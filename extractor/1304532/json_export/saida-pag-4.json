[{"id":32556319,"iid":9646,"project_id":1304532,"title":"Create new gitaly storage shard node to replace `nfs-file46`","description":"Gitaly storage shard `nfs-file46` (`file-46-stor-gprd.c.gitlab-production.internal`) is currently at `62.27%` usage.\n\nA new gitaly node should be created, and added to the list of shards configured to be included in consideration for storing new project repositories.\n\nThat way, `nfs-file46` can be removed from rotation without any concern that the node's removal from the configuration will put any additional burden on the remaining nodes.\n\nIt is important to avoid acceleration of usage growth on the remaining nodes accepting new repositories.","state":"closed","created_at":"2020-03-27T21:28:15.235Z","updated_at":"2022-08-04T13:53:05.763Z","closed_at":"2020-04-08T13:43:50.577Z","closed_by":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"labels":["C3","Infrastructure","Service::Gitaly","change","requires production access","workflow-infra::Done"],"milestone":null,"assignees":[{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"}],"author":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"type":"ISSUE","assignee":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"user_notes_count":0,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2020-03-30","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9646","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9646","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9646/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9646/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9646","relative":"#9646","full":"gitlab-com/gl-infra/reliability#9646"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":32556303,"iid":9645,"project_id":1304532,"title":"Create new gitaly storage shard node to replace `nfs-file43`","description":"Gitaly storage shard `nfs-file43` (`file-43-stor-gprd.c.gitlab-production.internal`) is currently at `60.38%` usage.\n\nA new gitaly node should be created, and added to the list of shards configured to be included in consideration for storing new project repositories.\n\nThat way, `nfs-file43` can be removed from rotation without any concern that the node's removal from the configuration will put any additional burden on the remaining nodes.\n\nIt is important to avoid acceleration of usage growth on the remaining nodes accepting new repositories.","state":"closed","created_at":"2020-03-27T21:27:07.447Z","updated_at":"2022-08-04T13:53:07.308Z","closed_at":"2020-04-09T13:42:14.292Z","closed_by":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"labels":["C3","Infrastructure","Service::Gitaly","change","requires production access","workflow-infra::Done"],"milestone":null,"assignees":[{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"}],"author":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"type":"ISSUE","assignee":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"user_notes_count":0,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2020-03-31","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9645","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9645","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9645/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9645/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9645","relative":"#9645","full":"gitlab-com/gl-infra/reliability#9645"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":32552241,"iid":9640,"project_id":1304532,"title":"Resolve redis config discrepancy for redis-cache between gstg and gprd","description":"Apart from credentials, the only discrepancy between the production and staging config for redis-cache nodes is the disk persistence options.  The redis-cache nodes in the staging environment enabled periodically writing an RDB dump, whereas production does not.  Since this dataset is meant to be ephemeral and gets persisted to disk anyway on clean shutdown, this may be a reasonable setting.  We can re-enable it later if we decide it's too expensive to repopulate this cache from empty, but anecdotally several people have mentioned that they think it's tolerable.  For now, let's just get the staging config to match production.\n\nFor reference, here's the discrepancy we're going to resolve:\n\n```shell\nmsmiley@saoirse:~$ ssh redis-cache-01-db-gprd.c.gitlab-production.internal -- sudo cat /var/opt/gitlab/redis/redis.conf | egrep -v '^ *($|#)' | perl -pe 's/(masterauth|requirepass) .*/$1 **REDACTED**/' \u003e /tmp/redis.conf.gprd\n\nmsmiley@saoirse:~$ ssh redis-cache-01-db-gstg.c.gitlab-staging-1.internal -- sudo cat /var/opt/gitlab/redis/redis.conf | egrep -v '^ *($|#)' | perl -pe 's/(masterauth|requirepass) .*/$1 **REDACTED**/' \u003e /tmp/redis.conf.gstg\n\nmsmiley@saoirse:~$ diff -U0 /tmp/redis.conf.{gstg,gprd}\n--- /tmp/redis.conf.gstg\t2020-03-27 10:53:49.830460831 -0700\n+++ /tmp/redis.conf.gprd\t2020-03-27 10:53:26.821766688 -0700\n@@ -12,3 +11,0 @@\n-save 900 1\n-save 300 10\n-save 60 10000\n```","state":"closed","created_at":"2020-03-27T18:26:50.129Z","updated_at":"2022-08-04T13:53:17.050Z","closed_at":"2020-03-31T03:12:23.161Z","closed_by":{"id":3947902,"username":"msmiley","name":"Matt Smiley","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3947902/avatar.png","web_url":"https://gitlab.com/msmiley"},"labels":["workflow-infra::Done"],"milestone":null,"assignees":[{"id":3947902,"username":"msmiley","name":"Matt Smiley","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3947902/avatar.png","web_url":"https://gitlab.com/msmiley"}],"author":{"id":3947902,"username":"msmiley","name":"Matt Smiley","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3947902/avatar.png","web_url":"https://gitlab.com/msmiley"},"type":"ISSUE","assignee":{"id":3947902,"username":"msmiley","name":"Matt Smiley","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3947902/avatar.png","web_url":"https://gitlab.com/msmiley"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9640","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9640","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9640/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9640/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9640","relative":"#9640","full":"gitlab-com/gl-infra/reliability#9640"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":32538978,"iid":9638,"project_id":1304532,"title":"Elastic: field expansion matches too many fields","description":"\n\nRequest: \n\n\u003cdetails\u003e\n\n```\n{\n  \"version\": true,\n  \"size\": 500,\n  \"sort\": [\n    {\n      \"json.time\": {\n        \"order\": \"desc\",\n        \"unmapped_type\": \"boolean\"\n      }\n    }\n  ],\n  \"_source\": {\n    \"excludes\": []\n  },\n  \"aggs\": {\n    \"2\": {\n      \"date_histogram\": {\n        \"field\": \"json.time\",\n        \"fixed_interval\": \"30s\",\n        \"time_zone\": \"UTC\",\n        \"min_doc_count\": 1\n      }\n    }\n  },\n  \"stored_fields\": [\n    \"*\"\n  ],\n  \"script_fields\": {\n    \"controller_and_action\": {\n      \"script\": {\n        \"source\": \"doc['json.controller.keyword'] + \\\"#\\\" + doc['json.action.keyword']\",\n        \"lang\": \"painless\"\n      }\n    }\n  },\n  \"docvalue_fields\": [\n    {\n      \"field\": \"@timestamp\",\n      \"format\": \"date_time\"\n    },\n    {\n      \"field\": \"json.expiry_from\",\n      \"format\": \"date_time\"\n    },\n    {\n      \"field\": \"json.expiry_to\",\n      \"format\": \"date_time\"\n    },\n    {\n      \"field\": \"json.extra.bucket.start\",\n      \"format\": \"date_time\"\n    },\n    {\n      \"field\": \"json.extra.bucket.stop\",\n      \"format\": \"date_time\"\n    },\n    {\n      \"field\": \"json.extra.commits.timestamp\",\n      \"format\": \"date_time\"\n    },\n    {\n      \"field\": \"json.extra.created_after\",\n      \"format\": \"date_time\"\n    },\n    {\n      \"field\": \"json.extra.created_at\",\n      \"format\": \"date_time\"\n    },\n    {\n      \"field\": \"json.extra.created_before\",\n      \"format\": \"date_time\"\n    },\n    {\n      \"field\": \"json.extra.due_date\",\n      \"format\": \"date_time\"\n    },\n    {\n      \"field\": \"json.extra.head_commit.timestamp\",\n      \"format\": \"date_time\"\n    },\n    {\n      \"field\": \"json.extra.pull_request.base.repo.created_at\",\n      \"format\": \"date_time\"\n    },\n    {\n      \"field\": \"json.extra.pull_request.base.repo.pushed_at\",\n      \"format\": \"date_time\"\n    },\n    {\n      \"field\": \"json.extra.pull_request.base.repo.updated_at\",\n      \"format\": \"date_time\"\n    },\n    {\n      \"field\": \"json.extra.pull_request.closed_at\",\n      \"format\": \"date_time\"\n    },\n    {\n      \"field\": \"json.extra.pull_request.created_at\",\n      \"format\": \"date_time\"\n    },\n    {\n      \"field\": \"json.extra.pull_request.head.repo.created_at\",\n      \"format\": \"date_time\"\n    },\n    {\n      \"field\": \"json.extra.pull_request.head.repo.pushed_at\",\n      \"format\": \"date_time\"\n    },\n    {\n      \"field\": \"json.extra.pull_request.head.repo.updated_at\",\n      \"format\": \"date_time\"\n    },\n    {\n      \"field\": \"json.extra.pull_request.merged_at\",\n      \"format\": \"date_time\"\n    },\n    {\n      \"field\": \"json.extra.pull_request.updated_at\",\n      \"format\": \"date_time\"\n    },\n    {\n      \"field\": \"json.extra.raw_response.created_on\",\n      \"format\": \"date_time\"\n    },\n    {\n      \"field\": \"json.extra.raw_response.updated_on\",\n      \"format\": \"date_time\"\n    },\n    {\n      \"field\": \"json.extra.repository.updated_at\",\n      \"format\": \"date_time\"\n    },\n    {\n      \"field\": \"json.extra.request_forgery_protection.bucket.start\",\n      \"format\": \"date_time\"\n    },\n    {\n      \"field\": \"json.extra.request_forgery_protection.bucket.stop\",\n      \"format\": \"date_time\"\n    },\n    {\n      \"field\": \"json.extra.request_forgery_protection.commits.timestamp\",\n      \"format\": \"date_time\"\n    },\n    {\n      \"field\": \"json.extra.request_forgery_protection.head_commit.timestamp\",\n      \"format\": \"date_time\"\n    },\n    {\n      \"field\": \"json.extra.request_forgery_protection.pull_request.base.repo.created_at\",\n      \"format\": \"date_time\"\n    },\n    {\n      \"field\": \"json.extra.request_forgery_protection.pull_request.base.repo.pushed_at\",\n      \"format\": \"date_time\"\n    },\n    {\n      \"field\": \"json.extra.request_forgery_protection.pull_request.base.repo.updated_at\",\n      \"format\": \"date_time\"\n    },\n    {\n      \"field\": \"json.extra.request_forgery_protection.pull_request.closed_at\",\n      \"format\": \"date_time\"\n    },\n    {\n      \"field\": \"json.extra.request_forgery_protection.pull_request.created_at\",\n      \"format\": \"date_time\"\n    },\n    {\n      \"field\": \"json.extra.request_forgery_protection.pull_request.head.repo.created_at\",\n      \"format\": \"date_time\"\n    },\n    {\n      \"field\": \"json.extra.request_forgery_protection.pull_request.head.repo.pushed_at\",\n      \"format\": \"date_time\"\n    },\n    {\n      \"field\": \"json.extra.request_forgery_protection.pull_request.head.repo.updated_at\",\n      \"format\": \"date_time\"\n    },\n    {\n      \"field\": \"json.extra.request_forgery_protection.pull_request.merged_at\",\n      \"format\": \"date_time\"\n    },\n    {\n      \"field\": \"json.extra.request_forgery_protection.pull_request.updated_at\",\n      \"format\": \"date_time\"\n    },\n    {\n      \"field\": \"json.extra.request_forgery_protection.repository.updated_at\",\n      \"format\": \"date_time\"\n    },\n    {\n      \"field\": \"json.time\",\n      \"format\": \"date_time\"\n    },\n    {\n      \"field\": \"publish_time\",\n      \"format\": \"date_time\"\n    }\n  ],\n  \"query\": {\n    \"bool\": {\n      \"must\": [],\n      \"filter\": [\n        {\n          \"multi_match\": {\n            \"type\": \"best_fields\",\n            \"query\": \"ExternalDiffUploader\",\n            \"lenient\": true\n          }\n        },\n        {\n          \"match_phrase\": {\n            \"json.controller\": {\n              \"query\": \"Projects::MergeRequests::DiffsController\"\n            }\n          }\n        },\n        {\n          \"range\": {\n            \"json.time\": {\n              \"format\": \"strict_date_optional_time\",\n              \"gte\": \"2020-03-27T12:00:00.000Z\",\n              \"lte\": \"2020-03-27T12:30:00.000Z\"\n            }\n          }\n        }\n      ],\n      \"should\": [],\n      \"must_not\": []\n    }\n  },\n  \"highlight\": {\n    \"pre_tags\": [\n      \"@kibana-highlighted-field@\"\n    ],\n    \"post_tags\": [\n      \"@/kibana-highlighted-field@\"\n    ],\n    \"fields\": {\n      \"*\": {}\n    },\n    \"fragment_size\": 2147483647\n  }\n}\n```\n\u003c/details\u003e\n\nResponse: \n\u003cdetails\u003e\n\n```\n{\n  \"took\": 5158,\n  \"timed_out\": false,\n  \"_shards\": {\n    \"total\": 762,\n    \"successful\": 750,\n    \"skipped\": 750,\n    \"failed\": 12,\n    \"failures\": [\n      {\n        \"shard\": 0,\n        \"index\": \"pubsub-rails-inf-gprd-001925\",\n        \"node\": \"jmnNQegZRWOO0aJBFjnZew\",\n        \"reason\": {\n          \"type\": \"query_shard_exception\",\n          \"reason\": \"failed to create query: {\\n  \\\"bool\\\" : {\\n    \\\"filter\\\" : [\\n      {\\n        \\\"multi_match\\\" : {\\n          \\\"query\\\" : \\\"ExternalDiffUploader\\\",\\n          \\\"fields\\\" : [ ],\\n          \\\"type\\\" : \\\"best_fields\\\",\\n          \\\"operator\\\" : \\\"OR\\\",\\n          \\\"slop\\\" : 0,\\n          \\\"prefix_length\\\" : 0,\\n          \\\"max_expansions\\\" : 50,\\n          \\\"lenient\\\" : true,\\n          \\\"zero_terms_query\\\" : \\\"NONE\\\",\\n          \\\"auto_generate_synonyms_phrase_query\\\" : true,\\n          \\\"fuzzy_transpositions\\\" : true,\\n          \\\"boost\\\" : 1.0\\n        }\\n      },\\n      {\\n        \\\"match_phrase\\\" : {\\n          \\\"json.controller\\\" : {\\n            \\\"query\\\" : \\\"Projects::MergeRequests::DiffsController\\\",\\n            \\\"slop\\\" : 0,\\n            \\\"zero_terms_query\\\" : \\\"NONE\\\",\\n            \\\"boost\\\" : 1.0\\n          }\\n        }\\n      },\\n      {\\n        \\\"range\\\" : {\\n          \\\"json.time\\\" : {\\n            \\\"from\\\" : \\\"2020-03-27T12:00:00.000Z\\\",\\n            \\\"to\\\" : \\\"2020-03-27T12:30:00.000Z\\\",\\n            \\\"include_lower\\\" : true,\\n            \\\"include_upper\\\" : true,\\n            \\\"format\\\" : \\\"strict_date_optional_time\\\",\\n            \\\"boost\\\" : 1.0\\n          }\\n        }\\n      }\\n    ],\\n    \\\"adjust_pure_negative\\\" : true,\\n    \\\"boost\\\" : 1.0\\n  }\\n}\",\n          \"index_uuid\": \"HunDEJAFRKieC7kFcif7zw\",\n          \"index\": \"pubsub-rails-inf-gprd-001925\",\n          \"caused_by\": {\n            \"type\": \"illegal_argument_exception\",\n            \"reason\": \"field expansion matches too many fields, limit: 1024, got: 1470\"\n          }\n        }\n      },\n      {\n        \"shard\": 0,\n        \"index\": \"pubsub-rails-inf-gprd-001926\",\n        \"node\": \"Nce627z_R7aRVIjH1JkAog\",\n        \"reason\": {\n          \"type\": \"query_shard_exception\",\n          \"reason\": \"failed to create query: {\\n  \\\"bool\\\" : {\\n    \\\"filter\\\" : [\\n      {\\n        \\\"multi_match\\\" : {\\n          \\\"query\\\" : \\\"ExternalDiffUploader\\\",\\n          \\\"fields\\\" : [ ],\\n          \\\"type\\\" : \\\"best_fields\\\",\\n          \\\"operator\\\" : \\\"OR\\\",\\n          \\\"slop\\\" : 0,\\n          \\\"prefix_length\\\" : 0,\\n          \\\"max_expansions\\\" : 50,\\n          \\\"lenient\\\" : true,\\n          \\\"zero_terms_query\\\" : \\\"NONE\\\",\\n          \\\"auto_generate_synonyms_phrase_query\\\" : true,\\n          \\\"fuzzy_transpositions\\\" : true,\\n          \\\"boost\\\" : 1.0\\n        }\\n      },\\n      {\\n        \\\"match_phrase\\\" : {\\n          \\\"json.controller\\\" : {\\n            \\\"query\\\" : \\\"Projects::MergeRequests::DiffsController\\\",\\n            \\\"slop\\\" : 0,\\n            \\\"zero_terms_query\\\" : \\\"NONE\\\",\\n            \\\"boost\\\" : 1.0\\n          }\\n        }\\n      },\\n      {\\n        \\\"range\\\" : {\\n          \\\"json.time\\\" : {\\n            \\\"from\\\" : \\\"2020-03-27T12:00:00.000Z\\\",\\n            \\\"to\\\" : \\\"2020-03-27T12:30:00.000Z\\\",\\n            \\\"include_lower\\\" : true,\\n            \\\"include_upper\\\" : true,\\n            \\\"format\\\" : \\\"strict_date_optional_time\\\",\\n            \\\"boost\\\" : 1.0\\n          }\\n        }\\n      }\\n    ],\\n    \\\"adjust_pure_negative\\\" : true,\\n    \\\"boost\\\" : 1.0\\n  }\\n}\",\n          \"index_uuid\": \"URp08IJpRjKQ6kRnKFJQ8w\",\n          \"index\": \"pubsub-rails-inf-gprd-001926\",\n          \"caused_by\": {\n            \"type\": \"illegal_argument_exception\",\n            \"reason\": \"field expansion matches too many fields, limit: 1024, got: 1136\"\n          }\n        }\n      }\n    ]\n  },\n  \"hits\": {\n    \"total\": 0,\n    \"max_score\": 0,\n    \"hits\": []\n  }\n}\n```\n\n\u003c/details\u003e","state":"closed","created_at":"2020-03-27T13:25:00.939Z","updated_at":"2022-08-04T13:53:20.233Z","closed_at":"2020-04-24T16:40:24.636Z","closed_by":{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},"labels":["Service::Logging","workflow-infra::Done"],"milestone":null,"assignees":[],"author":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"type":"ISSUE","assignee":null,"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9638","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9638","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9638/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9638/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":"https://gitlab.com/api/v4/projects/1304532/issues/9876"},"references":{"short":"#9638","relative":"#9638","full":"gitlab-com/gl-infra/reliability#9638"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":134,"epic":{"id":16079,"iid":134,"title":"clean up after migration to 7.X","url":"/groups/gitlab-com/gl-infra/-/epics/134","group_id":1112072,"human_readable_timestamp":"\u003cstrong\u003e1174\u003c/strong\u003e days elapsed"},"iteration":null,"health_status":"on_track"},{"id":32503229,"iid":9627,"project_id":1304532,"title":"Configure WAL-G's \"wal-push\" and \"backup-push\" to test Postgres backups creation with WAL-G on production","description":"In https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/8903, we started to test WAL-G for both the creation and use of backups on **staging**.\n\nAfter 3 weeks of successful testing (see `Daily staging restore using WAL-G, from WAL-G staging archive` in https://ops.gitlab.net/gitlab-com/gl-infra/gitlab-restore/postgres-gprd/pipeline_schedules), it is time to start testing on a production replica.\n\n1. [x] Decide how replica will be chosen and how it will be configured using Chef (note that patroni-01 is the master in gprd right now). Such replica is to be marked as unavailable for failover.\n1. [x] In addition to WAL-E, install WAL-G 0.2.14 to all Postgres instances (how it can be done: https://ops.gitlab.net/gitlab-com/gl-infra/gitlab-restore/postgres-gprd/blob/master/bootstrap.sh#L84). It is okay to have both WAL-E and WAL-G installed.\n1. [x] Configure WAL-G. Use some new GCS bucket, different from the existing ones.\n1. [ ] on the chosen replica in `gprd`, put WAL-G's `wal-push` to `archive_command`, and set `archive_mode` to `'always'`.\n1. [ ] Ensure that wal-push log does not have errors, but shows successful WAL-pushing and the new GCS bucket/folder is being filled with WALs.\n1. [ ] Configure daily `backup-push` on the same replica (a cronjob similar to WAL-E's `backup-push` cronjob on the master), to have full backups daily.\n\nAdditional TODOs:\n\n- [ ] https://gitlab.com/gitlab-com/runbooks/blob/master/rules/gitlab-wale-backups.yml#L24\n- [ ] adjust runbooks","state":"closed","created_at":"2020-03-26T17:51:12.192Z","updated_at":"2021-03-17T21:59:33.725Z","closed_at":"2020-11-13T11:49:16.163Z","closed_by":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"labels":["Database","alertmanager-silence","backup","priority::1","workflow-infra::Done"],"milestone":{"id":1682540,"iid":102,"group_id":1112072,"title":"Datastores team - W45","description":"Datastores team, 1st half of November, 14 days.","state":"closed","created_at":"2020-10-19T15:54:43.296Z","updated_at":"2020-11-13T22:23:12.095Z","due_date":"2020-11-15","start_date":"2020-11-02","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/102"},"assignees":[{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"}],"author":{"id":1906296,"username":"NikolayS","name":"Nikolay Samokhvalov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1906296/avatar.png","web_url":"https://gitlab.com/NikolayS"},"type":"ISSUE","assignee":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"user_notes_count":116,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9627","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":8,"completed_count":3},"weight":8,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9627","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9627/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9627/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9627","relative":"#9627","full":"gitlab-com/gl-infra/reliability#9627"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":27,"epic":{"id":3033,"iid":27,"title":"Backup Masterless","url":"/groups/gitlab-com/gl-infra/-/epics/27","group_id":1112072,"human_readable_end_date":"Dec 14, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":32496839,"iid":9625,"project_id":1304532,"title":"Incorrect runbook link for alert `service_apdex_slo_out_of_bounds_lower_15m`","description":"Link for `runbook` (\"`troubleshooting/service-ci-runners.md`\") on `service_apdex_slo_out_of_bounds_lower_15m` alert is incorrect.\n\nCorrect link is: https://ops.gitlab.net/gitlab-com/runbooks/-/blob/master/docs/ci-runners/service-ci-runners.md","state":"closed","created_at":"2020-03-26T16:04:08.939Z","updated_at":"2022-08-04T13:53:28.409Z","closed_at":"2021-09-07T21:14:47.179Z","closed_by":{"id":3623028,"username":"cmiskell","name":"Craig Miskell","state":"active","avatar_url":"https://secure.gravatar.com/avatar/852a93b505b1f4a5549595792035f445?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmiskell"},"labels":["alert","runbook","workflow-infra::Done"],"milestone":null,"assignees":[{"id":3623028,"username":"cmiskell","name":"Craig Miskell","state":"active","avatar_url":"https://secure.gravatar.com/avatar/852a93b505b1f4a5549595792035f445?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmiskell"}],"author":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"type":"ISSUE","assignee":{"id":3623028,"username":"cmiskell","name":"Craig Miskell","state":"active","avatar_url":"https://secure.gravatar.com/avatar/852a93b505b1f4a5549595792035f445?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmiskell"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9625","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9625","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9625/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9625/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9625","relative":"#9625","full":"gitlab-com/gl-infra/reliability#9625"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":32481109,"iid":9621,"project_id":1304532,"title":"Terraform artifacts too large in CI","description":"CI jobs for terraform are failing with `413 Request Entity Too Large` errors.\n\nhttps://ops.gitlab.net/gitlab-com/gitlab-com-infrastructure/-/jobs/1029505\n\n```\n environments/gstg/.terraform: found 3365 matching files \n ERROR: Uploading artifacts to coordinator... too large archive  id=1029505 responseStatus=413 Request Entity Too Large status=413 Request Entity Too Large token=bjnHYt3n\n FATAL: too large                                   \n ERROR: Job failed: exit code 1\n```","state":"closed","created_at":"2020-03-26T09:28:59.820Z","updated_at":"2022-08-04T13:53:31.452Z","closed_at":"2020-03-26T10:25:17.887Z","closed_by":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"labels":["terraform","workflow-infra::Done"],"milestone":null,"assignees":[{"id":116,"username":"marin","name":"Marin Jankovski","state":"active","avatar_url":"https://secure.gravatar.com/avatar/5154f0b0eda3f798c8a254962d57192f?s=80\u0026d=identicon","web_url":"https://gitlab.com/marin"}],"author":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"type":"ISSUE","assignee":{"id":116,"username":"marin","name":"Marin Jankovski","state":"active","avatar_url":"https://secure.gravatar.com/avatar/5154f0b0eda3f798c8a254962d57192f?s=80\u0026d=identicon","web_url":"https://gitlab.com/marin"},"user_notes_count":6,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9621","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9621","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9621/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9621/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9621","relative":"#9621","full":"gitlab-com/gl-infra/reliability#9621"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":32478381,"iid":9620,"project_id":1304532,"title":"reactive_caching queue execution time SLO violations","description":"We are regularly getting alerts for violating the `reactive_caching` queue execution time SLO.\nWe should investigate the reason and either improve the execution times or adjust the SLO.","state":"closed","created_at":"2020-03-26T08:25:14.694Z","updated_at":"2022-08-04T13:53:32.105Z","closed_at":"2020-03-26T10:33:14.179Z","closed_by":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"labels":["Service::Sidekiq","workflow-infra::Done"],"milestone":null,"assignees":[{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"}],"author":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"type":"ISSUE","assignee":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"user_notes_count":5,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9620","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9620","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9620/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9620/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9620","relative":"#9620","full":"gitlab-com/gl-infra/reliability#9620"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":191,"epic":{"id":30438,"iid":191,"title":"Make reactive_caching queue not exceed its SLIs","url":"/groups/gitlab-com/gl-infra/-/epics/191","group_id":1112072,"human_readable_timestamp":"\u003cstrong\u003e1146\u003c/strong\u003e days elapsed"},"iteration":null,"health_status":null},{"id":32344201,"iid":9594,"project_id":1304532,"title":"Experimentally consider reducing Gitaly storage shard node instance GCP Machine Type","description":"Experimentally consider and conduct and data-based evaluation of the consequences of reducing Gitaly storage shard node instance GCP Machine Type as part of a measure to reduce Operating Expenditures.\n\nProposed by @jstava: https://gitlab.com/gitlab-org/gitlab/-/issues/211609","state":"closed","created_at":"2020-03-23T16:26:09.344Z","updated_at":"2022-08-04T13:53:56.220Z","closed_at":"2022-08-02T06:02:39.087Z","closed_by":{"id":1786152,"username":"gitlab-bot","name":"ü§ñ GitLab Bot ü§ñ","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1786152/avatar.png","web_url":"https://gitlab.com/gitlab-bot"},"labels":["Infrastructure","Service::GCP","workflow-infra::Done"],"milestone":null,"assignees":[],"author":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"type":"ISSUE","assignee":null,"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2020-04-30","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9594","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9594","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9594/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9594/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9594","relative":"#9594","full":"gitlab-com/gl-infra/reliability#9594"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":32341678,"iid":9592,"project_id":1304532,"title":"Execute PostgreSQL upgrade on staging","description":"Using the template: https://ops.gitlab.net/gitlab-com/gl-infra/db-migration/-/issues/10\n\nWe would like to execute the first test migration for the PostgreSQL upgrade. The date would be at 31 of March of 2020 12:30 UTC\n\nThe maintenance time for staging should be from 30 to 40 minutes.\n\nPlease upgrade 3 nodes, we will keep 3 secondaries hosts for the rollback.","state":"closed","created_at":"2020-03-23T15:23:57.562Z","updated_at":"2021-06-24T08:08:04.313Z","closed_at":"2020-05-10T22:35:10.827Z","closed_by":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"labels":["Database","OnGres::Project","priority::2","workflow-infra::Done"],"milestone":{"id":1239654,"iid":76,"group_id":1112072,"title":"W16 DBRE","description":"","state":"closed","created_at":"2020-04-14T09:14:09.392Z","updated_at":"2020-05-13T19:56:10.734Z","due_date":"2020-05-08","start_date":"2020-04-14","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/76"},"assignees":[{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"}],"author":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"type":"ISSUE","assignee":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"user_notes_count":28,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2020-05-28","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9592","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9592","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9592/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9592/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9592","relative":"#9592","full":"gitlab-com/gl-infra/reliability#9592"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":106,"epic":{"id":14061,"iid":106,"title":"Upgrade Postgresql to version 11.7 on GitLab.com","url":"/groups/gitlab-com/gl-infra/-/epics/106","group_id":1112072,"human_readable_end_date":"Apr 30, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":32249101,"iid":9586,"project_id":1304532,"title":"Redis PCAP files in /tmp","description":"@gitlab-com/gl-infra \n\nThere are many pcap files that are quite large on `redis-cache-01-db-gprd.c.gitlab-production.internal` in the `/tmp` directory. This has put the filespace free down to 6% or so on the root filesystem.\n\nIf you need any of these files for posterity, please move them and delete them. And if you made some and don't need them, consider deleting them ASAP.\n\nThank you!","state":"closed","created_at":"2020-03-20T20:47:00.064Z","updated_at":"2022-08-04T13:54:06.620Z","closed_at":"2020-03-21T16:05:29.151Z","closed_by":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"labels":["Service::Redis","workflow-infra::Done"],"milestone":{"id":1132902,"iid":65,"group_id":1112072,"title":"Reliability - March 2020","description":"","state":"closed","created_at":"2020-01-23T15:43:44.224Z","updated_at":"2020-04-13T03:13:41.645Z","due_date":"2020-03-31","start_date":"2020-03-01","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/65"},"assignees":[{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"}],"author":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"type":"ISSUE","assignee":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"user_notes_count":3,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9586","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9586","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9586/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9586/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9586","relative":"#9586","full":"gitlab-com/gl-infra/reliability#9586"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":32239542,"iid":9584,"project_id":1304532,"title":"create the rollback script for the postgresql upgrade","description":"We need to script the rollback of the Postgresql upgrade if we need to use it.\n\nWe would consider using GCP snapshots for it.\n\nAlso, we would keep 2 database nodes that are read-only that we will not execute the upgrade. With those nodes, we could restore the environment quickly.\n\nPlease consider that we will be in a scenario after the upgrade script described in the file: https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/9277\n\nI would like share with you the steps for the rollback script:\n\nAt the begining of the rollback we will have:\n\n* A snapshot consistent from the database before the upgrade.\n* Excluded instances group - 4 nodes not upgraded. If we are successful with the upgrade, we would not upgrade them, reducing the cluster number of nodes.\n\nAt this point we are ready to run the rollback upgrade.\n\n- Run Chef `merge_and_apply` to rollback the `patroni.yml` file.\n- Stop services on failed instances like `chef-client`, `pgbouncer`, `patroni`, and `postgresql` (check manually).\n- On failed instances change config to false values and avoid start service accidentally.\n- Stop `pgbouncer` on \"excluded instances\" to avoid connections.\n- Start `chef-client` services on \"excluded instances\".\n- Resume patroni service --wait\n- Check if patroni elect a new leader.\n- Start `pgbouncer` \n- [continue...]","state":"closed","created_at":"2020-03-20T15:41:05.524Z","updated_at":"2022-08-04T13:54:13.032Z","closed_at":"2020-05-04T14:04:05.822Z","closed_by":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"labels":["Database","OnGres::Project","priority::2","workflow-infra::Done"],"milestone":{"id":1195326,"iid":72,"group_id":1112072,"title":"W12 DBRE","description":"","state":"closed","created_at":"2020-03-16T09:44:04.095Z","updated_at":"2020-04-06T02:13:30.558Z","due_date":"2020-03-27","start_date":"2020-03-16","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/72"},"assignees":[{"id":2493611,"username":"adescoms","name":"Adri√°n Escoms","state":"active","avatar_url":"https://secure.gravatar.com/avatar/d6f86d318669a8b32174b7132607443d?s=80\u0026d=identicon","web_url":"https://gitlab.com/adescoms"},{"id":3715468,"username":"sergio.ostapowicz","name":"Sergio Alejandro Ostapowicz","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3715468/avatar.png","web_url":"https://gitlab.com/sergio.ostapowicz"}],"author":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"type":"ISSUE","assignee":{"id":2493611,"username":"adescoms","name":"Adri√°n Escoms","state":"active","avatar_url":"https://secure.gravatar.com/avatar/d6f86d318669a8b32174b7132607443d?s=80\u0026d=identicon","web_url":"https://gitlab.com/adescoms"},"user_notes_count":37,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":"2020-05-29","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9584","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9584","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9584/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9584/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9584","relative":"#9584","full":"gitlab-com/gl-infra/reliability#9584"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":32155027,"iid":9555,"project_id":1304532,"title":"New storage setting for Terraform state","description":"In https://gitlab.com/groups/gitlab-org/-/epics/2673, the Configure:System group is creating a new feature to store Terraform state in GitLab. This involves adding a new storage setting, since Terraform state doesn't correlate to any of the other settings.\n\nhttps://gitlab.com/gitlab-org/gitlab/-/merge_requests/26619 introduces an uploader that uses this new storage setting. It also adds default values for this setting.\n\nhttps://gitlab.com/gitlab-org/omnibus-gitlab/-/merge_requests/3983 adds the storage setting to Omnibus.\n\nhttps://gitlab.com/gitlab-org/charts/gitlab/-/merge_requests/1208 adds the storage setting to GitLab Helm Chart.\n\n- [x] Add buckets for the feature in our module https://ops.gitlab.net/gitlab-com/gl-infra/terraform-modules/google/storage-buckets/-/merge_requests/23\n- [x] Setup buckets on gstg https://ops.gitlab.net/gitlab-com/gitlab-com-infrastructure/-/merge_requests/1608\n- [x] Enable feature on gstg https://ops.gitlab.net/gitlab-cookbooks/chef-repo/-/merge_requests/3163\n- [x] Setup buckets on gprd https://ops.gitlab.net/gitlab-com/gitlab-com-infrastructure/-/merge_requests/1610\n- [x] Enable feature on gprd https://ops.gitlab.net/gitlab-cookbooks/chef-repo/-/merge_requests/3164\n\n/cc @nicholasklick @mattkasa","state":"closed","created_at":"2020-03-18T22:38:15.960Z","updated_at":"2021-06-24T08:08:05.835Z","closed_at":"2020-04-16T16:13:01.914Z","closed_by":{"id":367626,"username":"alejandro","name":"Alejandro Rodr√≠guez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"},"labels":["devops::configure","group::system","workflow-infra::Done"],"milestone":{"id":1191536,"iid":71,"group_id":1112072,"title":"Reliability - April 2020","description":"","state":"closed","created_at":"2020-03-12T16:27:31.364Z","updated_at":"2020-05-08T14:25:17.816Z","due_date":"2020-04-30","start_date":"2020-04-01","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/71"},"assignees":[{"id":367626,"username":"alejandro","name":"Alejandro Rodr√≠guez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"},{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},{"id":2222520,"username":"dawsmith","name":"Dave Smith","state":"active","avatar_url":"https://secure.gravatar.com/avatar/ef341e061f6b86461626e64c5fbcfe52?s=80\u0026d=identicon","web_url":"https://gitlab.com/dawsmith"}],"author":{"id":4373269,"username":"ali-gitlab","name":"Alishan Ladhani","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4373269/avatar.png","web_url":"https://gitlab.com/ali-gitlab"},"type":"ISSUE","assignee":{"id":367626,"username":"alejandro","name":"Alejandro Rodr√≠guez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"},"user_notes_count":18,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9555","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":5,"completed_count":5},"weight":2,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9555","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9555/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9555/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9555","relative":"#9555","full":"gitlab-com/gl-infra/reliability#9555"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":32151883,"iid":9553,"project_id":1304532,"title":"DNS record for `*.asaba-sandbox.gitlap.com`","description":"Please add the following A record to DNS:\n\n```\n    \"*.asaba-sandbox.gitlap.com.\": {\n      \"records\": [\n         \"35.208.230.243\"\n       ],\n      \"ttl\": 300\n    }\n```\n\nRelated to gitlab-com/gl-security/engineering#884.\n\n@dawsmith @AnthonySandoval for assignment.","state":"closed","created_at":"2020-03-18T20:27:11.005Z","updated_at":"2022-08-04T13:54:31.770Z","closed_at":"2020-03-18T23:19:32.786Z","closed_by":{"id":367626,"username":"alejandro","name":"Alejandro Rodr√≠guez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"},"labels":["workflow-infra::Done"],"milestone":{"id":1132902,"iid":65,"group_id":1112072,"title":"Reliability - March 2020","description":"","state":"closed","created_at":"2020-01-23T15:43:44.224Z","updated_at":"2020-04-13T03:13:41.645Z","due_date":"2020-03-31","start_date":"2020-03-01","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/65"},"assignees":[{"id":367626,"username":"alejandro","name":"Alejandro Rodr√≠guez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"}],"author":{"id":2165775,"username":"asaba","name":"Antony Saba","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2165775/avatar.png","web_url":"https://gitlab.com/asaba"},"type":"ISSUE","assignee":{"id":367626,"username":"alejandro","name":"Alejandro Rodr√≠guez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9553","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9553","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9553/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9553/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9553","relative":"#9553","full":"gitlab-com/gl-infra/reliability#9553"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":32145921,"iid":9550,"project_id":1304532,"title":"Incident Review for intermittent CPU saturation on gitaly node file-45 on 2020-03-16","description":"\u003c!--\n**Please note:** if the incident relates to sensitive data, or is security related consider\nlabeling this issue with ~security and mark it confidential.\n*** \n--\u003e\n\nIncident being reviewed: https://gitlab.com/gitlab-com/gl-infra/production/-/issues/1774\n\nRelated incident with the same root cause: https://gitlab.com/gitlab-com/gl-infra/production/-/issues/1731\n\nThese incidents are confidential, to protect the privacy of the projects involved.\n\n## Summary\n\n- Service(s) affected : Gitaly\n- Minutes downtime or degradation : Several 10-25 minute periods of slowness, summing to 195 minutes spread across 11 days\n\nOne of the Gitaly shards (`file-45-stor-gprd`) reached CPU saturation, leading to an increased slowness and rate of errors (timeouts).  Other Gitaly shards were not affected.\n\nThe CPU saturation was triggered by many clients concurrently running `git fetch` or `git clone` on a repo that has a large graph of commit objects to traverse.  To generate the inventory of objects that the client needs, Gitaly runs `git pack-objects`, which for this repo requires significant CPU time and memory.  Enough of these helper processes were running that the host starved for CPU time, resulting in the observed increased latency and error rate (timeouts) from this particular Gitaly shard.\n\nFor reference, this incident ties back to other similar regressions on this particular Gitaly shard starting on 2020-03-05.  Each regression event caused roughly 10-25 minutes of degraded performance on 1 of the 52 Gitaly shards (`file-45`).  Now that we understand the pathology, we can link it back to the following regression events:\n- 2020-03-16: 3 events = 65 minutes\n- 2020-03-13: 1 event = 20 minutes\n- 2020-03-12: 3 events = 60 minutes\n- 2020-03-09: 1 event, 10 minutes\n- 2020-03-05: 2 events, 40 minutes\n\n\n### Mitigations\n\nThe owner of the repo whose distributed builds triggered this regression has kindly offered to adjust their build to reduce its impact.  Reusing fresher git-clones on the build servers may help, and reducing concurrency would definitely help.\n\nOn the GitLab server side, Gitaly needs to avoid saturation by limiting resource usage by these helper processes.  Both CPU time and memory are relevant to this problem.\n\nOne options is to limit the concurrency of the gRPC `PostUploadPack` calls, which spawn these `git pack-objects` helper processes.  (For context, the `git` client's fetch, pull, clone, etc. subcommand sends an HTTP POST request to the `[repo-url]/git-upload-pack` endpoint, which causes Rails to send Gitaly a `PostUploadPack` gRPC call.)  Using an instance-wide limit in combination with a smaller scoper limit per-namespace or per-project would allow the other projects to continue functioning while the busy peer is rate-limited.\n\nAnother possibility is using cgroups to impose a hard limit on resource usage by particular types of helper processes.  However, under certain workload patterns, that could result in starving all tenants of a Gitaly shard.  This may be better suited as a second line of defense, with the application-based concurrency limits acting as the primary defense with more graceful degradation behavior.\n\n\n## Impact \u0026 Metrics\n\n- What was the impact of the incident?  Slowness and intermittent errors for operations involving git repos stored on Gitaly shard `file-45`.\n- Who was impacted by this incident?  All customers having git repos stored on Gitaly shard `file-45` (roughly 2% of the repos on GitLab.com).\n- How did the incident impact customers?  Git operations would have been slow enough to sometimes timeout.\n- How many attempts were made to access the impacted service/feature?  Routine traffic over a 20 minute timespan\n- How many customers were affected?  Approximately 2% of repos were slow to access (sometimes up to timing out).  Unknown how many customers actively experienced this slowness.\n- How many customers tried to access the impacted service/feature?  See above.\n\n\n### Dashboard \"gitaly: Overview\"\n\nLatency apdex for the Gitaly service as a whole (i.e. not just the degraded shard) shows a drop of at most 2% during the regressions on 2020-03-16.  Corresponding spikes in Gitaly error rate (due to timeouts) jumped as high as 0.6%.  A similar pattern was found on the earlier dates that we later backtracked this pathology to.\n\n#### Latency\n\nhttps://dashboards.gitlab.net/d/gitaly-main/gitaly-overview?orgId=1\u0026from=1584378000000\u0026to=1584396000000\u0026fullscreen\u0026panelId=3\u0026var-PROMETHEUS_DS=Global\u0026var-environment=gprd\u0026var-stage=main\u0026var-sigma=2\n\n![Screenshot_from_2020-03-18_13-21-00](/uploads/9f029a264cdf89e7f9b6451632788943/Screenshot_from_2020-03-18_13-21-00.png)\n\n#### Error rate\n\nhttps://dashboards.gitlab.net/d/gitaly-main/gitaly-overview?orgId=1\u0026from=1584378000000\u0026to=1584396000000\u0026fullscreen\u0026panelId=4\u0026var-PROMETHEUS_DS=Global\u0026var-environment=gprd\u0026var-stage=main\u0026var-sigma=2\n\n![Screenshot_from_2020-03-18_13-26-30](/uploads/ecaa2a365c57c1c85905a5be558866eb/Screenshot_from_2020-03-18_13-26-30.png)\n\n### Dashboard \"Host Stats\"\n\nThe host-level resource usage metrics for the affected Gitaly node (`file-45`) clearly show the CPU usage saturation and memory usage increase.\n\nNetwork egress throughput spiked as a result of sending the clients the git objects they needed, but the network throughput was nowhere near the saturation point.  Disk I/O (not shown) was not significantly affected.  Disk read throughput moderately increased but most disk I/O was satisfied by the filesystem cache, with physical disk I/O only increasing as a result of the cache being eroded by the anonymous memory allocations by the numerous `git pack-objects` processes. \n\n#### CPU usage\n\nhttps://dashboards.gitlab.net/d/bd2Kl9Imk/host-stats?orgId=1\u0026var-environment=gprd\u0026var-node=file-45-stor-gprd.c.gitlab-production.internal\u0026var-promethus=prometheus-01-inf-gprd\u0026from=1584378000000\u0026to=1584396000000\u0026fullscreen\u0026panelId=8\n\n![Screenshot_from_2020-03-18_13-29-29](/uploads/0399bf11617d5f941ed26ab0c3367744/Screenshot_from_2020-03-18_13-29-29.png)\n\n#### Memory usage\n\nhttps://dashboards.gitlab.net/d/bd2Kl9Imk/host-stats?orgId=1\u0026var-environment=gprd\u0026var-node=file-45-stor-gprd.c.gitlab-production.internal\u0026var-promethus=prometheus-01-inf-gprd\u0026from=1584378000000\u0026to=1584396000000\u0026fullscreen\u0026panelId=39\n\n![Screenshot_from_2020-03-18_13-31-17](/uploads/c7c94b0db43e90d19cecb7a1ed874b3c/Screenshot_from_2020-03-18_13-31-17.png)\n\n#### Network usage\n\nhttps://dashboards.gitlab.net/d/bd2Kl9Imk/host-stats?orgId=1\u0026var-environment=gprd\u0026var-node=file-45-stor-gprd.c.gitlab-production.internal\u0026var-promethus=prometheus-01-inf-gprd\u0026from=1584378000000\u0026to=1584396000000\u0026fullscreen\u0026panelId=12\n\n![Screenshot_from_2020-03-18_13-32-21](/uploads/9deb042d4ef9df1bd6adbd90831945b2/Screenshot_from_2020-03-18_13-32-21.png)\n\n### Command line list of processes\n\n`top` shows the CPU usage was predominantly from the `git pack-objects` processes spawned by Gitaly, rather than by threads within Gitaly itself.  Note that each of these processes holds a significant amount of resident memory beyond its shared memory.\n\nAlso, each of these `git pack-objects` processes has accumulated many seconds of CPU time (some have several minutes of CPU time).  Follow-up analysis showed that these processes tended to have 40-60% of wall clock time spent on-CPU, at least during the regression; we suspect these processes are entirely CPU-bound and that their off-CPU time may have just been waiting for their next time slice, due to CPU starvation.\n\nThese `git pack-objects` processes were mostly operating on the same git repo directory (not shown), which is one of the ways we traced the regression back to its triggering conditions.\n\n#### Top processes using CPU time\n\n```shell\ntop - 20:03:16 up 67 days, 23:14,  2 users,  load average: 82.07, 71.93, 43.87\nTasks: 972 total,  75 running, 700 sleeping,   0 stopped,  30 zombie\n%Cpu(s): 94.9 us,  4.6 sy,  0.0 ni,  0.1 id,  0.0 wa,  0.0 hi,  0.4 si,  0.0 st\nKiB Mem : 12376827+total, 18716604 free, 71279952 used, 33771716 buff/cache\nKiB Swap:        0 total,        0 free,        0 used. 49609072 avail Mem \n\n  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                                                                                                                                 \n30400 git       20   0 12.944g 2.407g  18684 S  87.3  2.0   3104:23 /opt/gitlab/embedded/bin/gitaly /var/opt/gitlab/gitaly/config.toml                                                                      \n24383 git       20   0 3666708 0.985g 724520 R  55.9  0.8   0:11.10 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --delta-base-offset                                       \n18792 git       20   0 4010080 1.421g 910388 R  52.3  1.2   0:44.75 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --delta-base-offset                                       \n15964 git       20   0 4048068 1.616g 995520 R  52.0  1.4   1:06.52 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --delta-base-offset                                       \n17808 git       20   0 4014652 1.480g 945304 R  51.3  1.3   0:50.92 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --delta-base-offset                                       \n19394 git       20   0 3912712 1.389g 891808 R  50.3  1.2   0:41.27 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --delta-base-offset                                       \n10993 git       20   0 4409636 3.195g 2.279g R  50.0  2.7   1:36.05 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --delta-base-offset                                       \n16897 git       20   0 4531220 2.765g 1.732g R  47.4  2.3   3:41.96 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --delta-base-offset                                       \n13408 git       20   0 4305772 1.813g 0.988g R  47.1  1.5   1:24.43 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --delta-base-offset                                       \n14087 git       20   0 4264240 1.769g 0.983g R  47.1  1.5   1:19.99 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --delta-base-offset                                       \n14833 git       20   0 4264240 1.758g 0.979g R  46.7  1.5   1:18.16 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --delta-base-offset                                       \n14516 git       20   0 4531220 2.773g 1.739g R  46.1  2.3   3:51.42 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --delta-base-offset                                       \n19094 git       20   0 4010080 1.418g 909592 R  46.1  1.2   0:43.87 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --delta-base-offset                                       \n 4721 git       20   0 4431444 3.173g 2.237g R  45.8  2.7   1:43.69 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --delta-base-offset                                       \n14081 git       20   0 4531220 2.923g 1.888g R  45.4  2.5   3:57.74 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --delta-base-offset                                       \n16557 git       20   0 4035388 1.556g 971636 R  45.1  1.3   0:59.52 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --delta-base-offset                                       \n21825 git       20   0 3852644 1.219g 824620 R  45.1  1.0   0:26.51 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --delta-base-offset                                       \n12431 git       20   0 4406380 3.212g 2.300g R  44.4  2.7   1:32.37 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --delta-base-offset                                       \n23211 git       20   0 3769068 1.121g 776424 R  44.4  0.9   0:18.12 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --delta-base-offset                                       \n16331 git       20   0 4036872 1.577g 980652 R  44.1  1.3   1:01.84 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --delta-base-offset                                       \n24308 git       20   0 4495184 2.531g 1.533g R  44.1  2.1   3:13.28 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --delta-base-offset                                       \n15668 git       20   0 4049636 1.626g 976.6m R  43.8  1.4   1:07.32 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --delta-base-offset                                       \n17750 git       20   0 4021540 1.504g 953560 R  43.8  1.3   0:52.94 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --delta-base-offset                                       \n 5924 root      20   0  775092 211420  12276 S  43.1  0.2   1190:39 /opt/td-agent/embedded/bin/ruby -Eascii-8bit:ascii-8bit /opt/td-agent/embedded/bin/fluentd --log /var/log/td-agent/td-agent.log --daem+ \n12601 git       20   0 4531220 2.895g 1.860g R  42.8  2.5   3:58.59 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --delta-base-offset                                       \n18466 git       20   0 4011404 1.438g 919280 R  42.5  1.2   0:46.23 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --delta-base-offset                                       \n19942 git       20   0 3906556 1.356g 876976 R  42.5  1.1   0:37.52 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --delta-base-offset                                       \n17034 git       20   0 4035388 1.551g 969276 R  42.2  1.3   0:58.61 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --delta-base-offset                                       \n13404 git       20   0 4305772 1.803g 0.985g R  41.8  1.5   1:22.21 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --delta-base-offset                                       \n15915 git       20   0 4047368 1.610g 991744 R  41.5  1.4   1:05.33 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --delta-base-offset                                       \n19079 git       20   0 3912712 1.386g 890100 R  41.2  1.2   0:42.30 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --delta-base-offset                                       \n 2105 git       20   0 3624628 3.441g   3600 R  39.2  2.9   2:59.31 /opt/gitlab/embedded/libexec/git-core/git unpack-objects --pack_header=2,33 --strict --max-input-size=10485760000                       \n18049 git       20   0 4018152 1.483g 943724 R  39.2  1.3   0:50.88 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --delta-base-offset                                       \n22826 git       20   0 4495184 2.525g 1.528g R  38.9  2.1   3:18.47 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --delta-base-offset                                       \n16607 git       20   0 4031684 1.536g 963384 R  38.6  1.3   0:57.23 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --delta-base-offset                                       \n21679 git       20   0 3854772 1.221g 823376 R  38.6  1.0   0:28.12 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --delta-base-offset                                       \n23295 git       20   0 4495184 2.544g 1.547g R  38.6  2.2   3:17.52 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --delta-base-offset                                       \n16630 git       20   0 4035388 1.569g 978100 R  38.2  1.3   1:00.71 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --delta-base-offset                                       \n19127 git       20   0 3913500 1.391g 890976 R  37.9  1.2   0:42.71 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --delta-base-offset                                       \n12430 git       20   0 4414044 3.219g 2.300g R  37.6  2.7   1:32.96 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --delta-base-offset                                       \n17812 git       20   0 4013020 1.475g 944612 R  37.6  1.2   0:50.06 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --delta-base-offset                                       \n17967 git       20   0 4016844 1.482g 943656 R  37.6  1.3   0:50.65 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --delta-base-offset                                       \n13384 git       20   0 4305772 1.812g 0.987g R  37.3  1.5   1:23.82 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --delta-base-offset                                       \n14866 git       20   0 4264240 1.716g 985.4m R  37.3  1.5   1:11.54 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --delta-base-offset                                       \n15103 git       20   0 4264240 1.722g 989.3m R  37.3  1.5   1:12.10 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --delta-base-offset                                       \n 7408 git       20   0 2235824 870708 578048 R  36.9  0.7   1:44.94 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --progress --delta-base-offset --include-tag              \n 7871 git       20   0 4409636 3.151g 2.235g R  36.9  2.7   1:37.31 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --delta-base-offset                                       \n22605 git       20   0 4495184 2.534g 1.536g R  36.9  2.1   3:21.44 /opt/gitlab/embedded/libexec/git-core/git pack-objects --revs --thin --stdout --delta-base-offset                                       \n...\n```\n\n### CPU profile of Gitaly host `file-45` during the regression\n\nA CPU profile of all on-CPU processes shows that `git pack-objects` dominated CPU time and that they collectively spent most of their time calculating the deltas between what git objects the client request says it already has versus what the server-side bare repo has available to offer.  This suggests that the pathology is more likely to affect git repos with a large complex graph of object trees to compare.\n\n#### `perf` profile of on-CPU processes' stacks during the regression\n\n```shell\nmsmiley@file-45-stor-gprd.c.gitlab-production.internal:~$ sudo perf record --freq 99 -a -g -- sleep 10\n[ perf record: Woken up 1 times to write data ]\n[ perf record: Captured and wrote 5.118 MB perf.data (31680 samples) ]\n\nmsmiley@file-45-stor-gprd.c.gitlab-production.internal:~$ sudo perf script --header \u003e perf-script.during_cpu_saturation_by_many_git_pack_objects_pids.out\n\nmsmiley@saoirse:~/src/git/public/FlameGraph [master|‚úî] $ cat /tmp/perf-script.during_cpu_saturation_by_many_git_pack_objects_pids.out | ./stackcollapse-perf.pl | ./flamegraph.pl \u003e /tmp/file-45.during_git_pack_objects_cpu_saturation.svg\n```\n\nComplete SVG of flame graph: [file-45.during_git_pack_objects_cpu_saturation.svg](/uploads/647be579053e398fe994aa73d94c319b/file-45.during_git_pack_objects_cpu_saturation.svg)\n\n![flame-graph.git-pack-objects-saturating-cpu-on-gitaly-node-file-45](/uploads/9e427542d6431045d5e257b911e0ee83/flame-graph.git-pack-objects-saturating-cpu-on-gitaly-node-file-45.png)\n\n\n## Detection \u0026 Response\n\nStart with the following:\n\n- How was the incident detected? PagerDuty alerts such as [here](https://gitlab.pagerduty.com/incidents/PI1CE5Z) and [here](https://gitlab.pagerduty.com/incidents/PZESZJC): \"Gitaly error rate is too high\"\n- Did alarming work as expected?  Yes.\n- How long did it take from the start of the incident to its detection?  7 minutes.\n- How long did it take from detection to remediation?  The regressions self-resolved roughly 10 minutes after the alert triggered.  Analysis of the regression continued after incidents resolved, and once we discovered enough about the pathology and triggering conditions, we reached out to the owner of the triggering repo.  We temporarily blocked the behavior for that repo to protect other customers from the side-effects, and worked with the customer to understand their use-case and mitigate the impact.\n- Were there any issues with the response to the incident?  No.  We had all the necessary access to people and technology.\n\n## Root Cause Analysis\n\nA Gitaly node saturated its CPUs and significantly changed its memory usage profile.\n\n1. Why? - More CPU-bound memory-hungry processes were spawned than there are CPUs available on the host.\n2. Why? - Gitaly received numerous `PostUploadPack` gRPC calls from clients running `git fetch` (or similar), and Gitaly processed too many of them concurrently.\n3. Why? - Most repos are not prone to this pathology, so it has not yet been a focus of attention for Gitaly tuning.\n4. Why? - To trigger the pathology, the repo being accessed must have a very large object graph to traverse when composing a response to the client's `git fetch` (more specifically the `git` client's HTTP POST to `[repo_path]/git-upload-pack`).  Even for repos that meet this condition, to cause a regression on the Gitaly node, over 30 client requests to this repo must be concurrently running.\n5. Why? - The Gitaly server does not have enough CPU and memory capacity to handle workloads beyond the above specifications.  Once reaching the saturation point, all other Gitaly operations begin to slow down due to CPU starvation, with the degree of effect being proportional to the number of CPU-bound processes running.\n\n## What went well\n\n- Cross-team collaboration was fantastic!\n- IMOC and CMOC did a wonderful job (as usual!) of facilitating the investigation, getting help where needed, doing regular pulse checks, and guiding the balance of what info was ok to release publicly (as we were unsure at first whether this was a precursor to a malicious attack or an accidental outcome of a legitimate use-case).\n- Alerting worked appropriately.\n- Gitaly's and Rails' event logging to Elasticsearch gave us excellent observability into the app behavior and client request profile.\n- The CPU profiling tools (`perf` and BCC) gave us a clearer picture of what the CPU time was being spent on and which of the numerous git repos were associated with the bulk of the activity.\n\n## What can be improved\n\n- To prevent this from happening again, we need to prevent Gitaly from spawning enough `git` processes to saturate machine resources such as CPU and memory.  Gitaly already supports some forms of concurrency limiting, and tuning those may be sufficient.  Additional layers of protection (e.g. cgroups) could also be implemented, although we should consider the effects of saturation in each case and choose the most desirable failure mode for the health of the service as a whole when saturation is reached.  (For example, we prefer: slowness over downtime; downtime over possible corruption; automatic over manual recovery; etc.)\n- Each of the incidents in this 11-day series were low enough severity (`S3`) that we did not take the time to do root cause analysis until we noticed they were part of a recurring pattern.  Our on-call engineers field enough alerts, questions, and interruptions that we rarely have time to analyze self-recovering regressions like this.  This may be worth discussing as an iterative process improvement for incident triage.  Or maybe it's an acceptable cost of our existing prioritization scheme.\n\n## Corrective actions\n\n- Prevent Gitaly from running too many `git pack-objects` processes.\n    - Issue: https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/9554\n    - Estimated date of completion: TBD\n    - Owner: TBD\n- For short-term mitigation, add support for removing user access to CI/CD without having to fully block the user.\n    - Issue: https://gitlab.com/gitlab-org/gitlab/-/issues/35346\n    - Estimated date of completion: TBD\n    - Owner: TBD\n\n## Guidelines\n\n* [Blameless RCA Guideline](https://about.gitlab.com/handbook/engineering/root-cause-analysis/)\n* [5 whys](https://en.wikipedia.org/wiki/5_Whys)","state":"closed","created_at":"2020-03-18T18:06:27.682Z","updated_at":"2022-08-04T13:54:33.852Z","closed_at":"2020-04-09T20:35:14.416Z","closed_by":{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},"labels":["IncidentReview","workflow-infra::Done"],"milestone":null,"assignees":[{"id":3947902,"username":"msmiley","name":"Matt Smiley","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3947902/avatar.png","web_url":"https://gitlab.com/msmiley"}],"author":{"id":3947902,"username":"msmiley","name":"Matt Smiley","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3947902/avatar.png","web_url":"https://gitlab.com/msmiley"},"type":"ISSUE","assignee":{"id":3947902,"username":"msmiley","name":"Matt Smiley","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3947902/avatar.png","web_url":"https://gitlab.com/msmiley"},"user_notes_count":3,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9550","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9550","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9550/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9550/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9550","relative":"#9550","full":"gitlab-com/gl-infra/reliability#9550"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":32131630,"iid":9545,"project_id":1304532,"title":"Execute database benchmarking on Postgresql 11","description":"The goal is to check our load on PostgreSQL 11 and verify that the performance is similar or better. We could find some queries that the performance could change with the new planner, so we would like to reduce these cases.\n\nWe would execute the benchmark with the same concept that we have planned to test our primary database.\n\nThe main steps will be:\n\n- List the queries from pg_stat_statements\n\n- Execute a JMeter from a different host to reproduce the queries against the database, to generate similar traffic as production.","state":"closed","created_at":"2020-03-18T13:01:00.119Z","updated_at":"2022-05-19T15:42:35.207Z","closed_at":"2020-05-10T22:33:38.862Z","closed_by":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"labels":["Database","OnGres::Project","priority::2","workflow-infra::Done"],"milestone":{"id":1239654,"iid":76,"group_id":1112072,"title":"W16 DBRE","description":"","state":"closed","created_at":"2020-04-14T09:14:09.392Z","updated_at":"2020-05-13T19:56:10.734Z","due_date":"2020-05-08","start_date":"2020-04-14","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/76"},"assignees":[{"id":3007633,"username":"gerardo.herzig","name":"Gerardo Herzig","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3007633/avatar.png","web_url":"https://gitlab.com/gerardo.herzig"}],"author":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"type":"ISSUE","assignee":{"id":3007633,"username":"gerardo.herzig","name":"Gerardo Herzig","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3007633/avatar.png","web_url":"https://gitlab.com/gerardo.herzig"},"user_notes_count":46,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":"2020-05-08","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9545","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9545","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9545/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9545/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9545","relative":"#9545","full":"gitlab-com/gl-infra/reliability#9545"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":274,"epic":{"id":78928,"iid":274,"title":"Create a database benchmark environment","url":"/groups/gitlab-com/gl-infra/-/epics/274","group_id":1112072,"human_readable_end_date":"Mar 19, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":32012958,"iid":9510,"project_id":1304532,"title":"Recurring CPU-bound git-fetch processes on file-praefect-02 gitaly node","description":"While looking into intermittent alerts about high Gitaly latency on one of the nodes behind Praefect (e.g. [here](https://gitlab.pagerduty.com/incidents/PJ6FJVO) and [here](https://gitlab.pagerduty.com/incidents/PFACGWK)), I noticed that this host is almost always running 2 or 3 `git fetch` processes.  These `git fetch` processes are always CPU-bound.  Because they tend to run for several minutes, it was easy to find one and do some profiling on it before it exited.  Repeating this a few times on different `git fetch` processes consistently showed the same pattern -- these particular `git fetch` processes spent a lot of time reading directories via the `getdents` syscall.\n\nThese slow CPU-intensive `git fetch` processes may or may not be why the Gitaly latency is high enough to alert -- it's plausible but not proven.\n\nI thought it was worth documenting, mainly because further investigation may lead to tuning the git config of the handful of GitLab-owned repos stored on this host.  These repos (e.g. the repo for gitaly itself) tend to have many refs, which may or may not be related to why `git fetch` is doing so many expensive dentry fetches.\n\n### Observations\n\n#### perf_event profile\n\nThis is one of several examples, each giving consistent results even though the `git fetch` was running in at least 3 different git repos.\n\n```shell\nmsmiley@file-praefect-02-stor-gprd.c.gitlab-production.internal:~$ pgrep -u git -f '/opt/gitlab/embedded/bin/git ' | xargs -r ps uwf\nUSER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\ngit      32544 97.1  0.1 224848 207100 ?       R    21:18   0:51 /opt/gitlab/embedded/bin/git fetch tmp-f0c29603f769ef2a5e19823338fa\n\nmsmiley@file-praefect-02-stor-gprd.c.gitlab-production.internal:~$ sudo perf record --freq 99 -g --pid 32544 -- sleep 120\n[ perf record: Woken up 3 times to write data ]\n[ perf record: Captured and wrote 1.079 MB perf.data (8860 samples) ]\nTerminated\n```\n\nComplete flamegraph in SVG format: [git-fetch.svg](/uploads/7a5463cb953f0f86279eb111e6d4b59a/git-fetch.svg)\n\nScreenshot without the tall thin tower:\n\n![Screenshot_from_2020-03-15_15-03-44](/uploads/789aac5e826cf7061a109039e41b2ab4/Screenshot_from_2020-03-15_15-03-44.png)\n\n\n#### Size of dentry cache at the time\n\nThe kernel's slab cache for dentries is roughly 600 MB as of time writing.\n\n```shell\nmsmiley@file-praefect-02-stor-gprd.c.gitlab-production.internal:~$ date -u ; sudo slabtop --once\nSun Mar 15 21:26:54 UTC 2020\n Active / Total Objects (% used)    : 35725531 / 36164607 (98.8%)\n Active / Total Slabs (% used)      : 880109 / 880109 (100.0%)\n Active / Total Caches (% used)     : 78 / 127 (61.4%)\n Active / Total Size (% used)       : 5496363.91K / 5627374.90K (97.7%)\n Minimum / Average / Maximum Object : 0.01K / 0.16K / 8.00K\n\n  OBJS ACTIVE  USE OBJ SIZE  SLABS OBJ/SLAB CACHE SIZE NAME                   \n24567153 24533027  99%    0.10K 629927       39   2519708K buffer_head            \n3320415 3051784  91%    0.19K  79287       42    634296K dentry                 \n1887918 1886804  99%    0.04K  18509      102     74036K ext4_extent_status     \n1250816 1237169  98%    0.06K  19544       64     78176K kmalloc-64             \n1233603 1179390  95%    1.05K  42948       30   1374336K ext4_inode_cache       \n...\n\nmsmiley@file-praefect-02-stor-gprd.c.gitlab-production.internal:~$ free -m\n              total        used        free      shared  buff/cache   available\nMem:         120867        3323       13714        1160      103829      114721\nSwap:             0           0           0\n```\n\n#### Confirm that `getdents` syscall is both frequent and time-consuming\n\nProfile the top syscalls by count and duration for another example `git fetch` process.\n\n```shell\nmsmiley@file-praefect-02-stor-gprd.c.gitlab-production.internal:~$ pgrep -u git -f '/opt/gitlab/embedded/bin/git ' | xargs -r ps uwf\nUSER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\ngit      11227 68.1  0.0  47364 12140 ?        Sl   21:45   0:06 /opt/gitlab/embedded/bin/git fetch tmp-abdca8edcb52002d5ac34c56dbd7\ngit      11346 99.4  0.0  42608 27176 ?        R    21:46   0:04 /opt/gitlab/embedded/bin/git fetch tmp-da29fee686ab94a6c8a08bf13797\n\nmsmiley@file-praefect-02-stor-gprd.c.gitlab-production.internal:/usr/share/bcc/tools$ sudo ./syscount --pid 11346 --duration 10 --latency\nTracing syscalls, printing top 10... Ctrl+C to quit.\n[21:47:00]\nSYSCALL                   COUNT        TIME (us)\ngetdents                  66594      8425669.975\nopen                      22198        79449.929\nwrite                     11099        79104.089\nlstat                     22204        58918.045\nfstat                     22198        30487.748\nclose                     22198        28841.996\nbrk                           2           16.327\nstat                          1           14.969\n\nDetaching...\n```","state":"closed","created_at":"2020-03-15T22:10:14.218Z","updated_at":"2022-08-04T14:54:20.269Z","closed_at":"2020-05-11T23:30:55.242Z","closed_by":{"id":3947902,"username":"msmiley","name":"Matt Smiley","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3947902/avatar.png","web_url":"https://gitlab.com/msmiley"},"labels":["workflow-infra::Done"],"milestone":null,"assignees":[{"id":3947902,"username":"msmiley","name":"Matt Smiley","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3947902/avatar.png","web_url":"https://gitlab.com/msmiley"}],"author":{"id":3947902,"username":"msmiley","name":"Matt Smiley","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3947902/avatar.png","web_url":"https://gitlab.com/msmiley"},"type":"ISSUE","assignee":{"id":3947902,"username":"msmiley","name":"Matt Smiley","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3947902/avatar.png","web_url":"https://gitlab.com/msmiley"},"user_notes_count":3,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9510","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9510","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9510/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9510/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9510","relative":"#9510","full":"gitlab-com/gl-infra/reliability#9510"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":31980837,"iid":9508,"project_id":1304532,"title":"Certificate expiring on prometheus.GitLab.com","description":"The certificate on `prometheus.GitLab.com` is about to expire:  https://gitlab.pagerduty.com/incidents/P0MVVYH","state":"closed","created_at":"2020-03-14T02:15:01.253Z","updated_at":"2022-08-04T14:54:21.819Z","closed_at":"2020-03-14T05:17:20.690Z","closed_by":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"labels":["SRE:On-call","alert","workflow-infra::Done"],"milestone":null,"assignees":[{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"}],"author":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"type":"ISSUE","assignee":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9508","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9508","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9508/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9508/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9508","relative":"#9508","full":"gitlab-com/gl-infra/reliability#9508"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":31931941,"iid":9498,"project_id":1304532,"title":"Update customers.gitlab.com cheat sheet to prevent outages","description":"Originating incident: https://gitlab.com/gitlab-com/gl-infra/production/-/issues/1763\nIncident review: https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/9488\n\nUpdate the page in the dotcom documentation to reflect running the console as the `gitlab-customers` user and not as root.\n\nThe location that needs updated: https://gitlab.com/gitlab-com/support/dotcom/dotcom-internal/-/wikis/Customers-Console-Rails-Cheat-Sheet\nA source showing the proper commands: https://gitlab.com/gitlab-org/customers-gitlab-com/#accessing-production-as-an-admin-and-logs-and-console","state":"closed","created_at":"2020-03-12T17:44:52.040Z","updated_at":"2022-08-04T14:54:31.165Z","closed_at":"2020-03-12T18:07:11.270Z","closed_by":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"labels":["corrective action","workflow-infra::Done"],"milestone":{"id":1132902,"iid":65,"group_id":1112072,"title":"Reliability - March 2020","description":"","state":"closed","created_at":"2020-01-23T15:43:44.224Z","updated_at":"2020-04-13T03:13:41.645Z","due_date":"2020-03-31","start_date":"2020-03-01","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/65"},"assignees":[{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"}],"author":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"type":"ISSUE","assignee":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"user_notes_count":0,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9498","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9498","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9498/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9498/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9498","relative":"#9498","full":"gitlab-com/gl-infra/reliability#9498"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":31915588,"iid":9489,"project_id":1304532,"title":"change requests to improve checkpoint setup","description":"As mentioned in the issues : \nhttps://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/5189\n\nand \n\nhttps://ops.gitlab.net/gitlab-cookbooks/chef-repo/-/merge_requests/2848\n\nWe would like to reconsider checkpoint-related PostgreSQL settings:\n\n- `max_wal_size`: `5GB` ‚Üí `64GB` for less frequent \"forced\" checkpoints;\n- `checkpoint_timeout`: `5min` ‚Üí `10min` for less frequent \"planned\" checkpoints;\n- `checkpoint_completion_target`: `0.7` ‚Üí `0.9` for smoother checkpointer\nbehavior.\n\nAnd we would need to create the following changes, with 1-2 days of observations between them, on each step performing the change only on staging, and then on production:\n\n1. change `checkpoint_timeout` from `5min` to `10min` and change `checkpoint_completion_target` from `0.7` to `0.9`.\n   1. apply to gstg\n   1. apply to gprd\n1. change `max_wal_size` from `5GB` to `8GB`\n   1. apply to gstg\n   1. apply to gprd\n1. change `max_wal_size` from `8GB` to `16GB`\n   1. apply to gstg\n   1. apply to gprd\n1. change `max_wal_size` from `16GB` to `32GB`\n   1. apply to gstg\n   1. apply to gprd\n1. change `max_wal_size` from `32GB` to `64GB`\n   1. apply to gstg\n   1. apply to gprd\n\nFor the 1st step and staging @NikolayS created: https://ops.gitlab.net/gitlab-cookbooks/chef-repo/-/merge_requests/2871","state":"closed","created_at":"2020-03-12T12:36:14.579Z","updated_at":"2022-08-04T14:54:44.704Z","closed_at":"2020-10-01T15:32:24.158Z","closed_by":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"labels":["DStores-Backlog::DBPerf","Database","priority::2","workflow-infra::Done"],"milestone":{"id":1239654,"iid":76,"group_id":1112072,"title":"W16 DBRE","description":"","state":"closed","created_at":"2020-04-14T09:14:09.392Z","updated_at":"2020-05-13T19:56:10.734Z","due_date":"2020-05-08","start_date":"2020-04-14","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/76"},"assignees":[{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"}],"author":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"type":"ISSUE","assignee":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"user_notes_count":16,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2020-05-15","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9489","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9489","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9489/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9489/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9489","relative":"#9489","full":"gitlab-com/gl-infra/reliability#9489"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":31906779,"iid":9483,"project_id":1304532,"title":"Create ingress for GKE alertmanager","description":"To simplify adding silences, examining alerts without port forwarding.\n\nThis should have restricted access, to whoever is currently allowed to access https://alerts.gprd.gitlab.net (at most). We could likely use the GCP IAP for this.\n\n@bjk-gitlab @mwasilewski-gitlab @AnthonySandoval","state":"closed","created_at":"2020-03-12T08:35:24.913Z","updated_at":"2022-08-04T14:54:47.635Z","closed_at":"2020-06-12T12:51:17.685Z","closed_by":{"id":928230,"username":"bjk-gitlab","name":"Ben Kochie","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/928230/avatar.png","web_url":"https://gitlab.com/bjk-gitlab"},"labels":["Alerting","Observability","Service::Monitoring-Other","blocker","priority::2","workflow-infra::Done"],"milestone":{"id":1249005,"iid":80,"group_id":1112072,"title":"Observability Team - W23 2020","description":"[Sprint Board](https://gitlab.com/groups/gitlab-com/gl-infra/-/boards/1677278)\r\n\r\n## Focus Diagram\r\n\r\n\u003cimg src=\"/uploads/1bab352839c4f6af55ab757f09188ecd/Team_Focus_-_W23.jpeg\" width=\"850\"/\u003e\r\n\r\nWe have limited capacity this week, with only 11 working days due to time-off, holidays, and on-call shifts. Additionally, this is the final week for 360¬∞ feedback in Culture Amp. So, it's exceedingly important this sprint to work from the board! A few issues are carryovers from the May milestone‚Äìand you've already made significant progress on them‚Äìthat should close quickly. There are also some related, blocking issues that will cascade to closed. I'm confident we'll hit over 90% this sprint.\r\n\r\nAs seen above, we have a need to dedicate the majority of our focus to alerting and monitoring fixes and tunings. Columns on the board continue issues labeled ~P1 ~P2 and ~P3, and whenever possible should be worked on in order of priority.\r\n\r\nThe o11y weekly meeting is on Tuesday, 02 Jun. We'll cover this then. See you all there.\r\n\r\n---\r\n\r\n## Calendar\r\n\r\n|             | M 01 Jun | T 02 Jun | W 03 Jun | Th 04 Jun  | F 05 Jun\r\n|-------------|----------|----------|----------|----------- |----------\r\n| @bjk-gitlab | :ferris_wheel: | - | - | - | -\r\n| @cindy | - | - | - | - | -\r\n| @craigf | :palm_tree: | :palm_tree: | :palm_tree: | :palm_tree: | :palm_tree:\r\n| @igorwwwwwwwwwwwwwwwwwwww | :palm_tree: | :palm_tree: | :palm_tree: | :palm_tree: | :palm_tree:\r\n| @msmiley | - | :pager: | :pager: | :pager: | :pager:\r\n| @mwasilewski-gitlab | - | :pager: | :pager: | :pager: | :pager:\r\n\r\nW23 working days: 11\r\n\r\n|             | M 08 Jun | T 09 Jun | W 10 Jun | Th 11 Jun  | F 12 Jun\r\n|-------------|----------|----------|----------|----------- |----------\r\n| @bjk-gitlab | - | - | - | - | :sun_with_face: \r\n| @cindy | :palm_tree: | :palm_tree: | :palm_tree: | :palm_tree: | :sun_with_face:\r\n| @craigf | :x: | :pager: | :pager: | :pager: | :pager:\r\n| @igorwwwwwwwwwwwwwwwwwwww | - | - | - | - | :sun_with_face: \r\n| @msmiley | :pager: | :wrench: | :wrench: | :wrench: | :sun_with_face:\r\n| @mwasilewski-gitlab | :pager: | :wrench: | :wrench: | :ferris_wheel: | :sun_with_face: \r\n\r\nW24 working days: 8\r\n\r\n\u003chr\u003e\r\n\r\n**Total working days: 19**","state":"closed","created_at":"2020-04-20T20:17:57.535Z","updated_at":"2020-06-17T16:19:26.003Z","due_date":"2020-06-12","start_date":"2020-06-01","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/80"},"assignees":[{"id":4337537,"username":"ggillies","name":"Graeme Gillies","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4337537/avatar.png","web_url":"https://gitlab.com/ggillies"}],"author":{"id":3911656,"username":"craigf","name":"Craig Furman","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3911656/avatar.png","web_url":"https://gitlab.com/craigf"},"type":"ISSUE","assignee":{"id":4337537,"username":"ggillies","name":"Graeme Gillies","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4337537/avatar.png","web_url":"https://gitlab.com/ggillies"},"user_notes_count":30,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9483","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9483","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9483/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9483/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9483","relative":"#9483","full":"gitlab-com/gl-infra/reliability#9483"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":234,"epic":{"id":50155,"iid":234,"title":"Migrate alertmanager to kubernetes","url":"/groups/gitlab-com/gl-infra/-/epics/234","group_id":1112072,"human_readable_end_date":"Aug 5, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":"needs_attention"},{"id":31881534,"iid":9474,"project_id":1304532,"title":"Implement elasticsearch operational logging for utility scripts like `storage_rebalance.rb` and `storage_revert.rb`","description":"Implement elasticsearch operational logging for utility scripts like `storage_rebalance.rb` and `storage_revert.rb`.\n\nGot the idea for this one from @cmiskell.\n\n\u003e Just wondering if you're aware of SemanticLogger (https://github.com/rocketjob/semantic_logger)?  Delivery use this by preference, and I did also in https://gitlab.com/gitlab-com/gl-infra/infra-vault/-/tree/master/backup_job when prompted.   It does a lot of handy things, including logging to ElasticSearch if desired.  Not critical, but might be nice.\n\nhttps://gitlab.com/gitlab-com/runbooks/-/merge_requests/1935#note_294926778","state":"closed","created_at":"2020-03-11T17:31:26.925Z","updated_at":"2022-08-04T14:54:53.244Z","closed_at":"2021-06-16T18:26:24.544Z","closed_by":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"labels":["auto updated","workflow-infra::Done"],"milestone":null,"assignees":[{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"}],"author":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"type":"ISSUE","assignee":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"user_notes_count":4,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9474","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9474","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9474/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9474/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9474","relative":"#9474","full":"gitlab-com/gl-infra/reliability#9474"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":31840173,"iid":9459,"project_id":1304532,"title":"Implement actual proper opts parsing for bash scripts","description":"Implement actual proper opts parsing for bash scripts.\n\nAt the very least for the storage management utilities.","state":"closed","created_at":"2020-03-10T16:45:52.342Z","updated_at":"2022-08-04T14:55:03.736Z","closed_at":"2020-07-13T15:24:03.547Z","closed_by":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"labels":["auto updated","workflow-infra::Done"],"milestone":null,"assignees":[{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"}],"author":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"type":"ISSUE","assignee":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"user_notes_count":0,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2020-07-31","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9459","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9459","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9459/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9459/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9459","relative":"#9459","full":"gitlab-com/gl-infra/reliability#9459"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":31838746,"iid":9458,"project_id":1304532,"title":"Re-factor the information runbook utility commands into a bash function, and support an `--include-wiki` cli argument flag","description":"Re-factor the information commands into a bash function, and support an `--include-wiki` cli argument flag.\n\nThis will mean that the `print_info` function will be invoked once for the main `.git` repo directory, and then again for the `.wiki.git` directory when the `--include-wiki` flag is given.\n\nThis is dependent on implementation of proper options parsing, which is tracked by this issue: https://gitlab.com/gitlab-com/runbooks/-/issues/35","state":"closed","created_at":"2020-03-10T16:14:08.742Z","updated_at":"2022-08-04T14:55:04.466Z","closed_at":"2021-06-16T18:25:26.043Z","closed_by":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"labels":["auto updated","workflow-infra::Done"],"milestone":null,"assignees":[{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"}],"author":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"type":"ISSUE","assignee":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9458","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9458","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9458/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9458/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9458","relative":"#9458","full":"gitlab-com/gl-infra/reliability#9458"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":31809361,"iid":9448,"project_id":1304532,"title":"Update Disaster Recovery page in Handbook to reflect current state","description":"While [answering some customer questions](https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/9402), we noticed at least one piece of information is out of data on the [Handbook page describing our DR posture](https://about.gitlab.com/handbook/engineering/infrastructure/library/disaster-recovery/#repository-data).\n\nThis task is to review that document and update it where needed with regard to current state of recoverability.\n\nRendered: https://about.gitlab.com/handbook/engineering/infrastructure/library/disaster-recovery/\n\nSource: https://gitlab.com/gitlab-com/www-gitlab-com/-/blob/master/source/handbook/engineering/infrastructure/library/disaster-recovery/index.html.md","state":"closed","created_at":"2020-03-09T22:00:47.557Z","updated_at":"2022-09-01T00:47:39.353Z","closed_at":"2022-09-01T00:47:39.317Z","closed_by":{"id":10167447,"username":"afappiano","name":"Anthony Fappiano","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/10167447/avatar.png","web_url":"https://gitlab.com/afappiano"},"labels":["Reliability::P3","team::Reliability","workflow-infra::Triage"],"milestone":null,"assignees":[],"author":{"id":3947902,"username":"msmiley","name":"Matt Smiley","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3947902/avatar.png","web_url":"https://gitlab.com/msmiley"},"type":"ISSUE","assignee":null,"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9448","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9448","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9448/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9448/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9448","relative":"#9448","full":"gitlab-com/gl-infra/reliability#9448"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":31804085,"iid":9446,"project_id":1304532,"title":"semantic-release _may_not be working for our terraform modules","description":"The `publish` step in our pipelines upon MR merge may not be working.  Example pipeline of one that simply didn't do anything: https://ops.gitlab.net/gitlab-com/gl-infra/terraform-modules/google/pubsubbeat/-/jobs/972834\n\nI, personally, was able to reproduce this precisely.  Though another member of the team was not.  From @alejandro this appeared to work as expected on this persons workstation:\n\n```\nalejandro@MacBook-Pro-4 ~/terraform-modules/google/pubsubbeat (master) $  GITLAB_URL=\"https://ops.gitlab.net\" GL_TOKEN=\"[REDACTED]\" semantic-release\n[3:33:58 PM] [semantic-release] ‚Ä∫ ‚Ñπ  Running semantic-release version 15.13.2\n[3:33:59 PM] [semantic-release] ‚Ä∫ ‚úî  Loaded plugin \"verifyConditions\" from \"@semantic-release/gitlab\"\n[3:33:59 PM] [semantic-release] ‚Ä∫ ‚úî  Loaded plugin \"analyzeCommits\" from \"@semantic-release/commit-analyzer\"\n[3:33:59 PM] [semantic-release] ‚Ä∫ ‚úî  Loaded plugin \"generateNotes\" from \"@semantic-release/release-notes-generator\"\n[3:33:59 PM] [semantic-release] ‚Ä∫ ‚úî  Loaded plugin \"publish\" from \"@semantic-release/gitlab\"\n[3:33:59 PM] [semantic-release] ‚Ä∫ ‚ö†  This run was not triggered in a known CI environment, running in dry-run mode.\n[3:33:59 PM] [semantic-release] ‚Ä∫ ‚ö†  Run automated release from branch master in dry-run mode\n[3:34:04 PM] [semantic-release] ‚Ä∫ ‚úî  Allowed to push to the Git repository\n[3:34:04 PM] [semantic-release] ‚Ä∫ ‚Ñπ  Start step \"verifyConditions\" of plugin \"@semantic-release/gitlab\"\n[3:34:04 PM] [semantic-release] [@semantic-release/gitlab] ‚Ä∫ ‚Ñπ  Verify GitLab authentication (https://ops.gitlab.net/api/v4)\n[3:34:05 PM] [semantic-release] ‚Ä∫ ‚úî  Completed step \"verifyConditions\" of plugin \"@semantic-release/gitlab\"\n[3:34:08 PM] [semantic-release] ‚Ä∫ ‚Ñπ  Found git tag v5.3.0 associated with version 5.3.0\n[3:34:08 PM] [semantic-release] ‚Ä∫ ‚Ñπ  Found 2 commits since last release\n[3:34:08 PM] [semantic-release] ‚Ä∫ ‚Ñπ  Start step \"analyzeCommits\" of plugin \"@semantic-release/commit-analyzer\"\n[3:34:08 PM] [semantic-release] [@semantic-release/commit-analyzer] ‚Ä∫ ‚Ñπ  Analyzing commit: Merge branch 'jarv/add-gke-sink' into 'master'\nfeat: add default sink for GKE with exclusions for application logs\nSee merge request gitlab-com/gl-infra/terraform-modules/google/pubsubbeat!19\n[3:34:08 PM] [semantic-release] [@semantic-release/commit-analyzer] ‚Ä∫ ‚Ñπ  The commit should not trigger a release\n[3:34:08 PM] [semantic-release] [@semantic-release/commit-analyzer] ‚Ä∫ ‚Ñπ  Analyzing commit: feat: add default sink for GKE with exclusions for application logs\n[3:34:08 PM] [semantic-release] [@semantic-release/commit-analyzer] ‚Ä∫ ‚Ñπ  The release type for the commit is minor\n[3:34:08 PM] [semantic-release] [@semantic-release/commit-analyzer] ‚Ä∫ ‚Ñπ  Analysis of 2 commits complete: minor release\n[3:34:08 PM] [semantic-release] ‚Ä∫ ‚úî  Completed step \"analyzeCommits\" of plugin \"@semantic-release/commit-analyzer\"\n[3:34:08 PM] [semantic-release] ‚Ä∫ ‚Ñπ  The next release version is 5.4.0\n[3:34:08 PM] [semantic-release] ‚Ä∫ ‚Ñπ  Start step \"generateNotes\" of plugin \"@semantic-release/release-notes-generator\"\n[3:34:08 PM] [semantic-release] ‚Ä∫ ‚úî  Completed step \"generateNotes\" of plugin \"@semantic-release/release-notes-generator\"\n[3:34:08 PM] [semantic-release] ‚Ä∫ ‚ö†  Skip v5.4.0 tag creation in dry-run mode\n[3:34:08 PM] [semantic-release] ‚Ä∫ ‚ö†  Skip step \"publish\" of plugin \"@semantic-release/gitlab\" in dry-run mode\n[3:34:08 PM] [semantic-release] ‚Ä∫ ‚úî  Published release 5.4.0\n[3:34:08 PM] [semantic-release] ‚Ä∫ ‚Ñπ  Release note for version 5.4.0:\n# 5.4.0 (https://ops.gitlab.net/gitlab-com/gl-infra/terraform-modules/google/pubsubbeat/compare/v5.3.0...v5.4.0) (2020-03-09)\n```\n\nIn order to unblock the work being performed, @alejandro pushed up this tag.  This should be investigated to ensure other terraform modules are not also impacted.","state":"closed","created_at":"2020-03-09T18:42:09.182Z","updated_at":"2022-08-04T14:55:13.238Z","closed_at":"2020-03-17T18:44:47.636Z","closed_by":{"id":367626,"username":"alejandro","name":"Alejandro Rodr√≠guez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"},"labels":["automation","terraform","workflow-infra::Done"],"milestone":null,"assignees":[{"id":367626,"username":"alejandro","name":"Alejandro Rodr√≠guez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"}],"author":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"type":"ISSUE","assignee":{"id":367626,"username":"alejandro","name":"Alejandro Rodr√≠guez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"},"user_notes_count":5,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9446","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9446","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9446/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9446/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9446","relative":"#9446","full":"gitlab-com/gl-infra/reliability#9446"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":31802130,"iid":9444,"project_id":1304532,"title":"Update/create runbooks for increase/reduce disks for the patroni cluster","description":"After increasing the disks from the patroni cluster we observed a restart from postgresql on the node Patroni-07.\n\nTo increase the security from the platform, we would like to update/create our runbooks to stop the traffic on the node. \n\nI would suggest adding the tag on the node to drain the traffic:\n\n```\nnoloadbalance: true\n```","state":"closed","created_at":"2020-03-09T17:34:04.399Z","updated_at":"2022-08-04T14:55:14.644Z","closed_at":"2020-11-16T08:07:21.629Z","closed_by":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"labels":["Database","auto updated","priority::3","workflow-infra::Done"],"milestone":{"id":1176149,"iid":70,"group_id":1112072,"title":"W10 DBRE","description":"","state":"closed","created_at":"2020-03-02T08:36:37.826Z","updated_at":"2020-03-30T08:30:41.949Z","due_date":"2020-03-13","start_date":"2020-03-02","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/70"},"assignees":[{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"}],"author":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"type":"ISSUE","assignee":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"user_notes_count":6,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9444","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9444","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9444/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9444/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9444","relative":"#9444","full":"gitlab-com/gl-infra/reliability#9444"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":31797992,"iid":9442,"project_id":1304532,"title":"License DB Extraction for Data Warehouse","description":"The command is\n`pg_dump -Fp --no-owner --no-acl license_gitlab_com_production | sed -E 's/(DROP|CREATE|COMMENT ON) EXTENSION/-- \\1 EXTENSION/g' \u003e S{DUMPFILE}`","state":"closed","created_at":"2020-03-09T16:18:43.138Z","updated_at":"2021-06-24T08:08:08.943Z","closed_at":"2020-03-10T15:24:07.421Z","closed_by":{"id":5212782,"username":"m_walker","name":"Michael Walker","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5212782/avatar.png","web_url":"https://gitlab.com/m_walker"},"labels":["Database","priority::3","workflow-infra::Done"],"milestone":{"id":1176149,"iid":70,"group_id":1112072,"title":"W10 DBRE","description":"","state":"closed","created_at":"2020-03-02T08:36:37.826Z","updated_at":"2020-03-30T08:30:41.949Z","due_date":"2020-03-13","start_date":"2020-03-02","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/70"},"assignees":[{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},{"id":3007633,"username":"gerardo.herzig","name":"Gerardo Herzig","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3007633/avatar.png","web_url":"https://gitlab.com/gerardo.herzig"}],"author":{"id":5212782,"username":"m_walker","name":"Michael Walker","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5212782/avatar.png","web_url":"https://gitlab.com/m_walker"},"type":"ISSUE","assignee":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"user_notes_count":4,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2020-03-11","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9442","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9442","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9442/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9442/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9442","relative":"#9442","full":"gitlab-com/gl-infra/reliability#9442"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":31706514,"iid":9432,"project_id":1304532,"title":"Create runbook to resync the delayed replicas","description":"I would like to describe the steps executed to restore the delayed replicas.\n\nI think would be positive to have this documented, and make it possible that more engineers could execute the procedure if needed.","state":"closed","created_at":"2020-03-07T13:25:25.012Z","updated_at":"2022-08-04T14:55:23.648Z","closed_at":"2020-03-12T09:02:02.685Z","closed_by":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"labels":["Database","priority::3","workflow-infra::Done"],"milestone":{"id":1176149,"iid":70,"group_id":1112072,"title":"W10 DBRE","description":"","state":"closed","created_at":"2020-03-02T08:36:37.826Z","updated_at":"2020-03-30T08:30:41.949Z","due_date":"2020-03-13","start_date":"2020-03-02","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/70"},"assignees":[{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"}],"author":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"type":"ISSUE","assignee":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"user_notes_count":14,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2020-03-13","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9432","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9432","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9432/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9432/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9432","relative":"#9432","full":"gitlab-com/gl-infra/reliability#9432"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":31704706,"iid":9429,"project_id":1304532,"title":"resync dr-delayed replica","description":"at the moment we have a replication lag over 1 day.\n\nWe need to be just 8 hours behind the primary cluster.","state":"closed","created_at":"2020-03-07T11:30:36.098Z","updated_at":"2022-08-04T14:55:25.728Z","closed_at":"2020-03-09T09:28:40.742Z","closed_by":{"id":506061,"username":"ahmadsherif","name":"Ahmad Sherif","state":"active","avatar_url":"https://secure.gravatar.com/avatar/bd6d0ec4213b91601956c9f801cbfe9b?s=80\u0026d=identicon","web_url":"https://gitlab.com/ahmadsherif"},"labels":["Database","priority::3","workflow-infra::Done"],"milestone":{"id":1176149,"iid":70,"group_id":1112072,"title":"W10 DBRE","description":"","state":"closed","created_at":"2020-03-02T08:36:37.826Z","updated_at":"2020-03-30T08:30:41.949Z","due_date":"2020-03-13","start_date":"2020-03-02","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/70"},"assignees":[{"id":506061,"username":"ahmadsherif","name":"Ahmad Sherif","state":"active","avatar_url":"https://secure.gravatar.com/avatar/bd6d0ec4213b91601956c9f801cbfe9b?s=80\u0026d=identicon","web_url":"https://gitlab.com/ahmadsherif"}],"author":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"type":"ISSUE","assignee":{"id":506061,"username":"ahmadsherif","name":"Ahmad Sherif","state":"active","avatar_url":"https://secure.gravatar.com/avatar/bd6d0ec4213b91601956c9f801cbfe9b?s=80\u0026d=identicon","web_url":"https://gitlab.com/ahmadsherif"},"user_notes_count":10,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2020-03-11","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9429","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9429","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9429/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9429/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9429","relative":"#9429","full":"gitlab-com/gl-infra/reliability#9429"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":31607481,"iid":9396,"project_id":1304532,"title":"Regular and predictable database latency spikes are leading to web latency slowdowns (or \"the {00,04,08,12,16,20}:05 spike\")","description":"Spun out of https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/9248#note_294148937\n\nWithin ~1 minute of the following times, on a daily basis, we experience a slowdown on our web (and possibly other services)\n\n* `00:05`\n* `04:05`\n* `08:05`\n* `12:05`\n* `16:05`\n* `20:05`\n\n# p99.99 `db` durations over 24 hours\n\n![image](/uploads/0b763fd835f60e788df09e3d3d5cc422/image.png)\n\nhttps://log.gprd.gitlab.net/goto/6f240764af89c33cbaf08ff91d92fe53\n\n# p99.9 web duration over 3 minutes during a spike\n\n![image](/uploads/10bf79d5ea3db922bcf780c320e305fa/image.png)\n\nhttps://log.gprd.gitlab.net/goto/c414837b2116e33e0809ec871bafa946\n\ncc @Finotto","state":"closed","created_at":"2020-03-05T10:16:41.664Z","updated_at":"2022-08-04T15:53:37.093Z","closed_at":"2020-09-21T09:05:46.542Z","closed_by":{"id":5709244,"username":"albertoramos","name":"Alberto Ramos","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5709244/avatar.png","web_url":"https://gitlab.com/albertoramos"},"labels":["DE Infra/Datastores","DStores-Backlog::DBPerf","Database","priority::1","workflow-infra::Done"],"milestone":null,"assignees":[{"id":2493611,"username":"adescoms","name":"Adri√°n Escoms","state":"active","avatar_url":"https://secure.gravatar.com/avatar/d6f86d318669a8b32174b7132607443d?s=80\u0026d=identicon","web_url":"https://gitlab.com/adescoms"},{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"}],"author":{"id":895869,"username":"andrewn","name":"Andrew Newdigate","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/895869/avatar.png","web_url":"https://gitlab.com/andrewn"},"type":"ISSUE","assignee":{"id":2493611,"username":"adescoms","name":"Adri√°n Escoms","state":"active","avatar_url":"https://secure.gravatar.com/avatar/d6f86d318669a8b32174b7132607443d?s=80\u0026d=identicon","web_url":"https://gitlab.com/adescoms"},"user_notes_count":124,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9396","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9396","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9396/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9396/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9396","relative":"#9396","full":"gitlab-com/gl-infra/reliability#9396"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":31599440,"iid":9395,"project_id":1304532,"title":"Add pubsub key SLIs to metrics catalog","description":"","state":"closed","created_at":"2020-03-05T09:01:35.199Z","updated_at":"2022-09-01T00:45:34.576Z","closed_at":"2022-09-01T00:45:31.063Z","closed_by":{"id":10167447,"username":"afappiano","name":"Anthony Fappiano","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/10167447/avatar.png","web_url":"https://gitlab.com/afappiano"},"labels":["Observability","Reliability::P4","team::Reliability"],"milestone":null,"assignees":[],"author":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"type":"ISSUE","assignee":null,"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9395","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":true,"task_status":"","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9395","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9395/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9395/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9395","relative":"#9395","full":"gitlab-com/gl-infra/reliability#9395"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":152,"epic":{"id":17574,"iid":152,"title":"Establish SLOs for Logging Stack","url":"/groups/gitlab-com/gl-infra/-/epics/152","group_id":1112072,"human_readable_end_date":"Jul 17, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":31599382,"iid":9394,"project_id":1304532,"title":"Add stackdriver key SLIs to metrics catalog","description":"","state":"closed","created_at":"2020-03-05T09:00:52.318Z","updated_at":"2022-09-01T00:45:26.438Z","closed_at":"2022-09-01T00:45:24.789Z","closed_by":{"id":10167447,"username":"afappiano","name":"Anthony Fappiano","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/10167447/avatar.png","web_url":"https://gitlab.com/afappiano"},"labels":["Observability","Reliability::P4","team::Reliability"],"milestone":null,"assignees":[],"author":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"type":"ISSUE","assignee":null,"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9394","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":true,"task_status":"","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9394","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9394/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9394/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9394","relative":"#9394","full":"gitlab-com/gl-infra/reliability#9394"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":152,"epic":{"id":17574,"iid":152,"title":"Establish SLOs for Logging Stack","url":"/groups/gitlab-com/gl-infra/-/epics/152","group_id":1112072,"human_readable_end_date":"Jul 17, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":31599310,"iid":9393,"project_id":1304532,"title":"Add fluentd key SLIs to metrics catalog","description":"","state":"closed","created_at":"2020-03-05T08:59:57.928Z","updated_at":"2022-09-01T00:45:19.553Z","closed_at":"2022-09-01T00:45:18.491Z","closed_by":{"id":10167447,"username":"afappiano","name":"Anthony Fappiano","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/10167447/avatar.png","web_url":"https://gitlab.com/afappiano"},"labels":["Observability","Reliability::P4","team::Reliability"],"milestone":null,"assignees":[],"author":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"type":"ISSUE","assignee":null,"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9393","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":true,"task_status":"","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9393","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9393/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9393/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9393","relative":"#9393","full":"gitlab-com/gl-infra/reliability#9393"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":152,"epic":{"id":17574,"iid":152,"title":"Establish SLOs for Logging Stack","url":"/groups/gitlab-com/gl-infra/-/epics/152","group_id":1112072,"human_readable_end_date":"Jul 17, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":31501130,"iid":9375,"project_id":1304532,"title":"Postgresql Migration test on staging","description":"In this issue, I would like to plan and list the steps that we will execute to generate and restore the staging environment.\n\nNowadays we have a cluster with Postgresql 9.6\n\nWe will need to execute the following steps : \n- Install PostgreSQL 11. ( chef )\n- Setup the new instance ( Chef )\n- Stop the traffic on PG 9.6\n- Execute the migration ( the migration plan that will include the scripted steps on ansible ) - take a backup/dump from the database cluster 9.6 *BEFORE THE UPGRADE*\n- Extra tests with QA\n- Stop the traffic on PG 11\n- After finish, the migration tests, remove PG11 and restore the database backup to the instance PG 9.6.\n- restore the traffic to PG 9.6","state":"closed","created_at":"2020-03-03T12:47:21.821Z","updated_at":"2021-06-24T08:08:09.557Z","closed_at":"2020-04-09T07:59:32.836Z","closed_by":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"labels":["Database","workflow-infra::Done"],"milestone":{"id":1176149,"iid":70,"group_id":1112072,"title":"W10 DBRE","description":"","state":"closed","created_at":"2020-03-02T08:36:37.826Z","updated_at":"2020-03-30T08:30:41.949Z","due_date":"2020-03-13","start_date":"2020-03-02","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/70"},"assignees":[{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"}],"author":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"type":"ISSUE","assignee":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"user_notes_count":4,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2020-04-17","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9375","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9375","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9375/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9375/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9375","relative":"#9375","full":"gitlab-com/gl-infra/reliability#9375"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":106,"epic":{"id":14061,"iid":106,"title":"Upgrade Postgresql to version 11.7 on GitLab.com","url":"/groups/gitlab-com/gl-infra/-/epics/106","group_id":1112072,"human_readable_end_date":"Apr 30, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":31500788,"iid":9374,"project_id":1304532,"title":"Create process or feature to stop or control the impact of the background migrations on the database","description":"We have faced some background migrations that generated load on the database cluster. We would like to investigate the possibilities to manage better this situation in the future.\n\nThe idea of this issue is to find out or improve/generate documentation about the background migrations and how to manage them.\n\nWould be a goal to have the following features : \n\n- Be possible to stop the migration.\n- Setup the intervals when the migrations are executed.\n- Change the chunks of data that will be affected. \n- Pause the migration.","state":"closed","created_at":"2020-03-03T12:38:39.025Z","updated_at":"2022-08-04T15:53:50.983Z","closed_at":"2021-09-23T14:13:30.185Z","closed_by":{"id":3910448,"username":"craig-gomes","name":"Craig Gomes","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3910448/avatar.png","web_url":"https://gitlab.com/craig-gomes"},"labels":["Database","auto updated","workflow-infra::Done"],"milestone":{"id":1176149,"iid":70,"group_id":1112072,"title":"W10 DBRE","description":"","state":"closed","created_at":"2020-03-02T08:36:37.826Z","updated_at":"2020-03-30T08:30:41.949Z","due_date":"2020-03-13","start_date":"2020-03-02","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/70"},"assignees":[{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"}],"author":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"type":"ISSUE","assignee":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"user_notes_count":14,"merge_requests_count":0,"upvotes":2,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9374","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":8,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9374","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9374/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9374/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9374","relative":"#9374","full":"gitlab-com/gl-infra/reliability#9374"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":31398755,"iid":9349,"project_id":1304532,"title":"Fix terraform warnings regarding deprecations","description":"We've been updating our target terraform versions in several of our environments at https://ops.gitlab.net/gitlab-com/gitlab-com-infrastructure/ for different reasons, and this has left behind a cumulus of warnings in the output of our terraform `plan`s. Some of them are quite simple to address, like removing quotes around data types in variable deffinitions (e.g. `\"string\"` =\u003e `string`), but others might require refactoring.\n\n- [x] https://ops.gitlab.net/gitlab-com/gl-infra/terraform-modules/google/generic-stor/-/merge_requests/20\n- [x] https://ops.gitlab.net/gitlab-com/gl-infra/terraform-modules/google/generic-stor-redis/-/merge_requests/17\n- [x] https://ops.gitlab.net/gitlab-com/gl-infra/terraform-modules/google/generic-stor-with-group/-/merge_requests/16\n- [x] https://ops.gitlab.net/gitlab-com/gl-infra/terraform-modules/google/generic-sv-sidekiq/-/merge_requests/24\n- [x] https://ops.gitlab.net/gitlab-com/gl-infra/terraform-modules/google/generic-sv-with-group/-/merge_requests/14\n- [x] https://ops.gitlab.net/gitlab-com/gl-infra/terraform-modules/google/gke/-/merge_requests/26\n- [x] https://ops.gitlab.net/gitlab-com/gl-infra/terraform-modules/google/monitoring-with-count/-/merge_requests/20\n- [x] https://ops.gitlab.net/gitlab-com/gl-infra/terraform-modules/google/project/-/merge_requests/28\n- [x] https://ops.gitlab.net/gitlab-com/gl-infra/terraform-modules/google/tcp-lb/-/merge_requests/8\n- [x] https://ops.gitlab.net/gitlab-com/gl-infra/terraform-modules/google/pubsubbeat/-/merge_requests/20\n- [x] https://ops.gitlab.net/gitlab-com/gl-infra/terraform-modules/cloudflare_workers/-/merge_requests/3\n- [x] https://ops.gitlab.net/gitlab-com/gl-infra/terraform-modules/static-objects-cache/-/merge_requests/21\n- [x] https://ops.gitlab.net/gitlab-com/gitlab-com-infrastructure/-/merge_requests/1510","state":"closed","created_at":"2020-02-28T20:28:51.657Z","updated_at":"2022-08-04T15:54:07.050Z","closed_at":"2020-03-18T23:20:39.462Z","closed_by":{"id":367626,"username":"alejandro","name":"Alejandro Rodr√≠guez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"},"labels":["workflow-infra::Done"],"milestone":null,"assignees":[{"id":367626,"username":"alejandro","name":"Alejandro Rodr√≠guez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"}],"author":{"id":367626,"username":"alejandro","name":"Alejandro Rodr√≠guez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"},"type":"ISSUE","assignee":{"id":367626,"username":"alejandro","name":"Alejandro Rodr√≠guez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9349","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":13,"completed_count":13},"weight":3,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9349","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9349/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9349/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9349","relative":"#9349","full":"gitlab-com/gl-infra/reliability#9349"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":31370583,"iid":9344,"project_id":1304532,"title":"evaluate using database labs for the delayed replica","description":"We would like to test the possibility of using database labs in the delayed replica scenario. Actually we have just a scenario of 12 hours delay applying logs\n\nMain advantages:\n\n- We could have snapshots each hour, and make the restore in time easier. I.e. \n- The restore time of the images is fast.","state":"closed","created_at":"2020-02-28T08:07:10.263Z","updated_at":"2022-08-04T15:54:22.226Z","closed_at":"2020-11-17T07:21:15.744Z","closed_by":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"labels":["Database","auto updated","priority::2","workflow-infra::Done"],"milestone":{"id":1159113,"iid":69,"group_id":1112072,"title":"W8 DBRE","description":"","state":"closed","created_at":"2020-02-17T07:46:04.317Z","updated_at":"2020-03-02T08:55:22.683Z","due_date":"2020-02-28","start_date":"2020-02-17","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/69"},"assignees":[{"id":1906296,"username":"NikolayS","name":"Nikolay Samokhvalov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1906296/avatar.png","web_url":"https://gitlab.com/NikolayS"}],"author":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"type":"ISSUE","assignee":{"id":1906296,"username":"NikolayS","name":"Nikolay Samokhvalov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1906296/avatar.png","web_url":"https://gitlab.com/NikolayS"},"user_notes_count":6,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2020-04-24","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9344","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9344","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9344/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9344/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9344","relative":"#9344","full":"gitlab-com/gl-infra/reliability#9344"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":31333694,"iid":9332,"project_id":1304532,"title":"change in the delayed replica from wal-e to wal-g","description":"change the backup tool used on the delayed replica to use wal-g instead of wal-e","state":"closed","created_at":"2020-02-27T10:10:54.242Z","updated_at":"2020-10-22T16:22:53.484Z","closed_at":"2020-05-19T19:57:29.466Z","closed_by":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"labels":["Database","priority::2","workflow-infra::Done"],"milestone":{"id":1242270,"iid":78,"group_id":1112072,"title":"Datastores Team - May 2020","description":"","state":"closed","created_at":"2020-04-15T21:27:12.490Z","updated_at":"2020-07-23T10:49:48.643Z","due_date":"2020-05-29","start_date":"2020-05-04","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/78"},"assignees":[{"id":1906296,"username":"NikolayS","name":"Nikolay Samokhvalov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1906296/avatar.png","web_url":"https://gitlab.com/NikolayS"},{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"}],"author":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"type":"ISSUE","assignee":{"id":1906296,"username":"NikolayS","name":"Nikolay Samokhvalov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1906296/avatar.png","web_url":"https://gitlab.com/NikolayS"},"user_notes_count":17,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2020-04-24","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9332","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9332","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9332/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9332/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9332","relative":"#9332","full":"gitlab-com/gl-infra/reliability#9332"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":31303472,"iid":9330,"project_id":1304532,"title":"Bump ruby version for Chef cookbooks","description":"### Goal\n\nUpdate the pinned ruby version of our Chef cookbooks so that we can reliably run their `rspec` tests locally with `bundle exec rspec`.\n\n### Changes to make\n\nFor each chef cookbook that has a pinned ruby version:\n* Update the `.ruby-version` file to `2.6.3`.\n* Update the `.gitlab-ci.yml` file to refer to `ruby` container image of the same major+minor version as in step 1.\n\nFor reference, the `gitlab-server` cookbook is definitely affected, and the following additional cookbooks may be affected:\n\n```shell\ncookbook-about-gitlab-com/.ruby-version:2.4.4\ncookbook-license-gitlab-com/.ruby-version:2.4.4\ncookbook-omnibus-gitlab/.ruby-version:2.5.3\ngitlab-exporters/.ruby-version:2.5.3\ngitlab-haproxy/.ruby-version:2.3.3\ngitlab_lsyncd/.ruby-version:2.4.4\ngitlab-nessus/.ruby-version:2.4.5\ngitlab-omnibus-prerequisites/.ruby-version:2.3.6\ngitlab-openssh/.ruby-version:2.3.6\ngitlab-prometheus/.ruby-version:2.5.3\ngitlab-server/.ruby-version:2.5.3\ngitlab-uptycs/.ruby-version:2.4.5\n```\n\n### Background\n\nYesterday I discovered that due to a known bug in RubyGems, I could not run `bundler install` on a cookbook (which was a prerequisite to my goal at the time: running the cookbook's rspec tests locally with `bundle exec rspec`).  The bug and its work-arounds are described here:\n\nhttps://bundler.io/blog/2019/05/14/solutions-for-cant-find-gem-bundler-with-executable-bundle.html\n\nThis bug requires your `bundler` ruby gem to *exactly* match the version of bundler that last wrote the Gemfile.lock (indicated by that file's `BUNDLED WITH` line).\n\nIf you are using a version of ruby with the defective RubyGems that does not allow newer versions of bundler, then any bundler command will fail.  12 of our chef cookbooks currently pin the ruby version using a `.ruby-version` file (which is used by rbenv to switch the active ruby version).  Updating the pinned ruby version in `.ruby-version` to be \u003e= `2.6.3` would avoid this bug in RubyGems.  Our chef-repo itself is currently pinned to ruby 2.6.3, so I'd like to propose updating all 12 pinned cookbooks to use that same ruby version.\n\nNote that our cookbooks' CI pipeline `test` stage does not seem to be affected by this bug, presumably because it always runs in a container starting with a pristine ruby environment.\n\nQuestions for the team:\n1. Can anyone think of a reason not to do this?\n2. Apart from running each cookbook's rspec tests and letting the CI pipeline run its integration tests, what other testing would be appropriate?  Some cookbooks lack rspec tests for some recipes.\n\n#### Example of the problem\n\n```shell\n$ cat .ruby-version \n2.5.3\n\n$ rbenv install\n...\n\n$ rbenv version\n2.5.3 (set by /home/msmiley/src/git/gitlab/gitlab-cookbooks/gitlab-server/.ruby-version)\n\n$ gem install bundler\nFetching: bundler-2.1.4.gem (100%)\nSuccessfully installed bundler-2.1.4\nParsing documentation for bundler-2.1.4\nInstalling ri documentation for bundler-2.1.4\nDone installing documentation for bundler after 3 seconds\n1 gem installed\n\n$ bundle install\nTraceback (most recent call last):\n\t2: from /home/msmiley/.rbenv/versions/2.5.3/bin/bundle:23:in `\u003cmain\u003e'\n\t1: from /data/src/git/public/rbenv/versions/2.5.3/lib/ruby/2.5.0/rubygems.rb:308:in `activate_bin_path'\n/data/src/git/public/rbenv/versions/2.5.3/lib/ruby/2.5.0/rubygems.rb:289:in `find_spec_for_exe': can't find gem bundler (\u003e= 0.a) with executable bundle (Gem::GemNotFoundException)\n\n$ grep -A 1 'BUNDLED WITH' Gemfile.lock \nBUNDLED WITH\n   1.17.2\n\n$ gem install bundler -v \"$(grep -A 1 \"BUNDLED WITH\" Gemfile.lock | tail -n 1)\"\n...\n\n$ bundle install\nFetching gem metadata from https://rubygems.org/..........\n...\n```","state":"closed","created_at":"2020-02-26T19:33:34.210Z","updated_at":"2022-08-04T15:54:31.614Z","closed_at":"2020-02-27T12:37:47.149Z","closed_by":{"id":928230,"username":"bjk-gitlab","name":"Ben Kochie","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/928230/avatar.png","web_url":"https://gitlab.com/bjk-gitlab"},"labels":["workflow-infra::Done"],"milestone":null,"assignees":[{"id":3947902,"username":"msmiley","name":"Matt Smiley","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3947902/avatar.png","web_url":"https://gitlab.com/msmiley"}],"author":{"id":3947902,"username":"msmiley","name":"Matt Smiley","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3947902/avatar.png","web_url":"https://gitlab.com/msmiley"},"type":"ISSUE","assignee":{"id":3947902,"username":"msmiley","name":"Matt Smiley","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3947902/avatar.png","web_url":"https://gitlab.com/msmiley"},"user_notes_count":11,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9330","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9330","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9330/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9330/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9330","relative":"#9330","full":"gitlab-com/gl-infra/reliability#9330"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":31292481,"iid":9322,"project_id":1304532,"title":"create database user for sidekiq","description":"create a new database user for sidekiq.\n\nIt's a good practice and would make our life easier to identify the statements and logs in the database from this specific application.\n\n\nWe would like to know how much percent of the statements on the primary database are from sidekiq, and if we could redirect the read-only statements to the secondary nodes.","state":"closed","created_at":"2020-02-26T14:16:16.200Z","updated_at":"2022-08-04T15:54:36.894Z","closed_at":"2020-04-09T10:00:42.999Z","closed_by":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"labels":["Database","priority::3","workflow-infra::Done"],"milestone":{"id":1159113,"iid":69,"group_id":1112072,"title":"W8 DBRE","description":"","state":"closed","created_at":"2020-02-17T07:46:04.317Z","updated_at":"2020-03-02T08:55:22.683Z","due_date":"2020-02-28","start_date":"2020-02-17","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/69"},"assignees":[{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"}],"author":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"type":"ISSUE","assignee":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"user_notes_count":17,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2020-03-27","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9322","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9322","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9322/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9322/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9322","relative":"#9322","full":"gitlab-com/gl-infra/reliability#9322"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":31279527,"iid":9317,"project_id":1304532,"title":"New dedicated `gitlab-qa-mirror-runner` runner manager","description":"As part of https://gitlab.com/gitlab-org/gitlab-qa/issues/261, we'd like to setup a dedicated `gitlab-qa-mirror-runner` runner manager for the https://gitlab.com/gitlab-org/gitlab-qa-mirror project.\n\nThe set up / specifications would be similar to the `omnibus-gitlab-mirror-runner` runner manager.\n\nI originally opened a MR in the chef-repo, but then was pointed to Infrastructure as this would involve more steps than I anticipated: https://ops.gitlab.net/gitlab-cookbooks/chef-repo/-/merge_requests/2490#note_43048\n\nThe runner manager should be under the `GitLab QA Projects` GCP folder and probably in a new dedicated `quality-runners` project?\n\nAny help is appreciated, thanks! :pray_tone2: \n\n/cc @gl-quality/eng-prod","state":"closed","created_at":"2020-02-26T09:20:34.665Z","updated_at":"2021-10-28T07:01:09.604Z","closed_at":"2021-10-28T06:55:19.400Z","closed_by":{"id":128633,"username":"rymai","name":"R√©my Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"},"labels":["team::Reliability","workflow-infra::Done"],"milestone":null,"assignees":[],"author":{"id":128633,"username":"rymai","name":"R√©my Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"},"type":"ISSUE","assignee":null,"user_notes_count":4,"merge_requests_count":0,"upvotes":2,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9317","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9317","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9317/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9317/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9317","relative":"#9317","full":"gitlab-com/gl-infra/reliability#9317"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":"needs_attention"},{"id":31239899,"iid":9308,"project_id":1304532,"title":"Analyze queries from sidekiq","description":"The intention here is to recognize how much % are select statements coming from the read-write pgbouncer pools on the primary database.\n\nHaving these numbers we could suggest a change in the application to use the read-only databases.","state":"closed","created_at":"2020-02-25T10:32:51.190Z","updated_at":"2022-08-04T16:53:52.242Z","closed_at":"2020-03-03T09:23:21.577Z","closed_by":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"labels":["Database","workflow-infra::Done"],"milestone":{"id":1159113,"iid":69,"group_id":1112072,"title":"W8 DBRE","description":"","state":"closed","created_at":"2020-02-17T07:46:04.317Z","updated_at":"2020-03-02T08:55:22.683Z","due_date":"2020-02-28","start_date":"2020-02-17","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/69"},"assignees":[{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"}],"author":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"type":"ISSUE","assignee":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"user_notes_count":3,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2020-03-06","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9308","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9308","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9308/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9308/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9308","relative":"#9308","full":"gitlab-com/gl-infra/reliability#9308"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":31219344,"iid":9302,"project_id":1304532,"title":"502 Bad Gateway error while testing purchase in staging customers portal","description":"Amanda Rueda encounters a `502 Bad Gateway` while trying to complete a simple purchase test in the staging customers portal.\n\nOccurs in all browsers.  Clearing cache has no effect.\n\nSteps to reproduce:\n\nStaging gitlab page: https://customers.stg.gitlab.com/plans\n\nThen select the Bronze plan to purchase.\n\nThen when the nginx returns, the url is: https://customers.stg.gitlab.com/subscriptions/new?plan_id=2c92c0f95a24621b015a259a50307881\u0026transaction=create_subscription (edited) \n\nCustomer ID for testing in the customers portal is `4013`.","state":"closed","created_at":"2020-02-24T22:52:53.686Z","updated_at":"2022-08-04T16:53:55.990Z","closed_at":"2021-02-16T22:18:39.112Z","closed_by":{"id":3623028,"username":"cmiskell","name":"Craig Miskell","state":"active","avatar_url":"https://secure.gravatar.com/avatar/852a93b505b1f4a5549595792035f445?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmiskell"},"labels":["staging","workflow-infra::Done"],"milestone":null,"assignees":[],"author":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"type":"ISSUE","assignee":null,"user_notes_count":0,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2020-02-25","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9302","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9302","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9302/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9302/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9302","relative":"#9302","full":"gitlab-com/gl-infra/reliability#9302"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":31219311,"iid":9301,"project_id":1304532,"title":"Migrate Gitlab's Production Project to `ops.gitlab.net`","description":"To further efforts to dogfood incident management product features‚Äìand to remove our dependency on the installation (GitLab.com) that we're supporting‚Äìwe will export the `production` project from gitlab.com and import it onto ops.gitlab.net.\n\nA prerequisite for moving ops.gitlab.net (ops) will be to assess the production readiness of the installation. While we have no intent of publishing public issues or pages from ops.gitlab.net, the intent is for the ops installation to take over responsibility for more of our operational workflows (e.g. status page).\n\nAdditionally, adjustments will require substantial changes to the handbook instructing the Engineer On-Call to open production incidents on ops. We'll begin a campaign to inform the company of the switch, encouraging engineers and business stakeholders to verify or request access to ops. This will be necessary to view and contribute to ongoing incidents.\n\nLastly, we'll redirect Incident Management Automation workflows (\u0026100) and all other automation to use ops as the API endpoint for interaction with incident issues.\n\nThere will be a number of situations where we lose the convenience of cross referencing issues to other gitlab.com projects. We manage to handle this well enough with projects that primarily require participation from the infrastructure department alone. It could become more problematic when we need to increase visibility on issues that impact other business units.\n\nCc @marin @dawsmith @brentnewton @glopezfernandez","state":"closed","created_at":"2020-02-24T22:50:47.852Z","updated_at":"2022-08-04T16:53:56.677Z","closed_at":"2021-01-18T22:01:41.469Z","closed_by":{"id":2222520,"username":"dawsmith","name":"Dave Smith","state":"active","avatar_url":"https://secure.gravatar.com/avatar/ef341e061f6b86461626e64c5fbcfe52?s=80\u0026d=identicon","web_url":"https://gitlab.com/dawsmith"},"labels":["ManagerAction","priority::2","team::Reliability","workflow-infra::Done"],"milestone":null,"assignees":[],"author":{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},"type":"ISSUE","assignee":null,"user_notes_count":12,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9301","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9301","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9301/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9301/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9301","relative":"#9301","full":"gitlab-com/gl-infra/reliability#9301"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":"needs_attention"},{"id":31217526,"iid":9300,"project_id":1304532,"title":"Simplify and standardize path-based haproxy blocking","description":"Using file-based block lists simplifies the most common forms of ACL additions, making urgent changes safer and quicker to apply than writing new ACLs from scratch.\n\nUseful lists we could standardize include:\n* regexp match on request path\n* regexp match on beginning of request path (implemented today by \"blacklist-uris.lst\")\n* substring match on request path (computationally cheaper but less flexible than the equivalent regexp matcher)\n* CIDR match on client IP (after Cloudflare compatibility transformations)\n* regexp match on request path rate-limited to configurable X requests per second per client IP (after Cloudflare compatibility transformations)","state":"closed","created_at":"2020-02-24T21:33:31.513Z","updated_at":"2022-08-04T16:53:57.237Z","closed_at":"2020-05-12T16:48:44.946Z","closed_by":{"id":2222520,"username":"dawsmith","name":"Dave Smith","state":"active","avatar_url":"https://secure.gravatar.com/avatar/ef341e061f6b86461626e64c5fbcfe52?s=80\u0026d=identicon","web_url":"https://gitlab.com/dawsmith"},"labels":["corrective action","team::Reliability","workflow-infra::Done"],"milestone":null,"assignees":[],"author":{"id":3947902,"username":"msmiley","name":"Matt Smiley","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3947902/avatar.png","web_url":"https://gitlab.com/msmiley"},"type":"ISSUE","assignee":null,"user_notes_count":4,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9300","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9300","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9300/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9300/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9300","relative":"#9300","full":"gitlab-com/gl-infra/reliability#9300"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":"needs_attention"},{"id":31200227,"iid":9292,"project_id":1304532,"title":"Document GCP Escalation Path in Runbooks","description":"This escalation policy needs to be documented in our runbooks and accessible to the Incident Manager.","state":"closed","created_at":"2020-02-24T11:59:59.066Z","updated_at":"2021-01-04T12:00:30.435Z","closed_at":"2021-01-04T12:00:30.210Z","closed_by":{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},"labels":["Infrastructure mStaff","ManagerAction","priority::1","team::Reliability","workflow-infra::Done"],"milestone":null,"assignees":[{"id":2222520,"username":"dawsmith","name":"Dave Smith","state":"active","avatar_url":"https://secure.gravatar.com/avatar/ef341e061f6b86461626e64c5fbcfe52?s=80\u0026d=identicon","web_url":"https://gitlab.com/dawsmith"}],"author":{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},"type":"ISSUE","assignee":{"id":2222520,"username":"dawsmith","name":"Dave Smith","state":"active","avatar_url":"https://secure.gravatar.com/avatar/ef341e061f6b86461626e64c5fbcfe52?s=80\u0026d=identicon","web_url":"https://gitlab.com/dawsmith"},"user_notes_count":4,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2020-02-28","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9292","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9292","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9292/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9292/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9292","relative":"#9292","full":"gitlab-com/gl-infra/reliability#9292"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":"at_risk"},{"id":31192506,"iid":9290,"project_id":1304532,"title":"add extra box for the testing of pg upgrade","description":"we need to add an extra server to test the replication upgrade.\n\nThe box should have the same configuration as the primary box that we are using for the upgrade from PostgreSQL.\n\nI should have the same cookbooks,recipes to install the same version of postgresql as the primary.","state":"closed","created_at":"2020-02-24T08:59:07.290Z","updated_at":"2021-06-24T08:08:10.171Z","closed_at":"2020-02-27T13:39:08.909Z","closed_by":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"labels":["Database","workflow-infra::Done"],"milestone":{"id":1159113,"iid":69,"group_id":1112072,"title":"W8 DBRE","description":"","state":"closed","created_at":"2020-02-17T07:46:04.317Z","updated_at":"2020-03-02T08:55:22.683Z","due_date":"2020-02-28","start_date":"2020-02-17","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/69"},"assignees":[{"id":2493611,"username":"adescoms","name":"Adri√°n Escoms","state":"active","avatar_url":"https://secure.gravatar.com/avatar/d6f86d318669a8b32174b7132607443d?s=80\u0026d=identicon","web_url":"https://gitlab.com/adescoms"},{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"}],"author":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"type":"ISSUE","assignee":{"id":2493611,"username":"adescoms","name":"Adri√°n Escoms","state":"active","avatar_url":"https://secure.gravatar.com/avatar/d6f86d318669a8b32174b7132607443d?s=80\u0026d=identicon","web_url":"https://gitlab.com/adescoms"},"user_notes_count":5,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9290","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9290","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9290/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9290/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9290","relative":"#9290","full":"gitlab-com/gl-infra/reliability#9290"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":106,"epic":{"id":14061,"iid":106,"title":"Upgrade Postgresql to version 11.7 on GitLab.com","url":"/groups/gitlab-com/gl-infra/-/epics/106","group_id":1112072,"human_readable_end_date":"Apr 30, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":31141840,"iid":9282,"project_id":1304532,"title":"Verify SRE access to Azure","description":"The following SREs need to verify their access to Azure portal:\n\n- [x] aamarsanaa@gitlab.com @aamarsanaa \n- [x] ahmad@gitlab.com @ahmadsherif \n- [x] cbarrett@gitlab.com @craig \n- [x] cfurman@gitlab.com @craigf \n- [x] cmiskell@gitlab.com @cmiskell \n- [x] dsylva@gitlab.com @devin \n- [x] hmeyer@gitlab.com @T4cC0re \n- [x] hphilipps@gitlab.com @hphilipps \n- [x] msmiley@gitlab.com @msmiley \n- [x] nnelson@gitlab.com @nnelson \n\nPlease reachout to me if you do not have access to the portal.\n\nCc @dawsmith","state":"closed","created_at":"2020-02-21T22:13:50.488Z","updated_at":"2020-06-08T16:57:20.868Z","closed_at":"2020-06-08T16:57:20.845Z","closed_by":{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},"labels":["priority::3","team::Reliability","workflow-infra::Done"],"milestone":null,"assignees":[{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"}],"author":{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},"type":"ISSUE","assignee":{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},"user_notes_count":13,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2020-02-29","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9282","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":10,"completed_count":10},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9282","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9282/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9282/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9282","relative":"#9282","full":"gitlab-com/gl-infra/reliability#9282"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":"at_risk"},{"id":31137645,"iid":9281,"project_id":1304532,"title":"Configure Thanos to scrape Airflow","description":"The data team has a prometheus metrics endpoint ready to be scraped at https://airflow.gitlabdata.com/admin/metrics/\nThanos needs to be configured to scrape this endpoint and store the metrics it gathers so the data team can start doing monitoring and alerting.","state":"closed","created_at":"2020-02-21T18:25:31.038Z","updated_at":"2020-04-27T17:15:18.996Z","closed_at":"2020-04-22T18:50:09.383Z","closed_by":{"id":928230,"username":"bjk-gitlab","name":"Ben Kochie","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/928230/avatar.png","web_url":"https://gitlab.com/bjk-gitlab"},"labels":["Data Team","infra::done","priority::2","workflow-infra::Done"],"milestone":{"id":1237326,"iid":74,"group_id":1112072,"title":"Observability Team - April 2020","description":"This is a first attempt at planning with the new team structure. Without a planning process, I'm targeting the end of the month. Our best mechanism for organizing a single pane of glass using GitLab boards is using two boards: one for in the active milestone and another for everything without a milestone.","state":"closed","created_at":"2020-04-13T02:47:34.907Z","updated_at":"2020-05-13T19:49:03.277Z","due_date":"2020-04-30","start_date":"2020-04-13","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/74"},"assignees":[{"id":928230,"username":"bjk-gitlab","name":"Ben Kochie","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/928230/avatar.png","web_url":"https://gitlab.com/bjk-gitlab"}],"author":{"id":5212782,"username":"m_walker","name":"Michael Walker","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5212782/avatar.png","web_url":"https://gitlab.com/m_walker"},"type":"ISSUE","assignee":{"id":928230,"username":"bjk-gitlab","name":"Ben Kochie","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/928230/avatar.png","web_url":"https://gitlab.com/bjk-gitlab"},"user_notes_count":6,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9281","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9281","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9281/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9281/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9281","relative":"#9281","full":"gitlab-com/gl-infra/reliability#9281"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":"needs_attention"},{"id":31134970,"iid":9279,"project_id":1304532,"title":"create config setup in chef of the new PostgreSQL 11.6 cluster","description":"We need to be able to install the package, create the folder structure, and configuration files  of postgresql 11.6 on the hosts with chef. as we currently do for postgresql 9.6.\n\nAlso, we need adapt monitoring, backups and the patroni setup.\nAt the moment we have a recipe to make the package available.\n\nWe need to add to our chef to :\n\n- install the package of PG 11.6 \n- create the setup for the cluster ( folder structure )\n- render the config file from chef ( the config from the chef to the proper patroni files )\n- change some monitoring functions from for Postgresql 11.6 ( there are some changes in the name of some functions )\n- Point the backups to the data folder from the Postgresql version 11.6\n- change the patroni setup to work with the data folder from pg 11.6","state":"closed","created_at":"2020-02-21T16:40:07.758Z","updated_at":"2022-08-04T16:54:20.526Z","closed_at":"2020-04-02T15:54:31.717Z","closed_by":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"labels":["Database","workflow-infra::Done"],"milestone":{"id":1176149,"iid":70,"group_id":1112072,"title":"W10 DBRE","description":"","state":"closed","created_at":"2020-03-02T08:36:37.826Z","updated_at":"2020-03-30T08:30:41.949Z","due_date":"2020-03-13","start_date":"2020-03-02","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/70"},"assignees":[{"id":506061,"username":"ahmadsherif","name":"Ahmad Sherif","state":"active","avatar_url":"https://secure.gravatar.com/avatar/bd6d0ec4213b91601956c9f801cbfe9b?s=80\u0026d=identicon","web_url":"https://gitlab.com/ahmadsherif"},{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"}],"author":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"type":"ISSUE","assignee":{"id":506061,"username":"ahmadsherif","name":"Ahmad Sherif","state":"active","avatar_url":"https://secure.gravatar.com/avatar/bd6d0ec4213b91601956c9f801cbfe9b?s=80\u0026d=identicon","web_url":"https://gitlab.com/ahmadsherif"},"user_notes_count":23,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9279","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":8,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9279","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9279/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9279/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9279","relative":"#9279","full":"gitlab-com/gl-infra/reliability#9279"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":106,"epic":{"id":14061,"iid":106,"title":"Upgrade Postgresql to version 11.7 on GitLab.com","url":"/groups/gitlab-com/gl-infra/-/epics/106","group_id":1112072,"human_readable_end_date":"Apr 30, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":31134677,"iid":9278,"project_id":1304532,"title":"create chef recipe/cookbook to install extensions on postgresql 11.6","description":"We need to make available pg_repack for the new pg cluster \n\nwe need to install the extensions  pg_Repack and pg_Stat_Statements.\n\nWe should add this config on the new cluster to start with if not would require a new restart in the future.\n\n\nIt should be added on the cookbook/recipes for pg 11.6.","state":"closed","created_at":"2020-02-21T16:29:51.480Z","updated_at":"2022-08-04T16:54:21.511Z","closed_at":"2020-03-24T10:29:22.917Z","closed_by":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"labels":["Database","workflow-infra::Done"],"milestone":{"id":1176149,"iid":70,"group_id":1112072,"title":"W10 DBRE","description":"","state":"closed","created_at":"2020-03-02T08:36:37.826Z","updated_at":"2020-03-30T08:30:41.949Z","due_date":"2020-03-13","start_date":"2020-03-02","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/70"},"assignees":[{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"}],"author":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"type":"ISSUE","assignee":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"user_notes_count":8,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2020-04-02","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9278","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9278","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9278/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9278/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9278","relative":"#9278","full":"gitlab-com/gl-infra/reliability#9278"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":106,"epic":{"id":14061,"iid":106,"title":"Upgrade Postgresql to version 11.7 on GitLab.com","url":"/groups/gitlab-com/gl-infra/-/epics/106","group_id":1112072,"human_readable_end_date":"Apr 30, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":31134470,"iid":9277,"project_id":1304532,"title":"create script for PostgreSQL upgrade","description":"we need to script all the steps the database migration ( could be in ansible): \n - consider that all the steps will be executed one-by-one and we can cancel the total execution in case of any failure\n - would execute them from a bastion in a shared session as screen\n - the steps will be : \n\n\n** Pre checks : **\n- Verify files ownership\n- Check Version before the upgrade\t\n- Verify check of pg_upgrade\n- Delete and verify the monitoring functions are deleted.\n- Verify the collation between versions.\n\n** Upgrade steps : ( migration script) **\n- stop all the connections and verify that\n- stop the 9.6 cluster\n- Take a snapshot from the database.\n- Execute pg_upgrade ( all nodes )\n- Apply pg configuration changes ( parallel query parameters ( parallel )  and others‚Ä¶ autovacuum maybe ) ( all the nodes ) ( MR to executed separated )\n- Start cluster \n- Vacuumdb analyze ( primary )\n- Vacummdb freeze ( primary)  - it will run for longer ‚Ä¶ we will start with QA tests and enabling traffic.\nChanges on PG_exporter ( all nodes )  \n\n\n\n** Post checks : ( migration script) **\n- Check version after upgrade\n- Create views and functions taht we need for monitoring and verify they are created properly\n- Change some functions for monitoring in exporter","state":"closed","created_at":"2020-02-21T16:24:07.238Z","updated_at":"2021-06-24T08:08:10.711Z","closed_at":"2020-05-04T14:00:58.534Z","closed_by":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"labels":["Database","priority::1","workflow-infra::Done"],"milestone":{"id":1239654,"iid":76,"group_id":1112072,"title":"W16 DBRE","description":"","state":"closed","created_at":"2020-04-14T09:14:09.392Z","updated_at":"2020-05-13T19:56:10.734Z","due_date":"2020-05-08","start_date":"2020-04-14","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/76"},"assignees":[{"id":3715468,"username":"sergio.ostapowicz","name":"Sergio Alejandro Ostapowicz","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3715468/avatar.png","web_url":"https://gitlab.com/sergio.ostapowicz"},{"id":4690884,"username":"asotolongo","name":"Anthony Sotolongo","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4690884/avatar.png","web_url":"https://gitlab.com/asotolongo"}],"author":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"type":"ISSUE","assignee":{"id":3715468,"username":"sergio.ostapowicz","name":"Sergio Alejandro Ostapowicz","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3715468/avatar.png","web_url":"https://gitlab.com/sergio.ostapowicz"},"user_notes_count":104,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2020-04-24","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9277","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9277","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9277/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9277/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9277","relative":"#9277","full":"gitlab-com/gl-infra/reliability#9277"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":106,"epic":{"id":14061,"iid":106,"title":"Upgrade Postgresql to version 11.7 on GitLab.com","url":"/groups/gitlab-com/gl-infra/-/epics/106","group_id":1112072,"human_readable_end_date":"Apr 30, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":31113051,"iid":9273,"project_id":1304532,"title":"Add elasticsearch key SLIs to metrics catalog","description":"We should add key SLIs for the elasticsearch logging cluster to the metrics catalog in order to define SLO alerts and dashboards based on them.","state":"closed","created_at":"2020-02-21T09:59:23.003Z","updated_at":"2020-03-09T20:30:38.466Z","closed_at":"2020-03-09T16:28:10.642Z","closed_by":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"labels":["Observability-reliability","Service::Logging","team::Reliability","workflow-infra::Done"],"milestone":{"id":1132902,"iid":65,"group_id":1112072,"title":"Reliability - March 2020","description":"","state":"closed","created_at":"2020-01-23T15:43:44.224Z","updated_at":"2020-04-13T03:13:41.645Z","due_date":"2020-03-31","start_date":"2020-03-01","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/65"},"assignees":[{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"}],"author":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"type":"ISSUE","assignee":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"user_notes_count":5,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9273","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9273","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9273/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9273/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9273","relative":"#9273","full":"gitlab-com/gl-infra/reliability#9273"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":157,"epic":{"id":18244,"iid":157,"title":"SLO Alerts for Elastic Search","url":"/groups/gitlab-com/gl-infra/-/epics/157","group_id":1112072,"human_readable_end_date":"Aug 7, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":31078638,"iid":9265,"project_id":1304532,"title":"Rollout node_exporter 1.0","description":"The Prometheus node_exporter is now 1.0.\n\n* [x]  Rollout release candidate to subset of nodes for testing.\n* [x]  Rollout final release\n\nRelease candidate: https://github.com/prometheus/node_exporter/releases/tag/v1.0.0-rc.0","state":"closed","created_at":"2020-02-20T13:58:40.606Z","updated_at":"2020-05-30T19:08:34.621Z","closed_at":"2020-05-27T15:04:15.698Z","closed_by":{"id":928230,"username":"bjk-gitlab","name":"Ben Kochie","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/928230/avatar.png","web_url":"https://gitlab.com/bjk-gitlab"},"labels":["Observability","workflow-infra::Done"],"milestone":{"id":1242271,"iid":79,"group_id":1112072,"title":"Observability Team - May 2020","description":"Here are the things we'd like to accomplish this sprint!\r\n\r\n[Board](https://gitlab.com/groups/gitlab-com/gl-infra/-/boards/1677278?milestone_title=Observability%20Team%20-%20May%202020\u0026)\r\n\r\n### Kubernetes Deployments\r\n\r\n- Sentry: https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/9118\r\n- Grafana: https://gitlab.com/groups/gitlab-com/gl-infra/-/epics/146\r\n- Grafana Image Renderer: https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/9991","state":"closed","created_at":"2020-04-15T21:27:15.933Z","updated_at":"2020-05-31T19:18:46.407Z","due_date":"2020-05-29","start_date":"2020-05-04","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/79"},"assignees":[{"id":928230,"username":"bjk-gitlab","name":"Ben Kochie","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/928230/avatar.png","web_url":"https://gitlab.com/bjk-gitlab"}],"author":{"id":928230,"username":"bjk-gitlab","name":"Ben Kochie","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/928230/avatar.png","web_url":"https://gitlab.com/bjk-gitlab"},"type":"ISSUE","assignee":{"id":928230,"username":"bjk-gitlab","name":"Ben Kochie","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/928230/avatar.png","web_url":"https://gitlab.com/bjk-gitlab"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9265","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":2,"completed_count":2},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9265","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9265/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9265/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9265","relative":"#9265","full":"gitlab-com/gl-infra/reliability#9265"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":31031271,"iid":9247,"project_id":1304532,"title":"DNS and certificate update for Bouncer","description":"I'm currently in the process of moving [Bouncer](https://gitlab.com/gitlab-com/security-tools/janitor-rails), an internal antispam tool, over to GCP so that everyone who isn't me can actually access it:\n\n* I'd like to point the DNS entry for `bouncer.sec.gitlab.net` to 35.224.46.119 (the IP address of the GCP machine I've provisioned for this)\n\n* And I'd need an updated HTTPS certificate due to this move (and also, in a rare instance of serendipitous timing, the old cert just expired)\n\nThanks, and let me know if there's anything else needed on my end!","state":"closed","created_at":"2020-02-19T15:17:17.765Z","updated_at":"2022-08-04T16:54:40.419Z","closed_at":"2021-01-10T19:47:47.201Z","closed_by":{"id":3623028,"username":"cmiskell","name":"Craig Miskell","state":"active","avatar_url":"https://secure.gravatar.com/avatar/852a93b505b1f4a5549595792035f445?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmiskell"},"labels":["workflow-infra::Done"],"milestone":null,"assignees":[],"author":{"id":2107633,"username":"rostrander","name":"Roger Ostrander","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2107633/avatar.png","web_url":"https://gitlab.com/rostrander"},"type":"ISSUE","assignee":null,"user_notes_count":5,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9247","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9247","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9247/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9247/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9247","relative":"#9247","full":"gitlab-com/gl-infra/reliability#9247"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":30994839,"iid":9234,"project_id":1304532,"title":"2020-02-18: Canary web saturated during deploy","description":"\u003c!--\n**Please note:** if the incident relates to sensitive data, or is security related consider\nlabeling this issue with ~security and mark it confidential.\n*** \n--\u003e\n\nIncident: https://gitlab.com/gitlab-com/gl-infra/production/issues/1679\n\n## Summary\n\nDuring a deploy to canary, sluggish behavior was reported in slack. Metrics show a very high spike in latency and saturation of the canary web fleet. Once the deploy had finished, everything recovered.\n\n- Service(s) affected : Web Canary\n- Team attribution : \n- Minutes downtime or degradation : ~40 minutes\n\nFor calculating duration of event, use the [Platform Metrics Dashboard](https://dashboards.gitlab.net/d/ZUei7TkWz/platform-metrics?orgId=1) to look at appdex and SLO violations.\n\n## Impact \u0026 Metrics\n\nStart with the following:\n\n- What was the impact of the incident? (i.e. service outage, sub-service brown-out, exposure of sensitive data, ...)\n- Who was impacted by this incident? (i.e. external customers, internal customers, specific teams, ...)\n- How did the incident impact customers? (i.e. preventing them from doing X, incorrect display of Y, ...)\n- How many attempts were made to access the impacted service/feature?\n- How many customers were affected?\n- How many customers tried to access the impacted service/feature?\n\nInclude any additional metrics that are of relevance.\n\n* [Web Overview Dashboard of Canary at the time](https://dashboards.gitlab.net/d/web-main/web-overview?orgId=1\u0026from=1582055400000\u0026to=1582059600000\u0026var-PROMETHEUS_DS=Global\u0026var-environment=gprd\u0026var-stage=cny\u0026var-sigma=2)\n\n* [Rails controller metrics](https://dashboards.gitlab.net/d/rPsQXrImk/rails-controller?orgId=1\u0026from=1582055400000\u0026to=1582059600000\u0026var-env=gprd\u0026var-type=web\u0026var-stage=cny\u0026var-controller=Projects::IssuesController\u0026var-action=discussions.json)\n\n* Saturation\n![Screen_Shot_2020-02-18_at_4.28.49_PM](/uploads/b0aac9d69e036813a51cca2e7e1af100/Screen_Shot_2020-02-18_at_4.28.49_PM.png)\nhttps://dashboards.gitlab.net/d/web-main/web-overview?orgId=1\u0026from=1582055400000\u0026to=1582059600000\u0026var-PROMETHEUS_DS=Global\u0026var-environment=gprd\u0026var-stage=cny\u0026var-sigma=2\u0026fullscreen\u0026panelId=6\n\n* Requests per Second\n![Screen_Shot_2020-02-18_at_4.31.43_PM](/uploads/ad8399278b9cf45f2c8c680833e5ff5d/Screen_Shot_2020-02-18_at_4.31.43_PM.png)\nhttps://dashboards.gitlab.net/d/web-main/web-overview?orgId=1\u0026from=1582055400000\u0026to=1582059600000\u0026var-PROMETHEUS_DS=Global\u0026var-environment=gprd\u0026var-stage=cny\u0026var-sigma=2\u0026fullscreen\u0026panelId=5\n\n## Detection \u0026 Response\n\nStart with the following:\n\n- How was the incident detected?\n- Did alarming work as expected?\n- How long did it take from the start of the incident to its detection?\n- How long did it take from detection to remediation?\n- Were there any issues with the response to the incident? (i.e. bastion host used to access the service was not available, relevant team memeber wasn't page-able, ...)\n\n## Root Cause Analysis\n\nThe purpose of this document is to understand the reasons that caused an incident, and to create mechanisms to prevent it from recurring in the future. A root cause can **never be a person**, the way of writing has to refer to the system and the context rather than the specific actors.\n\nFollow the \"**5 whys**\" in a **blameless** manner as the core of the root-cause analysis.\n\nFor this it is necessary to start with the incident, and question why it happened. Keep iterating asking \"why?\" 5 times. While it's not a hard rule that it has to be 5 times, it helps to keep questions get deeper in finding the actual root cause. \n\nKeep in min that from one \"why?\" there may come more than one answer, consider following the different branches.\n\n### Example of the usage of \"5 whys\"\nThe vehicle will not start. (the problem)\n\n1. Why? - The battery is dead. \n2. Why? - The alternator is not functioning.\n3. Why? - The alternator belt has broken.\n4. Why? - The alternator belt was well beyond its useful service life and not replaced. \n5. Why? - The vehicle was not maintained according to the recommended service schedule. (Fifth why, a root cause)\n\n## What went well\n\nStart with the following:\n\n- Identify the things that worked well or as expected.\n- Any additional call-outs for what went particularly well.\n\n## What can be improved\n\nStart with the following:\n\n- Using the root cause analysis, explain what can be improved to prevent this from happening again.\n- Is there anything that could have been done to improve the detection or time to detection?\n- Is there anything that could have been done to improve the response or time to response?\n- Is there an existing issue that would have either prevented this incident or reduced the impact?\n- Did we have any indication or beforehand knowledge that this incident might take place?\n\n## Corrective actions\n\n- List issues that have been created as corrective actions from this incident.\n- For each issue, include the following:\n    - \u003cBare Issue link\u003e - Issue labeled as ~\"corrective action\".\n    - Include an estimated date of completion of the corrective action.\n    - Incldue the named individual who owns the delivery of the corrective action.\n\n## Guidelines\n\n* [Blameless RCA Guideline](https://about.gitlab.com/handbook/engineering/root-cause-analysis/)\n* [5 whys](https://en.wikipedia.org/wiki/5_Whys)","state":"closed","created_at":"2020-02-18T21:09:11.461Z","updated_at":"2022-08-04T16:54:47.298Z","closed_at":"2020-03-24T15:42:39.193Z","closed_by":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"labels":["IncidentReview","Service::Web","severity::3","workflow-infra::Done"],"milestone":null,"assignees":[{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"}],"author":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"type":"ISSUE","assignee":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"user_notes_count":16,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9234","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9234","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9234/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9234/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9234","relative":"#9234","full":"gitlab-com/gl-infra/reliability#9234"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":30945722,"iid":9225,"project_id":1304532,"title":"Design database infrastructure for Praefect","description":"In order for Praefect to support replication coordination and failover it will rely on a PostgreSQL database. We must define a cost-effective and performant infrastructure to support this, with replication in mind.\n\nMore info on Praefect's data model: https://gitlab.com/gitlab-org/gitaly/issues/1495\n\n- [x] https://ops.gitlab.net/gitlab-com/gitlab-com-infrastructure/-/merge_requests/1468\n- [x] https://ops.gitlab.net/gitlab-cookbooks/chef-repo/-/merge_requests/2816\n- [ ] Opt-in to CloudSQL maintenance notifications (to be addressed on https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/9462)\n- [x] Configure preferred maintenance window day of the week and time https://ops.gitlab.net/gitlab-com/gitlab-com-infrastructure/-/merge_requests/1480\n\n/cc @gitlab-com/gl-infra for thoughts","state":"closed","created_at":"2020-02-17T21:28:53.097Z","updated_at":"2022-08-04T17:53:05.749Z","closed_at":"2020-03-10T19:52:59.505Z","closed_by":{"id":367626,"username":"alejandro","name":"Alejandro Rodr√≠guez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"},"labels":["workflow-infra::Done"],"milestone":null,"assignees":[{"id":367626,"username":"alejandro","name":"Alejandro Rodr√≠guez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"}],"author":{"id":367626,"username":"alejandro","name":"Alejandro Rodr√≠guez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"},"type":"ISSUE","assignee":{"id":367626,"username":"alejandro","name":"Alejandro Rodr√≠guez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"},"user_notes_count":47,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9225","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":4,"completed_count":3},"weight":6,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9225","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9225/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9225/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9225","relative":"#9225","full":"gitlab-com/gl-infra/reliability#9225"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":199,"epic":{"id":14582,"iid":199,"title":"HA Gitaly on GitLab.com","url":"/groups/gitlab-com/-/epics/199","group_id":6543,"human_readable_end_date":"Jan 31, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":30917235,"iid":9221,"project_id":1304532,"title":"create change requests to reduce the number of read only replicas","description":"As discussed in the issue https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/8592\n\nThe goal is to reduce 2 replicas from the production cluster.\n\nWe would like to have 6 nodes read-only receiving traffic and 2 nodes in standby without traffic.\n\n\nPlease create the change requests and proceed.","state":"closed","created_at":"2020-02-17T11:03:33.647Z","updated_at":"2022-08-04T17:53:08.201Z","closed_at":"2020-04-09T07:55:40.030Z","closed_by":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"labels":["Database","priority::2","workflow-infra::Done"],"milestone":{"id":1216307,"iid":73,"group_id":1112072,"title":"W14 DBRE","description":"","state":"closed","created_at":"2020-03-30T08:31:20.801Z","updated_at":"2020-04-28T08:58:15.566Z","due_date":"2020-04-10","start_date":"2020-03-30","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/73"},"assignees":[{"id":2493611,"username":"adescoms","name":"Adri√°n Escoms","state":"active","avatar_url":"https://secure.gravatar.com/avatar/d6f86d318669a8b32174b7132607443d?s=80\u0026d=identicon","web_url":"https://gitlab.com/adescoms"}],"author":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"type":"ISSUE","assignee":{"id":2493611,"username":"adescoms","name":"Adri√°n Escoms","state":"active","avatar_url":"https://secure.gravatar.com/avatar/d6f86d318669a8b32174b7132607443d?s=80\u0026d=identicon","web_url":"https://gitlab.com/adescoms"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2020-05-29","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9221","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9221","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9221/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9221/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9221","relative":"#9221","full":"gitlab-com/gl-infra/reliability#9221"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":30731697,"iid":9207,"project_id":1304532,"title":"Clarify durations in deployer annotation text","description":"Clarify durations in annotation text.\n\nOld text printed the 2 durations adjacent to each other, resulting in\nconfusing phrasing such as \"an hour and 16 hours\":\n\n\u003e deployer finished a deployer pipeline of ... on gprd which took\n\u003e an hour and 16 hours (wall time)\n\nThis change aims to separate and more clearly define the two durations:\n\n\u003e deployer finished a deployer pipeline of ... on gprd which had \n\u003e end-to-end wall clock duration of an hour (and sum of pipeline\n\u003e stage durations was 16 hours)","state":"closed","created_at":"2020-02-13T20:16:54.394Z","updated_at":"2022-08-04T17:53:17.006Z","closed_at":"2020-02-14T17:24:46.776Z","closed_by":{"id":3947902,"username":"msmiley","name":"Matt Smiley","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3947902/avatar.png","web_url":"https://gitlab.com/msmiley"},"labels":["workflow-infra::Done"],"milestone":null,"assignees":[{"id":3947902,"username":"msmiley","name":"Matt Smiley","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3947902/avatar.png","web_url":"https://gitlab.com/msmiley"}],"author":{"id":3947902,"username":"msmiley","name":"Matt Smiley","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3947902/avatar.png","web_url":"https://gitlab.com/msmiley"},"type":"ISSUE","assignee":{"id":3947902,"username":"msmiley","name":"Matt Smiley","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3947902/avatar.png","web_url":"https://gitlab.com/msmiley"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9207","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9207","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9207/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9207/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9207","relative":"#9207","full":"gitlab-com/gl-infra/reliability#9207"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":30730945,"iid":9206,"project_id":1304532,"title":"CI job stalled with no trace output for chef-repo apply_to_prod job","description":"Investigate why a CI job in our chef-repo's CI pipeline seems to have stalled indefinitely.\n\n### Details\n\nThe following manually triggered job (`apply_to_prod`) in the normal chef-repo CI pipeline seems to have stalled and shows no job trace output via the web UI:\n\nhttps://ops.gitlab.net/gitlab-cookbooks/chef-repo/-/jobs/909330\n\nThe purpose of this job is to push the merge request's changes to chef server, so that subsequent chef-client runs can apply them.  Chef server did get those changes, which initially suggested that this job may have run but lost its output.  However, we discovered that this job had been run twice, with the first run succeeding and the second run stalling.\n\nhttps://ops.gitlab.net/gitlab-cookbooks/chef-repo/-/jobs/909204\n\nSo the successful first run would have pushed the changes to Chef Server.  That puts us back to suspecting that the 2nd job run is stalled rather than just not reporting its output.","state":"closed","created_at":"2020-02-13T19:48:17.430Z","updated_at":"2023-05-05T11:11:14.757Z","closed_at":"2023-05-05T11:11:14.737Z","closed_by":{"id":4411649,"username":"rehab","name":"Rehab","state":"active","avatar_url":"https://secure.gravatar.com/avatar/9d69bb3e051942900412ccf83871b403?s=80\u0026d=identicon","web_url":"https://gitlab.com/rehab"},"labels":["Reliability::P4","Service::CI Runners","team::Reliability","workflow-infra::Cancelled"],"milestone":null,"assignees":[],"author":{"id":3947902,"username":"msmiley","name":"Matt Smiley","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3947902/avatar.png","web_url":"https://gitlab.com/msmiley"},"type":"ISSUE","assignee":null,"user_notes_count":4,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9206","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9206","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9206/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9206/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9206","relative":"#9206","full":"gitlab-com/gl-infra/reliability#9206"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":"needs_attention"},{"id":30723483,"iid":9201,"project_id":1304532,"title":"Postgres Replication lag is over 3 hours on archive recovery replica","description":"Postgres Replication lag is frequently over 3 hours on archive recovery replica, and was especially high on Tuesday, 2020-02-11.\n\n![Screen_Shot_2020-02-13_at_10.10.28_AM](/uploads/6d30a5240151878cfd71a8c549127981/Screen_Shot_2020-02-13_at_10.10.28_AM.png)\n\nhttps://prometheus-db.gprd.gitlab.net/graph?g0.range_input=1w\u0026g0.expr=(pg_replication_lag%20%3E%201)%20and%20on(instance)%20(pg_replication_is_replica%7Btype%3D%22postgres-archive%22%7D%20%3D%3D%201)\u0026g0.tab=0\n\nSome initial diagnosis work has been undertaken by @gerardo.herzig with `#ongres-gitlab`.\n\n\u003e \"From time to time, wal-e wal fetching is getting stuck\"\n\nPlease see the linked incident issue for more details: https://gitlab.com/gitlab-com/gl-infra/production/issues/1653","state":"closed","created_at":"2020-02-13T16:14:24.798Z","updated_at":"2022-08-04T17:53:18.780Z","closed_at":"2022-08-02T06:03:05.463Z","closed_by":{"id":1786152,"username":"gitlab-bot","name":"ü§ñ GitLab Bot ü§ñ","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1786152/avatar.png","web_url":"https://gitlab.com/gitlab-bot"},"labels":["C4","Service::Postgres","backup","workflow-infra::Done"],"milestone":null,"assignees":[],"author":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"type":"ISSUE","assignee":null,"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9201","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9201","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9201/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9201/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9201","relative":"#9201","full":"gitlab-com/gl-infra/reliability#9201"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":30722090,"iid":9198,"project_id":1304532,"title":"RCA: 2020-02-12: The elastic_indexer Sidekiq queue (main stage) is not meeting its latency SLOs","description":"\u003c!--\n**Please note:** if the incident relates to sensitive data, or is security related consider\nlabeling this issue with ~security and mark it confidential.\n*** \n--\u003e\n\nIncident: gitlab-com/gl-infra/production#1661\n\n## Summary\n\nOur default setting of sidekiq db connection pool size to be equal to `max_concurrency` was making it likely to have worker threads competing for db connections on nodes with a very low `max_concurrency`. As a result, we were seeing some jobs timing out on getting a db connection on those queues.\n\n- Service(s) affected : ~\"Service::Sidekiq\" \n- Team attribution : \n- Minutes downtime or degradation : \n\nFor calculating duration of event, use the [Platform Metrics Dashboard](https://dashboards.gitlab.net/d/ZUei7TkWz/platform-metrics?orgId=1) to look at appdex and SLO violations.\n\n## Impact \u0026 Metrics\n\nStart with the following:\n\n- What was the impact of the incident? (i.e. service outage, sub-service brown-out, exposure of sensitive data, ...)\n- Who was impacted by this incident? (i.e. external customers, internal customers, specific teams, ...)\n- How did the incident impact customers? (i.e. preventing them from doing X, incorrect display of Y, ...)\n- How many attempts were made to access the impacted service/feature?\n- How many customers were affected?\n- How many customers tried to access the impacted service/feature?\n\nInclude any additional metrics that are of relevance.\n\nProvide any relevant graphs that could help understand the impact of the incident and its dynamics.\n\n## Detection \u0026 Response\n\nStart with the following:\n\n- How was the incident detected?\n- Did alarming work as expected?\n- How long did it take from the start of the incident to its detection?\n- How long did it take from detection to remediation?\n- Were there any issues with the response to the incident? (i.e. bastion host used to access the service was not available, relevant team memeber wasn't page-able, ...)\n\n## Root Cause Analysis\n\nThe purpose of this document is to understand the reasons that caused an incident, and to create mechanisms to prevent it from recurring in the future. A root cause can **never be a person**, the way of writing has to refer to the system and the context rather than the specific actors.\n\nFollow the \"**5 whys**\" in a **blameless** manner as the core of the root-cause analysis.\n\nFor this it is necessary to start with the incident, and question why it happened. Keep iterating asking \"why?\" 5 times. While it's not a hard rule that it has to be 5 times, it helps to keep questions get deeper in finding the actual root cause. \n\nKeep in min that from one \"why?\" there may come more than one answer, consider following the different branches.\n\n### Example of the usage of \"5 whys\"\nThe vehicle will not start. (the problem)\n\n1. Why? - The battery is dead. \n2. Why? - The alternator is not functioning.\n3. Why? - The alternator belt has broken.\n4. Why? - The alternator belt was well beyond its useful service life and not replaced. \n5. Why? - The vehicle was not maintained according to the recommended service schedule. (Fifth why, a root cause)\n\n## What went well\n\nStart with the following:\n\n- Identify the things that worked well or as expected.\n- Any additional call-outs for what went particularly well.\n\n## What can be improved\n\nStart with the following:\n\n- Using the root cause analysis, explain what can be improved to prevent this from happening again.\n- Is there anything that could have been done to improve the detection or time to detection?\n- Is there anything that could have been done to improve the response or time to response?\n- Is there an existing issue that would have either prevented this incident or reduced the impact?\n- Did we have any indication or beforehand knowledge that this incident might take place?\n\n## Corrective actions\n\nFrom https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/9198#note_287817712\n\n* We have overridden the minimum connection pool size in `gitlab.rb` for the elasticsearch and export priorities and this has resolved the issue: https://ops.gitlab.net/gitlab-cookbooks/chef-repo/-/merge_requests/2668\n* The database connection pool should always have a minimum number pool size greater than some value (perhaps 5?) cc @mkaeppler @ayufan https://gitlab.com/gitlab-com/gl-infra/scalability/issues/155\n* For higher concurrencies, it would be worth considering adding a few extra connections to the pool than the concurrency, as an insurance against deadlock cc @mkaeppler @ayufan https://gitlab.com/gitlab-com/gl-infra/scalability/issues/155\n* We should report, through prometheus, connection pool utilisation in a process (on an interval, eg every 10 seconds?) - as a gauge metric. We should also record maximum pool size, so that we can add connection pool saturation as a saturation metric cc @mkaeppler @ayufan (https://gitlab.com/gitlab-com/gl-infra/scalability/issues/153)\n* Track down the cause of the exception rescues in the elastic indexer workers cc @DylanGriffith https://gitlab.com/gitlab-org/gitlab/issues/205640\n* Do not re-report old Sidekiq errors in future invocations https://gitlab.com/gitlab-org/gitlab/-/merge_requests/25161\n* Do no mask errors behind `Sidekiq::JobRetry::Skip` exceptions\n* Reindex lost ES index jobs cc @DylanGriffith - https://gitlab.com/gitlab-com/gl-infra/production/issues/1666\n\n## Guidelines\n\n* [Blameless RCA Guideline](https://about.gitlab.com/handbook/infrastructure/#rca)\n* [5 whys](https://en.wikipedia.org/wiki/5_Whys)","state":"closed","created_at":"2020-02-13T15:31:39.439Z","updated_at":"2022-08-04T17:53:20.815Z","closed_at":"2020-02-20T10:24:20.468Z","closed_by":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"labels":["IncidentReview","Service::Pgbouncer","severity::4","workflow-infra::Done"],"milestone":null,"assignees":[{"id":120073,"username":"DylanGriffith","name":"Dylan Griffith","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/120073/avatar.png","web_url":"https://gitlab.com/DylanGriffith"},{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"}],"author":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"type":"ISSUE","assignee":{"id":120073,"username":"DylanGriffith","name":"Dylan Griffith","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/120073/avatar.png","web_url":"https://gitlab.com/DylanGriffith"},"user_notes_count":25,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9198","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9198","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9198/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9198/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9198","relative":"#9198","full":"gitlab-com/gl-infra/reliability#9198"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":30682623,"iid":9193,"project_id":1304532,"title":"It appears that the /dev/sda1 disk on api-06-sv-gprd.c.gitlab-production.internal will be full soon","description":"Alert:\n\n\u003e The filesystem is predicted to be full in will be full in the next 24 hours.\n\n![Screen_Shot_2020-02-12_at_10.47.27_AM](/uploads/9f6d1ce6116312684c51fe845f61fd5e/Screen_Shot_2020-02-12_at_10.47.27_AM.png)\n\n```bash\n$ bundle exec knife ssh role:gprd-base-fe-api 'df -h | grep \"/dev/sda1\"'\napi-15-sv-gprd.c.gitlab-production.internal /dev/sda1                                                                                         20G   12G  8.2G  58% /\napi-25-sv-gprd.c.gitlab-production.internal /dev/sda1                                                                                         20G   11G  8.7G  56% /\napi-04-sv-gprd.c.gitlab-production.internal /dev/sda1                                                                                         20G   18G  2.3G  89% /\napi-21-sv-gprd.c.gitlab-production.internal /dev/sda1                                                                                         20G   15G  5.3G  74% /\napi-07-sv-gprd.c.gitlab-production.internal /dev/sda1                                                                                         20G   11G  8.7G  56% /\napi-13-sv-gprd.c.gitlab-production.internal /dev/sda1                                                                                         20G  6.8G   13G  35% /\napi-19-sv-gprd.c.gitlab-production.internal /dev/sda1                                                                                         20G   12G  8.2G  58% /\napi-09-sv-gprd.c.gitlab-production.internal /dev/sda1                                                                                         20G   14G  6.1G  69% /\napi-03-sv-gprd.c.gitlab-production.internal /dev/sda1                                                                                         20G   13G  6.4G  68% /\napi-16-sv-gprd.c.gitlab-production.internal /dev/sda1                                                                                         20G  6.5G   13G  34% /\napi-10-sv-gprd.c.gitlab-production.internal /dev/sda1                                                                                         20G   15G  4.5G  77% /\napi-24-sv-gprd.c.gitlab-production.internal /dev/sda1                                                                                         20G   12G  7.8G  60% /\napi-11-sv-gprd.c.gitlab-production.internal /dev/sda1                                                                                         20G   14G  6.0G  70% /\napi-01-sv-gprd.c.gitlab-production.internal /dev/sda1                                                                                         20G   13G  6.6G  67% /\napi-08-sv-gprd.c.gitlab-production.internal /dev/sda1                                                                                         20G   13G  6.5G  67% /\napi-18-sv-gprd.c.gitlab-production.internal /dev/sda1                                                                                         20G   13G  7.1G  64% /\napi-17-sv-gprd.c.gitlab-production.internal /dev/sda1                                                                                         20G   12G  8.2G  58% /\napi-20-sv-gprd.c.gitlab-production.internal /dev/sda1                                                                                         20G   16G  3.9G  80% /\napi-22-sv-gprd.c.gitlab-production.internal /dev/sda1                                                                                         20G   13G  6.9G  65% /\napi-14-sv-gprd.c.gitlab-production.internal /dev/sda1                                                                                         20G   13G  6.8G  65% /\napi-06-sv-gprd.c.gitlab-production.internal /dev/sda1                                                                                         20G   18G  2.1G  90% /\napi-05-sv-gprd.c.gitlab-production.internal /dev/sda1                                                                                         20G   16G  3.7G  81% /\napi-23-sv-gprd.c.gitlab-production.internal /dev/sda1                                                                                         20G  7.1G   13G  37% /\napi-26-sv-gprd.c.gitlab-production.internal /dev/sda1                                                                                         20G   15G  5.0G  75% /\napi-12-sv-gprd.c.gitlab-production.internal /dev/sda1                                                                                         20G   13G  6.8G  65% /\napi-02-sv-gprd.c.gitlab-production.internal /dev/sda1                                                                                         20G   14G  5.5G  72% /\n```\n\nAnd also `api-04-sv-gprd.c.gitlab-production.internal`.\n\n![Screen_Shot_2020-02-12_at_10.46.16_AM](/uploads/dcec9a4a04e9842621cd1adc00a8e447/Screen_Shot_2020-02-12_at_10.46.16_AM.png)","state":"closed","created_at":"2020-02-12T16:24:09.182Z","updated_at":"2022-08-04T17:53:24.250Z","closed_at":"2021-02-16T22:17:10.775Z","closed_by":{"id":3623028,"username":"cmiskell","name":"Craig Miskell","state":"active","avatar_url":"https://secure.gravatar.com/avatar/852a93b505b1f4a5549595792035f445?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmiskell"},"labels":["Service::API","auto updated","workflow-infra::Done"],"milestone":null,"assignees":[{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"}],"author":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"type":"ISSUE","assignee":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"user_notes_count":16,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2020-02-12","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9193","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9193","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9193/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9193/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9193","relative":"#9193","full":"gitlab-com/gl-infra/reliability#9193"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":30681897,"iid":9190,"project_id":1304532,"title":"It appears that the pgbouncer_async_pool component of the pgbouncer service consistently exceeds SLO","description":"This alert popped up in the #alerts-general slack channel today:\n\n\u003e The `pgbouncer` service (`main` stage), `pgbouncer_async_pool` component has a saturation exceeding SLO and is close to its capacity limit.\n\n\u003e This means that this resource is running close to capacity and is at risk of exceeding its current capacity limit.\n\nSo, I clicked through to the dashboard and saw this:\n\n![Screen_Shot_2020-02-12_at_10.00.07_AM](/uploads/dda0e529a7c5caaa15a92061fd8c98e2/Screen_Shot_2020-02-12_at_10.00.07_AM.png)\n\nhttps://dashboards.gitlab.net/d/alerts-saturation_component/alerts-saturation-component-alert?orgId=1\u0026from=now-7d\u0026to=now\u0026panelId=2\u0026tz=UTC\u0026var-environment=gprd\u0026var-type=pgbouncer\u0026var-stage=main\u0026var-component=pgbouncer_async_pool\n\nThat looks pretty consistently not good.\n\nI imagine the pool needs to be adjusted upward, to expand capacity?  I do not yet have any knowledge about whether the existing system resources will support such an expansion or not.","state":"closed","created_at":"2020-02-12T16:04:36.285Z","updated_at":"2022-08-04T17:53:26.390Z","closed_at":"2020-07-13T12:22:54.918Z","closed_by":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"labels":["C4","Database","OnGres::Support","Service::Pgbouncer","workflow-infra::Done"],"milestone":{"id":1142605,"iid":66,"group_id":1112072,"title":"W6 DBRE","description":"","state":"closed","created_at":"2020-02-02T07:54:53.150Z","updated_at":"2020-03-02T08:54:59.491Z","due_date":"2020-02-14","start_date":"2020-02-03","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/66"},"assignees":[{"id":2493611,"username":"adescoms","name":"Adri√°n Escoms","state":"active","avatar_url":"https://secure.gravatar.com/avatar/d6f86d318669a8b32174b7132607443d?s=80\u0026d=identicon","web_url":"https://gitlab.com/adescoms"},{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"}],"author":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"type":"ISSUE","assignee":{"id":2493611,"username":"adescoms","name":"Adri√°n Escoms","state":"active","avatar_url":"https://secure.gravatar.com/avatar/d6f86d318669a8b32174b7132607443d?s=80\u0026d=identicon","web_url":"https://gitlab.com/adescoms"},"user_notes_count":8,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9190","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9190","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9190/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9190/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9190","relative":"#9190","full":"gitlab-com/gl-infra/reliability#9190"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":69129504,"iid":10955,"project_id":1304532,"title":"check the performance of the bloat check","description":"We had this check offline - Get http://10.217.7.101:9168/database_bloat: context deadline exceeded\n\nhttps://prometheus-db.gprd.gitlab.net/targets#job-gitlab-monitor-database-bloat\n\nSeems we reached a timeout.\n\nWe should investigate why, and find out, performance improvements if possible.\n\nThe queries come from an external codebase recommendation:\n\nhttps://gitlab.com/gitlab-org/gitlab-exporter/-/blob/master/lib/gitlab_exporter/database/bloat_btree.sql\n\nhttps://gitlab.com/gitlab-org/gitlab-exporter/-/blob/master/lib/gitlab_exporter/database/bloat_table.sql","state":"closed","created_at":"2020-02-12T15:12:27.864Z","updated_at":"2022-08-04T17:53:27.538Z","closed_at":"2021-06-03T11:35:29.261Z","closed_by":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"labels":["Database","Database","auto updated","workflow-infra::Done"],"milestone":null,"assignees":[{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"}],"author":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"type":"ISSUE","assignee":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"user_notes_count":5,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/10955","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/10955","notes":"https://gitlab.com/api/v4/projects/1304532/issues/10955/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/10955/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#10955","relative":"#10955","full":"gitlab-com/gl-infra/reliability#10955"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":30647134,"iid":9182,"project_id":1304532,"title":"Set 301 redirect for www.remoteonly.org","description":"Followup from https://gitlab.com/gitlab-com/www-gitlab-com/issues/6153\n\n/cc @dmurph @awinata","state":"closed","created_at":"2020-02-11T19:41:03.790Z","updated_at":"2022-08-04T17:53:31.870Z","closed_at":"2020-02-13T20:48:19.216Z","closed_by":{"id":367626,"username":"alejandro","name":"Alejandro Rodr√≠guez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"},"labels":["workflow-infra::Done"],"milestone":{"id":1089114,"iid":61,"group_id":1112072,"title":"Reliability February 2020","description":"It's a leap year! 29 days this February.","state":"closed","created_at":"2019-12-04T21:56:25.906Z","updated_at":"2020-04-06T19:04:09.864Z","due_date":"2020-02-29","start_date":"2020-02-01","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/61"},"assignees":[{"id":367626,"username":"alejandro","name":"Alejandro Rodr√≠guez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"}],"author":{"id":367626,"username":"alejandro","name":"Alejandro Rodr√≠guez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"},"type":"ISSUE","assignee":{"id":367626,"username":"alejandro","name":"Alejandro Rodr√≠guez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"},"user_notes_count":4,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9182","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9182","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9182/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9182/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9182","relative":"#9182","full":"gitlab-com/gl-infra/reliability#9182"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":30622920,"iid":9177,"project_id":1304532,"title":"create test environment in staging for capacity planning","description":"considering the issue : https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/9094\n\nWe need the necessary environment to proceed with the [GPT](https://gitlab.com/gitlab-org/quality/performance):\n\n- [x] database server with the setup similar with production\n- [x] create a box to deploy the performance tool.\n- [ ] Configure boxes for [pointing Gitlab instance to the database box](https://docs.gitlab.com/ee/administration/high_availability/gitlab.html).","state":"closed","created_at":"2020-02-11T10:44:02.323Z","updated_at":"2020-03-25T07:59:12.169Z","closed_at":"2020-03-03T14:08:32.652Z","closed_by":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"labels":["Database","OnGres::Project","workflow-infra::Done"],"milestone":{"id":1159113,"iid":69,"group_id":1112072,"title":"W8 DBRE","description":"","state":"closed","created_at":"2020-02-17T07:46:04.317Z","updated_at":"2020-03-02T08:55:22.683Z","due_date":"2020-02-28","start_date":"2020-02-17","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/69"},"assignees":[{"id":2493611,"username":"adescoms","name":"Adri√°n Escoms","state":"active","avatar_url":"https://secure.gravatar.com/avatar/d6f86d318669a8b32174b7132607443d?s=80\u0026d=identicon","web_url":"https://gitlab.com/adescoms"},{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"}],"author":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"type":"ISSUE","assignee":{"id":2493611,"username":"adescoms","name":"Adri√°n Escoms","state":"active","avatar_url":"https://secure.gravatar.com/avatar/d6f86d318669a8b32174b7132607443d?s=80\u0026d=identicon","web_url":"https://gitlab.com/adescoms"},"user_notes_count":53,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9177","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":3,"completed_count":2},"weight":2,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9177","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9177/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9177/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9177","relative":"#9177","full":"gitlab-com/gl-infra/reliability#9177"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":30617659,"iid":9176,"project_id":1304532,"title":"RCA: 2020-02-11 High db insert rate caused by enabling issue templates on projects","description":"\u003c!--\n**Please note:** if the incident relates to sensitive data, or is security related consider\nlabeling this issue with ~security and mark it confidential.\n*** \n--\u003e\n\nIncident: https://gitlab.com/gitlab-com/gl-infra/production/issues/1651\n\n## Summary\n\nEnabling instance templates for each project creation due to a bug, caused thousands of services to be created for each project creation (doing URL validation for each service, causing delays) which was causing a high db insert rate and latencies for web.\n\nAdditionally, because of copying the same template to the projects, many slack notifications from other projects were sent to out to one single project, which is a security issue: https://gitlab.com/gitlab-com/gl-security/secops/operations/issues/650\n\n- Service(s) affected : ~\"Service::Web\" ~\"Service::Postgres\" \n- Team attribution : ~\"group::ecosystem\" \n- Minutes downtime or degradation : 153m (06:31 - 09:04)\n\nFor calculating duration of event, use the [Platform Metrics Dashboard](https://dashboards.gitlab.net/d/ZUei7TkWz/platform-metrics?orgId=1) to look at appdex and SLO violations.\n\n## Impact \u0026 Metrics\n\nStart with the following:\n\n- What was the impact of the incident? (i.e. service outage, sub-service brown-out, exposure of sensitive data, ...)\n- Who was impacted by this incident? (i.e. external customers, internal customers, specific teams, ...)\n- How did the incident impact customers? (i.e. preventing them from doing X, incorrect display of Y, ...)\n- How many attempts were made to access the impacted service/feature?\n- How many customers were affected?\n- How many customers tried to access the impacted service/feature?\n\nInclude any additional metrics that are of relevance.\n\nProvide any relevant graphs that could help understand the impact of the incident and its dynamics.\n\nDB inserts into `services` table:\n![image](/uploads/1910528a373d585508c28378e8ec5501/image.png)\nhttps://dashboards.gitlab.net/d/RZmbBr7mk/gitlab-triage?orgId=1\u0026fullscreen\u0026panelId=8\u0026from=1581399974013\u0026to=1581413232942\n\nWeb saturation:\n![image](/uploads/4847c780a52743bee7ab3c36cc9c0ef6/image.png)\nhttps://dashboards.gitlab.net/d/general-service/general-service-platform-metrics?orgId=1\u0026fullscreen\u0026panelId=10\u0026from=1581400421276\u0026to=1581413397765\n\n\n## Detection \u0026 Response\n\nStart with the following:\n\n- How was the incident detected?\n  - EOC was paged because of db replication lag caused by high insert rate, marquee customer alerts also triggered\n- Did alarming work as expected?\n  - We did not get SLO violation alerts, maybe the impact wasn't high enough - need to investigate\n- How long did it take from the start of the incident to its detection?\n  - 45m until [db replication alert](https://gitlab.pagerduty.com/incidents/PBP8ZVR?utm_source=slack\u0026utm_campaign=channel) fired (06:31 - 07:16)\n- How long did it take from detection to remediation?\n  - 108m (07:16 - 09:04)\n- Were there any issues with the response to the incident? (i.e. bastion host used to access the service was not available, relevant team member wasn't page-able, ...)\n\n## Root Cause Analysis\n\nWe experienced high web latencies\n\n1. Why? - Because we suddenly started to create many services for each project creation, doing url lookups each service in `lib/gitlab/url_blocker.rb:111`, which took a lot of time (during a db transaction inserting into the `services` table).\n2. Why? - Because the instance creation attribute was set to `true` for each new project.\n3. Why? - Because a [db migration](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/23595/diffs#diff-content-abca773d09b69a0771e11f06ab0d9e92ab632889) with a column rename created a trigger to set `instance = template`, which enabled the previously disabled attribute\n4. Why? - Because we had two versions of the codebase running at the same time, one would set a `template` to false when creating a new service, and the other would set `instance` to false but leave `template` as true (and therefore repopulate `instance` as true based on the trigger)\n5. Why? - Service code is old and does some things we probably would not accept now like not having unique constraints on project_id and service type. We have validations at application level, not at the database level.\n\n## What went well\n\nStart with the following:\n\n- Identify the things that worked well or as expected.\n- Any additional call-outs for what went particularly well.\n\n## What can be improved\n\nStart with the following:\n\n- Using the root cause analysis, explain what can be improved to prevent this from happening again.\n- Is there anything that could have been done to improve the detection or time to detection?\n- Is there anything that could have been done to improve the response or time to response?\n- Is there an existing issue that would have either prevented this incident or reduced the impact?\n- Did we have any indication or beforehand knowledge that this incident might take place?\n\n## Corrective actions\n\n- Immediate corrective actions were to revert the change.\n  - https://gitlab.com/gitlab-org/gitlab/-/merge_requests/24857\n  - https://gitlab.com/gitlab-org/gitlab/-/merge_requests/24885\n- We will add database constraints as suggested in https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/9176#note_286149490\n- Add suggestion to [renaming columns docs](https://docs.gitlab.com/ee/development/what_requires_downtime.html#renaming-columns) about splitting migration MRs\n\n## Guidelines\n\n* [Blameless RCA Guideline](https://about.gitlab.com/handbook/infrastructure/#rca)\n* [5 whys](https://en.wikipedia.org/wiki/5_Whys)","state":"closed","created_at":"2020-02-11T09:42:11.343Z","updated_at":"2022-08-04T17:53:35.355Z","closed_at":"2020-02-20T10:28:04.564Z","closed_by":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"labels":["C1","IncidentReview","incident","security","severity::1","workflow-infra::Done"],"milestone":null,"assignees":[{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"}],"author":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"type":"INCIDENT","assignee":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"user_notes_count":36,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2020-03-13","confidential":false,"discussion_locked":null,"issue_type":"incident","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9176","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9176","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9176/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9176/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9176","relative":"#9176","full":"gitlab-com/gl-infra/reliability#9176"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":30600879,"iid":9174,"project_id":1304532,"title":"Add an auto-scaling policy to the snowplow collectors in AWS","description":"There were a few troubles with the collectors in Snowplow this morning: https://gitlab.pagerduty.com/incidents/P0CIK95?utm_source=slack\u0026utm_campaign=channel\n\nThere is an auto scaling group defined for the collectors, but no policy to take advantage of it. We should add a policy.","state":"closed","created_at":"2020-02-10T19:53:50.467Z","updated_at":"2020-02-14T22:25:29.371Z","closed_at":"2020-02-14T21:44:09.942Z","closed_by":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"labels":["Service::Snowplow","priority::3","workflow-infra::Done"],"milestone":{"id":1089114,"iid":61,"group_id":1112072,"title":"Reliability February 2020","description":"It's a leap year! 29 days this February.","state":"closed","created_at":"2019-12-04T21:56:25.906Z","updated_at":"2020-04-06T19:04:09.864Z","due_date":"2020-02-29","start_date":"2020-02-01","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/61"},"assignees":[{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"}],"author":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"type":"ISSUE","assignee":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9174","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9174","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9174/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9174/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9174","relative":"#9174","full":"gitlab-com/gl-infra/reliability#9174"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":30593946,"iid":9172,"project_id":1304532,"title":"Remove us-east-1b availability zone from snowplow collector auto scaling group","description":"The machine size specified, `t2.micro`, is not available in that availability zone. Possibly replace it with another AZ?","state":"closed","created_at":"2020-02-10T16:42:21.184Z","updated_at":"2022-08-04T17:53:38.326Z","closed_at":"2020-02-13T21:27:03.307Z","closed_by":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"labels":["Service::Snowplow","priority::3","workflow-infra::Done"],"milestone":null,"assignees":[{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"}],"author":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"type":"ISSUE","assignee":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9172","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9172","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9172/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9172/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9172","relative":"#9172","full":"gitlab-com/gl-infra/reliability#9172"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":30488450,"iid":9156,"project_id":1304532,"title":"Regenerate docker-machine certs during gitlab-runner upgrades","description":"### Task\n\nOpportunistically regenerate the CA and client certificates used by `docker-machine` on our CI Runner Manager hosts to provision VMs.  This avoids a race condition that can corrupt the certs if they expire naturally while the host is in service.\n\nWe deploy the `gitlab-runner` service more often than the certs expire, and that planned downtime provides an opportunity when no other `docker-machine` processes should be running, hence avoiding the race condition.\n\n### Background\n\nCurrently our CI Runner Manager hosts use `docker-machine` to provision VMs for running CI jobs in docker containers.  The manager host acts as a CA and signs its own client cert as well as the per-VM server cert.  The CA and client certs have a 3-year lifespan, and when they expire, the next invocation of `docker-machine create` will generate a fresh pair of certs.  However, in a high-throughput environment like GitLab.com, it is very likely that multiple docker-machine processes will concurrently try to generate new certs, each one overwriting the other's work.  This can lead to mismatched or corrupt CA and client certs.  When that occurs (see https://gitlab.com/gitlab-com/gl-infra/production/issues/1609#note_283265339), the host running docker-machine can provision new VMs, but those VMs reject all attempts to authenticate to its `dockerd` daemon using the damaged or untrusted client cert.  Consequently, the manager host fails to run every job it pulls.","state":"closed","created_at":"2020-02-06T22:41:34.114Z","updated_at":"2022-08-04T17:53:51.228Z","closed_at":"2021-07-15T06:24:44.145Z","closed_by":{"id":210928,"username":"steveazz","name":"Steve Azzopardi","state":"active","avatar_url":"https://secure.gravatar.com/avatar/4a5eeed7ec5c80642df9ee708bb496d7?s=80\u0026d=identicon","web_url":"https://gitlab.com/steveazz"},"labels":["Service::CI Runners","corrective action","severity::2","team::Reliability","workflow-infra::Done"],"milestone":null,"assignees":[],"author":{"id":3947902,"username":"msmiley","name":"Matt Smiley","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3947902/avatar.png","web_url":"https://gitlab.com/msmiley"},"type":"ISSUE","assignee":null,"user_notes_count":3,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9156","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9156","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9156/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9156/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9156","relative":"#9156","full":"gitlab-com/gl-infra/reliability#9156"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":30481273,"iid":9147,"project_id":1304532,"title":"Terraform error re-creating forwarding rule for load balancer","description":"When deleting a load balancer and then re-creating it and its forwarding rule, we get an error due to not specifying the subnet.\n\n```\nError: Error creating ForwardingRule: googleapi: Error 400: Invalid value for field 'resource.subnetwork': ''. Network interface must specify a subnet if the network resource is in custom subnet mode., invalid\n\n  on .terraform/modules/gcp-tcp-lb-internal/loadbalancing.tf line 102, in resource \"google_compute_forwarding_rule\" \"internal\":\n 102: resource \"google_compute_forwarding_rule\" \"internal\" {\n```","state":"closed","created_at":"2020-02-06T18:09:37.145Z","updated_at":"2022-08-04T17:54:13.266Z","closed_at":"2020-02-06T18:57:14.727Z","closed_by":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"labels":["terraform","workflow-infra::Done"],"milestone":null,"assignees":[{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"}],"author":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"type":"ISSUE","assignee":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9147","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9147","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9147/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9147/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9147","relative":"#9147","full":"gitlab-com/gl-infra/reliability#9147"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":30440115,"iid":9128,"project_id":1304532,"title":"2020-02-05 assist with support for marquee customer","description":"Help with support call on 2020-02-04 and follow-up tasks.\n\nCustomer is building a shared CI runner platform and but some metrics are missing from their Grafana dashboards.  Help troubleshooting why some metrics are missing.","state":"closed","created_at":"2020-02-05T19:21:24.895Z","updated_at":"2022-08-04T17:54:23.590Z","closed_at":"2020-02-15T00:38:38.231Z","closed_by":{"id":3947902,"username":"msmiley","name":"Matt Smiley","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3947902/avatar.png","web_url":"https://gitlab.com/msmiley"},"labels":["workflow-infra::Done"],"milestone":null,"assignees":[{"id":3947902,"username":"msmiley","name":"Matt Smiley","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3947902/avatar.png","web_url":"https://gitlab.com/msmiley"}],"author":{"id":3947902,"username":"msmiley","name":"Matt Smiley","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3947902/avatar.png","web_url":"https://gitlab.com/msmiley"},"type":"ISSUE","assignee":{"id":3947902,"username":"msmiley","name":"Matt Smiley","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3947902/avatar.png","web_url":"https://gitlab.com/msmiley"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9128","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9128","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9128/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9128/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9128","relative":"#9128","full":"gitlab-com/gl-infra/reliability#9128"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":30420924,"iid":9117,"project_id":1304532,"title":"Evaluate options to enable checksums on the database","description":"We need to enable checksums in the database, the main reason is to avoid data corruption.\n\nWe need to estimate the most adequated strategy to accomplish this task on our database.\n\nWe could consider a switchover to an instance generated by logical replication. (It is needed a project to create this instance from the actual cluster using logical replication.)\n\nOr we could think about a longer maintenance window to enable checksums on the database, but our SLA agreements won't allow this approach.","state":"closed","created_at":"2020-02-05T12:49:37.607Z","updated_at":"2022-08-04T17:54:30.182Z","closed_at":"2020-10-02T09:54:43.394Z","closed_by":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"labels":["Database","auto updated","workflow-infra::Done"],"milestone":null,"assignees":[{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"}],"author":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"type":"ISSUE","assignee":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2020-09-30","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9117","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":12,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9117","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9117/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9117/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9117","relative":"#9117","full":"gitlab-com/gl-infra/reliability#9117"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":171,"epic":{"id":19349,"iid":171,"title":"Enable checksums in the PostgreSQL database and integrity checks","url":"/groups/gitlab-com/gl-infra/-/epics/171","group_id":1112072,"human_readable_end_date":"Jan 29, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":30285613,"iid":9098,"project_id":1304532,"title":"Create chronogram for the PostgreSQL upgrade","description":"Create a chronogram to have better visibility or blockers for the Postgresql upgrade.\n\nThis chronogram will have per task :\n\n-the overview.\n\n-the owner.\n \n-the deadline dates.\n\n-a field for possible blockers.","state":"closed","created_at":"2020-02-03T08:29:38.100Z","updated_at":"2022-08-04T17:54:41.400Z","closed_at":"2020-03-06T21:49:47.528Z","closed_by":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"labels":["Database","priority::2","workflow-infra::Done"],"milestone":{"id":1176149,"iid":70,"group_id":1112072,"title":"W10 DBRE","description":"","state":"closed","created_at":"2020-03-02T08:36:37.826Z","updated_at":"2020-03-30T08:30:41.949Z","due_date":"2020-03-13","start_date":"2020-03-02","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/70"},"assignees":[{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"}],"author":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"type":"ISSUE","assignee":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9098","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9098","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9098/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9098/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9098","relative":"#9098","full":"gitlab-com/gl-infra/reliability#9098"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":106,"epic":{"id":14061,"iid":106,"title":"Upgrade Postgresql to version 11.7 on GitLab.com","url":"/groups/gitlab-com/gl-infra/-/epics/106","group_id":1112072,"human_readable_end_date":"Apr 30, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":30285198,"iid":9097,"project_id":1304532,"title":"Defining the  steps for the PostgreSQL upgrade with a restore of a backup from production using a cluster with a replica ( read-only )","description":"The idea of this task is to create a test scenario for the PostgreSQL upgrade( pg 9.6 and 11.6 ), with a database with a size like production. \n\nWe should have a similar hardware setup as the production boxes in these boxes.\n\nWe the idea here is to get estimative of time that we need to execute the task of the upgrade.\n\nThe cluster could have 3 nodes.\n\n\n\n# Step by step for PG_UPGRADE(master and standby)\n\n\n@adescoms @sergio.ostapowicz @Finotto \nThe following  steps  are for executing `pg_upgrade` for upgrade from PG 9.6 to 11.7, \nthis was tested on servers `patroni-migrate-01-db-gstg.c.gitlab-staging-1.internal` and `patroni-migrate-02-db-gstg.c.gitlab-staging-1.internal`. \n\n***preliminary version***\n\n# Upgrade with pg_upgrade\n\nBefore executing the `pg_upgrade` some issue have to be resolved and are related with:\n\n - Server 9.6 have the extension `pg_repack` installed (solution, install pg_repack for PG 11)\n - Some views, functions, and queries from `postgres exporter` are incompatible with PG 11 (solution, like a workaround, rewrite the views and functions and add some wrapper functions for queries) \n - Make a copy to all configs file \n \n\nTo execute `pg_upgrade` in gitlab server you must follow the next steps: \n\n 1. Remove the following view and functions from PG 9.6\n\n\t   *  views : \"postgres_exporter\".\"pg_stat_replication\", \"postgres_exporter\".\"pg_stat_wal_receiver\"\n       *  functions : postgres_exporter.f_select_pg_stat_replication(), public.f_pg_stat_wal_receiver()\n\t  \n   1.1 Make sure all connections out , checkpoint in master and check replica status , \n\nAdd to pg_hba.conf from PG 9.6 the line\n  ```\nhost all all 0.0.0.0/0 reject\n  ```\n\nConnect to postgres database\n    \n```\n   select pg_terminate_backend(pid) from pg_stat_activity where datname='gitlabhq_production'; --disconnecto all from gitlabhq_production database\n   checkpoint ;\n   select * from pg_stat_replication ;\n\n```\n\n 2. Stop PG 9.6 if is  running in all server\n\n 3. Install postgresql-11 and stop service,  *ignore if is already installed and stopped*\n    * apt-get install postgresql-11\n    * pg_ctlcluster 11 main stop\n   \n 4. Create the path (*data11* or the name that you want) for the new PG cluster a give the correct permission\n ```\n     mkdir /var/opt/gitlab/postgresql/data11\n     chown gitlab-psql:gitlab-psql /var/opt/gitlab/postgresql/data11\n     chmod 700 /var/opt/gitlab/postgresql/data11/\n```\n 5. Create the new cluster database with user `gitlab-psql` in master\n    ```\n    su gitlab-psql\n    /usr/lib/postgresql/11/bin/./initdb -D /var/opt/gitlab/postgresql/data11 --locale=C.UTF-8 --encoding=UTF8\n    ```\n 6. Enable to connect locally \"trust\" on pg_hba(/var/opt/gitlab/postgresql/data/pg_hba.conf) by adding the following line to the beginning of the file\n    * local   all         all                              trust\n 7. Install the pg_repack extension for PG 11\n   ```\napt-get install postgresql-11-repack\n\n--optional, compile from source code\nwget http://api.pgxn.org/dist/pg_repack/1.4.5/pg_repack-1.4.5.zip\nunzip pg_repack-1.4.5.zip -d ./pg_repack\ncd pg_repack/pg_repack-1.4.5/\nmake  PG_CONFIG=/usr/lib/postgresql/11/bin/pg_config\n--like a root \nmake install PG_CONFIG=/usr/lib/postgresql/11/bin/pg_config\n\n```\n\n\n8. Install the postgresql 11 server on standby server and pg_repack extension\n```\napt-get install postgresql-11-repack\n\n--optional, compile from source code\n\nwget http://api.pgxn.org/dist/pg_repack/1.4.5/pg_repack-1.4.5.zip\nunzip pg_repack-1.4.5.zip -d ./pg_repack\ncd pg_repack/pg_repack-1.4.5/\nmake  PG_CONFIG=/usr/lib/postgresql/11/bin/pg_config\n--like a root \nmake install PG_CONFIG=/usr/lib/postgresql/11/bin/pg_config\n```\n  9.\tCheck if all fine before execute pg_upgrade in master\n   ```\n   su gitlab-psql\n /usr/lib/postgresql/11/bin/pg_upgrade --old-bindir /usr/lib/postgresql/9.6/bin --new-bindir /usr/lib/postgresql/11/bin --old-datadir /var/opt/gitlab/postgresql/data --new-datadir /var/opt/gitlab/postgresql/data11/ -o \"-c config_file=/var/opt/gitlab/postgresql/postgresql.conf\" -O \"-c config_file=/var/opt/gitlab/postgresql/data11/postgresql.conf\"  --check --link\n  ``` \n 10.\tIf the result from above is *Clusters are compatible* then execute the upgrade\n```\n--takes approximately 10 sec\nsu gitlab-psql\n /usr/lib/postgresql/11/bin/pg_upgrade --old-bindir /usr/lib/postgresql/9.6/bin --new-bindir /usr/lib/postgresql/11/bin --old-datadir /var/opt/gitlab/postgresql/data --new-datadir /var/opt/gitlab/postgresql/data11/ -o \"-c config_file=/var/opt/gitlab/postgresql/postgresql.conf\" -O \"-c config_file=/var/opt/gitlab/postgresql/data11/postgresql.conf\"  --link\n  ``` \t\n 11. If the result from above is *Upgrade Complete* then test start PG 11 , make sure the config are correct or with the values that you need and test start/stop PG service\n ```\nsu gitlab-psql\n cd /usr/lib/postgresql/11/bin/ \n./postgres -D /var/opt/gitlab/postgresql/data11 -c \"config_file=/var/opt/gitlab/postgresql/data11/postgresql.conf\"\n\nstop server\n  ``` \t\n\n### *Upgrade standby replicas*\n12. Create the structures for data 11 on replicas \n```\nmkdir /var/opt/gitlab/postgresql/data11\nchown gitlab-psql:gitlab-psql /var/opt/gitlab/postgresql/data11\nchmod 700 /var/opt/gitlab/postgresql/data11/\n```\n13. Copy to standby server the data for PG 11 and delta from PG 9.6, configure the recovery.conf to connecto to master PG 11\n```\ncd  /var/opt/gitlab/postgresql\nrsync --archive --delete --hard-links --size-only --no-inc-recursive  data data11 10.224.42.102:/var/opt/gitlab/postgresql\n```  \n\n\n14. Config the replica setting if is necessary \n15. Confing standby ,  Start master  and standby server\nrecovery.conf\n```\nrecovery_target_timeline = 'latest'\nstandby_mode = 'on'\nprimary_conninfo = 'user=gitlab-replicator password=password host=IP port=5432  application_name=your_name'\nprimary_slot_name = 'your_slot_name'\n```\n\n16. Create the replication slot in master\n```\n select pg_create_physical_replication_slot('your_slot_name');\n ``` \n \n \n17. Connect to postgres on Master server, and create the functions and views required by `postgres exporter`\n``` \nsudo gitlab-psql \n--and execute the code\nCREATE OR REPLACE FUNCTION postgres_exporter.f_select_pg_stat_replication()\n  RETURNS SETOF pg_catalog.pg_stat_replication                                         \n  LANGUAGE sql                                                              \n  SECURITY DEFINER                                                          \n AS $BODY$                                                             \n   SELECT * from pg_catalog.pg_stat_replication;                            \n $BODY$;\n\nCREATE VIEW \"postgres_exporter\".\"pg_stat_replication\" AS\n SELECT *\n   FROM \"postgres_exporter\".\"f_select_pg_stat_replication\"() ;\n   \n CREATE OR REPLACE FUNCTION public.f_pg_stat_wal_receiver()          \n  RETURNS SETOF pg_stat_wal_receiver                                 \n  LANGUAGE sql                                                       \n  SECURITY DEFINER                                                   \n AS $BODY$\n select * from pg_catalog.pg_stat_wal_receiver\n $BODY$;\n\nCREATE VIEW \"postgres_exporter\".\"pg_stat_wal_receiver\" AS\n SELECT *\n   FROM \"public\".\"f_pg_stat_wal_receiver\"() ;\n  \nGRANT ALL PRIVILEGES ON postgres_exporter.pg_stat_replication TO postgres_exporter;\nGRANT ALL PRIVILEGES ON postgres_exporter.pg_stat_wal_receiver TO postgres_exporter;\n\nCREATE OR REPLACE FUNCTION public.pg_last_xlog_replay_location()\n RETURNS pg_lsn AS\n $BODY$\n SELECT pg_last_wal_replay_lsn();\n $BODY$\n LANGUAGE SQL STABLE;\n\nCREATE OR REPLACE FUNCTION public.pg_current_xlog_insert_location()\n RETURNS pg_lsn AS\n $BODY$\n SELECT  pg_current_wal_insert_lsn();\n $BODY$\n LANGUAGE SQL STABLE;\n\nCREATE OR REPLACE FUNCTION public.pg_current_xlog_location() \n RETURNS pg_lsn AS $$\n SELECT pg_current_wal_lsn();\n $$ LANGUAGE SQL STABLE;\n\nCREATE OR REPLACE FUNCTION public.pg_xlogfile_name(pg_lsn) \n RETURNS text AS $$\n SELECT pg_walfile_name($1);\n $$ LANGUAGE SQL STABLE;\n\n``` \n \n 18. To collect statistics \n     *  Add the temporaly line to pg_hba.conf (/var/opt/gitlab/postgresql/data/pg_hba.conf) and reload conf  with `select pg_reload_conf()` : host   gitlabhq_production       gitlab-superuser        127.0.0.1/0        trust\n     * Execute the vaccumdb binaries with the following parameters: \n      ```\n        --takes approximately 4 min\n       /usr/lib/postgresql/11/bin/vacuumdb  --analyze-only --jobs 64 -d gitlabhq_production -U gitlab-superuser -h 127.0.0.1\n       ```\n    \n     * Remove  or comment the lines from pg_hba (/var/opt/gitlab/postgresql/data/pg_hba.conf) and reload conf with `select pg_reload_conf()` on master server:\n         * host all all 0.0.0.0/0 reject\n         * local   all         all                              trust\n         * host   gitlabhq_production       gitlab-superuser        127.0.0.1/0        trust  \n \n\n\n\n\n19. *Integrate PG 11 with HA solution Patroni*","state":"closed","created_at":"2020-02-03T08:18:53.455Z","updated_at":"2022-08-04T17:54:42.135Z","closed_at":"2020-03-16T09:52:17.304Z","closed_by":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"labels":["Database","priority::2","team::Reliability","workflow-infra::Done"],"milestone":{"id":1176149,"iid":70,"group_id":1112072,"title":"W10 DBRE","description":"","state":"closed","created_at":"2020-03-02T08:36:37.826Z","updated_at":"2020-03-30T08:30:41.949Z","due_date":"2020-03-13","start_date":"2020-03-02","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/70"},"assignees":[{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},{"id":4690884,"username":"asotolongo","name":"Anthony Sotolongo","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4690884/avatar.png","web_url":"https://gitlab.com/asotolongo"}],"author":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"type":"ISSUE","assignee":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"user_notes_count":68,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2020-05-29","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9097","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":8,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9097","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9097/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9097/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9097","relative":"#9097","full":"gitlab-com/gl-infra/reliability#9097"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":106,"epic":{"id":14061,"iid":106,"title":"Upgrade Postgresql to version 11.7 on GitLab.com","url":"/groups/gitlab-com/gl-infra/-/epics/106","group_id":1112072,"human_readable_end_date":"Apr 30, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":30284876,"iid":9096,"project_id":1304532,"title":"Create image for testing the PostgreSQL upgrade","description":"I would suggest, create an image before we execute the pg_upgrade.\n\nI would suggest stopping the PostgreSQL instances to keep the databases in a consistent state.\n\nThe suggestion would be to have a cluster ( can be with 2 nodes only Read-Write and Read-Only). \nWith Postgresql 9.6 ( the actual version from Production ) and version 11.6 that is the target for this migration.\n\nAlso, we should consider having the restoration of a backup in the PG 9.6. \n\nWith this image we could restore the testing scenario easier after our test, to be able to iterate faster.","state":"closed","created_at":"2020-02-03T08:09:10.316Z","updated_at":"2022-08-04T17:54:42.733Z","closed_at":"2020-03-06T21:51:16.652Z","closed_by":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"labels":["Database","priority::2","workflow-infra::Done"],"milestone":{"id":1159113,"iid":69,"group_id":1112072,"title":"W8 DBRE","description":"","state":"closed","created_at":"2020-02-17T07:46:04.317Z","updated_at":"2020-03-02T08:55:22.683Z","due_date":"2020-02-28","start_date":"2020-02-17","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/69"},"assignees":[{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"}],"author":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"type":"ISSUE","assignee":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9096","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9096","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9096/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9096/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9096","relative":"#9096","full":"gitlab-com/gl-infra/reliability#9096"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":106,"epic":{"id":14061,"iid":106,"title":"Upgrade Postgresql to version 11.7 on GitLab.com","url":"/groups/gitlab-com/gl-infra/-/epics/106","group_id":1112072,"human_readable_end_date":"Apr 30, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":30284481,"iid":9095,"project_id":1304532,"title":"Create the template of the migration plan for PostgreSQL Upgrade","description":"Create a similar migration template plan as we did for the Patroni migration.\n\nWe should add :\n- The steps that we will execute.\n- The owners of each task.\n- The pre-checks and post-checks tasks for the migration, and what we will perform in case of failure or unexpected behaviors.\n- The communication needed on each step.","state":"closed","created_at":"2020-02-03T07:55:03.398Z","updated_at":"2022-08-04T17:54:43.443Z","closed_at":"2020-04-02T15:53:41.237Z","closed_by":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"labels":["Database","priority::3","workflow-infra::Done"],"milestone":{"id":1216307,"iid":73,"group_id":1112072,"title":"W14 DBRE","description":"","state":"closed","created_at":"2020-03-30T08:31:20.801Z","updated_at":"2020-04-28T08:58:15.566Z","due_date":"2020-04-10","start_date":"2020-03-30","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/73"},"assignees":[{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"}],"author":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"type":"ISSUE","assignee":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"user_notes_count":4,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9095","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":12,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9095","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9095/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9095/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9095","relative":"#9095","full":"gitlab-com/gl-infra/reliability#9095"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":106,"epic":{"id":14061,"iid":106,"title":"Upgrade Postgresql to version 11.7 on GitLab.com","url":"/groups/gitlab-com/gl-infra/-/epics/106","group_id":1112072,"human_readable_end_date":"Apr 30, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":30284123,"iid":9094,"project_id":1304532,"title":"Capacity Planning for the primary database (closed)","description":"It has been a long time since our last capacity planning, and we would like to verify:\n- How much more load we could add on the primary database without degradation in the performance.\n- We are reaching 60k connections per second. How much could we raise safely?\n- Should we increase disk or memory to optimize performance? Any suggestions in shared buffers setup?\n- Estimate how much % of the load is related to the table merge_requests.\n- Add more topics that you think could be the next bottleneck to scale the availability of our primary database.\n- measure the hot set of data that we use at the moment in memory. How much are we hitting disk. (`pg_buffercache` and the LRU count)","state":"closed","created_at":"2020-02-03T07:42:09.670Z","updated_at":"2022-08-04T17:54:44.133Z","closed_at":"2020-05-10T22:34:15.231Z","closed_by":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"labels":["Database","OnGres::Project","workflow-infra::Done"],"milestone":{"id":1176149,"iid":70,"group_id":1112072,"title":"W10 DBRE","description":"","state":"closed","created_at":"2020-03-02T08:36:37.826Z","updated_at":"2020-03-30T08:30:41.949Z","due_date":"2020-03-13","start_date":"2020-03-02","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/70"},"assignees":[{"id":2493611,"username":"adescoms","name":"Adri√°n Escoms","state":"active","avatar_url":"https://secure.gravatar.com/avatar/d6f86d318669a8b32174b7132607443d?s=80\u0026d=identicon","web_url":"https://gitlab.com/adescoms"},{"id":3007633,"username":"gerardo.herzig","name":"Gerardo Herzig","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3007633/avatar.png","web_url":"https://gitlab.com/gerardo.herzig"},{"id":3715468,"username":"sergio.ostapowicz","name":"Sergio Alejandro Ostapowicz","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3715468/avatar.png","web_url":"https://gitlab.com/sergio.ostapowicz"}],"author":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"type":"ISSUE","assignee":{"id":2493611,"username":"adescoms","name":"Adri√°n Escoms","state":"active","avatar_url":"https://secure.gravatar.com/avatar/d6f86d318669a8b32174b7132607443d?s=80\u0026d=identicon","web_url":"https://gitlab.com/adescoms"},"user_notes_count":23,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2020-04-24","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9094","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":12,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9094","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9094/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9094/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9094","relative":"#9094","full":"gitlab-com/gl-infra/reliability#9094"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":106,"epic":{"id":14061,"iid":106,"title":"Upgrade Postgresql to version 11.7 on GitLab.com","url":"/groups/gitlab-com/gl-infra/-/epics/106","group_id":1112072,"human_readable_end_date":"Apr 30, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":30283479,"iid":9093,"project_id":1304532,"title":"Verify the optimized parameters for PG Upgrade","description":"Our goal is to upgrade our database cluster to PostgreSQL to version 11.6, and we need to verify the optimized setup of parameters of PostgreSQL and Patroni/Consul for our database cluster. \n\nPlease consider the parallelism parameters that we could optimize.\n\nAdd here your thoughts about new parameters or values that we could discuss better.\n\nAlso, check the optimized parameters for the pg_upgrade command that we will execute.\n\nThis task is a top priority since we need to execute this migration until April.","state":"closed","created_at":"2020-02-03T07:18:05.345Z","updated_at":"2021-06-24T08:08:11.799Z","closed_at":"2020-03-26T16:10:18.829Z","closed_by":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"labels":["Database","OnGres::Project","priority::2","workflow-infra::Done"],"milestone":{"id":1195326,"iid":72,"group_id":1112072,"title":"W12 DBRE","description":"","state":"closed","created_at":"2020-03-16T09:44:04.095Z","updated_at":"2020-04-06T02:13:30.558Z","due_date":"2020-03-27","start_date":"2020-03-16","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/72"},"assignees":[{"id":2493611,"username":"adescoms","name":"Adri√°n Escoms","state":"active","avatar_url":"https://secure.gravatar.com/avatar/d6f86d318669a8b32174b7132607443d?s=80\u0026d=identicon","web_url":"https://gitlab.com/adescoms"},{"id":4690884,"username":"asotolongo","name":"Anthony Sotolongo","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4690884/avatar.png","web_url":"https://gitlab.com/asotolongo"}],"author":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"type":"ISSUE","assignee":{"id":2493611,"username":"adescoms","name":"Adri√°n Escoms","state":"active","avatar_url":"https://secure.gravatar.com/avatar/d6f86d318669a8b32174b7132607443d?s=80\u0026d=identicon","web_url":"https://gitlab.com/adescoms"},"user_notes_count":32,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2020-04-02","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9093","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":8,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9093","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9093/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9093/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9093","relative":"#9093","full":"gitlab-com/gl-infra/reliability#9093"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":106,"epic":{"id":14061,"iid":106,"title":"Upgrade Postgresql to version 11.7 on GitLab.com","url":"/groups/gitlab-com/gl-infra/-/epics/106","group_id":1112072,"human_readable_end_date":"Apr 30, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":30249778,"iid":9090,"project_id":1304532,"title":"Write the design doc for the Postgresql upgrade","description":"In this document, we would describe all the steps from the upgrade: \nthe mr is: https://gitlab.com/gitlab-com/www-gitlab-com/-/merge_requests/41495","state":"closed","created_at":"2020-02-02T19:56:39.977Z","updated_at":"2022-08-04T17:54:46.917Z","closed_at":"2020-04-14T07:25:58.055Z","closed_by":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"labels":["Database","priority::3","workflow-infra::Done"],"milestone":{"id":1216307,"iid":73,"group_id":1112072,"title":"W14 DBRE","description":"","state":"closed","created_at":"2020-03-30T08:31:20.801Z","updated_at":"2020-04-28T08:58:15.566Z","due_date":"2020-04-10","start_date":"2020-03-30","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/73"},"assignees":[{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"}],"author":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"type":"ISSUE","assignee":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"user_notes_count":6,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2020-05-29","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9090","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":8,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9090","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9090/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9090/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9090","relative":"#9090","full":"gitlab-com/gl-infra/reliability#9090"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":106,"epic":{"id":14061,"iid":106,"title":"Upgrade Postgresql to version 11.7 on GitLab.com","url":"/groups/gitlab-com/gl-infra/-/epics/106","group_id":1112072,"human_readable_end_date":"Apr 30, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":30231907,"iid":9088,"project_id":1304532,"title":"Create test box to simulate postgresql upgrade","description":"We need a staging box, with the following 2 different versions of postgresql installed :\n\n- PG 9.6 as we have in production\n- PG 11.6 that is the target of our migration\n\n- Please create a box with the same specs as production.\n\nFor this we need :\n\n- [ ] create the new cookbooks needed to complete the task of execute a Postgresql migration\n\nTo execute the initial test : \n\nRestore a backup from staging or execute and restore a dump from the database.\n\nWith this steps we will be able to execute the pg_upgrade.","state":"closed","created_at":"2020-02-02T08:15:51.321Z","updated_at":"2022-08-04T17:54:48.820Z","closed_at":"2020-02-17T07:47:57.281Z","closed_by":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"labels":["Database","team::Reliability","workflow-infra::Done"],"milestone":{"id":1142605,"iid":66,"group_id":1112072,"title":"W6 DBRE","description":"","state":"closed","created_at":"2020-02-02T07:54:53.150Z","updated_at":"2020-03-02T08:54:59.491Z","due_date":"2020-02-14","start_date":"2020-02-03","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/66"},"assignees":[{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"}],"author":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"type":"ISSUE","assignee":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"user_notes_count":11,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2020-02-21","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9088","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":1,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9088","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9088/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9088/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9088","relative":"#9088","full":"gitlab-com/gl-infra/reliability#9088"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":106,"epic":{"id":14061,"iid":106,"title":"Upgrade Postgresql to version 11.7 on GitLab.com","url":"/groups/gitlab-com/gl-infra/-/epics/106","group_id":1112072,"human_readable_end_date":"Apr 30, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":30169532,"iid":9085,"project_id":1304532,"title":"Document the TF and Chef Provisioning and Bootstraping Process in the Runbooks","description":"## SOC Type I Control Remediation Step for VM Provisioning\n\nThe Security Compliance team is preparing for a SOC external audit, see https://gitlab.com/gitlab-com/gl-security/compliance/compliance/issues/1381. And has asked for simple documentation on the build process‚Äìprovisioning and bootstraping‚Äìof servers in our production environment. We perform this workflow with Terraform and Chef, but I'm unable to locate a simple explanation on the process. Perhaps I've overlooked it, but I couldn't find anything in the runbook directory in https://gitlab.com/gitlab-com/gitlab-com-infrastructure that outlines the workflow.\n\n## Definition of Done\n\nIn a Markdown file in the runbooks directory:\n\n- [ ] identify which machine image gets used for VM creation, preferably by pointing to the code\n- [ ] include a workflow diagram that outlines both human and machine interactions with the files and tools that provision and bootstrap the image","state":"closed","created_at":"2020-01-31T21:07:28.506Z","updated_at":"2022-08-04T17:54:51.286Z","closed_at":"2020-02-17T19:39:54.732Z","closed_by":{"id":5096918,"username":"sttruong","name":"Steve Truong","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5096918/avatar.png","web_url":"https://gitlab.com/sttruong"},"labels":["Compliance","workflow-infra::Done"],"milestone":{"id":1089114,"iid":61,"group_id":1112072,"title":"Reliability February 2020","description":"It's a leap year! 29 days this February.","state":"closed","created_at":"2019-12-04T21:56:25.906Z","updated_at":"2020-04-06T19:04:09.864Z","due_date":"2020-02-29","start_date":"2020-02-01","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/61"},"assignees":[{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"}],"author":{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},"type":"ISSUE","assignee":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"user_notes_count":16,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2020-02-05","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9085","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":2,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9085","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9085/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9085/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9085","relative":"#9085","full":"gitlab-com/gl-infra/reliability#9085"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":30168629,"iid":9084,"project_id":1304532,"title":"[blueprint] Postgresql Upgrade","description":"Please create a blueprint for the PostgreSQL upgrade.","state":"closed","created_at":"2020-01-31T20:22:04.547Z","updated_at":"2022-08-04T17:54:51.840Z","closed_at":"2020-04-14T07:25:37.880Z","closed_by":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"labels":["Database","priority::3","workflow-infra::Done"],"milestone":{"id":1216307,"iid":73,"group_id":1112072,"title":"W14 DBRE","description":"","state":"closed","created_at":"2020-03-30T08:31:20.801Z","updated_at":"2020-04-28T08:58:15.566Z","due_date":"2020-04-10","start_date":"2020-03-30","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/73"},"assignees":[{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"}],"author":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"type":"ISSUE","assignee":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"user_notes_count":0,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2020-05-29","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9084","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9084","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9084/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9084/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9084","relative":"#9084","full":"gitlab-com/gl-infra/reliability#9084"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":106,"epic":{"id":14061,"iid":106,"title":"Upgrade Postgresql to version 11.7 on GitLab.com","url":"/groups/gitlab-com/gl-infra/-/epics/106","group_id":1112072,"human_readable_end_date":"Apr 30, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":30152120,"iid":9082,"project_id":1304532,"title":"Prometheus config is not being reloaded on rules change","description":"From slack (while it lasts): https://gitlab.slack.com/archives/CK171RT0F/p1580460508118300\n\n\u003e\u003e\u003e\nSome changes to the runbooks got merged to master last night but didn‚Äôt get picked up by Prometheus. On investigation, the changes has been rolled out to the `rules` directory, but it looks like chef didn‚Äôt tell Prometheus to reload its configuration. \n\nI hupped the process and all is now right in the world‚Ä¶\n\u003e\u003e\u003e\n\nWe should ensure that chef performs a config reload on changes.","state":"closed","created_at":"2020-01-31T12:51:34.715Z","updated_at":"2022-08-04T17:54:53.164Z","closed_at":"2020-02-04T10:46:40.171Z","closed_by":{"id":928230,"username":"bjk-gitlab","name":"Ben Kochie","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/928230/avatar.png","web_url":"https://gitlab.com/bjk-gitlab"},"labels":["Observability-reliability","priority::1","team::Reliability","workflow-infra::Done"],"milestone":null,"assignees":[{"id":928230,"username":"bjk-gitlab","name":"Ben Kochie","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/928230/avatar.png","web_url":"https://gitlab.com/bjk-gitlab"}],"author":{"id":895869,"username":"andrewn","name":"Andrew Newdigate","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/895869/avatar.png","web_url":"https://gitlab.com/andrewn"},"type":"ISSUE","assignee":{"id":928230,"username":"bjk-gitlab","name":"Ben Kochie","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/928230/avatar.png","web_url":"https://gitlab.com/bjk-gitlab"},"user_notes_count":2,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9082","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9082","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9082/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9082/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9082","relative":"#9082","full":"gitlab-com/gl-infra/reliability#9082"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":30126521,"iid":9073,"project_id":1304532,"title":"PagerDuty Services, Escalation Policies, and Users in Terraform","description":"PagerDuty recently published an [article](https://www.pagerduty.com/eng/how-why-terraform) advocating for IaC with PagerDuty objects in Terraform. This is a great idea! Or is it?\n\nThis issue seeks to collect feedback on the pros and cons of doing so, before commiting to putting putting these resources into version control.","state":"closed","created_at":"2020-01-30T19:23:43.565Z","updated_at":"2022-08-04T17:54:58.263Z","closed_at":"2020-09-28T15:41:45.379Z","closed_by":{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},"labels":["Discussion","oncall","team::Reliability","terraform","workflow-infra::Done"],"milestone":null,"assignees":[],"author":{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},"type":"ISSUE","assignee":null,"user_notes_count":5,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9073","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9073","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9073/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9073/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9073","relative":"#9073","full":"gitlab-com/gl-infra/reliability#9073"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":30121574,"iid":9071,"project_id":1304532,"title":"Configure replication in praefect","description":"For this we'll need to create a new storage node and add it to the existing virtual storage. All settings required are already available in omnibus\n\n- [x] terraform changes: https://ops.gitlab.net/gitlab-com/gitlab-com-infrastructure/merge_requests/1353\n- [x] chef-repo changes: https://ops.gitlab.net/gitlab-cookbooks/chef-repo/merge_requests/2576\n\n/cc @johncai","state":"closed","created_at":"2020-01-30T16:20:40.529Z","updated_at":"2022-08-04T17:54:59.477Z","closed_at":"2020-01-30T20:28:26.600Z","closed_by":{"id":367626,"username":"alejandro","name":"Alejandro Rodr√≠guez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"},"labels":["workflow-infra::Done"],"milestone":null,"assignees":[{"id":367626,"username":"alejandro","name":"Alejandro Rodr√≠guez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"}],"author":{"id":367626,"username":"alejandro","name":"Alejandro Rodr√≠guez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"},"type":"ISSUE","assignee":{"id":367626,"username":"alejandro","name":"Alejandro Rodr√≠guez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9071","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":2,"completed_count":2},"weight":3,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9071","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9071/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9071/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9071","relative":"#9071","full":"gitlab-com/gl-infra/reliability#9071"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":199,"epic":{"id":14582,"iid":199,"title":"HA Gitaly on GitLab.com","url":"/groups/gitlab-com/-/epics/199","group_id":6543,"human_readable_end_date":"Jan 31, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":30120782,"iid":9069,"project_id":1304532,"title":"Error check on querying the gitlab.com replica","description":"I'm trying to debug why our extract for certain tables is failing from the gitlab.com replica. We're trying to query the `resource_label_events` table and it seems like something is killing the job. I can't tell if it's a timeout on the postgres side or something on our side. \n\nThe latest query was between these times UTC:\n\n```\n[2020-01-29 23:08:01,384] INFO - b'INFO:root:SELECT id , action , issue_id , merge_request_id , epic_id , label_id , user_id , created_at , cached_markdown_version , reference , reference_html FROM resource_label_events\\n'\n[2020-01-29 23:08:01,384] INFO - b' \\n'\n[2020-01-29 23:14:13,961] INFO - Event: gitlab-com-db-scd-5c81df55 had an event of type Failed\n```\n\nMaybe it's related to something like https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/7769 ?\n\n@Finotto would you be able to provide some guidance / insight here?\n\nHappy to provide whatever information I need on my end.","state":"closed","created_at":"2020-01-30T15:54:34.575Z","updated_at":"2022-08-04T17:55:00.705Z","closed_at":"2020-02-18T14:26:26.853Z","closed_by":{"id":1942272,"username":"tayloramurphy","name":"Taylor A Murphy","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1942272/avatar.png","web_url":"https://gitlab.com/tayloramurphy"},"labels":["Database","workflow-infra::Done"],"milestone":{"id":1159113,"iid":69,"group_id":1112072,"title":"W8 DBRE","description":"","state":"closed","created_at":"2020-02-17T07:46:04.317Z","updated_at":"2020-03-02T08:55:22.683Z","due_date":"2020-02-28","start_date":"2020-02-17","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/69"},"assignees":[],"author":{"id":1942272,"username":"tayloramurphy","name":"Taylor A Murphy","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1942272/avatar.png","web_url":"https://gitlab.com/tayloramurphy"},"type":"ISSUE","assignee":null,"user_notes_count":8,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2020-02-21","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9069","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9069","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9069/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9069/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9069","relative":"#9069","full":"gitlab-com/gl-infra/reliability#9069"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":30027952,"iid":9056,"project_id":1304532,"title":"Monitor and alert on Elastic logging cluster SLOs","description":"We should define SLOs for the key SLIs and implement monitoring and alerting:\n\n* Query latency\n* Availability\n* Query error rate\n* Delay of log visibility\n* Completeness of logs","state":"closed","created_at":"2020-01-28T14:39:44.473Z","updated_at":"2022-08-04T17:55:17.402Z","closed_at":"2020-06-26T15:48:56.763Z","closed_by":{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},"labels":["Observability-reliability","Service::Logging","priority::1","workflow-infra::Done"],"milestone":{"id":1249008,"iid":81,"group_id":1112072,"title":"Observability Team - W25 2020","description":"## Calendar\r\n\r\n|             | M 15 Jun | T 16 Jun | W 17 Jun | Th 18 Jun  | F 19 Jun\r\n|-------------|----------|----------|----------|----------- |----------\r\n| @bjk-gitlab | - | - | - | - | -\r\n| @cindy | - | - | - | - | -\r\n| @craigf | :pager: | :wrench: | :wrench: | :wrench: | :wrench: \r\n| @igorwwwwwwwwwwwwwwwwwwww | - | - | - | - | -\r\n| @msmiley | - | - | - | - | -\r\n| @mwasilewski-gitlab | - | - | - | - | üßòüèª‚Äç‚ôÇÔ∏è\r\n\r\nW25 working days: 24\r\n\r\n|             | M 22 Jun | T 23 Jun | W 24 Jun | Th 25 Jun  | F 26 Jun\r\n|-------------|----------|----------|----------|----------- |----------\r\n| @bjk-gitlab | - | - | - | - | -\r\n| @cindy | - | - | - | - | -\r\n| @craigf | :sun_with_face: | :palm_tree: | - | - | -\r\n| @igorwwwwwwwwwwwwwwwwwwww | - | - | - | - | -\r\n| @msmiley | :palm_tree: | :palm_tree: | :palm_tree: | :palm_tree: | :palm_tree: \r\n| @mwasilewski-gitlab | - | - | - | - | -\r\n\r\nW26 working days: 24\r\n\r\n\u003chr\u003e\r\n\r\n**Total working days: 48**","state":"closed","created_at":"2020-04-20T20:18:41.941Z","updated_at":"2020-06-30T19:07:01.642Z","due_date":"2020-06-26","start_date":"2020-06-15","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/81"},"assignees":[],"author":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"type":"ISSUE","assignee":null,"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9056","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":8,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9056","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9056/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9056/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9056","relative":"#9056","full":"gitlab-com/gl-infra/reliability#9056"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":157,"epic":{"id":18244,"iid":157,"title":"SLO Alerts for Elastic Search","url":"/groups/gitlab-com/gl-infra/-/epics/157","group_id":1112072,"human_readable_end_date":"Aug 7, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":30027585,"iid":9055,"project_id":1304532,"title":"Consider to backup Elastic visualizations and dashboards","description":"We are not keeping kibana visualizations or dashboards in version control, as they are mainly created via UI.\nWe should consider if it makes sense to export those visualization and dashboard configurations regularly to be able to restore them if needed.","state":"closed","created_at":"2020-01-28T14:30:31.129Z","updated_at":"2022-08-04T17:55:18.009Z","closed_at":"2020-02-05T12:10:36.640Z","closed_by":{"id":506061,"username":"ahmadsherif","name":"Ahmad Sherif","state":"active","avatar_url":"https://secure.gravatar.com/avatar/bd6d0ec4213b91601956c9f801cbfe9b?s=80\u0026d=identicon","web_url":"https://gitlab.com/ahmadsherif"},"labels":["Observability-reliability","Service::Logging","backup","team::Reliability","workflow-infra::Done"],"milestone":{"id":1089114,"iid":61,"group_id":1112072,"title":"Reliability February 2020","description":"It's a leap year! 29 days this February.","state":"closed","created_at":"2019-12-04T21:56:25.906Z","updated_at":"2020-04-06T19:04:09.864Z","due_date":"2020-02-29","start_date":"2020-02-01","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/61"},"assignees":[{"id":506061,"username":"ahmadsherif","name":"Ahmad Sherif","state":"active","avatar_url":"https://secure.gravatar.com/avatar/bd6d0ec4213b91601956c9f801cbfe9b?s=80\u0026d=identicon","web_url":"https://gitlab.com/ahmadsherif"}],"author":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"type":"ISSUE","assignee":{"id":506061,"username":"ahmadsherif","name":"Ahmad Sherif","state":"active","avatar_url":"https://secure.gravatar.com/avatar/bd6d0ec4213b91601956c9f801cbfe9b?s=80\u0026d=identicon","web_url":"https://gitlab.com/ahmadsherif"},"user_notes_count":1,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9055","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9055","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9055/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9055/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9055","relative":"#9055","full":"gitlab-com/gl-infra/reliability#9055"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":135,"epic":{"id":16081,"iid":135,"title":"Switch production to 7.X","url":"/groups/gitlab-com/gl-infra/-/epics/135","group_id":1112072,"human_readable_end_date":"Feb 7, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":30025393,"iid":9054,"project_id":1304532,"title":"Add alerts for fluentd","description":"We should be alerted if fluentd fails to forward messages.\n\npossible metrics to watch:\n* `sum(fluentd_output_status_buffer_total_bytes{env=\"gprd\"}) by (fqdn,type)`\n\nrelated to https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/7939","state":"closed","created_at":"2020-01-28T13:39:26.517Z","updated_at":"2022-08-04T17:55:18.619Z","closed_at":"2021-02-16T22:15:33.658Z","closed_by":{"id":3623028,"username":"cmiskell","name":"Craig Miskell","state":"active","avatar_url":"https://secure.gravatar.com/avatar/852a93b505b1f4a5549595792035f445?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmiskell"},"labels":["Observability-reliability","Service::Logging","workflow-infra::Done"],"milestone":null,"assignees":[],"author":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"type":"ISSUE","assignee":null,"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9054","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9054","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9054/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9054/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9054","relative":"#9054","full":"gitlab-com/gl-infra/reliability#9054"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":190,"epic":{"id":26692,"iid":190,"title":"SLIs for Elasticsearch","url":"/groups/gitlab-com/gl-infra/-/epics/190","group_id":1112072},"iteration":null,"health_status":null},{"id":30004127,"iid":9048,"project_id":1304532,"title":"Allow Rate Limiting Specific URL's","description":"Currently, there is not a straightforward way to rate limit access to specific URL's.  We can either allow a URL or block it.  It would be very useful to be able to set limits on how many times per minute a single client can request a URL, or how many times per minute a URL can be requested in total.  A flexible way to specify this would add significantly to the site's resilience.\n\n## Wishlist\n\n- It would be nice to be able to specify a URL regex, for example to rate limit all `*.zip` files.\n- It would be nice to be able to rate limit groups of users differently, including unauthenticated users\n- It would be nice to be able to rate limit IP's and CIDR ranges separately from users.\n- It would be nice to be able to limit on other criteria such as User-Agent\n\n## Things to consider\n\n- Some larger organizations will be behind NAT's and all users will appear to be from the same IP\n- Cloudflare may appear to make a lot of requests from the same IP, so we'll need to be able to differentiate the proxy server from the end user\n- A DDoS may be distributed, and may appear to come from many IP's.  We should still have a way to set a high threshold for how many times a specific URL can be requested at all.  This should be much higher than the single IP threshold\n- We should be careful not to limit internal components such as sidekiq inadvertently\n\n## Related things\n\n- Here is an incident that this would have prevented: https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/9047\n- Here is some related work happening in the product: https://gitlab.com/gitlab-org/gitlab/issues/30829\n- Here is a related corrective action for API rate limiting: https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/6645","state":"closed","created_at":"2020-01-28T05:41:08.946Z","updated_at":"2022-08-04T17:55:22.017Z","closed_at":"2021-06-24T08:10:28.388Z","closed_by":{"id":1786152,"username":"gitlab-bot","name":"ü§ñ GitLab Bot ü§ñ","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1786152/avatar.png","web_url":"https://gitlab.com/gitlab-bot"},"labels":["corrective action","severity::4","workflow-infra::Done"],"milestone":null,"assignees":[],"author":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"type":"ISSUE","assignee":null,"user_notes_count":5,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9048","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9048","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9048/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9048/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9048","relative":"#9048","full":"gitlab-com/gl-infra/reliability#9048"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":289,"epic":{"id":88204,"iid":289,"title":"Cloudflare Automation Implementation","url":"/groups/gitlab-com/gl-infra/-/epics/289","group_id":1112072,"human_readable_end_date":"Sep 30, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":29895201,"iid":9024,"project_id":1304532,"title":"Replace staging certificate in Cloudflare","description":"The certificate for `staging.gitlab.com` has been updated in the GKMS vault and on the servers.  The key was updated as well. https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/8965\n\nThere is a copy of this cert and key in Cloudflare which is still the old version.\n\nThe new certificate is:\n```console\n$ openssl s_client -connect geo.staging.gitlab.com:443 \u003c /dev/null 2\u003e/dev/null | openssl x509 -fingerprint -noout -in /dev/stdin\nSHA1 Fingerprint=7A:E2:52:DB:CB:40:B5:D1:E8:2F:CF:C6:74:23:DF:90:41:76:91:3F\n```\n\nThe cert and key are in the `gitlab-omnibus-secrets-geo gstg` GKMS vault. They can be retrieved like this:\n\n```\n./gkms-vault-show gitlab-omnibus-secrets-geo gstg | jq -r '.\"omnibus-gitlab\".ssl.certificate' | gsed 's/\\\\\\n/\\n/g'\n```\nand\n```\n./gkms-vault-show gitlab-omnibus-secrets-geo gstg | jq -r '.\"omnibus-gitlab\".ssl.private_key' | gsed 's/\\\\\\n/\\n/g'\n```\n\nThe Cloudflare cert and key need to be updated to the new version of the cert and key.","state":"closed","created_at":"2020-01-23T20:11:20.569Z","updated_at":"2020-01-29T14:48:18.232Z","closed_at":"2020-01-29T13:14:02.862Z","closed_by":{"id":555989,"username":"T4cC0re","name":"Hendrik Meyer","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/555989/avatar.png","web_url":"https://gitlab.com/T4cC0re"},"labels":["team::Reliability","workflow-infra::Done"],"milestone":{"id":1087804,"iid":60,"group_id":1112072,"title":"Reliability January 2020","description":"","state":"closed","created_at":"2019-12-03T16:29:27.112Z","updated_at":"2020-01-31T23:02:22.156Z","due_date":"2020-01-31","start_date":"2020-01-01","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/60"},"assignees":[{"id":555989,"username":"T4cC0re","name":"Hendrik Meyer","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/555989/avatar.png","web_url":"https://gitlab.com/T4cC0re"}],"author":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"type":"ISSUE","assignee":{"id":555989,"username":"T4cC0re","name":"Hendrik Meyer","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/555989/avatar.png","web_url":"https://gitlab.com/T4cC0re"},"user_notes_count":5,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9024","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9024","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9024/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9024/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9024","relative":"#9024","full":"gitlab-com/gl-infra/reliability#9024"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":29863428,"iid":9007,"project_id":1304532,"title":"Scale up praefect nodes for more CPU cores","description":"On https://gitlab.com/gitlab-org/gitaly/issues/2348#note_275054258 it was established that the periodical CPU spikes we're seeing in praefect nodes are actually caused by chef-client runs, and it was suggested that increasing the CPU core count could mitigate this problem. Let's change from `n1-standard-1` to `n1-standard-2`.","state":"closed","created_at":"2020-01-22T20:12:55.052Z","updated_at":"2022-08-04T17:55:48.977Z","closed_at":"2020-01-22T20:34:39.546Z","closed_by":{"id":367626,"username":"alejandro","name":"Alejandro Rodr√≠guez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"},"labels":["workflow-infra::Done"],"milestone":null,"assignees":[{"id":367626,"username":"alejandro","name":"Alejandro Rodr√≠guez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"}],"author":{"id":367626,"username":"alejandro","name":"Alejandro Rodr√≠guez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"},"type":"ISSUE","assignee":{"id":367626,"username":"alejandro","name":"Alejandro Rodr√≠guez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/9007","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/9007","notes":"https://gitlab.com/api/v4/projects/1304532/issues/9007/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/9007/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#9007","relative":"#9007","full":"gitlab-com/gl-infra/reliability#9007"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":199,"epic":{"id":14582,"iid":199,"title":"HA Gitaly on GitLab.com","url":"/groups/gitlab-com/-/epics/199","group_id":6543,"human_readable_end_date":"Jan 31, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":29826208,"iid":8995,"project_id":1304532,"title":"Split out secrets for geo secondary in staging","description":"The Geo Secondary node in staging currently uses the same `gitlab-omnibus-secrets` file as the rest of the environment.  In some cases this is fine, but in cases like the redis server, we want to not configure secrets and use the local omnibus instance.  This doesn't work with secrets configured because Chef assumes that if we have them, we must want to use them.\n\nThe proposal (https://gitlab.com/gitlab-org/gitlab/issues/37926#note_274534850) is:\n\n- Change the chef configuration for that node to use a different secrets file here: https://ops.gitlab.net/gitlab-cookbooks/chef-repo/blob/master/roles/gstg-infra-geo-secondary.json#L36\n- Then delete secrets from that new file which we don't want applied to the node\n- Cange any other secrets which shouldn't be the same (This is probably out of scope for this issue)\n\n/cc @craigf @dbalexandre","state":"closed","created_at":"2020-01-22T00:42:30.621Z","updated_at":"2021-06-24T08:08:13.931Z","closed_at":"2020-01-23T01:43:04.585Z","closed_by":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"labels":["Geo","chef","workflow-infra::Done"],"milestone":null,"assignees":[{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},{"id":3911656,"username":"craigf","name":"Craig Furman","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3911656/avatar.png","web_url":"https://gitlab.com/craigf"}],"author":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"type":"ISSUE","assignee":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"user_notes_count":6,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/8995","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/8995","notes":"https://gitlab.com/api/v4/projects/1304532/issues/8995/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/8995/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#8995","relative":"#8995","full":"gitlab-com/gl-infra/reliability#8995"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":29824453,"iid":8994,"project_id":1304532,"title":"Write a runbook which documents qa-tunnel.gitlab.info","description":"Write a runbook which documents qa-tunnel.gitlab.info.","state":"closed","created_at":"2020-01-21T22:10:07.796Z","updated_at":"2022-08-04T17:55:56.911Z","closed_at":"2021-06-16T18:25:06.543Z","closed_by":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"labels":["auto updated","runbook","workflow-infra::Done"],"milestone":null,"assignees":[{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"}],"author":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"type":"ISSUE","assignee":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"user_notes_count":4,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/8994","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/8994","notes":"https://gitlab.com/api/v4/projects/1304532/issues/8994/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/8994/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#8994","relative":"#8994","full":"gitlab-com/gl-infra/reliability#8994"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":29772770,"iid":8978,"project_id":1304532,"title":"Add fluentd and pubsub graphs to logging dashboard","description":"On our [logging dashboard](https://dashboards.gitlab.net/d/USVj3qHmk/logging?orgId=1\u0026refresh=30s\u0026from=now-3h\u0026to=now) we don't have graphs for fluentd and no bandwidth data for logs in stackdriver and pubsub.","state":"closed","created_at":"2020-01-20T16:18:32.504Z","updated_at":"2020-01-20T18:42:37.673Z","closed_at":"2020-01-20T17:19:35.040Z","closed_by":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"labels":["Observability","Service::Stackdriver","logging","team::Reliability","workflow-infra::Done"],"milestone":{"id":1087804,"iid":60,"group_id":1112072,"title":"Reliability January 2020","description":"","state":"closed","created_at":"2019-12-03T16:29:27.112Z","updated_at":"2020-01-31T23:02:22.156Z","due_date":"2020-01-31","start_date":"2020-01-01","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/60"},"assignees":[{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"}],"author":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"type":"ISSUE","assignee":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/8978","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/8978","notes":"https://gitlab.com/api/v4/projects/1304532/issues/8978/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/8978/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#8978","relative":"#8978","full":"gitlab-com/gl-infra/reliability#8978"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":135,"epic":{"id":16081,"iid":135,"title":"Switch production to 7.X","url":"/groups/gitlab-com/gl-infra/-/epics/135","group_id":1112072,"human_readable_end_date":"Feb 7, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":29756649,"iid":8970,"project_id":1304532,"title":"Create a read replica of the license and customers  database for analytics queries","description":"The data team needs a read replica of the license and customers database for the purposes of reporting within Snowflake.\n\nAs this is done in CloudSQL it should be pretty quick to spin up a new one. The only thing we'd need is similar VPC peering like we have with the production replica so we can connect directly to it.","state":"closed","created_at":"2020-01-20T09:57:37.151Z","updated_at":"2022-08-04T17:56:21.513Z","closed_at":"2020-01-23T20:44:44.401Z","closed_by":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"labels":["Database","workflow-infra::Done"],"milestone":null,"assignees":[{"id":2222520,"username":"dawsmith","name":"Dave Smith","state":"active","avatar_url":"https://secure.gravatar.com/avatar/ef341e061f6b86461626e64c5fbcfe52?s=80\u0026d=identicon","web_url":"https://gitlab.com/dawsmith"},{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"}],"author":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"type":"ISSUE","assignee":{"id":2222520,"username":"dawsmith","name":"Dave Smith","state":"active","avatar_url":"https://secure.gravatar.com/avatar/ef341e061f6b86461626e64c5fbcfe52?s=80\u0026d=identicon","web_url":"https://gitlab.com/dawsmith"},"user_notes_count":11,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2020-02-14","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/8970","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/8970","notes":"https://gitlab.com/api/v4/projects/1304532/issues/8970/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/8970/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#8970","relative":"#8970","full":"gitlab-com/gl-infra/reliability#8970"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":29715262,"iid":8965,"project_id":1304532,"title":"Configure External Access for geo.staging.gitlab.com","description":"In order to work with the geo secondary instance, we need to be able to get to the admin interface. https://gitlab.com/gitlab-org/gitlab/issues/37926\nI have tried a few different approaches to this.\n\n- Using our existing haproxy is dangerous, since it requires major changes to the template used by all instances (including production) in order for haproxy to proxy requests for geo.staging.gitlab.com to the geo-staging instance.\n- Using a GCP load balancer is a little heavy handed since we only have one backend, but I tried it.  I discovered that we would have to change the module type that we use to provision the geo-staging instance from generic-store to generic-sv-with-group - or write a whole new module. This is in addition to adding individual resources for health checks, backends, url_maps's and various other things.  Writing a whole new module is the right way to do this, but that's too much work for a one off which will only be used for development work.\n- Provisioning an external IP address and creating a firewall rule to allow access directly to this node.  This is what I'm going with for the moment, since it is the simplest and there is no need for anything more complicated.  This will get us unblocked and we can revisit it in the future.\n\nTo provision the external address we need:\n\n- A static external IP associated with the node\n- A Firewall rule allowing this access to the node\n- A DNS entry\n- A certificate or SAN for SSL connections to the interface","state":"closed","created_at":"2020-01-17T21:20:03.261Z","updated_at":"2022-08-04T17:56:34.995Z","closed_at":"2020-01-21T23:54:50.586Z","closed_by":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"labels":["Service::Geo","unblocks others","workflow-infra::Done"],"milestone":null,"assignees":[{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"}],"author":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"type":"ISSUE","assignee":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"user_notes_count":4,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/8965","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/8965","notes":"https://gitlab.com/api/v4/projects/1304532/issues/8965/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/8965/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#8965","relative":"#8965","full":"gitlab-com/gl-infra/reliability#8965"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null}]