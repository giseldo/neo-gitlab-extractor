[{"id":24515650,"iid":7796,"project_id":1304532,"title":"Upgrade Patroni to 1.5.6","description":"The below notes were copied from [here](https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/7790#note_213228185):\n\nThe [Patroni release notes for 1.5.6](https://patroni.readthedocs.io/en/latest/releases.html#version-1-5-6) cite a bug fix that allows health checks to Patroni to not be blocked by Patroni's potentially slow call to `get_cluster` (which is what most often stalls when Consul agent cannot promptly talk to Consul server).\n\n\u003e Reduce lock time taken by dcs.get_cluster method (Alexander)\n\u003e\n\u003e Due to the lock being held DCS slowness was affecting the REST API health checks causing false positives.\n\nThis [bug fix](https://github.com/zalando/patroni/commit/680444ae13154aca6f03556cdd1280e296b549ca) alone should help avoid *some* of the cases of unnecessary Patroni failover. The Patroni agent was sometimes slow to respond to incoming health check requests because it was holding an internal lock while running a REST call to Consul agent (which can be slow). This bug fix avoids that contention most of the time by waiting to take that lock until after the REST call to Consul finishes (and also by caching the results for up to TTL seconds).\n\nThis does not address all of our concerns (e.g. slow calls to Consul can still lead to the Patroni cluster lock expiring), so we should probably still increase Patroni's DCS `ttl` setting in addition to this upgrade.\n\n---\n\nBe sure to review all of the release notes between our current Patroni release (1.5.0) and the target release (1.5.6).\n\nConfirm that Patroni cluster can run safely in mixed mode, with some members using 1.5.0 and others using 1.5.6.\n\nRun through functional testing.\n\nPlan to deploy in `gstg` and then `gprd`.","state":"closed","created_at":"2019-09-06T00:12:38.730Z","updated_at":"2021-06-24T08:09:05.237Z","closed_at":"2019-09-23T10:08:05.843Z","closed_by":{"id":2493611,"username":"adescoms","name":"Adri√°n Escoms","state":"active","avatar_url":"https://secure.gravatar.com/avatar/d6f86d318669a8b32174b7132607443d?s=80\u0026d=identicon","web_url":"https://gitlab.com/adescoms"},"labels":["Database","OnGres::Project","priority::1","workflow-infra::Done"],"milestone":null,"assignees":[{"id":3007633,"username":"gerardo.herzig","name":"Gerardo Herzig","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3007633/avatar.png","web_url":"https://gitlab.com/gerardo.herzig"}],"author":{"id":3947902,"username":"msmiley","name":"Matt Smiley","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3947902/avatar.png","web_url":"https://gitlab.com/msmiley"},"type":"ISSUE","assignee":{"id":3007633,"username":"gerardo.herzig","name":"Gerardo Herzig","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3007633/avatar.png","web_url":"https://gitlab.com/gerardo.herzig"},"user_notes_count":10,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":"2019-09-20","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7796","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7796","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7796/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7796/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7796","relative":"#7796","full":"gitlab-com/gl-infra/reliability#7796"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2,"epic":{"id":1050,"iid":2,"title":"Postgres DB Availability work","url":"/groups/gitlab-com/gl-infra/-/epics/2","group_id":1112072,"human_readable_end_date":"May 8, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":24515597,"iid":7795,"project_id":1304532,"title":"Increase Patroni's patience when talking with Consul","description":"Increase Patroni's DCS settings for `retry_timeout` (currently 10 seconds) and `ttl` (currently 30 seconds).\n\nThe rationale is described here:\nhttps://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/7790#note_213228185\n\nAnd remember that `ttl` is silently halved by Patroni before being sent to Consul.\n\nThe `ttl` should probably be several times as large as the `retry_timeout`.\n\nNote: The `loop_wait` setting (currently 10 seconds) may be ok to leave as-is, even though we are increasing the other settings.  `loop_wait` is roughly how long Patroni waits passively for notification from Consul of a cluster state change before it starts another round of pushing its own status updates to Consul and renewing its Consul session TTL.  The configured `ttl` must be significantly larger than both `loop_wait` and `retry_timeout`.","state":"closed","created_at":"2019-09-06T00:04:26.437Z","updated_at":"2020-03-13T23:09:26.973Z","closed_at":"2020-03-13T22:16:00.336Z","closed_by":{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},"labels":["Database","OnGres::Project","team::Reliability","workflow-infra::Done"],"milestone":{"id":995576,"iid":42,"group_id":1112072,"title":"Dev \u0026 Ops: 2019-09-09 - 2019-09-22","description":"","state":"closed","created_at":"2019-09-09T14:46:08.050Z","updated_at":"2019-09-23T09:43:07.078Z","due_date":"2019-09-22","start_date":"2019-09-09","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/42"},"assignees":[{"id":3947902,"username":"msmiley","name":"Matt Smiley","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3947902/avatar.png","web_url":"https://gitlab.com/msmiley"}],"author":{"id":3947902,"username":"msmiley","name":"Matt Smiley","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3947902/avatar.png","web_url":"https://gitlab.com/msmiley"},"type":"ISSUE","assignee":{"id":3947902,"username":"msmiley","name":"Matt Smiley","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3947902/avatar.png","web_url":"https://gitlab.com/msmiley"},"user_notes_count":16,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7795","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7795","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7795/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7795/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7795","relative":"#7795","full":"gitlab-com/gl-infra/reliability#7795"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2,"epic":{"id":1050,"iid":2,"title":"Postgres DB Availability work","url":"/groups/gitlab-com/gl-infra/-/epics/2","group_id":1112072,"human_readable_end_date":"May 8, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":24515528,"iid":7794,"project_id":1304532,"title":"Stop aborting pg_rewind during Patroni failover","description":"The `statement_timeout` setting should not be applied to the Postgres user account used by `pg_rewind`. This consistently aborts the conversion of the old primary db into a replica after failover. Making that one configuration change could avoid a significant amount of toil (i.e. replacing or rebuilding the old primary node as a fresh replica).","state":"closed","created_at":"2019-09-05T23:56:40.841Z","updated_at":"2022-08-05T04:03:01.998Z","closed_at":"2019-09-10T00:24:06.541Z","closed_by":{"id":3947902,"username":"msmiley","name":"Matt Smiley","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3947902/avatar.png","web_url":"https://gitlab.com/msmiley"},"labels":["workflow-infra::Done"],"milestone":null,"assignees":[],"author":{"id":3947902,"username":"msmiley","name":"Matt Smiley","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3947902/avatar.png","web_url":"https://gitlab.com/msmiley"},"type":"ISSUE","assignee":null,"user_notes_count":4,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2019-09-11","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7794","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7794","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7794/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7794/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7794","relative":"#7794","full":"gitlab-com/gl-infra/reliability#7794"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":24505303,"iid":7790,"project_id":1304532,"title":"Why are patroni failovers occurring so often","description":"**Problem statement:**\n\nPatroni failover events are expensive and are occurring much more frequently than expected.  While a failover is in progress, the read-only replica databases remain available, but the writable primary database is unavailable.  This causes all upstream clients to fail any task that requires any interaction with the primary database.  For most purposes, GitLab.com is effectively unavailable during this time.\n\nPatroni's failover mechanism is crucial for maintaining high availability of our writable Postgres database, providing efficient and reliable return to service when the writable instance fails or becomes unreachable by its many clients.  However, *unnecessary* failover events harm availability (typically cause 1-3 minutes of downtime) and require hours of manual clean-up and analysis.\n\n**Goal:**\n\nReduce the rate of unnecessary failover events, to improve availability and avoid toil.\n\nDiscover what triggers the recent Patroni failover events, and propose options to avoid them without sacrificing too much ability to detect and respond to events that really do necessitate failover.\n\n**Non-goals:**\n\nReducing the amount of toil associated with failover events is a separate and also desirable goal, but will not be addressed here, except for one point:\n* The `statement_timeout` setting should not be applied to the Postgres user account used by `pg_rewind`.  This consistently aborts the conversion of the old primary into a replica after failover.  Making that one configuration change could avoid a significant amount of toil (i.e. replacing or rebuilding the old primary node as a fresh replica).\n\nReducing the duration of downtime during a failover event is a separate and also desirable goal, but tuning that is not expected to yield significant improvement.  The downtime duration consists of 3 phases:\n* *Failure detection time:* Time between an actual failure and its detection is mainly affected by the health checks' frequency, timeouts, and scope.  Tuning failure detection to be more aggressive can sometimes lead to higher false-positive rate.  That appears to be the case currently, so reducing our currently high false-positive rate may require increasing the time to detect actual failures.  To the best of my knowledge, currently Patroni's failure detection time is at most 40 seconds (`loop_delay` + `ttl`).\n* *Leader election:* Patroni's leader election process includes a mandatory delay to let the replicas apply as much of the old primary's transactions as possible from the WAL stream.  Then the freshest healthy replica is elected to become the new primary.  The Postgres timeline is forked, and all other replicas are asked to switch to the new timeline and start consuming new transactions from the new primary.\n* *Reconvergence:* Clients must reconnect to the new postgres primary db.  This time is already quite small because all clients connect to the writable primary postgres instance via a proxy (`pgbouncer`).  Only those handful of `pgbouncer` instances must actually reconnect to Patroni's new primary Postgres db.\n\n**Background:**\n\nIn the last couple months Patroni has several times initiated failover of the writable primary Postgres node.  Most of those failovers appear to have been unnecessary, at least judging from the availability metrics for GitLab.com prior to failover.\n\n**Prior work:**\n\nFor reference, here are some (but not necessarily all) of the Patroni failover events we investigated:\n* [2019-07-17 failover from patroni-01 to patroni-04](https://gitlab.com/gitlab-com/gl-infra/production/issues/968) and its [RCA issue](https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/7275)\n* [2019-08-14 failover from patroni-01 to patroni-04](https://gitlab.com/gitlab-com/gl-infra/production/issues/1054) and its [RCA issue](https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/7573)\n* [2019-08-27 failover from patroni-07 to patroni-10](https://gitlab.com/gitlab-com/gl-infra/production/issues/1094) and its [RCA issue](https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/7737)\n* [2019-09-03 failover from patroni-10 to patroni-11](https://gitlab.com/gitlab-com/gl-infra/production/issues/1119) and its [RCA issue](https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/7767)\n\nSeveral people have independently observed that Patroni failovers are triggered by timeouts during Patroni agent's call to its local Consul agent.  Those timeouts are most often observed in Patroni's `get_cluster` method, which makes the Patroni loop's 1st of 4 REST calls to the local Consul agent.  What causes those timeouts is not yet clear, although several ideas have been proposed, including (but not limited to):\n* ephemeral network packet loss, either in general or along the path of consul agent's connection to a consul server\n* kernel memory pressure delaying TCP receives\n* consul servers undergoing leader election\n\nAt least one failover (on [2019-09-03](https://gitlab.com/gitlab-com/gl-infra/production/issues/1119)) showed that around the time of the failover, the current Patroni lost its cluster lock -- its consul \"session\" (mutex) was invalidated.  This, too, can be a side-effect of brief interruption between consul agent and consul server, since the \"consul session\" (which implements the Patroni cluster lock) automatically expires (unlocks the cluster) if not renewed every 15 seconds.  Patroni only attempts to renew this session every 10 seconds, so a 5 second delay leads to lock expiry.","state":"closed","created_at":"2019-09-05T17:28:32.755Z","updated_at":"2020-04-21T01:24:16.822Z","closed_at":"2019-10-03T15:59:13.827Z","closed_by":{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},"labels":["Discussion","Investigation","OnGres::Support","team::Reliability","workflow-infra::Done"],"milestone":null,"assignees":[{"id":3947902,"username":"msmiley","name":"Matt Smiley","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3947902/avatar.png","web_url":"https://gitlab.com/msmiley"}],"author":{"id":3947902,"username":"msmiley","name":"Matt Smiley","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3947902/avatar.png","web_url":"https://gitlab.com/msmiley"},"type":"ISSUE","assignee":{"id":3947902,"username":"msmiley","name":"Matt Smiley","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3947902/avatar.png","web_url":"https://gitlab.com/msmiley"},"user_notes_count":23,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7790","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7790","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7790/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7790/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7790","relative":"#7790","full":"gitlab-com/gl-infra/reliability#7790"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2,"epic":{"id":1050,"iid":2,"title":"Postgres DB Availability work","url":"/groups/gitlab-com/gl-infra/-/epics/2","group_id":1112072,"human_readable_end_date":"May 8, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":24505297,"iid":7789,"project_id":1304532,"title":"We've lost a few custom metric rules since the GKE migration for the Container Registry","description":"Since the migration to GKE a few metrics no longer work as the recording rule is invalid.\n\nImpacted metrics:\n* `gitlab_component_availability:ratio{type=\"registry\"}`\n* `slo:min:gitlab_service_apdex:ratio`\n* `gitlab_service_apdex:ratio`\n\nThis situation has caused a loss of visibility into some panels on this dashboard: https://dashboards.gitlab.net/d/general-service/general-service-platform-metrics?orgId=1\u0026var-type=registry  And we've triggered a few alerts that look at this data.\n\nUtilize this issue to find new recording rules for these metrics and ensure all panels on the aforementioned dashboard are working.","state":"closed","created_at":"2019-09-05T17:27:59.936Z","updated_at":"2022-08-05T04:03:05.616Z","closed_at":"2019-09-19T13:40:05.818Z","closed_by":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"labels":["Service::Container Registry","auto updated","kubernetes","team::Delivery","workflow-infra::Done"],"milestone":null,"assignees":[{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"}],"author":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"type":"ISSUE","assignee":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"user_notes_count":9,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7789","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7789","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7789/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7789/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7789","relative":"#7789","full":"gitlab-com/gl-infra/reliability#7789"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":85,"epic":{"id":11045,"iid":85,"title":"Items to complete after transitioning GitLab.com Container Registry from Virtual Machines to GKE Pods","url":"/groups/gitlab-com/gl-infra/-/epics/85","group_id":1112072},"iteration":null,"health_status":null},{"id":24497368,"iid":7787,"project_id":1304532,"title":"Create database for GKE Grafana service","description":"Currently we store Grafana dashboards and other configuration (`dashboards.gitlab.net`) locally in a sqlite database.\n\n* [x] Create a cloud hosted database.\n* [ ] Sync data from old Grafana to new.","state":"closed","created_at":"2019-09-05T13:44:32.827Z","updated_at":"2022-08-05T04:03:06.578Z","closed_at":"2021-08-18T04:29:59.892Z","closed_by":{"id":9179861,"username":"pguinoiseau","name":"Pierre Guinoiseau","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/9179861/avatar.png","web_url":"https://gitlab.com/pguinoiseau"},"labels":["Observability-reliability","Service::PublicGrafana","priority::3","team::Reliability","workflow-infra::Done"],"milestone":null,"assignees":[{"id":9179861,"username":"pguinoiseau","name":"Pierre Guinoiseau","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/9179861/avatar.png","web_url":"https://gitlab.com/pguinoiseau"}],"author":{"id":928230,"username":"bjk-gitlab","name":"Ben Kochie","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/928230/avatar.png","web_url":"https://gitlab.com/bjk-gitlab"},"type":"ISSUE","assignee":{"id":9179861,"username":"pguinoiseau","name":"Pierre Guinoiseau","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/9179861/avatar.png","web_url":"https://gitlab.com/pguinoiseau"},"user_notes_count":5,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7787","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":2,"completed_count":1},"weight":2,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7787","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7787/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7787/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7787","relative":"#7787","full":"gitlab-com/gl-infra/reliability#7787"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":146,"epic":{"id":16537,"iid":146,"title":"Move Grafana Dashboard service to Kubernetes","url":"/groups/gitlab-com/gl-infra/-/epics/146","group_id":1112072,"human_readable_end_date":"Jan 29, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":"at_risk"},{"id":24497209,"iid":7786,"project_id":1304532,"title":"Move Grafana Dashboard service to Kubernetes","description":"Top level tracking of moving Grafana dashboards to GKE.","state":"closed","created_at":"2019-09-05T13:41:56.015Z","updated_at":"2022-08-05T04:03:07.203Z","closed_at":"2019-12-18T17:56:36.252Z","closed_by":{"id":693144,"username":"craig","name":"Craig Barrett","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c8dfa1ca41754b9409068e5e42080cd2?s=80\u0026d=identicon","web_url":"https://gitlab.com/craig"},"labels":["auto updated","priority::2","workflow-infra::Done"],"milestone":null,"assignees":[{"id":928230,"username":"bjk-gitlab","name":"Ben Kochie","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/928230/avatar.png","web_url":"https://gitlab.com/bjk-gitlab"}],"author":{"id":928230,"username":"bjk-gitlab","name":"Ben Kochie","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/928230/avatar.png","web_url":"https://gitlab.com/bjk-gitlab"},"type":"ISSUE","assignee":{"id":928230,"username":"bjk-gitlab","name":"Ben Kochie","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/928230/avatar.png","web_url":"https://gitlab.com/bjk-gitlab"},"user_notes_count":5,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":true,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7786","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7786","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7786/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7786/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7786","relative":"#7786","full":"gitlab-com/gl-infra/reliability#7786"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":24486926,"iid":7783,"project_id":1304532,"title":"-------------------- Cut Line --------------------","description":"This issue is a functional hack in this board: https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/boards/1240891\n\nSee https://gitlab.com/gitlab-com/www-gitlab-com/issues/4075 for the feature request for real cut lines.","state":"closed","created_at":"2019-09-05T08:59:51.150Z","updated_at":"2022-08-05T04:03:09.599Z","closed_at":"2020-06-16T08:53:42.105Z","closed_by":{"id":2722370,"username":"rnienaber","name":"Rachel Nienaber","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2722370/avatar.png","web_url":"https://gitlab.com/rnienaber"},"labels":["Infrastructure mStaff","group::scalability","workflow-infra::Done"],"milestone":null,"assignees":[],"author":{"id":116,"username":"marin","name":"Marin Jankovski","state":"active","avatar_url":"https://secure.gravatar.com/avatar/5154f0b0eda3f798c8a254962d57192f?s=80\u0026d=identicon","web_url":"https://gitlab.com/marin"},"type":"ISSUE","assignee":null,"user_notes_count":0,"merge_requests_count":0,"upvotes":0,"downvotes":1,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7783","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7783","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7783/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7783/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7783","relative":"#7783","full":"gitlab-com/gl-infra/reliability#7783"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":24476239,"iid":7777,"project_id":1304532,"title":"Proposal: use imaging for provisioning","description":"There has been some discussions on the topic, and I would like to bring it more formally and take a decision. I would like to propose to *not* provision the (at least database) nodes with chef directly, but rather from pre-created images.\n\nThe main driver is *reproducibility*. Current dynamic provisioning may lead to different versions of any or potentially many software components, like kernel (this has happened already: https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/7630) but could also be intermediate libraries, or main components. In any case, not having a consistent, reproducible image leads to some serious problems, like:\n*  Uneven performance.\n*  Difficult to impossible debugging if caused by different versioning.\n*  Bugs caused on one component version not happening on another one.\n*  Possible security issues or data-affecting issues (PostgreSQL, for example, is prone to index corruption issue if replicating between instances running on different versions of the glibc if they have altered the collations).\n\nReproducible builds and reproducible images are generally considered a good pattern. Obviously this doesn't mean chef or the current provisioning system cannot be used: but just to start from a base image, install the software, and generate the final image. Actually, images may be layered, such as in:\n*  Start from base Ubuntu LTS layer.\n*  Add basic common utility packages -\u003e image\n*  Add specific GitLab packages / software -\u003e image\n*  Add PostgreSQL or pgbouncer or whatever software -\u003e image\n\nWhile many options exist, [Packer](https://www.packer.io/) may be used as a tool to generate the images.\n\nOther than reproducible builds, this technique offers other advantages:\n*  Make the provisioning stage less error prone (while provisioning, some external software repository may fail, leading to the provisioning to fail).\n*  Faster provisioning (normally not important, buy may help when, for instance, a new replica is needed to be brought up asap).\n*  Better security. Since images are immutable, they can be statically analyzed for security issues. Dynamic provisioning may install potentially different (typically newer) versions of some packages which may not have been analyzed from a security perspective.\n\nIt also comes with some drawbacks:\n*  Image management. Image combination may at some point become kind of exponential. With proper scripting, using a layered approach, this should not be a big deal (only higher storage costs of the images, but this should be very minor cost factor).\n*  Software packages may be updated less. But can be fixed by creating periodic issues to review and check which software packages can be updated.\n\ncc: @Finotto","state":"closed","created_at":"2019-09-05T00:58:10.160Z","updated_at":"2022-08-05T04:03:14.340Z","closed_at":"2021-10-18T11:42:39.575Z","closed_by":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"labels":["DStores-Backlog::DBNTHave/Cleanup","Database","OnGres::Project","auto updated","priority::2","team::Reliability","workflow-infra::Done"],"milestone":null,"assignees":[{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"}],"author":{"id":2483568,"username":"ahachete","name":"Alvaro Hernandez","state":"active","avatar_url":"https://secure.gravatar.com/avatar/5af6a3c5c96061774cc52fd45ba305da?s=80\u0026d=identicon","web_url":"https://gitlab.com/ahachete"},"type":"ISSUE","assignee":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"user_notes_count":9,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7777","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7777","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7777/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7777/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7777","relative":"#7777","full":"gitlab-com/gl-infra/reliability#7777"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":24475821,"iid":7776,"project_id":1304532,"title":"Evaluate Odyssey as a replacement for pgbouncer(s)","description":"In light of the recent issues related to pgbouncer's single-threaded core saturation (like in https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/7632), some measures have been taken to mitigate or prevent excessive load:\n*  Creating more replicas (and hence distributing the load across more servers and, consequently, pgbouncers). See: https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/7674\n*  Adding more than one pgbouncer per PostgreSQL host and expose them as separate services, so as to have effectively multi-process load balancing via DNS. See: https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/7651\n\nObviously, none are ideal, even we bought some time. Ideally, we should use a multi-threaded load balancer. Enter [Odyssey](https://github.com/yandex/odyssey). It is heavily used at high-profile sites like Yandex, and while at version `1.0rc1`, reports from the main author claim for its stability. We should test it thoroughly and evaluate if it may become a replacement for the multiple pgbouncers per host.\n\nProposed plan:\n\n*  [x] Wait until GA release, right now the latest version is an RC =\u003e https://github.com/yandex/odyssey/releases/latest\n*  [ ] Determine a relevant workload and mechanism to benchmark GitLab. This might become a separate issue on its own. We really need to have a way to measure performance, reproducibly, that resembles production workload (unless anything like this already exists).\n*  [ ] Measure Odyssey performance and compare with saturated pgbouncer.\n*  [ ] Stress-test Odyssey and look for potential crashes and/or memory leaks.\n*  [ ] Create a final report summarizing the findings.\n\ncc @Finotto","state":"closed","created_at":"2019-09-05T00:16:25.600Z","updated_at":"2022-08-05T04:03:15.068Z","closed_at":"2020-02-02T07:55:42.604Z","closed_by":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"labels":["Database","OnGres::Project","priority::3","workflow-infra::Done"],"milestone":{"id":1128198,"iid":64,"group_id":1112072,"title":"W4 DBRE","description":"","state":"closed","created_at":"2020-01-20T06:26:40.274Z","updated_at":"2020-02-10T07:10:19.720Z","due_date":"2020-01-31","start_date":"2020-01-20","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/64"},"assignees":[{"id":2589296,"username":"emanuel_ongres","name":"Emanuel Calvo","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2589296/avatar.png","web_url":"https://gitlab.com/emanuel_ongres"}],"author":{"id":2483568,"username":"ahachete","name":"Alvaro Hernandez","state":"active","avatar_url":"https://secure.gravatar.com/avatar/5af6a3c5c96061774cc52fd45ba305da?s=80\u0026d=identicon","web_url":"https://gitlab.com/ahachete"},"type":"ISSUE","assignee":{"id":2589296,"username":"emanuel_ongres","name":"Emanuel Calvo","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2589296/avatar.png","web_url":"https://gitlab.com/emanuel_ongres"},"user_notes_count":17,"merge_requests_count":0,"upvotes":2,"downvotes":0,"due_date":"2020-01-31","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7776","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":5,"completed_count":1},"weight":16,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7776","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7776/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7776/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7776","relative":"#7776","full":"gitlab-com/gl-infra/reliability#7776"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":24475284,"iid":7775,"project_id":1304532,"title":"Unset statement_timeout for gitlab-superuser","description":"PostgreSQL configuration parameter [statement_timeout](https://postgresqlco.nf/en/doc/param/statement_timeout?version=9.6) is currently set to `15s`. While there are reasons for this setting on a global scale (mostly to avoid possibly idling connections, taking into account that it doesn't exist any PostgreSQL parameter similar to a `session_timeout`), it causes some troubles to some administrative commands. For instance, it needs to be disabled before running some long running operations like `VACUUM` or `ANALYZE`. Most importantly, it seems to be the cause of recent `pg_rewind` failures (when triggered by Patroni). See: https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/7543\n\nWhile `pg_rewind` should be patched (by PostgreSQL), as IMHO it shouldn't be subject to the `statement_timeout`, we need to work around it. I already proposed some workarounds: https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/7543#note_204263742 Among those, I propose to implement the following one:\n\n\u003e `alter user \"gitlab-superuser\" set statement_timeout=0` or equivalent command, to disable the statement timeout for the `gitlab-superuser` user --which would not be a bad thing anyway, unless any application connects with this user, but hopefully is not the case.\n\nThe main reason is that not only will prevent `pg_rewind` from failing, but will also avoid having to unset `statement_timeout` for several other operations.\n\nThis needs to be added to the DDL code. Required actions:\n* [ ]  Check that no application code is connecting to the database as `gitlab-superuser` (should not be the case, but needs to be checked).\n* [ ]  Add the above DDL statement to the DDL creation process.\n* [ ]  Prepare DDL change script to apply it to production.\n\nIf there's any other proposal on how to act, please comment.\n\n@Finotto","state":"closed","created_at":"2019-09-04T23:24:27.846Z","updated_at":"2022-08-05T04:03:15.747Z","closed_at":"2019-09-11T17:19:51.219Z","closed_by":{"id":506061,"username":"ahmadsherif","name":"Ahmad Sherif","state":"active","avatar_url":"https://secure.gravatar.com/avatar/bd6d0ec4213b91601956c9f801cbfe9b?s=80\u0026d=identicon","web_url":"https://gitlab.com/ahmadsherif"},"labels":["Database","OnGres::Project","priority::1","workflow-infra::Done"],"milestone":{"id":995576,"iid":42,"group_id":1112072,"title":"Dev \u0026 Ops: 2019-09-09 - 2019-09-22","description":"","state":"closed","created_at":"2019-09-09T14:46:08.050Z","updated_at":"2019-09-23T09:43:07.078Z","due_date":"2019-09-22","start_date":"2019-09-09","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/42"},"assignees":[{"id":506061,"username":"ahmadsherif","name":"Ahmad Sherif","state":"active","avatar_url":"https://secure.gravatar.com/avatar/bd6d0ec4213b91601956c9f801cbfe9b?s=80\u0026d=identicon","web_url":"https://gitlab.com/ahmadsherif"}],"author":{"id":2483568,"username":"ahachete","name":"Alvaro Hernandez","state":"active","avatar_url":"https://secure.gravatar.com/avatar/5af6a3c5c96061774cc52fd45ba305da?s=80\u0026d=identicon","web_url":"https://gitlab.com/ahachete"},"type":"ISSUE","assignee":{"id":506061,"username":"ahmadsherif","name":"Ahmad Sherif","state":"active","avatar_url":"https://secure.gravatar.com/avatar/bd6d0ec4213b91601956c9f801cbfe9b?s=80\u0026d=identicon","web_url":"https://gitlab.com/ahmadsherif"},"user_notes_count":2,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7775","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":3,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7775","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7775/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7775/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7775","relative":"#7775","full":"gitlab-com/gl-infra/reliability#7775"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":24475245,"iid":7774,"project_id":1304532,"title":"Make sure meltano cert upgrade happens","description":"Your SSLMate certificate for www.meltano.com will expire on September  7, 2019.\n\nThe renewal of this certificate is awaiting approval by the administrator(s) of the following domains:\n\nwww.meltano.com: Please visit https://sslmate.com/console/orders/www.meltano.com\nmeltano.com: Please visit https://sslmate.com/console/orders/www.meltano.com\n\nFor more information about how to approve this certificate, visit https://sslmate.com/console/orders/www.meltano.com\n\ncc @gitlab-com/gl-infra/cicd-and-enablement","state":"closed","created_at":"2019-09-04T23:19:39.884Z","updated_at":"2019-12-06T21:45:45.465Z","closed_at":"2019-09-06T19:40:50.590Z","closed_by":{"id":429540,"username":"ahanselka","name":"Alex Hanselka","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/429540/avatar.png","web_url":"https://gitlab.com/ahanselka"},"labels":["SRE:On-call","priority::2","team::Reliability","workflow-infra::Done"],"milestone":{"id":989649,"iid":40,"group_id":1112072,"title":"CI/CD \u0026 Enablement September 2019","description":"","state":"closed","created_at":"2019-09-03T14:00:40.199Z","updated_at":"2019-10-07T17:05:43.892Z","due_date":"2019-09-30","start_date":"2019-09-01","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/40"},"assignees":[{"id":429540,"username":"ahanselka","name":"Alex Hanselka","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/429540/avatar.png","web_url":"https://gitlab.com/ahanselka"}],"author":{"id":2222520,"username":"dawsmith","name":"Dave Smith","state":"active","avatar_url":"https://secure.gravatar.com/avatar/ef341e061f6b86461626e64c5fbcfe52?s=80\u0026d=identicon","web_url":"https://gitlab.com/dawsmith"},"type":"ISSUE","assignee":{"id":429540,"username":"ahanselka","name":"Alex Hanselka","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/429540/avatar.png","web_url":"https://gitlab.com/ahanselka"},"user_notes_count":8,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":"2019-09-06","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7774","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7774","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7774/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7774/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7774","relative":"#7774","full":"gitlab-com/gl-infra/reliability#7774"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":24470177,"iid":7773,"project_id":1304532,"title":"Update gitlab-exporter (former gitlab-monitor) and re-enable CI metric scrapes","description":"We disabled scraping the CI metrics because the queries are real heavy. The top issue for this is https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/7724.\n\nNow https://gitlab.com/gitlab-org/gitlab-exporter/merge_requests/101 improved the queries by adding a date range filter. This requires a new index which is going to get shipped with https://gitlab.com/gitlab-org/gitlab-ce/merge_requests/32546.\n\nOnce the index has found its way to production, we should\n* Update `gitlab-exporter` to 5.0.1, at least on the archive DR replica\n* Revert https://ops.gitlab.net/gitlab-cookbooks/chef-repo/merge_requests/1711 to re-enable scraping.","state":"closed","created_at":"2019-09-04T18:17:31.508Z","updated_at":"2022-08-05T04:03:16.870Z","closed_at":"2019-09-16T12:55:07.398Z","closed_by":{"id":506061,"username":"ahmadsherif","name":"Ahmad Sherif","state":"active","avatar_url":"https://secure.gravatar.com/avatar/bd6d0ec4213b91601956c9f801cbfe9b?s=80\u0026d=identicon","web_url":"https://gitlab.com/ahmadsherif"},"labels":["Database","Observability-reliability","auto updated","team::Reliability","workflow-infra::Done"],"milestone":{"id":995576,"iid":42,"group_id":1112072,"title":"Dev \u0026 Ops: 2019-09-09 - 2019-09-22","description":"","state":"closed","created_at":"2019-09-09T14:46:08.050Z","updated_at":"2019-09-23T09:43:07.078Z","due_date":"2019-09-22","start_date":"2019-09-09","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/42"},"assignees":[{"id":506061,"username":"ahmadsherif","name":"Ahmad Sherif","state":"active","avatar_url":"https://secure.gravatar.com/avatar/bd6d0ec4213b91601956c9f801cbfe9b?s=80\u0026d=identicon","web_url":"https://gitlab.com/ahmadsherif"}],"author":{"id":1562869,"username":"abrandl","name":"Andreas Brandl","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1562869/avatar.png","web_url":"https://gitlab.com/abrandl"},"type":"ISSUE","assignee":{"id":506061,"username":"ahmadsherif","name":"Ahmad Sherif","state":"active","avatar_url":"https://secure.gravatar.com/avatar/bd6d0ec4213b91601956c9f801cbfe9b?s=80\u0026d=identicon","web_url":"https://gitlab.com/ahmadsherif"},"user_notes_count":9,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7773","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7773","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7773/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7773/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7773","relative":"#7773","full":"gitlab-com/gl-infra/reliability#7773"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":24459604,"iid":7770,"project_id":1304532,"title":"alert toil: HPA Unable to Scale","description":"This particular alert fires quite often.  I think it simply needs to be tuned.  https://gitlab.com/gitlab-com/runbooks/blob/master/rules/kubernetes-hpa.yml#L25-33  The alert is relatively basic, and when a scale down operation completes successfully, we'll have hit the minimum number of Pods, which is not a bad thing.  The last time I saw this alert fire in our staging environment, was legit to fire based on the current alert rule, but undesired as it doesn't mean anything to us:\n\n```json\n{\n  \"type\": \"ScalingLimited\",\n  \"status\": \"True\",\n  \"lastTransitionTime\": \"2019-09-04T11:47:26Z\",\n  \"reason\": \"TooFewReplicas\",\n  \"message\":\"the desired replica count is increasing faster than the maximum scale rate\"\n}\n```\n\nUtilize this issue to figure out how we can tune the alert such that it does not fire in situations where we scaled down to the minimum number of Pods.  In this situation, it's completely fine to happen as the HPA wanted to scale down further, but don't allow it too.  We want more than 1 Pod running for the sake of redundancy.","state":"closed","created_at":"2019-09-04T12:27:22.596Z","updated_at":"2022-08-05T04:03:19.529Z","closed_at":"2019-09-09T13:58:20.365Z","closed_by":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"labels":["Service::Container Registry","kubernetes","team::Delivery","toil","workflow-infra::Done"],"milestone":null,"assignees":[{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"}],"author":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"type":"ISSUE","assignee":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7770","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7770","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7770/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7770/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7770","relative":"#7770","full":"gitlab-com/gl-infra/reliability#7770"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":85,"epic":{"id":11045,"iid":85,"title":"Items to complete after transitioning GitLab.com Container Registry from Virtual Machines to GKE Pods","url":"/groups/gitlab-com/gl-infra/-/epics/85","group_id":1112072},"iteration":null,"health_status":null},{"id":24458199,"iid":7769,"project_id":1304532,"title":"Read permissions for analytics for new tables","description":"When creating new tables, we don't assign read permissions for the `analytics` user. This has led to https://gitlab.com/gitlab-data/analytics/merge_requests/1522#note_212269236.\n\nAn alternative to updating the permissions manually is to add the `analytics` user to the `gitlab` group. `gitlab` is the user owning the tables and has full read/write access. Write is not needed for analytics, but we're only using this on the archive replica (read-only) anyways.\n\nWe may want to make sure the `analytics` user cannot be used on the patroni instances (through pg_hba, for example).\n\ncc @Finotto","state":"closed","created_at":"2019-09-04T11:39:40.680Z","updated_at":"2022-08-05T04:03:20.659Z","closed_at":"2020-06-30T10:14:17.962Z","closed_by":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"labels":["Database","priority::3","workflow-infra::Done"],"milestone":{"id":1142605,"iid":66,"group_id":1112072,"title":"W6 DBRE","description":"","state":"closed","created_at":"2020-02-02T07:54:53.150Z","updated_at":"2020-03-02T08:54:59.491Z","due_date":"2020-02-14","start_date":"2020-02-03","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/66"},"assignees":[{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"}],"author":{"id":1562869,"username":"abrandl","name":"Andreas Brandl","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1562869/avatar.png","web_url":"https://gitlab.com/abrandl"},"type":"ISSUE","assignee":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"user_notes_count":57,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":"2020-06-05","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7769","time_stats":{"time_estimate":0,"total_time_spent":1800,"human_time_estimate":null,"human_total_time_spent":"30m"},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7769","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7769/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7769/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7769","relative":"#7769","full":"gitlab-com/gl-infra/reliability#7769"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":116,"epic":{"id":15222,"iid":116,"title":"Admin DW databases","url":"/groups/gitlab-com/gl-infra/-/epics/116","group_id":1112072,"human_readable_end_date":"Feb 14, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":24457541,"iid":7768,"project_id":1304532,"title":"cleanup unused postgres 11 resources","description":"As long as the postgres 11 epic (https://gitlab.com/groups/gitlab-com/gl-infra/-/epics/71) isn't worked on we should remove unused postgres 11 resources and clean up unapplied terraform configs.","state":"closed","created_at":"2019-09-04T11:18:04.540Z","updated_at":"2022-08-05T04:03:21.208Z","closed_at":"2019-11-13T17:48:06.679Z","closed_by":{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},"labels":["Service::Postgres","team::Reliability","terraform","workflow-infra::Done"],"milestone":null,"assignees":[{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"}],"author":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"type":"ISSUE","assignee":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"user_notes_count":3,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7768","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7768","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7768/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7768/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7768","relative":"#7768","full":"gitlab-com/gl-infra/reliability#7768"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":24436488,"iid":7764,"project_id":1304532,"title":"Create shared CloudSQL module for terraform","description":"Since the Google provided CloudSQL module does't suit our use case, we'll need to implement our own module which will extend https://github.com/terraform-google-modules/terraform-google-sql-db\n\nThe primary issues are:\n\n1. The module does not implement private IP support. We will be connecting to our instances via a private IP from either gitlab instances or apps running on GKE clusters. Adding the private network functionality to the [VPC Module](https://ops.gitlab.net/gitlab-com/gl-infra/terraform-modules/google/vpc) makes cloudsql work, but is currently causing problems with API permissions.\n1. Google's module does not support `count` - which means that it can't be enabled and disabled with a CI variable.  When building a project with a Kubernetes cluster to attach to a project or group for Auto DevOps, we want to be able to use CloudSQL for production instances, but disable it for staging and review apps.  The module will not do this and Terraform does not support conditionally including modules (https://github.com/hashicorp/terraform/issues/12906).\n\nThe new module is here: https://ops.gitlab.net/gitlab-com/gl-infra/terraform-modules/google/cloud-sql\n\n/cc @ahanselka @craig","state":"closed","created_at":"2019-09-03T18:23:43.045Z","updated_at":"2022-08-05T04:03:25.924Z","closed_at":"2019-10-30T23:33:55.398Z","closed_by":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"labels":["terraform","workflow-infra::Done"],"milestone":null,"assignees":[{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"}],"author":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"type":"ISSUE","assignee":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"user_notes_count":4,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7764","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7764","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7764/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7764/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7764","relative":"#7764","full":"gitlab-com/gl-infra/reliability#7764"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":24417128,"iid":7752,"project_id":1304532,"title":"Improve alerting for jobs getting stuck in sidekiq queues","description":"We often do not notice soon enough when jobs get stuck in sidekiq queues because long running jobs are blocking them (see https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/7438). We should have better and more prompt alerting on that.","state":"closed","created_at":"2019-09-03T10:04:46.260Z","updated_at":"2020-07-10T16:33:50.803Z","closed_at":"2020-07-10T16:33:50.748Z","closed_by":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"labels":["Service::Sidekiq","alert","corrective action","team::Reliability","workflow-infra::Done"],"milestone":null,"assignees":[],"author":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"type":"ISSUE","assignee":null,"user_notes_count":3,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7752","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7752","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7752/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7752/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7752","relative":"#7752","full":"gitlab-com/gl-infra/reliability#7752"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":24416205,"iid":7751,"project_id":1304532,"title":"Add runbook for analyzing Gitaly pprof data","description":"In case of incidents or for performance profiling it is very helpful to analyze Go pprof data. We should have runbook instructions for that.","state":"closed","created_at":"2019-09-03T09:44:55.757Z","updated_at":"2019-12-06T21:42:55.659Z","closed_at":"2019-09-06T10:43:33.190Z","closed_by":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"labels":["corrective action","documentation","team::Reliability","workflow-infra::Done"],"milestone":null,"assignees":[{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"}],"author":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"type":"ISSUE","assignee":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7751","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7751","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7751/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7751/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7751","relative":"#7751","full":"gitlab-com/gl-infra/reliability#7751"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":24411696,"iid":7749,"project_id":1304532,"title":"Declare gitlab-ci GCP firewall rules in terraform","description":"Currently, the [gitlab-ci firewall rules](https://console.cloud.google.com/networking/firewalls/list?project=gitlab-ci-155816\u0026firewallTablesize=50) are manually managed.\n\nWe should declare these in terraform so that we can managed them in a reviewable, version controlled way.\n\nSomewhat relatedly, some chef roles declare iptables rules, e.g. https://ops.gitlab.net/gitlab-cookbooks/chef-repo/blob/master/roles/gitlab-runners-prometheus.json#L4-28. We could consider removing these as they are redundant in GCP due to the GCP firewall. Careful checking needs to be done first to ensure that any removed iptables rule has a GCP equivalent that's enforced.\n\ncc @jarv for fact-checking","state":"closed","created_at":"2019-09-03T08:21:41.753Z","updated_at":"2022-08-05T04:03:48.836Z","closed_at":"2019-09-05T11:29:24.979Z","closed_by":{"id":3911656,"username":"craigf","name":"Craig Furman","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3911656/avatar.png","web_url":"https://gitlab.com/craigf"},"labels":["auto updated","workflow-infra::Done"],"milestone":null,"assignees":[{"id":3911656,"username":"craigf","name":"Craig Furman","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3911656/avatar.png","web_url":"https://gitlab.com/craigf"}],"author":{"id":3911656,"username":"craigf","name":"Craig Furman","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3911656/avatar.png","web_url":"https://gitlab.com/craigf"},"type":"ISSUE","assignee":{"id":3911656,"username":"craigf","name":"Craig Furman","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3911656/avatar.png","web_url":"https://gitlab.com/craigf"},"user_notes_count":10,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7749","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7749","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7749/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7749/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7749","relative":"#7749","full":"gitlab-com/gl-infra/reliability#7749"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":24398833,"iid":7745,"project_id":1304532,"title":"Fix Terraform CI failure in `aws-snowplow` environment","description":"While working through fixing the errors in !7744 (MR: https://ops.gitlab.net/gitlab-com/gitlab-com-infrastructure/merge_requests/973) `tflint` started working properly again, and surfaced the following error in the `aws-snowplow` terraform configuration:\n\n```\n$ /bin/tflint\nError: Failed to load configurations: main.tf:152,3-21: Attribute redefined; The argument \"assume_role_policy\" was already set at main.tf:149,3-21. Each argument may be set only once., and 6 other diagnostic(s)\n```\n\nSeveral `lifecycle: ignore_changes` blocks were generating errors related to attribute names (these seem like false positives)\n```\n$ tflint\nError: Failed to load configurations: main.tf:671,34-35: Attribute name required; Dot must be followed by attribute name., and 5 other diagnostic(s)\n```\n\nOnce all the lifecycle blocks were commented to enable `tflint` run to finish, this was the final output:\n\n```\n $ tflint\nmain.tf\n        ERROR:138 name must be 1 characters or higher (aws_iam_role_invalid_name)\n        ERROR:138 name does not match valid pattern ^[\\w+=,.@-]+$ (aws_iam_role_invalid_name)\n        ERROR:148 name must be 1 characters or higher (aws_iam_role_invalid_name)\n        ERROR:148 name does not match valid pattern ^[\\w+=,.@-]+$ (aws_iam_role_invalid_name)\n\nResult: 4 issues  (4 errors , 0 warnings , 0 notices)\n```","state":"closed","created_at":"2019-09-02T21:31:03.703Z","updated_at":"2022-08-05T04:03:52.578Z","closed_at":"2019-09-02T22:53:27.483Z","closed_by":{"id":367626,"username":"alejandro","name":"Alejandro Rodr√≠guez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"},"labels":["terraform","workflow-infra::Done"],"milestone":null,"assignees":[{"id":367626,"username":"alejandro","name":"Alejandro Rodr√≠guez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"}],"author":{"id":693144,"username":"craig","name":"Craig Barrett","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c8dfa1ca41754b9409068e5e42080cd2?s=80\u0026d=identicon","web_url":"https://gitlab.com/craig"},"type":"ISSUE","assignee":{"id":367626,"username":"alejandro","name":"Alejandro Rodr√≠guez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7745","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7745","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7745/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7745/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7745","relative":"#7745","full":"gitlab-com/gl-infra/reliability#7745"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":24393429,"iid":7743,"project_id":1304532,"title":"Performance Insights -Query Review- :: Week 36","description":"- Query # 1 : See #7804 \n- Query # 2 : See #7805 \n- Query # 3 : See #7806","state":"closed","created_at":"2019-09-02T15:47:54.083Z","updated_at":"2021-06-24T08:09:09.335Z","closed_at":"2019-09-09T08:57:10.062Z","closed_by":{"id":2493611,"username":"adescoms","name":"Adri√°n Escoms","state":"active","avatar_url":"https://secure.gravatar.com/avatar/d6f86d318669a8b32174b7132607443d?s=80\u0026d=identicon","web_url":"https://gitlab.com/adescoms"},"labels":["Database","OnGres::Project","workflow-infra::Done"],"milestone":{"id":989400,"iid":38,"group_id":1112072,"title":"Database September part 1","description":"","state":"closed","created_at":"2019-09-03T10:14:40.685Z","updated_at":"2019-10-09T16:21:15.363Z","due_date":"2019-09-13","start_date":"2019-09-02","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/38"},"assignees":[{"id":3007633,"username":"gerardo.herzig","name":"Gerardo Herzig","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3007633/avatar.png","web_url":"https://gitlab.com/gerardo.herzig"}],"author":{"id":2493611,"username":"adescoms","name":"Adri√°n Escoms","state":"active","avatar_url":"https://secure.gravatar.com/avatar/d6f86d318669a8b32174b7132607443d?s=80\u0026d=identicon","web_url":"https://gitlab.com/adescoms"},"type":"ISSUE","assignee":{"id":3007633,"username":"gerardo.herzig","name":"Gerardo Herzig","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3007633/avatar.png","web_url":"https://gitlab.com/gerardo.herzig"},"user_notes_count":8,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2019-09-06","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7743","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7743","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7743/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7743/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7743","relative":"#7743","full":"gitlab-com/gl-infra/reliability#7743"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":24334739,"iid":7735,"project_id":1304532,"title":"Why does postgres replication lag sometimes grow significantly","description":"The `dr` environment's postgres replica (on host `postgres-dr-archive-01-db-gprd.c.gitlab-production.internal`) recently lagged by over 1 hour, triggering a PagerDuty alert.  The Prometheus metric `replication_lag` suggests this is may be a chronic problem potentially affecting all replicas.\n\nWhy does replication fall behind?  What can we do about it?","state":"closed","created_at":"2019-08-30T17:50:50.551Z","updated_at":"2023-03-30T15:09:01.401Z","closed_at":"2019-10-03T19:08:07.047Z","closed_by":{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},"labels":["Database","Investigation","workflow-infra::Done"],"milestone":null,"assignees":[{"id":3947902,"username":"msmiley","name":"Matt Smiley","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3947902/avatar.png","web_url":"https://gitlab.com/msmiley"},{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"}],"author":{"id":3947902,"username":"msmiley","name":"Matt Smiley","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3947902/avatar.png","web_url":"https://gitlab.com/msmiley"},"type":"ISSUE","assignee":{"id":3947902,"username":"msmiley","name":"Matt Smiley","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3947902/avatar.png","web_url":"https://gitlab.com/msmiley"},"user_notes_count":4,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7735","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7735","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7735/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7735/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7735","relative":"#7735","full":"gitlab-com/gl-infra/reliability#7735"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":24320338,"iid":7728,"project_id":1304532,"title":"Alert when running out of NAT ports","description":"After rolling out the changes described inhttps://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/5071, machines will usually not have public IPs and will access the internet via Google Cloud NAT.\n\nTo determine how many IPs we'll need, we can use the following formula\n\n`nat_ip_count = M * P / 64,512`\n\nWhere:\n\nM = number of machines in the region (multiply by some generous number to account for future growth)\nP = Minimum NAT ports per VM (defaults to 64)\n\nThere are 64512 TCP and UDP (each) ports available per NAT IP. (https://cloud.google.com/nat/docs/overview#number_of_nat_ports_and_connections for context)\n\nIntroducing Cloud NAT will have created another resource that can be saturated. Assuming constant min NAT ports per VM, we risk running out of NAT ports as the number of machines per router grows. We should alert on this so that SREs can provision extra NAT IPs in advance.","state":"closed","created_at":"2019-08-30T10:07:39.769Z","updated_at":"2019-12-06T21:42:42.934Z","closed_at":"2019-10-16T17:26:30.801Z","closed_by":{"id":3911656,"username":"craigf","name":"Craig Furman","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3911656/avatar.png","web_url":"https://gitlab.com/craigf"},"labels":["auto updated","team::Reliability","workflow-infra::Done"],"milestone":{"id":1006849,"iid":45,"group_id":1112072,"title":"W41 Secure \u0026 Defend","description":"## Calendar\r\n\r\n|             \t| M 07 Oct \t| T 08 Oct \t| W 09 Oct \t| Th 10 Oct  | F 11 Oct\r\n|-------------\t|----------\t|----------\t|----------\t|----------- |----------\t\r\n| @bjk-gitlab \t| -        \t| -       \t| -        \t| -          | -\r\n| @craig      \t| On-call     \t| -        \t| -        \t| -          | -         \t\r\n| @craigf     \t| -        \t| -        \t| -   \t| On-call    | On-call\r\n| @cmiskell   \t| Moving   \t| Moving    | Moving  \t| Moving     | Moving  \t\r\n| @hphilipps  \t| Vacation \t| Vacation  | Vacation  | Vacation   | Vacation         \t\r\n| @msmiley    \t| -      \t| -      \t| -      \t| -          | -\r\n\r\nW41 working days: 16\r\n\r\n|             \t| M 14 Oct \t| T 15 Oct \t| W 16 Oct \t| Th 17 Oct  | F 18 Oct \r\n|-------------\t|----------\t|----------\t|----------\t|----------- |----------\r\n| @bjk-gitlab \t| -        \t| -        \t| -   \t    | -          | -   \r\n| @craig      \t| -        \t| -       \t| -       \t| -          | - \r\n| @craigf     \t| On-call  \t| On-call  \t| -      \t| -          | -   \r\n| @cmiskell   \t| -      \t| -        \t| -        \t| -          | Moving\r\n| @hphilipps  \t| Ill        \t| Ill        \t| Ill        \t| -          | - \r\n| @msmiley    \t| -        \t| On-call   | On-call  \t| On-call    | On-call\r\n\r\nW42 working days: 21\r\n\r\n\u003chr\u003e\r\n\r\n**Total working days: 37**","state":"closed","created_at":"2019-09-18T18:11:09.033Z","updated_at":"2019-11-12T23:45:39.396Z","due_date":"2019-10-20","start_date":"2019-10-07","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/45"},"assignees":[{"id":3911656,"username":"craigf","name":"Craig Furman","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3911656/avatar.png","web_url":"https://gitlab.com/craigf"}],"author":{"id":3911656,"username":"craigf","name":"Craig Furman","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3911656/avatar.png","web_url":"https://gitlab.com/craigf"},"type":"ISSUE","assignee":{"id":3911656,"username":"craigf","name":"Craig Furman","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3911656/avatar.png","web_url":"https://gitlab.com/craigf"},"user_notes_count":15,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7728","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7728","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7728/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7728/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7728","relative":"#7728","full":"gitlab-com/gl-infra/reliability#7728"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":97,"epic":{"id":13250,"iid":97,"title":"Egress traffic from gitlab.com should come from a known list of IPs","url":"/groups/gitlab-com/gl-infra/-/epics/97","group_id":1112072,"human_readable_end_date":"Mar 20, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":24312315,"iid":7724,"project_id":1304532,"title":"gitlab-monitor scrapes cause replication lag on archive replica","description":"Background:\n* We disabled `gitlab-monitor` on the patroni hosts as we suspected the queries were amplifying load on the database\n* I moved the heavy queries around the `/ci_builds` endpoint to the archive replica with https://ops.gitlab.net/gitlab-cookbooks/chef-repo/merge_requests/1701\n\nWe now observe [unsustainable replication lag](https://prometheus-db.gprd.gitlab.net/graph?g0.range_input=2d\u0026g0.expr=pg_replication_lag%7Benvironment%3D%22gprd%22%2Cfqdn%3D%22postgres-dr-archive-01-db-gprd.c.gitlab-production.internal%22%2Cinstance%3D%22postgres-dr-archive-01-db-gprd.c.gitlab-production.internal%3A9187%22%2Cjob%3D%22postgres%22%2Cstage%3D%22main%22%2Ctier%3D%22db%22%2Ctype%3D%22postgres-archive%22%7D\u0026g0.tab=0) on the archive replica:\n\n![Screenshot_from_2019-08-30_08-27-55](/uploads/89e0f102ca1fce00dfaf2af7c0f95787/Screenshot_from_2019-08-30_08-27-55.png)\n\nA single scrape takes about 30s and this query is the top offender (27s): \n* Query: https://gitlab.com/gitlab-org/gitlab-exporter/blob/master/lib/gitlab_exporter/database/ci_builds.rb#L10\n* Plan: https://explain.depesz.com/s/d1A1\n\nThere's no direct way of speeding up the query as it is expected to scan a lot of data (about 15GB of buffers per query).\n\nThis issue is to track the infra changes.","state":"closed","created_at":"2019-08-30T06:37:15.312Z","updated_at":"2019-12-06T21:42:55.269Z","closed_at":"2019-09-17T11:32:29.520Z","closed_by":{"id":1562869,"username":"abrandl","name":"Andreas Brandl","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1562869/avatar.png","web_url":"https://gitlab.com/abrandl"},"labels":["Database","Observability-reliability","auto updated","caplan","team::Reliability","workflow-infra::Done"],"milestone":{"id":995879,"iid":43,"group_id":1112072,"title":"W37 Secure \u0026 Defend","description":"We'll be keeping the same Kanban board for team work and filtering on a new milestone every odd numbered week. This \"sprint\" construct is going to be used to facilitate backlog grooming and planning.","state":"closed","created_at":"2019-09-09T19:23:14.535Z","updated_at":"2019-09-23T21:27:53.972Z","due_date":"2019-09-22","start_date":"2019-09-09","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/43"},"assignees":[{"id":1562869,"username":"abrandl","name":"Andreas Brandl","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1562869/avatar.png","web_url":"https://gitlab.com/abrandl"}],"author":{"id":1562869,"username":"abrandl","name":"Andreas Brandl","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1562869/avatar.png","web_url":"https://gitlab.com/abrandl"},"type":"ISSUE","assignee":{"id":1562869,"username":"abrandl","name":"Andreas Brandl","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1562869/avatar.png","web_url":"https://gitlab.com/abrandl"},"user_notes_count":17,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7724","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7724","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7724/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7724/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7724","relative":"#7724","full":"gitlab-com/gl-infra/reliability#7724"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":24304846,"iid":7721,"project_id":1304532,"title":"Create a new DR Unix group to allow SSH / sudo access","description":"We'd like a new DR Unix group to be created which is required to allow SSH / sudo access to DR specific nodes. \n\nRelated:\n\n* https://gitlab.com/groups/gitlab-com/gl-infra/-/epics/12\n* https://gitlab.com/groups/gitlab-org/-/epics/575\n\ncc @devin, @dawsmith, @fzimmer, @rnienaber \n\nThis issue was moved from: https://ops.gitlab.net/gitlab-cookbooks/chef-repo/issues/1","state":"closed","created_at":"2019-08-29T20:15:18.561Z","updated_at":"2022-08-05T22:03:29.226Z","closed_at":"2019-08-30T20:59:27.328Z","closed_by":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"labels":["chef","priority::2","team::Reliability","workflow-infra::Done"],"milestone":{"id":944730,"iid":34,"group_id":1112072,"title":"CI/CD \u0026 Enablement August 2019","description":"","state":"closed","created_at":"2019-07-25T22:25:27.797Z","updated_at":"2019-09-14T00:06:06.520Z","due_date":"2019-08-31","start_date":"2019-08-01","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/34"},"assignees":[{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"}],"author":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"type":"ISSUE","assignee":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"user_notes_count":13,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7721","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7721","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7721/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7721/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7721","relative":"#7721","full":"gitlab-com/gl-infra/reliability#7721"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":24195544,"iid":7685,"project_id":1304532,"title":"create a diagram of postgresql+patroni+pgbouncer+consul on prod","description":"create a diagram of postgresql+patroni+pgbouncer+consul on prod and setup from ports for visibility of the team.\n\nAlso a table with all the hosts.","state":"closed","created_at":"2019-08-27T09:15:39.215Z","updated_at":"2022-08-05T22:03:57.357Z","closed_at":"2019-12-05T16:18:43.585Z","closed_by":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"labels":["Database","OnGres::Support","oncall","priority::3","workflow-infra::Done"],"milestone":{"id":1086169,"iid":57,"group_id":1112072,"title":"W49 DBRE","description":"","state":"closed","created_at":"2019-12-02T11:12:51.548Z","updated_at":"2020-01-16T17:23:47.770Z","due_date":"2019-12-13","start_date":"2019-12-02","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/57"},"assignees":[{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"}],"author":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"type":"ISSUE","assignee":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2019-12-06","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7685","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7685","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7685/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7685/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7685","relative":"#7685","full":"gitlab-com/gl-infra/reliability#7685"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":24186594,"iid":7683,"project_id":1304532,"title":"customers.gitlab.com 500 Error","description":"Reported in slack (#questions) https://gitlab.slack.com/archives/C0AR2KW4B/p1566877301475900","state":"closed","created_at":"2019-08-27T03:58:57.578Z","updated_at":"2022-08-05T22:03:59.718Z","closed_at":"2019-08-27T04:57:10.626Z","closed_by":{"id":3623028,"username":"cmiskell","name":"Craig Miskell","state":"active","avatar_url":"https://secure.gravatar.com/avatar/852a93b505b1f4a5549595792035f445?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmiskell"},"labels":["workflow-infra::Done"],"milestone":null,"assignees":[{"id":3623028,"username":"cmiskell","name":"Craig Miskell","state":"active","avatar_url":"https://secure.gravatar.com/avatar/852a93b505b1f4a5549595792035f445?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmiskell"}],"author":{"id":3623028,"username":"cmiskell","name":"Craig Miskell","state":"active","avatar_url":"https://secure.gravatar.com/avatar/852a93b505b1f4a5549595792035f445?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmiskell"},"type":"ISSUE","assignee":{"id":3623028,"username":"cmiskell","name":"Craig Miskell","state":"active","avatar_url":"https://secure.gravatar.com/avatar/852a93b505b1f4a5549595792035f445?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmiskell"},"user_notes_count":4,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7683","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7683","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7683/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7683/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7683","relative":"#7683","full":"gitlab-com/gl-infra/reliability#7683"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":24176931,"iid":7681,"project_id":1304532,"title":"Add env-zero to environments page in handbook","description":"We should include information about `env-zero` and how we bootstrap infrastructure projects to https://about.gitlab.com/handbook/engineering/infrastructure/environments/\n\n/cc @devin","state":"closed","created_at":"2019-08-26T19:27:10.632Z","updated_at":"2021-06-24T08:10:09.270Z","closed_at":"2019-09-27T00:33:05.358Z","closed_by":{"id":2222520,"username":"dawsmith","name":"Dave Smith","state":"active","avatar_url":"https://secure.gravatar.com/avatar/ef341e061f6b86461626e64c5fbcfe52?s=80\u0026d=identicon","web_url":"https://gitlab.com/dawsmith"},"labels":["documentation","team::Reliability","terraform","workflow-infra::Done"],"milestone":{"id":995966,"iid":44,"group_id":1112072,"title":"W39 Secure \u0026 Defend","description":"## Calendar\r\n\r\n|             \t| M 23 Sep \t| T 24 Sep \t| W 25 Sep \t| Th 26 Sep  | F 27 Sep\r\n|-------------\t|----------\t|----------\t|----------\t|----------- |----------\t\r\n| @bjk-gitlab \t| -        \t| -       \t| -        \t| -          | -\r\n| @craig      \t| -     \t| -        \t| -        \t| -          | -         \t\r\n| @craigf     \t| -        \t| -        \t| Vacation        \t| -          | -\r\n| @cmiskell   \t| -        \t| On-call   | On-call  \t| On-call    | On-call  \t\r\n| @hphilipps  \t| -        \t| -        \t| -        \t| -          | -         \t\r\n| @msmiley    \t| Vacation \t| Vacation \t| Vacation \t| Vacation   | -\r\n\r\nW39 working days: 21\r\n\r\n|             \t| M 30 Sep \t| T 01 Oct \t| W 02 Oct \t| Th 03 Oct \t| F 04 Oct \r\n|-------------\t|----------\t|----------\t|----------\t|-----------\t|----------\r\n| @bjk-gitlab \t| -        \t| -        \t| SREcon   \t| SREcon      \t| SREcon   \r\n| @craig      \t| -        \t| On-call  \t| On-call  \t| On-call      \t| On-call  \r\n| @craigf     \t| -        \t| -        \t| SREcon   \t| SREcon       \t| SREcon   \r\n| @cmiskell   \t| On-call \t| -        \t| -        \t| -          \t| On-call recovery\r\n| @hphilipps  \t| -        \t| -        \t| -        \t| Holiday      \t| Vacation \r\n| @msmiley    \t| -        \t| -         | -        \t| -          \t| -         \r\n\r\nW40 working days: 16\r\n\r\n\u003chr\u003e\r\n\r\n**Total working days: 37**","state":"closed","created_at":"2019-09-09T20:45:22.363Z","updated_at":"2019-10-07T16:05:35.691Z","due_date":"2019-10-06","start_date":"2019-09-23","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/44"},"assignees":[{"id":693144,"username":"craig","name":"Craig Barrett","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c8dfa1ca41754b9409068e5e42080cd2?s=80\u0026d=identicon","web_url":"https://gitlab.com/craig"}],"author":{"id":693144,"username":"craig","name":"Craig Barrett","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c8dfa1ca41754b9409068e5e42080cd2?s=80\u0026d=identicon","web_url":"https://gitlab.com/craig"},"type":"ISSUE","assignee":{"id":693144,"username":"craig","name":"Craig Barrett","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c8dfa1ca41754b9409068e5e42080cd2?s=80\u0026d=identicon","web_url":"https://gitlab.com/craig"},"user_notes_count":0,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7681","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7681","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7681/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7681/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7681","relative":"#7681","full":"gitlab-com/gl-infra/reliability#7681"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":24138265,"iid":7671,"project_id":1304532,"title":"Dashboards not syncing to dashboards.gitlab.com","description":"```\n/usr/lib/ruby/2.3.0/net/http/response.rb:120:in `error!': 401 \"Unauthorized\" (Net::HTTPServerException)\n\tfrom /usr/lib/ruby/2.3.0/net/http/response.rb:129:in `value'\n\tfrom ./sync_grafana_dashboards:68:in `\u003cmain\u003e'\n```\nThis is fetching the dashboard list from the public server (itself).  Probably broken when the public dashboard server got rebuilt; I suspect we didn't create or update the API key.","state":"closed","created_at":"2019-08-26T01:50:04.795Z","updated_at":"2022-08-05T23:02:08.269Z","closed_at":"2019-08-26T02:53:28.735Z","closed_by":{"id":3623028,"username":"cmiskell","name":"Craig Miskell","state":"active","avatar_url":"https://secure.gravatar.com/avatar/852a93b505b1f4a5549595792035f445?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmiskell"},"labels":["workflow-infra::Done"],"milestone":null,"assignees":[{"id":3623028,"username":"cmiskell","name":"Craig Miskell","state":"active","avatar_url":"https://secure.gravatar.com/avatar/852a93b505b1f4a5549595792035f445?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmiskell"}],"author":{"id":3623028,"username":"cmiskell","name":"Craig Miskell","state":"active","avatar_url":"https://secure.gravatar.com/avatar/852a93b505b1f4a5549595792035f445?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmiskell"},"type":"ISSUE","assignee":{"id":3623028,"username":"cmiskell","name":"Craig Miskell","state":"active","avatar_url":"https://secure.gravatar.com/avatar/852a93b505b1f4a5549595792035f445?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmiskell"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7671","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7671","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7671/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7671/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7671","relative":"#7671","full":"gitlab-com/gl-infra/reliability#7671"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":24105643,"iid":7665,"project_id":1304532,"title":"Look into rails-console issues for dr environment","description":"Testing ssh to the rails console on DR, I see something like:\n\nCreating this when I started to test access for Ash in this access request:\nhttps://gitlab.com/gitlab-com/access-requests/issues/1202\n\nHoping to get the Geo team better access to just look at issues with the DR environment.\n\n```\nDavids-MBP:users dsmith$ ssh dsmith-rails@console-01-sv-dr.c.gitlab-dr.internal\nStarting console, please wait ...\n--------------------------------------------------------------------------------\n GitLab:       12.1.0-rc23-ee (213728f63b4)\n GitLab Shell: 9.3.0\nTraceback (most recent call last):\n\t66: from bin/rails:4:in `\u003cmain\u003e'\n\t65: from bin/rails:4:in `require'\n\t64: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/railties-5.2.3/lib/rails/commands.rb:18:in `\u003ctop (required)\u003e'\n\t63: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/railties-5.2.3/lib/rails/command.rb:46:in `invoke'\n\t62: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/railties-5.2.3/lib/rails/command/base.rb:65:in `perform'\n\t61: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/thor-0.19.4/lib/thor.rb:369:in `dispatch'\n\t60: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/thor-0.19.4/lib/thor/invocation.rb:126:in `invoke_command'\n\t59: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/thor-0.19.4/lib/thor/command.rb:27:in `run'\n\t58: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/railties-5.2.3/lib/rails/commands/console/console_command.rb:95:in `perform'\n\t57: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/railties-5.2.3/lib/rails/command/actions.rb:15:in `require_application_and_environment!'\n\t56: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/railties-5.2.3/lib/rails/command/actions.rb:28:in `require_environment!'\n\t55: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/railties-5.2.3/lib/rails/application.rb:337:in `require_environment!'\n\t54: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/activesupport-5.2.3/lib/active_support/dependencies.rb:291:in `require'\n\t53: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/activesupport-5.2.3/lib/active_support/dependencies.rb:257:in `load_dependency'\n\t52: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/activesupport-5.2.3/lib/active_support/dependencies.rb:291:in `block in require'\n\t51: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/activesupport-5.2.3/lib/active_support/dependencies.rb:291:in `require'\n\t50: from /opt/gitlab/embedded/service/gitlab-rails/config/environment.rb:6:in `\u003ctop (required)\u003e'\n\t49: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/railties-5.2.3/lib/rails/application.rb:361:in `initialize!'\n\t48: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/railties-5.2.3/lib/rails/initializable.rb:60:in `run_initializers'\n\t47: from /opt/gitlab/embedded/lib/ruby/2.6.0/tsort.rb:205:in `tsort_each'\n\t46: from /opt/gitlab/embedded/lib/ruby/2.6.0/tsort.rb:226:in `tsort_each'\n\t45: from /opt/gitlab/embedded/lib/ruby/2.6.0/tsort.rb:347:in `each_strongly_connected_component'\n\t44: from /opt/gitlab/embedded/lib/ruby/2.6.0/tsort.rb:347:in `call'\n\t43: from /opt/gitlab/embedded/lib/ruby/2.6.0/tsort.rb:347:in `each'\n\t42: from /opt/gitlab/embedded/lib/ruby/2.6.0/tsort.rb:349:in `block in each_strongly_connected_component'\n\t41: from /opt/gitlab/embedded/lib/ruby/2.6.0/tsort.rb:415:in `each_strongly_connected_component_from'\n\t40: from /opt/gitlab/embedded/lib/ruby/2.6.0/tsort.rb:415:in `call'\n\t39: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/railties-5.2.3/lib/rails/initializable.rb:50:in `tsort_each_child'\n\t38: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/railties-5.2.3/lib/rails/initializable.rb:50:in `each'\n\t37: from /opt/gitlab/embedded/lib/ruby/2.6.0/tsort.rb:421:in `block in each_strongly_connected_component_from'\n\t36: from /opt/gitlab/embedded/lib/ruby/2.6.0/tsort.rb:431:in `each_strongly_connected_component_from'\n\t35: from /opt/gitlab/embedded/lib/ruby/2.6.0/tsort.rb:422:in `block (2 levels) in each_strongly_connected_component_from'\n\t34: from /opt/gitlab/embedded/lib/ruby/2.6.0/tsort.rb:350:in `block (2 levels) in each_strongly_connected_component'\n\t33: from /opt/gitlab/embedded/lib/ruby/2.6.0/tsort.rb:228:in `block in tsort_each'\n\t32: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/railties-5.2.3/lib/rails/initializable.rb:61:in `block in run_initializers'\n\t31: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/railties-5.2.3/lib/rails/initializable.rb:32:in `run'\n\t30: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/railties-5.2.3/lib/rails/initializable.rb:32:in `instance_exec'\n\t29: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/railties-5.2.3/lib/rails/engine.rb:613:in `block in \u003cclass:Engine\u003e'\n\t28: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/railties-5.2.3/lib/rails/engine.rb:613:in `each'\n\t27: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/railties-5.2.3/lib/rails/engine.rb:614:in `block (2 levels) in \u003cclass:Engine\u003e'\n\t26: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/railties-5.2.3/lib/rails/engine.rb:656:in `load_config_initializer'\n\t25: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/activesupport-5.2.3/lib/active_support/notifications.rb:170:in `instrument'\n\t24: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/railties-5.2.3/lib/rails/engine.rb:657:in `block in load_config_initializer'\n\t23: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/activesupport-5.2.3/lib/active_support/dependencies.rb:285:in `load'\n\t22: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/activesupport-5.2.3/lib/active_support/dependencies.rb:257:in `load_dependency'\n\t21: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/activesupport-5.2.3/lib/active_support/dependencies.rb:285:in `block in load'\n\t20: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/activesupport-5.2.3/lib/active_support/dependencies.rb:285:in `load'\n\t19: from /opt/gitlab/embedded/service/gitlab-rails/config/initializers/console_message.rb:9:in `\u003ctop (required)\u003e'\n\t18: from /opt/gitlab/embedded/service/gitlab-rails/lib/gitlab/database.rb:79:in `version'\n\t17: from /opt/gitlab/embedded/service/gitlab-rails/lib/gitlab/database.rb:259:in `database_version'\n\t16: from /opt/gitlab/embedded/service/gitlab-rails/lib/gitlab/database.rb:246:in `connection'\n\t15: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/activerecord-5.2.3/lib/active_record/connection_handling.rb:90:in `connection'\n\t14: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/activerecord-5.2.3/lib/active_record/connection_handling.rb:118:in `retrieve_connection'\n\t13: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/activerecord-5.2.3/lib/active_record/connection_adapters/abstract/connection_pool.rb:1014:in `retrieve_connection'\n\t12: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/activerecord-5.2.3/lib/active_record/connection_adapters/abstract/connection_pool.rb:382:in `connection'\n\t11: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/activerecord-5.2.3/lib/active_record/connection_adapters/abstract/connection_pool.rb:523:in `checkout'\n\t10: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/activerecord-5.2.3/lib/active_record/connection_adapters/abstract/connection_pool.rb:795:in `acquire_connection'\n\t 9: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/activerecord-5.2.3/lib/active_record/connection_adapters/abstract/connection_pool.rb:834:in `try_to_checkout_new_connection'\n\t 8: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/activerecord-5.2.3/lib/active_record/connection_adapters/abstract/connection_pool.rb:855:in `checkout_new_connection'\n\t 7: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/activerecord-5.2.3/lib/active_record/connection_adapters/abstract/connection_pool.rb:811:in `new_connection'\n\t 6: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/activerecord-5.2.3/lib/active_record/connection_adapters/postgresql_adapter.rb:48:in `postgresql_connection'\n\t 5: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/activerecord-5.2.3/lib/active_record/connection_adapters/postgresql_adapter.rb:48:in `new'\n\t 4: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/activerecord-5.2.3/lib/active_record/connection_adapters/postgresql_adapter.rb:223:in `initialize'\n\t 3: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/activerecord-5.2.3/lib/active_record/connection_adapters/postgresql_adapter.rb:692:in `connect'\n\t 2: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/pg-1.1.4/lib/pg.rb:56:in `connect'\n\t 1: from /opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/pg-1.1.4/lib/pg.rb:56:in `new'\n/opt/gitlab/embedded/lib/ruby/gems/2.6.0/gems/pg-1.1.4/lib/pg.rb:56:in `initialize': ERROR:  pgbouncer cannot connect to server (PG::ConnectionBad)\n```","state":"closed","created_at":"2019-08-23T19:01:37.124Z","updated_at":"2022-08-05T23:02:14.658Z","closed_at":"2019-08-30T21:19:51.485Z","closed_by":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"labels":["OnGres::Support","Service::Postgres","workflow-infra::Done"],"milestone":null,"assignees":[{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"}],"author":{"id":2222520,"username":"dawsmith","name":"Dave Smith","state":"active","avatar_url":"https://secure.gravatar.com/avatar/ef341e061f6b86461626e64c5fbcfe52?s=80\u0026d=identicon","web_url":"https://gitlab.com/dawsmith"},"type":"ISSUE","assignee":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"user_notes_count":4,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7665","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7665","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7665/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7665/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7665","relative":"#7665","full":"gitlab-com/gl-infra/reliability#7665"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":24080762,"iid":7658,"project_id":1304532,"title":"Use LetsEncrypt for docs.gitlab.com","description":"Similarly to https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/7654, I think it's time we switched the docs site (https://gitlab.com/gitlab-org/gitlab-docs) to using Let's Encrypt.\n\nI'm really hoping this will work correctly, as https://docs.gitlab.com has a lot of visitors and is very crucial to working properly :)","state":"closed","created_at":"2019-08-23T07:54:28.165Z","updated_at":"2019-12-06T21:43:19.486Z","closed_at":"2019-08-28T03:48:32.270Z","closed_by":{"id":3623028,"username":"cmiskell","name":"Craig Miskell","state":"active","avatar_url":"https://secure.gravatar.com/avatar/852a93b505b1f4a5549595792035f445?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmiskell"},"labels":["auto updated","team::Reliability","workflow-infra::Done"],"milestone":null,"assignees":[{"id":3623028,"username":"cmiskell","name":"Craig Miskell","state":"active","avatar_url":"https://secure.gravatar.com/avatar/852a93b505b1f4a5549595792035f445?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmiskell"}],"author":{"id":3585,"username":"axil","name":"Achilleas Pipinellis","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3585/avatar.png","web_url":"https://gitlab.com/axil"},"type":"ISSUE","assignee":{"id":3623028,"username":"cmiskell","name":"Craig Miskell","state":"active","avatar_url":"https://secure.gravatar.com/avatar/852a93b505b1f4a5549595792035f445?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmiskell"},"user_notes_count":5,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7658","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7658","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7658/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7658/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7658","relative":"#7658","full":"gitlab-com/gl-infra/reliability#7658"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":24071878,"iid":7654,"project_id":1304532,"title":"Use LetsEncrypt for www.remoteonly.org","description":"https://gitlab.com/gitlab-com/www-remoteonly-org/ is hosted on GitLab Pages;  per https://gitlab.com/gitlab-com/www-remoteonly-org/issues/50 the cert expired a few days ago and we didn't notice.  It required manual effort to find and update the cert that sslmate had autorenewed. \n\nGiven we have LetsEncrypt (LE) support built into Pages now (beta, but presumably generally working), we should move to that as a dog-fooding exercise, and to reduce irregular (thus cognitively expensive) toil work that can easily be missed.","state":"closed","created_at":"2019-08-22T23:25:02.158Z","updated_at":"2022-08-05T23:02:23.045Z","closed_at":"2019-08-26T02:47:08.540Z","closed_by":{"id":3623028,"username":"cmiskell","name":"Craig Miskell","state":"active","avatar_url":"https://secure.gravatar.com/avatar/852a93b505b1f4a5549595792035f445?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmiskell"},"labels":["workflow-infra::Done"],"milestone":null,"assignees":[{"id":3623028,"username":"cmiskell","name":"Craig Miskell","state":"active","avatar_url":"https://secure.gravatar.com/avatar/852a93b505b1f4a5549595792035f445?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmiskell"}],"author":{"id":3623028,"username":"cmiskell","name":"Craig Miskell","state":"active","avatar_url":"https://secure.gravatar.com/avatar/852a93b505b1f4a5549595792035f445?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmiskell"},"type":"ISSUE","assignee":{"id":3623028,"username":"cmiskell","name":"Craig Miskell","state":"active","avatar_url":"https://secure.gravatar.com/avatar/852a93b505b1f4a5549595792035f445?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmiskell"},"user_notes_count":4,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7654","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7654","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7654/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7654/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7654","relative":"#7654","full":"gitlab-com/gl-infra/reliability#7654"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":24053089,"iid":7649,"project_id":1304532,"title":"Some public dashboards are broken","description":"For example https://dashboards.gitlab.com/d/2zgM_rImz/imported-github-importer?orgId=1\n\nMost panels do not render, with the error message \"query timed out in expression evaluation\". Continuously refreshing the page occasionally yields 1 or 2 panels that load.\n\n**Update**: Work that still needs to be done:\n\nRemove iptables firewall rules from the runner prometheus instance so that it can be scraped by gprd infra prometheus on its public network interface. The gprd prometheus IPs should be whitelisted. [This MR](https://ops.gitlab.net/gitlab-cookbooks/chef-repo/merge_requests/1740) got the ball rolling but I dropped it on the floor a while ago. It's imperative that the GCP firewall is carefully checked to ensure we're not opening up a security hole by removing the on-box firewall. Add rules using terraform if need be. Note that this interacts with https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/8018 which will cause the IP of the gprd prometheus to change. Currently they're behind Cloud NAT.","state":"closed","created_at":"2019-08-22T14:55:23.763Z","updated_at":"2020-03-13T23:09:25.113Z","closed_at":"2020-03-13T22:16:13.349Z","closed_by":{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},"labels":["Observability","auto updated","team::Reliability","workflow-infra::Done"],"milestone":{"id":1020810,"iid":49,"group_id":1112072,"title":"W43 Secure \u0026 Defend","description":"## Calendar\r\n\r\n|             \t| M 21 Oct \t| T 22 Oct \t| W 23 Oct \t| Th 24 Oct  | F 25 Oct\r\n|-------------\t|----------\t|----------\t|----------\t|----------- |----------\t\r\n| @bjk-gitlab \t| -        \t| -       \t| -        \t| -          | -\r\n| @craig      \t| -     \t| -        \t| -        \t| -          | -         \t\r\n| @craigf     \t| -        \t| -        \t| -       \t| -          | -\r\n| @cmiskell   \t| -        \t| -         | -       \t| -          | - \r\n| @hphilipps  \t| -      \t| -      \t| üìü  \t| üìü    | üìü\r\n| @msmiley    \t| üìü  \t| /      \t| /      \t| /          | /\r\n\r\nW43 working days: 22\r\n\r\n|             \t| M 28 Oct \t| T 29 Oct \t| W 30 Oct \t| Th 31 Oct  | F 01 Nov \r\n|-------------\t|----------\t|----------\t|----------\t|----------- |----------\r\n| @bjk-gitlab \t| -        \t| -        \t| -   \t    | -          | -   \r\n| @craig      \t| -        \t| -       \t| -       \t| -          | - \r\n| @craigf     \t| -      \t| -      \t| -      \t| -          | üå¥\r\n| @cmiskell   \t| üå¥| -      \t| -      \t| -          | -\r\n| @hphilipps  \t| üìü  \t| üìü  \t| /        \t| üå¥          | üå¥ \r\n| @msmiley    \t| -      \t| -      \t| -      \t| -          | -\r\n\r\nW44 working days: 23\r\n\r\n\u003chr\u003e\r\n\r\n**Total working days: 45**","state":"closed","created_at":"2019-10-02T14:57:08.851Z","updated_at":"2019-11-05T02:17:05.981Z","due_date":"2019-11-03","start_date":"2019-10-21","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/49"},"assignees":[{"id":928230,"username":"bjk-gitlab","name":"Ben Kochie","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/928230/avatar.png","web_url":"https://gitlab.com/bjk-gitlab"},{"id":3911656,"username":"craigf","name":"Craig Furman","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3911656/avatar.png","web_url":"https://gitlab.com/craigf"}],"author":{"id":3911656,"username":"craigf","name":"Craig Furman","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3911656/avatar.png","web_url":"https://gitlab.com/craigf"},"type":"ISSUE","assignee":{"id":928230,"username":"bjk-gitlab","name":"Ben Kochie","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/928230/avatar.png","web_url":"https://gitlab.com/bjk-gitlab"},"user_notes_count":27,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7649","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7649","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7649/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7649/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7649","relative":"#7649","full":"gitlab-com/gl-infra/reliability#7649"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":24009928,"iid":7634,"project_id":1304532,"title":"GKE in GPRD is evicting our registry Pods","description":"Occasional checks into the cluster as traffic in canary has shifted has resulted in some evicted Pods over the course of time.  We do not yet have alerts set for this type of situation.  To be handled here: https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/7604\n\nUtilize this issue to track what we can do to prevent Evicted Pods.  The reasoning has currently been diagnosed as memory overuse compared to the configured memory requests:\n\n```\nMessage:            The node was low on resource: memory. Container registry was using 3309728Ki, which exceeds its request of 32Mi.\n```\n\nThis particular Pod in the above example was using over ~413MB of RAM, but we only request ~32MB.  The requests configuration:\n\n```yaml\n   registry:\n    Image:      registry:2.7.1\n    Port:       \u003cnone\u003e\n    Host Port:  \u003cnone\u003e\n    Requests:\n      cpu:        50m\n      memory:     32Mi\n```\n\nUtilize this issue to track how best to handle this situation.  It may be that we need to figure out an appropriate baseline and manage our requests appropriately such that Kubernetes will scale the nodes as needed.\n\nReference: \n* https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/\n* https://kubernetes.io/docs/tasks/administer-cluster/out-of-resource/\n\n/cc @gitlab-org/delivery","state":"closed","created_at":"2019-08-21T13:41:36.679Z","updated_at":"2022-08-05T23:02:39.340Z","closed_at":"2019-09-04T19:19:20.710Z","closed_by":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"labels":["kubernetes","priority::3","team::Delivery","workflow-infra::Done"],"milestone":null,"assignees":[{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"}],"author":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"type":"ISSUE","assignee":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"user_notes_count":11,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7634","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7634","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7634/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7634/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7634","relative":"#7634","full":"gitlab-com/gl-infra/reliability#7634"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":85,"epic":{"id":11045,"iid":85,"title":"Items to complete after transitioning GitLab.com Container Registry from Virtual Machines to GKE Pods","url":"/groups/gitlab-com/gl-infra/-/epics/85","group_id":1112072},"iteration":null,"health_status":null},{"id":24007535,"iid":7633,"project_id":1304532,"title":"Use helm-diff for dry-run","description":"@mwasilewski-gitlab mentioned in a coffeebreak that he has used helm-diff before and thought it could be something useful for us.\n\nhttps://github.com/databus23/helm-diff\n\n\nWould be nice addition to our existing dry-run pipeline for branches as right now it doesn't show much","state":"closed","created_at":"2019-08-21T12:36:31.005Z","updated_at":"2022-08-05T23:02:39.888Z","closed_at":"2019-09-04T15:48:50.355Z","closed_by":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"labels":["corrective action","kubernetes","priority::1","team::Delivery","workflow-infra::Done"],"milestone":null,"assignees":[{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"}],"author":{"id":1254817,"username":"jarv","name":"John Jarvis","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1254817/avatar.png","web_url":"https://gitlab.com/jarv"},"type":"ISSUE","assignee":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"user_notes_count":4,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7633","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7633","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7633/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7633/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7633","relative":"#7633","full":"gitlab-com/gl-infra/reliability#7633"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":85,"epic":{"id":11045,"iid":85,"title":"Items to complete after transitioning GitLab.com Container Registry from Virtual Machines to GKE Pods","url":"/groups/gitlab-com/gl-infra/-/epics/85","group_id":1112072},"iteration":null,"health_status":null},{"id":23976412,"iid":7623,"project_id":1304532,"title":"ops.gitlab.net slow-down due to the database and VM being in different regions","description":"the WIP issue https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/6675 has left the ops in a state where it is very slow. we are also seeing some timeout errors from chatops:\n\n![Screen_Shot_2019-08-20_at_4.54.33_PM](/uploads/32172e4bf04d337df1c501b8b8dec7e0/Screen_Shot_2019-08-20_at_4.54.33_PM.png)\n\n\nTo wrap this up we can do the following:\n\n1. Delete ops-too\n2. Create a new instance with a new name\n3. Mount nfs, setup to use memorystore, connect to cloudsql (without repos at this point)\n4. Shut down both boxes, rsync data from the old to the new server\n5. change the dns\n\nOr if we are worried about introducing too many changes, keep files on local disk.","state":"closed","created_at":"2019-08-20T14:57:47.335Z","updated_at":"2022-08-05T23:02:49.746Z","closed_at":"2019-08-22T16:51:39.766Z","closed_by":{"id":1254817,"username":"jarv","name":"John Jarvis","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1254817/avatar.png","web_url":"https://gitlab.com/jarv"},"labels":["priority::1","workflow-infra::Done"],"milestone":null,"assignees":[{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},{"id":1254817,"username":"jarv","name":"John Jarvis","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1254817/avatar.png","web_url":"https://gitlab.com/jarv"}],"author":{"id":1254817,"username":"jarv","name":"John Jarvis","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1254817/avatar.png","web_url":"https://gitlab.com/jarv"},"type":"ISSUE","assignee":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"user_notes_count":18,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7623","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7623","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7623/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7623/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7623","relative":"#7623","full":"gitlab-com/gl-infra/reliability#7623"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23972334,"iid":7622,"project_id":1304532,"title":"Run ClearSharedRunnersMinutesWorker on production","description":"In https://gitlab.com/gitlab-org/gitlab-ce/issues/65540 we fixed an issue where the pipeline minutes usage was showing incorrect values.\nThe problem was in [`ClearSharedRunnersMinutesWorker`](https://gitlab.com/gitlab-org/gitlab-ee/blob/0c1c17abba98ffabbb59e854672cef60c8803e39/ee/app/workers/clear_shared_runners_minutes_worker.rb) that was timing out when trying to reset numbers for projects.\n\nGiven that the fix is out now, we would need to run it on production to reset the pipeline minutes quota so that users can see correct statistics. [We have decided to do so](https://gitlab.com/gitlab-org/gitlab-ce/issues/65540) now despite giving free minutes to users.\n\nThe same worker should run automatically on cron schedule on the 1st of every month.\n\n### The ask\n\nis it possible to run the following on production?\n\n```ruby\nClearSharedRunnersMinutesWorker.new.perform\n```\n\nand report the status of the operation in this issue. This should not take long and the result would be that project and namespace statistics will be in sync for the month of August.\n\n/cc @drewcimino @ahanselka","state":"closed","created_at":"2019-08-20T13:22:19.724Z","updated_at":"2022-08-05T23:02:50.578Z","closed_at":"2019-08-27T19:10:36.247Z","closed_by":{"id":429540,"username":"ahanselka","name":"Alex Hanselka","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/429540/avatar.png","web_url":"https://gitlab.com/ahanselka"},"labels":["SRE:On-call","priority::2","requires production access","severity::2","toil","unblocks others","unscheduled","workflow-infra::Done"],"milestone":{"id":944730,"iid":34,"group_id":1112072,"title":"CI/CD \u0026 Enablement August 2019","description":"","state":"closed","created_at":"2019-07-25T22:25:27.797Z","updated_at":"2019-09-14T00:06:06.520Z","due_date":"2019-08-31","start_date":"2019-08-01","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/34"},"assignees":[{"id":429540,"username":"ahanselka","name":"Alex Hanselka","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/429540/avatar.png","web_url":"https://gitlab.com/ahanselka"}],"author":{"id":695467,"username":"fabiopitino","name":"Fabio Pitino","state":"active","avatar_url":"https://secure.gravatar.com/avatar/f0db032076c54065b10b3efdfd175e6c?s=80\u0026d=identicon","web_url":"https://gitlab.com/fabiopitino"},"type":"ISSUE","assignee":{"id":429540,"username":"ahanselka","name":"Alex Hanselka","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/429540/avatar.png","web_url":"https://gitlab.com/ahanselka"},"user_notes_count":4,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7622","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7622","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7622/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7622/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7622","relative":"#7622","full":"gitlab-com/gl-infra/reliability#7622"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23957253,"iid":7619,"project_id":1304532,"title":"Route SLO alerts to pagerduty","description":"https://gitlab.com/gitlab-com/runbooks/merge_requests/1344 is routing latency SLO alerts to pagerduty as they seem to be very accurate in indicating real production issues.\n\nWe also should send other SLO alerts in https://gitlab.com/gitlab-com/runbooks/blob/master/rules/general-service-alerts.yml to pagerduty after we trimmed down the false alert rate (https://gitlab.com/gitlab-org/gitlab-ce/issues/66166):\n\n* [ ] error ratios alerts\n* [ ] saturation alerts\n* [ ] service availability alerts\n\nOperation rate alerts probably shouldn't go to pagerduty, as they will manifest in higher latencies or error ratios when they affect production.","state":"closed","created_at":"2019-08-20T06:37:03.333Z","updated_at":"2022-08-05T23:02:52.504Z","closed_at":"2019-12-16T19:52:36.590Z","closed_by":{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},"labels":["Observability-reliability","PagerDuty","alert","caplan","team::Reliability","workflow-infra::Done"],"milestone":null,"assignees":[{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"}],"author":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"type":"ISSUE","assignee":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7619","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":3,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7619","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7619/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7619/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7619","relative":"#7619","full":"gitlab-com/gl-infra/reliability#7619"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23942446,"iid":7611,"project_id":1304532,"title":"Shut down cron.gitlab.com","description":"This machine was only used for the Zoom sync (https://ops.gitlab.net/gitlab-cookbooks/chef-repo/merge_requests/1659), and this has now been replaced with a schedule pipeline (https://gitlab.com/gitlab-com/www-gitlab-com/merge_requests/28319).\n\n- [x] chef-repo changes: https://ops.gitlab.net/gitlab-cookbooks/chef-repo/merge_requests/2174\n- [x] gitlab-com-infrastructure changes: https://ops.gitlab.net/gitlab-com/gitlab-com-infrastructure/merge_requests/1191\n\n/cc: @ahanselka","state":"closed","created_at":"2019-08-19T21:35:53.113Z","updated_at":"2022-08-05T23:03:01.198Z","closed_at":"2019-11-20T02:15:30.024Z","closed_by":{"id":367626,"username":"alejandro","name":"Alejandro Rodr√≠guez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"},"labels":["oncall","workflow-infra::Done"],"milestone":null,"assignees":[{"id":367626,"username":"alejandro","name":"Alejandro Rodr√≠guez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"}],"author":{"id":64248,"username":"stanhu","name":"Stan Hu","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/64248/stanhu.jpg","web_url":"https://gitlab.com/stanhu"},"type":"ISSUE","assignee":{"id":367626,"username":"alejandro","name":"Alejandro Rodr√≠guez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"},"user_notes_count":4,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7611","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":2,"completed_count":2},"weight":2,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7611","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7611/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7611/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7611","relative":"#7611","full":"gitlab-com/gl-infra/reliability#7611"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23928490,"iid":7604,"project_id":1304532,"title":"Bolster Alerting for GKE clusters and components","description":"We are lacking in alerting/paging for issues with our GKE Clusters and components installed inside of them.  Let's see what we can do to improve our stature on this.\n\nConsider the following:\n* [x] The `stable/prometheus-operator` helm chart has many alerts that we've chosen to not implement due to our own configuration for alerting.  Consider porting these over if they seem to suit our needs\n* [x] Alert for any number of evicted Pods that remain around - https://gitlab.com/gitlab-com/runbooks/merge_requests/1357\n* [x] Alert if we've been unable to scrape metrics for an extended period of time `kube_hpa_status_condition` https://gitlab.com/gitlab-com/runbooks/merge_requests/1376\n* [x] Custom rules for `gitlab_component_availability` need to capture our running Pods - https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/7575\n* [x] Validate rules are in place for when we've reached the limits of our HPA scaling configurations https://gitlab.com/gitlab-com/runbooks/merge_requests/1376\n* [x] can we alert when we are bumping against the maximum of allowed nodes in a node pool? https://gitlab.com/gitlab-com/runbooks/merge_requests/1377\n* [x] node specific metrics, disk, memory, cpu usage\n* [x] container throttling - https://gitlab.com/gitlab-com/runbooks/merge_requests/1407","state":"closed","created_at":"2019-08-19T15:57:44.977Z","updated_at":"2022-08-05T23:03:05.555Z","closed_at":"2019-09-05T16:54:41.549Z","closed_by":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"labels":["kubernetes","team::Delivery","workflow-infra::Done"],"milestone":null,"assignees":[{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"}],"author":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"type":"ISSUE","assignee":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"user_notes_count":9,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7604","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":8,"completed_count":8},"weight":5,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7604","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7604/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7604/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7604","relative":"#7604","full":"gitlab-com/gl-infra/reliability#7604"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":85,"epic":{"id":11045,"iid":85,"title":"Items to complete after transitioning GitLab.com Container Registry from Virtual Machines to GKE Pods","url":"/groups/gitlab-com/gl-infra/-/epics/85","group_id":1112072},"iteration":null,"health_status":null},{"id":23927256,"iid":7602,"project_id":1304532,"title":"Change all Kubernetes monitoring Services to use json log output","description":"Components installed via `monitoring` are using standard test log format.  Let's see if we can swap this out to json log formatting to make it easier to search inside of Kibana.","state":"closed","created_at":"2019-08-19T15:52:01.476Z","updated_at":"2022-08-05T23:03:06.684Z","closed_at":"2019-08-23T18:23:09.341Z","closed_by":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"labels":["kubernetes","logging","team::Delivery","workflow-infra::Done"],"milestone":null,"assignees":[{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"}],"author":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"type":"ISSUE","assignee":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7602","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7602","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7602/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7602/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7602","relative":"#7602","full":"gitlab-com/gl-infra/reliability#7602"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":70,"epic":{"id":7650,"iid":70,"title":"Migrate the GitLab Registry Service to Kubernetes","url":"/groups/gitlab-com/gl-infra/-/epics/70","group_id":1112072},"iteration":null,"health_status":null},{"id":23916516,"iid":7599,"project_id":1304532,"title":"Stackgres blueprint","description":"","state":"closed","created_at":"2019-08-19T13:44:24.168Z","updated_at":"2022-08-05T23:03:08.399Z","closed_at":"2020-02-07T17:59:07.571Z","closed_by":{"id":506061,"username":"ahmadsherif","name":"Ahmad Sherif","state":"active","avatar_url":"https://secure.gravatar.com/avatar/bd6d0ec4213b91601956c9f801cbfe9b?s=80\u0026d=identicon","web_url":"https://gitlab.com/ahmadsherif"},"labels":["Infrastructure mStaff","VP of Infrastructure","auto updated","workflow-infra::Done"],"milestone":null,"assignees":[{"id":506061,"username":"ahmadsherif","name":"Ahmad Sherif","state":"active","avatar_url":"https://secure.gravatar.com/avatar/bd6d0ec4213b91601956c9f801cbfe9b?s=80\u0026d=identicon","web_url":"https://gitlab.com/ahmadsherif"},{"id":2360513,"username":"glopezfernandez","name":"Gerardo Lopez-Fernandez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2360513/avatar.png","web_url":"https://gitlab.com/glopezfernandez"}],"author":{"id":2360513,"username":"glopezfernandez","name":"Gerardo Lopez-Fernandez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2360513/avatar.png","web_url":"https://gitlab.com/glopezfernandez"},"type":"ISSUE","assignee":{"id":506061,"username":"ahmadsherif","name":"Ahmad Sherif","state":"active","avatar_url":"https://secure.gravatar.com/avatar/bd6d0ec4213b91601956c9f801cbfe9b?s=80\u0026d=identicon","web_url":"https://gitlab.com/ahmadsherif"},"user_notes_count":9,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7599","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7599","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7599/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7599/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7599","relative":"#7599","full":"gitlab-com/gl-infra/reliability#7599"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23846368,"iid":7583,"project_id":1304532,"title":"Consolidate bastion `howto` pages in runbooks","description":"We currently have the following in gitlab-com/runbooks:\n\n```\nhowto/gprd-bastions.md\nhowto/gstg-bastions.md\nhowto/ops-bastions.md\nhowto/dr-bastions.md\nhowto/pre-bastions.md\n```\n\nAt a minimum, this should be consolidate. I prefer we instead make this a file in this repository's onboarding directory. We should update it there regularly.","state":"closed","created_at":"2019-08-16T15:39:44.339Z","updated_at":"2022-08-05T23:03:19.007Z","closed_at":"2022-08-02T06:04:32.920Z","closed_by":{"id":1786152,"username":"gitlab-bot","name":"ü§ñ GitLab Bot ü§ñ","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1786152/avatar.png","web_url":"https://gitlab.com/gitlab-bot"},"labels":["onboarding","toil","workflow-infra::Done"],"milestone":null,"assignees":[],"author":{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},"type":"ISSUE","assignee":null,"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7583","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7583","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7583/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7583/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7583","relative":"#7583","full":"gitlab-com/gl-infra/reliability#7583"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23845288,"iid":7580,"project_id":1304532,"title":"When a deployment to Kubernetes fails, the master branch is now inconsistent with what has been deployed","description":"Our deployment procedure for Kubernetes assumes that deployments would always succeed.  In times for which they do not, helm will automatically roll back the desired change.  This presents an issue as the master branch is no longer an accurrate representation for what is running on the cluster.  Utilize this issue to track what we can do to ensure that master is a reflection of what exists on a cluster.\n\n## Thoughts\n\n* We would want to setup a failure job that performs work, potentially reverting the change\n* Issues with linked MR's would need some form of communication to know that a deploy was unsuccessful, anything that may have been auto closed may need to be reopened\n\n/cc @gitlab-org/delivery","state":"closed","created_at":"2019-08-16T14:54:07.365Z","updated_at":"2022-08-05T23:03:20.339Z","closed_at":"2019-10-09T14:54:58.980Z","closed_by":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"labels":["Kubernetes::Unplanned","documentation","kubernetes","team::Delivery","workflow-infra::Done"],"milestone":null,"assignees":[{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"}],"author":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"type":"ISSUE","assignee":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"user_notes_count":9,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7580","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7580","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7580/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7580/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7580","relative":"#7580","full":"gitlab-com/gl-infra/reliability#7580"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":85,"epic":{"id":11045,"iid":85,"title":"Items to complete after transitioning GitLab.com Container Registry from Virtual Machines to GKE Pods","url":"/groups/gitlab-com/gl-infra/-/epics/85","group_id":1112072},"iteration":null,"health_status":null},{"id":23845203,"iid":7579,"project_id":1304532,"title":"GPRD Kubernetes Cluster was inadvertently created with preemptible instances","description":"The cluster created with this node type was a mistake.  Utilize this issue to switch the node pool to change to non preemptible nodes.","state":"closed","created_at":"2019-08-16T14:49:54.746Z","updated_at":"2022-08-05T23:03:20.934Z","closed_at":"2019-08-16T18:25:18.296Z","closed_by":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"labels":["Service::Container Registry","kubernetes","team::Delivery","workflow-infra::Done"],"milestone":null,"assignees":[{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"}],"author":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"type":"ISSUE","assignee":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7579","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7579","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7579/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7579/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7579","relative":"#7579","full":"gitlab-com/gl-infra/reliability#7579"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":70,"epic":{"id":7650,"iid":70,"title":"Migrate the GitLab Registry Service to Kubernetes","url":"/groups/gitlab-com/gl-infra/-/epics/70","group_id":1112072},"iteration":null,"health_status":null},{"id":23845090,"iid":7577,"project_id":1304532,"title":"GPRD Kubernetes Cluster is generating many errors","description":"Utilize this issue to track these errors and learn/discuss/address.\n\nhttps://log.gitlab.net/goto/5770bdf4c1f9aa4707de3a60fcd6e37b#/?_g=h@44136fa\n\n| Log | Filter? | Ignorable | Info |\n| --- | ------- | --------- | ---- |\n| `daemonsets/fluentd-gcp-v3.2.0 was not changed` | possible | Yes | https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/7577#note_204637830 |\n| `rm: can't remove '/etc/ssl/certs/*': No such file or directory` | possible | Yes | https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/7577#note_204643312 |\n| `WARNING: ca-certificates.crt does not contain exactly one certificate or CRL: skipping` | possible | Yes | https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/7577#note_204643312 |\n| `unable to fetch pod metrics for pod \u003cNAMESPACE\u003e/\u003cPODNAME\u003e: no metrics known for pod` | Not advised | No | https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/7577#note_204658792 | \n| `...watch of \\*v1.Endpoints ended with: too old resource version...` | possible | Possibly | https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/7577#note_204660050 |\n| `caller=shipper.go:350 msg=\"upload new block\"...` | Not advised | Yes | https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/7577#note_204660110 |\n| prometheus info level messages | No advised | Yes | https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/7577#note_204813763 |\n| `time=\"\u003cTIMESTAMP\u003e\" level=info msg=\"debug server listening :5001\"` | Not advised | Yes | https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/7577#note_205157205 |\n\n### Actionable Items\n\nhttps://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/7577#note_205227095","state":"closed","created_at":"2019-08-16T14:43:49.369Z","updated_at":"2022-08-05T23:03:22.388Z","closed_at":"2019-08-20T17:41:46.341Z","closed_by":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"labels":["Service::Container Registry","kubernetes","team::Delivery","workflow-infra::Done"],"milestone":null,"assignees":[{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"}],"author":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"type":"ISSUE","assignee":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"user_notes_count":21,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7577","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7577","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7577/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7577/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7577","relative":"#7577","full":"gitlab-com/gl-infra/reliability#7577"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":70,"epic":{"id":7650,"iid":70,"title":"Migrate the GitLab Registry Service to Kubernetes","url":"/groups/gitlab-com/gl-infra/-/epics/70","group_id":1112072},"iteration":null,"health_status":null},{"id":23812123,"iid":7563,"project_id":1304532,"title":"Enable json logs on registry","description":"Currently we are not using structured logs on registry in gke, we should enable them.","state":"closed","created_at":"2019-08-15T15:41:57.460Z","updated_at":"2022-08-05T23:03:29.654Z","closed_at":"2019-08-27T13:49:51.594Z","closed_by":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"labels":["Service::Container Registry","kubernetes","priority::3","team::Delivery","workflow-infra::Done"],"milestone":null,"assignees":[{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"}],"author":{"id":1254817,"username":"jarv","name":"John Jarvis","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1254817/avatar.png","web_url":"https://gitlab.com/jarv"},"type":"ISSUE","assignee":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"user_notes_count":10,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7563","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7563","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7563/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7563/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7563","relative":"#7563","full":"gitlab-com/gl-infra/reliability#7563"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":85,"epic":{"id":11045,"iid":85,"title":"Items to complete after transitioning GitLab.com Container Registry from Virtual Machines to GKE Pods","url":"/groups/gitlab-com/gl-infra/-/epics/85","group_id":1112072},"iteration":null,"health_status":null},{"id":23794489,"iid":7558,"project_id":1304532,"title":"Change the onprem-testbed env from using GCP filestore to NFSv4 on the gitaly node","description":"Requested in the thread at https://gitlab.com/gitlab-org/gitaly/issues/1708#note_200047676","state":"closed","created_at":"2019-08-15T02:25:48.952Z","updated_at":"2020-03-14T01:08:24.743Z","closed_at":"2020-03-13T22:15:02.924Z","closed_by":{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},"labels":["team::Reliability","workflow-infra::Done"],"milestone":null,"assignees":[{"id":3623028,"username":"cmiskell","name":"Craig Miskell","state":"active","avatar_url":"https://secure.gravatar.com/avatar/852a93b505b1f4a5549595792035f445?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmiskell"}],"author":{"id":3623028,"username":"cmiskell","name":"Craig Miskell","state":"active","avatar_url":"https://secure.gravatar.com/avatar/852a93b505b1f4a5549595792035f445?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmiskell"},"type":"ISSUE","assignee":{"id":3623028,"username":"cmiskell","name":"Craig Miskell","state":"active","avatar_url":"https://secure.gravatar.com/avatar/852a93b505b1f4a5549595792035f445?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmiskell"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7558","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7558","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7558/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7558/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7558","relative":"#7558","full":"gitlab-com/gl-infra/reliability#7558"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23789919,"iid":7554,"project_id":1304532,"title":"Investigate saturation of read-only replica PGbouncer (and lack of load distribution)","description":"During https://gitlab.com/gitlab-com/gl-infra/production/issues/1054, we observed the following behavior:\n\n* At 8:30a UTC `patroni01` experienced a network issue that caused Patroni to fail over to `patroni04`\n  * `patroni01` ended up in a corrupted state and was offline\n  * `patroni04` became the new master\n  * `1` master, `5` replicas\n\n* `patroni06` immediately became overloaded: \n  * server connections maxed out at 100 (as configured)\n  * active clients dropped\n  * waiting connections increased\n\n![Screen_Shot_2019-08-14_at_9.22.28_PM](/uploads/99de8c23fc6a81c02ae14e4c23b9b29a/Screen_Shot_2019-08-14_at_9.22.28_PM.png)\n\n* however, all other replicas, while registering the failover blip, managed to stabilize nearly inmediately:\n\n![Screen_Shot_2019-08-14_at_9.27.34_PM](/uploads/af8e0f6aef112449bb205b431b4f225b/Screen_Shot_2019-08-14_at_9.27.34_PM.png)\n\nThe behavior of `06` wasn't expected. As an experiment, we took `06` out of the cluster temporarily. What we observed was `03` crater under the excess load:\n\n![Screen_Shot_2019-08-15_at_12.10.40_AM](/uploads/454b1843f3d5de33ffd2ac6a484cbd55/Screen_Shot_2019-08-15_at_12.10.40_AM.png)\n\nWhen `01` was finally restored an added to the cluster as a read-only replica, we attemped the experiement of pulling 06 out of the rotor. As 03 did, it cratered:\n\n![Screen_Shot_2019-08-15_at_12.12.25_AM](/uploads/9cd6b5a9f969ebbbbb6444ffbbd7d7dd/Screen_Shot_2019-08-15_at_12.12.25_AM.png)\n\n@stanhu checked the internal list of hosts (no screenshot or data saved) and it simply did not seem to have enough entropy. From memory, `05` was the first database replica in the list. After we added `01` to the cluster, `05` was still first in the list and `01` was last. With a sample of 1 observation, the combination we saw post rejoin is possible, but it seems unlikely. We expected not to see `05` in the same spot as before, and we didn't expect to see `01` last.\n\nIt is worth noting that once we were back to 5 replicas, we started seeing a slow recovery on `06`:\n\n![Screen_Shot_2019-08-15_at_12.23.27_AM](/uploads/6584dfc0630308f546742333691422e6/Screen_Shot_2019-08-15_at_12.23.27_AM.png)\n\nThus, there is clearly a capacity component to this riddle. As a precaution, we added another database replica, `07`, in hopes that this addition will buy us some runway in case of having another replica fail.","state":"closed","created_at":"2019-08-14T19:28:39.258Z","updated_at":"2022-10-17T05:18:46.294Z","closed_at":"2020-10-15T10:18:00.081Z","closed_by":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"labels":["workflow-infra::Done"],"milestone":null,"assignees":[{"id":3385446,"username":"zeffmorgan","name":"Zeff Morgan","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3385446/avatar.png","web_url":"https://gitlab.com/zeffmorgan"}],"author":{"id":2360513,"username":"glopezfernandez","name":"Gerardo Lopez-Fernandez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2360513/avatar.png","web_url":"https://gitlab.com/glopezfernandez"},"type":"ISSUE","assignee":{"id":3385446,"username":"zeffmorgan","name":"Zeff Morgan","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3385446/avatar.png","web_url":"https://gitlab.com/zeffmorgan"},"user_notes_count":12,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7554","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7554","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7554/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7554/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7554","relative":"#7554","full":"gitlab-com/gl-infra/reliability#7554"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23788247,"iid":7552,"project_id":1304532,"title":"Communication during incidents","description":"Communication during https://gitlab.com/gitlab-com/gl-infra/production/issues/1054 was lacking in effectiveness.\n\n* we neglected to update status.io for some time\n* we did not notify Support\n* there was a fair amount of *what we know* and *what we've tried* as people joined the incident call","state":"closed","created_at":"2019-08-14T17:51:26.218Z","updated_at":"2022-08-05T23:03:34.692Z","closed_at":"2020-08-17T09:29:18.165Z","closed_by":{"id":2360513,"username":"glopezfernandez","name":"Gerardo Lopez-Fernandez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2360513/avatar.png","web_url":"https://gitlab.com/glopezfernandez"},"labels":["Infrastructure mStaff","VP of Infrastructure","auto updated","corrective action","workflow-infra::Done"],"milestone":null,"assignees":[{"id":2360513,"username":"glopezfernandez","name":"Gerardo Lopez-Fernandez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2360513/avatar.png","web_url":"https://gitlab.com/glopezfernandez"},{"id":4437855,"username":"brentnewton","name":"Brent Newton","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4437855/avatar.png","web_url":"https://gitlab.com/brentnewton"}],"author":{"id":2360513,"username":"glopezfernandez","name":"Gerardo Lopez-Fernandez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2360513/avatar.png","web_url":"https://gitlab.com/glopezfernandez"},"type":"ISSUE","assignee":{"id":2360513,"username":"glopezfernandez","name":"Gerardo Lopez-Fernandez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2360513/avatar.png","web_url":"https://gitlab.com/glopezfernandez"},"user_notes_count":4,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7552","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7552","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7552/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7552/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7552","relative":"#7552","full":"gitlab-com/gl-infra/reliability#7552"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23787912,"iid":7551,"project_id":1304532,"title":"Client-side read-replica list observability","description":"During https://gitlab.com/gitlab-com/gl-infra/production/issues/1054, we observed unexpected behavior from the application read-replica load balancing. When the `01` node failed over to `04`, the failover caused significant, uneven load to shift to `06`. When we removed `06` from the cluster, the load shifted to `03`. When we undid that, the load came back to `03`. When we added the restored `01` and tried to remove `06`, `01` became overloaded. It was only when we had all replicas working and let them have time to stabilize that we saw the platform go back to nominal operation.\n\nOne of the questions we asked during the incident was \"what does the list look like across the fleet\". It turns out we can't easily answer that. @stanhu did some magic and was able to watch this on a few nodes:\n\n![Screen_Shot_2019-08-14_at_3.15.21_PM](/uploads/e02f5543900cac729f2acb5b3445b74a/Screen_Shot_2019-08-14_at_3.15.21_PM.png)\n\nIt would be useful to expose this data and be able to see it site-wide. Is it really as randomized as we think it should be? Exposing this in logs might be a first step, but it would required on-the-flight processing. A possible visual approach is, for each replica, how many clients have it in each position in the array. We may cap that at 4 positions to start this, regardless of the number of replicas). In any event, being able to see this during an incident likes today's is imperative.","state":"closed","created_at":"2019-08-14T17:27:28.050Z","updated_at":"2022-08-05T23:03:35.283Z","closed_at":"2019-12-18T20:53:00.851Z","closed_by":{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},"labels":["Observability","caplan","priority::1","severity::1","team::Reliability","workflow-infra::Done"],"milestone":null,"assignees":[{"id":3947902,"username":"msmiley","name":"Matt Smiley","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3947902/avatar.png","web_url":"https://gitlab.com/msmiley"}],"author":{"id":2360513,"username":"glopezfernandez","name":"Gerardo Lopez-Fernandez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2360513/avatar.png","web_url":"https://gitlab.com/glopezfernandez"},"type":"ISSUE","assignee":{"id":3947902,"username":"msmiley","name":"Matt Smiley","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3947902/avatar.png","web_url":"https://gitlab.com/msmiley"},"user_notes_count":16,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7551","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7551","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7551/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7551/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7551","relative":"#7551","full":"gitlab-com/gl-infra/reliability#7551"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2,"epic":{"id":1050,"iid":2,"title":"Postgres DB Availability work","url":"/groups/gitlab-com/gl-infra/-/epics/2","group_id":1112072,"human_readable_end_date":"May 8, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":23787703,"iid":7549,"project_id":1304532,"title":"Patroni documentation and training","description":"Post https://gitlab.com/gitlab-com/gl-infra/production/issues/1054, we realized that ee need to do a review of Patroni documentation and runbooks and do training on how the database cluster is configured, how Patroni works, how we perform common operations (add a node, remove a node, check on status, build a node, etc).\n\nEveryone on-call (EOCs and IMOCs) must become familiar with this. DNA seems like a good setting to run such training.","state":"closed","created_at":"2019-08-14T17:14:21.572Z","updated_at":"2022-08-05T23:03:37.868Z","closed_at":"2020-07-03T08:56:56.195Z","closed_by":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"labels":["Database","Infrastructure mStaff","auto updated","team::Reliability","workflow-infra::Done"],"milestone":{"id":989400,"iid":38,"group_id":1112072,"title":"Database September part 1","description":"","state":"closed","created_at":"2019-09-03T10:14:40.685Z","updated_at":"2019-10-09T16:21:15.363Z","due_date":"2019-09-13","start_date":"2019-09-02","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/38"},"assignees":[{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"}],"author":{"id":2360513,"username":"glopezfernandez","name":"Gerardo Lopez-Fernandez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2360513/avatar.png","web_url":"https://gitlab.com/glopezfernandez"},"type":"ISSUE","assignee":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2019-08-28","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7549","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7549","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7549/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7549/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7549","relative":"#7549","full":"gitlab-com/gl-infra/reliability#7549"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23787506,"iid":7548,"project_id":1304532,"title":"Patroni runbooks and tooling =\u003e 20%","description":"During https://gitlab.com/gitlab-com/gl-infra/production/issues/1054, it was apparent some of our Patroni runbooks lacked details, didn't work, or were out of date. For instance, creating a new replica ran into a bunch of issues, and there were questions about the validity of the Chef/Terraform state: disk sizing, Patroni startup, etc.\n\nAlso, this still requires deep knowledge of flags, and such. We should think about abstracting some of these operations in a tool that hides this complexity. I want to be able to type something like 'foo create replica --production' or 'foo disable replica --production \u003ctarget\u003e', where *foo* is likely `gittab-ctl patroni`.\n\nThe way we do this today is too risky, as we craft commands on the fly and execute them on hosts in production.","state":"closed","created_at":"2019-08-14T17:03:34.745Z","updated_at":"2022-08-05T23:03:38.460Z","closed_at":"2020-07-07T08:31:53.967Z","closed_by":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"labels":["Database","Infrastructure mStaff","auto updated","corrective action","oncall","severity::1","team::Reliability","workflow-infra::Done"],"milestone":{"id":995576,"iid":42,"group_id":1112072,"title":"Dev \u0026 Ops: 2019-09-09 - 2019-09-22","description":"","state":"closed","created_at":"2019-09-09T14:46:08.050Z","updated_at":"2019-09-23T09:43:07.078Z","due_date":"2019-09-22","start_date":"2019-09-09","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/42"},"assignees":[{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"}],"author":{"id":2360513,"username":"glopezfernandez","name":"Gerardo Lopez-Fernandez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2360513/avatar.png","web_url":"https://gitlab.com/glopezfernandez"},"type":"ISSUE","assignee":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"user_notes_count":8,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2019-09-13","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7548","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7548","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7548/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7548/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7548","relative":"#7548","full":"gitlab-com/gl-infra/reliability#7548"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23787489,"iid":7547,"project_id":1304532,"title":"Patroni runbooks: add enable statistics","description":"During https://gitlab.com/gitlab-com/gl-infra/production/issues/1054, @craigf mentioned that statistics had to be enabled on a new master after failover, but that this was not covered in runbooks.","state":"closed","created_at":"2019-08-14T17:02:49.062Z","updated_at":"2022-08-05T23:03:39.061Z","closed_at":"2019-08-27T13:52:29.949Z","closed_by":{"id":3911656,"username":"craigf","name":"Craig Furman","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3911656/avatar.png","web_url":"https://gitlab.com/craigf"},"labels":["Database","OnGres::Support","corrective action","workflow-infra::Done"],"milestone":null,"assignees":[{"id":3911656,"username":"craigf","name":"Craig Furman","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3911656/avatar.png","web_url":"https://gitlab.com/craigf"}],"author":{"id":2360513,"username":"glopezfernandez","name":"Gerardo Lopez-Fernandez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2360513/avatar.png","web_url":"https://gitlab.com/glopezfernandez"},"type":"ISSUE","assignee":{"id":3911656,"username":"craigf","name":"Craig Furman","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3911656/avatar.png","web_url":"https://gitlab.com/craigf"},"user_notes_count":7,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2019-08-15","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7547","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7547","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7547/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7547/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7547","relative":"#7547","full":"gitlab-com/gl-infra/reliability#7547"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23787387,"iid":7546,"project_id":1304532,"title":"Runbook/Handbook update: how to page Ongres","description":"During https://gitlab.com/gitlab-com/gl-infra/production/issues/1054, it wasn't clear to the EOC how to page Ongres. Add to Runbook/Handbook, and make changes to `chatops` as necessary to reduce friction.","state":"closed","created_at":"2019-08-14T16:57:21.830Z","updated_at":"2022-08-05T23:03:39.875Z","closed_at":"2021-08-09T21:42:23.282Z","closed_by":{"id":3623028,"username":"cmiskell","name":"Craig Miskell","state":"active","avatar_url":"https://secure.gravatar.com/avatar/852a93b505b1f4a5549595792035f445?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmiskell"},"labels":["workflow-infra::Done"],"milestone":null,"assignees":[],"author":{"id":2360513,"username":"glopezfernandez","name":"Gerardo Lopez-Fernandez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2360513/avatar.png","web_url":"https://gitlab.com/glopezfernandez"},"type":"ISSUE","assignee":null,"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2019-08-15","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7546","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7546","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7546/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7546/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7546","relative":"#7546","full":"gitlab-com/gl-infra/reliability#7546"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23756624,"iid":7536,"project_id":1304532,"title":"Set 301 redirect catchall on HAProxy for allremote.info domain","description":"Per the request in gitlab-com/marketing/corporate-marketing#789 we need to do the following:\n\nAlso do the work for remoteonly.org in https://gitlab.com/gitlab-com/www-gitlab-com/issues/6153","state":"closed","created_at":"2019-08-13T22:17:02.706Z","updated_at":"2022-08-05T23:03:47.896Z","closed_at":"2020-01-09T16:57:25.482Z","closed_by":{"id":367626,"username":"alejandro","name":"Alejandro Rodr√≠guez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"},"labels":["priority::2","team::Reliability","workflow-infra::Done"],"milestone":{"id":1087804,"iid":60,"group_id":1112072,"title":"Reliability January 2020","description":"","state":"closed","created_at":"2019-12-03T16:29:27.112Z","updated_at":"2020-01-31T23:02:22.156Z","due_date":"2020-01-31","start_date":"2020-01-01","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/60"},"assignees":[{"id":367626,"username":"alejandro","name":"Alejandro Rodr√≠guez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"}],"author":{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},"type":"ISSUE","assignee":{"id":367626,"username":"alejandro","name":"Alejandro Rodr√≠guez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"},"user_notes_count":17,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":"2020-01-24","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7536","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7536","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7536/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7536/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7536","relative":"#7536","full":"gitlab-com/gl-infra/reliability#7536"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23753683,"iid":7532,"project_id":1304532,"title":"Build automation for calculation and storage of MTBF for user facing services","description":"Sub issue of https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/7431.\n\nStarting point to discuss the question on how we track MTBF.\n\nCurrently we have a [spreadsheet here](https://docs.google.com/spreadsheets/d/1bCEUQbWMccVm1dfBrOFtXjyDVCflHu4rB6htOaC_0yI/edit#gid=1150439504), but it is manual..\n\nQuestions for discussion here:\n1.  Where are we going to get the data?  Currently production issues.\n1.  What are the MTBF metrics we want to track? \n  - MTBF between Sev 1/2 incident issues\n  - MTBF between any incident issue\n  - Further breakdown by tags - eg MTBF by service ?\n1.  Where do we want to store the end result - prometheus, periscope?\n\nadding @alejandro @cmcfarland @devin @ahanselka @nnelson @ggillies to start discussion on these","state":"closed","created_at":"2019-08-13T19:54:06.375Z","updated_at":"2022-08-05T23:03:51.645Z","closed_at":"2019-10-01T13:34:38.224Z","closed_by":{"id":2222520,"username":"dawsmith","name":"Dave Smith","state":"active","avatar_url":"https://secure.gravatar.com/avatar/ef341e061f6b86461626e64c5fbcfe52?s=80\u0026d=identicon","web_url":"https://gitlab.com/dawsmith"},"labels":["auto updated","team::Reliability","workflow-infra::Done"],"milestone":{"id":989649,"iid":40,"group_id":1112072,"title":"CI/CD \u0026 Enablement September 2019","description":"","state":"closed","created_at":"2019-09-03T14:00:40.199Z","updated_at":"2019-10-07T17:05:43.892Z","due_date":"2019-09-30","start_date":"2019-09-01","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/40"},"assignees":[{"id":2222520,"username":"dawsmith","name":"Dave Smith","state":"active","avatar_url":"https://secure.gravatar.com/avatar/ef341e061f6b86461626e64c5fbcfe52?s=80\u0026d=identicon","web_url":"https://gitlab.com/dawsmith"}],"author":{"id":2222520,"username":"dawsmith","name":"Dave Smith","state":"active","avatar_url":"https://secure.gravatar.com/avatar/ef341e061f6b86461626e64c5fbcfe52?s=80\u0026d=identicon","web_url":"https://gitlab.com/dawsmith"},"type":"ISSUE","assignee":{"id":2222520,"username":"dawsmith","name":"Dave Smith","state":"active","avatar_url":"https://secure.gravatar.com/avatar/ef341e061f6b86461626e64c5fbcfe52?s=80\u0026d=identicon","web_url":"https://gitlab.com/dawsmith"},"user_notes_count":3,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2019-08-21","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7532","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7532","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7532/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7532/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7532","relative":"#7532","full":"gitlab-com/gl-infra/reliability#7532"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23722603,"iid":7524,"project_id":1304532,"title":"Cert-manager versions older than 0.8.0 need to be upgraded by Nov 1st","description":"Letsencrypt says:\n```\nWe've been working with Jetstack, the authors of cert-manager, on a \nseries of fixes to the client. Cert-manager sometimes falls into a \ntraffic pattern where it sends really excessive traffic to Let's \nEncrypt's servers, continuously. To mitigate this, we plan to start \nblocking all traffic from cert-manager versions less than 0.8.0 (the \ncurrent semver minor release), as of November 1, 2019. Please upgrade \nall of your cert-manager instances before then.\n```\n\nSome of our older Kubernetes clusters fall into this category - probably because of autodevops setups which run cert-manager pods.\n\n/cc @skarbek","state":"closed","created_at":"2019-08-13T04:11:07.867Z","updated_at":"2022-08-05T23:04:03.505Z","closed_at":"2020-01-27T22:33:03.285Z","closed_by":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"labels":["Infrastructure","auto updated","kubernetes","workflow-infra::Done"],"milestone":null,"assignees":[{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"}],"author":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"type":"ISSUE","assignee":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"user_notes_count":3,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7524","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7524","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7524/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7524/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7524","relative":"#7524","full":"gitlab-com/gl-infra/reliability#7524"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23717031,"iid":7522,"project_id":1304532,"title":"RCA: Consul SSL Issue","description":"Incident: gitlab-com/gl-infra/production#1037\n\n## Summary\n\nA brief summary of what happened. Try to make it as executive-friendly as possible.\n\nWe discovered expired, self signed certificates on our consul servers. These certificates could not be renewed in the usual way because the signing key for the Cerficate Authority was no longer available. Existing TLS connections to the service were still up and passing traffic, but any change or network interruption would cause them to disconnect and not be able to reconnect.  This is a problem because our database high availability setup uses those connections for service location.  If any of the existing connections from web nodes or api nodes were interrupted, the wouldn't be able to find the database.  If any of the connections from the database nodes were interrupted, the database would fail over and not be able to decide which is primary.  Each of these situations would be very bad, and both of them together would render the entire site unusable until it was fixed.\n\nThe problem in this case was that going to each machine and addressing the problem one at a time would not work. Even rolling out or pushing a change via Chef would leave us with each individual node non-functional for 1 to 30 minutes.  All changes needed to be made (exactly) simultaneously, without allowing the database to fail over.\n\nThis left a lot of individual risks, and a lot of unknowns to test and validate.  There were several possible solutions to work through, and after walking through them we decided that turning off validation of the certificates would both remove all of the risk, and allow time to come up with a proper solution for certificate management.  All of the other options required a similar amount of effort and more importantly the same risk and process for simultaneously restarting the service everywhere. Other solutions explored were:\n\n- Replacing the certificates and CA with another self signed cert\n- Switching from a single custom CA to the system CA store and using sslmate\n- Switching to a letsencrypt cert\n\n### Metadata\n\n- Service(s) affected : Consul, Database, PGBouncer, Patroni, Web/API \n- Team attribution :  SRE\n- Minutes downtime or degradation : 0 (10 seconds for consul, 1 minute for Patroni)\n\n## Impact \u0026 Metrics\n\nStart with the following:\n\n- What was the impact of the incident? (i.e. service outage, sub-service brown-out, exposure of sensitive data, ...)\n\nThe impact was the elevated risk in that any interruption in any established TCP connection would cause either a partial or total outage of GitLab.com, depending on the node(s) involved.\n\n- Who was impacted by this incident? (i.e. external customers, internal customers, specific teams, ...)\n\nEveryone using GitLab.com could have been impacted. In the end, nobody was impacted and nobody noticed who was not involved in the activity.\n\n- How did the incident impact customers? (i.e. preventing them from doing X, incorrect display of Y, ...)\n\nThere was no impact to customers\n\n\n## Detection \u0026 Response\n\nStart with the following:\n\n- How was the incident detected?\n\nThis was detected by a restart of one of the database servers in staging.  It could not re-connect to consul.\n\n- Did alarming work as expected?\n\nNo.  We had no alert for the expiration of this certificate, since it was never intended to go into production.\n\n- How long did it take from the start of the incident to its detection?\n\n3 days from certificate expiration to noticing it\n\n- How long did it take from detection to remediation?\n\nAbout 2 days of troubleshooting, planning, and a maintenance window to remediate\n\n- Were there any issues with the response to the incident? (i.e. bastion host used to access the service was not available, relevant team memeber wasn't page-able, ...)\n\n    - sshguard on consul servers was locking out the bastion hosts.\n    - Behavior when testing in staging did not match behavior when testing in DR\n\n## Root Cause Analysis\n\n- The SSL certificates were expired on the consul hosts\n- Self signed certificates were in use and the CA key no longer existed\n- No production readiness review was done\n- These servers were originally a proof of concept and were later promoted to production\n- Moving too fast due to the rush to switch the database high availability technology to Patroni\n\n\n## What went well\n\nStart with the following:\n\n- The process of restarting consul on all servers without causing an outage went exactly as planned.\n- The team did an amazing job of covering all of the possible risks and planning around them.\n- The handover between time zones was extremely helpful.\n\n## What can be improved\n\nStart with the following:\n\n- Using the root cause analysis, explain what can be improved to prevent this from happening again.\n\nOur method of managing certificates is not optimal. Certificates should automatically renew in all cases.\n\n- Is there anything that could have been done to improve the detection or time to detection?\n\nAll certificates should be monitored, especially in cases where they do not auto-renew - but even when they do\nA production readiness review should have caught this usage of a self signed certificate and its associated CA\n\n- Is there anything that could have been done to improve the response or time to response?\n\nWe could have handed over the planning and response from the APAC shift to the Europe shift  after the troubleshooting was finished. We decided instead to set up an emergency procedure and have the people who did the troubleshooting and testing be the ones to plan and execute the response. In retrospect this was the right decision - but if the situation had been more urgent, we could have reduced the time.\n\n- Is there an existing issue that would have either prevented this incident or reduced the impact?\n\nYes: https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/1574\n\n- Did we have any indication or beforehand knowledge that this incident might take place?\n\nSince there were no alerts, we had no indication. \n\n## Corrective actions\n\n- List issues that have been created as corrective actions from this incident.\n\n    - https://gitlab.com/gitlab-com/gl-infra/production/issues/1042\n    - https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/7484 - sshguard blocking consul servers\n\n## Guidelines\n\n* [Blameless RCA Guideline](https://about.gitlab.com/handbook/infrastructure/#rca)\n* [5 whys](https://en.wikipedia.org/wiki/5_Whys)","state":"closed","created_at":"2019-08-12T21:16:07.025Z","updated_at":"2022-03-22T11:50:05.233Z","closed_at":"2019-10-11T18:47:40.594Z","closed_by":{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},"labels":["IncidentReview","workflow-infra::Done"],"milestone":null,"assignees":[{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"}],"author":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"type":"ISSUE","assignee":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"user_notes_count":0,"merge_requests_count":0,"upvotes":2,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7522","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7522","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7522/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7522/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7522","relative":"#7522","full":"gitlab-com/gl-infra/reliability#7522"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23683431,"iid":7515,"project_id":1304532,"title":"Deep Dive on production#1039","description":"@aamarsanaa @hphilipps i please drive a deep dive on the incident https://gitlab.com/gitlab-com/gl-infra/production/issues/1039. we'll perform a walkthrough of the incident during the DNA meeting on 14 August. Please re-familiarize yourselves with the incident and RCA. This issue has much more to do with process than troubleshooting.","state":"closed","created_at":"2019-08-12T07:18:53.744Z","updated_at":"2022-08-06T01:03:07.187Z","closed_at":"2019-09-19T06:18:56.090Z","closed_by":{"id":2601632,"username":"aamarsanaa","name":"Amarbayar Amarsanaa","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2601632/avatar.png","web_url":"https://gitlab.com/aamarsanaa"},"labels":["auto updated","workflow-infra::Done"],"milestone":null,"assignees":[{"id":2601632,"username":"aamarsanaa","name":"Amarbayar Amarsanaa","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2601632/avatar.png","web_url":"https://gitlab.com/aamarsanaa"},{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"}],"author":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"type":"ISSUE","assignee":{"id":2601632,"username":"aamarsanaa","name":"Amarbayar Amarsanaa","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2601632/avatar.png","web_url":"https://gitlab.com/aamarsanaa"},"user_notes_count":4,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7515","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7515","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7515/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7515/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7515","relative":"#7515","full":"gitlab-com/gl-infra/reliability#7515"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23679500,"iid":7510,"project_id":1304532,"title":"Replace SSL cert for dashboards.gitlab.com","description":"``` \nhttps://dashboards.gitlab.com\n SSL certificate for https://dashboards.gitlab.com expires in 4d 23h 24m 58s\n```\n-----\n```\n$ echo \"\" |openssl s_client -connect dashboards.gitlab.com:443 -showcerts 2\u003e\u00261|openssl x509 -noout -enddate\nnotAfter=Aug 16 23:59:59 2019 GMT\n```\n-----\n```\nsslmate list |grep dashboards.gitlab.com\ndashboards.gitlab.com                                   DV    Active   2020-08-17  No key file \n```\n-----\nCertificates stored/managed in gcloud, so we'll have to upload an entire new one, which means we need to rekey in sslmate.","state":"closed","created_at":"2019-08-12T01:37:44.838Z","updated_at":"2020-03-14T01:08:24.689Z","closed_at":"2020-03-13T22:04:23.168Z","closed_by":{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},"labels":["team::Reliability","workflow-infra::Done"],"milestone":null,"assignees":[{"id":3623028,"username":"cmiskell","name":"Craig Miskell","state":"active","avatar_url":"https://secure.gravatar.com/avatar/852a93b505b1f4a5549595792035f445?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmiskell"}],"author":{"id":3623028,"username":"cmiskell","name":"Craig Miskell","state":"active","avatar_url":"https://secure.gravatar.com/avatar/852a93b505b1f4a5549595792035f445?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmiskell"},"type":"ISSUE","assignee":{"id":3623028,"username":"cmiskell","name":"Craig Miskell","state":"active","avatar_url":"https://secure.gravatar.com/avatar/852a93b505b1f4a5549595792035f445?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmiskell"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2019-08-17","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7510","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7510","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7510/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7510/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7510","relative":"#7510","full":"gitlab-com/gl-infra/reliability#7510"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23678289,"iid":7506,"project_id":1304532,"title":"[Project] Repository Migration =\u003e 0%","description":"Epic: https://gitlab.com/groups/gitlab-com/gl-infra/-/epics/65","state":"closed","created_at":"2019-08-11T22:01:21.387Z","updated_at":"2022-08-06T01:03:14.185Z","closed_at":"2020-06-08T17:19:33.269Z","closed_by":{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},"labels":["Infrastructure mStaff","auto updated","team::Reliability","workflow-infra::Done"],"milestone":null,"assignees":[],"author":{"id":2360513,"username":"glopezfernandez","name":"Gerardo Lopez-Fernandez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2360513/avatar.png","web_url":"https://gitlab.com/glopezfernandez"},"type":"ISSUE","assignee":null,"user_notes_count":4,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7506","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7506","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7506/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7506/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7506","relative":"#7506","full":"gitlab-com/gl-infra/reliability#7506"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23674684,"iid":7505,"project_id":1304532,"title":"-------------------- Cut Line --------------------","description":"This issue is a functional hack in this board: https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/boards/1240891\n\nSee https://gitlab.com/gitlab-com/www-gitlab-com/issues/4075 for the feature request for real cut lines.","state":"closed","created_at":"2019-08-11T16:20:25.116Z","updated_at":"2022-10-28T16:26:12.577Z","closed_at":"2022-10-28T14:28:33.224Z","closed_by":{"id":10167447,"username":"afappiano","name":"Anthony Fappiano","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/10167447/avatar.png","web_url":"https://gitlab.com/afappiano"},"labels":["Infrastructure mStaff","team::Delivery"],"milestone":null,"assignees":[],"author":{"id":2360513,"username":"glopezfernandez","name":"Gerardo Lopez-Fernandez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2360513/avatar.png","web_url":"https://gitlab.com/glopezfernandez"},"type":"ISSUE","assignee":null,"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7505","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7505","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7505/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7505/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7505","relative":"#7505","full":"gitlab-com/gl-infra/reliability#7505"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23674652,"iid":7503,"project_id":1304532,"title":"-------------------- Cut Line --------------------","description":"This issue is a functional hack in this board: https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/boards/1240891\n\nSee https://gitlab.com/gitlab-com/www-gitlab-com/issues/4075 for the feature request for real cut lines.","state":"closed","created_at":"2019-08-11T16:18:22.458Z","updated_at":"2022-08-06T01:03:14.908Z","closed_at":"2020-06-08T19:11:55.267Z","closed_by":{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},"labels":["Infrastructure mStaff","team::Reliability","workflow-infra::Done"],"milestone":null,"assignees":[],"author":{"id":2360513,"username":"glopezfernandez","name":"Gerardo Lopez-Fernandez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2360513/avatar.png","web_url":"https://gitlab.com/glopezfernandez"},"type":"ISSUE","assignee":null,"user_notes_count":0,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7503","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7503","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7503/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7503/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7503","relative":"#7503","full":"gitlab-com/gl-infra/reliability#7503"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23674367,"iid":7501,"project_id":1304532,"title":"-------------------- Cut Line --------------------","description":"This issue is a functional hack in this board: https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/boards/1240891\n\nSee https://gitlab.com/gitlab-com/www-gitlab-com/issues/4075 for the feature request for real cut lines.","state":"closed","created_at":"2019-08-11T16:15:10.085Z","updated_at":"2022-08-06T01:03:15.497Z","closed_at":"2020-06-08T19:11:50.393Z","closed_by":{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},"labels":["Infrastructure mStaff","team::Reliability","workflow-infra::Done"],"milestone":null,"assignees":[],"author":{"id":2360513,"username":"glopezfernandez","name":"Gerardo Lopez-Fernandez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2360513/avatar.png","web_url":"https://gitlab.com/glopezfernandez"},"type":"ISSUE","assignee":null,"user_notes_count":0,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7501","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7501","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7501/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7501/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7501","relative":"#7501","full":"gitlab-com/gl-infra/reliability#7501"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23661453,"iid":7497,"project_id":1304532,"title":"Operations Analyst, Infrastructure role to Data Analyst, Infrastructure role","description":"","state":"closed","created_at":"2019-08-10T21:20:39.569Z","updated_at":"2022-08-06T01:03:16.101Z","closed_at":"2019-08-20T02:14:39.039Z","closed_by":{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},"labels":["Infrastructure mStaff","VP of Infrastructure","auto updated","hiring","priority::1","workflow-infra::Done"],"milestone":null,"assignees":[{"id":2360513,"username":"glopezfernandez","name":"Gerardo Lopez-Fernandez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2360513/avatar.png","web_url":"https://gitlab.com/glopezfernandez"}],"author":{"id":2360513,"username":"glopezfernandez","name":"Gerardo Lopez-Fernandez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2360513/avatar.png","web_url":"https://gitlab.com/glopezfernandez"},"type":"ISSUE","assignee":{"id":2360513,"username":"glopezfernandez","name":"Gerardo Lopez-Fernandez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2360513/avatar.png","web_url":"https://gitlab.com/glopezfernandez"},"user_notes_count":3,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2019-08-12","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7497","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7497","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7497/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7497/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7497","relative":"#7497","full":"gitlab-com/gl-infra/reliability#7497"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23661438,"iid":7496,"project_id":1304532,"title":"MTTP for Infrastructure","description":"Measure our ***mean time to production** for Infrastructure change (i.e., the elapsed time from commit on master to having the change applied to production): Chef, Terraform, etc.","state":"closed","created_at":"2019-08-10T21:18:06.406Z","updated_at":"2022-08-06T01:03:16.784Z","closed_at":"2019-12-25T15:41:41.790Z","closed_by":{"id":116,"username":"marin","name":"Marin Jankovski","state":"active","avatar_url":"https://secure.gravatar.com/avatar/5154f0b0eda3f798c8a254962d57192f?s=80\u0026d=identicon","web_url":"https://gitlab.com/marin"},"labels":["Infrastructure mStaff","KPI","team::Delivery","workflow-infra::Done"],"milestone":null,"assignees":[],"author":{"id":2360513,"username":"glopezfernandez","name":"Gerardo Lopez-Fernandez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2360513/avatar.png","web_url":"https://gitlab.com/glopezfernandez"},"type":"ISSUE","assignee":null,"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7496","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7496","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7496/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7496/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7496","relative":"#7496","full":"gitlab-com/gl-infra/reliability#7496"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23646435,"iid":7493,"project_id":1304532,"title":"Clean up of Production Board","description":"The Production Board (https://gitlab.com/gitlab-com/gl-infra/production/-/boards/1204483) has a number of items in the `Open` state but do not seem like incidents, changes or deltas. We need to clean those up, either by moving them to Infrastructure project or closing them out.\n\nAdditionally, there are a bunch of changes which aren't really changes or were changes at some point which were unfinished. As a general rule, a change has clearly defined start and end states. Let's clean that up as well, either by finishing them or moving them to be Infra issues.","state":"closed","created_at":"2019-08-09T17:32:07.474Z","updated_at":"2022-08-06T01:03:19.292Z","closed_at":"2019-11-01T09:19:44.543Z","closed_by":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"labels":["Infrastructure mStaff","workflow-infra::Done"],"milestone":null,"assignees":[{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},{"id":2222520,"username":"dawsmith","name":"Dave Smith","state":"active","avatar_url":"https://secure.gravatar.com/avatar/ef341e061f6b86461626e64c5fbcfe52?s=80\u0026d=identicon","web_url":"https://gitlab.com/dawsmith"},{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"}],"author":{"id":2360513,"username":"glopezfernandez","name":"Gerardo Lopez-Fernandez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2360513/avatar.png","web_url":"https://gitlab.com/glopezfernandez"},"type":"ISSUE","assignee":{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},"user_notes_count":3,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7493","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7493","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7493/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7493/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7493","relative":"#7493","full":"gitlab-com/gl-infra/reliability#7493"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23632177,"iid":7489,"project_id":1304532,"title":"Certificate runbooks =\u003e0%","description":"Ensure we have certificate renewal and installation runbooks for all certificates in use. As we do not have good certificate inventory capabilities, as good place to start gathering the inventory might be Chef.\n\nEpic: https://gitlab.com/groups/gitlab-com/gl-infra/-/epics/87","state":"closed","created_at":"2019-08-09T08:42:59.010Z","updated_at":"2022-03-03T10:08:22.127Z","closed_at":"2019-11-07T10:15:33.376Z","closed_by":{"id":555989,"username":"T4cC0re","name":"Hendrik Meyer","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/555989/avatar.png","web_url":"https://gitlab.com/T4cC0re"},"labels":["Infrastructure mStaff","VPE Interest","auto updated","priority::1","severity::1","team::Reliability","workflow-infra::Done"],"milestone":{"id":1060421,"iid":55,"group_id":1112072,"title":"W45 Dev \u0026 Ops","description":"","state":"closed","created_at":"2019-11-05T10:13:26.190Z","updated_at":"2019-12-03T22:08:39.621Z","due_date":"2019-11-17","start_date":"2019-11-04","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/55"},"assignees":[{"id":555989,"username":"T4cC0re","name":"Hendrik Meyer","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/555989/avatar.png","web_url":"https://gitlab.com/T4cC0re"}],"author":{"id":2360513,"username":"glopezfernandez","name":"Gerardo Lopez-Fernandez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2360513/avatar.png","web_url":"https://gitlab.com/glopezfernandez"},"type":"ISSUE","assignee":{"id":555989,"username":"T4cC0re","name":"Hendrik Meyer","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/555989/avatar.png","web_url":"https://gitlab.com/T4cC0re"},"user_notes_count":8,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2019-11-15","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7489","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7489","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7489/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7489/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7489","relative":"#7489","full":"gitlab-com/gl-infra/reliability#7489"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":87,"epic":{"id":11077,"iid":87,"title":"Certificate runbooks","url":"/groups/gitlab-com/gl-infra/-/epics/87","group_id":1112072,"human_readable_end_date":"Nov 17, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":23631223,"iid":7487,"project_id":1304532,"title":"Certificate monitoring","description":"Ensure we have expiration monitoring for all certificates in use. As we do not have good certificate inventory capabilities, as good place to start gathering the inventory might be Chef.","state":"closed","created_at":"2019-08-09T08:17:00.785Z","updated_at":"2022-03-03T10:08:22.196Z","closed_at":"2020-01-31T13:13:09.657Z","closed_by":{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},"labels":["Infrastructure mStaff","Observability-reliability","VPE Interest","auto updated","caplan","corrective action","priority::1","severity::1","team::Reliability","workflow-infra::Done"],"milestone":null,"assignees":[{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},{"id":2360513,"username":"glopezfernandez","name":"Gerardo Lopez-Fernandez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2360513/avatar.png","web_url":"https://gitlab.com/glopezfernandez"}],"author":{"id":2360513,"username":"glopezfernandez","name":"Gerardo Lopez-Fernandez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2360513/avatar.png","web_url":"https://gitlab.com/glopezfernandez"},"type":"ISSUE","assignee":{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},"user_notes_count":8,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7487","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7487","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7487/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7487/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7487","relative":"#7487","full":"gitlab-com/gl-infra/reliability#7487"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23621412,"iid":7484,"project_id":1304532,"title":"sshguard Blocking access to consul servers","description":"`sshguard` is blocking ssh access to consul servers.  It is getting requests from the bastions which it interprets as hostile and adds an iptables rule to block the bastions on the ssh port.  This has the effect of locking everyone out. We should either set a timeout that allows traffic again, or use a different method of determining hostile traffic. \n\n```\nsudo iptables -nvL --line\n```\nResults in lines like the folowing - sometimes 2 or 3 bastion servers are listed\n\n```\nChain sshguard (1 references)\nnum   pkts bytes target     prot opt in     out     source               destination\n1    14214  935K DROP       all  --  *      *       10.216.4.4           0.0.0.0/0\n```\n\nThe line can be removed with\n\n```\nsudo iptables -D sshguard 1\n```\n\nWe should also determine exactly which traffic is triggering this behavior.  If it is not being caused by someone with access who has their ssh setup misconfigured, then it is being caused by someone malicious who has gotten access to the bastions.","state":"closed","created_at":"2019-08-08T22:11:38.619Z","updated_at":"2022-08-06T01:03:24.649Z","closed_at":"2019-08-13T02:33:16.282Z","closed_by":{"id":3623028,"username":"cmiskell","name":"Craig Miskell","state":"active","avatar_url":"https://secure.gravatar.com/avatar/852a93b505b1f4a5549595792035f445?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmiskell"},"labels":["Infrastructure","corrective action","workflow-infra::Done"],"milestone":null,"assignees":[{"id":3623028,"username":"cmiskell","name":"Craig Miskell","state":"active","avatar_url":"https://secure.gravatar.com/avatar/852a93b505b1f4a5549595792035f445?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmiskell"}],"author":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"type":"ISSUE","assignee":{"id":3623028,"username":"cmiskell","name":"Craig Miskell","state":"active","avatar_url":"https://secure.gravatar.com/avatar/852a93b505b1f4a5549595792035f445?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmiskell"},"user_notes_count":4,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7484","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7484","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7484/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7484/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7484","relative":"#7484","full":"gitlab-com/gl-infra/reliability#7484"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23618000,"iid":7483,"project_id":1304532,"title":"RCA Merge requests getting closed inadvertently","description":"\u003c!--\n**Please note:** if the incident relates to sensitive data, or is security related consider\nlabeling this issue with ~security and mark it confidential.\n*** \n--\u003e\n\nIncident: gitlab-com/gl-infra/production#NNN\n\n## Summary\n\nBecause of issue noted in https://gitlab.com/gitlab-com/gl-infra/production/issues/1039, some MR's had their source branches reported missing and the refresh service closed all MR's that it found with a reported missing source branch.\n\n- Service(s) affected : ~\"Service:Sidekiq\" \n\n- Team attribution : \n\n- Minutes downtime or degradation : \n\nFor calculating duration of event, use the [Platform Metrics Dashboard](https://dashboards.gitlab.net/d/ZUei7TkWz/platform-metrics?orgId=1) to look at appdex and SLO violations.\n\n## Impact \u0026 Metrics\n\nStart with the following:\n\n- What was the impact of the incident?\n  - a small number of MRs got closed inadvertently\n- Who was impacted by this incident?\n  - a small number of users (internal and external)\n- How did the incident impact customers? \n  - MRs were closed which should have stayed open.\n- How many attempts were made to access the impacted service/feature?\n- How many customers were affected?\n- How many customers tried to access the impacted service/feature?\n\nInclude any additional metrics that are of relevance.\n\nProvide any relevant graphs that could help understand the impact of the incident and its dynamics.\n\n## Detection \u0026 Response\n\nStart with the following:\n\n- How was the incident detected?\n  - reports from users\n- Did alarming work as expected?\n  - there is no alarming for this kind of event\n- How long did it take from the start of the incident to its detection?\n- How long did it take from detection to remediation?\n- Were there any issues with the response to the incident? (i.e. bastion host used to access the service was not available, relevant team memeber wasn't page-able, ...)\n\n## Root Cause Analysis\n\nMerge requests got closed unexpectedly.\n\n1. Why? - MergeRequests::RefreshService closed some MRs.\n2. Why? - Because their branches seemed missing.\n3. Why? - The branch cache was not invalidated.\n4. Why? - We killed `post_receive` jobs during incident https://gitlab.com/gitlab-com/gl-infra/production/issues/1039 which seems to have prevented branch invalidation in a few cases.\n5. Why? - Because there is a possible race condition with branch invalidation (https://gitlab.com/gitlab-org/gitlab-ce/issues/65803)\n\n## What went well\n\nStart with the following:\n\n- Identify the things that worked well or as expected.\n- Any additional call-outs for what went particularly well.\n\n## What can be improved\n\nStart with the following:\n\n- Using the root cause analysis, explain what can be improved to prevent this from happening again.\n- Is there anything that could have been done to improve the detection or time to detection?\n- Is there anything that could have been done to improve the response or time to response?\n- Is there an existing issue that would have either prevented this incident or reduced the impact?\n- Did we have any indication or beforehand knowledge that this incident might take place?\n\n## Corrective actions\n\n* [x] fix for MergeRequestWorker race condition https://gitlab.com/gitlab-org/gitlab-ce/issues/65803 \n\n## Guidelines\n\n* [Blameless RCA Guideline](https://about.gitlab.com/handbook/infrastructure/#rca)\n* [5 whys](https://en.wikipedia.org/wiki/5_Whys)","state":"closed","created_at":"2019-08-08T19:33:07.855Z","updated_at":"2019-12-06T21:43:17.899Z","closed_at":"2019-08-19T09:18:36.444Z","closed_by":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"labels":["IncidentReview","SRE:On-call","Service::Sidekiq","oncall","severity::1","team::Reliability","workflow-infra::Done"],"milestone":null,"assignees":[{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"}],"author":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"type":"ISSUE","assignee":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7483","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":1,"completed_count":1},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7483","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7483/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7483/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7483","relative":"#7483","full":"gitlab-com/gl-infra/reliability#7483"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23612242,"iid":7480,"project_id":1304532,"title":"Work out exactly how many merge requests were closed in https://gitlab.com/gitlab-com/gl-infra/production/issues/1040","description":"In https://gitlab.com/gitlab-com/gl-infra/production/issues/1040 a race-condition between the PostReceiveWorker and the Merge Request Refresh Worker (?) related to delayed cache invalidation led to merge requests getting closed by a bug in the application.\n\nAt present we do not know how many were closed.\n\nThe decision has been made not to automatically reopen the MRs as this may lead to further confusion for users, however it's important from a messaging point-of-view that we understand roughly how many users were affected by this bug.\n\n@abrandl has done some initial analysis so assigning to him. \n\ncc @smcgivern for any insight into how we can determine whether an MR was closed by a missing branch or a user action.","state":"closed","created_at":"2019-08-08T15:30:03.111Z","updated_at":"2020-03-13T22:15:15.073Z","closed_at":"2020-03-13T22:15:15.031Z","closed_by":{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},"labels":["auto updated","team::Reliability","workflow-infra::Done"],"milestone":null,"assignees":[{"id":1562869,"username":"abrandl","name":"Andreas Brandl","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1562869/avatar.png","web_url":"https://gitlab.com/abrandl"}],"author":{"id":895869,"username":"andrewn","name":"Andrew Newdigate","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/895869/avatar.png","web_url":"https://gitlab.com/andrewn"},"type":"ISSUE","assignee":{"id":1562869,"username":"abrandl","name":"Andreas Brandl","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1562869/avatar.png","web_url":"https://gitlab.com/abrandl"},"user_notes_count":14,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7480","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":0,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7480","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7480/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7480/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7480","relative":"#7480","full":"gitlab-com/gl-infra/reliability#7480"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23611966,"iid":7479,"project_id":1304532,"title":"RCA: Gitaly n+1 calls causing bad latency and sidekiq queues to grow","description":"\u003c!--\n**Please note:** if the incident relates to sensitive data, or is security related consider\nlabeling this issue with ~security and mark it confidential.\n*** \n--\u003e\n\nIncident: gitlab-com/gl-infra/production#1039\n\nRapid Action Issue: https://gitlab.com/gitlab-com/www-gitlab-com/issues/4997\n\n## Summary\n\nSome commits with a massive amount of tags caused jobs to make many Gitaly calls, leading to higher Gitaly latency and growing sidekiq queues.\n\nFor timeline see the incident issue: https://gitlab.com/gitlab-com/gl-infra/production/issues/1039#timeline\n\n- Service(s) affected : ~\"Service:Gitaly\" ~\"Service:Sidekiq\" ~\"Service:Web\" \n\n- Team attribution : \n\n- Minutes downtime or degradation : 05:10 - 14:55 = 9h45m = 585m\n\nFor calculating duration of event, use the [Platform Metrics Dashboard](https://dashboards.gitlab.net/d/ZUei7TkWz/platform-metrics?orgId=1) to look at appdex and SLO violations.\n\n![image](/uploads/76ce8e67855fdc9ef9667caac01c5b94/image.png)\n\n## Impact \u0026 Metrics\n\nStart with the following:\n\n- What was the impact of the incident?\n  - higher Gitaly latencies, Sidekiq queues growing, higher web latencies\n- Who was impacted by this incident?\n  - all users waiting for jobs to be triggered or finish or web hooks\n- How did the incident impact customers?\n- How many attempts were made to access the impacted service/feature?\n- How many customers were affected?\n- How many customers tried to access the impacted service/feature?\n\nInclude any additional metrics that are of relevance.\n\nProvide any relevant graphs that could help understand the impact of the incident and its dynamics.\n\n## Detection \u0026 Response\n\nStart with the following:\n\n- How was the incident detected?\n  - 05:29 UTC [gitaly latency APDEX alert](https://gitlab.slack.com/archives/CD6HFD1L0/p1565242198350300) in #alerts-general which was noticed by EOC at 6:30\n- Did alarming work as expected?\n  - Alarming on queue size should fire earlier and Gitaly latency alerts should go to pagerduty\n- How long did it take from the start of the incident to its detection?\n  - queues started to grow at 05:10, got detected by EOC at 06:30 = 80m\n- How long did it take from detection to remediation?\n  - 06:30 - 14:55 = 8h25m = 505m\n- Were there any issues with the response to the incident?\n\n## Root Cause Analysis\n\nSidekiq jobs were piling up over hours.\n\n1. Why? - Jobs took longer to process.\n2. Why? - Gitaly latency was getting worse.\n3. Why? - There were more gitaly calls made by some jobs.\n4. Why? - Some jobs were processing massive amounts of tags which cause n+1 problems for Gitaly\n5. Why? - Commits of a user contained too many tags.\n\n## What went well\n\nStart with the following:\n\n- Identify the things that worked well or as expected.\n- Any additional call-outs for what went particularly well.\n\n## What can be improved\n\n- we should add limits for things like the amount of tags\n- improve performance for handling many tags\n- improve sidekiq architecture\n- alerts for growing queue size should fire earlier\n- Gitaly latency APDEX alerts should go to pagerduty\n- paging CMOC via `/pd-mgr` slack command doesn't seem to work?\n- change the severity label on the incident ticket in time to reflect our current rating of the incident severity\n- make status.io updates more meaningful for customers\n\nStart with the following:\n\n## Corrective actions\n\n* [x] add chef config for the sidekiq changes we did manual: https://ops.gitlab.net/gitlab-cookbooks/chef-repo/merge_requests/1619\n* [x] create `find_tag` RPC https://gitlab.com/gitlab-org/gitaly/issues/1848\n* [ ] implement `find_tag` RPC https://gitlab.com/gitlab-org/gitlab-ce/issues/65795\n* [x] PostReceive should have bounds on how many changes it processes. https://gitlab.com/gitlab-org/gitlab-ce/issues/65804\n* [x] add timeouts to gitaly calls from sidekiq https://gitlab.com/gitlab-com/www-gitlab-com/issues/4997\n* [x] make it possible to kill running sidekiq jobs https://gitlab.com/gitlab-org/gitlab-ce/issues/51096\n* [ ] re-architect queue implementation https://gitlab.com/gitlab-com/www-gitlab-com/issues/4951\n* [x] page for gitaly SLO alerts https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/7391\n* [x] identify limits to prevent platform incidents https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/7481\n* [x] add runbook for analyzing Gitaly pprof data https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/7751\n* [x] document marquee_account_alerts and infra-escalation channels in oncall runbook\n\n\n## Guidelines\n\n* [Blameless RCA Guideline](https://about.gitlab.com/handbook/customer-success/professional-services-engineering/workflows/internal/root-cause-analysis.html)\n* [5 whys](https://en.wikipedia.org/wiki/5_Whys)","state":"closed","created_at":"2019-08-08T15:19:47.342Z","updated_at":"2020-03-13T23:09:26.556Z","closed_at":"2020-03-13T22:12:13.429Z","closed_by":{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},"labels":["Background Processing","IncidentReview","SRE:On-call","Service::Gitaly","oncall","severity::1","team::Reliability","wg-isolation","workflow-infra::Done"],"milestone":null,"assignees":[{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"}],"author":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"type":"ISSUE","assignee":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"user_notes_count":9,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7479","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":11,"completed_count":9},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7479","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7479/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7479/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7479","relative":"#7479","full":"gitlab-com/gl-infra/reliability#7479"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23606406,"iid":7476,"project_id":1304532,"title":"Terraform GKE Module failure to apply network policy","description":"When the network policy is disabled as desired, we still attempt to configure the provider, which fails:\n\n```\n1 error occurred:\n        * module.gke-skarbek.google_container_cluster.cluster: 1 error occurred:\n        * google_container_cluster.cluster: googleapi: Error 400: The network policy addon must be enabled before updating the nodes., badRequest\n```","state":"closed","created_at":"2019-08-08T12:35:07.926Z","updated_at":"2022-08-06T01:03:29.231Z","closed_at":"2019-08-08T19:07:57.833Z","closed_by":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"labels":["Kubernetes::Prep","team::Delivery","terraform","workflow-infra::Done"],"milestone":null,"assignees":[{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"}],"author":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"type":"ISSUE","assignee":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"user_notes_count":4,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7476","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7476","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7476/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7476/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7476","relative":"#7476","full":"gitlab-com/gl-infra/reliability#7476"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23606383,"iid":7475,"project_id":1304532,"title":"Terraform GKE module unable to upgrade Kubernetes version","description":"When attempting to upgrade the cluster using terraform, we fail:\n\n```\n1 error occurred:\n        * module.gitlab-gke.google_container_cluster.cluster: 1 error occurred:\n        * google_container_cluster.cluster: node_version was updated but default-pool was not found. To update the version for a non-default pool, use the version attribute on that pool.\n```","state":"closed","created_at":"2019-08-08T12:34:07.585Z","updated_at":"2022-08-06T01:03:29.769Z","closed_at":"2019-08-09T19:46:38.026Z","closed_by":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"labels":["Kubernetes::Prep","team::Delivery","terraform","workflow-infra::Done"],"milestone":null,"assignees":[{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"}],"author":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"type":"ISSUE","assignee":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7475","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7475","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7475/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7475/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7475","relative":"#7475","full":"gitlab-com/gl-infra/reliability#7475"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23580291,"iid":7467,"project_id":1304532,"title":"service observability review","description":"With team-level ownership of services, one of the first and most urgent tasks we need to perform is an in-depth review of service observability (as highlighted by the recent consul certificate expiration incident).\n\nPlease create issues for each service for said review and execute with the **highest priority**.","state":"closed","created_at":"2019-08-07T15:33:07.220Z","updated_at":"2022-08-06T01:03:34.321Z","closed_at":"2020-01-13T22:18:03.166Z","closed_by":{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},"labels":["Infrastructure mStaff","Observability-reliability","priority::1","team::Reliability","workflow-infra::Done"],"milestone":null,"assignees":[{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},{"id":2222520,"username":"dawsmith","name":"Dave Smith","state":"active","avatar_url":"https://secure.gravatar.com/avatar/ef341e061f6b86461626e64c5fbcfe52?s=80\u0026d=identicon","web_url":"https://gitlab.com/dawsmith"},{"id":2360513,"username":"glopezfernandez","name":"Gerardo Lopez-Fernandez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2360513/avatar.png","web_url":"https://gitlab.com/glopezfernandez"}],"author":{"id":2360513,"username":"glopezfernandez","name":"Gerardo Lopez-Fernandez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2360513/avatar.png","web_url":"https://gitlab.com/glopezfernandez"},"type":"ISSUE","assignee":{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},"user_notes_count":0,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7467","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7467","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7467/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7467/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7467","relative":"#7467","full":"gitlab-com/gl-infra/reliability#7467"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23573661,"iid":7465,"project_id":1304532,"title":"Create Production GKE Clusters","description":"Utilize this issue to:\n* discuss how we want to spec our production GKE cluster(s)\n* decide if we should have 1 cluster for `production` and cluster for `cny`, or if 1 cluster can handle both\n* After decisions are made, either spin up a new issue, or reuse this one to complete the work\n\nOur design documents did not go into the desired detail to complete this implementation.\n\n/cc @gitlab-org/delivery \n/cc @gitlab-com/gl-infra","state":"closed","created_at":"2019-08-07T12:19:55.691Z","updated_at":"2022-08-06T01:03:35.561Z","closed_at":"2019-08-16T13:38:33.085Z","closed_by":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"labels":["Kubernetes::Prep","team::Delivery","terraform","workflow-infra::Done"],"milestone":null,"assignees":[{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"}],"author":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"type":"ISSUE","assignee":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"user_notes_count":23,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7465","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7465","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7465/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7465/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7465","relative":"#7465","full":"gitlab-com/gl-infra/reliability#7465"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":70,"epic":{"id":7650,"iid":70,"title":"Migrate the GitLab Registry Service to Kubernetes","url":"/groups/gitlab-com/gl-infra/-/epics/70","group_id":1112072},"iteration":null,"health_status":null},{"id":23564824,"iid":7460,"project_id":1304532,"title":"Provision short-lived consoles with terraform + chef","description":"Chef doesn't converge on special-case console instances with a name other than \"console\" as seen in https://ops.gitlab.net/gitlab-com/gitlab-com-infrastructure/merge_requests/894. I'll investigate why.","state":"closed","created_at":"2019-08-07T08:03:04.210Z","updated_at":"2022-08-06T01:03:39.339Z","closed_at":"2019-08-07T09:22:52.277Z","closed_by":{"id":3911656,"username":"craigf","name":"Craig Furman","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3911656/avatar.png","web_url":"https://gitlab.com/craigf"},"labels":["workflow-infra::Done"],"milestone":null,"assignees":[{"id":3911656,"username":"craigf","name":"Craig Furman","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3911656/avatar.png","web_url":"https://gitlab.com/craigf"}],"author":{"id":3911656,"username":"craigf","name":"Craig Furman","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3911656/avatar.png","web_url":"https://gitlab.com/craigf"},"type":"ISSUE","assignee":{"id":3911656,"username":"craigf","name":"Craig Furman","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3911656/avatar.png","web_url":"https://gitlab.com/craigf"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7460","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7460","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7460/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7460/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7460","relative":"#7460","full":"gitlab-com/gl-infra/reliability#7460"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23553317,"iid":7456,"project_id":1304532,"title":"Error deploying license.gitlab.com","description":"`sudo chef-client`:\n\n```\n[2019-08-06T20:30:17+00:00] WARN: Resource cron_access from the client is overriding the resource from a cookbook. Please upgrade your cookbook or remove the cookbook from your run_list.\n[2019-08-06T20:30:17+00:00] WARN: Resource cron_access from the client is overriding the resource from a cookbook. Please upgrade your cookbook or remove the cookbook from your run_list.\n[2019-08-06T20:30:17+00:00] WARN: Resource cron_manage from the client is overriding the resource from a cookbook. Please upgrade your cookbook or remove the cookbook from your run_list.\n[2019-08-06T20:30:17+00:00] WARN: Resource cron_d from the client is overriding the resource from a cookbook. Please upgrade your cookbook or remove the cookbook from your run_list.\n[2019-08-06T20:30:17+00:00] WARN: Resource chef_handler from the client is overriding the resource from a cookbook. Please upgrade your cookbook or remove the cookbook from your run_list.\n[2019-08-06T20:30:17+00:00] WARN: Resource zypper_repo from the client is overriding the resource from a cookbook. Please upgrade your cookbook or remove the cookbook from your run_list.\nRecipe: gitlab-exporters::chef_client\n  * chef_gem[prometheus-client] action install (up to date)\n  * directory[/var/chef/handlers] action create (up to date)\n  * cookbook_file[/var/chef/handlers/prometheus_handler.rb] action create (up to date)\n  * chef_handler[PrometheusHandler] action enable (up to date)\n  \n  ================================================================================\n  Recipe Compile Error in /var/chef/cache/cookbooks/cookbook-license-gitlab-com/recipes/default.rb\n  ================================================================================\n  \n  NoMethodError\n  -------------\n  undefined method `supports' for Chef::Resource::User::LinuxUser\n  \n  Cookbook Trace:\n  ---------------\n    /var/chef/cache/cookbooks/cookbook-license-gitlab-com/recipes/user.rb:12:in `block in from_file'\n    /var/chef/cache/cookbooks/cookbook-license-gitlab-com/recipes/user.rb:9:in `from_file'\n    /var/chef/cache/cookbooks/cookbook-license-gitlab-com/recipes/default.rb:9:in `from_file'\n  \n  Relevant File Content:\n  ----------------------\n  /var/chef/cache/cookbooks/cookbook-license-gitlab-com/recipes/user.rb:\n  \n    5:  #\n    6:  # Copyright 2016, GitLab Inc.\n    7:  #\n    8:  \n    9:  user 'gitlab-license' do\n   10:    shell '/bin/false'\n   11:    system true\n   12\u003e\u003e   supports :manage_home =\u003e true\n   13:  end\n   14:  \n   15:  directory '/home/gitlab-license' do\n   16:    recursive true\n   17:    owner 'gitlab-license'\n   18:    group 'gitlab-license'\n   19:  end\n   20:  \n  \n  System Info:\n  ------------\n  chef_version=14.13.11\n  platform=ubuntu\n  platform_version=14.04\n  ruby=ruby 2.5.5p157 (2019-03-15 revision 67260) [x86_64-linux]\n  program_name=/usr/bin/chef-client\n  executable=/opt/chef/bin/chef-client\n  \n  \n  Running handlers:\n[2019-08-06T20:30:21+00:00] ERROR: Running exception handlers\n    - PrometheusHandler\n  Running handlers complete\n[2019-08-06T20:30:21+00:00] ERROR: Exception handlers complete\n  Chef Client failed. 0 resources updated in 19 seconds\n[2019-08-06T20:30:21+00:00] FATAL: Stacktrace dumped to /var/chef/cache/chef-stacktrace.out\n[2019-08-06T20:30:21+00:00] FATAL: Please provide the contents of the stacktrace.out file if you file a bug report\n[2019-08-06T20:30:21+00:00] FATAL: NoMethodError: undefined method `supports' for Chef::Resource::User::LinuxUser\n```","state":"closed","created_at":"2019-08-06T20:31:30.681Z","updated_at":"2022-08-06T01:03:53.898Z","closed_at":"2019-08-08T01:17:24.420Z","closed_by":{"id":367626,"username":"alejandro","name":"Alejandro Rodr√≠guez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"},"labels":["deploy","oncall","workflow-infra::Done"],"milestone":null,"assignees":[{"id":367626,"username":"alejandro","name":"Alejandro Rodr√≠guez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"}],"author":{"id":280339,"username":"rdavila","name":"Rub√©n D√°vila","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/280339/avatar.png","web_url":"https://gitlab.com/rdavila"},"type":"ISSUE","assignee":{"id":367626,"username":"alejandro","name":"Alejandro Rodr√≠guez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7456","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7456","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7456/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7456/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7456","relative":"#7456","full":"gitlab-com/gl-infra/reliability#7456"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23551782,"iid":7453,"project_id":1304532,"title":"Improve error-handling in Postgres graceful-failover script","description":"**Goals:**\n\nImprove the error-handling of our [`graceful-failover` script](https://ops.gitlab.net/gitlab-cookbooks/chef-repo/blob/master/bin/graceful-failover):\n* The script appears to have killed itself during error-handling, before calling its `resume_pgbouncer` function.\n* The deadlines of 10 and 5 seconds appears to not always be long enough to complete all of the PgBouncer PAUSE operations.  Consider tuning those deadlines.\n\n**Background:**\n\nThe [`graceful-failover` script](https://ops.gitlab.net/gitlab-cookbooks/chef-repo/blob/master/bin/graceful-failover) automates the steps of switching which postgres instance is currently the primary (writable) node:\n* Identify the current primary member of the given environment's Patroni cluster.\n* Issue the `PAUSE` command to the PgBouncer instances used by db clients that need write access.\n* Wait for up to 10 seconds for the `PAUSE` to complete on all PgBouncer instances.\n* If still waiting, kill all active or idle-in-transaction db sessions on the primary Postgres node.\n* Wait for up to 5 more seconds for the `PAUSE` to complete on all PgBouncer instances.\n* If still waiting, try to abort: Kill the `knife` command that was trying to issue the `PAUSE` commands, issue a `RESUME` command to all PgBouncers, and then exit the script.\n* At this point in the script, assume the `PAUSE` succeeded.\n* Tell Patroni to run the switchover immediately, preferring the specified node as the new primary.\n* Unpause all PgBouncer instances.\n\nDuring today's production maintenance, the script had 2 problems:\n1. The PAUSE command was slow enough to reach the script's 1st and 2nd deadline.  That is abnormal, and we should look for ways to reduce the chances of that happening.  Note that the PgBouncer [PAUSE command](https://pgbouncer.github.io/usage.html#pause-db) is a blocking operation, so the duration is partially dependent on client behavior.\n2. The error-handling routine failed to reach the line that would un-pause the PgBouncer instances.  That left PgBouncers in a paused state, causing extended downtime.\n\nDetails of today's automation failure are logged in [this production change issue](https://gitlab.com/gitlab-com/gl-infra/production/issues/952#note_200807981).","state":"closed","created_at":"2019-08-06T19:01:06.054Z","updated_at":"2022-08-16T17:01:09.371Z","closed_at":"2022-08-16T17:01:00.687Z","closed_by":{"id":10167447,"username":"afappiano","name":"Anthony Fappiano","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/10167447/avatar.png","web_url":"https://gitlab.com/afappiano"},"labels":["Database","team::Reliability","workflow-infra::Done"],"milestone":null,"assignees":[],"author":{"id":3947902,"username":"msmiley","name":"Matt Smiley","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3947902/avatar.png","web_url":"https://gitlab.com/msmiley"},"type":"ISSUE","assignee":null,"user_notes_count":8,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7453","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7453","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7453/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7453/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7453","relative":"#7453","full":"gitlab-com/gl-infra/reliability#7453"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23551529,"iid":7452,"project_id":1304532,"title":"Automate terraform for env-projects","description":"Update gitlab-ci.yml in gitlab-com/gitlab-com-infrastructure\u003e to automatically plan/apply configurations in `environments/env-projects` as well as the other application-centric environments. This environment may need to be handled a little differently because of the inherent circular dependencies. There are multiple approaches to handle bootstrapping the remote state for the genesis project the first time, ([here](https://www.monterail.com/blog/chicken-or-egg-terraforms-remote-backend) is an example [with sample code](https://github.com/monterail/terraform-bootstrap-example))","state":"closed","created_at":"2019-08-06T18:45:22.074Z","updated_at":"2022-08-16T17:00:35.779Z","closed_at":"2022-08-16T17:00:35.764Z","closed_by":{"id":10167447,"username":"afappiano","name":"Anthony Fappiano","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/10167447/avatar.png","web_url":"https://gitlab.com/afappiano"},"labels":["automation","team::Reliability","terraform","workflow-infra::Done"],"milestone":null,"assignees":[],"author":{"id":693144,"username":"craig","name":"Craig Barrett","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c8dfa1ca41754b9409068e5e42080cd2?s=80\u0026d=identicon","web_url":"https://gitlab.com/craig"},"type":"ISSUE","assignee":null,"user_notes_count":5,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7452","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7452","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7452/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7452/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7452","relative":"#7452","full":"gitlab-com/gl-infra/reliability#7452"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":219,"epic":{"id":46451,"iid":219,"title":"Terraform Improvements Backlog","url":"/groups/gitlab-com/gl-infra/-/epics/219","group_id":1112072},"iteration":null,"health_status":null},{"id":23551395,"iid":7451,"project_id":1304532,"title":"Add non-core GCP projects to env-projects","description":"Add `infra-vault` (and other?) project(s) to the same configuration as our core projects under `environments/env-projects` in gitlab-com/gitlab-com-infrastructure\u003e to make everything (more?) consistent","state":"closed","created_at":"2019-08-06T18:38:16.005Z","updated_at":"2022-08-16T16:59:48.853Z","closed_at":"2022-08-16T16:59:48.842Z","closed_by":{"id":10167447,"username":"afappiano","name":"Anthony Fappiano","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/10167447/avatar.png","web_url":"https://gitlab.com/afappiano"},"labels":["automation","team::Reliability","terraform","workflow-infra::Done"],"milestone":null,"assignees":[],"author":{"id":693144,"username":"craig","name":"Craig Barrett","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c8dfa1ca41754b9409068e5e42080cd2?s=80\u0026d=identicon","web_url":"https://gitlab.com/craig"},"type":"ISSUE","assignee":null,"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7451","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7451","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7451/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7451/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7451","relative":"#7451","full":"gitlab-com/gl-infra/reliability#7451"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23551276,"iid":7448,"project_id":1304532,"title":"Use one consistent method to manage secrets buckets","description":"We have added the `env-projects` environment to gitlab-com/gitlab-com-infrastructure\u003e in order to start managing GCP projects and the service accounts used to provision resources into those projects via infrastructure-as-code (terraform) using the https://ops.gitlab.net/gitlab-com/gl-infra/terraform-modules/google/project module. As a follow-on step, we need to sort out how we handle [the secrets bucket](https://ops.gitlab.net/gitlab-com/gl-infra/terraform-modules/google/project/blob/8846b4b6ba45d1917ceaa1b33cc465b085a9d35c/main.tf#L29) - we have conflicting buckets created in multiple different modules, and the `project` module likely isn't the best place for them.\n\nSome are created using the `project` module, while others are created using the `gitlab-storage` module, and we have various permutations of attributes in either case.","state":"closed","created_at":"2019-08-06T18:31:15.444Z","updated_at":"2022-08-06T01:03:56.699Z","closed_at":"2019-10-21T17:59:13.878Z","closed_by":{"id":693144,"username":"craig","name":"Craig Barrett","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c8dfa1ca41754b9409068e5e42080cd2?s=80\u0026d=identicon","web_url":"https://gitlab.com/craig"},"labels":["auto updated","automation","priority::4","team::Reliability","terraform","workflow-infra::Done"],"milestone":{"id":1006849,"iid":45,"group_id":1112072,"title":"W41 Secure \u0026 Defend","description":"## Calendar\r\n\r\n|             \t| M 07 Oct \t| T 08 Oct \t| W 09 Oct \t| Th 10 Oct  | F 11 Oct\r\n|-------------\t|----------\t|----------\t|----------\t|----------- |----------\t\r\n| @bjk-gitlab \t| -        \t| -       \t| -        \t| -          | -\r\n| @craig      \t| On-call     \t| -        \t| -        \t| -          | -         \t\r\n| @craigf     \t| -        \t| -        \t| -   \t| On-call    | On-call\r\n| @cmiskell   \t| Moving   \t| Moving    | Moving  \t| Moving     | Moving  \t\r\n| @hphilipps  \t| Vacation \t| Vacation  | Vacation  | Vacation   | Vacation         \t\r\n| @msmiley    \t| -      \t| -      \t| -      \t| -          | -\r\n\r\nW41 working days: 16\r\n\r\n|             \t| M 14 Oct \t| T 15 Oct \t| W 16 Oct \t| Th 17 Oct  | F 18 Oct \r\n|-------------\t|----------\t|----------\t|----------\t|----------- |----------\r\n| @bjk-gitlab \t| -        \t| -        \t| -   \t    | -          | -   \r\n| @craig      \t| -        \t| -       \t| -       \t| -          | - \r\n| @craigf     \t| On-call  \t| On-call  \t| -      \t| -          | -   \r\n| @cmiskell   \t| -      \t| -        \t| -        \t| -          | Moving\r\n| @hphilipps  \t| Ill        \t| Ill        \t| Ill        \t| -          | - \r\n| @msmiley    \t| -        \t| On-call   | On-call  \t| On-call    | On-call\r\n\r\nW42 working days: 21\r\n\r\n\u003chr\u003e\r\n\r\n**Total working days: 37**","state":"closed","created_at":"2019-09-18T18:11:09.033Z","updated_at":"2019-11-12T23:45:39.396Z","due_date":"2019-10-20","start_date":"2019-10-07","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/45"},"assignees":[{"id":693144,"username":"craig","name":"Craig Barrett","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c8dfa1ca41754b9409068e5e42080cd2?s=80\u0026d=identicon","web_url":"https://gitlab.com/craig"}],"author":{"id":693144,"username":"craig","name":"Craig Barrett","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c8dfa1ca41754b9409068e5e42080cd2?s=80\u0026d=identicon","web_url":"https://gitlab.com/craig"},"type":"ISSUE","assignee":{"id":693144,"username":"craig","name":"Craig Barrett","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c8dfa1ca41754b9409068e5e42080cd2?s=80\u0026d=identicon","web_url":"https://gitlab.com/craig"},"user_notes_count":4,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7448","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7448","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7448/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7448/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7448","relative":"#7448","full":"gitlab-com/gl-infra/reliability#7448"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23551198,"iid":7447,"project_id":1304532,"title":"Document bootstrapping GCP projects with terraform","description":"We have added the `env-projects` environment to gitlab-com/gitlab-com-infrastructure\u003e in order to start managing GCP projects and the service accounts used to provision resources into those projects via infrastructure-as-code (terraform) using the https://ops.gitlab.net/gitlab-com/gl-infra/terraform-modules/google/project module. As a follow-on step, we need to add/update documentation for project bootstrap and management process (especially how to handle circular dependency to manage `env-zero` in terraform (if possible), as well)","state":"closed","created_at":"2019-08-06T18:27:15.229Z","updated_at":"2022-08-06T01:03:57.266Z","closed_at":"2020-05-05T18:05:58.707Z","closed_by":{"id":693144,"username":"craig","name":"Craig Barrett","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c8dfa1ca41754b9409068e5e42080cd2?s=80\u0026d=identicon","web_url":"https://gitlab.com/craig"},"labels":["automation","team::Reliability","terraform","workflow-infra::Done"],"milestone":null,"assignees":[],"author":{"id":693144,"username":"craig","name":"Craig Barrett","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c8dfa1ca41754b9409068e5e42080cd2?s=80\u0026d=identicon","web_url":"https://gitlab.com/craig"},"type":"ISSUE","assignee":null,"user_notes_count":0,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7447","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7447","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7447/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7447/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7447","relative":"#7447","full":"gitlab-com/gl-infra/reliability#7447"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23551045,"iid":7446,"project_id":1304532,"title":"Add IAM permissions for terraform service accounts","description":"We have added the `env-projects` environment to gitlab-com/gitlab-com-infrastructure\u003e in order to start managing GCP projects and the service accounts used to provision resources into those projects via infrastructure-as-code (terraform) using the https://ops.gitlab.net/gitlab-com/gl-infra/terraform-modules/google/project module. As a follow-on step, we need to add/import/update the relevant IAM permissions for those service accounts.","state":"closed","created_at":"2019-08-06T18:24:57.184Z","updated_at":"2022-08-06T01:03:57.777Z","closed_at":"2019-08-16T20:26:02.402Z","closed_by":{"id":693144,"username":"craig","name":"Craig Barrett","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c8dfa1ca41754b9409068e5e42080cd2?s=80\u0026d=identicon","web_url":"https://gitlab.com/craig"},"labels":["automation","team::Reliability","terraform","workflow-infra::Done"],"milestone":null,"assignees":[{"id":693144,"username":"craig","name":"Craig Barrett","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c8dfa1ca41754b9409068e5e42080cd2?s=80\u0026d=identicon","web_url":"https://gitlab.com/craig"}],"author":{"id":693144,"username":"craig","name":"Craig Barrett","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c8dfa1ca41754b9409068e5e42080cd2?s=80\u0026d=identicon","web_url":"https://gitlab.com/craig"},"type":"ISSUE","assignee":{"id":693144,"username":"craig","name":"Craig Barrett","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c8dfa1ca41754b9409068e5e42080cd2?s=80\u0026d=identicon","web_url":"https://gitlab.com/craig"},"user_notes_count":6,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7446","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7446","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7446/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7446/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7446","relative":"#7446","full":"gitlab-com/gl-infra/reliability#7446"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23549558,"iid":7445,"project_id":1304532,"title":"Understand why Postgres failover caused a brief outage","description":"When failing over the master node, postgres caused a brief outage.\n\nhttps://gitlab.com/gitlab-com/gl-infra/production/issues/1035\n\nThis issue is to understand why.\n\n/cc @abrandl @Finotto","state":"closed","created_at":"2019-08-06T17:12:02.055Z","updated_at":"2022-08-06T01:03:58.484Z","closed_at":"2019-08-07T11:47:25.775Z","closed_by":{"id":1562869,"username":"abrandl","name":"Andreas Brandl","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1562869/avatar.png","web_url":"https://gitlab.com/abrandl"},"labels":["Database","OnGres::Support","Service::Postgres","workflow-infra::Done"],"milestone":null,"assignees":[{"id":1562869,"username":"abrandl","name":"Andreas Brandl","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1562869/avatar.png","web_url":"https://gitlab.com/abrandl"}],"author":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"type":"ISSUE","assignee":{"id":1562869,"username":"abrandl","name":"Andreas Brandl","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1562869/avatar.png","web_url":"https://gitlab.com/abrandl"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7445","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7445","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7445/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7445/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7445","relative":"#7445","full":"gitlab-com/gl-infra/reliability#7445"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23549530,"iid":7444,"project_id":1304532,"title":"Manage the registry application grafana dashboards with libsonnet","description":"* https://dashboards.gitlab.net/d/CoBSgj8iz/application-info?orgId=1\n* https://dashboards.gitlab.net/d/oWe9aYxmk/pod-metrics?orgId=1\n\nThese need to be converted over from the current manual creation method into libsonnet.\n\n\n/cc @gitlab-com/gl-infra","state":"closed","created_at":"2019-08-06T17:10:27.257Z","updated_at":"2022-08-06T01:03:59.192Z","closed_at":"2019-10-14T19:23:15.112Z","closed_by":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"labels":["priority::4","workflow-infra::Done"],"milestone":null,"assignees":[{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"}],"author":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"type":"ISSUE","assignee":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"user_notes_count":9,"merge_requests_count":0,"upvotes":2,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7444","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7444","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7444/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7444/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7444","relative":"#7444","full":"gitlab-com/gl-infra/reliability#7444"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":85,"epic":{"id":11045,"iid":85,"title":"Items to complete after transitioning GitLab.com Container Registry from Virtual Machines to GKE Pods","url":"/groups/gitlab-com/gl-infra/-/epics/85","group_id":1112072},"iteration":null,"health_status":null},{"id":23521299,"iid":7440,"project_id":1304532,"title":"Why do the PgBouncer hosts have a very uneven distribution of client connections?","description":"**Problem:**\n\nA large majority of database client connections are being handled by a single PgBouncer instance, despite the fact that 2 PgBouncer instances are active backends in our Google Internal TCP Load Balancer.  This imbalance defeats our attempt to alleviate our bottleneck of PgBouncer's CPU saturation.\n\n**Goal:**\n\nLearn why traffic is not being roughly equally distributed among the active members of the Google Internal TCP Load Balancer (ILB).  This is a research task that should result in a recommendation.\n\n**Alternatives:**\n\nIf we cannot fix this imbalance, we could instead use HAProxy as a load balancer in front of several PgBouncer instances.  This would optionally let us run multiple PgBouncer instances per host.  However, unlike the Google ILB, HAProxy would be an additional TCP endpoint, adding more network latency and another component to manage.\n\n**Background:**\n\n - Recently (~4-8 weeks ago) in response to a performance problem we changed how database clients connect to the primary Postgres instance in our Patroni cluster.\n   - Previously, all clients needing write-access to Postgres would connect to a single PgBouncer instance running on the same host as the primary Postgres instance.\n   - PgBouncer is a single-threaded process, so it can use at most 1 CPU's worth of compute cycles.\n   - That PgBouncer instance's workload sometimes saturated its 1 CPU ceiling under our peak daily workload.\n   - To spread that workload among more CPUs, we needed to add more PgBouncer instances and treat them as a pool.\n - We reconfigured the DB Clients connect to the primary Postgres database via a Google Internal TCP Load Balancer (ILB) that points to a pool of currently 2 active PgBouncer instances.\n   - The ILB is not a proxy; it is a set of network routing rules that lets clients talk directly to the backend service instances (PgBouncer hosts).\n   - The ILB's backend-service actually contains 2 active hosts and 1 inactive host.  Only the 2 active hosts matter for this analysis.\n - Surprisingly, the workload is *not* evenly distributed among the PgBouncer hosts.\n   - The number of established connections from clients to PgBouncer is very unevenly distributed among the 2 active PgBouncer hosts.\n   - This unevenness defeats our goal of spreading the workload among multiple PgBouncer instances.\n   - Clients whose hostnames start with \"web\" and \"git\" seem to be the most strongly affected by this bias for preferring to connect to host \"pgbouncer-03\" rather than \"pgbouncer-02\".","state":"closed","created_at":"2019-08-05T21:01:56.116Z","updated_at":"2021-06-24T08:10:09.930Z","closed_at":"2019-10-03T19:04:40.220Z","closed_by":{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},"labels":["Database","Discussion","team::Reliability","workflow-infra::Done"],"milestone":{"id":989400,"iid":38,"group_id":1112072,"title":"Database September part 1","description":"","state":"closed","created_at":"2019-09-03T10:14:40.685Z","updated_at":"2019-10-09T16:21:15.363Z","due_date":"2019-09-13","start_date":"2019-09-02","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/38"},"assignees":[{"id":3947902,"username":"msmiley","name":"Matt Smiley","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3947902/avatar.png","web_url":"https://gitlab.com/msmiley"}],"author":{"id":3947902,"username":"msmiley","name":"Matt Smiley","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3947902/avatar.png","web_url":"https://gitlab.com/msmiley"},"type":"ISSUE","assignee":{"id":3947902,"username":"msmiley","name":"Matt Smiley","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3947902/avatar.png","web_url":"https://gitlab.com/msmiley"},"user_notes_count":8,"merge_requests_count":0,"upvotes":2,"downvotes":0,"due_date":"2019-08-09","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7440","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7440","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7440/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7440/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7440","relative":"#7440","full":"gitlab-com/gl-infra/reliability#7440"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2,"epic":{"id":1050,"iid":2,"title":"Postgres DB Availability work","url":"/groups/gitlab-com/gl-infra/-/epics/2","group_id":1112072,"human_readable_end_date":"May 8, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":23520099,"iid":7438,"project_id":1304532,"title":"RCA: Note Creation on commit via API Calls Halted `new_note` Sidekiq Queue","description":"\u003c!--\n**Please note:** if the incident relates to sensitive data, or is security related consider\nlabeling this issue with ~security and mark it confidential.\n*** \n--\u003e\n\nIncident: gitlab-com/gl-infra/production#1028\n\n## Summary\n\nA user generated many notes on a single commit via API calls which slowed down the `new_note` sidekiq queue and blocked sending notifications for issue and MR comments for all customers.\n\n- Service(s) affected : ~\"Service:Sidekiq\" \n- Team attribution : \n- Minutes downtime or degradation : 220\n\nFor calculating duration of event, use the [Platform Metrics Dashboard](https://dashboards.gitlab.net/d/ZUei7TkWz/platform-metrics?orgId=1) to look at appdex and SLO violations.\n\n## Impact \u0026 Metrics\n\nStart with the following:\n\n- What was the impact of the incident?\n  - blocking to send out pending issue- and MR comment notifications\n- Who was impacted by this incident?\n  - all users supposed to get notifications\n- How did the incident impact customers?\n  - notifications arrived with a delay of up to 220m\n- How many attempts were made to access the impacted service/feature?\n- How many customers were affected?\n- How many customers tried to access the impacted service/feature?\n\nInclude any additional metrics that are of relevance.\n\n - Up to 14,000 notifications queued up\n\nProvide any relevant graphs that could help understand the impact of the incident and its dynamics.\n\n![image](/uploads/7127adb9cf0f94cac69c30480b2fa1c1/image.png)\n\n## Detection \u0026 Response\n\nStart with the following:\n\n- How was the incident detected?\n  - [pagerduty alert](https://gitlab.pagerduty.com/incidents/PPF0U8C) for `new_note` queue size \n- Did alarming work as expected?\n  - Alarming for queue size worked, but the alert threshold was reached over an hour after the incident started\n- How long did it take from the start of the incident to its detection?\n  - 68m\n- How long did it take from detection to remediation?\n  - 152m\n- Were there any issues with the response to the incident?\n  - it wasn't easy to get hold of a backend engineer at the beginning\n\n## Root Cause Analysis\n\n`new_note` notifications have been delayed.\n\n1. Why? - They piled up in the `new_note` sidekiq queue. \n2. Why? - The queue was processing jobs considerably slower.\n3. Why? - Many long-running jobs have been added to the queue.\n4. Why? - A commit with a huge amount of comments got thousands of new comments and processing a commit with many comments is very slow.\n5. Why? - Apparently an automation of a user was creating those comments via API inadvertently.\n\n## What went well\n\nOur monitoring detected the issue and paged the EOC. Backend engineers did a great job of finding and mitigating the root cause. Thanks to @andrew for jumping on the incident call quickly.\n\n## What can be improved\n\n- We should get alerted sooner when notes are stuck in the queue. E.g. not only alerting by queue size but also by job duration.\n- Limit the amount of notes a user can create per time and on one commit.\n- Make `new_note` processing more efficient on commits with many notes.\n- We had the same kind of incident [a year ago](https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/4230) and should have improved alerting and protections against too many notes since then.\n\n\n## Corrective actions\n\n* [ ] https://gitlab.com/gitlab-org/gitlab-ce/issues/46676\n* [x] https://gitlab.com/gitlab-org/gitlab-ce/issues/60857\n* [ ] improve alerting https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/7752\n\n## Guidelines\n\n* [Blameless RCA Guideline](https://about.gitlab.com/handbook/infrastructure/#rca)\n* [5 whys](https://en.wikipedia.org/wiki/5_Whys)","state":"closed","created_at":"2019-08-05T19:49:35.326Z","updated_at":"2022-08-07T19:02:42.259Z","closed_at":"2019-09-03T10:05:51.131Z","closed_by":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"labels":["Background Processing","IncidentReview","SRE:On-call","oncall","team::Reliability","workflow-infra::Done"],"milestone":null,"assignees":[{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"}],"author":{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},"type":"ISSUE","assignee":{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2019-08-09","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7438","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":3,"completed_count":1},"weight":2,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7438","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7438/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7438/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7438","relative":"#7438","full":"gitlab-com/gl-infra/reliability#7438"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23517805,"iid":7437,"project_id":1304532,"title":"Update DBRE section of On-Call Handbook section","description":"The [DBRE section](https://about.gitlab.com/handbook/on-call/#dbre) of the On-Call Handbook reads:\n\n\u003e For database-related issues the DBRE on-call can be paged.\n\u003e Responding to pages is on a best-effort basis and there is no expected response time.\n\u003e Alerts are not triggered via automation. All escalations to the DBREs are initiated by a human, either the SRE or manager on-call.\n\nThis needs to be updated, given that we do have an expected response time. Also, I believe we do have automated alerts.","state":"closed","created_at":"2019-08-05T18:14:29.121Z","updated_at":"2022-08-07T19:02:42.922Z","closed_at":"2019-08-20T04:26:21.882Z","closed_by":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"labels":["Infrastructure mStaff","priority::1","severity::1","team::Reliability","workflow-infra::Done"],"milestone":null,"assignees":[{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"}],"author":{"id":2360513,"username":"glopezfernandez","name":"Gerardo Lopez-Fernandez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2360513/avatar.png","web_url":"https://gitlab.com/glopezfernandez"},"type":"ISSUE","assignee":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"user_notes_count":6,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2019-08-14","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7437","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7437","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7437/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7437/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7437","relative":"#7437","full":"gitlab-com/gl-infra/reliability#7437"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23509114,"iid":7433,"project_id":1304532,"title":"FY20-Q3 Infrastructure IACV OKR: Raise GitLab.com Availability from 96.64% to a consistent 99.95% =\u003e 0%","description":"* [ ] Key result: MTTD, MTTR, MTBF, and MTTP PIs to be at OK health and a minimum of level 2 maturity `=\u003e 0%, comment`\n* [ ] Key result: 100% of services have fully defined and observable service levels, error budgets, and capacity planning `=\u003e 0%, comment`\n* [ ] Key result: 50% of services running on Kubernetes `=\u003e 0%, comment`","state":"closed","created_at":"2019-08-05T13:50:49.228Z","updated_at":"2021-06-24T08:09:18.067Z","closed_at":"2020-08-17T14:43:31.257Z","closed_by":{"id":2360513,"username":"glopezfernandez","name":"Gerardo Lopez-Fernandez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2360513/avatar.png","web_url":"https://gitlab.com/glopezfernandez"},"labels":["Infrastructure mStaff","OKR","VP of Infrastructure","auto updated","workflow-infra::Done"],"milestone":null,"assignees":[{"id":2360513,"username":"glopezfernandez","name":"Gerardo Lopez-Fernandez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2360513/avatar.png","web_url":"https://gitlab.com/glopezfernandez"}],"author":{"id":2360513,"username":"glopezfernandez","name":"Gerardo Lopez-Fernandez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2360513/avatar.png","web_url":"https://gitlab.com/glopezfernandez"},"type":"ISSUE","assignee":{"id":2360513,"username":"glopezfernandez","name":"Gerardo Lopez-Fernandez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2360513/avatar.png","web_url":"https://gitlab.com/glopezfernandez"},"user_notes_count":5,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2019-10-31","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7433","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":3,"completed_count":0},"weight":8,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7433","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7433/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7433/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7433","relative":"#7433","full":"gitlab-com/gl-infra/reliability#7433"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23508275,"iid":7432,"project_id":1304532,"title":"Adjust number of DBRE reqs","description":"","state":"closed","created_at":"2019-08-05T13:27:08.059Z","updated_at":"2022-08-07T19:02:45.897Z","closed_at":"2020-10-21T12:13:22.023Z","closed_by":{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},"labels":["Infrastructure mStaff","VP of Infrastructure","auto updated","hiring","workflow-infra::Done"],"milestone":null,"assignees":[{"id":2360513,"username":"glopezfernandez","name":"Gerardo Lopez-Fernandez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2360513/avatar.png","web_url":"https://gitlab.com/glopezfernandez"}],"author":{"id":2360513,"username":"glopezfernandez","name":"Gerardo Lopez-Fernandez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2360513/avatar.png","web_url":"https://gitlab.com/glopezfernandez"},"type":"ISSUE","assignee":{"id":2360513,"username":"glopezfernandez","name":"Gerardo Lopez-Fernandez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2360513/avatar.png","web_url":"https://gitlab.com/glopezfernandez"},"user_notes_count":3,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2019-08-16","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7432","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7432","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7432/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7432/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7432","relative":"#7432","full":"gitlab-com/gl-infra/reliability#7432"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23508038,"iid":7431,"project_id":1304532,"title":"FY20-Q3 CI/CD \u0026 Enablement: Drive all user-visible services‚Äô MTBF from 4 days to 6 days =\u003e 0%","description":"Current MTBF calculations spreadsheet: https://docs.google.com/spreadsheets/d/1bCEUQbWMccVm1dfBrOFtXjyDVCflHu4rB6htOaC_0yI/edit#gid=1150439504\n\n4 days to 6 days is based on calculation of MTBF for S1/S2 incidents","state":"closed","created_at":"2019-08-05T13:20:26.323Z","updated_at":"2022-08-07T19:02:47.446Z","closed_at":"2020-06-08T17:18:04.211Z","closed_by":{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},"labels":["Infrastructure mStaff","OKR","auto updated","team::Reliability","workflow-infra::Done"],"milestone":null,"assignees":[{"id":2222520,"username":"dawsmith","name":"Dave Smith","state":"active","avatar_url":"https://secure.gravatar.com/avatar/ef341e061f6b86461626e64c5fbcfe52?s=80\u0026d=identicon","web_url":"https://gitlab.com/dawsmith"}],"author":{"id":2360513,"username":"glopezfernandez","name":"Gerardo Lopez-Fernandez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2360513/avatar.png","web_url":"https://gitlab.com/glopezfernandez"},"type":"ISSUE","assignee":{"id":2222520,"username":"dawsmith","name":"Dave Smith","state":"active","avatar_url":"https://secure.gravatar.com/avatar/ef341e061f6b86461626e64c5fbcfe52?s=80\u0026d=identicon","web_url":"https://gitlab.com/dawsmith"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2019-10-31","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7431","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7431","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7431/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7431/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7431","relative":"#7431","full":"gitlab-com/gl-infra/reliability#7431"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23501053,"iid":7428,"project_id":1304532,"title":"FY20-Q3 OKR: Drive all user-visible services‚Äô MTTD from Unknown to 5 min =\u003e 0%","description":"* [ ] Key result: 70% (7/10) DevOps lifecycle stages have SLI dashboards for development to monitor. `=\u003e 0%, comment`\n* [ ] Key result: 100% of team-owned services have fully defined and observable service levels, error budgets, and capacity planning `=\u003e 0%, comment`\n* [ ] Key result: 50% of team-owned services running on Kubernetes `=\u003e 0%, comment`\n* [ ] Key result: Perform weekly load-testing in staging on 2 team-owned services `=\u003e 0%, comment`","state":"closed","created_at":"2019-08-05T11:03:06.948Z","updated_at":"2022-08-07T19:02:49.605Z","closed_at":"2020-06-08T17:18:20.572Z","closed_by":{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},"labels":["Infrastructure mStaff","OKR","team::Reliability","workflow-infra::Done"],"milestone":null,"assignees":[],"author":{"id":2360513,"username":"glopezfernandez","name":"Gerardo Lopez-Fernandez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2360513/avatar.png","web_url":"https://gitlab.com/glopezfernandez"},"type":"ISSUE","assignee":null,"user_notes_count":0,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2019-10-31","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7428","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":4,"completed_count":0},"weight":8,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7428","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7428/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7428/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7428","relative":"#7428","full":"gitlab-com/gl-infra/reliability#7428"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23499956,"iid":7427,"project_id":1304532,"title":"FY20-Q3 Dev \u0026 Ops OKR: Drive all user-visible services‚Äô MTTR from 4.66 to 2 (days) =\u003e 30%","description":"* [ ] Key result: 100% of incidents have severities, RCAs, and error budgets accounted for `=\u003e 0%, comment`\n* [ ] Key result: 100% of team-owned services have fully defined and observable service levels, error budgets, and capacity planning `=\u003e 0%, comment`\n* [ ] Key result: Migrate Postgresql and his ecosystem to use stackgres( kubernetes) in staging. `=\u003e 0%, comment`","state":"closed","created_at":"2019-08-05T10:47:30.748Z","updated_at":"2022-08-07T19:02:50.306Z","closed_at":"2020-06-08T17:18:12.339Z","closed_by":{"id":528408,"username":"asandov","name":"AnthonySandoval","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/528408/avatar.png","web_url":"https://gitlab.com/asandov"},"labels":["Infrastructure mStaff","OKR","auto updated","team::Reliability","workflow-infra::Done"],"milestone":null,"assignees":[{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"}],"author":{"id":2360513,"username":"glopezfernandez","name":"Gerardo Lopez-Fernandez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2360513/avatar.png","web_url":"https://gitlab.com/glopezfernandez"},"type":"ISSUE","assignee":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2019-10-31","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7427","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":3,"completed_count":0},"weight":8,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7427","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7427/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7427/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7427","relative":"#7427","full":"gitlab-com/gl-infra/reliability#7427"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23451215,"iid":7422,"project_id":1304532,"title":"Error when deploying customers.gitlab.com","description":"```\n    - gitlab-mitigate-sackpanic (0.1.3)\n  - gitlab_users (0.1.49)\n  - chef-client (11.2.0)\n  - gitlab-prometheus (1.2.0)\n  - systemd (3.2.4)\n  - windows (6.0.0)\n  - gitlab-server (1.1.0)\n  - gitlab-exporters (1.3.1)\n\nRunning handlers:\n[2019-08-02T20:07:32+00:00] ERROR: Running exception handlers\nRunning handlers complete\n[2019-08-02T20:07:32+00:00] ERROR: Exception handlers complete\nChef Client failed. 0 resources updated in 11 seconds\n[2019-08-02T20:07:32+00:00] FATAL: Stacktrace dumped to /var/chef/cache/chef-stacktrace.out\n[2019-08-02T20:07:32+00:00] FATAL: Please provide the contents of the stacktrace.out file if you file a bug report\n[2019-08-02T20:07:32+00:00] FATAL: Chef::Exceptions::CookbookChefVersionMismatch: Cookbook 'gitlab_application_ruby' version '4.2.3' depends on chef version [\"\u003e= 12.1\", \"\u003c 14\"], but the running chef version is 14.13.11\n```","state":"closed","created_at":"2019-08-02T20:10:26.524Z","updated_at":"2022-08-07T19:02:53.378Z","closed_at":"2019-08-02T20:42:09.115Z","closed_by":{"id":367626,"username":"alejandro","name":"Alejandro Rodr√≠guez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"},"labels":["chef","deploy","oncall","workflow-infra::Done"],"milestone":null,"assignees":[{"id":367626,"username":"alejandro","name":"Alejandro Rodr√≠guez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"}],"author":{"id":280339,"username":"rdavila","name":"Rub√©n D√°vila","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/280339/avatar.png","web_url":"https://gitlab.com/rdavila"},"type":"ISSUE","assignee":{"id":367626,"username":"alejandro","name":"Alejandro Rodr√≠guez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7422","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7422","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7422/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7422/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7422","relative":"#7422","full":"gitlab-com/gl-infra/reliability#7422"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23439311,"iid":7420,"project_id":1304532,"title":"We need a way to test kubernetes application configuration changes locally","description":"Right now testing application changes must happen on an environment, whether that be `gstg` or `pre`.  This is not the safest way to test things if multiple persons are testing.  It would be nice to utilize Docker's Kubernetes integration locally, or minikube, or another tool to test application configuration changes as necessary.\n\n@jarv recently demo'd the use of docker-desktop\n\n@skarbek has toyed with minikube\n\nWe need to ensure that whatever tool we utilize, it's backward compatible with linux and osx.\n\nUse this issue to track progress on making this reality.","state":"closed","created_at":"2019-08-02T13:57:40.644Z","updated_at":"2022-08-07T19:02:55.699Z","closed_at":"2019-08-15T15:47:15.211Z","closed_by":{"id":1254817,"username":"jarv","name":"John Jarvis","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1254817/avatar.png","web_url":"https://gitlab.com/jarv"},"labels":["kubernetes","team::Delivery","workflow-infra::Done"],"milestone":null,"assignees":[{"id":1254817,"username":"jarv","name":"John Jarvis","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1254817/avatar.png","web_url":"https://gitlab.com/jarv"}],"author":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"type":"ISSUE","assignee":{"id":1254817,"username":"jarv","name":"John Jarvis","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1254817/avatar.png","web_url":"https://gitlab.com/jarv"},"user_notes_count":8,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7420","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7420","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7420/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7420/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7420","relative":"#7420","full":"gitlab-com/gl-infra/reliability#7420"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":70,"epic":{"id":7650,"iid":70,"title":"Migrate the GitLab Registry Service to Kubernetes","url":"/groups/gitlab-com/gl-infra/-/epics/70","group_id":1112072},"iteration":null,"health_status":null},{"id":23439198,"iid":7418,"project_id":1304532,"title":"Migration method for GKE registry; configure our get/set weight scripts","description":"Our current scripts used to get/set the weights for haproxy backends currently does not work properly for the registry frontends.  Make the necessary modifications such that we can set the weight of the Kubernetes backed Container Registry backend to allow us to transition between VM's and Kuberenetes nice and easy","state":"closed","created_at":"2019-08-02T13:53:23.683Z","updated_at":"2022-08-07T19:02:56.935Z","closed_at":"2019-08-06T15:33:14.109Z","closed_by":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"labels":["Kubernetes::Prep","chef","team::Delivery","workflow-infra::Done"],"milestone":null,"assignees":[{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"}],"author":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"type":"ISSUE","assignee":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"user_notes_count":5,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/7418","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/7418","notes":"https://gitlab.com/api/v4/projects/1304532/issues/7418/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/7418/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#7418","relative":"#7418","full":"gitlab-com/gl-infra/reliability#7418"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":70,"epic":{"id":7650,"iid":70,"title":"Migrate the GitLab Registry Service to Kubernetes","url":"/groups/gitlab-com/gl-infra/-/epics/70","group_id":1112072},"iteration":null,"health_status":null}]