[{"id":124902511,"iid":17548,"project_id":1304532,"title":"Create three new gitaly storage shard nodes file-{90..92}-stor-gprd for storing new projects","description":"# `Production` Change\n\n### Change Summary\n\nCreate three new gitaly storage shard nodes `file-{90..92}-stor-gprd` for storing new projects.  Why?  Increase capacity for new project repository storage.\n\nMore details: https://gitlab.com/gitlab-com/gl-infra/capacity-planning/-/issues/507\n\n- [ ] [Detailed steps for the change](#detailed-steps-for-the-change)\n- [ ] [Build the new VM instance](#build-the-new-vm-instance)\n- [ ] [Ensure the creation of the storage directory](#ensure-the-creation-of-the-storage-directory)\n- [ ] [Configure the GitLab application so that it is aware of the new node](#configure-the-GitLab-application-so-that-it-is-aware-of-the-new-node)\n- [ ] [Add the new Gitaly node to all our Kubernetes container configuration](#add-the-new-gitaly-node-to-all-our-kubernetes-container-configuration)\n- [ ] [Test the new node](#test-the-new-node)\n- [ ] [Enable the new node in Gitlab](#enable-the-new-node-in-gitlab)\n\n\n### Change Details\n\n1. **Services Impacted**  - ~\"Service::Gitaly\" \n1. **Change Technician**  - @nnelson\n1. **Change Reviewer**    - @cmcfarland \n1. **Time tracking**      - `2 hours`\n1. **Downtime Component** - `zero downtime`\n\n## Meta\n\n- [x] Replace all occurrences of \"`XX`\" with the new gitaly shard node number when executing commands.\n- [x] Set the title of this production change issue to: Create new gitaly storage shard node `file-90-stor-gprd` for storing new projects\n\n\n### Detailed steps for the change\n\nThe following are the detailed steps for the change.\n\n\n### Build the new VM instance\n\n- **pre-conditions for execution of the step**\n  - [x] [Create a new MR](https://ops.gitlab.net/gitlab-com/gl-infra/config-mgmt/-/merge_requests/new).\n    * The commit should increment the `\"node_count\" -\u003e \"default\" -\u003e \"multizone-stor\"` variable setting by the number of new gitlay shards that are being added [around line `533` of the file `environments/gprd/variables.tf`](https://ops.gitlab.net/gitlab-com/gl-infra/config-mgmt/-/blob/master/environments/gprd/variables.tf#L533)\n    * Here is [an example title and description to use for this MR](https://ops.gitlab.net/gitlab-com/gl-infra/config-mgmt/-/merge_requests/1605).\n    - [x] Using the new value of the `multizone-stor` field, change the MR title to: Increment multi-zone storage nodes by [Number of new gitaly shards] to [the new total]\n  - [x] Link: https://ops.gitlab.net/gitlab-com/gl-infra/config-mgmt/-/merge_requests/5150\n  - [x] Have the MR reviewed by a colleague.\n- **execution commands for the step**\n  - [x] Optionally, check quotas before applying the terraform changes. You can check with:\n  ```bash\n  gcloud --project='gitlab-production' compute regions describe us-east1 --format=json | jq -c '.quotas[] | select(.limit \u003e 0) | select(.usage / .limit \u003e 0.5) | { metric, limit, usage }'\n  ```\n  - [x] Merge the MR.\n  - [x] Click the `apply gprd` pipeline stage `play` button.\n- **post-execution validation for the step**\n  - [x] Examine the `gprd apply` pipeline stage output and confirm the absence of relevant errors.\n- **rollback of the step**\n  - [ ] Revert the MR.\n\n\n### Ensure the creation of the storage directory\n\nOnce the gitaly node is created, it will take a few minutes for chef to run on the system, so it may not be immediately available.\n\n- **pre-conditions for execution of the step**\n  - [x] Make sure `chef-client` runs without any errors.\n  ```bash\n  export node='file-90-stor-gprd.c.gitlab-production.internal'\n  bundle exec knife ssh \"fqdn:$node\" \"sudo grep 'Chef Client finished' /var/log/syslog | tail -n 1\"\n  ```\n- **execution commands for the step**\n  - [ ] **If** chef does not converge after 10 minutes or so, then invoke it manually. If chef refuses to run, then something is wrong, and this procedure should be rolled-back.\n  ```bash\n  bundle exec knife ssh \"fqdn:$node\" \"sudo chef-client\"\n  ```\n  - [x] Confirm storage directory `/var/opt/gitlab/git-data/repositories` exists on the file system of the new node.\n  ```bash\n  bundle exec knife ssh \"fqdn:$node\" \"sudo df -hT /var/opt/gitlab/git-data/repositories \u0026\u0026 sudo ls -la /var/opt/gitlab/git-data/ \u0026\u0026 sudo ls -la /var/opt/gitlab/git-data/repositories | head\"\n  ```\n- **post-execution validation for the step**\n  - [x] Confirm that the gitaly service is running\n  ```bash\n  bundle exec knife ssh \"fqdn:$node\" \"sudo gitlab-ctl status gitaly\"\n  ```\n  - [x] Confirm that there are no relevant errors in the logs.\n  ```bash\n  bundle exec knife ssh \"fqdn:$node\" \"sudo grep -i 'error' /var/log/gitlab/gitaly/current | tail\"\n  ```\n- **rollback of the step**\n  - No rollback procedure for this step is necessary.\n  - This step only confirms and verifies steps taken so far.\n\n\n### Configure the GitLab application so that it is aware of the new node\n\nConfigure the GitLab application to include the new node. Note: The GitLab application will consider the new node to be disabled by default.\n\n- **pre-conditions for execution of the step**\n  - [x] Create [a new MR in the `chef-repo` project](https://gitlab.com/gitlab-com/gl-infra/chef-repo/-/merge_requests/new).\n    * Here is [an example title and description to use for this MR](https://gitlab.com/gitlab-com/gl-infra/chef-repo/-/merge_requests/1242).\n    * The commit should consist of the following changes:\n    - [x] Update the `override_attributes.omnibus-gitlab.gitaly.storage` list items of file [`roles/gprd-base-stor-gitaly-common.json`](https://gitlab.com/gitlab-com/gl-infra/chef-repo/-/blob/master/roles/gprd-base-stor-gitaly-common.json#L410), add item(s) similar to:\n    ```json\n                {\n                  \"name\": \"nfs-file90\",\n                  \"path\": \"/var/opt/gitlab/git-data/repositories\"\n                },\n    ```\n    - [x] Update the `default_attributes.omnibus-gitlab.gitlab_rb.git_data_dirs` map entry of file [`roles/gprd-base.json`](https://gitlab.com/gitlab-com/gl-infra/chef-repo/-/blob/master/roles/gprd-base.json#L494), add an entry similar to:\n    ```json\n                \"nfs-file90\": {\n                  \"path\": \"/var/opt/gitlab/git-data-file90\",\n                  \"gitaly_address\": \"tcp://file-90-stor-gprd.c.gitlab-production.internal:9999\"\n                },\n    ```\n  - [x] Link: https://gitlab.com/gitlab-com/gl-infra/chef-repo/-/merge_requests/3017\n  - [x] Have the MR reviewed by a colleague.\n- **execution commands for the step**\n  - [x] Notify the Engineer On-call about the planned change.\n  - [x] Create a silence for `GitalyServiceGoserverTrafficAbsentSingleNode` alert, which will get raised if new Gitaly server(s) do not receive enough traffic for 30 minutes. [Reference of alert raised in the past](https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/16269#note_1100938329).\n  - [x] Merge the MR.\n  - [x] Examine the pipeline stage output for `apply_to_prod` job on ops.gitlab.net pipeline to verify that change was applied successfully and there were no errors.\n- **post-execution validation for the step**\n  - [x] Verify chef role to check for the change:\n  ```bash\n  $ bundle exec knife role show gprd-base-stor-gitaly-common | grep -A1 'nfs-file90'\n          name: nfs-file90\n          path: /var/opt/gitlab/git-data/repositories\n  ```\n  - [x] Wait 30-35 minutes for the nodes to converge naturally. In the normal circumstances, chef-client periodically runs every 30 (plus upto 5) minutes. Verify by checking node status (ignore patroni/postgres servers in the list):\n  ```bash\n  bundle exec knife status \"roles:gprd-base-stor-gitaly-common\" --run-list\n  ```\n  - [ ] Optionally, in case you are running out of patience and thinking explicit run, force `chef-client` to run on the relevant nodes (It will take excruciatingly long time though, so better to wait for natural convergence):\n  ```bash\n  bundle exec knife ssh -C 3 \"roles:gprd-base-stor-gitaly-common\" \"sudo chef-client\"\n  ```\n  \n- **rollback of the step**\n  - [ ] Revert the MR.\n  - [ ] Check the `apply_to_prod` ops.gitlab.net pipeline to see if the change successfully applied.\n  - [ ] Re-run the commands in the post-execution validation for the step\n\n\n### Add the new Gitaly node to all our Kubernetes container configuration\n\n- **pre-conditions for execution of the step**\n  - [x] Create [a new MR in the `gl-infra/k8s-workloads/gitlab-com` project](https://gitlab.com/gitlab-com/gl-infra/k8s-workloads/gitlab-com/-/blob/master/releases/gitlab/values/gprd.yaml.gotmpl).\n    * Here is [an example title and description to use for this MR](https://gitlab.com/gitlab-com/gl-infra/k8s-workloads/gitlab-com/-/merge_requests/1779/diffs).\n    - [x] In the MR you want to update the file `releases/gitlab/values/${environment}.yaml.gotmpl` and add the new node to the `global.gitaly.external` yaml list\n        Typically the data looks like\n    ```\n    - hostname: gitaly-01-sv-pre.c.gitlab-pre.internal\n      name: default\n      port: \"9999\"\n      tlsEnabled: false\n    ```\n  - [x] Link: https://gitlab.com/gitlab-com/gl-infra/k8s-workloads/gitlab-com/-/merge_requests/2599\n  - [x] Have the MR reviewed by a colleague in **Delivery**\n- **execution commands for the step**\n  - [x] Notify the Engineer On-call about the planned change and seek approval, to ensure that no other deployment (From #announcements) is ongoing at the time.\n  - [x] Merge the MR.\n  - [x] Examine the pipeline stage output to verify that there were no errors.\n\n- **rollback of the step**\n  - [ ] Revert the MR.\n  - [ ] Re-run the execution step for a roll-back.\n\n\n### Test the new node\n\nConfirm that the new storage node is operational.\n\n- **pre-conditions for execution of the step**\n  - [ ] Export your `gitlab.com` user auth token as an environment variable in your shell session.\n  ```bash\n  export GITLAB_COM_API_PRIVATE_TOKEN='CHANGEME'\n  ```\n  - [ ] Also export your `gitlab.com` admin user auth token as an environment variable in your shell session.\n  ```bash\n  export GITLAB_GPRD_ADMIN_API_PRIVATE_TOKEN='CHANGEME'\n  ```\n- **execution commands for the step**\n  - [x] Create a new project:\n  ```bash\n  export project_name='nfs-file90-test'\n  rm -f \"/tmp/project-${project_name}.json\"\n  curl --silent --show-error --request POST \"https://gitlab.com/api/v4/projects?name=${project_name}\u0026default_branch=main\" --header \"Private-Token: ${GITLAB_COM_API_PRIVATE_TOKEN}\" \u003e \"/tmp/project-${project_name}.json\"\n  export project_id=$(cat \"/tmp/project-${project_name}.json\" | jq -r '.id')\n  export ssh_url_to_repo=$(cat \"/tmp/project-${project_name}.json\" | jq -r '.ssh_url_to_repo')\n  ```\n  - [x] Clone the project.\n  ```bash\n  git clone \"${ssh_url_to_repo}\" \"/tmp/${project_name}\"\n  ```\n  - [x] Add, commit, and push a `README` file to the project repository.\n  ```bash\n  echo \"# ${project_name}\" \u003e \"/tmp/${project_name}/README.md\"\n  pushd \"/tmp/${project_name}\" \u0026\u0026 git add \"/tmp/${project_name}/README.md\" \u0026\u0026 git commit -am \"Add README\" \u0026\u0026 git push origin main \u0026\u0026 popd\n  ```\n  - [x] Use the API to [move it to a new storage server](https://gitlab.com/gitlab-com/runbooks/-/blob/master/docs/gitaly/storage-rebalancing.md#manual-method):\n  ```bash\n  export destination_storage_name='nfs-file90'\n  export move_id=$(curl --silent --show-error --request POST \"https://gitlab.com/api/v4/projects/${project_id}/repository_storage_moves\" --data \"{\\\"destination_storage_name\\\": \\\"${destination_storage_name}\\\"}\" --header \"Private-Token: ${GITLAB_GPRD_ADMIN_API_PRIVATE_TOKEN}\" --header 'Content-Type: application/json' | jq -r '.id')\n  ```\n  - [x] Optionally poll the api to monitor the state of the move:\n  ```bash\n  curl --silent --show-error \"https://gitlab.com/api/v4/projects/${project_id}/repository_storage_moves/${move_id}\" --header \"Private-Token: ${GITLAB_GPRD_ADMIN_API_PRIVATE_TOKEN}\" | jq -r '.state'\n  ```\n  - [x] Optionally confirm the new location:\n  ```bash\n  curl --silent --show-error \"https://gitlab.com/api/v4/projects/${project_id}\" --header \"Private-Token: ${GITLAB_GPRD_ADMIN_API_PRIVATE_TOKEN}\" | jq -r '.repository_storage'\n  ```\n  - [x] Once the project has finished being moved to the new shard, proceed to add, commit, and push an update to the `README`:\n  ```bash\n  echo -e \"\\n\\ntest\" \u003e\u003e \"/tmp/${project_name}/README.md\"\n  pushd \"/tmp/${project_name}\" \u0026\u0026 git add \"/tmp/${project_name}/README.md\" \u0026\u0026 git commit -am \"Update README to test nfs-file90\" \u0026\u0026 git push origin main \u0026\u0026 popd\n  ```\n  - [x] Verify that the changes were persisted as expected:\n  ```bash\n  rm -rf \"/tmp/${project_name}\"\n  git clone \"${ssh_url_to_repo}\" \"/tmp/${project_name}\"\n  grep 'test' \"/tmp/${project_name}/README.md\"\n  ```\n\n### Enable the new node in Gitlab\n\nEnabling new nodes in the GitLab admin console requires using an admin account to change where new projects are stored. In [`Admin Area`](https://gitlab.com/admin) \u003e [`Settings`](https://gitlab.com/admin/application_settings/general) \u003e [`Repository`](https://gitlab.com/admin/application_settings/repository) \u003e `Repository storage` \u003e `Expand`, you will see a list of storage nodes. The ones that are checked are the ones that will receive new projects. For more information see [gitlab docs](https://docs.gitlab.com/ee/administration/repository_storage_paths.html#choose-where-new-repositories-will-be-stored).\n\n- **execution commands for the step**\n  - [x] Open a private browser window or tab and navigate to: https://gitlab.com/admin/application_settings/repository\n  - [x] Click the `Expand` button next to `Repository storage`.\n  - [x] Click the `Save changes` button. (I know you didn't do any changes, just trust the process and click the button)\n  - [x] Click play on the [Production gitaly-shard-weights-assigner job](https://ops.gitlab.net/gitlab-com/gl-infra/gitaly-shard-weights-assigner/-/pipeline_schedules) to assign a weight.\n\n- **post-execution validation for the step**\n  - [x] Take a count of how many projects are being created on the new shard:\n  ```bash\n  export node='file-90-stor-gprd.c.gitlab-production.internal'\n  bundle exec knife ssh \"fqdn:$node\" \"sudo find /var/opt/gitlab/git-data/repositories/@hashed -mindepth 2 -maxdepth 3 -name *.git | wc -l\"\n  ```\n  - [x] Observe that this number goes up over time.\n\n- **post-execution validation for the step**\n  - [ ] Take a count of how many projects are being created on the old shard:\n  ```bash\n  export node='file-YY-stor-gprd.c.gitlab-production.internal'\n  bundle exec knife ssh \"fqdn:$node\" \"sudo find /var/opt/gitlab/git-data/repositories/@hashed -mindepth 2 -maxdepth 3 -name *.git | wc -l\"\n  ```\n  - [ ] Observe that this number never goes up over time.  (Either goes down or does not change.)\n  - [x] Delete silence created for `GitalyServiceGoserverTrafficAbsentSingleNode` alert in steps [above](#configure-the-gitlab-application-so-that-it-is-aware-of-the-new-node).","state":"closed","created_at":"2023-03-07T19:17:14.873Z","updated_at":"2023-03-10T18:59:31.248Z","closed_at":"2023-03-10T18:59:31.213Z","closed_by":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"labels":["C3","Category:Capacity Planning","Change Management","Complete","Infrastructure","Service::Gitaly","change","eoc_approved","requires production access","status::scheduled","team::Practices"],"milestone":null,"assignees":[{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"}],"author":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"type":"ISSUE","assignee":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"user_notes_count":14,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2023-03-10","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/17548","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":66,"completed_count":47},"weight":2,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/17548","notes":"https://gitlab.com/api/v4/projects/1304532/issues/17548/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/17548/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#17548","relative":"#17548","full":"gitlab-com/gl-infra/reliability#17548"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":123233985,"iid":17364,"project_id":1304532,"title":"The dbconsole-praefect.sh script must specify secrets for database client connections","description":"\u003c!--\nThis template is for GitLab Team Members seeking support of SRE where there isn't an existing `request-*` template available.\n\nPlease fill out the details below.\n--\u003e\n\n**Details**\n - Point of contact for this request: @nnelson\n - If a call is needed, what is the proposed date and time of the call:  [+ Date and Time +]\n - Additional call details (format, type of call): [+ additional details +]\n\n**SRE Support Needed**\n\nThe `dbconsole-praefect.sh` script is now required to specify the client certificates to be used for the connection.\n\nThis may be verified with:\n\n```sh\nssh console-01-sv-gstg.c.gitlab-staging-1.internal\nPGSSLCOMPRESSION=0 PGPASSWORD=$(sudo /bin/cat /etc/gitlab/gitlab.rb | perl -ne 'm/praefect.*database_password.*?\"(.*)\"/ \u0026\u0026 do { print $1 }') sudo --preserve-env /opt/gitlab/embedded/bin/psql \"sslmode=verify-ca sslrootcert=/etc/gitlab/ssl/praefect-database-server-ca.pem sslcert=/etc/gitlab/ssl/praefect-database-client-cert.pem sslkey=/etc/gitlab/ssl/praefect-database-client-key.pem hostaddr=10.94.0.2 user=praefect dbname=praefect_production\"\n```\n\nThe template and recipe in the unfortunately scoped `gitlab_users` cookbook must be updated accordingly.\n\n\n\u003c!--\nplease do not edit the below\n--\u003e","state":"closed","created_at":"2023-02-07T16:44:01.402Z","updated_at":"2023-04-05T12:34:34.121Z","closed_at":"2023-03-15T17:14:59.062Z","closed_by":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"labels":["Database","Reliability::P3","Service::Praefect","team::Practices","work::general","workflow-infra::Done"],"milestone":{"id":3011532,"iid":226,"group_id":1112072,"title":"Reliability:Practices W10,W11","description":"","state":"closed","created_at":"2023-03-02T12:39:42.478Z","updated_at":"2023-03-20T15:36:02.135Z","due_date":"2023-03-18","start_date":"2023-03-06","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/226"},"assignees":[{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"}],"author":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"type":"ISSUE","assignee":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/17364","time_stats":{"time_estimate":0,"total_time_spent":14400,"human_time_estimate":null,"human_total_time_spent":"4h"},"task_completion_status":{"count":0,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/17364","notes":"https://gitlab.com/api/v4/projects/1304532/issues/17364/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/17364/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#17364","relative":"#17364","full":"gitlab-com/gl-infra/reliability#17364"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":"on_track"},{"id":118261655,"iid":16781,"project_id":1304532,"title":"Container Registry: Review and adjust SLI for manifest routes","description":"## Context\n\nRelated to https://gitlab.com/groups/gitlab-com/gl-infra/-/epics/476+.\n\n## Task\n\nNow that Phase 2 of the [GitLab.com registry upgrade/migration](https://gitlab.com/groups/gitlab-org/-/epics/5523) is complete, the existing SLIs are likely too loose, as operations are now executed on the metadata database (faster), not the storage backend (slower).\n\n~\"group::container registry\" will self-serve this issue.","state":"closed","created_at":"2022-11-07T12:02:24.586Z","updated_at":"2023-01-26T14:36:33.823Z","closed_at":"2022-11-22T16:56:37.628Z","closed_by":{"id":12647344,"username":"suleimiahmed","name":"Suleimi Ahmed","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/12647344/avatar.png","web_url":"https://gitlab.com/suleimiahmed"},"labels":["Observability","Reliability::P3","Service::Container Registry","devops::package","group::container registry","section::ops","team::Reliability","work::general","workflow-infra::Done","workflow::production"],"milestone":{"id":2745641,"iid":800,"group_id":6543,"title":"15.7","description":"","state":"active","created_at":"2022-08-22T16:50:38.272Z","updated_at":"2022-08-22T16:50:38.272Z","due_date":"2022-12-17","start_date":"2022-11-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/-/milestones/800"},"assignees":[{"id":12647344,"username":"suleimiahmed","name":"Suleimi Ahmed","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/12647344/avatar.png","web_url":"https://gitlab.com/suleimiahmed"}],"author":{"id":5054840,"username":"jdrpereira","name":"João Pereira","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5054840/avatar.png","web_url":"https://gitlab.com/jdrpereira"},"type":"ISSUE","assignee":{"id":12647344,"username":"suleimiahmed","name":"Suleimi Ahmed","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/12647344/avatar.png","web_url":"https://gitlab.com/suleimiahmed"},"user_notes_count":5,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/16781","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/16781","notes":"https://gitlab.com/api/v4/projects/1304532/issues/16781/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/16781/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#16781","relative":"#16781","full":"gitlab-com/gl-infra/reliability#16781"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":476,"epic":{"id":273485,"iid":476,"title":"Container Registry: Refactor SLIs post upgrade/migration","url":"/groups/gitlab-com/gl-infra/-/epics/476","group_id":1112072,"human_readable_end_date":"Mar 17, 2023","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":116351647,"iid":16519,"project_id":1304532,"title":"Establish a method for monitoring the health/success of disk backup snapshot creation in GCP","description":"## Summary\n\n\u003c!--\nGive context for what problem this issue is trying to prevent from happening again.\n\nProvide a brief assessment of the risk (chance and impact) of the problem that this corrective action fixes, to assist with triage and prioritization.\n--\u003e\n\nEstablish a method for monitoring the health/success of disk backup snapshot creation in GCP.\n\nThere is presently a now known risk that disk backup snapshots could begin to fail without anyone being aware of the situation until one goes to try to use a snapshot which has failed for something.\n\nFailed disk backup snapshots could result in the extensive loss of customer data were any of the virtual server disks to fail for any reason during a period of failing snapshot creation.\n\n\n## Related Incident(s)\n\n\u003c!--\nNote the originating incident(s) and link known related incidents/other issues.\n\nThe relation will happen automatically if you are creating this issue from an incident, if this isn't done already please uncomment the following line:\n--\u003e\n\nOriginating issue(s): https://gitlab.com/gitlab-com/gl-infra/production/-/issues/7833\n\n\n## Desired Outcome/Acceptance Criteria\n\n\u003c!--\nHow will you know that this issue is complete?\n\nIf you have any initial thoughts on implementation details (e.g. what to do or not do, gotchas, edge cases etc.), please share them while they are fresh in your mind.\n--\u003e\n\nAn alert will be generated, and ultimately the SRE On-call will be paged, when a certain number (any?) of disk backup snapshots fail to be created within a certain period of time from their scheduled initialization.\n\n\n## Associated Services\n\n\u003c!--\nApply the appropriate services associated with this corrective action if applicable.\n\n~Service::SERVICE_NAME\n\n--\u003e\n\n~\"Service::GCP\" \n\n## Corrective Action Issue Checklist\n\n* [x] Link the incident(s) this corrective action arose out of\n* [x] Give context for what problem this corrective action is trying to prevent from re-occurring\n* [x] Assign a severity label (this is the highest sev of related incidents, defaults to 'severity::4')\n* [x] Assign a priority (this will default to 'Reliability::P4')","state":"closed","created_at":"2022-10-05T18:42:56.939Z","updated_at":"2023-02-08T10:31:19.624Z","closed_at":"2023-01-20T04:09:24.601Z","closed_by":{"id":12345715,"username":"ayeung","name":"Adeline Yeung","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/12345715/avatar.png","web_url":"https://gitlab.com/ayeung"},"labels":["Reliability::P3","Service::GCP","corrective action","severity::3","team::General","team::Reliability","work::incident","workflow-infra::Done"],"milestone":null,"assignees":[],"author":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"type":"ISSUE","assignee":null,"user_notes_count":3,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/16519","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":4,"completed_count":4},"weight":3,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/16519","notes":"https://gitlab.com/api/v4/projects/1304532/issues/16519/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/16519/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#16519","relative":"#16519","full":"gitlab-com/gl-infra/reliability#16519"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":113483221,"iid":16207,"project_id":1304532,"title":"Demo: /chatops run pager pause","description":"# Demo: `/chatops run pager pause`\n\n## Scenario\n\n\u003e For site-wide outages, EOC gets a nearly continuous stream of pages that needs to be acknowledged, which is very distracting when trying to focus on mitigating said outage. For production, we have 3 PagerDuty services that could send a page to the EOC: `GitLab Production`, `SLO Alerts gprd main stage`, and `SLO alerts gprd cny stage`. Manually creating a maintenance window for all of them is a waste of time during an incident.\n\nSee this ~\"corrective action\" for details: https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/15550\n\nModerator note: Since Steve Azzopardi's excellent work creating relationships and hierarchies for service alerting, this has since become much less of a burdensome problem during severe incidents. Nevertheless, this feature may have some value, and because it directly effects the way that an on-call engineer is paged or not, it is important to socialize this operational information.\n\nSee runbook documentation here: https://gitlab.com/gitlab-com/runbooks/-/blob/master/on-call/checklists/eoc.md#creating-temporary-pagerduty-maintenance-windows\n\n## Meeting Format\n\nDemo presentation.\n\n- [x] Moderator: @nnelson \n- [ ] Note Taker: @shimrangeorge / `tbd`\n\n\n## Acceptance Criteria\n\n\u003c!--\n  All items must be completed prior to the closure of this issue.\n--\u003e\n\n- [ ] Google Doc created: `todo`\n- [ ] Meeting scheduled; Agenda should include\n  - Google Doc\n  - Link to Scenario\n- [ ] Meeting must be recorded\n- [ ] Recording is uploaded to YouTube; apply the video to the following\n  playlists:\n  - Infrastructure Fire Drills\n  - Infrastructure Group\n- [ ] Mark the video as private if any [Yellow and above classified data is\n  shared](https://about.gitlab.com/handbook/engineering/security/data-classification-standard.html)\n- [ ] Review the Google Doc and/or the Video for any potential follow up issues\n  that need to be resolved","state":"closed","created_at":"2022-08-18T16:49:48.653Z","updated_at":"2023-02-15T15:23:39.919Z","closed_at":"2023-02-15T15:23:39.837Z","closed_by":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"labels":["Reliability::P4","demo","team::Reliability","work::general","workflow-infra::Ready"],"milestone":null,"assignees":[{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"}],"author":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"type":"ISSUE","assignee":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2022-08-18","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/16207","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":8,"completed_count":1},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/16207","notes":"https://gitlab.com/api/v4/projects/1304532/issues/16207/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/16207/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#16207","relative":"#16207","full":"gitlab-com/gl-infra/reliability#16207"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":112951247,"iid":16151,"project_id":1304532,"title":"For project authorizations refresh jobs, use workers based on the applicable urgency context","description":"Based on the discussion at https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/16080#note_1054295096\n\n\u003e granting access (inserting into `project_authorizations`) can have lower priority. According to https://docs.gitlab.com/ee/development/sidekiq/worker_attributes.html#job-urgency, this would mean a delay of maximum 1 minute before the users can actually access the project they've gained access to. But when revoking access, this might be to block a bad actor from something, so we might want it more immediate.\n\nThis means that we have an opportunity to have different types of workers that do the same thing, but differ in urgency.\n\nAnd based on its context (eg, addition of a member to a project vs removal of a member from a project), we can use the worker based on the urgency of the user action.","state":"closed","created_at":"2022-08-08T15:00:45.090Z","updated_at":"2022-08-08T15:07:57.096Z","closed_at":"2022-08-08T15:01:10.956Z","closed_by":{"id":4093067,"username":"manojmj","name":"Manoj M J","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4093067/avatar.png","web_url":"https://gitlab.com/manojmj"},"labels":["workflow-infra::Done"],"milestone":null,"assignees":[],"author":{"id":4093067,"username":"manojmj","name":"Manoj M J","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4093067/avatar.png","web_url":"https://gitlab.com/manojmj"},"type":"ISSUE","assignee":null,"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/16151","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/16151","notes":"https://gitlab.com/api/v4/projects/1304532/issues/16151/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/16151/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#16151","relative":"#16151","full":"gitlab-com/gl-infra/reliability#16151"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":112182744,"iid":16096,"project_id":1304532,"title":"Decide tagging pattern for premium machine types","description":"Premium machine types (such as n2-standard-4 to pick a totally arbitrary example) need some sort of standard tagging format to be determined ahead of time.\n\nThis small detail is important as it's very painful and annoying to users if we change it after the fact.\n\nPremium machine type runner managers will be set to `run-untagged=false` so that the only way to use them is to run with the tags. \n\nBlocks #16091\n\n## PM proposal for configuration and tagging pattern (2022-07-29)\n\n### Tagging naming convention for GitLab SaaS runners\n\nsaas-{os}-{instance size}-{arch}-{additional capability}\n\n- SaaS: denotes that this is a SaaS Runner\n- OS: denotes the operating system.\n- instance size: Using AWS's [naming convention](https://www.archerimagine.com/articles/aws/aws-ec2-instance-type-tutorial.html#instance-sizing) as prior art, this denotes the T-shirt size representation of the instance (CPU, Memory)\n- additional capability: used to represent additional capability. For example - GPU enabled VM's.\n\n| Description| Cloud Provider |Machine Type|Run Untagged Jobs|Tags|\n| ------ | ------ | ------ | ------ | ------ |\n| Linux + Docker Builds - [general purpose CI] | Google Compute |n1-standard-1|Yes|saas-linux-small-amd64|\n| Linux + Docker Builds - [general purpose CI] | Google Compute |~~n1-standard-2~~ \u003cbr\u003e n2d-standard-2|No|saas-linux-medium-amd64|\n| Linux + Docker Builds - [general purpose CI] | Google Compute |~~n1-standard-4~~ \u003cbr\u003e n2d-standard-4|No|saas-linux-large-amd64|\n| Linux + Docker Builds - [AI/MLOPS - GPU Enabled] | Google Compute |n1-standard-4 + GPU|No|saas-linux-large-amd64-gpu|","state":"closed","created_at":"2022-07-25T20:50:41.739Z","updated_at":"2022-09-15T01:49:56.137Z","closed_at":"2022-08-16T14:54:27.938Z","closed_by":{"id":215818,"username":"tmaczukin","name":"Tomasz Maczukin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0a9a99b9665ab7eda2cd7bffd54b1836?s=80\u0026d=identicon","web_url":"https://gitlab.com/tmaczukin"},"labels":["Reliability::P4","Service::CI Runners","group::runner","section::ops","team::Reliability","type::feature","work::general","workflow-infra::Done"],"milestone":null,"assignees":[],"author":{"id":2469083,"username":"erushton","name":"Elliot Rushton","state":"blocked","avatar_url":"https://secure.gravatar.com/avatar/4194662ce4a5b5f53e61689fd7a2daf9?s=80\u0026d=identicon","web_url":"https://gitlab.com/erushton"},"type":"ISSUE","assignee":null,"user_notes_count":5,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/16096","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":0,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/16096","notes":"https://gitlab.com/api/v4/projects/1304532/issues/16096/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/16096/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#16096","relative":"#16096","full":"gitlab-com/gl-infra/reliability#16096"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":768,"epic":{"id":572744,"iid":768,"title":"Multiple Linux Runner Sizes","url":"/groups/gitlab-com/gl-infra/-/epics/768","group_id":1112072},"iteration":null,"health_status":"on_track"},{"id":112170477,"iid":16094,"project_id":1304532,"title":"Increase capacity on larger runner machine offerings","description":"After testing that the new runner managers work with their different machine types, we need to update chef and configure them to have the production level capacity.\n\nWith that configuration will be ready for the official start.\n\nThe last steps will be then to:\n\n- announce the new runners\n- unpause them in GitLab, so that they become available for users.","state":"closed","created_at":"2022-07-25T17:41:19.540Z","updated_at":"2022-09-19T17:45:49.559Z","closed_at":"2022-09-19T17:45:49.546Z","closed_by":{"id":215818,"username":"tmaczukin","name":"Tomasz Maczukin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0a9a99b9665ab7eda2cd7bffd54b1836?s=80\u0026d=identicon","web_url":"https://gitlab.com/tmaczukin"},"labels":["Reliability::P3","Service::CI Runners","feature::addition","group::runner","section::ops","tShirt-size::S","team::Reliability","type::feature","work::general","workflow-infra::Ready"],"milestone":null,"assignees":[{"id":215818,"username":"tmaczukin","name":"Tomasz Maczukin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0a9a99b9665ab7eda2cd7bffd54b1836?s=80\u0026d=identicon","web_url":"https://gitlab.com/tmaczukin"}],"author":{"id":2469083,"username":"erushton","name":"Elliot Rushton","state":"blocked","avatar_url":"https://secure.gravatar.com/avatar/4194662ce4a5b5f53e61689fd7a2daf9?s=80\u0026d=identicon","web_url":"https://gitlab.com/erushton"},"type":"ISSUE","assignee":{"id":215818,"username":"tmaczukin","name":"Tomasz Maczukin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0a9a99b9665ab7eda2cd7bffd54b1836?s=80\u0026d=identicon","web_url":"https://gitlab.com/tmaczukin"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/16094","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/16094","notes":"https://gitlab.com/api/v4/projects/1304532/issues/16094/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/16094/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#16094","relative":"#16094","full":"gitlab-com/gl-infra/reliability#16094"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":768,"epic":{"id":572744,"iid":768,"title":"Multiple Linux Runner Sizes","url":"/groups/gitlab-com/gl-infra/-/epics/768","group_id":1112072},"iteration":null,"health_status":null},{"id":112170462,"iid":16093,"project_id":1304532,"title":"Create terraform plans for large machine runner managers","description":"Add new runner managers into terraform repository.\n\n## Work checklist\n\n- [x] merge https://ops.gitlab.net/gitlab-com/gl-infra/config-mgmt/-/merge_requests/4139\n- [x] request quota limit upgrade of C2 CPUs to 2000\n- [x] apply changes from https://ops.gitlab.net/gitlab-com/gl-infra/config-mgmt/-/merge_requests/4139 to create the runner manager nodes\n- [x] apply fix from https://ops.gitlab.net/gitlab-com/gl-infra/config-mgmt/-/merge_requests/4155\n- [x] manually verify configuration\n- [x] finalize preparation steps (create Docker Machine VM on each of the nodes manually - once per each node - to make sure that the configuration works and to generate Docker Machine TLS Auth certificates)","state":"closed","created_at":"2022-07-25T17:40:42.933Z","updated_at":"2023-03-13T11:07:20.567Z","closed_at":"2022-09-08T17:37:11.097Z","closed_by":{"id":215818,"username":"tmaczukin","name":"Tomasz Maczukin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0a9a99b9665ab7eda2cd7bffd54b1836?s=80\u0026d=identicon","web_url":"https://gitlab.com/tmaczukin"},"labels":["Reliability::P3","Service::CI Runners","feature::addition","group::runner","section::ops","team::Reliability","type::feature","work::general","workflow-infra::Done"],"milestone":null,"assignees":[{"id":215818,"username":"tmaczukin","name":"Tomasz Maczukin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0a9a99b9665ab7eda2cd7bffd54b1836?s=80\u0026d=identicon","web_url":"https://gitlab.com/tmaczukin"},{"id":4411649,"username":"rehab","name":"Rehab","state":"active","avatar_url":"https://secure.gravatar.com/avatar/9d69bb3e051942900412ccf83871b403?s=80\u0026d=identicon","web_url":"https://gitlab.com/rehab"}],"author":{"id":2469083,"username":"erushton","name":"Elliot Rushton","state":"blocked","avatar_url":"https://secure.gravatar.com/avatar/4194662ce4a5b5f53e61689fd7a2daf9?s=80\u0026d=identicon","web_url":"https://gitlab.com/erushton"},"type":"ISSUE","assignee":{"id":215818,"username":"tmaczukin","name":"Tomasz Maczukin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0a9a99b9665ab7eda2cd7bffd54b1836?s=80\u0026d=identicon","web_url":"https://gitlab.com/tmaczukin"},"user_notes_count":12,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2022-08-25","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/16093","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":6,"completed_count":6},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/16093","notes":"https://gitlab.com/api/v4/projects/1304532/issues/16093/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/16093/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#16093","relative":"#16093","full":"gitlab-com/gl-infra/reliability#16093"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":768,"epic":{"id":572744,"iid":768,"title":"Multiple Linux Runner Sizes","url":"/groups/gitlab-com/gl-infra/-/epics/768","group_id":1112072},"iteration":null,"health_status":null},{"id":112170426,"iid":16092,"project_id":1304532,"title":"Create chef roles for large runner machine types","description":"For new runner managers we need to define chef roles that they will use for configuration.\n\n## Plan checklist\n\n- [x] Merge https://gitlab.com/gitlab-com/gl-infra/chef-repo/-/merge_requests/2234+","state":"closed","created_at":"2022-07-25T17:40:03.400Z","updated_at":"2022-09-05T07:58:32.335Z","closed_at":"2022-09-01T15:40:10.483Z","closed_by":{"id":215818,"username":"tmaczukin","name":"Tomasz Maczukin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0a9a99b9665ab7eda2cd7bffd54b1836?s=80\u0026d=identicon","web_url":"https://gitlab.com/tmaczukin"},"labels":["Reliability::P3","Service::CI Runners","feature::addition","group::runner","section::ops","team::Reliability","type::feature","work::general","workflow-infra::Done"],"milestone":null,"assignees":[{"id":215818,"username":"tmaczukin","name":"Tomasz Maczukin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0a9a99b9665ab7eda2cd7bffd54b1836?s=80\u0026d=identicon","web_url":"https://gitlab.com/tmaczukin"},{"id":4411649,"username":"rehab","name":"Rehab","state":"active","avatar_url":"https://secure.gravatar.com/avatar/9d69bb3e051942900412ccf83871b403?s=80\u0026d=identicon","web_url":"https://gitlab.com/rehab"}],"author":{"id":2469083,"username":"erushton","name":"Elliot Rushton","state":"blocked","avatar_url":"https://secure.gravatar.com/avatar/4194662ce4a5b5f53e61689fd7a2daf9?s=80\u0026d=identicon","web_url":"https://gitlab.com/erushton"},"type":"ISSUE","assignee":{"id":215818,"username":"tmaczukin","name":"Tomasz Maczukin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0a9a99b9665ab7eda2cd7bffd54b1836?s=80\u0026d=identicon","web_url":"https://gitlab.com/tmaczukin"},"user_notes_count":0,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2022-08-25","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/16092","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":1,"completed_count":1},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/16092","notes":"https://gitlab.com/api/v4/projects/1304532/issues/16092/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/16092/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#16092","relative":"#16092","full":"gitlab-com/gl-infra/reliability#16092"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":768,"epic":{"id":572744,"iid":768,"title":"Multiple Linux Runner Sizes","url":"/groups/gitlab-com/gl-infra/-/epics/768","group_id":1112072},"iteration":null,"health_status":null},{"id":112170398,"iid":16091,"project_id":1304532,"title":"Register large machine runner managers","description":"We need to register the new machines and store the tokens generated in our 1password vault.\n\nTo truly be done this, we need to know the tagging format to be used to distinguish the machine types. Tags can be updated after registration though so we can register, store the tokens, then update the tag formats.\n\n**This issue requires gitlab.com admin access**\n\n## Plan checklist\n\n- Register following runner managers and store tokens in chef vault\n  - `saas-linux-medium` :point_right: `./bin/gkms-vault-create runners-manager-saas-linux-medium-amd64 ci`\n    - [x] `blue-1.saas-linux-medium-amd4.runners-manager.gitlab.com`\n    - [x] `blue-2.saas-linux-medium-amd4.runners-manager.gitlab.com`\n    - [x] `blue-3.saas-linux-medium-amd4.runners-manager.gitlab.com`\n    - [x] `blue-4.saas-linux-medium-amd4.runners-manager.gitlab.com`\n    - [x] `blue-5.saas-linux-medium-amd4.runners-manager.gitlab.com`\n    - [x] `green-1.saas-linux-medium-amd4.runners-manager.gitlab.com`\n    - [x] `green-2.saas-linux-medium-amd4.runners-manager.gitlab.com`\n    - [x] `green-3.saas-linux-medium-amd4.runners-manager.gitlab.com`\n    - [x] `green-4.saas-linux-medium-amd4.runners-manager.gitlab.com`\n    - [x] `green-5.saas-linux-medium-amd4.runners-manager.gitlab.com`\n  - `saas-linux-large` :point_right: `./bin/gkms-vault-create runners-manager-saas-linux-large-amd64 ci`\n    - [x] `blue-1.saas-linux-large-amd4.runners-manager.gitlab.com`\n    - [x] `blue-2.saas-linux-large-amd4.runners-manager.gitlab.com`\n    - [x] `blue-3.saas-linux-large-amd4.runners-manager.gitlab.com`\n    - [x] `blue-4.saas-linux-large-amd4.runners-manager.gitlab.com`\n    - [x] `blue-5.saas-linux-large-amd4.runners-manager.gitlab.com`\n    - [x] `green-1.saas-linux-large-amd4.runners-manager.gitlab.com`\n    - [x] `green-2.saas-linux-large-amd4.runners-manager.gitlab.com`\n    - [x] `green-3.saas-linux-large-amd4.runners-manager.gitlab.com`\n    - [x] `green-4.saas-linux-large-amd4.runners-manager.gitlab.com`\n    - [x] `green-5.saas-linux-large-amd4.runners-manager.gitlab.com`\n- Add collected tokens to chef vault for the dedicated roles","state":"closed","created_at":"2022-07-25T17:39:23.622Z","updated_at":"2022-08-24T17:32:13.381Z","closed_at":"2022-08-24T12:59:54.437Z","closed_by":{"id":215818,"username":"tmaczukin","name":"Tomasz Maczukin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0a9a99b9665ab7eda2cd7bffd54b1836?s=80\u0026d=identicon","web_url":"https://gitlab.com/tmaczukin"},"labels":["Reliability::P4","Service::CI Runners","feature::addition","group::runner","section::ops","team::Reliability","type::feature","work::general","workflow-infra::Ready"],"milestone":null,"assignees":[{"id":215818,"username":"tmaczukin","name":"Tomasz Maczukin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0a9a99b9665ab7eda2cd7bffd54b1836?s=80\u0026d=identicon","web_url":"https://gitlab.com/tmaczukin"}],"author":{"id":2469083,"username":"erushton","name":"Elliot Rushton","state":"blocked","avatar_url":"https://secure.gravatar.com/avatar/4194662ce4a5b5f53e61689fd7a2daf9?s=80\u0026d=identicon","web_url":"https://gitlab.com/erushton"},"type":"ISSUE","assignee":{"id":215818,"username":"tmaczukin","name":"Tomasz Maczukin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0a9a99b9665ab7eda2cd7bffd54b1836?s=80\u0026d=identicon","web_url":"https://gitlab.com/tmaczukin"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/16091","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":20,"completed_count":20},"weight":0,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/16091","notes":"https://gitlab.com/api/v4/projects/1304532/issues/16091/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/16091/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#16091","relative":"#16091","full":"gitlab-com/gl-infra/reliability#16091"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":768,"epic":{"id":572744,"iid":768,"title":"Multiple Linux Runner Sizes","url":"/groups/gitlab-com/gl-infra/-/epics/768","group_id":1112072},"iteration":null,"health_status":null},{"id":112170361,"iid":16090,"project_id":1304532,"title":"Request increase in required GCP project quotas for large runner machine projects","description":"For each GCP project we create in the [create projects issue](https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/16089) we also need to request quota increases for the \"usual things\".\n\nBasing on the [recent work](https://gitlab.com/gitlab-com/gl-infra/capacity-planning/-/issues/30) done for `private` runners and assuming that we will handle the same maximum capacity per the GCP project as in `shared` and `private` runners case, we will definitely need to request upgrades for:\n\n- **Read requests per minute** - 4500 (from the default 1500)\n- **Heavy-weight read requests per minute** - 2250 (from the default 750)\n\nWe will also need to increase the `CPUs` quota. The default limit is 2400 and with bigger machine types we will use definitely more. Assuming that the maximum number of VMs we will handle in each GCP project will be 1500, we will need to request:\n\n- 3000 for the `saas-linux-medium` shard (using the `n1-standard-2` machine type which has 2 vCPUs)\n- 6000 for the `saas-linux-large` shard (using the `n1-standard-4` machine type which has 4 vCPUs)\n\nThere was a discussion whether we should use `n2d` machines instead of `n1`. Currently the decision seem to be to stay with `n1`.\n\nBut if we will decide to use `n2d` we will also need to increase the `N2D CPUs` - the value would be same as for the `CPUs` one (as id depends on the estimated maximum number of hosted VMs x number of CPUs per VM).\n\n## Plan checklist\n\n- [x] Request quota limits increases\n    - [x] `gitlab-r-saas-l-m-amd64-1`\n\n        ```\n        Thank you for submitting Case # (ID:12bee97039bb48b28a06c087d467547e) to Google Cloud Platform support for the following quotas:\n        Change CPUs - us-east1 from 2,400 to 3,000\n        Change N2D CPUs - us-east1 from 500 to 3,000\n        Change Heavy-weight read requests per minute from 750 to 2,250\n        Change Read requests per minute from 1,500 to 4,500\n        ```\n\n    - [x] `gitlab-r-saas-l-m-amd64-2`\n\n        ```\n        Thank you for submitting Case # (ID:842fbbcf476147dda093a1df763c4da5) to Google Cloud Platform support for the following quotas:\n        Change CPUs - us-east1 from 2,400 to 3,000\n        Change N2D CPUs - us-east1 from 500 to 3,000\n        Change Heavy-weight read requests per minute from 750 to 2,250\n        Change Read requests per minute from 1,500 to 4,500\n        ```\n\n    - [x] `gitlab-r-saas-l-m-amd64-3`\n\n        ```\n        Thank you for submitting Case # (ID:35c99197a5a143ec883c26aceaab15b3) to Google Cloud Platform support for the following quotas:\n        Change CPUs - us-east1 from 2,400 to 3,000\n        Change N2D CPUs - us-east1 from 500 to 3,000\n        Change Heavy-weight read requests per minute from 750 to 2,250\n        Change Read requests per minute from 1,500 to 4,500\n        ```\n\n    - [x] `gitlab-r-saas-l-m-amd64-4`\n\n        ```\n        Thank you for submitting Case # (ID:bf7d29f5201c49b4b6d1140650e953d5) to Google Cloud Platform support for the following quotas:\n        Change CPUs - us-east1 from 2,400 to 3,000\n        Change N2D CPUs - us-east1 from 500 to 3,000\n        Change Heavy-weight read requests per minute from 750 to 2,250\n        Change Read requests per minute from 1,500 to 4,500\n        ```\n\n    - [x] `gitlab-r-saas-l-m-amd64-5`\n\n        ```\n        Thank you for submitting Case # (ID:606d548097904ce3bcb8d7a525b057ac) to Google Cloud Platform support for the following quotas:\n        Change CPUs - us-east1 from 2,400 to 3,000\n        Change N2D CPUs - us-east1 from 500 to 3,000\n        Change Heavy-weight read requests per minute from 750 to 2,250\n        Change Read requests per minute from 1,500 to 4,500\n        ```\n\n    - [x] `gitlab-r-saas-l-l-amd64-1`\n\n        ```\n        Thank you for submitting Case # (ID:3de48d3fd05e415abca185efa3fa5742) to Google Cloud Platform support for the following quotas:\n        Change CPUs - us-east1 from 2,400 to 6,000\n        Change N2D CPUs - us-east1 from 500 to 6,000\n        Change Heavy-weight read requests per minute from 750 to 2,250\n        Change Read requests per minute from 1,500 to 4,500\n        ```\n\n    - [x] `gitlab-r-saas-l-l-amd64-2`\n\n        ```\n        Thank you for submitting Case # (ID:81e8af60637f490dae4661f9c80fa5cf) to Google Cloud Platform support for the following quotas:\n        Change N2D CPUs - us-east1 from 500 to 6,000\n        Change CPUs - us-east1 from 2,400 to 6,000\n        Change Heavy-weight read requests per minute from 750 to 2,250\n        Change Read requests per minute from 1,500 to 4,500\n        ```\n\n    - [x] `gitlab-r-saas-l-l-amd64-3`\n\n        ```\n        Thank you for submitting Case # (ID:abbf0b50a4ce40fb8c8969beb7c963b2) to Google Cloud Platform support for the following quotas:\n        Change N2D CPUs - us-east1 from 500 to 6,000\n        Change CPUs - us-east1 from 2,400 to 6,000\n        Change Heavy-weight read requests per minute from 750 to 2,250\n        Change Read requests per minute from 1,500 to 4,500\n        ```\n\n    - [x] `gitlab-r-saas-l-l-amd64-4`\n\n        ```\n        Thank you for submitting Case # (ID:35032f9e334f4a36836daa1ce54ac4e1) to Google Cloud Platform support for the following quotas:\n        Change N2D CPUs - us-east1 from 500 to 6,000\n        Change CPUs - us-east1 from 2,400 to 6,000\n        Change Heavy-weight read requests per minute from 750 to 2,250\n        Change Read requests per minute from 1,500 to 4,500\n        ```\n\n    - [x] `gitlab-r-saas-l-l-amd64-5`\n\n        ```\n        Thank you for submitting Case # (ID:06a1b9e00bf8410aa373693f06c0d117) to Google Cloud Platform support for the following quotas:\n        Change CPUs - us-east1 from 2,400 to 6,000\n        Change N2D CPUs - us-east1 from 500 to 6,000\n        Change Heavy-weight read requests per minute from 750 to 2,250\n        Change Read requests per minute from 1,500 to 4,500\n        ```\n\n- [x] Confirm that quota limits were increased\n    - [x] `gitlab-r-saas-l-m-amd64-1`\n    - [x] `gitlab-r-saas-l-m-amd64-2`\n    - [x] `gitlab-r-saas-l-m-amd64-3`\n    - [x] `gitlab-r-saas-l-m-amd64-4`\n    - [x] `gitlab-r-saas-l-m-amd64-5`\n    - [x] `gitlab-r-saas-l-l-amd64-1`\n    - [x] `gitlab-r-saas-l-l-amd64-2`\n    - [x] `gitlab-r-saas-l-l-amd64-3`\n    - [x] `gitlab-r-saas-l-l-amd64-4`\n    - [x] `gitlab-r-saas-l-l-amd64-5`","state":"closed","created_at":"2022-07-25T17:38:26.804Z","updated_at":"2022-09-15T12:37:40.939Z","closed_at":"2022-09-15T11:43:35.268Z","closed_by":{"id":215818,"username":"tmaczukin","name":"Tomasz Maczukin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0a9a99b9665ab7eda2cd7bffd54b1836?s=80\u0026d=identicon","web_url":"https://gitlab.com/tmaczukin"},"labels":["Reliability::P4","Service::CI Runners","feature::addition","group::runner","section::ops","team::Reliability","type::feature","work::general","workflow-infra::Done"],"milestone":null,"assignees":[{"id":215818,"username":"tmaczukin","name":"Tomasz Maczukin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0a9a99b9665ab7eda2cd7bffd54b1836?s=80\u0026d=identicon","web_url":"https://gitlab.com/tmaczukin"},{"id":4411649,"username":"rehab","name":"Rehab","state":"active","avatar_url":"https://secure.gravatar.com/avatar/9d69bb3e051942900412ccf83871b403?s=80\u0026d=identicon","web_url":"https://gitlab.com/rehab"}],"author":{"id":2469083,"username":"erushton","name":"Elliot Rushton","state":"blocked","avatar_url":"https://secure.gravatar.com/avatar/4194662ce4a5b5f53e61689fd7a2daf9?s=80\u0026d=identicon","web_url":"https://gitlab.com/erushton"},"type":"ISSUE","assignee":{"id":215818,"username":"tmaczukin","name":"Tomasz Maczukin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0a9a99b9665ab7eda2cd7bffd54b1836?s=80\u0026d=identicon","web_url":"https://gitlab.com/tmaczukin"},"user_notes_count":5,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2022-08-23","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/16090","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":22,"completed_count":22},"weight":0,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/16090","notes":"https://gitlab.com/api/v4/projects/1304532/issues/16090/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/16090/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#16090","relative":"#16090","full":"gitlab-com/gl-infra/reliability#16090"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":768,"epic":{"id":572744,"iid":768,"title":"Multiple Linux Runner Sizes","url":"/groups/gitlab-com/gl-infra/-/epics/768","group_id":1112072},"iteration":null,"health_status":null},{"id":112170229,"iid":16089,"project_id":1304532,"title":"Create new GCP Projects for new Runner managers","description":"As per https://gitlab.com/groups/gitlab-com/gl-infra/-/epics/768#note_1066322541 we will define two new shards of our SaaS Linux runners: `saas-linux-medium` and `saas-linux-large`.\n\nFor each of them we will have 5 working runners, which means 5 GCP projects per shard. We need to register unique CIDRs for the `ephemera-runners/ephemeral-runners` subnetworks that will be used by the ephemeral VMs. Later, basing on the created projects, we will create runner managers connected with them.\n\n## Plan checklist\n\n- [x] Register unique CIDRs for ephemeral runner projects in our documentation :point_right: https://gitlab.com/gitlab-com/runbooks/-/merge_requests/4915/diffs\n- [x] Define new projects through terraform :point_right: https://ops.gitlab.net/gitlab-com/gl-infra/config-mgmt/-/merge_requests/4100\n- [x] Create new projects manually :point_right: https://gitlab.com/gitlab-com/gl-infra/production/-/issues/7652\n- [x] ~~Merge new environments definition :point_right: https://ops.gitlab.net/gitlab-com/gl-infra/config-mgmt/-/merge_requests/4121~~\n- [x] Configure the new projects through terraform :point_right: https://ops.gitlab.net/gitlab-com/gl-infra/config-mgmt/-/merge_requests/4101 (please rebase after merging 4121!)","state":"closed","created_at":"2022-07-25T17:35:11.444Z","updated_at":"2022-09-01T13:21:15.703Z","closed_at":"2022-08-31T18:50:54.274Z","closed_by":{"id":429540,"username":"ahanselka","name":"Alex Hanselka","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/429540/avatar.png","web_url":"https://gitlab.com/ahanselka"},"labels":["Reliability::P4","Service::CI Runners","feature::addition","group::runner","section::ops","team::Reliability","type::feature","work::general","workflow-infra::Done"],"milestone":null,"assignees":[{"id":215818,"username":"tmaczukin","name":"Tomasz Maczukin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0a9a99b9665ab7eda2cd7bffd54b1836?s=80\u0026d=identicon","web_url":"https://gitlab.com/tmaczukin"},{"id":429540,"username":"ahanselka","name":"Alex Hanselka","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/429540/avatar.png","web_url":"https://gitlab.com/ahanselka"},{"id":4411649,"username":"rehab","name":"Rehab","state":"active","avatar_url":"https://secure.gravatar.com/avatar/9d69bb3e051942900412ccf83871b403?s=80\u0026d=identicon","web_url":"https://gitlab.com/rehab"}],"author":{"id":2469083,"username":"erushton","name":"Elliot Rushton","state":"blocked","avatar_url":"https://secure.gravatar.com/avatar/4194662ce4a5b5f53e61689fd7a2daf9?s=80\u0026d=identicon","web_url":"https://gitlab.com/erushton"},"type":"ISSUE","assignee":{"id":215818,"username":"tmaczukin","name":"Tomasz Maczukin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0a9a99b9665ab7eda2cd7bffd54b1836?s=80\u0026d=identicon","web_url":"https://gitlab.com/tmaczukin"},"user_notes_count":8,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2022-08-23","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/16089","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":5,"completed_count":5},"weight":4,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/16089","notes":"https://gitlab.com/api/v4/projects/1304532/issues/16089/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/16089/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#16089","relative":"#16089","full":"gitlab-com/gl-infra/reliability#16089"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":768,"epic":{"id":572744,"iid":768,"title":"Multiple Linux Runner Sizes","url":"/groups/gitlab-com/gl-infra/-/epics/768","group_id":1112072},"iteration":null,"health_status":null},{"id":112057532,"iid":16080,"project_id":1304532,"title":"Adjust SLO for `urgent-authorized-projects` sidekiq queue","description":"## Summary\n\n\u003c!--\nGive context for what problem this issue is trying to prevent from happening again.\n\nProvide a brief assessment of the risk (chance and impact) of the problem that this corrective action fixes, to assist with triage and prioritization.\n--\u003e\n\nNewly common alert: [`The shard_urgent_authorized_projects SLI of the sidekiq service (main stage) has an apdex violating SLO`](https://gitlab.com/gitlab-com/gl-infra/production/-/issues/7491)\n\nBecause of: https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/15955#note_1010193110\n\nRequires: SLO adjustment\n\n### Should this be moved to `throttled`\n\nLooking at our [slos](https://gitlab.com/gitlab-com/runbooks/-/blob/c1f88c0a606e61aab56006f49359eaef6fe154e3/metrics-catalog/services/lib/sidekiq-helpers.libsonnet#L47-61) we have one called `throttled` where it doesn't look at `queue` time but only at `execution` time. \n\nThe `urgent-authorized-projects` is set to `urgent=high` so it also looks at queue time, which is affecting our apdex.\n\n\n#### Execution time\n\nLooking at 1 day it seems like most jobs complete under 2 seconds.\n\n![Screenshot_2022-08-02_at_09.36.32](/uploads/b5aea12f775b268af10c357ff2ad8a32/Screenshot_2022-08-02_at_09.36.32.png)\n\n[Source](https://thanos.gitlab.net/graph?g0.expr=sum(sidekiq_jobs_execution_time%3A1m%7Benvironment%3D%22gprd%22%2C%20shard%3D~%22urgent-authorized-projects%22%7D)%20by%20(shard)%0A\u0026g0.tab=0\u0026g0.stacked=0\u0026g0.range_input=1d\u0026g0.max_source_resolution=0s\u0026g0.deduplicate=1\u0026g0.partial_response=0\u0026g0.store_matches=%5B%5D)\n\nZooming out for 1 week we see the worst case scenario is `70s`\n\n![Screenshot_2022-08-02_at_09.41.51](/uploads/8607f81b3522baf28cefab886b6ec392/Screenshot_2022-08-02_at_09.41.51.png)\n\n[Source](https://thanos.gitlab.net/graph?g0.expr=sum(sidekiq_jobs_execution_time%3A1m%7Benvironment%3D%22gprd%22%2C%20shard%3D~%22urgent-authorized-projects%22%7D)%20by%20(shard)\u0026g0.tab=0\u0026g0.stacked=0\u0026g0.range_input=1w\u0026g0.max_source_resolution=0s\u0026g0.deduplicate=1\u0026g0.partial_response=0\u0026g0.store_matches=%5B%5D)\n\n#### Queue time\n\nLooking at the queue time the p95 is around 10s, which is right around the [`urgent=high` slo](https://gitlab.com/gitlab-com/runbooks/-/blob/c1f88c0a606e61aab56006f49359eaef6fe154e3/metrics-catalog/services/lib/sidekiq-helpers.libsonnet#L49)\n\n![Screenshot_2022-08-02_at_09.45.07](/uploads/605135208f1f992ca74b929f053c41e8/Screenshot_2022-08-02_at_09.45.07.png)\n\n[Source](https://thanos.gitlab.net/graph?g0.expr=histogram_quantile(0.95%2C%20sum(sli_aggregations%3Asidekiq_jobs_queue_duration_seconds_bucket_rate5m%7Benvironment%3D%22gprd%22%2C%20shard%3D~%22urgent-authorized-projects%22%7D)%20by%20(le%2C%20shard))\u0026g0.tab=0\u0026g0.stacked=0\u0026g0.range_input=1d\u0026g0.max_source_resolution=0s\u0026g0.deduplicate=1\u0026g0.partial_response=0\u0026g0.store_matches=%5B%5D)\n\nZooming out for 1 week we sometimes see it got to 60s\n\n![Screenshot_2022-08-02_at_09.56.43](/uploads/12a1c80a24e85669f19e0dc917f56954/Screenshot_2022-08-02_at_09.56.43.png)\n\n[Source](https://thanos.gitlab.net/graph?g0.expr=histogram_quantile(0.95%2C%20sum(sli_aggregations%3Asidekiq_jobs_queue_duration_seconds_bucket_rate5m%7Benvironment%3D%22gprd%22%2C%20shard%3D~%22urgent-authorized-projects%22%7D)%20by%20(le%2C%20shard))\u0026g0.tab=0\u0026g0.stacked=0\u0026g0.range_input=1w\u0026g0.max_source_resolution=0s\u0026g0.deduplicate=1\u0026g0.partial_response=0\u0026g0.store_matches=%5B%5D)\n\n### Conclusion\n\nThe `urgent-authorized-projects` was created to throttle the number of jobs we execute concurrently from saturating the DB. It's unfortunate that we added `urgent` in the shard name because it's not `urgent` but it's throttled.\n\n\n\n \n\n## Related Incident(s)\n\n\u003c!--\nNote the originating incident(s) and link known related incidents/other issues.\n\nThe relation will happen automatically if you are creating this issue from an incident, if this isn't done already please uncomment the following line:\n--\u003e\n\nOriginating issue(s): gitlab-com/gl-infra/production#7491\n\n\n## Desired Outcome/Acceptance Criteria\n\n\u003c!--\nHow will you know that this issue is complete?\n\nIf you have any initial thoughts on implementation details (e.g. what to do or not do, gotchas, edge cases etc.), please share them while they are fresh in your mind.\n--\u003e\n\nThis `urgent` classified activity is no longer completed within the expectations for `urgent` work, because it is being deliberately throttled with a lower concurrency level and less replicas.  It is not desired to reclassify this workload, but instead simply adjust the SLO for this particular queue so that it no longer alerts EOCs.\n\nWhat we should do is:\n\n- [x] Change the queue to `throttled` inside of the runbook :point_right: https://gitlab.com/gitlab-com/runbooks/-/merge_requests/4860\n- [x] Update the label from `urgent=high` to `urgent=throttled` so the `throttled` SLO is taken into consideration.\n    -  [x] `gstg`: https://gitlab.com/gitlab-com/gl-infra/k8s-workloads/gitlab-helmfiles/-/merge_requests/942\n    -  [x] `gprd`: https://gitlab.com/gitlab-com/gl-infra/k8s-workloads/gitlab-helmfiles/-/merge_requests/944\n- [x] Create follow up issue to clean this up with the shard itself (since the shard will be deleted once we fix https://gitlab.com/groups/gitlab-org/-/epics/8200) :point_right: https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/16080#note_1065636788\n\n## Associated Services\n\n\u003c!--\nApply the appropriate services associated with this corrective action if applicable.\n\n~Service::SERVICE_NAME\n\n--\u003e\n\n## Corrective Action Issue Checklist\n\n* [x] Link the incident(s) this corrective action arose out of\n* [x] Give context for what problem this corrective action is trying to prevent from re-occurring\n* [x] Assign a severity label (this is the highest sev of related incidents, defaults to 'severity::4')\n* [x] Assign a priority (this will default to 'priority::4')","state":"closed","created_at":"2022-07-22T17:58:40.957Z","updated_at":"2023-02-08T10:39:49.225Z","closed_at":"2022-08-16T06:57:03.900Z","closed_by":{"id":210928,"username":"steveazz","name":"Steve Azzopardi","state":"active","avatar_url":"https://secure.gravatar.com/avatar/4a5eeed7ec5c80642df9ee708bb496d7?s=80\u0026d=identicon","web_url":"https://gitlab.com/steveazz"},"labels":["Service::Sidekiq","alertmanager-silence","corrective action","priority::2","severity::4","team::Reliability","work::incident","workflow-infra::Done"],"milestone":null,"assignees":[{"id":210928,"username":"steveazz","name":"Steve Azzopardi","state":"active","avatar_url":"https://secure.gravatar.com/avatar/4a5eeed7ec5c80642df9ee708bb496d7?s=80\u0026d=identicon","web_url":"https://gitlab.com/steveazz"}],"author":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"type":"ISSUE","assignee":{"id":210928,"username":"steveazz","name":"Steve Azzopardi","state":"active","avatar_url":"https://secure.gravatar.com/avatar/4a5eeed7ec5c80642df9ee708bb496d7?s=80\u0026d=identicon","web_url":"https://gitlab.com/steveazz"},"user_notes_count":28,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/16080","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":9,"completed_count":9},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/16080","notes":"https://gitlab.com/api/v4/projects/1304532/issues/16080/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/16080/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#16080","relative":"#16080","full":"gitlab-com/gl-infra/reliability#16080"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":112047375,"iid":16078,"project_id":1304532,"title":"Update home page url in staging from https://about.staging.gitlab.com to https://staging.gitlab.com/users/sign_in","description":"\u003c!--\nThis template is for GitLab Team Members seeking support of SRE where there isn't an existing `request-*` template available.\n\nPlease fill out the details below.\n--\u003e\n\n**Details**\n - Point of contact for this request: @nnelson \n - If a call is needed, what is the proposed date and time of the call:  `2022-07-22 1500 utc`\n - Additional call details (format, type of call): `No call required`\n\n**SRE Support Needed**\n\nUpdate home page url in staging from `https://about.staging.gitlab.com` to `https://staging.gitlab.com/users/sign_in`.\n\nNavigate to [`https://staging.gitlab.com/admin/application_settings/general`](https://staging.gitlab.com/admin/application_settings/general) `\u003e ` `Sign-in restrictions`\n\nChange this field:\n\n![Screen_Shot_2022-07-22_at_9.20.34_AM](/uploads/c3be969bc84070782f54b984a79139de/Screen_Shot_2022-07-22_at_9.20.34_AM.png)\n\nTo the new value: https://staging.gitlab.com/users/sign_in\n\nClick `Save changes`.\n\n\u003c!--\nplease do not edit the below\n--\u003e","state":"closed","created_at":"2022-07-22T14:22:30.884Z","updated_at":"2022-08-10T20:07:47.380Z","closed_at":"2022-08-10T19:57:23.017Z","closed_by":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"labels":["Reliability::P4","environment::gstg","gitlab.com","priority::4","team::Reliability","unblocks others","work::general","workflow-infra::Done"],"milestone":null,"assignees":[{"id":2222520,"username":"dawsmith","name":"Dave Smith","state":"active","avatar_url":"https://secure.gravatar.com/avatar/ef341e061f6b86461626e64c5fbcfe52?s=80\u0026d=identicon","web_url":"https://gitlab.com/dawsmith"},{"id":8814797,"username":"amoter","name":"Anna Liisa Moter","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/8814797/avatar.png","web_url":"https://gitlab.com/amoter"},{"id":9043148,"username":"kwanyangu","name":"Kennedy Wanyangu","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/9043148/avatar.png","web_url":"https://gitlab.com/kwanyangu"},{"id":10167447,"username":"afappiano","name":"Anthony Fappiano","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/10167447/avatar.png","web_url":"https://gitlab.com/afappiano"}],"author":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"type":"ISSUE","assignee":{"id":2222520,"username":"dawsmith","name":"Dave Smith","state":"active","avatar_url":"https://secure.gravatar.com/avatar/ef341e061f6b86461626e64c5fbcfe52?s=80\u0026d=identicon","web_url":"https://gitlab.com/dawsmith"},"user_notes_count":0,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":"2022-07-22","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/16078","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/16078","notes":"https://gitlab.com/api/v4/projects/1304532/issues/16078/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/16078/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#16078","relative":"#16078","full":"gitlab-com/gl-infra/reliability#16078"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":102941271,"iid":15282,"project_id":1304532,"title":"Bring node_count from 2 to 3 for camoproxy service cluster in staging","description":"Bring node_count from 2 to 3 for camoproxy service cluster in staging.\n\nPart of: https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/15277\n\nFor more details see: https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/15277#note_852825341","state":"closed","created_at":"2022-02-23T16:29:21.885Z","updated_at":"2022-08-04T10:12:12.356Z","closed_at":"2022-02-24T05:00:20.215Z","closed_by":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"labels":["Infrastructure","Service::Camoproxy","environment::gstg","workflow-infra::Done"],"milestone":null,"assignees":[{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"}],"author":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"type":"ISSUE","assignee":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/15282","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/15282","notes":"https://gitlab.com/api/v4/projects/1304532/issues/15282/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/15282/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#15282","relative":"#15282","full":"gitlab-com/gl-infra/reliability#15282"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":708,"epic":{"id":468100,"iid":708,"title":"Vertically scale services to compensate for osqueryd saturation","url":"/groups/gitlab-com/gl-infra/-/epics/708","group_id":1112072,"human_readable_end_date":"May 7, 2022","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":102882061,"iid":15274,"project_id":1304532,"title":"Increase machine type for staging camoproxy","description":"Increase machine type for `staging` `camoproxy`.\n\nSo, a configuration for `osqueryd` appears to be causing leading to performance issues on small instances.\n\nThis issue tracks the work for increasting the machine type for the ~\"Service::Camoproxy\" instances in the `staging` environment.\n\nPart of: https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/15110","state":"closed","created_at":"2022-02-22T18:22:57.419Z","updated_at":"2022-08-04T10:12:17.953Z","closed_at":"2022-02-23T04:26:14.918Z","closed_by":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"labels":["Infrastructure","Service::Camoproxy","workflow-infra::Done"],"milestone":null,"assignees":[{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"}],"author":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"type":"ISSUE","assignee":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/15274","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/15274","notes":"https://gitlab.com/api/v4/projects/1304532/issues/15274/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/15274/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#15274","relative":"#15274","full":"gitlab-com/gl-infra/reliability#15274"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":94803334,"iid":14304,"project_id":1304532,"title":"Metrics and dashboards improvements","description":"## Context\n\nThis is part of the work to upgrade and migrate the GitLab.com container registry to a new version backed by a metadata database and online garbage collection (https://gitlab.com/groups/gitlab-org/-/epics/5523). This will be achieved following the gradual migration plan detailed in https://gitlab.com/gitlab-org/container-registry/-/issues/374.\n\n## Task\n\nGo through the list of Prometheus metrics and Grafana dashboards for the registry and ensure that everything is working as expected and displayed accurately. This is a good opportunity not only for fixes but also for generic improvements.","state":"closed","created_at":"2021-10-04T13:49:07.953Z","updated_at":"2022-08-04T11:17:38.891Z","closed_at":"2021-10-06T15:54:37.272Z","closed_by":{"id":5054840,"username":"jdrpereira","name":"João Pereira","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5054840/avatar.png","web_url":"https://gitlab.com/jdrpereira"},"labels":["Container Registry Migration","Container Registry Migration::Phase 1","Service::Container Registry","devops::package","group::package registry","section::ops","workflow-infra::Done"],"milestone":null,"assignees":[{"id":5054840,"username":"jdrpereira","name":"João Pereira","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5054840/avatar.png","web_url":"https://gitlab.com/jdrpereira"}],"author":{"id":5054840,"username":"jdrpereira","name":"João Pereira","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5054840/avatar.png","web_url":"https://gitlab.com/jdrpereira"},"type":"ISSUE","assignee":{"id":5054840,"username":"jdrpereira","name":"João Pereira","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5054840/avatar.png","web_url":"https://gitlab.com/jdrpereira"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/14304","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/14304","notes":"https://gitlab.com/api/v4/projects/1304532/issues/14304/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/14304/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#14304","relative":"#14304","full":"gitlab-com/gl-infra/reliability#14304"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":577,"epic":{"id":346213,"iid":577,"title":"Setup to support  Container Registry into Production","url":"/groups/gitlab-com/gl-infra/-/epics/577","group_id":1112072,"human_readable_end_date":"Nov 5, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":93417473,"iid":14146,"project_id":1304532,"title":"Clean up Consul node snapshots after OS upgrade","description":"After upgrading the console nodes https://gitlab.com/gitlab-com/gl-infra/production/-/issues/5481 and https://gitlab.com/gitlab-com/gl-infra/production/-/issues/5606, there will be some snapshots which we want to keep for at least several days, but probably not more than a few weeks.  We want to be able to close out the upgrade CR when it is finished, and not keep it open pending deleting these snapshots.\n\nThis issue is a reminder to clean up the snapshots after a reasonable amount of time has passed.","state":"closed","created_at":"2021-09-09T19:05:06.044Z","updated_at":"2022-08-04T11:19:21.185Z","closed_at":"2021-10-05T22:34:22.680Z","closed_by":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"labels":["Service::Consul","team::Reliability","workflow-infra::Done"],"milestone":null,"assignees":[{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"}],"author":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"type":"ISSUE","assignee":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/14146","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/14146","notes":"https://gitlab.com/api/v4/projects/1304532/issues/14146/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/14146/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#14146","relative":"#14146","full":"gitlab-com/gl-infra/reliability#14146"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":231,"epic":{"id":49437,"iid":231,"title":"GitLab.com Fleet OS Upgrades","url":"/groups/gitlab-com/gl-infra/-/epics/231","group_id":1112072},"iteration":null,"health_status":null},{"id":92826617,"iid":14099,"project_id":1304532,"title":"Increase the `shared_buffers` of `postgres-dr-delayed-01-db-gprd.c.gitlab-production.internal` to `20GB`","description":"Increase the `shared_buffers` of `postgres-dr-delayed-01-db-gprd.c.gitlab-production.internal` to `20GB`.\n\nSee: https://gitlab.com/gitlab-com/gl-infra/production/-/issues/5428#note_663616379","state":"closed","created_at":"2021-08-30T20:41:55.701Z","updated_at":"2022-08-04T11:19:46.584Z","closed_at":"2021-09-02T16:01:03.374Z","closed_by":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"labels":["corrective action","workflow-infra::Done"],"milestone":null,"assignees":[{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"}],"author":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"type":"ISSUE","assignee":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"user_notes_count":7,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/14099","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/14099","notes":"https://gitlab.com/api/v4/projects/1304532/issues/14099/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/14099/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#14099","relative":"#14099","full":"gitlab-com/gl-infra/reliability#14099"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":92222481,"iid":14038,"project_id":1304532,"title":"Upgrade GitLab services to terraform v1.0.X","description":"\nThe latest major version of terraform (v1.0) has hit GA and we should start planning to upgrade to avoid unnecessary tech debt.\n\nWe will have to push the changes to the following Auto-Devops environments:\n\n- [x] services-staging\n- [x] services-prod\n- [x] license-stg\n- [x] license-prd\n- [x] gs-staging\n- [x] gs-production\n\n\nRelated Issues:\n- We can use #12287 (closed) as a procedure reference.\n- [gitlab-com-infrastructure Terraform v0.14 to v1.0.4 Upgrade](https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/13908)","state":"closed","created_at":"2021-08-18T18:28:04.138Z","updated_at":"2021-08-26T21:09:10.977Z","closed_at":"2021-08-26T21:09:10.970Z","closed_by":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"labels":["team::Reliability","terraform","workflow-infra::Done"],"milestone":null,"assignees":[{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"}],"author":{"id":8509599,"username":"mchacon3","name":"Marcel Chacon","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/8509599/avatar.png","web_url":"https://gitlab.com/mchacon3"},"type":"ISSUE","assignee":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/14038","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":6,"completed_count":6},"weight":2,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/14038","notes":"https://gitlab.com/api/v4/projects/1304532/issues/14038/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/14038/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#14038","relative":"#14038","full":"gitlab-com/gl-infra/reliability#14038"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":466,"epic":{"id":268625,"iid":466,"title":"Upgrade to terraform v1.0","url":"/groups/gitlab-com/gl-infra/-/epics/466","group_id":1112072,"human_readable_end_date":"Jul 31, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":89844435,"iid":13732,"project_id":1304532,"title":"Remove un-needed keys from the staging omnibus GKMS vault","description":"https://gitlab.com/gitlab-com/gl-infra/production/-/issues/5050\n\nPer this incident issue, we should take a short term corrective action to fix the immediate problem of the Omnibus GKMS vault file being too large to encrypt. There are other on-going efforts to compress these JSON files before encryption.\n\nPer @alejandro, we should be able to remove some keys for praefect TLS to help save enough space to get things working in the short term. https://gitlab.com/gitlab-com/gl-infra/production/-/issues/5050#note_617653560\n\nSpecifically, removing these keys:\n- `omnibus-gitlab`:\n   - `ssl`:\n      - `praefect_certificate`\n      - `praefect_private_key`\n      - `trusted_certs`:\n         - `praefect.crt`","state":"closed","created_at":"2021-07-06T14:44:54.102Z","updated_at":"2021-08-18T20:49:46.904Z","closed_at":"2021-08-18T20:49:46.896Z","closed_by":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"labels":["corrective action","team::Reliability","workflow-infra::Done"],"milestone":null,"assignees":[{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"}],"author":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"type":"ISSUE","assignee":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"user_notes_count":3,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2021-07-09","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/13732","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/13732","notes":"https://gitlab.com/api/v4/projects/1304532/issues/13732/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/13732/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#13732","relative":"#13732","full":"gitlab-com/gl-infra/reliability#13732"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":89669363,"iid":13712,"project_id":1304532,"title":"Validate an existing node can switch to the v10 boot script","description":"Because of https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/13477 we can update the boot script and just require a reboot for it to stick.\n\nThe v10 of this script introduced in https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/13566 forces a node to use a `-generic` kernel to receive Ubuntu Advantage Kernel Livepatches.\n\nWe should validate that we can switch a node to v10 without a rebuild, by just rebooting.\n\nAC:\n\n- [x] In gstg create a new instance of `generic-stor` for each boot script version prior to v10 and each Ubuntu 16.04, 18.04, and 20.04\n   - start version is debatable, check in TF what is the lowest version in use.\n- [x] Make sure everything runs as usual (chef-client works successfully)\n- [x] bulk update the script version to v10 in TF\n- [x] reboot the machines\n- [x] Check the machines are now running a `-generic`-kernel\n- [x] Make sure everything runs as usual (chef-client works successfully)\n\nChecklist / notes whether it worked: (Replace `OK` with notes if required)\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eScript version/OS\u003c/th\u003e\n\u003cth\u003exenial / 16.04\u003c/th\u003e\n\u003cth\u003ebionic / 18.04\u003c/th\u003e\n\u003cth\u003efocal / 20.04\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003cbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e\n6\n\u003c/td\u003e\n\u003ctd\u003e\n\n- [x] OK\n\n\u003c/td\u003e\n\u003ctd\u003e\n\n- [x] OK\n\n\u003c/td\u003e\n\u003ctd\u003e\n\n- [x] OK\n\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\u003ctr\u003e\n\u003ctd\u003e\n7\n\u003c/td\u003e\n\u003ctd\u003e\n\n- [x] OK\n\n\u003c/td\u003e\n\u003ctd\u003e\n\n- [x] OK\n\n\u003c/td\u003e\n\u003ctd\u003e\n\n- [x] OK\n\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\u003ctr\u003e\n\u003ctd\u003e\n8\n\u003c/td\u003e\n\u003ctd\u003e\n\n- [x] OK\n\n\u003c/td\u003e\n\u003ctd\u003e\n\n- [x] OK\n\n\u003c/td\u003e\n\u003ctd\u003e\n\n- [x] OK\n\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\u003ctr\u003e\n\u003ctd\u003e\n9\n\u003c/td\u003e\n\u003ctd\u003e\n\n- [x] OK\n\n\u003c/td\u003e\n\u003ctd\u003e\n\n- [x] OK\n\n\u003c/td\u003e\n\u003ctd\u003e\n\n- [x] OK\n\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\u003ctr\u003e\n\u003ctd\u003e\n 10 itself (tested in dev)\n\u003c/td\u003e\n\u003ctd\u003e\n\n- [x] OK\n\n\u003c/td\u003e\n\u003ctd\u003e\n\n- [x] OK\n\n\u003c/td\u003e\n\u003ctd\u003e\n\n- [x] OK\n\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n(Any failures in regards to the epbf-exporter can be ignored, as long as chef-client still finishes. This is a known issue: https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/13575)","state":"closed","created_at":"2021-07-02T12:14:55.125Z","updated_at":"2021-08-16T21:11:24.924Z","closed_at":"2021-07-06T16:42:46.698Z","closed_by":{"id":555989,"username":"T4cC0re","name":"Hendrik Meyer","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/555989/avatar.png","web_url":"https://gitlab.com/T4cC0re"},"labels":["team::Reliability","workflow-infra::Done"],"milestone":null,"assignees":[{"id":555989,"username":"T4cC0re","name":"Hendrik Meyer","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/555989/avatar.png","web_url":"https://gitlab.com/T4cC0re"}],"author":{"id":555989,"username":"T4cC0re","name":"Hendrik Meyer","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/555989/avatar.png","web_url":"https://gitlab.com/T4cC0re"},"type":"ISSUE","assignee":{"id":555989,"username":"T4cC0re","name":"Hendrik Meyer","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/555989/avatar.png","web_url":"https://gitlab.com/T4cC0re"},"user_notes_count":5,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/13712","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":21,"completed_count":21},"weight":8,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/13712","notes":"https://gitlab.com/api/v4/projects/1304532/issues/13712/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/13712/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#13712","relative":"#13712","full":"gitlab-com/gl-infra/reliability#13712"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":231,"epic":{"id":49437,"iid":231,"title":"GitLab.com Fleet OS Upgrades","url":"/groups/gitlab-com/gl-infra/-/epics/231","group_id":1112072},"iteration":null,"health_status":null},{"id":89033504,"iid":13606,"project_id":1304532,"title":"Determine gitaly deduplication efficiency","description":"To determine whether we might use the project migration API we need to know the worst-case size of a project.\n\n\nAC: \n- [x] Build a script, that can get the size of the project itself, as well as referenced objects in the `@pool` structure.\n- [x] Run the script on multiple shards and gather the output","state":"closed","created_at":"2021-06-21T13:19:38.911Z","updated_at":"2021-06-24T12:40:31.541Z","closed_at":"2021-06-24T12:29:30.588Z","closed_by":{"id":555989,"username":"T4cC0re","name":"Hendrik Meyer","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/555989/avatar.png","web_url":"https://gitlab.com/T4cC0re"},"labels":["workflow-infra::Done"],"milestone":null,"assignees":[{"id":555989,"username":"T4cC0re","name":"Hendrik Meyer","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/555989/avatar.png","web_url":"https://gitlab.com/T4cC0re"}],"author":{"id":555989,"username":"T4cC0re","name":"Hendrik Meyer","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/555989/avatar.png","web_url":"https://gitlab.com/T4cC0re"},"type":"ISSUE","assignee":{"id":555989,"username":"T4cC0re","name":"Hendrik Meyer","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/555989/avatar.png","web_url":"https://gitlab.com/T4cC0re"},"user_notes_count":17,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/13606","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":2,"completed_count":2},"weight":5,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/13606","notes":"https://gitlab.com/api/v4/projects/1304532/issues/13606/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/13606/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#13606","relative":"#13606","full":"gitlab-com/gl-infra/reliability#13606"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":231,"epic":{"id":49437,"iid":231,"title":"GitLab.com Fleet OS Upgrades","url":"/groups/gitlab-com/gl-infra/-/epics/231","group_id":1112072},"iteration":null,"health_status":null},{"id":88756621,"iid":13566,"project_id":1304532,"title":"Ubuntu Advantage aware bootstrap script","description":"This issue is to split our scope-creep from https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/10039 regarding https://ops.gitlab.net/gitlab-com/gl-infra/terraform-modules/google/bootstrap/-/merge_requests/14\n\nAs per https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/10039#note_577158689:\n\nRework kernel management\n  * Install the latest kernel at node bootstrap time, no more hardcoding of versions. (make sure apt holding works though, just in case we are forced to rollback a kernel)\n  * Use livepatch to keep security updates\n  * Use livepatch status to see whether all security updates could be applied or if there is a reboot required.\n\nThe MR linked above adds it. This issue is to document the rollout of v10 of the bootstrap script.","state":"closed","created_at":"2021-06-15T15:04:00.151Z","updated_at":"2021-07-09T17:12:13.018Z","closed_at":"2021-07-02T14:49:38.583Z","closed_by":{"id":555989,"username":"T4cC0re","name":"Hendrik Meyer","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/555989/avatar.png","web_url":"https://gitlab.com/T4cC0re"},"labels":["team::Reliability","workflow-infra::Done"],"milestone":null,"assignees":[{"id":555989,"username":"T4cC0re","name":"Hendrik Meyer","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/555989/avatar.png","web_url":"https://gitlab.com/T4cC0re"}],"author":{"id":555989,"username":"T4cC0re","name":"Hendrik Meyer","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/555989/avatar.png","web_url":"https://gitlab.com/T4cC0re"},"type":"ISSUE","assignee":{"id":555989,"username":"T4cC0re","name":"Hendrik Meyer","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/555989/avatar.png","web_url":"https://gitlab.com/T4cC0re"},"user_notes_count":6,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/13566","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":8,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/13566","notes":"https://gitlab.com/api/v4/projects/1304532/issues/13566/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/13566/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#13566","relative":"#13566","full":"gitlab-com/gl-infra/reliability#13566"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":231,"epic":{"id":49437,"iid":231,"title":"GitLab.com Fleet OS Upgrades","url":"/groups/gitlab-com/gl-infra/-/epics/231","group_id":1112072},"iteration":null,"health_status":null},{"id":87529364,"iid":13419,"project_id":1304532,"title":"Teleport approvals not working from remote command lines","description":"The `tctl` command is not working from remote sessions.  It works fine from the server, but from an approver's laptop, it's not working.\n\nThe error looks like: \n\n```\n[CLIENT]       Cannot connect to the auth server: failed direct dial to auth server: Get \"https://teleport.cluster.local/v2/configuration/name\": x509: certificate is valid for teleport.gprd.gitlab.net, not 73746167696e672d74656c65706f72742d636c7573746572.teleport.cluster.local\n    Get \"https://teleport.cluster.local/v2/configuration/name\": x509: certificate is valid for teleport.gprd.gitlab.net, not 73746167696e672d74656c65706f72742d636c7573746572.teleport.cluster.local, failed dial to auth server through reverse tunnel: Get \"https://teleport.cluster.local/v2/configuration/name\": dial tcp 34.74.121.190:3024: connect: operation timed out\n    Get \"https://teleport.cluster.local/v2/configuration/name\": dial tcp 34.74.121.190:3024: connect: operation timed out.\nIs the auth server running on \"teleport.gprd.gitlab.net:3080\"?\n```","state":"closed","created_at":"2021-05-21T21:02:13.266Z","updated_at":"2021-05-21T21:38:53.602Z","closed_at":"2021-05-21T21:35:33.479Z","closed_by":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"labels":["unscheduled","workflow-infra::Done"],"milestone":null,"assignees":[{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"}],"author":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"type":"ISSUE","assignee":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"user_notes_count":3,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/13419","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/13419","notes":"https://gitlab.com/api/v4/projects/1304532/issues/13419/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/13419/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#13419","relative":"#13419","full":"gitlab-com/gl-infra/reliability#13419"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":350,"epic":{"id":133459,"iid":350,"title":"Project: Rails Console Access","url":"/groups/gitlab-com/gl-infra/-/epics/350","group_id":1112072,"human_readable_end_date":"Jul 31, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":87295112,"iid":13396,"project_id":1304532,"title":"Container Registry: Define custom SLI for blob upload routes","description":"## Context\nAs part of https://gitlab.com/groups/gitlab-com/gl-infra/-/epics/476, we're breaking the single Container Registry SLI into multiple SLIs per API route.\n\n## Proposal\n\nSeparate the blob upload routes SLI. 3 SLIs is what we should go for this route:\n\n* `server_route_blob_upload_uuid_writes`: `PATCH`, `PUT`\n* `server_route_blob_upload_uuid_deletes`: `DELETE`\n* `server_route_blob_upload_uuid_reads`: `GET` (with a comment that `GET` is unused?)\n\n\nSee https://gitlab.com/groups/gitlab-com/gl-infra/-/epics/476#note_578464890 for additional details.","state":"closed","created_at":"2021-05-18T16:16:12.998Z","updated_at":"2023-03-08T10:04:15.743Z","closed_at":"2023-03-06T12:06:13.710Z","closed_by":{"id":171554,"username":"reprazent","name":"Bob Van Landuyt","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/171554/avatar.png","web_url":"https://gitlab.com/reprazent"},"labels":["Error Budget Improvement","Observability","Service::Container Registry","devops::package","group::container registry","section::ops","type::maintenance","work::general"],"milestone":{"id":2745654,"iid":804,"group_id":6543,"title":"15.10","description":"","state":"active","created_at":"2022-08-22T17:01:14.967Z","updated_at":"2022-08-22T17:01:14.967Z","due_date":"2023-03-17","start_date":"2023-02-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/-/milestones/804"},"assignees":[{"id":5054840,"username":"jdrpereira","name":"João Pereira","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5054840/avatar.png","web_url":"https://gitlab.com/jdrpereira"}],"author":{"id":5054840,"username":"jdrpereira","name":"João Pereira","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5054840/avatar.png","web_url":"https://gitlab.com/jdrpereira"},"type":"ISSUE","assignee":{"id":5054840,"username":"jdrpereira","name":"João Pereira","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5054840/avatar.png","web_url":"https://gitlab.com/jdrpereira"},"user_notes_count":9,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/13396","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/13396","notes":"https://gitlab.com/api/v4/projects/1304532/issues/13396/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/13396/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#13396","relative":"#13396","full":"gitlab-com/gl-infra/reliability#13396"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":476,"epic":{"id":273485,"iid":476,"title":"Container Registry: Refactor SLIs post upgrade/migration","url":"/groups/gitlab-com/gl-infra/-/epics/476","group_id":1112072,"human_readable_end_date":"Mar 17, 2023","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":87036899,"iid":13362,"project_id":1304532,"title":"Investigate/setup restart policy for teleport","description":"Discovered on staging today (2021-05-13) that teleport on staging had been dead for a while:\n\n```\ndsmith@teleport-01-inf-gstg.c.gitlab-staging-1.internal:~$ systemctl status teleport\n● teleport.service - Gravitational Teleport - Access Control Server\n   Loaded: loaded (/etc/systemd/system/teleport.service; enabled; vendor preset: enabled)\n   Active: inactive (dead) since Fri 2021-04-30 21:15:51 UTC; 1 weeks 5 days ago\n     Docs: https://goteleport.com/teleport/docs/\n Main PID: 19722 (code=exited, status=0/SUCCESS)\n```\n\nOddly the code is exited / success so I wonder what happened.\n\nLooks like the systemd unit does have `Restart = on-failure`, but that didn't work in this case with success?","state":"closed","created_at":"2021-05-13T14:05:50.617Z","updated_at":"2021-05-17T07:54:08.173Z","closed_at":"2021-05-14T01:18:16.607Z","closed_by":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"labels":["workflow-infra::Done"],"milestone":{"id":1994752,"iid":136,"group_id":1112072,"title":"Core-Infra FY22Q2 Items","description":"This milestone is a bucket to make sure we can see things on our board:\r\n\r\n[https://gitlab.com/groups/gitlab-com/gl-infra/-/boards/1688496?\u0026label_name\\[\\]=team%3A%3ACore-Infra](https://gitlab.com/groups/gitlab-com/gl-infra/-/boards/1688496?\u0026label_name%5B%5D=team%3A%3ACore-Infra)","state":"closed","created_at":"2021-04-13T15:13:04.655Z","updated_at":"2021-11-12T05:29:30.642Z","due_date":"2021-07-31","start_date":"2021-05-01","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/136"},"assignees":[{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"}],"author":{"id":2222520,"username":"dawsmith","name":"Dave Smith","state":"active","avatar_url":"https://secure.gravatar.com/avatar/ef341e061f6b86461626e64c5fbcfe52?s=80\u0026d=identicon","web_url":"https://gitlab.com/dawsmith"},"type":"ISSUE","assignee":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"user_notes_count":5,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/13362","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/13362","notes":"https://gitlab.com/api/v4/projects/1304532/issues/13362/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/13362/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#13362","relative":"#13362","full":"gitlab-com/gl-infra/reliability#13362"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":350,"epic":{"id":133459,"iid":350,"title":"Project: Rails Console Access","url":"/groups/gitlab-com/gl-infra/-/epics/350","group_id":1112072,"human_readable_end_date":"Jul 31, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":86945122,"iid":13352,"project_id":1304532,"title":"Disk space usage on nfs-file-{48,49,50,51} is between `86.41%` and `89.45%`","description":"We might need to do some repository shuffling away from `nfs-file-{48,49,50,51}` which are between `86.41%` and `89.45%`: https://dashboards.gitlab.net/d/W_Pbu9Smk/storage-stats?orgId=1\u0026refresh=30m\u0026var-env=gprd\u0026var-environment=gprd\u0026var-node=All\u0026from=1620742126000\u0026to=1620828526000\u0026viewPanel=160\n\nUnless there is some trigger which automatically re-homes git repositories after a specific threshold is crossed.\n\nThis is a scenario which this epic (https://gitlab.com/groups/gitlab-com/gl-infra/-/epics/357) is intended to address, and is implementation complete (https://gitlab.com/gitlab-com/gl-infra/balancer), fully tested in `staging`, but not yet tested in production.\n\nObviously, we can do this manually very easily now.\n\nI think it is worth discussing if now would be a good time to proceed with production testing of the automation.","state":"closed","created_at":"2021-05-12T14:15:31.306Z","updated_at":"2022-08-04T11:26:14.096Z","closed_at":"2021-09-21T20:20:15.974Z","closed_by":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"labels":["DStores-Backlog::GTLY","GitLab.com Resource Saturation","Service::Gitaly","workflow-infra::Done"],"milestone":null,"assignees":[],"author":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"type":"ISSUE","assignee":null,"user_notes_count":5,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/13352","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/13352","notes":"https://gitlab.com/api/v4/projects/1304532/issues/13352/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/13352/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#13352","relative":"#13352","full":"gitlab-com/gl-infra/reliability#13352"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":85776055,"iid":13191,"project_id":1304532,"title":"Setup ansible user across the fleet","description":"In order to support testing Ansible against nodes in our GCP projects, we will need to have a target user setup for connections from the control node (CI runner).\n\nTo establish access to existing hosts, we will create a data bag for the user in Chef, and add a pre-generated SSH key (that will be saved in 1Password).\n\nFor long-term access that will remain once we move further with the migration and no longer have Chef, or no longer perform user provisioning with Chef, we will need to update the bootstrap module to make sure the user exists when a compute instance is initially provisioned by terraform.","state":"closed","created_at":"2021-04-22T21:41:58.190Z","updated_at":"2022-11-22T15:20:43.121Z","closed_at":"2022-11-22T15:20:42.894Z","closed_by":{"id":693144,"username":"craig","name":"Craig Barrett","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c8dfa1ca41754b9409068e5e42080cd2?s=80\u0026d=identicon","web_url":"https://gitlab.com/craig"},"labels":["Reliability::P4","ansible","auto updated","chef","team::Reliability","workflow-infra::Cancelled"],"milestone":{"id":1994752,"iid":136,"group_id":1112072,"title":"Core-Infra FY22Q2 Items","description":"This milestone is a bucket to make sure we can see things on our board:\r\n\r\n[https://gitlab.com/groups/gitlab-com/gl-infra/-/boards/1688496?\u0026label_name\\[\\]=team%3A%3ACore-Infra](https://gitlab.com/groups/gitlab-com/gl-infra/-/boards/1688496?\u0026label_name%5B%5D=team%3A%3ACore-Infra)","state":"closed","created_at":"2021-04-13T15:13:04.655Z","updated_at":"2021-11-12T05:29:30.642Z","due_date":"2021-07-31","start_date":"2021-05-01","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/136"},"assignees":[],"author":{"id":693144,"username":"craig","name":"Craig Barrett","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c8dfa1ca41754b9409068e5e42080cd2?s=80\u0026d=identicon","web_url":"https://gitlab.com/craig"},"type":"ISSUE","assignee":null,"user_notes_count":8,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/13191","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/13191","notes":"https://gitlab.com/api/v4/projects/1304532/issues/13191/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/13191/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#13191","relative":"#13191","full":"gitlab-com/gl-infra/reliability#13191"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":392,"epic":{"id":175938,"iid":392,"title":"Replace Chef with Ansible","url":"/groups/gitlab-com/gl-infra/-/epics/392","group_id":1112072,"human_readable_end_date":"Sep 10, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":84947722,"iid":13061,"project_id":1304532,"title":"Developer Evangelism Group Project","description":"# Group Project Request\n\n- Project / Group Name (\u003c17 characters and start with `group-`): group-community\n- Project Administrator (email): jcoghlan@gitlab.com \n\n### Provide a brief overview of the reason for this project and why it is needed and for how long it will be used.\n\nWill primarily be used by the Developer Evangelism team in testing, demos, and content creation. \n\n## Security\n\n### Provide a list of data and the corresponding classification that will be used in this project and how it will be accessed.\n\n\n## Group Project Access Checklist\n\nMake sure the following criteria is met and understood by the project administrator. \n\n- [ ] If the gitlab.com database is copied, that data has been processed by the [pseudonymization script]( https://gitlab.com/gitlab-com/runbooks/blob/master/howto/pseudonymization-gitlab-db.md).\n- [ ] Regular security updates are applied to all nodes in the project.\n- [ ] Unused instances will be removed in a timely manner\n- [ ] The Project Administrator is responsible for any users or additional administrators that they add to the project\n- [ ] The Project Administrator is responsible for justifying any cloud spend within the project.\n- [ ] Group Projects are intended for development, test, or demo work. Everything in these projects is considered temporary.\n\n## Infrastructure Tasks\n\n- [x] Create a new branch that is **not** the same as the group name and is less than 25 characters long. For example, `add-telemetry-group`.\n- [x] Create file in https://ops.gitlab.net/gitlab-com/group-projects named `environments/(group name from above).tfvars` by copying an existing file and changing the Administrator and Group Name variables\n- [x] Once the pipeline succeeds, review the changes are correct and stop the review by activating the `stop_review` job\n- [x] Merge the change to master\n- [x] Create a branch from master named `(group name from above)` and push\n- [x] Verify that the pipeline completed successfully at https://ops.gitlab.net/gitlab-com/group-projects/pipelines\n- [ ] (Optional) If the group does not start with `group-*` or `gitlab-qa-*k`, add the newly created branch as a protected branch.","state":"closed","created_at":"2021-04-09T17:32:36.685Z","updated_at":"2021-06-09T17:04:15.636Z","closed_at":"2021-06-09T17:04:15.610Z","closed_by":{"id":429540,"username":"ahanselka","name":"Alex Hanselka","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/429540/avatar.png","web_url":"https://gitlab.com/ahanselka"},"labels":["team::Reliability","workflow-infra::Done"],"milestone":{"id":1994752,"iid":136,"group_id":1112072,"title":"Core-Infra FY22Q2 Items","description":"This milestone is a bucket to make sure we can see things on our board:\r\n\r\n[https://gitlab.com/groups/gitlab-com/gl-infra/-/boards/1688496?\u0026label_name\\[\\]=team%3A%3ACore-Infra](https://gitlab.com/groups/gitlab-com/gl-infra/-/boards/1688496?\u0026label_name%5B%5D=team%3A%3ACore-Infra)","state":"closed","created_at":"2021-04-13T15:13:04.655Z","updated_at":"2021-11-12T05:29:30.642Z","due_date":"2021-07-31","start_date":"2021-05-01","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/136"},"assignees":[{"id":429540,"username":"ahanselka","name":"Alex Hanselka","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/429540/avatar.png","web_url":"https://gitlab.com/ahanselka"}],"author":{"id":2815943,"username":"johncoghlan","name":"John Coghlan","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2815943/avatar.png","web_url":"https://gitlab.com/johncoghlan"},"type":"ISSUE","assignee":{"id":429540,"username":"ahanselka","name":"Alex Hanselka","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/429540/avatar.png","web_url":"https://gitlab.com/ahanselka"},"user_notes_count":5,"merge_requests_count":0,"upvotes":2,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/13061","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":13,"completed_count":6},"weight":2,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/13061","notes":"https://gitlab.com/api/v4/projects/1304532/issues/13061/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/13061/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#13061","relative":"#13061","full":"gitlab-com/gl-infra/reliability#13061"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":82056775,"iid":12995,"project_id":1304532,"title":"PoC migrating GET to collections format","description":"As noted in https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/12787#note_542492346, shifting the ansible code within the [GitLab Environment Toolkit](https://gitlab.com/gitlab-org/quality/gitlab-environment-toolkit) and publishing the package to Galaxy would enable us to use that as an upstream dependency upon which we would build our gitlab.com-specific code. Ideally, when we begin shifting functionality from our existing Chef cookbooks, this would enable us to focus general updates and improvements to GET for all of its downstream users to benefit, and things which are highly specific to the gitlab.com deployment within GCP to a `gitlab.gitlab-com` collection.\n\nThis idea is not fully fleshed out, yet, and may not be feasible to incorporate with our current processes/requirements for managing the various roles/fleets within our infrastructure.","state":"closed","created_at":"2021-03-31T23:23:53.646Z","updated_at":"2021-07-27T21:14:26.015Z","closed_at":"2021-07-27T21:14:25.799Z","closed_by":{"id":693144,"username":"craig","name":"Craig Barrett","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c8dfa1ca41754b9409068e5e42080cd2?s=80\u0026d=identicon","web_url":"https://gitlab.com/craig"},"labels":["ansible","team::Reliability","workflow-infra::Done"],"milestone":{"id":1994752,"iid":136,"group_id":1112072,"title":"Core-Infra FY22Q2 Items","description":"This milestone is a bucket to make sure we can see things on our board:\r\n\r\n[https://gitlab.com/groups/gitlab-com/gl-infra/-/boards/1688496?\u0026label_name\\[\\]=team%3A%3ACore-Infra](https://gitlab.com/groups/gitlab-com/gl-infra/-/boards/1688496?\u0026label_name%5B%5D=team%3A%3ACore-Infra)","state":"closed","created_at":"2021-04-13T15:13:04.655Z","updated_at":"2021-11-12T05:29:30.642Z","due_date":"2021-07-31","start_date":"2021-05-01","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/136"},"assignees":[{"id":693144,"username":"craig","name":"Craig Barrett","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c8dfa1ca41754b9409068e5e42080cd2?s=80\u0026d=identicon","web_url":"https://gitlab.com/craig"},{"id":8814797,"username":"amoter","name":"Anna Liisa Moter","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/8814797/avatar.png","web_url":"https://gitlab.com/amoter"}],"author":{"id":693144,"username":"craig","name":"Craig Barrett","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c8dfa1ca41754b9409068e5e42080cd2?s=80\u0026d=identicon","web_url":"https://gitlab.com/craig"},"type":"ISSUE","assignee":{"id":693144,"username":"craig","name":"Craig Barrett","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c8dfa1ca41754b9409068e5e42080cd2?s=80\u0026d=identicon","web_url":"https://gitlab.com/craig"},"user_notes_count":16,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12995","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12995","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12995/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12995/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12995","relative":"#12995","full":"gitlab-com/gl-infra/reliability#12995"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":392,"epic":{"id":175938,"iid":392,"title":"Replace Chef with Ansible","url":"/groups/gitlab-com/gl-infra/-/epics/392","group_id":1112072,"human_readable_end_date":"Sep 10, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":81962137,"iid":12984,"project_id":1304532,"title":"Update CSP directives for embedded iframes","description":"Many teams are creating curated learning paths/partner content in the EdCast platform (GitLab Learn) and ImPartner using SSOT content from the GitLab docs site and handbook. But if a user clicks the Web IDE button at the bottom of a handbooks page from within the iframe in either, the iframe goes blank.\n\nWe need to support embedded content from\n```\nedcast.gitlab.com\ngitlab-learn.leapest.com\npartners.gitlab.com\n```\n\nThe definition of done here is to ensure that the 3rd party sites listed above where we're embedding content from the handbook are allowed in the CSP `frame-ancestors` directive within Fastly and the same for gitlab.com and Cloudflare (for the WebIDE). Ideally, we will also be able to test against staging before changing the production config.\n\nFor additional context, this was highlighted while [updating CSP directives for the handbook](https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/12062#note_541359829) to enable clickable SVG objects, and the [updated CSP inadvertently blocked embedded iframes](https://gitlab.com/gitlab-com/www-gitlab-com/-/issues/10052#note_541406634) from external 3rd party sites GitLab teams are using to provide educational content, partner resources, etc. This [has been an issue](https://gitlab.com/gitlab-com/www-gitlab-com/-/issues/7638#note_341249056) in the past, as well.","state":"closed","created_at":"2021-03-30T22:57:39.066Z","updated_at":"2021-06-24T08:06:20.467Z","closed_at":"2021-06-10T21:27:53.259Z","closed_by":{"id":4668878,"username":"c.yoshida","name":"Christine Yoshida","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4668878/avatar.png","web_url":"https://gitlab.com/c.yoshida"},"labels":["AssistType::HandbookMaintenance","AssistingTeam::Sales","CDN","corrective action","workflow-infra::Done"],"milestone":{"id":1994752,"iid":136,"group_id":1112072,"title":"Core-Infra FY22Q2 Items","description":"This milestone is a bucket to make sure we can see things on our board:\r\n\r\n[https://gitlab.com/groups/gitlab-com/gl-infra/-/boards/1688496?\u0026label_name\\[\\]=team%3A%3ACore-Infra](https://gitlab.com/groups/gitlab-com/gl-infra/-/boards/1688496?\u0026label_name%5B%5D=team%3A%3ACore-Infra)","state":"closed","created_at":"2021-04-13T15:13:04.655Z","updated_at":"2021-11-12T05:29:30.642Z","due_date":"2021-07-31","start_date":"2021-05-01","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/136"},"assignees":[{"id":693144,"username":"craig","name":"Craig Barrett","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c8dfa1ca41754b9409068e5e42080cd2?s=80\u0026d=identicon","web_url":"https://gitlab.com/craig"},{"id":4668878,"username":"c.yoshida","name":"Christine Yoshida","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4668878/avatar.png","web_url":"https://gitlab.com/c.yoshida"}],"author":{"id":4668878,"username":"c.yoshida","name":"Christine Yoshida","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4668878/avatar.png","web_url":"https://gitlab.com/c.yoshida"},"type":"ISSUE","assignee":{"id":693144,"username":"craig","name":"Craig Barrett","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c8dfa1ca41754b9409068e5e42080cd2?s=80\u0026d=identicon","web_url":"https://gitlab.com/craig"},"user_notes_count":8,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12984","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12984","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12984/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12984/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12984","relative":"#12984","full":"gitlab-com/gl-infra/reliability#12984"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":81448025,"iid":12905,"project_id":1304532,"title":"SRE Onboarding template assumes the engineer has SSH access for Chef steps","description":"As an onboarding engineer, the steps to configure Chef (and knife) require that an SSH user is configured via the Chef data bags to allow SSH to the chef server. The order of these steps should be updated to reflect this dependency and a caveat should be added to the Chef steps for creating the Chef user so that it is understood that SSH steps will need to be completed first.","state":"closed","created_at":"2021-03-22T19:32:48.893Z","updated_at":"2022-08-04T11:30:59.232Z","closed_at":"2021-03-23T11:45:21.267Z","closed_by":{"id":8410890,"username":"nhoppe1","name":"Natan Hoppe","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/8410890/avatar.png","web_url":"https://gitlab.com/nhoppe1"},"labels":["Unplanned","workflow-infra::Done"],"milestone":{"id":1852669,"iid":132,"group_id":1112072,"title":"Core-Infra Mar 14 - Mar 27","description":"","state":"closed","created_at":"2021-01-27T20:25:20.396Z","updated_at":"2021-04-13T15:17:38.707Z","due_date":"2021-03-27","start_date":"2021-03-14","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/132"},"assignees":[{"id":8410890,"username":"nhoppe1","name":"Natan Hoppe","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/8410890/avatar.png","web_url":"https://gitlab.com/nhoppe1"}],"author":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"type":"ISSUE","assignee":{"id":8410890,"username":"nhoppe1","name":"Natan Hoppe","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/8410890/avatar.png","web_url":"https://gitlab.com/nhoppe1"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12905","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12905","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12905/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12905/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12905","relative":"#12905","full":"gitlab-com/gl-infra/reliability#12905"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":81337239,"iid":12893,"project_id":1304532,"title":"Increase frequency of `ANALYZE` operation on `namespaces` table to every `30 minutes`","description":"Increase frequency of `ANALYZE` operation on `namespaces` table to every `30 minutes`.\n\nAlvaro Hernandex writes:\n\n\u003e Current incident started ~ 40mins after the last cron-ed ANALYZE. So probably 1h is not frequent enough. I'd suggest to run it more frequently, every 30 mins or even 15 minutes. It is a lightweight operation, which causes a bit of I/O and lasts, under weekend non-incident profile, just 18 seconds (probably under peak load on a week day more, but still quite lightweight).\n\n@brentnewton writes:\n\n\u003e based on this, let’s move to every 30 mins.\n\n~\"corrective action\" for production incident https://gitlab.com/gitlab-com/gl-infra/production/-/issues/4024","state":"closed","created_at":"2021-03-20T21:16:37.564Z","updated_at":"2021-03-22T22:56:57.772Z","closed_at":"2021-03-20T22:51:50.613Z","closed_by":{"id":4437855,"username":"brentnewton","name":"Brent Newton","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4437855/avatar.png","web_url":"https://gitlab.com/brentnewton"},"labels":["Database","Patroni","Service::Postgres","configuration","corrective action","severity::1","workflow-infra::Done"],"milestone":null,"assignees":[{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"}],"author":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"type":"ISSUE","assignee":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"user_notes_count":0,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2021-03-20","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12893","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12893","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12893/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12893/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12893","relative":"#12893","full":"gitlab-com/gl-infra/reliability#12893"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":80939112,"iid":12837,"project_id":1304532,"title":"Replace CustomerDot Zuora integration User to Remediate SOX Gap","description":"The CustomerDot Integration User is currently tied to a specific engineer's email address.  The following Issue contains additinoal context:  https://gitlab.com/gitlab-com/business-ops/enterprise-apps/intake/-/issues/91.  @jameslopez [has provided advice on what email should be associated with the CustomerDot integration user](https://gitlab.com/gitlab-com/business-ops/enterprise-apps/intake/-/issues/91#note_520357501):  `fulfillment-be+zuoraprod@gitlab.com`\n\nThe ask here is to work with the Infrastructure team to complete the switch of the CustomerDot integration user from `ruben_APIproduction@gitlab.com` to `fulfillment-be+zuoraprod@gitlab.com`","state":"closed","created_at":"2021-03-15T14:30:07.565Z","updated_at":"2021-05-11T17:09:21.010Z","closed_at":"2021-05-07T18:06:55.975Z","closed_by":{"id":8509599,"username":"mchacon3","name":"Marcel Chacon","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/8509599/avatar.png","web_url":"https://gitlab.com/mchacon3"},"labels":["AssistType::CloudInfra","AssistingTeam::Growth\u0026Fullfillment","Unplanned","workflow-infra::Done"],"milestone":{"id":1994749,"iid":135,"group_id":1112072,"title":"Core-Infra FY22Q1 Items","description":"This milestone is a bucket to make sure we can see things on our board:\r\n\r\nhttps://gitlab.com/groups/gitlab-com/gl-infra/-/boards/1688496?\u0026label_name[]=team%3A%3ACore-Infra","state":"closed","created_at":"2021-04-13T15:12:22.906Z","updated_at":"2021-05-12T18:53:03.055Z","due_date":"2021-04-30","start_date":"2021-02-01","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/135"},"assignees":[{"id":8509599,"username":"mchacon3","name":"Marcel Chacon","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/8509599/avatar.png","web_url":"https://gitlab.com/mchacon3"}],"author":{"id":7200051,"username":"mquitevis","name":"Mark Quitevis","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/7200051/avatar.png","web_url":"https://gitlab.com/mquitevis"},"type":"ISSUE","assignee":{"id":8509599,"username":"mchacon3","name":"Marcel Chacon","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/8509599/avatar.png","web_url":"https://gitlab.com/mchacon3"},"user_notes_count":9,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2021-04-16","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12837","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12837","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12837/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12837/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12837","relative":"#12837","full":"gitlab-com/gl-infra/reliability#12837"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":80821930,"iid":12822,"project_id":1304532,"title":"Disable Cloudflare `Onion Routing` setting","description":"**Current Situation**\n\u003c!--Describe the current situation which you are intending to iterate on with the work described in this issue.--\u003e\nThe `Onion Routing` setting is enabled on GitLab.com. This causes Cloudflare to issue an `alt-svc` header to tor browsers.  \nIt is presumed, that the behaviour causes issues with Cloudflare Spectrum to trigger https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/10860. This makes the site *unusable through tor* without disabling that header manually client-side.\n\n![Screenshot_from_2021-03-12_18-40-01](/uploads/8daccc432b27ca23241f5caf267b0230/Screenshot_from_2021-03-12_18-40-01.png)\n\n**Desired Outcome**\n\u003c!--Describe the intended outcome of the work represented in this issue. How does it improve upon the current situation above?--\u003e\nDisable the `Onion Routing` setting. That will cause TOR traffic to run through the usual tor relays and not be short-circuited to Cloudflare via a hidden service. Customers might see the Challenge page, but afterward, it should work normally, as we don't hit the issue in #10860.\n\nThis fix is easy to apply and at least will make the site usable, albeit with some inconvenience to the user.\n\nhttps://ops.gitlab.net/gitlab-com/gitlab-com-infrastructure/-/blob/cc7bfef7e45642aebaff8c19a8db936da21d361e/environments/gstg/main.tf#L2058 must be set to `off`  \nhttps://ops.gitlab.net/gitlab-com/gitlab-com-infrastructure/-/blob/cc7bfef7e45642aebaff8c19a8db936da21d361e/environments/gprd/main.tf#L2208 must be set to `off`\n\n---\nThis might also be an upstream but in Cloudflare, as we use Cloudflare Spectrum for our HTTPS ingress. We should raise a case with them to see if that may contribute to the problem, as their hidden services might interfere with that/affect this behavior.\n---\n\n**Acceptance Criteria**\n\u003c!--List out work items necessary to arrive at the desired outcome above, as atomically as possible.--\u003e\n- [ ] `Onion Routing` is turned off on gstg\n- [ ] `Onion Routing` is turned off on gprd","state":"closed","created_at":"2021-03-12T17:57:15.168Z","updated_at":"2022-08-04T11:32:07.307Z","closed_at":"2022-01-14T11:46:40.479Z","closed_by":{"id":555989,"username":"T4cC0re","name":"Hendrik Meyer","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/555989/avatar.png","web_url":"https://gitlab.com/T4cC0re"},"labels":["Core-Infra::P1","corrective action","team::Reliability","workflow-infra::Done"],"milestone":null,"assignees":[],"author":{"id":555989,"username":"T4cC0re","name":"Hendrik Meyer","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/555989/avatar.png","web_url":"https://gitlab.com/T4cC0re"},"type":"ISSUE","assignee":null,"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12822","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":2,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12822","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12822/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12822/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12822","relative":"#12822","full":"gitlab-com/gl-infra/reliability#12822"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":80675908,"iid":12804,"project_id":1304532,"title":"Hook onto GCP instance maintenance events","description":"During https://gitlab.com/gitlab-com/gl-infra/production/-/issues/3891 we discovered, that we can react to imminent maintenance events by [hooking into a GCP API](https://cloud.google.com/compute/docs/storing-retrieving-metadata#maintenanceevents).\n\nI wrote a little script that registers itself and listens for those events.\n\nIf everything is okay, we run all executable files in `/etc/gcp_watchdog/hooks/up`, if there is a problem/maintenance we run them in `/etc/gcp_watchdog/hooks/maint`.  \nEvery script will get the event (or `UP` for okay events) as argv1. Those can also be symlinks\n\n`/dev/shm/gcp_watchdog.state` will contain the state/last event or `UP`.\n\nIf the metadata API is unavailable, a maintenance will be assumed and `metadata_unavailable_without_state` will be passed as the event. If there is a state saved in the current execution, that will be used instead.\n\nOnly a change in state will cause hooks to run.\n\nWe should seek to deploy this everywhere. We can then add some cheap scripts to see if it triggers as expected before hooking into production services.\n\n```bash\n#!/usr/bin/env bash\n\nset -uf\n\nSTATE=/dev/shm/gcp_watchdog.state\nHOOK_DIR=/etc/gcp_watchdog/hooks\n\n# Clean the state. Others might consume this, but we want to always be in the know of what happens.\ntouch \"${STATE}\";\ntruncate -s0 \"${STATE}\"\n\nhandle_event () {\n  local event=\"$1\"\n  local subdir=\"$2\"\n\n  if does_state_match \"${event}\"; then\n    # We are already there.\n    return 0;\n  fi\n\n  echo \"Got new event: ${event}\"\n\n  # Find all executable hooks and execute 16 at a time, passing the event as argv1. OR-ing true to prevent xargs from qutting on error.\n  find \"${HOOK_DIR}/${subdir}\" -executable -print0 | xargs -0rn1 -P16 -I% -- sh -c \"% ${event} || true\";\n\n  set_state \"${event}\"\n}\n\nset_state () {\n  local event=\"$1\"\n\n  echo \"${event}\" \u003e \"${STATE}\"\n}\n\ndoes_state_match () {\n  if [ \"$(cat \"${STATE}\" 2\u003e/dev/null)\" == \"$1\" ]; then\n    return 0;\n  else\n    return 1;\n  fi\n}\n\nresponse=\"$(curl -s http://metadata.google.internal/computeMetadata/v1/instance/maintenance-event -H 'Metadata-Flavor: Google')\"\nwhile true; do\n  if [ -z \"${response}\" ]; then\n    # request failed\n    echo request failed\n    if [ -z \"$(cat \"${STATE}\" 2\u003e/dev/null)\" ]; then\n      echo \"no state registered. Assuming maintenance mode\"\n      handle_event \"metadata_unavailable_without_state\" \"maint\"\n    fi\n    # Do not wait for changes, but fetch value ASAP\n    response=\"$(curl -s http://metadata.google.internal/computeMetadata/v1/instance/maintenance-event -H 'Metadata-Flavor: Google')\"\n    sleep 1;\n    continue;\n  elif [ \"NONE\" == \"${response}\" ]; then\n    # all clear, poll again\n    handle_event \"UP\" \"up\"\n  else\n    handle_event \"${response}\" \"maint\";\n  fi\n  sleep 1;\n  # For subsequent requests: Poll\n  response=\"$(curl -s http://metadata.google.internal/computeMetadata/v1/instance/maintenance-event?wait_for_change=true -H 'Metadata-Flavor: Google')\"\ndone\n```","state":"closed","created_at":"2021-03-10T23:06:18.581Z","updated_at":"2022-12-14T09:39:10.837Z","closed_at":"2021-08-09T11:59:55.047Z","closed_by":{"id":555989,"username":"T4cC0re","name":"Hendrik Meyer","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/555989/avatar.png","web_url":"https://gitlab.com/T4cC0re"},"labels":["corrective action","team::Reliability","workflow-infra::Done"],"milestone":null,"assignees":[{"id":555989,"username":"T4cC0re","name":"Hendrik Meyer","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/555989/avatar.png","web_url":"https://gitlab.com/T4cC0re"}],"author":{"id":555989,"username":"T4cC0re","name":"Hendrik Meyer","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/555989/avatar.png","web_url":"https://gitlab.com/T4cC0re"},"type":"ISSUE","assignee":{"id":555989,"username":"T4cC0re","name":"Hendrik Meyer","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/555989/avatar.png","web_url":"https://gitlab.com/T4cC0re"},"user_notes_count":4,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12804","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12804","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12804/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12804/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12804","relative":"#12804","full":"gitlab-com/gl-infra/reliability#12804"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":80645953,"iid":12795,"project_id":1304532,"title":"Expose the container registry database-related metrics in the Grafana dashboards","description":"Related to https://gitlab.com/groups/gitlab-org/-/epics/5392.\n\nAs we approach the deployment of the new registry with a metadata database and online garbage collection to pre-production, we'll need to extend the existing Grafana dashboards for the registry with database-related metrics (application metrics, not the database cluster metrics).\n\nThe container registry, when the metadata database is enabled, emits the following sets of Prometheus metrics:\n\n- Connection pool statistics: Count of open, idle, in use, etc. connections ([`sql.Stats`](https://golang.org/pkg/database/sql/#DBStats));\n- Statements duration: The duration of every single statement executed against the database is recorded using a histogram;\n- Online GC statistics: Statistics about online GC, such as the number of processed tasks, recovered space, etc.\n\nThe ~\"group::package\" team will try to self-serve these changes but we may need some guidance.","state":"closed","created_at":"2021-03-10T14:27:41.470Z","updated_at":"2022-08-04T11:32:20.183Z","closed_at":"2021-06-02T10:39:04.515Z","closed_by":{"id":5054840,"username":"jdrpereira","name":"João Pereira","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5054840/avatar.png","web_url":"https://gitlab.com/jdrpereira"},"labels":["Observability","Service::Container Registry","devops::package","group::package registry","workflow-infra::Done","workflow::in review"],"milestone":{"id":1406672,"iid":269,"group_id":6543,"title":"13.12","description":"","state":"active","created_at":"2020-08-13T14:24:36.800Z","updated_at":"2021-03-25T18:28:54.607Z","due_date":"2021-05-17","start_date":"2021-04-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/-/milestones/269"},"assignees":[{"id":5054840,"username":"jdrpereira","name":"João Pereira","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5054840/avatar.png","web_url":"https://gitlab.com/jdrpereira"}],"author":{"id":5054840,"username":"jdrpereira","name":"João Pereira","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5054840/avatar.png","web_url":"https://gitlab.com/jdrpereira"},"type":"ISSUE","assignee":{"id":5054840,"username":"jdrpereira","name":"João Pereira","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5054840/avatar.png","web_url":"https://gitlab.com/jdrpereira"},"user_notes_count":24,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12795","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12795","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12795/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12795/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12795","relative":"#12795","full":"gitlab-com/gl-infra/reliability#12795"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":80188941,"iid":12740,"project_id":1304532,"title":"Get Chef working for Staging Subscription GCP Proof of Concept","description":"","state":"closed","created_at":"2021-03-03T16:41:23.161Z","updated_at":"2022-08-04T12:29:22.714Z","closed_at":"2021-09-20T14:03:28.993Z","closed_by":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"labels":["team::Reliability","workflow-infra::Done"],"milestone":{"id":1994752,"iid":136,"group_id":1112072,"title":"Core-Infra FY22Q2 Items","description":"This milestone is a bucket to make sure we can see things on our board:\r\n\r\n[https://gitlab.com/groups/gitlab-com/gl-infra/-/boards/1688496?\u0026label_name\\[\\]=team%3A%3ACore-Infra](https://gitlab.com/groups/gitlab-com/gl-infra/-/boards/1688496?\u0026label_name%5B%5D=team%3A%3ACore-Infra)","state":"closed","created_at":"2021-04-13T15:13:04.655Z","updated_at":"2021-11-12T05:29:30.642Z","due_date":"2021-07-31","start_date":"2021-05-01","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/136"},"assignees":[{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},{"id":273486,"username":"jameslopez","name":"James Lopez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/273486/avatar.png","web_url":"https://gitlab.com/jameslopez"}],"author":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"type":"ISSUE","assignee":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"user_notes_count":12,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12740","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":true,"task_status":"","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12740","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12740/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12740/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12740","relative":"#12740","full":"gitlab-com/gl-infra/reliability#12740"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":390,"epic":{"id":175744,"iid":390,"title":"Improve observability and logging of CustomersDot","url":"/groups/gitlab-com/gl-infra/-/epics/390","group_id":1112072,"human_readable_end_date":"Feb 20, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":80044697,"iid":12720,"project_id":1304532,"title":"Rebuilt org-ci to increase IP address space","description":"In the effort to roll out https://gitlab.com/gitlab-com/gl-infra/production/-/issues/3648, we discovered there isn't enough IP space for doing an upgrade. We need to change the CIDR and thus rebuild the cluster.\n\nThe suggestion is to update `gitlab-gke-pod-cidr` to be `10.3.0.0/16`.\n\nI estimate this won't take much time as there is tolerance for downtime with no customer impact as well as it being a pretty simple change. We will also need to be sure that the helm configs are pushed up to the new cluster.\n\nWe also need to update the [runbook](https://ops.gitlab.net/gitlab-com/runbooks/-/tree/master/docs/ci-runners#gitlab-org-ci-project) with new ranges.","state":"closed","created_at":"2021-03-02T00:05:44.503Z","updated_at":"2021-06-24T08:06:30.088Z","closed_at":"2021-04-21T18:52:41.401Z","closed_by":{"id":429540,"username":"ahanselka","name":"Alex Hanselka","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/429540/avatar.png","web_url":"https://gitlab.com/ahanselka"},"labels":["workflow-infra::Done"],"milestone":{"id":1994749,"iid":135,"group_id":1112072,"title":"Core-Infra FY22Q1 Items","description":"This milestone is a bucket to make sure we can see things on our board:\r\n\r\nhttps://gitlab.com/groups/gitlab-com/gl-infra/-/boards/1688496?\u0026label_name[]=team%3A%3ACore-Infra","state":"closed","created_at":"2021-04-13T15:12:22.906Z","updated_at":"2021-05-12T18:53:03.055Z","due_date":"2021-04-30","start_date":"2021-02-01","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/135"},"assignees":[{"id":429540,"username":"ahanselka","name":"Alex Hanselka","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/429540/avatar.png","web_url":"https://gitlab.com/ahanselka"},{"id":8509599,"username":"mchacon3","name":"Marcel Chacon","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/8509599/avatar.png","web_url":"https://gitlab.com/mchacon3"}],"author":{"id":429540,"username":"ahanselka","name":"Alex Hanselka","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/429540/avatar.png","web_url":"https://gitlab.com/ahanselka"},"type":"ISSUE","assignee":{"id":429540,"username":"ahanselka","name":"Alex Hanselka","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/429540/avatar.png","web_url":"https://gitlab.com/ahanselka"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12720","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12720","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12720/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12720/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12720","relative":"#12720","full":"gitlab-com/gl-infra/reliability#12720"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":80016011,"iid":12717,"project_id":1304532,"title":"Verifying gitlab domain for One trust","description":"\u003c!--\nThis template is for GitLab Team Members seeking support of SRE where there isn't an existing `request-*` template available.\n\nPlease fill out the details below.\n--\u003e\n\n**Details** \n - Point of contact for this request: @Karuna16 \n - If a call is needed, what is the proposed date and time of the call:  [+ Date and Time +]\n - Additional call details (format, type of call): [+ additional details +]\n\n**SRE Support Needed**\n[+ Support Request Details +]\n\nNew txt record on `gitlab.com`\nVerifying domain name for gitlab.com for One Trust SSO setup. Here's the [link](https://my.onetrust.com/s/article/UUID-3ec2fcd6-37f9-a0e3-20a1-acb6c64f99c3#UUID-3ec2fcd6-37f9-a0e3-20a1-acb6c64f99c3_bridgehead-idm458761989491843162723680452) on how to verify domain. Attaching the screenshot in case link doesn't work.![Screenshot_2021-03-01_at_9.04.10_PM](/uploads/3b7cf7fa46101c34e13c48ac61cdbf43/Screenshot_2021-03-01_at_9.04.10_PM.png)\n\nThe TXT token from One trust: onetrust-domain-verification=af5b5fda116e45a9b4c4abcd9e571923\nAlias can @ or blank.\n\n\u003c!--\nplease do not edit the below\n--\u003e![Screenshot_2021-03-01_at_9.38.48_PM](/uploads/18a6e3bdc131df47aa2c7c386675dad7/Screenshot_2021-03-01_at_9.38.48_PM.png)","state":"closed","created_at":"2021-03-01T15:35:27.755Z","updated_at":"2021-03-15T10:56:14.088Z","closed_at":"2021-03-15T10:56:12.586Z","closed_by":{"id":7818558,"username":"Karuna16","name":"Karuna Singh","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/7818558/avatar.png","web_url":"https://gitlab.com/Karuna16"},"labels":["AssistType::Domain-DNS-SSL-Management","AssistingTeam::IT","workflow-infra::Done"],"milestone":{"id":1852668,"iid":131,"group_id":1112072,"title":"Core-Infra Feb 28 - Mar 13","description":"","state":"closed","created_at":"2021-01-27T20:22:18.924Z","updated_at":"2021-04-13T15:15:40.701Z","due_date":"2021-03-13","start_date":"2021-02-28","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/131"},"assignees":[{"id":2222520,"username":"dawsmith","name":"Dave Smith","state":"active","avatar_url":"https://secure.gravatar.com/avatar/ef341e061f6b86461626e64c5fbcfe52?s=80\u0026d=identicon","web_url":"https://gitlab.com/dawsmith"},{"id":4437855,"username":"brentnewton","name":"Brent Newton","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4437855/avatar.png","web_url":"https://gitlab.com/brentnewton"},{"id":5709244,"username":"albertoramos","name":"Alberto Ramos","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5709244/avatar.png","web_url":"https://gitlab.com/albertoramos"}],"author":{"id":7818558,"username":"Karuna16","name":"Karuna Singh","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/7818558/avatar.png","web_url":"https://gitlab.com/Karuna16"},"type":"ISSUE","assignee":{"id":2222520,"username":"dawsmith","name":"Dave Smith","state":"active","avatar_url":"https://secure.gravatar.com/avatar/ef341e061f6b86461626e64c5fbcfe52?s=80\u0026d=identicon","web_url":"https://gitlab.com/dawsmith"},"user_notes_count":13,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12717","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12717","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12717/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12717/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12717","relative":"#12717","full":"gitlab-com/gl-infra/reliability#12717"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":79744643,"iid":12688,"project_id":1304532,"title":"Transfer meltano.{com,io,net,org} domains to Meltano's AWS account","description":"As a separate business unit in the company, the Meltano team mostly manages its own assets (for example its website, accounts for Google Workspace, Slack, Zendesk, and SendGrid, and domain names meltanodata.com and singerhub.io), that are billed to a Meltano-specific corporate credit card and budgeted to the \"R\u0026D - Meltano\" department.\n\nThe one exception are the `meltano.{com,io,net,org}` domains that are registered under GitLab's AWS account.\nTo give the Meltano team full control over the assets it's responsible for and make sure expenses are taken out of the correct budgets,\nI think it would be appropriate for these domains to be [transferred](https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/domain-transfer-from-route-53.html) to Meltano's AWS account with ID 292927715491.\n\nSince this was requested and rejected two years ago in https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/6316, the Meltano team has become more independent and now manages more of its own infra assets, with the ownership of these domains a remnant of its early days as \"just\" a team in GitLab.","state":"closed","created_at":"2021-02-24T20:56:33.255Z","updated_at":"2021-07-12T22:41:37.346Z","closed_at":"2021-07-12T21:51:13.326Z","closed_by":{"id":429540,"username":"ahanselka","name":"Alex Hanselka","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/429540/avatar.png","web_url":"https://gitlab.com/ahanselka"},"labels":["AssistType::Domain-DNS-SSL-Management","AssistingTeam::Development","team::Reliability","workflow-infra::Done"],"milestone":{"id":1994752,"iid":136,"group_id":1112072,"title":"Core-Infra FY22Q2 Items","description":"This milestone is a bucket to make sure we can see things on our board:\r\n\r\n[https://gitlab.com/groups/gitlab-com/gl-infra/-/boards/1688496?\u0026label_name\\[\\]=team%3A%3ACore-Infra](https://gitlab.com/groups/gitlab-com/gl-infra/-/boards/1688496?\u0026label_name%5B%5D=team%3A%3ACore-Infra)","state":"closed","created_at":"2021-04-13T15:13:04.655Z","updated_at":"2021-11-12T05:29:30.642Z","due_date":"2021-07-31","start_date":"2021-05-01","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/136"},"assignees":[{"id":429540,"username":"ahanselka","name":"Alex Hanselka","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/429540/avatar.png","web_url":"https://gitlab.com/ahanselka"}],"author":{"id":87854,"username":"DouweM","name":"Douwe Maan","state":"active","avatar_url":"https://secure.gravatar.com/avatar/73d1548ae618321220679b3a4fda7fb1?s=80\u0026d=identicon","web_url":"https://gitlab.com/DouweM"},"type":"ISSUE","assignee":{"id":429540,"username":"ahanselka","name":"Alex Hanselka","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/429540/avatar.png","web_url":"https://gitlab.com/ahanselka"},"user_notes_count":43,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12688","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12688","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12688/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12688/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12688","relative":"#12688","full":"gitlab-com/gl-infra/reliability#12688"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":79703641,"iid":12679,"project_id":1304532,"title":"Add deployment version info to K8s dropdown menu for each service in Grafana","description":"Use case: We want to get information about the deployed version of a service in Grafana.\n\nRight now there is a `pod-info` dashboard for each service where you can see the deployment versions e.g. [this](https://dashboards.gitlab.net/d/sidekiq-pod/sidekiq-pod-info?orgId=1) for sidekiq. But it would be easier to find, if we\n\n1. would add this to the \"Kubernetes Detail\" dropdown menu for each service overview dashboard or\n2. add the deployment version information directly to the \"Kube Deployment Detail\" dashboard, which already is linked in the \"Kubernetes Detail\" dropdown menu\n\nI would prefer option 2.","state":"closed","created_at":"2021-02-24T11:13:26.320Z","updated_at":"2022-09-01T01:22:40.960Z","closed_at":"2022-09-01T01:22:38.803Z","closed_by":{"id":10167447,"username":"afappiano","name":"Anthony Fappiano","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/10167447/avatar.png","web_url":"https://gitlab.com/afappiano"},"labels":["Reliability::P4","team::Reliability"],"milestone":null,"assignees":[],"author":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"type":"ISSUE","assignee":null,"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12679","time_stats":{"time_estimate":14400,"total_time_spent":0,"human_time_estimate":"4h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12679","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12679/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12679/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12679","relative":"#12679","full":"gitlab-com/gl-infra/reliability#12679"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":79643924,"iid":12671,"project_id":1304532,"title":"Review and update License/Version/Customers Runbook Documentation","description":"Per this incident: https://gitlab.com/gitlab-com/gl-infra/production/-/issues/3398\n\nAs an SRE on-call, I should be able to open the Runbooks and find basic information on how to find and change the Customers, License, and Version services.","state":"closed","created_at":"2021-02-23T15:14:44.119Z","updated_at":"2021-03-01T22:56:59.315Z","closed_at":"2021-02-24T13:37:31.975Z","closed_by":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"labels":["corrective action","workflow-infra::Done"],"milestone":{"id":1815578,"iid":129,"group_id":1112072,"title":"Core-Infra Feb 14 - Feb 27","description":"","state":"closed","created_at":"2021-01-09T00:24:06.412Z","updated_at":"2021-04-13T15:08:12.276Z","due_date":"2021-02-27","start_date":"2021-02-14","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/129"},"assignees":[{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"}],"author":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"type":"ISSUE","assignee":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"user_notes_count":0,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12671","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12671","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12671/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12671/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12671","relative":"#12671","full":"gitlab-com/gl-infra/reliability#12671"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":79643555,"iid":12670,"project_id":1304532,"title":"Review and update the Services-Base README","description":"Per this incident: https://gitlab.com/gitlab-com/gl-infra/production/-/issues/3398\n\nThe [README.md](https://ops.gitlab.net/gitlab-com/services-base/-/blob/master/README.md) for the Services-Base project should be reviewed and updated to better reflect the intended workflow of making a change, promoting the change through the Staging and Production environments, and cleaning up any remaining environments.","state":"closed","created_at":"2021-02-23T15:09:15.086Z","updated_at":"2021-04-20T13:21:05.648Z","closed_at":"2021-04-20T13:21:05.539Z","closed_by":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"labels":["corrective action","workflow-infra::Done"],"milestone":null,"assignees":[{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"}],"author":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"type":"ISSUE","assignee":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"user_notes_count":0,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12670","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12670","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12670/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12670/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12670","relative":"#12670","full":"gitlab-com/gl-infra/reliability#12670"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":79434974,"iid":12649,"project_id":1304532,"title":"TLS renewal or certificate for airflow.gitlabdata.com","description":"This was originally set up with https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/9205 and was implemented as described in [our handbook](https://about.gitlab.com/handbook/business-ops/data-team/platform/infrastructure/#tls)\n\nLooks like we either need access to Route 53 to do this or the renewed certificate. \n\nThe data team work is tracked in https://gitlab.com/gitlab-data/analytics/-/issues/7994","state":"closed","created_at":"2021-02-19T19:21:00.593Z","updated_at":"2021-02-22T23:41:09.668Z","closed_at":"2021-02-22T19:25:31.392Z","closed_by":{"id":4554632,"username":"jjstark","name":"Justin Stark","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4554632/avatar.png","web_url":"https://gitlab.com/jjstark"},"labels":["AssistType::Domain-DNS-SSL-Management","AssistingTeam::Data","Unplanned","unblocks others","workflow-infra::Done"],"milestone":{"id":1815578,"iid":129,"group_id":1112072,"title":"Core-Infra Feb 14 - Feb 27","description":"","state":"closed","created_at":"2021-01-09T00:24:06.412Z","updated_at":"2021-04-13T15:08:12.276Z","due_date":"2021-02-27","start_date":"2021-02-14","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/129"},"assignees":[{"id":693144,"username":"craig","name":"Craig Barrett","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c8dfa1ca41754b9409068e5e42080cd2?s=80\u0026d=identicon","web_url":"https://gitlab.com/craig"},{"id":2222520,"username":"dawsmith","name":"Dave Smith","state":"active","avatar_url":"https://secure.gravatar.com/avatar/ef341e061f6b86461626e64c5fbcfe52?s=80\u0026d=identicon","web_url":"https://gitlab.com/dawsmith"}],"author":{"id":4554632,"username":"jjstark","name":"Justin Stark","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4554632/avatar.png","web_url":"https://gitlab.com/jjstark"},"type":"ISSUE","assignee":{"id":693144,"username":"craig","name":"Craig Barrett","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c8dfa1ca41754b9409068e5e42080cd2?s=80\u0026d=identicon","web_url":"https://gitlab.com/craig"},"user_notes_count":6,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2021-02-22","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12649","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12649","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12649/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12649/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12649","relative":"#12649","full":"gitlab-com/gl-infra/reliability#12649"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":78997103,"iid":12607,"project_id":1304532,"title":"Grow production API fleet by 6 nodes (or more)","description":"[![Screen_Shot_2021-02-12_at_2.52.48_PM](/uploads/97561837174e5c2969e4a676824ce8ec/Screen_Shot_2021-02-12_at_2.52.48_PM.png)](https://dashboards.gitlab.net/d/api-main/api-overview?viewPanel=66\u0026orgId=1\u0026from=1612986771345\u0026to=1613159571346\u0026var-PROMETHEUS_DS=Global\u0026var-environment=gprd\u0026var-stage=main\u0026var-sigma=2)\n\n[![Screen_Shot_2021-02-12_at_2.56.10_PM](/uploads/62cd2c700ef8577f275fd664a6b67421/Screen_Shot_2021-02-12_at_2.56.10_PM.png)](https://dashboards.gitlab.net/d/api-main/api-overview?viewPanel=1217942947\u0026orgId=1\u0026from=1612986960558\u0026to=1613159760558\u0026var-PROMETHEUS_DS=Global\u0026var-environment=gprd\u0026var-stage=main\u0026var-sigma=2)\n\nThe API VM fleet is starting to show loads that place the VMs load/core value over 1 during peak use times. This coupled with a deploy can lead to poor apdex. Until API is moved into Kubernetes, we should increase the fleet size to minimize customer facing performance issues.\n\nThe outcome of this work should be that deploys during peak times should not spike single node puma worker component to 100%.","state":"closed","created_at":"2021-02-12T20:01:00.964Z","updated_at":"2022-08-04T12:30:59.286Z","closed_at":"2021-03-09T00:34:07.315Z","closed_by":{"id":3623028,"username":"cmiskell","name":"Craig Miskell","state":"active","avatar_url":"https://secure.gravatar.com/avatar/852a93b505b1f4a5549595792035f445?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmiskell"},"labels":["Service::API","corrective action","workflow-infra::Done"],"milestone":null,"assignees":[],"author":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"type":"ISSUE","assignee":null,"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12607","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12607","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12607/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12607/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12607","relative":"#12607","full":"gitlab-com/gl-infra/reliability#12607"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":78727798,"iid":12573,"project_id":1304532,"title":"Update packagecloud to latest version","description":"\u003c!--\nThis template is for GitLab Team Members seeking support of SRE where there isn't an existing `request-*` template available.\n\nPlease fill out the details below.\n--\u003e\n\n**Details** \n - Point of contact for this request: @twk3 @joshlambert @mendeni \n - If a call is needed, what is the proposed date and time of the call: (likely not needed)\n - Additional call details (format, type of call):\n\n**SRE Support Needed**\n\nWe would like to have packages.gitlab.com upgraded to the latest version of packagecloud 3.0.3 as it brings support for additional package versions the Distribution team would like to provide to customers.\n\nWe would like for the upgrade to be available for us to use with the GitLab 13.10 release.\n\nOmnibus issue: https://gitlab.com/gitlab-org/omnibus-gitlab/-/issues/5979\n\ncc\\ @ahanselka @dawsmith \n\n\n\n\n\u003c!--\nplease do not edit the below\n--\u003e","state":"closed","created_at":"2021-02-09T15:16:15.273Z","updated_at":"2022-08-04T12:31:23.332Z","closed_at":"2021-03-31T19:52:18.751Z","closed_by":{"id":3913673,"username":"mendeni","name":"Steven Wilson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3913673/avatar.png","web_url":"https://gitlab.com/mendeni"},"labels":["AssistType::CloudInfra","AssistingTeam::Development","Unplanned","team::Reliability","workflow-infra::Done"],"milestone":{"id":1852669,"iid":132,"group_id":1112072,"title":"Core-Infra Mar 14 - Mar 27","description":"","state":"closed","created_at":"2021-01-27T20:25:20.396Z","updated_at":"2021-04-13T15:17:38.707Z","due_date":"2021-03-27","start_date":"2021-03-14","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/132"},"assignees":[{"id":429540,"username":"ahanselka","name":"Alex Hanselka","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/429540/avatar.png","web_url":"https://gitlab.com/ahanselka"}],"author":{"id":42196,"username":"twk3","name":"DJ Mountney","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0585c59e37fc2dbc124fc4c9f575234d?s=80\u0026d=identicon","web_url":"https://gitlab.com/twk3"},"type":"ISSUE","assignee":{"id":429540,"username":"ahanselka","name":"Alex Hanselka","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/429540/avatar.png","web_url":"https://gitlab.com/ahanselka"},"user_notes_count":12,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2021-03-17","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12573","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12573","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12573/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12573/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12573","relative":"#12573","full":"gitlab-com/gl-infra/reliability#12573"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":78681464,"iid":12566,"project_id":1304532,"title":"Deploy Ephemeral Sessions on Read Only console servers","description":"Using the Virtual Machines provisioned in https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/12562\n\nCreate and push out the chef configuration that will ephemeral systemd sessions in the staging and production environments.","state":"closed","created_at":"2021-02-09T01:09:26.346Z","updated_at":"2021-03-16T20:37:26.491Z","closed_at":"2021-03-16T20:37:26.424Z","closed_by":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"labels":["Core-Infra::P2","chef","workflow-infra::Done"],"milestone":{"id":1852668,"iid":131,"group_id":1112072,"title":"Core-Infra Feb 28 - Mar 13","description":"","state":"closed","created_at":"2021-01-27T20:22:18.924Z","updated_at":"2021-04-13T15:15:40.701Z","due_date":"2021-03-13","start_date":"2021-02-28","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/131"},"assignees":[{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"}],"author":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"type":"ISSUE","assignee":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12566","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":8,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12566","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12566/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12566/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12566","relative":"#12566","full":"gitlab-com/gl-infra/reliability#12566"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":350,"epic":{"id":133459,"iid":350,"title":"Project: Rails Console Access","url":"/groups/gitlab-com/gl-infra/-/epics/350","group_id":1112072,"human_readable_end_date":"Jul 31, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":78681460,"iid":12565,"project_id":1304532,"title":"Deploy Teleport on Read Only console servers","description":"Using the Virtual Machines provisioned in https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/12562\n\nCreate and push out the chef configuration that will install Teleport in the staging and production environments.","state":"closed","created_at":"2021-02-09T01:09:09.912Z","updated_at":"2021-03-16T20:37:29.470Z","closed_at":"2021-03-16T20:21:53.237Z","closed_by":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"labels":["Core-Infra::P2","chef","workflow-infra::Done"],"milestone":{"id":1852668,"iid":131,"group_id":1112072,"title":"Core-Infra Feb 28 - Mar 13","description":"","state":"closed","created_at":"2021-01-27T20:22:18.924Z","updated_at":"2021-04-13T15:15:40.701Z","due_date":"2021-03-13","start_date":"2021-02-28","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/131"},"assignees":[{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"}],"author":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"type":"ISSUE","assignee":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12565","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":8,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12565","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12565/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12565/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12565","relative":"#12565","full":"gitlab-com/gl-infra/reliability#12565"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":350,"epic":{"id":133459,"iid":350,"title":"Project: Rails Console Access","url":"/groups/gitlab-com/gl-infra/-/epics/350","group_id":1112072,"human_readable_end_date":"Jul 31, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":78668132,"iid":12562,"project_id":1304532,"title":"Provision read only console servers","description":"Write Terraform to provision read only console servers including Teleport and ephemeral sessions from PoC\n\nOnce this is complete we can:\n\n- Deploy Teleport on Read Only console servers: https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/12565\n- Deploy Ephemeral Sessions on Read Only console servers: https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/12566","state":"closed","created_at":"2021-02-08T20:22:20.305Z","updated_at":"2021-06-24T08:06:32.536Z","closed_at":"2021-03-02T20:19:31.297Z","closed_by":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"labels":["Core-Infra::P2","Unplanned","chef","terraform","workflow-infra::Done"],"milestone":{"id":1815578,"iid":129,"group_id":1112072,"title":"Core-Infra Feb 14 - Feb 27","description":"","state":"closed","created_at":"2021-01-09T00:24:06.412Z","updated_at":"2021-04-13T15:08:12.276Z","due_date":"2021-02-27","start_date":"2021-02-14","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/129"},"assignees":[{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"}],"author":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"type":"ISSUE","assignee":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12562","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":8,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12562","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12562/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12562/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12562","relative":"#12562","full":"gitlab-com/gl-infra/reliability#12562"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":350,"epic":{"id":133459,"iid":350,"title":"Project: Rails Console Access","url":"/groups/gitlab-com/gl-infra/-/epics/350","group_id":1112072,"human_readable_end_date":"Jul 31, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":78447341,"iid":12542,"project_id":1304532,"title":"Unable to expand Cloud NAT IP routing any further","description":"In recent incident: https://gitlab.com/gitlab-com/gl-infra/production/-/issues/3448\n\nWe needed to add additional IP addresses to our Cloud NAT device.  Luckily we were able to easily add two ip addresses that were next in line with our IP reservations.  Should we need to expand any further, our terraform module may not support this.\n\nUtilize this issue to accomplish the following:\n\n1. [x] Learn how IP allocation works with respect to Cloud NAT devices - during the incident, we appeared to use IP addresses that are not technically allowed to be used in the CIDR range\n1. [ ] Determine how we can expand the set of IP's to the Cloud NAT device - currently we apply a CIDR range and a count of IP addresses - the current allocated CIDR has no free IP addresses\n1. [ ] Documentation updated to reflect how these are configured and how to expand in the future\n1. [ ] Consider expanding our current Cloud NAT IP Allocation\n\nMarking this as high priority because the next time we run out of ports, we currently do not have an identified mitigation strategy.","state":"closed","created_at":"2021-02-04T17:31:50.624Z","updated_at":"2022-08-04T12:31:44.016Z","closed_at":"2021-10-22T20:11:53.964Z","closed_by":{"id":8814797,"username":"amoter","name":"Anna Liisa Moter","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/8814797/avatar.png","web_url":"https://gitlab.com/amoter"},"labels":["AssistType::CloudInfra","AssistingTeam::Infrastructure","Core-Infra::P1","corrective action","priority::1","team::Reliability","terraform","workflow-infra::Done"],"milestone":null,"assignees":[],"author":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"type":"ISSUE","assignee":null,"user_notes_count":17,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12542","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":4,"completed_count":1},"weight":13,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12542","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12542/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12542/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12542","relative":"#12542","full":"gitlab-com/gl-infra/reliability#12542"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":610,"epic":{"id":372977,"iid":610,"title":"Cloud NAT IP routing","url":"/groups/gitlab-com/gl-infra/-/epics/610","group_id":1112072},"iteration":null,"health_status":null},{"id":78440319,"iid":12539,"project_id":1304532,"title":"Fluentd pod restarts should not cause many old, already indexed log lines to be sent to elasticsearch","description":"\u003c!--\nI see you're filing an issue for the observability SRE team. Please write a clear description of the problem in the issue description, and acceptance criteria. Give the issue a terse but descriptive title.\n\nDon't forget to:\n\n- Put the issue in an epic, if one fits\n- assign a weight based on perceived complexity and how much of the problem space is unknown: 1, 2 or 4\n\nSee https://about.gitlab.com/handbook/engineering/infrastructure/team/reliability/observability/ for a description of our workflow.\n\nRemember to keep your epics in order of priority / necessity, to indicate to the team lead and engineering manager that you would like it to be inserted into the backlog.\n--\u003e\n\n## Problem\n\nIt's been observed (e.g. https://gitlab.com/gitlab-com/gl-infra/production/-/issues/3435#note_498652734) that restarting fluentd (by reprovisioning the daemonset pod) causes log files to be read in full from the beginning, entering many old and duplicated lines into elasticsearch. This skews logs-based aggregations, and puts strain on the elasticsearch nodes.\n\n## Desired outcome\n\nFluentd makes a best-effort attempt to pick up where it left off. The pos_file feature of the tail input plugin (https://docs.fluentd.org/input/tail#read_from_head), which we do configure, is meant to allow fluentd to resume from its previous position. The pos files are kept on `/var/log`, which in the daemonset pod is the same mountpoint is in the host's mount namespace and so files written there persist across pod restarts. \n\n## Acceptance criteria\n\n- [ ] As few as possible duplicate lines are entered into elastic in most fluentd pod restart scenarios","state":"closed","created_at":"2021-02-04T15:43:03.444Z","updated_at":"2021-02-10T14:55:58.571Z","closed_at":"2021-02-10T14:55:58.490Z","closed_by":{"id":3911656,"username":"craigf","name":"Craig Furman","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3911656/avatar.png","web_url":"https://gitlab.com/craigf"},"labels":["corrective action","workflow-infra::Done"],"milestone":{"id":1810563,"iid":125,"group_id":1112072,"title":"Observability Backlog","description":"The Observability SRE Team uses this milestone to scope work to our Kanban [board](https://gitlab.com/groups/gitlab-com/gl-infra/-/boards/1677278).\r\n\r\nFor our triage issues, please see this [issue search](https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/?scope=all\u0026utf8=%E2%9C%93\u0026state=opened\u0026label_name[]=team%3A%3AObservability\u0026label_name[]=workflow-infra%3A%3ATriage).","state":"closed","created_at":"2021-01-06T16:26:59.737Z","updated_at":"2022-01-04T10:18:35.366Z","due_date":null,"start_date":null,"expired":false,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/125"},"assignees":[{"id":3911656,"username":"craigf","name":"Craig Furman","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3911656/avatar.png","web_url":"https://gitlab.com/craigf"}],"author":{"id":3911656,"username":"craigf","name":"Craig Furman","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3911656/avatar.png","web_url":"https://gitlab.com/craigf"},"type":"ISSUE","assignee":{"id":3911656,"username":"craigf","name":"Craig Furman","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3911656/avatar.png","web_url":"https://gitlab.com/craigf"},"user_notes_count":14,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12539","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":1,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12539","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12539/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12539/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12539","relative":"#12539","full":"gitlab-com/gl-infra/reliability#12539"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":78415198,"iid":12531,"project_id":1304532,"title":"ILB for thanos-query-frontend, to bypass IAP for grafana","description":"\u003c!--\nI see you're filing an issue for the observability SRE team. Please write a clear description of the problem in the issue description, and acceptance criteria. Give the issue a terse but descriptive title.\n\nDon't forget to:\n\n- Put the issue in an epic, if one fits\n- assign a weight based on perceived complexity and how much of the problem space is unknown: 1, 2 or 4\n\nSee https://about.gitlab.com/handbook/engineering/infrastructure/team/reliability/observability/ for a description of our workflow.\n\nRemember to keep your epics in order of priority / necessity, to indicate to the team lead and engineering manager that you would like it to be inserted into the backlog.\n--\u003e\n\n## Problem\n\nWe need to access thanos-query-frontend in kubernetes internally, inside and outside GKE (because we have not migrated grafana to k8s yet).\n\n## Desired outcome\n\nA DNS entry that resolves to a private IP, that allows unauthenticated access to thanos QFE from inside the VPC.\n\n## Acceptance criteria\n\n- [x] A DNS entry that resolves to a private IP, that allows unauthenticated access to thanos QFE from inside the VPC\n\n---\n\nFYI @bjk-gitlab","state":"closed","created_at":"2021-02-04T09:51:56.597Z","updated_at":"2021-02-04T10:44:07.963Z","closed_at":"2021-02-04T10:43:13.149Z","closed_by":{"id":3911656,"username":"craigf","name":"Craig Furman","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3911656/avatar.png","web_url":"https://gitlab.com/craigf"},"labels":["workflow-infra::Done"],"milestone":{"id":1810563,"iid":125,"group_id":1112072,"title":"Observability Backlog","description":"The Observability SRE Team uses this milestone to scope work to our Kanban [board](https://gitlab.com/groups/gitlab-com/gl-infra/-/boards/1677278).\r\n\r\nFor our triage issues, please see this [issue search](https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/?scope=all\u0026utf8=%E2%9C%93\u0026state=opened\u0026label_name[]=team%3A%3AObservability\u0026label_name[]=workflow-infra%3A%3ATriage).","state":"closed","created_at":"2021-01-06T16:26:59.737Z","updated_at":"2022-01-04T10:18:35.366Z","due_date":null,"start_date":null,"expired":false,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/125"},"assignees":[{"id":3911656,"username":"craigf","name":"Craig Furman","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3911656/avatar.png","web_url":"https://gitlab.com/craigf"}],"author":{"id":3911656,"username":"craigf","name":"Craig Furman","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3911656/avatar.png","web_url":"https://gitlab.com/craigf"},"type":"ISSUE","assignee":{"id":3911656,"username":"craigf","name":"Craig Furman","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3911656/avatar.png","web_url":"https://gitlab.com/craigf"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12531","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":1,"completed_count":1},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12531","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12531/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12531/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12531","relative":"#12531","full":"gitlab-com/gl-infra/reliability#12531"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":283,"epic":{"id":87640,"iid":283,"title":"Migrate Thanos to Kubernetes","url":"/groups/gitlab-com/gl-infra/-/epics/283","group_id":1112072,"human_readable_end_date":"Dec 30, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":78093399,"iid":12493,"project_id":1304532,"title":"CI Cleaner script seems to have stopped working","description":"For some reason, the CI cleaner script has stopped working but doesn't error out. I'm not quite sure why as there is no error. Nonetheless, this should be fixed.\n\nMy initial suspicion is that something changed about our naming scheme or the GCP API, but I have done minimal investigation thus far.\n\n[link to pipelines](https://ops.gitlab.net/gitlab-com/gl-infra/ci-project-cleaner/-/pipelines)","state":"closed","created_at":"2021-01-29T19:48:26.156Z","updated_at":"2022-08-04T12:32:20.158Z","closed_at":"2021-02-10T16:38:41.541Z","closed_by":{"id":429540,"username":"ahanselka","name":"Alex Hanselka","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/429540/avatar.png","web_url":"https://gitlab.com/ahanselka"},"labels":["AssistType::CloudInfra","AssistingTeam::Infrastructure","Core-Infra::P2","Service::CI Runners","Unplanned","corrective action","workflow-infra::Done"],"milestone":{"id":1852668,"iid":131,"group_id":1112072,"title":"Core-Infra Feb 28 - Mar 13","description":"","state":"closed","created_at":"2021-01-27T20:22:18.924Z","updated_at":"2021-04-13T15:15:40.701Z","due_date":"2021-03-13","start_date":"2021-02-28","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/131"},"assignees":[{"id":429540,"username":"ahanselka","name":"Alex Hanselka","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/429540/avatar.png","web_url":"https://gitlab.com/ahanselka"},{"id":3623028,"username":"cmiskell","name":"Craig Miskell","state":"active","avatar_url":"https://secure.gravatar.com/avatar/852a93b505b1f4a5549595792035f445?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmiskell"}],"author":{"id":429540,"username":"ahanselka","name":"Alex Hanselka","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/429540/avatar.png","web_url":"https://gitlab.com/ahanselka"},"type":"ISSUE","assignee":{"id":429540,"username":"ahanselka","name":"Alex Hanselka","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/429540/avatar.png","web_url":"https://gitlab.com/ahanselka"},"user_notes_count":8,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12493","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":8,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12493","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12493/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12493/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12493","relative":"#12493","full":"gitlab-com/gl-infra/reliability#12493"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":78091731,"iid":12492,"project_id":1304532,"title":"Delete extra server entry from Okta ASA","description":"During the course of fixing https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/12441, an additional server entry for Okta ASA was created. This is unnecessary and should be deleted, but I don't have access to. The only person I know of that has access to delete is @cmiskell, but there may be others.\n\n[this is the server that needs deleting](https://app.scaleft.com/t/gitlab-poc/project/windows_ci/servers/28409349-186f-4079-a036-9faf2da9a92a)","state":"closed","created_at":"2021-01-29T19:02:02.366Z","updated_at":"2021-01-29T22:50:38.109Z","closed_at":"2021-01-29T22:50:38.039Z","closed_by":{"id":429540,"username":"ahanselka","name":"Alex Hanselka","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/429540/avatar.png","web_url":"https://gitlab.com/ahanselka"},"labels":["workflow-infra::Done"],"milestone":null,"assignees":[{"id":429540,"username":"ahanselka","name":"Alex Hanselka","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/429540/avatar.png","web_url":"https://gitlab.com/ahanselka"}],"author":{"id":429540,"username":"ahanselka","name":"Alex Hanselka","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/429540/avatar.png","web_url":"https://gitlab.com/ahanselka"},"type":"ISSUE","assignee":{"id":429540,"username":"ahanselka","name":"Alex Hanselka","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/429540/avatar.png","web_url":"https://gitlab.com/ahanselka"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12492","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12492","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12492/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12492/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12492","relative":"#12492","full":"gitlab-com/gl-infra/reliability#12492"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":78079775,"iid":12490,"project_id":1304532,"title":"Revise Chef server LEGO cron for certificate renewal","description":"The Chef server is not reloading nginx after a new certificate is installed. The LEGO command needs the following added: `--renew-hook='/usr/bin/chef-server-ctl hup nginx` to make sure this happens on a renewal.\n\nWe should also re-evaluate the LEGO schedule so that it will run once a day.","state":"closed","created_at":"2021-01-29T15:37:28.442Z","updated_at":"2021-02-02T16:21:55.112Z","closed_at":"2021-02-02T16:21:55.067Z","closed_by":{"id":928230,"username":"bjk-gitlab","name":"Ben Kochie","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/928230/avatar.png","web_url":"https://gitlab.com/bjk-gitlab"},"labels":["Service::Infrastructure","chef","corrective action","severity::4","workflow-infra::Done"],"milestone":{"id":1808963,"iid":124,"group_id":1112072,"title":"Core-Infra Jan 31 - Feb 13","description":"","state":"closed","created_at":"2021-01-05T23:32:25.348Z","updated_at":"2021-03-04T21:07:05.795Z","due_date":"2021-02-13","start_date":"2021-01-31","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/124"},"assignees":[{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"}],"author":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"type":"ISSUE","assignee":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2021-02-05","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12490","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12490","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12490/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12490/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12490","relative":"#12490","full":"gitlab-com/gl-infra/reliability#12490"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":78011323,"iid":12478,"project_id":1304532,"title":"Support pg_ctl_timeout attribute in the patroni service configuration","description":"Support `pg_ctl_timeout` attribute in the patroni service configuration.\n\n## Why\n\nThe present situation in the production patroni hosts is as follows:\n\nThe command `sudo systemctl stop patroni` when invoked in production does not wait long enough for the postgresql PostgreSQL database server to terminate, and sends it a `sigkill` signal, which forces the process to halt in an untidy way.\n\nThis would also happen if a patroni host was instructed to shutdown or reboot -- the `systemd` service manager would attempt to stop all its unit daemons, including the `patroni` service.\n\n## Expectations\n\nThis is an experiment with no bad consequences.  The experiment is to put in place a configuration attribute which allows us to adjust the amount of time which patroni waits for the PostgreSQL database server to cleanly shutdown before patroni gives up and sends postgresql a `sigkill`.\n\nIt is NOT KNOWN how long the PostgreSQL database server is required to shut down cleanly in production.  We have not yet conducted any tests to determine what this interval actually is.\n\n## Possible outcomes\n\nThe worst possible outcome is that patroni takes longer than the default timeout of `30` seconds for the PostgreSQL database server to shut down cleanly.  If the PostgreSQL database server still has not shut down by the end of the new timeout of `120` seconds, then we are no worse off than we were before.\n\nBut now we will have in place a mechanism to control this timeout interval configuration and adjust it upwards as we encounter new situational information around host system and patroni service shutdown commands, whereas presently we have no method by which to control this mechanism using our configuration management tooling.\n\n## Material references\n\nDiscussions around discovery of problem which this issue intends to iteratively solve.\n\n- https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/12066#note_464281824\n- https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/12066#note_463307997\n- https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/12066#note_463768785\n\n## Alternative proposals\n\nThis is not strictly an alternative option, as it can be combined with the current approach to reduce anxiety around system and service stop instructions.  It is possible to also disable the patroni systemd unit configuration to use the `sigkill` method at all.\n\n- https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/12066#note_465064619","state":"closed","created_at":"2021-01-28T15:57:08.416Z","updated_at":"2022-08-04T12:32:28.340Z","closed_at":"2021-03-04T21:43:22.204Z","closed_by":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"labels":["Patroni","configuration","environment::gprd","workflow-infra::Done"],"milestone":null,"assignees":[{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"}],"author":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"type":"ISSUE","assignee":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2021-01-28","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12478","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12478","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12478/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12478/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12478","relative":"#12478","full":"gitlab-com/gl-infra/reliability#12478"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":77826560,"iid":12440,"project_id":1304532,"title":"Core Infra team vision discussion","description":"@dawsmith and I were discussing ideas for clarifying, expanding, and updating our [team vision](https://about.gitlab.com/handbook/engineering/infrastructure/team/reliability/core-infra/#vision), and I wanted to kickstart a discussion amongst the team to make sure we incorporate all perspectives with any changes we make.\n\nHere's one section from my notes:\n\u003e I’ve struggled for a long time trying to figure out what our team should be, what our vision is, and where our north star lies. This statement: “Continue delivering tangible value for both GitLab.com, but indirectly our self-managed customers who run at a larger scale. It has been mentioned too many times, but every improvement we make at scale for .com is a challenge our self-managed customers won't have to deal with.” resonated strongly with me. The areas that core infra owns include many areas we take for granted, a bit. Rarely do we have clear ways to incorporate a link back to our self-hosted customers, outside of the occasional sales call where we answer questions about how we manage .com. Incorporating more focus on reusability for self-hosted GitLab admins would significantly help us to answer those questions, clarify priorities, and provide impetus to improve the quality of our work products.\n\u003e - Chef (and next, Ansible), with all the related cookbooks/playbooks, pipelines, testing, and deployment\n\u003e - Standardize around publicly available/distributed terraform modules, helper scripts, pipeline definitions, etc.\n\u003e - Frontend traffic management, allow/blocklists, WAF, etc.\n\u003e - Kubernetes cluster monitoring and management\n\nIn addition to ensuring we focus more on repeatability and reusability in our code artifacts, one common theme I keep coming back to in my 1:1 discussions with @dawsmith centers around shifting our mindset to think about services and platforms instead of (just) tools and technologies. So instead of attacking the problem of managing infrastructure by thinking about terraform code updates and custom scripts, I'd like to think through some standard use-cases and abstract those implementation details a bit. We can still leverage the best technology for a given purpose on the backend, but we can more effectively enable self-service for other teams within GitLab by codifying what it means to deploy infrastructure _in our environment_ with a narrower, more focused abstractions.\n\nThe idea is to enable scalability and SaaS platform maturity by distilling down complex codebases and diverse technologies into simpler, more consumable interfaces.\n\nOne example might be to define a \"frontend service\" that comprises managing allow/blocklists, path-based routing \u0026 ACLs, DNS, and SSL certificates; another could be dealing with the mountain of options with raw GCP/GKE APIs, console, and CLI options, and presenting a service/API/CLI of our own that allows a user to \"just\" create a VM, project, etc. while ensuring that the results of that action are properly tagged, follow naming conventions, have appropriate security measures in place, and are subject to lifecycle policies to reduce bloat in idle infrastructure.\n\nFor a GitLab engineer looking to engage with our infrastructure, it is much less intimidating to be presented with a curated selection of common use-cases via a web frontend, internal API, or custom CLI utility, than to be told \"Oh yeah - just check out our thousands of lines of terraform/chef/ansible/go code, that'll get you what you need.\" The easier and safer we make it for more people to productively contribute to the growth and management of gitlab.com, the better all our lives will be. As things stand, we often operate as a bit of a \"service team\", dealing with many fractured ad-hoc requests from many different directions, and that simply won't scale effectively.\n\nThese are just a couple points from my perspective. What does everyone else think? Since we could brainstorm a thousand ideas that may or may not be feasible/important/urgent, we should try to focus on the things that are most critical, alleviate the most pain, provide the greatest value, etc. As a concrete exercise, one way of framing this is to consider the end goal for a particular timeframe, then work backwards from there filling in the broad strokes of what it'll take to get there.\n\nEx:  \n_It is February 2022; in the past year we have_\n- _implemented a core webservice/API and associated CLI that we use to holistically manage frontend services for gitlab.com. So far we can manage allow/blocklists in Cloudflare, page rules, WAF rules, and path-based routing_\n- _while we have emergency-use out-of-band SSH credentials for SREs, we have successfully migrated all other infrastructure authn and authz to Okta or OAuth integrations_\n- _we have a service that allows us to create and manage VM base images, with reports on utilization throughout the environment for visibility as we facilitate updates, OS upgrades, and removal of outdated images from the catalog_\n- _we have established a baseline definition of the standards required for our GKE cluster, and have a plan to develop a CLI for creating, updating, and validating foundational cluster configuration throughout all our environments_","state":"closed","created_at":"2021-01-25T21:46:07.270Z","updated_at":"2022-08-04T12:32:49.594Z","closed_at":"2021-10-01T19:56:03.844Z","closed_by":{"id":693144,"username":"craig","name":"Craig Barrett","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c8dfa1ca41754b9409068e5e42080cd2?s=80\u0026d=identicon","web_url":"https://gitlab.com/craig"},"labels":["Discussion","team::Reliability","workflow-infra::Done"],"milestone":{"id":1994752,"iid":136,"group_id":1112072,"title":"Core-Infra FY22Q2 Items","description":"This milestone is a bucket to make sure we can see things on our board:\r\n\r\n[https://gitlab.com/groups/gitlab-com/gl-infra/-/boards/1688496?\u0026label_name\\[\\]=team%3A%3ACore-Infra](https://gitlab.com/groups/gitlab-com/gl-infra/-/boards/1688496?\u0026label_name%5B%5D=team%3A%3ACore-Infra)","state":"closed","created_at":"2021-04-13T15:13:04.655Z","updated_at":"2021-11-12T05:29:30.642Z","due_date":"2021-07-31","start_date":"2021-05-01","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/136"},"assignees":[{"id":429540,"username":"ahanselka","name":"Alex Hanselka","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/429540/avatar.png","web_url":"https://gitlab.com/ahanselka"},{"id":555989,"username":"T4cC0re","name":"Hendrik Meyer","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/555989/avatar.png","web_url":"https://gitlab.com/T4cC0re"},{"id":693144,"username":"craig","name":"Craig Barrett","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c8dfa1ca41754b9409068e5e42080cd2?s=80\u0026d=identicon","web_url":"https://gitlab.com/craig"},{"id":2222520,"username":"dawsmith","name":"Dave Smith","state":"active","avatar_url":"https://secure.gravatar.com/avatar/ef341e061f6b86461626e64c5fbcfe52?s=80\u0026d=identicon","web_url":"https://gitlab.com/dawsmith"},{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"}],"author":{"id":693144,"username":"craig","name":"Craig Barrett","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c8dfa1ca41754b9409068e5e42080cd2?s=80\u0026d=identicon","web_url":"https://gitlab.com/craig"},"type":"ISSUE","assignee":{"id":429540,"username":"ahanselka","name":"Alex Hanselka","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/429540/avatar.png","web_url":"https://gitlab.com/ahanselka"},"user_notes_count":8,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12440","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":8,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12440","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12440/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12440/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12440","relative":"#12440","full":"gitlab-com/gl-infra/reliability#12440"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":77690708,"iid":12434,"project_id":1304532,"title":"replace `module.gcp-tcp-lb-spectrum` with `module.gcp-tcp-lb` in gprd","description":"As part of https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/12313 we cleaned up `gprd` terraform to have a clean resource for the main spectrum app. To reach full alignment with `gstg`, we need to create a new `module.gcp-tcp-lb` with identical configuration and migrate the spectrum app over to that.","state":"closed","created_at":"2021-01-22T14:52:46.656Z","updated_at":"2022-09-01T01:19:51.278Z","closed_at":"2022-09-01T01:19:50.679Z","closed_by":{"id":10167447,"username":"afappiano","name":"Anthony Fappiano","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/10167447/avatar.png","web_url":"https://gitlab.com/afappiano"},"labels":["Reliability::P4","Service::Cloudflare","team::Reliability"],"milestone":null,"assignees":[],"author":{"id":555989,"username":"T4cC0re","name":"Hendrik Meyer","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/555989/avatar.png","web_url":"https://gitlab.com/T4cC0re"},"type":"ISSUE","assignee":null,"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12434","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":13,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12434","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12434/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12434/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12434","relative":"#12434","full":"gitlab-com/gl-infra/reliability#12434"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":117,"epic":{"id":15223,"iid":117,"title":"Cloudflare: move GitLab.com","url":"/groups/gitlab-com/gl-infra/-/epics/117","group_id":1112072,"human_readable_end_date":"Mar 6, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":77621595,"iid":12422,"project_id":1304532,"title":"Cleanup residue from email.customer.gitlab.com Cloudflare move","description":"Cleanup the terraform diffs caused by https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/12411\n\nThis will involve touching the dns_record module to allow for orange-clouded domains, as well as importing the new page rule and fixing the order in terraform.","state":"closed","created_at":"2021-01-21T16:09:00.126Z","updated_at":"2022-08-04T12:32:59.882Z","closed_at":"2021-05-18T13:55:36.714Z","closed_by":{"id":8410890,"username":"nhoppe1","name":"Natan Hoppe","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/8410890/avatar.png","web_url":"https://gitlab.com/nhoppe1"},"labels":["AssistType::Domain-DNS-SSL-Management","AssistingTeam::Infrastructure","Service::CustomersDot","Unplanned","workflow-infra::Done"],"milestone":{"id":1994752,"iid":136,"group_id":1112072,"title":"Core-Infra FY22Q2 Items","description":"This milestone is a bucket to make sure we can see things on our board:\r\n\r\n[https://gitlab.com/groups/gitlab-com/gl-infra/-/boards/1688496?\u0026label_name\\[\\]=team%3A%3ACore-Infra](https://gitlab.com/groups/gitlab-com/gl-infra/-/boards/1688496?\u0026label_name%5B%5D=team%3A%3ACore-Infra)","state":"closed","created_at":"2021-04-13T15:13:04.655Z","updated_at":"2021-11-12T05:29:30.642Z","due_date":"2021-07-31","start_date":"2021-05-01","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/136"},"assignees":[{"id":555989,"username":"T4cC0re","name":"Hendrik Meyer","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/555989/avatar.png","web_url":"https://gitlab.com/T4cC0re"},{"id":8410890,"username":"nhoppe1","name":"Natan Hoppe","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/8410890/avatar.png","web_url":"https://gitlab.com/nhoppe1"}],"author":{"id":555989,"username":"T4cC0re","name":"Hendrik Meyer","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/555989/avatar.png","web_url":"https://gitlab.com/T4cC0re"},"type":"ISSUE","assignee":{"id":555989,"username":"T4cC0re","name":"Hendrik Meyer","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/555989/avatar.png","web_url":"https://gitlab.com/T4cC0re"},"user_notes_count":7,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12422","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":8,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12422","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12422/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12422/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12422","relative":"#12422","full":"gitlab-com/gl-infra/reliability#12422"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":77589454,"iid":12417,"project_id":1304532,"title":"Woodhouse is @-ing unrelated people in incident issues","description":"Example: https://gitlab.com/gitlab-com/gl-infra/production/-/issues/3381#note_490373672\n\nIt appears as thought woodhouse is sometimes @-ing the incorrect GitLab handle for incident openers in the issue description, leading to this situation in which @brentnewton opened an issue which tagged `@bnewton`. We can see this was the case, from this subsequent description edit:\n\n![Screenshot_2021-01-21_at_07.43.03](/uploads/d633389241bfe4a3d9aa8e85ba19f32e/Screenshot_2021-01-21_at_07.43.03.png)\n\nThis may be due to incorrectly assuming some relationship between the user's Slack handle and their GitLab handle.","state":"closed","created_at":"2021-01-21T07:45:42.738Z","updated_at":"2021-02-21T01:14:01.401Z","closed_at":"2021-01-21T12:04:03.835Z","closed_by":{"id":3911656,"username":"craigf","name":"Craig Furman","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3911656/avatar.png","web_url":"https://gitlab.com/craigf"},"labels":["workflow-infra::Done"],"milestone":null,"assignees":[{"id":3911656,"username":"craigf","name":"Craig Furman","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3911656/avatar.png","web_url":"https://gitlab.com/craigf"}],"author":{"id":3911656,"username":"craigf","name":"Craig Furman","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3911656/avatar.png","web_url":"https://gitlab.com/craigf"},"type":"ISSUE","assignee":{"id":3911656,"username":"craigf","name":"Craig Furman","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3911656/avatar.png","web_url":"https://gitlab.com/craigf"},"user_notes_count":3,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12417","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12417","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12417/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12417/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12417","relative":"#12417","full":"gitlab-com/gl-infra/reliability#12417"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":77573036,"iid":12412,"project_id":1304532,"title":"Woodhouse mentions the wrong GitLab user","description":"I noticed after I created production#3338, that the initial description populated by Woodhouse at-mentioned `cbarrett`, but my gitlab.com username is @craig. I'm not sure where this identity is managed, since my slack handle is also @craig, so it's not pulling from there. My email is either cbarrett or craig at gitlab.com, depending on how/where you look.","state":"closed","created_at":"2021-01-20T21:39:07.484Z","updated_at":"2022-08-04T12:33:06.423Z","closed_at":"2021-02-21T01:14:20.131Z","closed_by":{"id":693144,"username":"craig","name":"Craig Barrett","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c8dfa1ca41754b9409068e5e42080cd2?s=80\u0026d=identicon","web_url":"https://gitlab.com/craig"},"labels":["workflow-infra::Done"],"milestone":null,"assignees":[],"author":{"id":693144,"username":"craig","name":"Craig Barrett","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c8dfa1ca41754b9409068e5e42080cd2?s=80\u0026d=identicon","web_url":"https://gitlab.com/craig"},"type":"ISSUE","assignee":null,"user_notes_count":0,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12412","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12412","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12412/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12412/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12412","relative":"#12412","full":"gitlab-com/gl-infra/reliability#12412"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":77561597,"iid":12410,"project_id":1304532,"title":"Manage repository residency audit tooling","description":"- [ ] Package the runbooks gitaly shard repository residency audit tooling script as a ruby gem.\n- [ ] Host it somewhere, like rubygems. (Or aptly.gitlab.com?)\n- [ ] Roll it out as part of a chef recipe included by a gitaly-specific role.","state":"closed","created_at":"2021-01-20T17:00:48.192Z","updated_at":"2023-01-03T11:01:14.617Z","closed_at":"2023-01-03T11:01:14.601Z","closed_by":{"id":210928,"username":"steveazz","name":"Steve Azzopardi","state":"active","avatar_url":"https://secure.gravatar.com/avatar/4a5eeed7ec5c80642df9ee708bb496d7?s=80\u0026d=identicon","web_url":"https://gitlab.com/steveazz"},"labels":["DStores-Backlog::GTLY","Infrastructure","Reliability::P4","Service::Gitaly","auto updated","chef","team::Reliability"],"milestone":null,"assignees":[],"author":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"type":"ISSUE","assignee":null,"user_notes_count":5,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12410","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":3,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12410","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12410/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12410/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12410","relative":"#12410","full":"gitlab-com/gl-infra/reliability#12410"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":77490807,"iid":12375,"project_id":1304532,"title":"Web-Pages HAProxy logs need more visibility","description":"As an EOC, I should be able to examine access requests coming into the web-pages service to help troubleshoot incidents involving web-pages.\n\nInspiring incident: https://gitlab.com/gitlab-com/gl-infra/production/-/issues/3317","state":"closed","created_at":"2021-01-19T17:22:14.017Z","updated_at":"2021-09-28T16:46:37.009Z","closed_at":"2021-09-28T16:46:36.993Z","closed_by":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"labels":["auto updated","corrective action","severity::4","team::Reliability","workflow-infra::Done"],"milestone":{"id":2119954,"iid":144,"group_id":1112072,"title":"EOC Queue Q2 2021","description":"","state":"closed","created_at":"2021-06-27T15:50:33.795Z","updated_at":"2021-11-12T05:29:04.183Z","due_date":"2021-07-31","start_date":"2021-05-01","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/144"},"assignees":[{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"}],"author":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"type":"ISSUE","assignee":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"user_notes_count":4,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12375","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12375","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12375/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12375/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12375","relative":"#12375","full":"gitlab-com/gl-infra/reliability#12375"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":77485561,"iid":12373,"project_id":1304532,"title":"Bump Cloud Native GitLab (CNG) to Redis 6.0.10","description":"This is a sister issue to https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/12346, for bumping the Redis version in CNG.","state":"closed","created_at":"2021-01-19T15:46:12.503Z","updated_at":"2021-06-03T12:27:34.595Z","closed_at":"2021-06-03T12:27:34.566Z","closed_by":{"id":876203,"username":"igorwwwwwwwwwwwwwwwwwwww","name":"Igor","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/876203/avatar.png","web_url":"https://gitlab.com/igorwwwwwwwwwwwwwwwwwwww"},"labels":["Service::Redis","workflow-infra::Done"],"milestone":{"id":1810563,"iid":125,"group_id":1112072,"title":"Observability Backlog","description":"The Observability SRE Team uses this milestone to scope work to our Kanban [board](https://gitlab.com/groups/gitlab-com/gl-infra/-/boards/1677278).\r\n\r\nFor our triage issues, please see this [issue search](https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/?scope=all\u0026utf8=%E2%9C%93\u0026state=opened\u0026label_name[]=team%3A%3AObservability\u0026label_name[]=workflow-infra%3A%3ATriage).","state":"closed","created_at":"2021-01-06T16:26:59.737Z","updated_at":"2022-01-04T10:18:35.366Z","due_date":null,"start_date":null,"expired":false,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/125"},"assignees":[{"id":876203,"username":"igorwwwwwwwwwwwwwwwwwwww","name":"Igor","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/876203/avatar.png","web_url":"https://gitlab.com/igorwwwwwwwwwwwwwwwwwwww"}],"author":{"id":876203,"username":"igorwwwwwwwwwwwwwwwwwwww","name":"Igor","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/876203/avatar.png","web_url":"https://gitlab.com/igorwwwwwwwwwwwwwwwwwwww"},"type":"ISSUE","assignee":{"id":876203,"username":"igorwwwwwwwwwwwwwwwwwwww","name":"Igor","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/876203/avatar.png","web_url":"https://gitlab.com/igorwwwwwwwwwwwwwwwwwwww"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12373","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12373","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12373/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12373/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12373","relative":"#12373","full":"gitlab-com/gl-infra/reliability#12373"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":395,"epic":{"id":180929,"iid":395,"title":"Redis 6 upgrade","url":"/groups/gitlab-com/gl-infra/-/epics/395","group_id":1112072,"human_readable_end_date":"Apr 30, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":77439656,"iid":12367,"project_id":1304532,"title":"Upgrade all GKE clusters to 1.18","description":"We need to upgrade all our GKE clusters to Kubernetes 1.18 (minimum release `v1.18.6-gke.6300`) as it was highlighted at https://gitlab.com/gitlab-org/charts/gitlab/-/issues/2440#note_486117933 that we have incorrect sysctl settings on our node, potentially leading to issues.\n\nLooking at the upgrades notes at https://v1-18.docs.kubernetes.io/docs/setup/release/notes/#urgent-upgrade-notes I'll highlight the important things of note that I think affect us\n\n\u003e kube-apiserver:  \n\u003e the following deprecated APIs can no longer be served:  \n\u003e        All resources under apps/v1beta1 and apps/v1beta2 - use apps/v1 instead  \n\u003e        daemonsets, deployments, replicasets resources under extensions/v1beta1 - use apps/v1 instead  \n\u003e        networkpolicies resources under extensions/v1beta1 - use networking.k8s.io/v1 instead  \n\u003e        podsecuritypolicies resources under extensions/v1beta1 - use policy/v1beta1 instead (#85903, @liggitt) [SIG API Machinery, Apps, Cluster Lifecycle, Instrumentation and Testing]  \n\nWe need to audit everything in the Gitlab chart (and all other services we deploy) to make sure we aren't using any deprecated interfaces\n\n\u003e resource metrics endpoint /metrics/resource/v1alpha1 as well as all metrics under this endpoint have been deprecated. Please convert to the following metrics emitted by endpoint /metrics/resource:\n\u003e - scrape_error --\u003e scrape_error  \n\u003e - node_cpu_usage_seconds_total --\u003e node_cpu_usage_seconds  \n\u003e - node_memory_working_set_bytes --\u003e node_memory_working_set_bytes  \n\u003e - container_cpu_usage_seconds_total --\u003e container_cpu_usage_seconds  \n\u003e - container_memory_working_set_bytes --\u003e container_memory_working_set_bytes  \n\u003e - scrape_error --\u003e scrape_error  \n\u003e (#86282, @RainbowMango) [SIG Node]\n\nWe need to confirm we don't rely on any of these\n\n\u003e Ingress:  \n\u003e    spec.ingressClassName replaces the deprecated kubernetes.io/ingress.class annotation, and allows associating an Ingress object with a particular controller.  \n\u003e    path definitions added a pathType field to allow indicating how the specified path should be matched against incoming requests. Valid values are Exact, Prefix, and ImplementationSpecific (#88587, @cmluciano) [SIG Apps, Cluster Lifecycle and Network]\n\nWe should check all ingress objects to make sure this is ok. I think this should be fine for backwards compatibility, but a bit of confirmation and investigation is worthwhile.\n\nMetrics changes also documented at https://v1-18.docs.kubernetes.io/docs/setup/release/notes/#metrics which we should review\n\n# Checklist\n\n## Pre-upgrade checks for 1.18\n* [x] Upgrade kubectl client for CI - https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/12367#note_488814977\n* [x] Confirm all resources in `k8s-workloads/gitlab-com` use non-deprecated apis\n* [x] Confirm all resources in `k8s-workloads/gitlab-helmfiles` use non-deprecated apis\n* [x] Confirm all resources in `k8s-workloads/tanka-deployments` use non-deprecated apis\n* [x] Confirm that we do not use resource metrics endpoint `/metrics/resource/v1alpha1` and if so, migrate to new endpoint\n* [x] Confirm that all ingress resources do not rely on the `kubernetes.io/ingress.class` annotation\n* [x] Confirm that the metric changes documented at https://v1-18.docs.kubernetes.io/docs/setup/release/notes/#metrics do not affect us\n\n## Upgrade\n* [x] `ops` master(s) upgraded\n* [x] `ops` nodes upgraded\n* [x] `pre` master(s) upgraded\n* [x] `pre` nodes upgraded\n* [x] `gstg` master(s) upgraded\n* [x] `gstg` nodes upgraded\n* [x] `gprd` master(s) upgraded\n* [x] `gprd` nodes upgraded\n* [x] `org-ci` master(s) upgraded\n* [x] `org-ci` nodes upgraded","state":"closed","created_at":"2021-01-19T00:01:15.768Z","updated_at":"2021-04-22T21:16:48.221Z","closed_at":"2021-04-21T22:10:48.819Z","closed_by":{"id":4337537,"username":"ggillies","name":"Graeme Gillies","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4337537/avatar.png","web_url":"https://gitlab.com/ggillies"},"labels":["Unplanned","corrective action","kubernetes","workflow-infra::Done"],"milestone":{"id":1994749,"iid":135,"group_id":1112072,"title":"Core-Infra FY22Q1 Items","description":"This milestone is a bucket to make sure we can see things on our board:\r\n\r\nhttps://gitlab.com/groups/gitlab-com/gl-infra/-/boards/1688496?\u0026label_name[]=team%3A%3ACore-Infra","state":"closed","created_at":"2021-04-13T15:12:22.906Z","updated_at":"2021-05-12T18:53:03.055Z","due_date":"2021-04-30","start_date":"2021-02-01","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/135"},"assignees":[{"id":4337537,"username":"ggillies","name":"Graeme Gillies","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4337537/avatar.png","web_url":"https://gitlab.com/ggillies"}],"author":{"id":4337537,"username":"ggillies","name":"Graeme Gillies","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4337537/avatar.png","web_url":"https://gitlab.com/ggillies"},"type":"ISSUE","assignee":{"id":4337537,"username":"ggillies","name":"Graeme Gillies","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4337537/avatar.png","web_url":"https://gitlab.com/ggillies"},"user_notes_count":32,"merge_requests_count":0,"upvotes":2,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12367","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":17,"completed_count":17},"weight":3,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12367","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12367/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12367/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12367","relative":"#12367","full":"gitlab-com/gl-infra/reliability#12367"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":77506531,"iid":12384,"project_id":1304532,"title":"Update our WAL-G info in our Runbooks","description":"This Runbook information is outdated and we should update it as a result of our successful implementation of WAL-G in production (retiring WAL-E)\n\nhttps://ops.gitlab.net/gitlab-com/runbooks/-/blob/master/docs/patroni/postgresql-backups-wale-walg.md\n\nWe may want to iterate on this in 2-3 different phases, to get results asap (clean the wrong info first), given the size and the amount of info of this Runbook.\n\nAcceptance Criteria:\n- [ ] All the mentions to WAL-E are removed, or state clearly the ones that are not valid anymore.\n- [ ] Update the mentions to WAL-G in the runbook, so they represent what we have in production at the moment.\n- [ ] Clean the sections that are not needed, and the pointers to external links.","state":"closed","created_at":"2021-01-18T16:41:38.641Z","updated_at":"2022-08-18T16:18:25.531Z","closed_at":"2022-08-18T16:18:25.488Z","closed_by":{"id":10167447,"username":"afappiano","name":"Anthony Fappiano","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/10167447/avatar.png","web_url":"https://gitlab.com/afappiano"},"labels":["Reliability::P2","team::Reliability","work::general","workflow-infra::Ready"],"milestone":null,"assignees":[],"author":{"id":5709244,"username":"albertoramos","name":"Alberto Ramos","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5709244/avatar.png","web_url":"https://gitlab.com/albertoramos"},"type":"ISSUE","assignee":null,"user_notes_count":1,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12384","time_stats":{"time_estimate":18000,"total_time_spent":0,"human_time_estimate":"5h","human_total_time_spent":null},"task_completion_status":{"count":3,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12384","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12384/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12384/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12384","relative":"#12384","full":"gitlab-com/gl-infra/reliability#12384"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":380,"epic":{"id":162885,"iid":380,"title":"WAL-G improvements","url":"/groups/gitlab-com/gl-infra/-/epics/380","group_id":1112072,"human_readable_end_date":"Jul 31, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":77227259,"iid":12346,"project_id":1304532,"title":"Bump omnibus to Redis 6.0.10","description":"We'll also want to make sure to allow the new threaded-io settings to be configured:\n\nFrom [annotated `redis.conf`](https://raw.githubusercontent.com/redis/redis/6.0/redis.conf):\n\n```\n################################ THREADED I/O #################################\n\n# Redis is mostly single threaded, however there are certain threaded\n# operations such as UNLINK, slow I/O accesses and other things that are\n# performed on side threads.\n#\n# Now it is also possible to handle Redis clients socket reads and writes\n# in different I/O threads. Since especially writing is so slow, normally\n# Redis users use pipelining in order to speed up the Redis performances per\n# core, and spawn multiple instances in order to scale more. Using I/O\n# threads it is possible to easily speedup two times Redis without resorting\n# to pipelining nor sharding of the instance.\n#\n# By default threading is disabled, we suggest enabling it only in machines\n# that have at least 4 or more cores, leaving at least one spare core.\n# Using more than 8 threads is unlikely to help much. We also recommend using\n# threaded I/O only if you actually have performance problems, with Redis\n# instances being able to use a quite big percentage of CPU time, otherwise\n# there is no point in using this feature.\n#\n# So for instance if you have a four cores boxes, try to use 2 or 3 I/O\n# threads, if you have a 8 cores, try to use 6 threads. In order to\n# enable I/O threads use the following configuration directive:\n#\n# io-threads 4\n#\n# Setting io-threads to 1 will just use the main thread as usual.\n# When I/O threads are enabled, we only use threads for writes, that is\n# to thread the write(2) syscall and transfer the client buffers to the\n# socket. However it is also possible to enable threading of reads and\n# protocol parsing using the following configuration directive, by setting\n# it to yes:\n#\n# io-threads-do-reads no\n#\n# Usually threading reads doesn't help much.\n#\n# NOTE 1: This configuration directive cannot be changed at runtime via\n# CONFIG SET. Aso this feature currently does not work when SSL is\n# enabled.\n#\n# NOTE 2: If you want to test the Redis speedup using redis-benchmark, make\n# sure you also run the benchmark itself in threaded mode, using the\n# --threads option to match the number of Redis threads, otherwise you'll not\n# be able to notice the improvements.\n```\n\nWe'll need to review the [CHANGELOG](https://raw.githubusercontent.com/antirez/redis/6.0/00-RELEASENOTES) for potential BC breaks.","state":"closed","created_at":"2021-01-14T14:13:44.163Z","updated_at":"2021-01-25T16:33:56.169Z","closed_at":"2021-01-25T11:09:47.782Z","closed_by":{"id":876203,"username":"igorwwwwwwwwwwwwwwwwwwww","name":"Igor","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/876203/avatar.png","web_url":"https://gitlab.com/igorwwwwwwwwwwwwwwwwwwww"},"labels":["workflow-infra::Done"],"milestone":null,"assignees":[{"id":876203,"username":"igorwwwwwwwwwwwwwwwwwwww","name":"Igor","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/876203/avatar.png","web_url":"https://gitlab.com/igorwwwwwwwwwwwwwwwwwwww"},{"id":3417286,"username":"mwasilewski-gitlab","name":"Michal Wasilewski","state":"blocked","avatar_url":"https://secure.gravatar.com/avatar/2a9fc70321a9df494ecdc8f178df11dd?s=80\u0026d=identicon","web_url":"https://gitlab.com/mwasilewski-gitlab"}],"author":{"id":876203,"username":"igorwwwwwwwwwwwwwwwwwwww","name":"Igor","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/876203/avatar.png","web_url":"https://gitlab.com/igorwwwwwwwwwwwwwwwwwwww"},"type":"ISSUE","assignee":{"id":876203,"username":"igorwwwwwwwwwwwwwwwwwwww","name":"Igor","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/876203/avatar.png","web_url":"https://gitlab.com/igorwwwwwwwwwwwwwwwwwwww"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12346","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12346","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12346/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12346/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12346","relative":"#12346","full":"gitlab-com/gl-infra/reliability#12346"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":395,"epic":{"id":180929,"iid":395,"title":"Redis 6 upgrade","url":"/groups/gitlab-com/gl-infra/-/epics/395","group_id":1112072,"human_readable_end_date":"Apr 30, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":77160393,"iid":12332,"project_id":1304532,"title":"Create lifecycle for docker images and containers on runner-01-inf-ops","description":"The `runner-01-inf-ops` runner has a lot of disk space that is consumed by docker images/containers/volumes/etc.\n\nWe should add some cron jobs to perform routine clean-ups on these resources to keep the node operating with plenty of disk space for new images, etc.\n\nMinimum DOD:\n* A weekly cron job to clean up dangling images `docker image prune`\n\nNice to have DOD:\n* A more elaborate cron job that also cleans up images not attached to containers, old containers, old volumes, and old networks.\n* Consider moving `/var/lib/docker` to it's own filesystem to prevent this disk usage from endangering the node's root filesystem.","state":"closed","created_at":"2021-01-13T13:43:04.674Z","updated_at":"2021-04-09T12:55:00.308Z","closed_at":"2021-04-09T12:55:00.242Z","closed_by":{"id":8509599,"username":"mchacon3","name":"Marcel Chacon","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/8509599/avatar.png","web_url":"https://gitlab.com/mchacon3"},"labels":["corrective action","severity::4","workflow-infra::Done"],"milestone":{"id":1852668,"iid":131,"group_id":1112072,"title":"Core-Infra Feb 28 - Mar 13","description":"","state":"closed","created_at":"2021-01-27T20:22:18.924Z","updated_at":"2021-04-13T15:15:40.701Z","due_date":"2021-03-13","start_date":"2021-02-28","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/131"},"assignees":[{"id":8509599,"username":"mchacon3","name":"Marcel Chacon","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/8509599/avatar.png","web_url":"https://gitlab.com/mchacon3"}],"author":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"type":"ISSUE","assignee":{"id":8509599,"username":"mchacon3","name":"Marcel Chacon","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/8509599/avatar.png","web_url":"https://gitlab.com/mchacon3"},"user_notes_count":13,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2021-02-26","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12332","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12332","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12332/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12332/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12332","relative":"#12332","full":"gitlab-com/gl-infra/reliability#12332"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":77084222,"iid":12313,"project_id":1304532,"title":"Align altssh on gstg with gprd \u0026 cleanup terraform residue","description":"**Current Situation**\n\u003c!--Describe the current situation which you are intending to iterate on with the work described in this issue.--\u003e\nCurrently on gprd we redirect the altssh traffic to our regular SSH LBs in Cloudflare Spectrum. We don't do this for gstg.\n\n**Desired Outcome**\n\u003c!--Describe the intended outcome of the work represented in this issue. How does it improve upon the current situation above?--\u003e\ngprd and gstg both re-map `altssh.gitlab.com:443` to `$gitlab_com_origin_ip:22` in Cloudflare spectrum.\n\n**Acceptance Criteria**\nThese are intertwined, thus not separate issues!\n\u003c!--List out work items necessary to arrive at the desired outcome above, as atomically as possible.--\u003e\n- [x] Copy the terraform definition for altssh from gprd to gstg\n- [x] Apply the changes\n- [x] Clean up the old terraform code","state":"closed","created_at":"2021-01-12T12:02:21.061Z","updated_at":"2021-08-09T11:48:28.362Z","closed_at":"2021-08-09T11:48:28.337Z","closed_by":{"id":555989,"username":"T4cC0re","name":"Hendrik Meyer","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/555989/avatar.png","web_url":"https://gitlab.com/T4cC0re"},"labels":["Core-Infra::P2","Service::Cloudflare","team::Reliability","workflow-infra::Done"],"milestone":{"id":1994752,"iid":136,"group_id":1112072,"title":"Core-Infra FY22Q2 Items","description":"This milestone is a bucket to make sure we can see things on our board:\r\n\r\n[https://gitlab.com/groups/gitlab-com/gl-infra/-/boards/1688496?\u0026label_name\\[\\]=team%3A%3ACore-Infra](https://gitlab.com/groups/gitlab-com/gl-infra/-/boards/1688496?\u0026label_name%5B%5D=team%3A%3ACore-Infra)","state":"closed","created_at":"2021-04-13T15:13:04.655Z","updated_at":"2021-11-12T05:29:30.642Z","due_date":"2021-07-31","start_date":"2021-05-01","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/136"},"assignees":[{"id":555989,"username":"T4cC0re","name":"Hendrik Meyer","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/555989/avatar.png","web_url":"https://gitlab.com/T4cC0re"}],"author":{"id":555989,"username":"T4cC0re","name":"Hendrik Meyer","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/555989/avatar.png","web_url":"https://gitlab.com/T4cC0re"},"type":"ISSUE","assignee":{"id":555989,"username":"T4cC0re","name":"Hendrik Meyer","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/555989/avatar.png","web_url":"https://gitlab.com/T4cC0re"},"user_notes_count":14,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2021-01-23","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12313","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":3,"completed_count":3},"weight":13,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12313","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12313/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12313/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12313","relative":"#12313","full":"gitlab-com/gl-infra/reliability#12313"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":94,"epic":{"id":12694,"iid":94,"title":"Cloudflare CDN, WAF implementation","url":"/groups/gitlab-com/gl-infra/-/epics/94","group_id":1112072,"human_readable_timestamp":"\u003cstrong\u003e1322\u003c/strong\u003e days elapsed"},"iteration":null,"health_status":null},{"id":76948932,"iid":12295,"project_id":1304532,"title":"Wrap up GSM epic and milestone","description":"The [project to launch Google Secrets Manager](\u0026343) and initial set of related processes is effectively done, and needs to be wrapped up. The [epic](\u0026343) and [milestone](https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/113) both need to be updated and closed, with references to leftover follow-up tasks to be addressed individually or as part of other, subsequent efforts (e.g. fixing instance-level service accounts during \u0026231)","state":"closed","created_at":"2021-01-08T23:59:33.703Z","updated_at":"2022-08-04T12:34:17.298Z","closed_at":"2021-03-04T21:03:07.978Z","closed_by":{"id":2222520,"username":"dawsmith","name":"Dave Smith","state":"active","avatar_url":"https://secure.gravatar.com/avatar/ef341e061f6b86461626e64c5fbcfe52?s=80\u0026d=identicon","web_url":"https://gitlab.com/dawsmith"},"labels":["Core-Infra::P2","workflow-infra::Done"],"milestone":{"id":1808963,"iid":124,"group_id":1112072,"title":"Core-Infra Jan 31 - Feb 13","description":"","state":"closed","created_at":"2021-01-05T23:32:25.348Z","updated_at":"2021-03-04T21:07:05.795Z","due_date":"2021-02-13","start_date":"2021-01-31","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/124"},"assignees":[],"author":{"id":693144,"username":"craig","name":"Craig Barrett","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c8dfa1ca41754b9409068e5e42080cd2?s=80\u0026d=identicon","web_url":"https://gitlab.com/craig"},"type":"ISSUE","assignee":null,"user_notes_count":0,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12295","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12295","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12295/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12295/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12295","relative":"#12295","full":"gitlab-com/gl-infra/reliability#12295"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":343,"epic":{"id":127310,"iid":343,"title":"Project: Migrate Infrastructure secrets from GCS+GKMS to GSM (Google Secret Manager)","url":"/groups/gitlab-com/gl-infra/-/epics/343","group_id":1112072,"human_readable_end_date":"Mar 13, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":76890801,"iid":12285,"project_id":1304532,"title":"Create new gitaly storage shard nodes to replace `nfs-file52` and `nfs-file53`","description":"Gitaly storage shard `nfs-file52` (`file-52-stor-gprd.c.gitlab-production.internal`) is at `75.46%` usage as of `2021-01-07`.  Gitaly storage shard `nfs-file53` (`file-53-stor-gprd.c.gitlab-production.internal`) is at `72.68%` usage as of `2021-01-07`.\n\nOur usage targets specify that we try to maintain usage between 65-79%.  New project creation would quickly cause more usage than that on both `nfs-file52` and `nfs-file53`.  The automatic weights assignment tool will soon eliminate `nfs-file52` and also `nfs-file53` as a candidate shard receiver for new project residencies.\n\nNote: This is partially a corrective action for incident [`2020-12-21: Gitaly nodes being removed from weight pool too soon`](https://gitlab.com/gitlab-com/gl-infra/production/-/issues/3225): https://gitlab.com/gitlab-com/gl-infra/production/-/issues/3225\n\nIt is no longer the case that nodes are being removed too soon, and so the initial five additional nodes were reduced to only two, instead.","state":"closed","created_at":"2021-01-07T16:40:44.714Z","updated_at":"2022-08-04T12:34:22.889Z","closed_at":"2021-05-11T21:30:20.375Z","closed_by":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"labels":["C4","DStores-Backlog::GTLY","Infrastructure","Service::Gitaly","auto updated","change","requires production access","workflow-infra::Done"],"milestone":null,"assignees":[{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"}],"author":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"type":"ISSUE","assignee":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2021-01-08","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12285","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12285","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12285/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12285/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12285","relative":"#12285","full":"gitlab-com/gl-infra/reliability#12285"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":76869540,"iid":12282,"project_id":1304532,"title":"keep wal-g backup-push logs for 7 days","description":"We should keep the wal-g backup-push logs for 7 days instead of simply overwriting the last log file with each backup.","state":"closed","created_at":"2021-01-07T11:47:39.717Z","updated_at":"2021-06-24T08:06:41.586Z","closed_at":"2021-01-08T10:54:11.829Z","closed_by":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"labels":["workflow-infra::Done","workflow-infrafin::Done"],"milestone":{"id":1720647,"iid":112,"group_id":1112072,"title":"Datastores team - W53","description":"Datastores iteration for the last week of 2020.","state":"closed","created_at":"2020-11-11T23:16:43.676Z","updated_at":"2021-11-12T05:28:05.907Z","due_date":"2021-01-10","start_date":"2020-12-28","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/112"},"assignees":[{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"}],"author":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"type":"ISSUE","assignee":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12282","time_stats":{"time_estimate":7200,"total_time_spent":0,"human_time_estimate":"2h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12282","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12282/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12282/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12282","relative":"#12282","full":"gitlab-com/gl-infra/reliability#12282"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":380,"epic":{"id":162885,"iid":380,"title":"WAL-G improvements","url":"/groups/gitlab-com/gl-infra/-/epics/380","group_id":1112072,"human_readable_end_date":"Jul 31, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":76838440,"iid":12276,"project_id":1304532,"title":"Evaluate infracost for inclusion in CI for terraform repositories","description":"The [infracost](https://www.infracost.io) utility seems like a very useful addition to our standard terraform workflows, and [this template](https://gitlab.com/infracost/infracost-gitlab-ci) may provide a useful starting place for incorporating the addition into our terraform project workflows (gitlab-com-infrastructure, gitlab-services, environments)","state":"closed","created_at":"2021-01-06T21:25:51.277Z","updated_at":"2022-09-01T01:17:00.846Z","closed_at":"2022-09-01T01:16:59.818Z","closed_by":{"id":10167447,"username":"afappiano","name":"Anthony Fappiano","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/10167447/avatar.png","web_url":"https://gitlab.com/afappiano"},"labels":["Reliability::P4","team::Reliability","terraform"],"milestone":null,"assignees":[],"author":{"id":693144,"username":"craig","name":"Craig Barrett","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c8dfa1ca41754b9409068e5e42080cd2?s=80\u0026d=identicon","web_url":"https://gitlab.com/craig"},"type":"ISSUE","assignee":null,"user_notes_count":3,"merge_requests_count":0,"upvotes":2,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12276","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12276","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12276/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12276/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12276","relative":"#12276","full":"gitlab-com/gl-infra/reliability#12276"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":219,"epic":{"id":46451,"iid":219,"title":"Terraform Improvements Backlog","url":"/groups/gitlab-com/gl-infra/-/epics/219","group_id":1112072},"iteration":null,"health_status":null},{"id":76837913,"iid":12275,"project_id":1304532,"title":"High-level planning and discussion for OS upgrades (16.04 to 20.04)","description":"The following is an initial _**rough draft**_ of pros and cons for each method. I'm sure there are many more pros and cons, but I'd like to open this up for input while I continue to consider the options. \n\nThis list will eventually be used to determine how to proceed. We should mainly consider patroni first, but I included others as I thought of them.\n\n# Pros and Cons of Upgrade Methods\n\nI am only considering pet services such as patroni and gitaly. Other nodes such as git and web are much more ephemeral and are likely going to be easiest to just rebuild.\nPatroni is in a high availability configuration and thus we could do the upgrades with only one bit of downtime during the failover of the primary. Gitaly nodes on the other\nhand are single points of failure and are unlikely to be able to be upgraded without downtime.\n\n## Delete and rebuild server with 20.04\n\nI would expect this process to be done via terraform by updating the base image for a given module and applying it in a targeted, one by one, fashion.\nThe disk would not be deleted while applying the terraform and would be reattached as-is to the newly built server.\n\nThis is my preferred method for redis, patroni, and ideally gitaly.\n\n### Pros\n\n- We will have a completely fresh server\n- Unlikely to end up in a state where a server doesn't come back from boot\n- Will be able to prove that this is a viable process for stateful servers in the future\n- By rebuilding these we could also implement the required changes for GSM (https://gitlab.com/groups/gitlab-com/gl-infra/-/epics/343)\n- An excellent time to upgrade machine types as well (https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/12484#note_505538821, https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/12294)\n\n### Cons\n\n- A rebuild might take some time to bootstrap and become available\n- Gitaly is a single point of failure, so doing this there might take more downtime than other methods\n- Terraform would be \"dirty\" for however long it takes to go through and rebuild each server\n  - There are around 60 gitaly servers so this would probably be quite a while\n- It is always unnerving to delete servers (not something we should base a decision on, simply wanted to express :slight_smile:)\n\n## In place update to 20.04\n\nWith this path, we would run an in place upgrade in which the only time the node would be down would be for the reboot.\nWe could set ignore_changes in the storage terraform module to allow new servers to be built with new images while not trying to force rebuilds on the old ones.\n\nThis is my preferred method for CI nodes s. \n\n### Pros\n\n- Doesn't require rebuild of server\n- Shorter downtime for a service like Gitaly as the downtime would only be a reboot\n- Would avoid rebuilding CI nodes since they are all fairly manual setup\n\n### Cons\n\n- Potential for strange behavior if the upgrade goes awry for some reason\n- If upgrade does go awry, recovering from that may be difficult and would likely be faster to fallback to the rebuild plan\n- We could update the machine type at the same time, but it would be a bit more difficult than rebuilding as it would involve terraform changes and applies unrelated to the upgrade.\nsd\n# Gitaly specific options\n\n## Subscribe to Ubuntu Advantage\n\nThis option would have us subscribe to [Advantage](https://ubuntu.com/advantage/) which would give us software and security updates until up to 2024. There would be a yearly fee associated with this option. A subscription for 80 VMs would be 6k a year with no support. If we wanted support it would be 20k or 40k per year based on whether we wanted 5 or 7 day access to support respectively. This would give us software and security updates until 2024, which ideally will be plenty of time. This in conjunction with ignoring boot disk and image changes in the storage module would allow us to build new servers using a new image but the same process.\n\nThis is my preferred method for Gitaly.\n\n### Pros\n\n- We can have quite a bit of runway if necessary to try to figure out the best way to update these, potentially with zero downtime.\n- We could thus focus on all of the other nodes we need to upgrade this quarter\n- The cost isn't really that expensive.\n\n### Cons\n\n- It costs. It is reasonable, but it does still cost.\n- We would be further kicking the can down the road (which is really only a minor downside given the benefit of extra time).\n- We're wanting to stop building GitLab packages for 16.04 so this would be a problem.\n\n## Upgrade by switching over to a newly built server\n\nThis method would involve building an additional server running 20.04, configuring it as desired, and then switching the data disk between the old and new nodes.\nThese servers would likely come in the form of a new terraform module definition.\n\nI do not think this a particularly great idea for any of our cases. I believe the only reasonable use of this method would be for Gitaly.\n\n### Pros\n\n- We could likely do the gitaly updates with the shortest amount of downtime this way, if we were able to solve the problems below.\n\n### Cons\n\n- We would have to have some method to switch traffic from the old node to the new node\n  - Currently all servers are referenced by DNS name which would be different with new servers\n  - The DNS name cannot be changed once the server is created\n  - Rolling out config changes to update the location of the gitaly shards is going to be a long and painful process, with high risk\n  - If we wanted to try to mitigate risk, we could create some sort of haproxy system in order to be able to swap traffic between the nodes\n- This method would likely be a substantial amount of extra work in validating everything as well as planning and executing all the switchovers\n\n## Build new servers and migrate all the repos from one node to the new node\n\nThis method would involve using the repo migration api to move all repos from one gitaly shard to a new one. I do not recommend this method.\n\n### Pros\n\n- We could upgrade the gitaly nodes with no downtime\n\n### Cons\n\n- The migration API is good, but there would undoubtedly be a decent number of failures, each of which would require investigation, validation, and repair\n- This would take ages. The migration of repos between shards is a slow process and we have about 60 shards to go through","state":"closed","created_at":"2021-01-06T21:01:39.498Z","updated_at":"2021-11-08T08:04:46.867Z","closed_at":"2021-11-08T06:56:59.521Z","closed_by":{"id":693144,"username":"craig","name":"Craig Barrett","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c8dfa1ca41754b9409068e5e42080cd2?s=80\u0026d=identicon","web_url":"https://gitlab.com/craig"},"labels":["auto updated","team::Reliability","workflow-infra::Done"],"milestone":{"id":1994752,"iid":136,"group_id":1112072,"title":"Core-Infra FY22Q2 Items","description":"This milestone is a bucket to make sure we can see things on our board:\r\n\r\n[https://gitlab.com/groups/gitlab-com/gl-infra/-/boards/1688496?\u0026label_name\\[\\]=team%3A%3ACore-Infra](https://gitlab.com/groups/gitlab-com/gl-infra/-/boards/1688496?\u0026label_name%5B%5D=team%3A%3ACore-Infra)","state":"closed","created_at":"2021-04-13T15:13:04.655Z","updated_at":"2021-11-12T05:29:30.642Z","due_date":"2021-07-31","start_date":"2021-05-01","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/136"},"assignees":[{"id":429540,"username":"ahanselka","name":"Alex Hanselka","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/429540/avatar.png","web_url":"https://gitlab.com/ahanselka"}],"author":{"id":693144,"username":"craig","name":"Craig Barrett","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c8dfa1ca41754b9409068e5e42080cd2?s=80\u0026d=identicon","web_url":"https://gitlab.com/craig"},"type":"ISSUE","assignee":{"id":429540,"username":"ahanselka","name":"Alex Hanselka","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/429540/avatar.png","web_url":"https://gitlab.com/ahanselka"},"user_notes_count":39,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12275","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":8,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12275","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12275/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12275/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12275","relative":"#12275","full":"gitlab-com/gl-infra/reliability#12275"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":231,"epic":{"id":49437,"iid":231,"title":"GitLab.com Fleet OS Upgrades","url":"/groups/gitlab-com/gl-infra/-/epics/231","group_id":1112072},"iteration":null,"health_status":null},{"id":76836574,"iid":12274,"project_id":1304532,"title":"Discussion and high-level plan for Chef to Ansible transition","description":"With Chef Server now EOL, limited options for community alternatives, and an overall pessimistic outlook on the future of the product/community after the sale of Chef Software, we have decided to begin the transition to Ansible next quarter. This issue will be used to kickstart the discussion around gathering some initial requirements, and generate the high-level plan for the effort that will be fed back into \u0026392.\n\n## Basic plan\n\nHere is a roll-up of the (very) high-level plan with additional/more detailed notes below. This is still a work-in-progress, and will likely continue to evolve even as we proceed to implementation and begin iterating on rolling through specific portions of the infrastructure.\n\n1. Reorganize gitlab-com/gitlab-com-infrastructure\u003e and update README\n1. Extend pipeline configs in gitlab-com/gitlab-com-infrastructure\u003e to support ansible / [GET](https://gitlab.com/gitlab-org/quality/gitlab-environment-toolkit)\n1. Implement [tagging standards](https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/11312) with additions as needed for this project\n1. Leverage tags/filters for [GCP inventory](https://docs.ansible.com/ansible/latest/collections/google/cloud/gcp_compute_inventory.html)\n    1. This should not necessarily be the same for [deployment](https://gitlab.com/gitlab-com/gl-infra/deploy-tooling), consul/service discovery may be a better option to distinguish between new, unconfigured nodes and those which have been successfully bootstrapped\n1. Develop bootstrap process, plan/implement corresponding terraform changes to support both Chef \u0026 Ansible\n1. Design equivalent top-level playbook structure for existing Chef roles\n1. Begin migrating common/base configuration and roles\n1. Design, document, and implement GKMS/GSM equivalents to Chef Vault items\n1. Rollout sequence (WIP)\n    1. Leave roles that are/will be migrating to k8s for last\n    1. Bastions\n    1. Gitaly\n    1. Praefect\n    1. Patroni\n    1. Redis\n    1. Console\n    1. Consul\n1. Develop plays for current configuration in chef cookbooks, by role\n1. Cleanup unused Chef \"stuff\"\n    1. Roles\n    1. Cookbooks\n    1. Data bags\n    1. Archive projects in gitlab\n    1. Decommission chef.gitlab.net\n    1. Remove monitoring/backups\n    1. Audit/cleanup documentation\n\n## Notes\n### Inventory\n\nEarly on, I had considered using Consul as an inventory source, but later realized that we would encounter a circular dependency on bootstrap, where nodes not already registered in Consul would not be visible, and as such Ansible could not target them to run a playbook that would... register... them... in... consul. While expanding our use of consul service discovery may be useful in other areas, it is not appropriate for this case. Using consul as a pivot point for a successfully bootstrapped node _may_ make that a more appropriate inventory source for deployments, however.\n\nWhich brings us to the [Google Cloud Compute Engine inventory source](https://docs.ansible.com/ansible/latest/collections/google/cloud/gcp_compute_inventory.html). This plugin will allow us to dynamically build inventories based on filters for matching resources within the GCP environment. We currently rely on Chef as our inventory source for deployments, so both the deployment tooling and the new Ansible infrastructure will need a new source of truth for their inventories. It clearly makes sense to shift to a GCP filter/tag-based approach for bootstrapping, as those values are assigned by terraform and provide a clean method for handoff between terraform and ansible.  We already [have plans](https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/11312) for implementing formal tagging standards, which should also be leveraged here, as well.\n\nFor deployments, however, leveraging Consul as the next \"higher-level\" inventory source seems appropriate, as a node would be registered in the service catalog and be subject to health/liveness/readiness checks indicating that a deployment to that specific node is appropriate, whereas a newly bootstrapped node may not have all pieces fully configured. Subsequent ansible runs could bridge the gap between the two should a new node be in the process of being bootstrapped _during_ a deployment, or we can incorporate functionality to prevent such situations into our deployment workflow.\n\nImplementing the tagging standards to facilitate updating/instantiating the inventory using a new source of truth (GCP) should be one of the first things to be done. The current Chef inventory can be kept for the duration of the project (ie minimal bootstrap, empty run-lists), but ultimately the new inventory will need to be well understood and fully integrated by the end of this project, with an ability to easily disable and remove chef once we have everything shifted to ansible. Similarly, developing plays to register services in consul and develop corresponding health checks should follow immediately after, so that we have that framework in place to adopt as we shift from Chef and Chef inventory to Ansible.\n\n### Pull vs push model\n\nFrom an architecture standpoint, one of the most fundamental differences between Chef and Ansible is the communications paradigm. While Ansible [can support a pull model](https://docs.ansible.com/ansible/latest/cli/ansible-pull.html) and we should certainly consider that if we encounter scaling challenges, the default starting assumption for most of the documentation, examples, tutorials, and small-scale examples rely on a push model via SSH. This is how our deployments to gitlab.com are conducted, and for simple alignment with the overwhelming mass of documentation and examples, is probably where we should start.\n\nIn addition, while not intrinsically related to this effort, we would benefit in several areas from leveraging Ansible in a build pipeline for \"golden\" images used in dynamically scaled infrastructure; we should keep that in mind as we work through this project. Because of its agentless nature, Ansible lends itself well to this approach, and that is a likely next project after the initial switch.\n\n### Management and orchestration\n\nAs I started reading about Ansible, one of the first questions I had was whether we need/want to leverage AWX (or Tower). After skimming through the main product page, I don't see a very compelling need for this in our case, especially based on the success we already have had in using GitLab for most of the primary features listed at https://www.ansible.com/products/tower for [deployments](https://gitlab.com/gitlab-com/gl-infra/deploy-tooling) and more recently for [codifying/automating database operations tasks](https://gitlab.com/gitlab-com/gl-infra/db-ops).\n\n| Feature | GitLab equivalent |\n| --- | --- |\n| Ansible Dashboard | Metrics exported to Prometheus and Grafana dashboards |\n| Real-time job status updates | GitLab CI Jobs |\n| Ansible Tower Workflows | GitLab CI Pipelines |\n| Activity streams (auditing) | GitLab CI Pipelines / repository history |\n| Ansible Tower clusters | N/A |\n| Integrations | GitLab CI Pipelines with webhooks/integrations |\n| Ansible Tower Smart Inventories | N/A - at most, \u003ca href=\"#inventory\"\u003edynamic inventory\u003c/a\u003e will suffice for our needs |\n| Ad-hoc jobs | GitLab CI Jobs |\n| Remote command execution | GitLab CI Jobs (or Teleport) |\n| REST API | GitLab API |\n\n### Secrets\n\nWith the recent completion of initial setup for Google Secrets Manager, we can begin coordinating the shift to begin using that service. I have not dug into this in sufficient detail, yet, but [some initial work](https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/12275#note_480745661) to update the instance service accounts will need to coordinated with this effort, as well as with the OS upgrades. In addition to updating instance service accounts, we need to functionally replace all existing tooling for managing secrets in GKMS and applying via Chef Vault. I have not really explored this in-depth, yet, so this is definitely a case of \"here there be dragons\" due to being so inherently vague.\n\n### Project structure\n\nAs we have seen over time, breaking out similar codebases and modular assets into multiple repositories enables flexibility when you have many consumers of the modular code, but this inherently brings a certain amount of added complexity and management pain. I have two thoughts to address this for this project.\n\nFirst is the recently announced [GitLab Environment Toolkit](https://gitlab.com/gitlab-org/quality/gitlab-environment-toolkit), developed by our QA team to effectively provision GitLab environments on-demand for testing. We need to evaluate the included Ansible code from that project due to the clear, overwhelming overlap between the two efforts. Absent any insurmountable complications, we should try to avoid forking to make the most effective use of a shared resource, but could also consider forking and maintaining a descendent project if absolutely necessary. Alternatively, we could attempt to cherry-pick the portions of Ansible code that apply to both situations, and work on a separate project from which both GET and our infrastructure tooling could inherit. In either case, I am hopeful that a closer examination shows this as an effective means of sharing infrastructure provisioning code both within GitLab and with the broader community.\n\nSecond, and possibly independent of the first, I'm thinking that our Ansible tooling need not be completely separate from our current Terraform code, and that consolidating both projects under gitlab-com-infrastructure could bring multiple benefits. It would provide the reduced complexity and ease of management of a monorepo, easier coordination of changes between Ansible and Terraform code for bootstrapping instances / managing instance groups, and provide a single place where most core infrastructure code and tooling can be stored/managed/documented. Consolidation of our Terraform code back into a monorepo with strict(er) adherence to feature-flagging code changes would necessarily be included in this approach to get the most benefit. Improved consistency across and within our infrastructure code is certainly desirable, but is not implicit from either approach. In the best case, the consolidation would make it easier to find portions of our codebase and therefore make it easier to keep things consistent (this is definitely a reach, however). This idea is not _completely_ fleshed out, and there are implications with things like our ephemeral and gitlab-services environments, but those too could conceivably be consolidated for the same reasons (though with a fair bit more difficulty, due to differing deployment patterns). Additionally, this centralizes a significant amount of privilege and therefore security risk into a single project, so maintaining good code hygiene and proper access controls would be critical.\n\nWhile I am in favor of the second point, it is the most significant decision I have yet to (fully) make, is not fully fleshed out (as noted), and would benefit the most from feedback from the broader team. If we decide that a shared infrastructure repo is not the right approach, I am still strongly in favor of keeping our Ansible code and tooling in a monorepo, regardless. If we have a clear need to distribute code in consumable format outside the team and/or outside of GitLab, we can revisit this choice later, but for our own team's immediate usage, I think the benefits far outweigh any drawbacks.\n\n### Disaster Recovery\n\nWhen I first approached conceptualizing this, I was thinking far more within the centralized model of Chef, and leaning towards implementation of AWX/Tower. Once I worked through the table above, it was easy to see that we shouldn't need that model. With that in mind, we will need to structure this project and locate the corresponding CI pipelines/jobs in much the same way that we do for Chef or Terraform today (e.g. on the ops instance, with a mirror to .com). Thus we would need to look to the DR capabilities from the underlying GitLab instance hosting the project and its CI pipelines.\n\n### Other Outstanding Questions/Topics\n\nThere are a few aspects that I can still think of, which I haven't touched on too much, yet.\n\n#### \"Service-ness\"\n\nSo far, this is very squarely in the realm of implementing a tool, and a corresponding technology stack. As there is no central server, and it doesn't really have a well-defined \"interface\" for interacting with the tool beyond directly accessing the code and automations triggered/run via CI, I hesitate to push this through a standard production readiness review, but at the same time we should reference our template to ensure that we check all the boxes for the relevant bits that still apply (documentation, architecture diagrams, monitoring/logging/alerting, etc).\n\n#### Observability\n\nThis is an area where we have interesting challenges, and not much to compare against in our current system. With Ansible being an agent less system, much of the monitoring will likely need to be baked into the CI jobs, and handled via hooks to external services at runtime. There is no central server to collect and emit logs to a traditional logging infrastructure, and likewise the same with metrics.","state":"closed","created_at":"2021-01-06T20:15:58.989Z","updated_at":"2021-04-22T21:01:30.580Z","closed_at":"2021-03-05T22:30:25.688Z","closed_by":{"id":693144,"username":"craig","name":"Craig Barrett","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c8dfa1ca41754b9409068e5e42080cd2?s=80\u0026d=identicon","web_url":"https://gitlab.com/craig"},"labels":["ansible","chef","workflow-infra::Done"],"milestone":{"id":1808963,"iid":124,"group_id":1112072,"title":"Core-Infra Jan 31 - Feb 13","description":"","state":"closed","created_at":"2021-01-05T23:32:25.348Z","updated_at":"2021-03-04T21:07:05.795Z","due_date":"2021-02-13","start_date":"2021-01-31","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/124"},"assignees":[{"id":693144,"username":"craig","name":"Craig Barrett","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c8dfa1ca41754b9409068e5e42080cd2?s=80\u0026d=identicon","web_url":"https://gitlab.com/craig"}],"author":{"id":693144,"username":"craig","name":"Craig Barrett","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c8dfa1ca41754b9409068e5e42080cd2?s=80\u0026d=identicon","web_url":"https://gitlab.com/craig"},"type":"ISSUE","assignee":{"id":693144,"username":"craig","name":"Craig Barrett","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c8dfa1ca41754b9409068e5e42080cd2?s=80\u0026d=identicon","web_url":"https://gitlab.com/craig"},"user_notes_count":24,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12274","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":8,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12274","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12274/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12274/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12274","relative":"#12274","full":"gitlab-com/gl-infra/reliability#12274"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":392,"epic":{"id":175938,"iid":392,"title":"Replace Chef with Ansible","url":"/groups/gitlab-com/gl-infra/-/epics/392","group_id":1112072,"human_readable_end_date":"Sep 10, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":76834477,"iid":12273,"project_id":1304532,"title":"Verify that customers.gitlab.com has a working database backup","description":"It is unclear if customers.gitlab.com has a functional backup of the database.","state":"closed","created_at":"2021-01-06T19:27:47.914Z","updated_at":"2021-01-07T19:57:02.262Z","closed_at":"2021-01-07T19:57:02.202Z","closed_by":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"labels":["Service::CustomersDot","Unplanned","workflow-infra::Done"],"milestone":{"id":1722318,"iid":115,"group_id":1112072,"title":"Core-Infra Dec 27-Jan 9 '21 Unplanned items","description":"","state":"closed","created_at":"2020-11-12T21:13:14.237Z","updated_at":"2021-01-20T00:25:04.544Z","due_date":"2021-01-09","start_date":"2020-12-27","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/115"},"assignees":[{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"}],"author":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"type":"ISSUE","assignee":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"user_notes_count":6,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12273","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12273","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12273/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12273/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12273","relative":"#12273","full":"gitlab-com/gl-infra/reliability#12273"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":390,"epic":{"id":175744,"iid":390,"title":"Improve observability and logging of CustomersDot","url":"/groups/gitlab-com/gl-infra/-/epics/390","group_id":1112072,"human_readable_end_date":"Feb 20, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":76829474,"iid":12272,"project_id":1304532,"title":"Improve wal-g backup job alerting","description":"The wal-g backup job metrics caused bogus alerts, because the backup is running from a random node each time, which made the metrics look like there was no backup for several days on a single node, while we are only interested on one successful backup job per env each day.\n\nThis was tracked within this incident issue: https://gitlab.com/gitlab-com/gl-infra/production/-/issues/3263\n\nThe fixes:\n\n* https://gitlab.com/gitlab-com/runbooks/-/merge_requests/3088\n* https://ops.gitlab.net/gitlab-cookbooks/gitlab-walg/-/merge_requests/39\n* https://ops.gitlab.net/gitlab-cookbooks/chef-repo/-/merge_requests/4813\n* https://gitlab.com/gitlab-com/runbooks/-/merge_requests/3093\n\nAdding this issue for tracking in our milestone.\n\n## Acceptance criteria\n\n* [x] Do not cause \"wal-g backup delayed\" false alerts for single patroni nodes\n* [x] runbook doc for how to use central pushgateways for job metrics with environment focus","state":"closed","created_at":"2021-01-06T16:51:53.035Z","updated_at":"2021-01-08T10:56:33.620Z","closed_at":"2021-01-08T10:56:33.524Z","closed_by":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"labels":["workflow-infra::Done"],"milestone":{"id":1720647,"iid":112,"group_id":1112072,"title":"Datastores team - W53","description":"Datastores iteration for the last week of 2020.","state":"closed","created_at":"2020-11-11T23:16:43.676Z","updated_at":"2021-11-12T05:28:05.907Z","due_date":"2021-01-10","start_date":"2020-12-28","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/112"},"assignees":[{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"}],"author":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"type":"ISSUE","assignee":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"user_notes_count":0,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12272","time_stats":{"time_estimate":28800,"total_time_spent":0,"human_time_estimate":"8h","human_total_time_spent":null},"task_completion_status":{"count":2,"completed_count":2},"weight":8,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12272","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12272/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12272/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12272","relative":"#12272","full":"gitlab-com/gl-infra/reliability#12272"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":380,"epic":{"id":162885,"iid":380,"title":"WAL-G improvements","url":"/groups/gitlab-com/gl-infra/-/epics/380","group_id":1112072,"human_readable_end_date":"Jul 31, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":76824777,"iid":12270,"project_id":1304532,"title":"Migrate to the new Subscriptions Management Application production fleet","description":"This issue will most likely spawn a production change issue (or two).\n\n\n- Migrate data (database?)\n- Switch DNS","state":"closed","created_at":"2021-01-06T15:03:41.275Z","updated_at":"2022-08-04T12:34:29.801Z","closed_at":"2022-04-22T12:20:59.782Z","closed_by":{"id":273486,"username":"jameslopez","name":"James Lopez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/273486/avatar.png","web_url":"https://gitlab.com/jameslopez"},"labels":["Service::CustomersDot","team::Reliability","workflow-infra::Done"],"milestone":null,"assignees":[],"author":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"type":"ISSUE","assignee":null,"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12270","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":8,"blocking_issues_count":1,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12270","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12270/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12270/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12270","relative":"#12270","full":"gitlab-com/gl-infra/reliability#12270"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":390,"epic":{"id":175744,"iid":390,"title":"Improve observability and logging of CustomersDot","url":"/groups/gitlab-com/gl-infra/-/epics/390","group_id":1112072,"human_readable_end_date":"Feb 20, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":76824770,"iid":12269,"project_id":1304532,"title":"Create a new subscriptions-production Terraform environment","description":"","state":"closed","created_at":"2021-01-06T15:03:32.222Z","updated_at":"2022-08-04T12:34:30.509Z","closed_at":"2022-02-02T09:53:36.307Z","closed_by":{"id":210928,"username":"steveazz","name":"Steve Azzopardi","state":"active","avatar_url":"https://secure.gravatar.com/avatar/4a5eeed7ec5c80642df9ee708bb496d7?s=80\u0026d=identicon","web_url":"https://gitlab.com/steveazz"},"labels":["Service::CustomersDot","team::Reliability","terraform","workflow-infra::Done"],"milestone":null,"assignees":[],"author":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"type":"ISSUE","assignee":null,"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12269","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12269","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12269/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12269/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12269","relative":"#12269","full":"gitlab-com/gl-infra/reliability#12269"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":390,"epic":{"id":175744,"iid":390,"title":"Improve observability and logging of CustomersDot","url":"/groups/gitlab-com/gl-infra/-/epics/390","group_id":1112072,"human_readable_end_date":"Feb 20, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":76824761,"iid":12268,"project_id":1304532,"title":"Create a new Chef role for the new production fleet `prd-subscriptions`","description":"","state":"closed","created_at":"2021-01-06T15:03:17.877Z","updated_at":"2022-08-04T12:34:31.398Z","closed_at":"2022-01-06T09:51:31.981Z","closed_by":{"id":210928,"username":"steveazz","name":"Steve Azzopardi","state":"active","avatar_url":"https://secure.gravatar.com/avatar/4a5eeed7ec5c80642df9ee708bb496d7?s=80\u0026d=identicon","web_url":"https://gitlab.com/steveazz"},"labels":["Service::CustomersDot","chef","team::Reliability","workflow-infra::Done"],"milestone":null,"assignees":[],"author":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"type":"ISSUE","assignee":null,"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12268","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12268","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12268/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12268/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12268","relative":"#12268","full":"gitlab-com/gl-infra/reliability#12268"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":390,"epic":{"id":175744,"iid":390,"title":"Improve observability and logging of CustomersDot","url":"/groups/gitlab-com/gl-infra/-/epics/390","group_id":1112072,"human_readable_end_date":"Feb 20, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":76824754,"iid":12267,"project_id":1304532,"title":"Create a new Google Cloud Project for production `gitlab-subscriptions-production`","description":"","state":"closed","created_at":"2021-01-06T15:03:07.116Z","updated_at":"2022-08-04T12:34:31.911Z","closed_at":"2022-01-06T09:57:10.945Z","closed_by":{"id":210928,"username":"steveazz","name":"Steve Azzopardi","state":"active","avatar_url":"https://secure.gravatar.com/avatar/4a5eeed7ec5c80642df9ee708bb496d7?s=80\u0026d=identicon","web_url":"https://gitlab.com/steveazz"},"labels":["Service::CustomersDot","team::Reliability","terraform","workflow-infra::Done"],"milestone":null,"assignees":[],"author":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"type":"ISSUE","assignee":null,"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12267","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12267","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12267/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12267/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12267","relative":"#12267","full":"gitlab-com/gl-infra/reliability#12267"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":390,"epic":{"id":175744,"iid":390,"title":"Improve observability and logging of CustomersDot","url":"/groups/gitlab-com/gl-infra/-/epics/390","group_id":1112072,"human_readable_end_date":"Feb 20, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":76824713,"iid":12265,"project_id":1304532,"title":"Create a new deploy process in Ansible and Chef","description":"\n   - A new recipe in the customer cookbook that sets up the right credentials for Ansible\n   - A new project that mirrors the customers code base and performs staging deploys and production deploys from master","state":"closed","created_at":"2021-01-06T15:02:03.630Z","updated_at":"2022-08-04T12:34:32.522Z","closed_at":"2021-09-16T07:52:04.462Z","closed_by":{"id":273486,"username":"jameslopez","name":"James Lopez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/273486/avatar.png","web_url":"https://gitlab.com/jameslopez"},"labels":["Service::CustomersDot","team::Reliability","workflow-infra::Done"],"milestone":null,"assignees":[{"id":273486,"username":"jameslopez","name":"James Lopez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/273486/avatar.png","web_url":"https://gitlab.com/jameslopez"}],"author":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"type":"ISSUE","assignee":{"id":273486,"username":"jameslopez","name":"James Lopez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/273486/avatar.png","web_url":"https://gitlab.com/jameslopez"},"user_notes_count":3,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12265","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":1,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12265","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12265/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12265/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12265","relative":"#12265","full":"gitlab-com/gl-infra/reliability#12265"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":390,"epic":{"id":175744,"iid":390,"title":"Improve observability and logging of CustomersDot","url":"/groups/gitlab-com/gl-infra/-/epics/390","group_id":1112072,"human_readable_end_date":"Feb 20, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":76824698,"iid":12264,"project_id":1304532,"title":"Create a new subscriptions-staging Terraform environment","description":"   - TCP load balancer with health checks and a static IP\n   - Start with a single node to begin with\n   - Bastion host\n   - Restrict outgoing as well as incoming traffic","state":"closed","created_at":"2021-01-06T15:01:50.560Z","updated_at":"2021-02-08T21:17:51.446Z","closed_at":"2021-02-08T21:17:51.394Z","closed_by":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"labels":["Service::CustomersDot","terraform","workflow-infra::Done"],"milestone":null,"assignees":[{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"}],"author":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"type":"ISSUE","assignee":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12264","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12264","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12264/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12264/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12264","relative":"#12264","full":"gitlab-com/gl-infra/reliability#12264"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":390,"epic":{"id":175744,"iid":390,"title":"Improve observability and logging of CustomersDot","url":"/groups/gitlab-com/gl-infra/-/epics/390","group_id":1112072,"human_readable_end_date":"Feb 20, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":76824677,"iid":12263,"project_id":1304532,"title":"Create a new Chef role for the new staging fleet `stg-subscriptions`","description":"- Start this role as basic as possible\n- No customers cookbook to start with","state":"closed","created_at":"2021-01-06T15:00:54.506Z","updated_at":"2021-01-11T21:10:57.099Z","closed_at":"2021-01-11T21:10:57.053Z","closed_by":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"labels":["Service::CustomersDot","chef","workflow-infra::Done"],"milestone":null,"assignees":[{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"}],"author":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"type":"ISSUE","assignee":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12263","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":1,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12263","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12263/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12263/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12263","relative":"#12263","full":"gitlab-com/gl-infra/reliability#12263"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":390,"epic":{"id":175744,"iid":390,"title":"Improve observability and logging of CustomersDot","url":"/groups/gitlab-com/gl-infra/-/epics/390","group_id":1112072,"human_readable_end_date":"Feb 20, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":76824670,"iid":12262,"project_id":1304532,"title":"Create a new Google Cloud Project for staging `gitlab-subscriptions-staging`","description":"A new project for the subscriptions management app should be created. The intent of having this in its own project is to build a stronger security barrier between other environments and the Customers infrastructure.\n\nConsider using this module to manage the new project: https://ops.gitlab.net/gitlab-com/gl-infra/terraform-modules/google/project","state":"closed","created_at":"2021-01-06T15:00:37.347Z","updated_at":"2021-01-11T21:11:34.632Z","closed_at":"2021-01-11T20:27:25.430Z","closed_by":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"labels":["Service::CustomersDot","terraform","workflow-infra::Done"],"milestone":{"id":1682692,"iid":108,"group_id":1112072,"title":"Core-Infra Subscription app improvements","description":"What are we doing?\r\n\r\nOne month focused work on improving customers.gitlab.com \r\n\r\n**Work is in corresponding [Improvements to Subscriptions Management app Epic](https://gitlab.com/groups/gitlab-com/gl-infra/-/epics/334)**\r\n","state":"closed","created_at":"2020-10-19T17:32:45.772Z","updated_at":"2021-11-12T05:28:01.858Z","due_date":"2020-12-31","start_date":"2020-11-20","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/108"},"assignees":[{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"}],"author":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"type":"ISSUE","assignee":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12262","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":1,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12262","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12262/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12262/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12262","relative":"#12262","full":"gitlab-com/gl-infra/reliability#12262"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":390,"epic":{"id":175744,"iid":390,"title":"Improve observability and logging of CustomersDot","url":"/groups/gitlab-com/gl-infra/-/epics/390","group_id":1112072,"human_readable_end_date":"Feb 20, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":76795255,"iid":12256,"project_id":1304532,"title":"Set up slack integration for access request workflow","description":"Using the instructions from Gravitational, we need to install the Teleport Slack application: https://goteleport.com/teleport/docs/enterprise/workflow/ssh-approval-slack/\n\nThis app will relay access requests into the `#production-access` channel in Slack, and authorized users will be able to review and approve them.\n\nCurrently we are at the proof of concept stage, so this is still considered development, but there should be minimal changes to get this into production when we are ready.","state":"closed","created_at":"2021-01-06T01:23:42.187Z","updated_at":"2021-08-10T16:38:50.372Z","closed_at":"2021-08-10T16:38:17.419Z","closed_by":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"labels":["team::Reliability","workflow-infra::Done"],"milestone":{"id":1994752,"iid":136,"group_id":1112072,"title":"Core-Infra FY22Q2 Items","description":"This milestone is a bucket to make sure we can see things on our board:\r\n\r\n[https://gitlab.com/groups/gitlab-com/gl-infra/-/boards/1688496?\u0026label_name\\[\\]=team%3A%3ACore-Infra](https://gitlab.com/groups/gitlab-com/gl-infra/-/boards/1688496?\u0026label_name%5B%5D=team%3A%3ACore-Infra)","state":"closed","created_at":"2021-04-13T15:13:04.655Z","updated_at":"2021-11-12T05:29:30.642Z","due_date":"2021-07-31","start_date":"2021-05-01","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/136"},"assignees":[{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"}],"author":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"type":"ISSUE","assignee":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"user_notes_count":16,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12256","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12256","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12256/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12256/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12256","relative":"#12256","full":"gitlab-com/gl-infra/reliability#12256"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":350,"epic":{"id":133459,"iid":350,"title":"Project: Rails Console Access","url":"/groups/gitlab-com/gl-infra/-/epics/350","group_id":1112072,"human_readable_end_date":"Jul 31, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":76531461,"iid":12221,"project_id":1304532,"title":"current Gitlab org Dockerhub plan expires Jan 31 2021","description":"\u003c!--\nThis template is for GitLab Team Members seeking support of SRE where there isn't an existing `request-*` template available.\n\nPlease fill out the details below.\n--\u003e\n\nFrom Docker:\n\n[Docker Team](https://email.docker.com/Ao6m0tFJ30IT3Po00K0x14L) plans start at $7 per user per month and provide access to advanced features and capabilities to help your team automate development workflows and increase productivity, including:\nUnlimited private and public repositories\nUnlimited authenticated image pulls\n3 Parallel auto-builds\nRole-based access controls\nUnlimited teams\nUnlimited Hub image vulnerability scans\nAnd [much more](https://email.docker.com/Ao6m0tFJ30IT3Po00K0x14L)\n\nYou are receiving this email because your legacy organizational repository plan expires on your January 2021 billing cycle date. [Read the FAQ.](https://email.docker.com/y3oF4oPI0T0KLJy1tn00630)\n\n\ncc @marin @erushton as I think this is legacy things we are still using dockerhub for.\n\nI also see @ddavison, @tmaczukin and @twk3, @dzaporozhets as owners so cc in case they have further input on what we should do with this organization.\n\n\n\u003c!--\nplease do not edit the below\n--\u003e","state":"closed","created_at":"2020-12-28T17:14:33.692Z","updated_at":"2023-03-15T15:43:27.687Z","closed_at":"2021-01-22T15:43:18.777Z","closed_by":{"id":2222520,"username":"dawsmith","name":"Dave Smith","state":"active","avatar_url":"https://secure.gravatar.com/avatar/ef341e061f6b86461626e64c5fbcfe52?s=80\u0026d=identicon","web_url":"https://gitlab.com/dawsmith"},"labels":["AssistType::CloudInfra","AssistingTeam::Infrastructure","Unplanned","workflow-infra::Done"],"milestone":{"id":1753312,"iid":118,"group_id":1112072,"title":"Core-Infra Jan 10 - Jan 23 Unplanned items","description":"","state":"closed","created_at":"2020-12-02T20:19:38.933Z","updated_at":"2021-01-27T20:14:53.967Z","due_date":"2021-01-23","start_date":"2021-01-10","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/118"},"assignees":[{"id":2222520,"username":"dawsmith","name":"Dave Smith","state":"active","avatar_url":"https://secure.gravatar.com/avatar/ef341e061f6b86461626e64c5fbcfe52?s=80\u0026d=identicon","web_url":"https://gitlab.com/dawsmith"},{"id":4437855,"username":"brentnewton","name":"Brent Newton","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4437855/avatar.png","web_url":"https://gitlab.com/brentnewton"},{"id":5709244,"username":"albertoramos","name":"Alberto Ramos","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5709244/avatar.png","web_url":"https://gitlab.com/albertoramos"}],"author":{"id":2222520,"username":"dawsmith","name":"Dave Smith","state":"active","avatar_url":"https://secure.gravatar.com/avatar/ef341e061f6b86461626e64c5fbcfe52?s=80\u0026d=identicon","web_url":"https://gitlab.com/dawsmith"},"type":"ISSUE","assignee":{"id":2222520,"username":"dawsmith","name":"Dave Smith","state":"active","avatar_url":"https://secure.gravatar.com/avatar/ef341e061f6b86461626e64c5fbcfe52?s=80\u0026d=identicon","web_url":"https://gitlab.com/dawsmith"},"user_notes_count":9,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2021-01-20","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12221","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12221","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12221/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12221/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12221","relative":"#12221","full":"gitlab-com/gl-infra/reliability#12221"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":76476214,"iid":12217,"project_id":1304532,"title":"Adjust SLO calculation for apples to apples time window comparisons","description":"Because of https://gitlab.com/gitlab-com/gl-infra/production/-/issues/3238 I'm proposing adjusting the SLO calculations to compare similar time windows for errors and requests.  Otherwise, we wind up seeing alerts for underlying omni-present errors when RPS is reduced.","state":"closed","created_at":"2020-12-25T22:45:38.749Z","updated_at":"2022-08-04T12:34:59.160Z","closed_at":"2021-01-06T18:24:39.867Z","closed_by":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"labels":["workflow-infra::Done"],"milestone":null,"assignees":[],"author":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"type":"ISSUE","assignee":null,"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12217","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12217","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12217/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12217/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12217","relative":"#12217","full":"gitlab-com/gl-infra/reliability#12217"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":76196529,"iid":12191,"project_id":1304532,"title":"GitLab Hosted version of Codesandbox Sandpack Fork","description":"### Overview\n\nAs part of https://gitlab.com/groups/gitlab-org/-/epics/3138#note_465738194 we needed to make some upstream contributions to the [Codesandbox Sandpack package `smooshpack`](https://www.npmjs.com/package/smooshpack). Unfortunately, it might take a while for these changes to land in the upstream package due to upstream availability.\n\nAfter [receiving approval to fork this package](https://gitlab.com/gitlab-com/legal-and-compliance/-/issues/308), we've applied these changes to a [GitLab project](https://gitlab.com/pslaughter/gitlab-codesandbox-client) and [published a new npm package `gitlab-smooshpack`](https://www.npmjs.com/package/gitlab-smooshpack).\n\nFor us to [use this behind a feature flag](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/50259#note_468978603), we need to have our GitLab forked package assets hosted in a separate bucket. Currently the Codesandbox package assets are hosted at `https://sandbox-prod.gitlab-static.net/`.\n\n### Proposal\n\nSimilar to the [steps used for the original package](https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/6709#note_259020854), here's how to get the specific assets we need to host:\n\n```\n# Download the package tarball\nwget $(npm view gitlab-smooshpack@0.0.66-1 dist.tarball)\n\n# Extract just the `sandpack` folder which contains the pre-built assets\ntar -xzf gitlab-smooshpack-0.0.66-1.tgz package/sandpack\n\n# The assets to host will be in `./package/sandpack`\n```\n\nThen drop all the files in `./package/sandpack` in a asset hosting bucket. Requirements:\n\n* Suggested domain: `https://gl-sandbox-prod.gitlab-static.net/`\n* SSL Enabled\n\n### Links / References\n\n- https://gitlab.com/groups/gitlab-org/-/epics/3138\n- Legal issue for forking https://gitlab.com/gitlab-com/legal-and-compliance/-/issues/308","state":"closed","created_at":"2020-12-17T16:03:15.996Z","updated_at":"2023-01-24T22:01:48.746Z","closed_at":"2023-01-24T21:27:30.782Z","closed_by":{"id":5212466,"username":"ericschurter","name":"Eric Schurter","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5212466/avatar.png","web_url":"https://gitlab.com/ericschurter"},"labels":["AssistType::CloudInfra","AssistingTeam::Development","Reliability::P4","Unplanned","auto updated","group::editor","team::Reliability","workflow-infra::Done"],"milestone":null,"assignees":[{"id":2222520,"username":"dawsmith","name":"Dave Smith","state":"active","avatar_url":"https://secure.gravatar.com/avatar/ef341e061f6b86461626e64c5fbcfe52?s=80\u0026d=identicon","web_url":"https://gitlab.com/dawsmith"},{"id":4437855,"username":"brentnewton","name":"Brent Newton","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4437855/avatar.png","web_url":"https://gitlab.com/brentnewton"},{"id":5709244,"username":"albertoramos","name":"Alberto Ramos","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5709244/avatar.png","web_url":"https://gitlab.com/albertoramos"}],"author":{"id":2233420,"username":"pslaughter","name":"Paul Slaughter","state":"active","avatar_url":"https://secure.gravatar.com/avatar/631b25421eb206ab44cb2793ef09d881?s=80\u0026d=identicon","web_url":"https://gitlab.com/pslaughter"},"type":"ISSUE","assignee":{"id":2222520,"username":"dawsmith","name":"Dave Smith","state":"active","avatar_url":"https://secure.gravatar.com/avatar/ef341e061f6b86461626e64c5fbcfe52?s=80\u0026d=identicon","web_url":"https://gitlab.com/dawsmith"},"user_notes_count":27,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12191","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12191","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12191/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12191/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12191","relative":"#12191","full":"gitlab-com/gl-infra/reliability#12191"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":76158340,"iid":12184,"project_id":1304532,"title":"Export Version and License DB for Import into Data Warehouse","description":"runbook: https://gitlab.com/gitlab-com/runbooks/-/blob/master/docs/uncategorized/cloudsql-data-export.md\n\nthis is hopefully one of the very last times","state":"closed","created_at":"2020-12-16T22:07:39.290Z","updated_at":"2021-01-04T20:06:38.472Z","closed_at":"2020-12-17T22:59:30.618Z","closed_by":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"labels":["AssistType::CloudInfra","AssistingTeam::Data","Core-Infra::P4","Service::Version","Unplanned","toil","workflow-infra::Done"],"milestone":{"id":1722315,"iid":114,"group_id":1112072,"title":"Core-Infra December 13-26 Unplanned items","description":"","state":"closed","created_at":"2020-11-12T21:12:02.923Z","updated_at":"2020-12-29T17:17:18.846Z","due_date":"2020-12-26","start_date":"2020-12-13","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/114"},"assignees":[{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"}],"author":{"id":5212782,"username":"m_walker","name":"Michael Walker","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5212782/avatar.png","web_url":"https://gitlab.com/m_walker"},"type":"ISSUE","assignee":{"id":2336046,"username":"devin","name":"Devin Sylva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/424b025122218e9a586245e301c1c725?s=80\u0026d=identicon","web_url":"https://gitlab.com/devin"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12184","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12184","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12184/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12184/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12184","relative":"#12184","full":"gitlab-com/gl-infra/reliability#12184"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":76148299,"iid":12179,"project_id":1304532,"title":"Geo secondary in staging is not sending out emails","description":"After promoting the geo secondary node in staging we ran some tests that should have triggered sending out some emails but no emails have been received. We should check the email configuration of the geo node and fix and document the necessary settings.","state":"closed","created_at":"2020-12-16T16:29:29.168Z","updated_at":"2021-01-18T15:17:21.450Z","closed_at":"2021-01-18T15:17:21.289Z","closed_by":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"labels":["Service::Geo","wg-disaster-recovery","workflow-infra::Done"],"milestone":{"id":1739582,"iid":116,"group_id":1112072,"title":"Datastores team - W02","description":"Datastores iteration for the second/third weeks of 2021.","state":"closed","created_at":"2020-11-24T09:38:22.429Z","updated_at":"2021-11-12T05:28:12.161Z","due_date":"2021-01-24","start_date":"2021-01-11","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/116"},"assignees":[{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"}],"author":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"type":"ISSUE","assignee":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"user_notes_count":7,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12179","time_stats":{"time_estimate":14400,"total_time_spent":0,"human_time_estimate":"4h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12179","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12179/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12179/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12179","relative":"#12179","full":"gitlab-com/gl-infra/reliability#12179"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":371,"epic":{"id":159463,"iid":371,"title":"Evaluate Geo as a disaster recovery solution for GitLab.com","url":"/groups/gitlab-com/gl-infra/-/epics/371","group_id":1112072,"human_readable_end_date":"Feb 21, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":76148097,"iid":12178,"project_id":1304532,"title":"Check google auth config for geo in staging","description":"During the staging failover test, after promotion of the secondary, Skarbek wasn't able to log into the geo node, upon using Google auth: `Error 400: redirect_uri_mismatch`.\n\nWe need to check the google auth settings and make sure that Google auth is working after a failover.","state":"closed","created_at":"2020-12-16T16:25:50.589Z","updated_at":"2021-01-18T15:23:36.813Z","closed_at":"2021-01-18T15:23:36.694Z","closed_by":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"labels":["Service::Geo","wg-disaster-recovery","workflow-infra::Done"],"milestone":{"id":1739582,"iid":116,"group_id":1112072,"title":"Datastores team - W02","description":"Datastores iteration for the second/third weeks of 2021.","state":"closed","created_at":"2020-11-24T09:38:22.429Z","updated_at":"2021-11-12T05:28:12.161Z","due_date":"2021-01-24","start_date":"2021-01-11","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/116"},"assignees":[{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"}],"author":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"type":"ISSUE","assignee":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"user_notes_count":7,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12178","time_stats":{"time_estimate":10800,"total_time_spent":0,"human_time_estimate":"3h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12178","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12178/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12178/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12178","relative":"#12178","full":"gitlab-com/gl-infra/reliability#12178"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":371,"epic":{"id":159463,"iid":371,"title":"Evaluate Geo as a disaster recovery solution for GitLab.com","url":"/groups/gitlab-com/gl-infra/-/epics/371","group_id":1112072,"human_readable_end_date":"Feb 21, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":76147615,"iid":12177,"project_id":1304532,"title":"Make sure pg_hba.conf is working for geo failover","description":"During staging geo failover test, the last step of Promotion failed (geo:set_secondary_as_primary) attempting to authenticate with postgres:\n\n```\n2020-11-27_13:18:12.31820       Connection matched pg_hba.conf line 77: \"host    all         all         0.0.0.0/0           md5\"\n2020-11-27_13:18:12.57502 2020-11-27 13:18:12 GMT [32557]: [1-1] FATAL:  password authentication failed for user \"gitlab\"\n2020-11-27_13:18:12.57504 2020-11-27 13:18:12 GMT [32557]: [2-1] DETAIL:  Password does not match for user \"gitlab\".\n```\n\nIt was temporarily fixed by adding\n\n```\nhost    all         all         0.0.0.0/0           trust\n```\n\nabove line 77 (which is mentioned in the error above) to `/var/opt/gitlab/postgresql/data/pg_hba.conf` and doing a `gitlab-ctl restart postgresql`, but this is getting overridden every time when doing a `gitlab-ctl reconfigure`.\n\nWe need to fix pg_hba.conf to work on both primary and secondary site for a failover or maybe need to change the DB password for the gitlab role.","state":"closed","created_at":"2020-12-16T16:13:04.740Z","updated_at":"2021-02-04T16:39:38.128Z","closed_at":"2021-02-04T16:39:37.957Z","closed_by":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"labels":["Service::Geo","group::geo","wg-disaster-recovery","workflow-infra::Done"],"milestone":{"id":1762254,"iid":120,"group_id":1112072,"title":"Datastores team - W04","description":"Second milestone of 2021 for the Datastores team.","state":"closed","created_at":"2020-12-08T10:32:48.902Z","updated_at":"2021-11-12T05:28:23.744Z","due_date":"2021-02-07","start_date":"2021-01-25","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/120"},"assignees":[{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"}],"author":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"type":"ISSUE","assignee":{"id":2524675,"username":"skarbek","name":"John Skarbek","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c6455ce4726023aac6dd7fb0acd1f236?s=80\u0026d=identicon","web_url":"https://gitlab.com/skarbek"},"user_notes_count":27,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12177","time_stats":{"time_estimate":14400,"total_time_spent":0,"human_time_estimate":"4h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12177","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12177/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12177/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12177","relative":"#12177","full":"gitlab-com/gl-infra/reliability#12177"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":371,"epic":{"id":159463,"iid":371,"title":"Evaluate Geo as a disaster recovery solution for GitLab.com","url":"/groups/gitlab-com/gl-infra/-/epics/371","group_id":1112072,"human_readable_end_date":"Feb 21, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":76099203,"iid":12153,"project_id":1304532,"title":"Ensure Accurate Domain Contacts at Gandi","description":"I've been working with some domains in Gandi recently and noticed that some of our contacts are old (people who are no longer here for instance). We should go through and ensure they're all accurate.","state":"closed","created_at":"2020-12-15T17:53:15.372Z","updated_at":"2020-12-16T21:59:22.460Z","closed_at":"2020-12-15T18:51:16.627Z","closed_by":{"id":429540,"username":"ahanselka","name":"Alex Hanselka","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/429540/avatar.png","web_url":"https://gitlab.com/ahanselka"},"labels":["workflow-infra::Done"],"milestone":{"id":1722315,"iid":114,"group_id":1112072,"title":"Core-Infra December 13-26 Unplanned items","description":"","state":"closed","created_at":"2020-11-12T21:12:02.923Z","updated_at":"2020-12-29T17:17:18.846Z","due_date":"2020-12-26","start_date":"2020-12-13","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/114"},"assignees":[{"id":429540,"username":"ahanselka","name":"Alex Hanselka","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/429540/avatar.png","web_url":"https://gitlab.com/ahanselka"}],"author":{"id":429540,"username":"ahanselka","name":"Alex Hanselka","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/429540/avatar.png","web_url":"https://gitlab.com/ahanselka"},"type":"ISSUE","assignee":{"id":429540,"username":"ahanselka","name":"Alex Hanselka","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/429540/avatar.png","web_url":"https://gitlab.com/ahanselka"},"user_notes_count":3,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12153","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12153","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12153/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12153/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12153","relative":"#12153","full":"gitlab-com/gl-infra/reliability#12153"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":75967749,"iid":12135,"project_id":1304532,"title":"License app data export credentials configuration","description":"(this issue description is based on [another similar issue's](https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/10670))\n\nRequest related to this issue: https://gitlab.com/gitlab-org/license-gitlab-com/-/issues/191\n\nFor automating export of the several tables for the `license-gitlab-com` project, we have a \"pipeline Schedule\" which needs several configuration parameters to be able to run properly.\n\n- Configuration screen: https://gitlab.com/gitlab-org/license-gitlab-com/-/pipeline_schedules/85641/edit\n\n## Credentials\n\n| Variable | Value |\n| ------ | ------ |\n| GCLOUD_SERVICE_KEY | GCP [service account](https://console.cloud.google.com/iam-admin/serviceaccounts) auth JSON file name |\n| GOOGLE_PROJECT_ID |  GCP project id ( API [sqladmin.googleapis.com] not enabled on project) ) |\n| GOOGLE_COMPUTE_ZONE | The region and zone for the GCP compute |\n| BUCKET | The GCS bucket where we shall upload the SQL export |\n| INSTANCE | Cloud SQL instance name |\n| DATABASE | Cloud SQL database name |","state":"closed","created_at":"2020-12-11T16:14:55.941Z","updated_at":"2021-06-24T08:09:35.904Z","closed_at":"2021-02-02T14:29:02.009Z","closed_by":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"labels":["AssistType::GitLabAdmin","AssistingTeam::Growth\u0026Fullfillment","Service::License","Unplanned","workflow-infra::Done"],"milestone":{"id":1808963,"iid":124,"group_id":1112072,"title":"Core-Infra Jan 31 - Feb 13","description":"","state":"closed","created_at":"2021-01-05T23:32:25.348Z","updated_at":"2021-03-04T21:07:05.795Z","due_date":"2021-02-13","start_date":"2021-01-31","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/124"},"assignees":[{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"}],"author":{"id":4192493,"username":"ebaque","name":"Etienne Baqué","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4192493/avatar.png","web_url":"https://gitlab.com/ebaque"},"type":"ISSUE","assignee":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"user_notes_count":26,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2021-01-07","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12135","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12135","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12135/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12135/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12135","relative":"#12135","full":"gitlab-com/gl-infra/reliability#12135"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":75826476,"iid":12108,"project_id":1304532,"title":"Fix these multiple wal-g backup-push failures","description":"Tonight we had GCS failures very often which showed multiple problems with wal-g backup-push (3 gprd backup runs failed tonight). Reminder: We have `GCS_CONTEXT_TIMEOUT` set to 600s currently, to make wal-push not block for too long on errors.\n\n### backup fails when missing to cleanup composite parts\n\nApparently GCS failed just at the moment when uploading and composing part 3179 was done, and wal-g tried to delete the composite parts.\n\n```\n\u003c13\u003eDec  9 00:00:01 backup.sh: INFO: 2020/12/09 02:04:56.856506 Finished writing part 3179.\n\u003c13\u003eDec  9 00:00:01 backup.sh: INFO: 2020/12/09 02:04:56.856548 Starting part 3187 ...\n\u003c13\u003eDec  9 00:00:01 backup.sh: INFO: 2020/12/09 02:04:57.665167 Finished writing part 3180.\n\u003c13\u003eDec  9 00:00:01 backup.sh: INFO: 2020/12/09 02:04:58.793366 Starting part 3188 ...\n\u003c13\u003eDec  9 00:00:01 backup.sh: INFO: 2020/12/09 02:05:03.142654 Finished writing part 3181.\n\u003c13\u003eDec  9 00:00:01 backup.sh: ERROR: 2020/12/09 02:05:09.417098 Failed to run a retriable func. Err: storage: object doesn't exist, retrying attempt 0\n\u003c13\u003eDec  9 00:00:01 backup.sh: ERROR: 2020/12/09 02:05:09.431631 Failed to run a retriable func. Err: storage: object doesn't exist, retrying attempt 1\n\u003c13\u003eDec  9 00:00:01 backup.sh: ERROR: 2020/12/09 02:05:09.612694 Failed to run a retriable func. Err: storage: object doesn't exist, retrying attempt 2\n\u003c13\u003eDec  9 00:00:01 backup.sh: ERROR: 2020/12/09 02:05:09.999934 Failed to run a retriable func. Err: storage: object doesn't exist, retrying attempt 3\n\u003c13\u003eDec  9 00:00:01 backup.sh: ERROR: 2020/12/09 02:05:10.667517 Failed to run a retriable func. Err: storage: object doesn't exist, retrying attempt 4\n\u003c13\u003eDec  9 00:00:01 backup.sh: ERROR: 2020/12/09 02:05:12.002879 Failed to run a retriable func. Err: storage: object doesn't exist, retrying attempt 5\n\u003c13\u003eDec  9 00:00:01 backup.sh: ERROR: 2020/12/09 02:05:15.451436 Failed to run a retriable func. Err: storage: object doesn't exist, retrying attempt 6\n\u003c13\u003eDec  9 00:00:01 backup.sh: ERROR: 2020/12/09 02:05:20.455462 Failed to run a retriable func. Err: storage: object doesn't exist, retrying attempt 7\n\u003c13\u003eDec  9 00:00:01 backup.sh: ERROR: 2020/12/09 02:05:30.321180 Failed to run a retriable func. Err: storage: object doesn't exist, retrying attempt 8\n\u003c13\u003eDec  9 00:00:01 backup.sh: ERROR: 2020/12/09 02:05:52.629282 Failed to run a retriable func. Err: storage: object doesn't exist, retrying attempt 9\n\u003c13\u003eDec  9 00:00:01 backup.sh: ERROR: 2020/12/09 02:06:44.111167 Failed to run a retriable func. Err: storage: object doesn't exist, retrying attempt 10\n\u003c13\u003eDec  9 00:00:01 backup.sh: ERROR: 2020/12/09 02:08:46.191842 Failed to run a retriable func. Err: storage: object doesn't exist, retrying attempt 11\n\u003c13\u003eDec  9 00:00:01 backup.sh: ERROR: 2020/12/09 02:12:35.924007 Failed to run a retriable func. Err: storage: object doesn't exist, retrying attempt 12\n\u003c13\u003eDec  9 00:00:01 backup.sh: ERROR: 2020/12/09 02:14:29.377187 GCS error : Unable to delete temporary chunks: GCS error : Unable to delete a temporary chunk: context deadline exceeded\n\u003c13\u003eDec  9 00:00:01 backup.sh: ERROR: 2020/12/09 02:14:29.377220 upload: could not upload 'base_000000040003836F000000A5/tar_partitions/part_3179.tar.br'\n\u003c13\u003eDec  9 00:00:01 backup.sh: ERROR: 2020/12/09 02:14:29.377225 GCS error : Unable to delete temporary chunks: GCS error : Unable to delete a temporary chunk: context deadline exceeded\n\u003c13\u003eDec  9 00:00:01 backup.sh: ERROR: 2020/12/09 02:14:29.377288 Unable to continue the backup process because of the loss of a part 3179.\n```\n\nI think wal-g managed to delete chunks 0-4, then GCS maybe returned a failure for deleting chunk 5 but chunk 5 actually was deleted, and then wal-g re-tried to delete chunk 5 - always getting `object doesn't exist` - until the deadline kicked in. And this made the whole backup fail.\n\nI checked and part 3179 actually is there and also the chunks that couldn't be deleted:\n\n```\nHenris-MBP:~ hphilipps$ gsutil ls -l gs://gitlab-gprd-postgres-backup/pitr-walg-pg11/basebackups_005/base_000000040003836F000000A5/tar_partitions/part_3179.tar.br\n 436441173  2020-12-09T02:04:57Z  gs://gitlab-gprd-postgres-backup/pitr-walg-pg11/basebackups_005/base_000000040003836F000000A5/tar_partitions/part_3179.tar.br\nTOTAL: 1 objects, 436441173 bytes (416.22 MiB)\nHenris-MBP:~ hphilipps$ gsutil ls -l gs://gitlab-gprd-postgres-backup/pitr-walg-pg11/basebackups_005/base_000000040003836F000000A5/tar_partitions/part_3179.tar.br_chunks/\n  52428800  2020-12-09T02:04:52Z  gs://gitlab-gprd-postgres-backup/pitr-walg-pg11/basebackups_005/base_000000040003836F000000A5/tar_partitions/part_3179.tar.br_chunks/chunk6\n  52428800  2020-12-09T02:04:56Z  gs://gitlab-gprd-postgres-backup/pitr-walg-pg11/basebackups_005/base_000000040003836F000000A5/tar_partitions/part_3179.tar.br_chunks/chunk7\n  17010773  2020-12-09T02:04:57Z  gs://gitlab-gprd-postgres-backup/pitr-walg-pg11/basebackups_005/base_000000040003836F000000A5/tar_partitions/part_3179.tar.br_chunks/chunk8\nTOTAL: 3 objects, 121868373 bytes (116.22 MiB)\n```\n\n**Suggestion:**\n\n* When cleaning up, we should not fail on `object doesn't exist` errors - just print a warning\n* Failing to cleaning up chunks shouldn't be a fatal error stopping the whole backup\n\n### Backup fails because of serious GCS outage and short GCS context timeout\n\nThe backup was restarted by the EOC, but then failed on multiple parts at the same time - GCS must have had serious problems. Maybe with more than 10m context timeout we would have been able to retry long enough to survive this. So this isn't a fault of wal-g in this case:\n\n```\n\u003c13\u003eDec  9 02:39:12 backup.sh: INFO: 2020/12/09 04:32:43.855286 Starting part 2828 ...\n\u003c13\u003eDec  9 02:39:12 backup.sh: WARNING: 2020/12/09 04:34:42.924392 Unable to copy an object chunk base_000000040003838C000000F8/tar_partitions/part_2826.tar.br_chunks/chunk1, part 1, err:\ngoogleapi: got HTTP response code 503 with body:\n\u003c13\u003eDec  9 02:39:12 backup.sh: WARNING: 2020/12/09 04:34:42.924426 Unable to close object writer base_000000040003838C000000F8/tar_partitions/part_2826.tar.br_chunks/chunk1, part 1, err: g\noogleapi: got HTTP response code 503 with body:\n\u003c13\u003eDec  9 02:39:12 backup.sh: ERROR: 2020/12/09 04:34:42.924432 Failed to run a retriable func. Err: googleapi: got HTTP response code 503 with body: , retrying attempt 0\n\u003c13\u003eDec  9 02:39:12 backup.sh: INFO: 2020/12/09 04:35:56.501148 Finished writing part 2820.\n\u003c13\u003eDec  9 02:39:12 backup.sh: INFO: 2020/12/09 04:35:56.501253 Starting part 2829 ...\n\u003c13\u003eDec  9 02:39:12 backup.sh: INFO: 2020/12/09 04:35:59.029180 Finished writing part 2822.\n\u003c13\u003eDec  9 02:39:12 backup.sh: INFO: 2020/12/09 04:35:59.029211 Starting part 2830 ...\n\u003c13\u003eDec  9 02:39:12 backup.sh: INFO: 2020/12/09 04:37:00.796524 Finished writing part 2824.\n\u003c13\u003eDec  9 02:39:12 backup.sh: INFO: 2020/12/09 04:37:00.796608 Starting part 2831 ...\n\u003c13\u003eDec  9 02:39:12 backup.sh: INFO: 2020/12/09 04:37:04.137069 Finished writing part 2823.\n\u003c13\u003eDec  9 02:39:12 backup.sh: INFO: 2020/12/09 04:37:04.137107 Starting part 2832 ...\n\u003c13\u003eDec  9 02:39:12 backup.sh: WARNING: 2020/12/09 04:39:54.072958 Unable to copy an object chunk base_000000040003838C000000F8/tar_partitions/part_2828.tar.br_chunks/chunk3, part 3, err: googleapi: got HTTP response code 503 with body:\n\u003c13\u003eDec  9 02:39:12 backup.sh: WARNING: 2020/12/09 04:39:54.073007 Unable to close object writer base_000000040003838C000000F8/tar_partitions/part_2828.tar.br_chunks/chunk3, part 3, err: googleapi: got HTTP response code 503 with body:\n\u003c13\u003eDec  9 02:39:12 backup.sh: ERROR: 2020/12/09 04:39:54.073010 Failed to run a retriable func. Err: googleapi: got HTTP response code 503 with body: , retrying attempt 0\n\u003c13\u003eDec  9 02:39:12 backup.sh: WARNING: 2020/12/09 04:40:44.952144 Unable to copy an object chunk base_000000040003838C000000F8/tar_partitions/part_2830.tar.br_chunks/chunk2, part 2, err: googleapi: got HTTP response code 503 with body:\n\u003c13\u003eDec  9 02:39:12 backup.sh: WARNING: 2020/12/09 04:40:44.952176 Unable to close object writer base_000000040003838C000000F8/tar_partitions/part_2830.tar.br_chunks/chunk2, part 2, err: googleapi: got HTTP response code 503 with body:\n\u003c13\u003eDec  9 02:39:12 backup.sh: ERROR: 2020/12/09 04:40:44.952185 Failed to run a retriable func. Err: googleapi: got HTTP response code 503 with body: , retrying attempt 0\n\u003c13\u003eDec  9 02:39:12 backup.sh: WARNING: 2020/12/09 04:40:54.395088 Unable to copy an object chunk base_000000040003838C000000F8/tar_partitions/part_2829.tar.br_chunks/chunk2, part 2, err: googleapi: got HTTP response code 503 with body:\n\u003c13\u003eDec  9 02:39:12 backup.sh: WARNING: 2020/12/09 04:40:54.395122 Unable to close object writer base_000000040003838C000000F8/tar_partitions/part_2829.tar.br_chunks/chunk2, part 2, err: googleapi: got HTTP response code 503 with body:\n\u003c13\u003eDec  9 02:39:12 backup.sh: ERROR: 2020/12/09 04:40:54.395128 Failed to run a retriable func. Err: googleapi: got HTTP response code 503 with body: , retrying attempt 0\n\u003c13\u003eDec  9 02:39:12 backup.sh: WARNING: 2020/12/09 04:41:14.960228 Unable to copy an object chunk base_000000040003838C000000F8/tar_partitions/part_2832.tar.br_chunks/chunk1, part 1, err: googleapi: got HTTP response code 503 with body:\n\u003c13\u003eDec  9 02:39:12 backup.sh: WARNING: 2020/12/09 04:41:14.960264 Unable to close object writer base_000000040003838C000000F8/tar_partitions/part_2832.tar.br_chunks/chunk1, part 1, err: googleapi: got HTTP response code 503 with body:\n\u003c13\u003eDec  9 02:39:12 backup.sh: ERROR: 2020/12/09 04:41:14.960268 Failed to run a retriable func. Err: googleapi: got HTTP response code 503 with body: , retrying attempt 0\n\u003c13\u003eDec  9 02:39:12 backup.sh: INFO: 2020/12/09 04:42:12.277519 Finished writing part 2825.\n\u003c13\u003eDec  9 02:39:12 backup.sh: INFO: 2020/12/09 04:42:12.277555 Starting part 2833 ...\n\u003c13\u003eDec  9 02:39:12 backup.sh: WARNING: 2020/12/09 04:42:37.292358 Unable to close object writer base_000000040003838C000000F8/tar_partitions/part_2825.tar.br_chunks/chunk6, part 6, err: Post https://storage.googleapis.com/upload/storage/v1/b/gitlab-gprd-postgres-backup/o?alt=json\u0026name=pitr-walg-pg11%2Fbasebackups_005%2Fbase_000000040003838C000000F8%2Ftar_partitions%2Fpart_2825.tar.br_chunks%2Fchunk6\u0026prettyPrint=false\u0026projection=full\u0026uploadType=multipart: context deadline exceeded\n\u003c13\u003eDec  9 02:39:12 backup.sh: ERROR: 2020/12/09 04:42:37.293047 Failed to run a retriable func. Err: context deadline exceeded, retrying attempt 0\n\u003c13\u003eDec  9 02:39:12 backup.sh: ERROR: 2020/12/09 04:42:37.322158 GCS error : Unable to compose object: context deadline exceeded\n\u003c13\u003eDec  9 02:39:12 backup.sh: ERROR: 2020/12/09 04:42:37.322187 upload: could not upload 'base_000000040003838C000000F8/tar_partitions/part_2825.tar.br'\n\u003c13\u003eDec  9 02:39:12 backup.sh: ERROR: 2020/12/09 04:42:37.322191 GCS error : Unable to compose object: context deadline exceeded\n\u003c13\u003eDec  9 02:39:12 backup.sh: ERROR: 2020/12/09 04:42:37.322199 Unable to continue the backup process because of the loss of a part 2825.\n```\n\n### Backup fails when closing writer of a chunk fails?\n\nThis one isn't fully clear to me, as the logs don't contain information which retriable func (upload, compose, cleanup) failed. But my assumption is this:\n\nClosing the writer for chunk 6 of part 6628 failed - but we don't seem to retry when closing the writer failed on upload, thus chunk 6 does not exist and when trying to compose, we get 404 errors until we timeout:\n\n```\n13\u003eDec  9 05:43:15 backup.sh: INFO: 2020/12/09 10:19:03.258079 Finished writing part 6634.\n\u003c13\u003eDec  9 05:43:15 backup.sh: WARNING: 2020/12/09 10:19:27.668491 Unable to close object writer base_00000004000383BC0000006B/tar_partitions/part_6628.tar.br_chunks/chunk6, part 6, err: g\noogleapi: got HTTP response code 503 with body:\n\u003c13\u003eDec  9 05:43:15 backup.sh: ERROR: 2020/12/09 10:19:27.792494 Failed to run a retriable func. Err: googleapi: Error 404: Object pitr-walg-pg11/basebackups_005/base_00000004000383BC0000006B/tar_partitions/part_6628.tar.br_chunks/chunk6 (generation: 0) not found., notFound, retrying attempt 0\n\u003c13\u003eDec  9 05:43:15 backup.sh: ERROR: 2020/12/09 10:19:27.938009 Failed to run a retriable func. Err: googleapi: Error 404: Object pitr-walg-pg11/basebackups_005/base_00000004000383BC0000006B/tar_partitions/part_6628.tar.br_chunks/chunk6 (generation: 0) not found., notFound, retrying attempt 1\n\u003c13\u003eDec  9 05:43:15 backup.sh: ERROR: 2020/12/09 10:19:28.128904 Failed to run a retriable func. Err: googleapi: Error 404: Object pitr-walg-pg11/basebackups_005/base_00000004000383BC0000006B/tar_partitions/part_6628.tar.br_chunks/chunk6 (generation: 0) not found., notFound, retrying attempt 2\n\u003c13\u003eDec  9 05:43:15 backup.sh: ERROR: 2020/12/09 10:19:28.508147 Failed to run a retriable func. Err: googleapi: Error 404: Object pitr-walg-pg11/basebackups_005/base_00000004000383BC0000006B/tar_partitions/part_6628.tar.br_chunks/chunk6 (generation: 0) not found., notFound, retrying attempt 3\n\u003c13\u003eDec  9 05:43:15 backup.sh: ERROR: 2020/12/09 10:19:29.531231 Failed to run a retriable func. Err: googleapi: Error 404: Object pitr-walg-pg11/basebackups_005/base_00000004000383BC0000006B/tar_partitions/part_6628.tar.br_chunks/chunk6 (generation: 0) not found., notFound, retrying attempt 4\n\u003c13\u003eDec  9 05:43:15 backup.sh: ERROR: 2020/12/09 10:19:31.349780 Failed to run a retriable func. Err: googleapi: Error 404: Object pitr-walg-pg11/basebackups_005/base_00000004000383BC0000006B/tar_partitions/part_6628.tar.br_chunks/chunk6 (generation: 0) not found., notFound, retrying attempt 5\n\u003c13\u003eDec  9 05:43:15 backup.sh: ERROR: 2020/12/09 10:19:35.075894 Failed to run a retriable func. Err: googleapi: Error 404: Object pitr-walg-pg11/basebackups_005/base_00000004000383BC0000006B/tar_partitions/part_6628.tar.br_chunks/chunk6 (generation: 0) not found., notFound, retrying attempt 6\n\u003c13\u003eDec  9 05:43:15 backup.sh: ERROR: 2020/12/09 10:19:42.193005 Failed to run a retriable func. Err: googleapi: Error 404: Object pitr-walg-pg11/basebackups_005/base_00000004000383BC0000006B/tar_partitions/part_6628.tar.br_chunks/chunk6 (generation: 0) not found., notFound, retrying attempt 7\n\u003c13\u003eDec  9 05:43:15 backup.sh: ERROR: 2020/12/09 10:19:51.924669 Failed to run a retriable func. Err: googleapi: Error 404: Object pitr-walg-pg11/basebackups_005/base_00000004000383BC0000006B/tar_partitions/part_6628.tar.br_chunks/chunk6 (generation: 0) not found., notFound, retrying attempt 8\n\u003c13\u003eDec  9 05:43:15 backup.sh: ERROR: 2020/12/09 10:20:15.367526 Failed to run a retriable func. Err: googleapi: Error 404: Object pitr-walg-pg11/basebackups_005/base_00000004000383BC0000006B/tar_partitions/part_6628.tar.br_chunks/chunk6 (generation: 0) not found., notFound, retrying attempt 9\n\u003c13\u003eDec  9 05:43:15 backup.sh: ERROR: 2020/12/09 10:21:17.551962 Failed to run a retriable func. Err: googleapi: Error 404: Object pitr-walg-pg11/basebackups_005/base_00000004000383BC0000006B/tar_partitions/part_6628.tar.br_chunks/chunk6 (generation: 0) not found., notFound, retrying attempt 10\n\u003c13\u003eDec  9 05:43:15 backup.sh: ERROR: 2020/12/09 10:23:07.873625 Failed to run a retriable func. Err: googleapi: Error 404: Object pitr-walg-pg11/basebackups_005/base_00000004000383BC0000006B/tar_partitions/part_6628.tar.br_chunks/chunk6 (generation: 0) not found., notFound, retrying attempt 11\n\u003c13\u003eDec  9 05:43:15 backup.sh: ERROR: 2020/12/09 10:25:30.905058 Failed to run a retriable func. Err: googleapi: Error 404: Object pitr-walg-pg11/basebackups_005/base_00000004000383BC0000006B/tar_partitions/part_6628.tar.br_chunks/chunk6 (generation: 0) not found., notFound, retrying attempt 12\n\u003c13\u003eDec  9 05:43:15 backup.sh: ERROR: 2020/12/09 10:28:03.582246 GCS error : Unable to compose object: context deadline exceeded\n\u003c13\u003eDec  9 05:43:15 backup.sh: ERROR: 2020/12/09 10:28:03.582279 upload: could not upload 'base_00000004000383BC0000006B/tar_partitions/part_6628.tar.br'\n\u003c13\u003eDec  9 05:43:15 backup.sh: ERROR: 2020/12/09 10:28:03.582284 GCS error : Unable to compose object: context deadline exceeded\n\u003c13\u003eDec  9 05:43:15 backup.sh: ERROR: 2020/12/09 10:28:03.582290 Unable to continue the backup process because of the loss of a part 6628.\n```\n\n**Suggestion:**\n\n* Make sure we retry when failing to close the writer on uploads. Maybe overriding the `err` return var in the defer func doesn't work as expected? https://github.com/wal-g/storages/blob/master/gcs/uploader.go#L75\n\n/cc @NikolayS","state":"closed","created_at":"2020-12-09T12:18:30.814Z","updated_at":"2022-08-04T12:35:54.964Z","closed_at":"2021-11-23T13:45:15.128Z","closed_by":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"labels":["Service::Postgres","corrective action","severity::4","team::Reliability","workflow-infra::Done"],"milestone":{"id":2119954,"iid":144,"group_id":1112072,"title":"EOC Queue Q2 2021","description":"","state":"closed","created_at":"2021-06-27T15:50:33.795Z","updated_at":"2021-11-12T05:29:04.183Z","due_date":"2021-07-31","start_date":"2021-05-01","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/144"},"assignees":[{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"}],"author":{"id":3059703,"username":"hphilipps","name":"Henri Philipps","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3059703/avatar.png","web_url":"https://gitlab.com/hphilipps"},"type":"ISSUE","assignee":{"id":2759709,"username":"Finotto","name":"Jose Finotto","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2759709/avatar.png","web_url":"https://gitlab.com/Finotto"},"user_notes_count":33,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12108","time_stats":{"time_estimate":86400,"total_time_spent":0,"human_time_estimate":"24h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":8,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12108","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12108/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12108/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12108","relative":"#12108","full":"gitlab-com/gl-infra/reliability#12108"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":380,"epic":{"id":162885,"iid":380,"title":"WAL-G improvements","url":"/groups/gitlab-com/gl-infra/-/epics/380","group_id":1112072,"human_readable_end_date":"Jul 31, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":75788120,"iid":12103,"project_id":1304532,"title":"Fuzzit.dev redirect","description":"The Secure sub-dept is completing the acquisition of fuzzit.dev and the last step is to redirect fuzzit's website to GitLab. My question is, does Infrastructure handle the redirection, if say, we want to redirect to a specific page? Please provide guidance on how to move forward. \n\ncc/ @dawsmith @david @tstadelhofer","state":"closed","created_at":"2020-12-08T20:56:31.730Z","updated_at":"2020-12-30T23:41:41.059Z","closed_at":"2020-12-30T23:41:41.012Z","closed_by":{"id":2222520,"username":"dawsmith","name":"Dave Smith","state":"active","avatar_url":"https://secure.gravatar.com/avatar/ef341e061f6b86461626e64c5fbcfe52?s=80\u0026d=identicon","web_url":"https://gitlab.com/dawsmith"},"labels":["AssistType::Domain-DNS-SSL-Management","AssistingTeam::Development","Unplanned","workflow-infra::Done"],"milestone":{"id":1722318,"iid":115,"group_id":1112072,"title":"Core-Infra Dec 27-Jan 9 '21 Unplanned items","description":"","state":"closed","created_at":"2020-11-12T21:13:14.237Z","updated_at":"2021-01-20T00:25:04.544Z","due_date":"2021-01-09","start_date":"2020-12-27","expired":true,"web_url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/milestones/115"},"assignees":[{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},{"id":6003688,"username":"ypats","name":"Yevgeny Pats","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/6003688/avatar.png","web_url":"https://gitlab.com/ypats"}],"author":{"id":4161201,"username":"tstadelhofer","name":"Todd Stadelhofer","state":"active","avatar_url":"https://secure.gravatar.com/avatar/462ca93b61be9ab6c88dc8009eb12c3e?s=80\u0026d=identicon","web_url":"https://gitlab.com/tstadelhofer"},"type":"ISSUE","assignee":{"id":194566,"username":"cmcfarland","name":"Cameron McFarland","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fea59864aa5c034e15089251bf9fa8f?s=80\u0026d=identicon","web_url":"https://gitlab.com/cmcfarland"},"user_notes_count":32,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-com/gl-infra/reliability/-/issues/12103","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/1304532/issues/12103","notes":"https://gitlab.com/api/v4/projects/1304532/issues/12103/notes","award_emoji":"https://gitlab.com/api/v4/projects/1304532/issues/12103/award_emoji","project":"https://gitlab.com/api/v4/projects/1304532","closed_as_duplicate_of":null},"references":{"short":"#12103","relative":"#12103","full":"gitlab-com/gl-infra/reliability#12103"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null}]