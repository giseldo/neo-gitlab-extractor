[{"id":24665041,"iid":23204,"project_id":278964,"title":"Frontend for showing √ó on hover on label to remove the label in sidebar","description":"We add a chip with an `x` icon (`icn/close`) that can be clicked to delete the label. The chip will change its style and show a background on hover and active states.\n\nThe shape of the chip will be a `16px x 16px` circle. The icon inside should be `8px x 8px`. The margin with the label name is `2px` and the padding on the right side of the chip is `4px`. Spec previous will be uploaded with all these measurements.\n\nThe target area of the chip will be a `16px x 16px` square indepndently of its shape.\n\nWe currently underline the label's name when hovering. This underline should be removed when hovering over the chip.\n\n| States | Sidebar |\n| ------ | ------- |\n| \u003cimg src=\"https://gitlab.com/gitlab-org/gitlab-ce/uploads/8603ad33cf17624e75c31147cf7f8288/labels--cursors.png\" width=442px\u003e | \u003cimg src=\"https://gitlab.com/gitlab-org/gitlab-ce/uploads/1585579d865d77987ee0620adef896ce/sidebar.png\" width=288px\u003e\n\nThe colors of the badge are based on the label name color:\n\n|     | Resting | Hover | Active |\n| --- | ------- | ----- | ------ |\n| Icon | Color: `same as text`, Opacity: `100%` | Color: `same as text`, Opacity: `100%` | Color: `same as label`, Opacity: `100%`  |\n| Icon Background | Color: `none`, Opacity: `0%` | Color: ` same as text`, Opacity: `30%` | Color: `same as text`, Opacity: `100%`  |\n\n### In scope\n- This should apply to issue, merge request, and epic pages.\n- This should apply to the slide out board sidebar for project boards and group boards.","state":"closed","created_at":"2018-07-10T10:46:23.914Z","updated_at":"2022-05-19T16:28:39.013Z","closed_at":"2020-02-14T21:34:30.241Z","closed_by":{"id":3507264,"username":"donaldcook","name":"Donald Cook","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3507264/avatar.png","web_url":"https://gitlab.com/donaldcook"},"labels":["[deprecated] Accepting merge requests","depth","devops::plan","frontend","group::project management","labels","type::feature","workflow::planning breakdown"],"milestone":{"id":490705,"iid":14,"group_id":9970,"title":"Backlog","description":"Issues that we want to do but are not planned right now. Open for contribution from the community.","state":"active","created_at":"2018-03-22T13:09:23.767Z","updated_at":"2018-10-30T14:56:54.069Z","due_date":null,"start_date":null,"expired":false,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/14"},"assignees":[],"author":{"id":563185,"username":"cperessini","name":"Chris Peressini","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/563185/avatar.png","web_url":"https://gitlab.com/cperessini"},"type":"ISSUE","assignee":null,"user_notes_count":18,"merge_requests_count":0,"upvotes":16,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/23204","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/23204","notes":"https://gitlab.com/api/v4/projects/278964/issues/23204/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/23204/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#23204","relative":"#23204","full":"gitlab-org/gitlab#23204"},"severity":"UNKNOWN","moved_to_id":30791244,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":12649720,"iid":6868,"project_id":278964,"title":"Read-only controller doesn't account for relative paths for /admin/sidekiq route","description":"Found while looking at https://gitlab.com/gitlab-org/gitlab-ee/merge_requests/6248#note_86991051:\n\nFor configurations using relative URLs, the `request.path` includes the relative path. For example, if `external_url` is set to `http://geo-secondary/test`, the `request.path` may be `/test/admin/sidekiq`.\n\nCurrently the use of `start_with?` in the read-only controller would not properly match.","state":"closed","created_at":"2018-07-10T04:30:17.451Z","updated_at":"2019-12-11T20:05:34.946Z","closed_at":"2019-01-14T05:20:47.185Z","closed_by":{"id":2187482,"username":"ashmckenzie","name":"Ash McKenzie","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2187482/avatar.png","web_url":"https://gitlab.com/ashmckenzie"},"labels":["Enterprise Edition","Geo Administration","devops::systems","group::geo","maintenance::refactor","workflow::in dev"],"milestone":{"id":581391,"iid":23,"group_id":9970,"title":"11.8","description":"","state":"closed","created_at":"2018-06-26T15:15:18.359Z","updated_at":"2019-03-08T17:33:19.162Z","due_date":"2019-02-22","start_date":"2019-01-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/23"},"assignees":[{"id":2187482,"username":"ashmckenzie","name":"Ash McKenzie","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2187482/avatar.png","web_url":"https://gitlab.com/ashmckenzie"}],"author":{"id":64248,"username":"stanhu","name":"Stan Hu","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/64248/stanhu.jpg","web_url":"https://gitlab.com/stanhu"},"type":"ISSUE","assignee":{"id":2187482,"username":"ashmckenzie","name":"Ash McKenzie","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2187482/avatar.png","web_url":"https://gitlab.com/ashmckenzie"},"user_notes_count":1,"merge_requests_count":1,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6868","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6868","notes":"https://gitlab.com/api/v4/projects/278964/issues/6868/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6868/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6868","relative":"#6868","full":"gitlab-org/gitlab#6868"},"severity":"UNKNOWN","moved_to_id":17312019,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":24665016,"iid":23182,"project_id":278964,"title":"Blacklist the use of \"becomes(SomeClass)\" in Rubocop","description":"In https://gitlab.com/gitlab-org/gitlab-ce/merge_requests/20313 I found out that `becomes(SomeClass)` (e.g. `becomes(Namespace)`) will result in eager loaded associations being ignored. This in turn can cause N+1 problems. We can easily work around this by just using the desired path methods (`admin_foo_path` for example). \n\nTo prevent future performance problems (and fix existing ones), we should add a Cop that disallows the use of `becomes(SomeClass)`.","state":"closed","created_at":"2018-07-09T14:02:53.739Z","updated_at":"2020-08-13T15:55:10.421Z","closed_at":"2020-08-13T15:53:45.703Z","closed_by":{"id":3483274,"username":"acroitor","name":"Alexandru Croitor","state":"active","avatar_url":"https://secure.gravatar.com/avatar/461378ef52c26eec55e6c15ec09bb9ed?s=80\u0026d=identicon","web_url":"https://gitlab.com/acroitor"},"labels":["Quality","Quality::test-gap","backend","bug::performance","database","devops::plan","group::project management","missed:11.10","missed:12.2","workflow::production"],"milestone":{"id":1233752,"iid":50,"group_id":9970,"title":"13.3","description":"https://about.gitlab.com/releases/2020/08/22/gitlab-13-3-released/","state":"closed","created_at":"2020-04-09T17:39:21.090Z","updated_at":"2022-04-13T14:50:18.976Z","due_date":"2020-08-17","start_date":"2020-07-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/50"},"assignees":[{"id":3483274,"username":"acroitor","name":"Alexandru Croitor","state":"active","avatar_url":"https://secure.gravatar.com/avatar/461378ef52c26eec55e6c15ec09bb9ed?s=80\u0026d=identicon","web_url":"https://gitlab.com/acroitor"}],"author":{"id":209240,"username":"yorickpeterse","name":"Yorick Peterse","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/209240/avatar.png","web_url":"https://gitlab.com/yorickpeterse"},"type":"ISSUE","assignee":{"id":3483274,"username":"acroitor","name":"Alexandru Croitor","state":"active","avatar_url":"https://secure.gravatar.com/avatar/461378ef52c26eec55e6c15ec09bb9ed?s=80\u0026d=identicon","web_url":"https://gitlab.com/acroitor"},"user_notes_count":7,"merge_requests_count":0,"upvotes":4,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/23182","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/23182","notes":"https://gitlab.com/api/v4/projects/278964/issues/23182/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/23182/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#23182","relative":"#23182","full":"gitlab-org/gitlab#23182"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":12623463,"iid":6851,"project_id":278964,"title":"Add Geo project/file registry details in the UI","description":"https://gitlab.com/gitlab-org/gitlab-ee/issues/4880 lays out the design for this:\n\n## Description\n\nGeo secondaries have a wealth of information about project and file synchronization. There is an API for reading this data, but we should also allow failures to be exposed in the UI.\n\nThere are two obvious places for this:\n\n## A. Project page\n\ne.g. https://gitlab.com/gitlab-org/gitlab-ce\n\nOn the secondary, we can show an \"out of date!\" warning, telling all users of the secondary that there are changes waiting to be synced. If the sync is suffering errors, we can display those here too, and go from a \"warning\" state to an \"error\" state.\n\nA customer also asked to add a button to force the resync: ZD: https://gitlab.zendesk.com/agent/tickets/96217\n\nThere might be an argument for displaying this data only to admins, but I'm comfortable with at least showing it to project members, and probably everyone.\n\n### Example from pull mirroring\n\nFor project mirrors, we have this handy interface at the top of the repository for 10.6:\n\n![image](/uploads/4ab0581a6f2d4471f56b065ae868ccb2/image.png)\n\nSomething like this, showing \"Last update\" details and an \"Update\" button, would be handy for Geo as well. \n\n\n## B. Admin page\n\nWe should have a simple CRUD interface to all the project and file registries. The `/admin/geo_nodes` page can link the failures to this page. It should be possible to look up the status of any project, and perhaps to find all projects with a given error text, from this interface.\n\n\n## Design\n\n#### Contexual Sidebar\n* Add **Projects** under **Geo**.\n* \"Geo nodes\" is changed to **Nodes**.\n\nNew structure:\n- Geo\n * Nodes\n * Projects\n\n#### Geo \u003e Projects\n- There is a tab bar includes:\n  - `All`: Will be sorted by the most up-to-date to the least one.\n  - `Pending`: Will be sorted by the oldest up-to-date\n  - `Failures`: Will be sorted by the many amounts of retry first and up-to-date as the second parameter, so if something is really broken and for a considerable amount of time, this will be the first item\n  - `Never`: Same logic with `Pending`.  \n- The \"Project\" boxes are **not** collapsible. (*Updated on July 25*)\n- It shows **20** \"project\" boxes on every single page.\n- The project names link to the specific project page (e.g. `https://gitlab.com/gitlab-org/gitlab-ee`)\n\n| Project homepage | Geo \u003e Projects |\n| --- | --- |\n| ![01-project-page--default](/uploads/545d1f3acd419d589dde79c74a1ecd64/01-project-page--default.png)  | ![mockup-admin-registries--Synced](/uploads/8cbbba4d1dace6ca9f8e8533a550b9bd/mockup-admin-registries--Synced.png) |\n\n#### The information in the different statuses:\n\n- **Synced**\n  - `Status`: In sync / Synced\n  - `Last successful sync`\n  - `Last time verified`\n  - Button: [Resync] / [Recheck] \n- **Pending**\n  - `Status`: Pending\n  - `Next sync scheduled at`\n  - `Last successful sync`\n  - Button: [Recheck]\n- **Failures**\n  - `Status`: Failed to sync / Failed to verify\n  - `Last successful sync`\n  - `Retry counts`\n  - `Last synchronization attemp` or `Last verification attemp`\n  - `Error message` will be in the \"More\" section. (\"More\" section is **collapsed** as default)\n  - Button: [Resync]/[Redownload]\n- **Never**\n  - `Status`: (Not sure the status type here)\n  - `Last successful sync`\n  - `Project created`\n  - Button: none\n\n| Synced| Pending | \n| --- | --- | \n| ![02-admin-registries--Synced](/uploads/d1acc8151416682ed67d4cf370c4ba68/02-admin-registries--Synced.png) | ![03-admin-registries--pending](/uploads/9bedb1f1e582b5d646ee9e055f23abf1/03-admin-registries--pending.png) | \n\n| Failures | Never |\n| --- | --- |\n| ![04-admin-registries--failures](/uploads/03ae7d5430b4c3dbeae556468e9f3cfc/04-admin-registries--failures.png) | ![05-admin-registries--never](/uploads/b54725be86fe28afec93afc80b580656/05-admin-registries--never.png) |\n\n\n#### Warning/Error messages\n\n##### Warning\n* Copy: `There are some changes waiting to be synced on this Geo secondary. [Sync now] or [Learn more]`\n - [Learn more]() navigates users to **Geo \u003e Projects** page.\n* Background color: `$orange-500`\n\n![sync-warning](/uploads/188963b9d73d6011fa5a2eef9f962dbf/sync-warning.png)\n\n\n##### Error\n* Copy: `There are some syncing errors on this Geo secondary. [Sync now] or [Learn more]`\n - [Learn more]() navigates users to **Geo \u003e Projects** page.\n* Background color: `$red-500`\n\n![sync-error](/uploads/f435bd03335c42ae2da080de0c817698/sync-error.png)","state":"closed","created_at":"2018-07-09T04:04:06.215Z","updated_at":"2019-12-11T20:05:36.540Z","closed_at":"2018-08-07T15:52:53.398Z","closed_by":{"id":64248,"username":"stanhu","name":"Stan Hu","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/64248/stanhu.jpg","web_url":"https://gitlab.com/stanhu"},"labels":["Deliverable","Enterprise Edition","devops::systems","frontend","group::geo","workflow::in review"],"milestone":{"id":494367,"iid":15,"group_id":9970,"title":"11.2","description":"","state":"closed","created_at":"2018-03-27T19:26:05.990Z","updated_at":"2018-11-06T19:16:51.951Z","due_date":"2018-08-22","start_date":"2018-07-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/15"},"assignees":[{"id":2293,"username":"brodock","name":"Gabriel Mazetto","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2293/avatar.png","web_url":"https://gitlab.com/brodock"},{"id":411701,"username":"kushalpandya","name":"Kushal Pandya","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/411701/avatar.png","web_url":"https://gitlab.com/kushalpandya"},{"id":577113,"username":"hazelyang","name":"Hazel Yang","state":"active","avatar_url":"https://secure.gravatar.com/avatar/e84e4d70639ad1177276340868d7f074?s=80\u0026d=identicon","web_url":"https://gitlab.com/hazelyang"}],"author":{"id":64248,"username":"stanhu","name":"Stan Hu","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/64248/stanhu.jpg","web_url":"https://gitlab.com/stanhu"},"type":"ISSUE","assignee":{"id":2293,"username":"brodock","name":"Gabriel Mazetto","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2293/avatar.png","web_url":"https://gitlab.com/brodock"},"user_notes_count":29,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6851","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6851","notes":"https://gitlab.com/api/v4/projects/278964/issues/6851/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6851/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6851","relative":"#6851","full":"gitlab-org/gitlab#6851"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":24664986,"iid":23160,"project_id":278964,"title":"Add non-Geo issue attachment upload test","description":"The Geo attachment replication test currently covers this in a roundabout way. It would help if we had a test that covered this directly so it is immediately obvious whether the problem is with replication or not.\n\nE.g. See initial ambiguity in this job failure https://gitlab.com/gitlab-org/gitlab-qa/issues/291\n\nAlso, CE-only MRs don't run Geo QA specs in CI, so legit failures aren't caught until much later.\n\nThis test will be very quick to add since the replication test exists.\n\nThe only downside is that this would increase QA run time for a test that somewhat overlaps with a Geo test.","state":"closed","created_at":"2018-07-06T18:31:12.696Z","updated_at":"2020-10-13T14:49:16.962Z","closed_at":"2020-10-13T14:49:16.928Z","closed_by":{"id":1144264,"username":"mkozono","name":"Michael Kozono","state":"active","avatar_url":"https://secure.gravatar.com/avatar/6243abba3cf112e6df4a5a644c5f86aa?s=80\u0026d=identicon","web_url":"https://gitlab.com/mkozono"},"labels":["QA","Quality","[deprecated] Accepting merge requests","devops::systems","group::geo","missed:11.11","missed:11.9","missed:12.1","missed:12.1","missed:12.10","missed:12.2","missed:12.3","missed:12.4","missed:12.5","missed:12.6","missed:12.7","missed:12.8","missed:12.9","missed:13.0","missed:13.1","missed:13.2","missed:13.3","missed:13.4","test"],"milestone":{"id":490705,"iid":14,"group_id":9970,"title":"Backlog","description":"Issues that we want to do but are not planned right now. Open for contribution from the community.","state":"active","created_at":"2018-03-22T13:09:23.767Z","updated_at":"2018-10-30T14:56:54.069Z","due_date":null,"start_date":null,"expired":false,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/14"},"assignees":[],"author":{"id":1144264,"username":"mkozono","name":"Michael Kozono","state":"active","avatar_url":"https://secure.gravatar.com/avatar/6243abba3cf112e6df4a5a644c5f86aa?s=80\u0026d=identicon","web_url":"https://gitlab.com/mkozono"},"type":"ISSUE","assignee":null,"user_notes_count":8,"merge_requests_count":0,"upvotes":2,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/23160","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/23160","notes":"https://gitlab.com/api/v4/projects/278964/issues/23160/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/23160/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#23160","relative":"#23160","full":"gitlab-org/gitlab#23160"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":12601516,"iid":6843,"project_id":278964,"title":"\"And\" translated out of sentence in the mr widget","description":"In `ee/app/assets/javascripts/vue_merge_request_widget/mr_widget_options.vue` we translate the string \"and\" to use in other sentences.\n\nThis translation will not work easily in all languages\n\n\n___\nThe following discussion from !6409 should be addressed:\n\n- [ ] @godfat started a [discussion](https://gitlab.com/gitlab-org/gitlab-ee/merge_requests/6409#note_86559191):  (+1 comment)\n\n    \u003e Not relevant in this MR, but I am sad seeing this being translatable. I feel this is going to be extremely hard to be correctly translated in all languages.","state":"closed","created_at":"2018-07-06T16:28:37.021Z","updated_at":"2022-11-28T17:00:51.175Z","closed_at":"2022-11-28T17:00:51.118Z","closed_by":{"id":4554599,"username":"m_gill","name":"Michelle Gill","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4554599/avatar.png","web_url":"https://gitlab.com/m_gill"},"labels":["Category:Internationalization","Enterprise Edition","Hackathon","devops::manage","frontend","good for new contributors","group::import","priority::4","section::dev","severity::4","type::bug","vintage"],"milestone":{"id":490705,"iid":14,"group_id":9970,"title":"Backlog","description":"Issues that we want to do but are not planned right now. Open for contribution from the community.","state":"active","created_at":"2018-03-22T13:09:23.767Z","updated_at":"2018-10-30T14:56:54.069Z","due_date":null,"start_date":null,"expired":false,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/14"},"assignees":[{"id":10409869,"username":"anshulriyal","name":"Anshul Riyal","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/10409869/avatar.png","web_url":"https://gitlab.com/anshulriyal"}],"author":{"id":171554,"username":"reprazent","name":"Bob Van Landuyt","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/171554/avatar.png","web_url":"https://gitlab.com/reprazent"},"type":"ISSUE","assignee":{"id":10409869,"username":"anshulriyal","name":"Anshul Riyal","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/10409869/avatar.png","web_url":"https://gitlab.com/anshulriyal"},"user_notes_count":16,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6843","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":1,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 1 checklist item completed","_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6843","notes":"https://gitlab.com/api/v4/projects/278964/issues/6843/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6843/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6843","relative":"#6843","full":"gitlab-org/gitlab#6843"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2722,"epic":{"id":23515,"iid":2722,"title":"Category:Internationalization Strategy","url":"/groups/gitlab-org/-/epics/2722","group_id":9970},"iteration":null,"health_status":null},{"id":12582115,"iid":6831,"project_id":278964,"title":"Add Group SAML activities to Group Audit Events","description":"### Problem to solve\n\n[Audit Events](https://docs.gitlab.com/ee/administration/audit_events.html) are a useful way to view GitLab activity, but most of them are instance-level only and stashed away in the admin panel. With the introduction of Group SAML, we should include these events in the audit log for the group.\n\n### Proposal\n\nLog Group SAML activity in Audit Events for the group.\n\n### What does success look like, and how can we measure that?\n\nSuccessful and failed logins via SAML are logged in Audit Events at the namespace level.\n\n### Implementation plan\n\n- [ ] Find entry point for SAML success and failure login\n- [ ] Inject audit event service for those points\n- [ ] Add SAML success and failure to documentation for group-level audit events\n\n### Potential obstacles\n\n- [Setting up SAML on GDK](https://gitlab.com/gitlab-org/gitlab-development-kit/-/blob/main/doc/howto/saml.md) can be tricky, but completely doable.\n\n### Links / references","state":"closed","created_at":"2018-07-05T23:53:44.320Z","updated_at":"2021-09-28T12:05:53.211Z","closed_at":"2021-09-28T09:23:41.694Z","closed_by":{"id":3468028,"username":"jiaan","name":"Jiaan Louw","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3468028/avatar.png","web_url":"https://gitlab.com/jiaan"},"labels":["Category:Audit Events","Category:Subgroups","Enterprise Edition","Next Up","OKR","audit_events::user_permissions","backend","devops::manage","gitlab.com","group::compliance","ideal for new hires","priority::2","release post item::in review","section::dev","type::feature","workflow::ready for development"],"milestone":{"id":1948708,"iid":64,"group_id":9970,"title":"14.4","description":"https://about.gitlab.com/releases/archives.html","state":"closed","created_at":"2021-03-17T21:44:55.682Z","updated_at":"2022-04-21T07:25:38.537Z","due_date":"2021-10-17","start_date":"2021-09-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/64"},"assignees":[{"id":3468028,"username":"jiaan","name":"Jiaan Louw","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3468028/avatar.png","web_url":"https://gitlab.com/jiaan"}],"author":{"id":1086520,"username":"jeremy-gl","name":"Jeremy Watson (ex-GitLab)","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1086520/avatar.png","web_url":"https://gitlab.com/jeremy-gl"},"type":"ISSUE","assignee":{"id":3468028,"username":"jiaan","name":"Jiaan Louw","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3468028/avatar.png","web_url":"https://gitlab.com/jiaan"},"user_notes_count":7,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6831","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":3,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 3 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6831","notes":"https://gitlab.com/api/v4/projects/278964/issues/6831/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6831/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6831","relative":"#6831","full":"gitlab-org/gitlab#6831"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":640,"epic":{"id":2446,"iid":640,"title":"Comprehensive audit log: actions","url":"/groups/gitlab-org/-/epics/640","group_id":9970,"human_readable_end_date":"Jan 17, 2023","human_readable_timestamp":"\u003cstrong\u003e1\u003c/strong\u003e day remaining"},"iteration":null,"health_status":null},{"id":12558040,"iid":6822,"project_id":278964,"title":"Generalized weights in API","description":"### Summary\n\nIt looks like Issue weights are still limited in the API:\n\n```\n StatusCodeError: 400 - {\"error\":\"weight does not have a valid value\"}\n```\n\nhttps://gitlab.com/gitlab-org/gitlab-ee/blob/master/lib/api/issues.rb#L58\n\n### Steps to reproduce\n\nAttempt to change the weight of an issue to any value \u003e 9 \n\n### What is the current *bug* behavior?\n\nReturns and error\n\n```\n StatusCodeError: 400 - {\"error\":\"weight does not have a valid value\"}\n```\n\n### What is the expected *correct* behavior?\n\nOnly throw an error if the value is not an integer\n\n### Relevant logs and/or screenshots\n```\n StatusCodeError: 400 - {\"error\":\"weight does not have a valid value\"}\n```\n\n#### Results of GitLab environment info\n\ngitlab.com","state":"closed","created_at":"2018-07-04T19:17:05.146Z","updated_at":"2022-05-19T16:28:11.314Z","closed_at":"2018-09-17T08:23:06.769Z","closed_by":{"id":87854,"username":"DouweM","name":"Douwe Maan","state":"active","avatar_url":"https://secure.gravatar.com/avatar/73d1548ae618321220679b3a4fda7fb1?s=80\u0026d=identicon","web_url":"https://gitlab.com/DouweM"},"labels":["Deliverable","Enterprise Edition","api","backend","devops::plan","direction","issue weight","issues","workflow::in review"],"milestone":{"id":567670,"iid":19,"group_id":9970,"title":"11.4","description":"","state":"closed","created_at":"2018-06-14T17:31:41.249Z","updated_at":"2018-12-20T06:49:55.749Z","due_date":"2018-10-22","start_date":"2018-09-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/19"},"assignees":[{"id":426128,"username":"felipe_artur","name":"Felipe Artur","state":"active","avatar_url":"https://secure.gravatar.com/avatar/dbad92659914f56621cbdd726e283e60?s=80\u0026d=identicon","web_url":"https://gitlab.com/felipe_artur"}],"author":{"id":630012,"username":"jdalrymple","name":"Justin Dalrymple","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/630012/avatar.png","web_url":"https://gitlab.com/jdalrymple"},"type":"ISSUE","assignee":{"id":426128,"username":"felipe_artur","name":"Felipe Artur","state":"active","avatar_url":"https://secure.gravatar.com/avatar/dbad92659914f56621cbdd726e283e60?s=80\u0026d=identicon","web_url":"https://gitlab.com/felipe_artur"},"user_notes_count":4,"merge_requests_count":2,"upvotes":2,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6822","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6822","notes":"https://gitlab.com/api/v4/projects/278964/issues/6822/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6822/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6822","relative":"#6822","full":"gitlab-org/gitlab#6822"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":24664918,"iid":23111,"project_id":278964,"title":"Projects::Settings::RepositoryController#show ‚Äì ActionView::Template::Error: undefined method `access_level' for nil:NilClass","description":"### Summary\n\nGitLab 11.0.2 responds with a 500 error page when visiting Settings -\u003e Repository for all projects in a particular group.\n\nProjects in other groups do not appear to be affected.\n\nThe exception is logged to our Sentry error tracking:\n\n**Transaction:** `Projects::Settings::RepositoryController#show`\n\n**Exception:** `ActionView::Template::Error: undefined method 'access_level' for nil:NilClass`\n\nThe exception happens in `app/views/projects/protected_branches/_update_protected_branch.html.haml` in the following block:\n\n```haml\n%td\n  = hidden_field_tag \"allowed_to_merge_#{protected_branch.id}\", protected_branch.merge_access_levels.first.access_level\n```\n\nThe full backtrace is linked below.\n\n### Steps to reproduce\n\nVisit the `/:group/:project/settings/repository` route of the affected project.\n\n### Example Project\n\nThe group of the affected is set to \"Internal\". The exception happens on both existing projects in the group, that are set to \"Private\" access level.\n\n### What is the current *bug* behavior?\n\nException when visiting Settings -\u003e Repository for all projects in the affected group.\n\n### What is the expected *correct* behavior?\n\nIt shouldn't crash ;-)\n\n### Relevant logs and/or screenshots\n\nRedacted public Sentry issue:\n\nhttps://sentry.louis-net.de/share/issue/1fb37ddcce3a4ac09be7c7392eb79555/\n\n(More details from the non-public issue can be provided if needed.)\n\n### Output of checks\n\nThis bug happens on a private GitLab CE Omnibus install.\n\n#### Results of GitLab environment info\n\n\u003cdetails\u003e\n\u003csummary\u003eExpand for output related to GitLab environment info\u003c/summary\u003e\n\u003cpre\u003e\n\nsudo gitlab-rake gitlab:env:info\n\nSystem information\nSystem:\t\tUbuntu 14.04\nCurrent User:\tgit\nUsing RVM:\tno\nRuby Version:\t2.4.4p296\nGem Version:\t2.7.6\nBundler Version:1.16.2\nRake Version:\t12.3.1\nRedis Version:\t3.2.11\nGit Version:\t2.17.1\nSidekiq Version:5.1.3\nGo Version:\tunknown\n\nGitLab information\nVersion:\t11.0.2\nRevision:\td9540ee\nDirectory:\t/opt/gitlab/embedded/service/gitlab-rails\nDB Adapter:\tpostgresql\nURL:\t\thttps://redacted\nHTTP Clone URL:\thttps://redacted/some-group/some-project.git\nSSH Clone URL:\tgit@redacted:some-group/some-project.git\nUsing LDAP:\tyes\nUsing Omniauth:\tno\n\nGitLab Shell\nVersion:\t7.1.4\nRepository storage paths:\n- default: \t/var/opt/gitlab/git-data/repositories\nHooks:\t\t/opt/gitlab/embedded/service/gitlab-shell/hooks\nGit:\t\t/opt/gitlab/embedded/bin/git\n\n\u003c/pre\u003e\n\u003c/details\u003e\n\n#### Results of GitLab application Check\n\n\u003cdetails\u003e\n\u003csummary\u003eExpand for output related to the GitLab application check\u003c/summary\u003e\n\u003cpre\u003e\n\nsudo gitlab-rake gitlab:check SANITIZE=true\n\nChecking GitLab Shell ...\n\nGitLab Shell version \u003e= 7.1.4 ? ... OK (7.1.4)\nRepo base directory exists?\ndefault... yes\nRepo storage directories are symlinks?\ndefault... no\nRepo paths owned by git:root, or git:git?\ndefault... yes\nRepo paths access is drwxrws---?\ndefault... yes\nhooks directories in repos are links: ...\n84/4 ... ok\n84/5 ... ok\n84/6 ... ok\n7/7 ... ok\n84/9 ... ok\n84/10 ... ok\n11/11 ... ok\n11/12 ... ok\n5/17 ... ok\n5/18 ... ok\n5/19 ... ok\n5/20 ... ok\n5/21 ... ok\n10/23 ... ok\n10/24 ... ok\n18/28 ... ok\n12/29 ... repository is empty\n12/30 ... ok\n12/31 ... ok\n11/32 ... ok\n5/33 ... ok\n22/36 ... ok\n20/37 ... ok\n5/39 ... ok\n5/40 ... ok\n5/41 ... ok\n20/42 ... ok\n18/45 ... ok\n26/46 ... ok\n19/48 ... ok\n12/49 ... ok\n10/50 ... ok\n12/53 ... ok\n2/55 ... ok\n18/56 ... ok\n11/57 ... ok\n2/58 ... ok\n28/59 ... ok\n5/60 ... ok\n5/61 ... ok\n2/62 ... ok\n17/63 ... ok\n5/66 ... ok\n17/67 ... ok\n17/68 ... ok\n2/70 ... ok\n17/71 ... ok\n11/72 ... ok\n19/73 ... ok\n19/74 ... ok\n19/76 ... ok\n84/77 ... ok\n10/78 ... ok\n10/79 ... ok\n10/80 ... ok\n30/81 ... ok\n31/82 ... ok\n17/84 ... ok\n22/85 ... ok\n22/87 ... ok\n2/88 ... ok\n2/89 ... ok\n17/90 ... ok\n84/91 ... ok\n84/92 ... ok\n10/94 ... ok\n5/95 ... ok\n10/96 ... ok\n10/97 ... ok\n57/98 ... ok\n41/99 ... ok\n11/100 ... ok\n10/101 ... ok\n2/102 ... ok\n30/103 ... ok\n2/104 ... ok\n33/105 ... ok\n6/106 ... ok\n36/107 ... ok\n37/108 ... ok\n22/109 ... ok\n2/110 ... ok\n19/111 ... ok\n37/112 ... ok\n5/113 ... ok\n2/114 ... ok\n11/115 ... ok\n2/117 ... ok\n2/118 ... ok\n7/120 ... ok\n40/121 ... ok\n41/122 ... ok\n30/123 ... ok\n41/124 ... ok\n17/125 ... repository is empty\n2/126 ... ok\n44/127 ... ok\n46/129 ... ok\n11/130 ... ok\n42/132 ... ok\n19/133 ... ok\n45/137 ... ok\n3/139 ... repository is empty\n41/140 ... ok\n5/141 ... ok\n10/144 ... ok\n30/145 ... ok\n22/146 ... ok\n3/147 ... ok\n17/148 ... ok\n10/149 ... ok\n10/150 ... ok\n48/152 ... ok\n23/153 ... ok\n42/154 ... ok\n42/157 ... ok\n9/159 ... repository is empty\n42/160 ... ok\n22/161 ... ok\n10/162 ... ok\n6/163 ... ok\n6/164 ... ok\n6/165 ... ok\n49/166 ... ok\n5/167 ... ok\n42/168 ... ok\n11/169 ... ok\n42/170 ... ok\n42/171 ... ok\n30/172 ... ok\n11/174 ... ok\n49/175 ... ok\n33/179 ... ok\n19/180 ... ok\n10/181 ... ok\n84/182 ... ok\n84/183 ... ok\n30/184 ... ok\n30/185 ... ok\n60/186 ... ok\n6/187 ... ok\n5/188 ... ok\n30/189 ... ok\n5/190 ... ok\n62/191 ... ok\n10/192 ... ok\n63/193 ... ok\n19/195 ... ok\n2/196 ... ok\n66/197 ... ok\n42/198 ... ok\n49/199 ... ok\n49/200 ... ok\n62/201 ... ok\n67/202 ... ok\n68/203 ... ok\n68/204 ... ok\n49/205 ... ok\n60/206 ... ok\n69/207 ... ok\n17/208 ... ok\n30/209 ... ok\n10/210 ... repository is empty\n45/211 ... ok\n22/212 ... ok\n17/214 ... ok\n17/215 ... ok\n33/216 ... ok\n40/217 ... ok\n63/218 ... ok\n5/221 ... ok\n64/222 ... ok\n75/223 ... ok\n75/224 ... ok\n38/225 ... ok\n7/226 ... ok\n5/227 ... ok\n33/228 ... ok\n30/229 ... ok\n78/230 ... ok\n33/231 ... ok\n33/233 ... ok\n2/235 ... ok\n5/236 ... ok\n5/237 ... ok\n75/238 ... ok\n5/239 ... ok\n5/240 ... ok\n5/241 ... ok\n5/242 ... ok\n5/243 ... ok\n5/244 ... ok\n77/245 ... ok\n26/246 ... ok\n5/247 ... ok\n62/248 ... ok\n17/249 ... ok\n80/250 ... ok\n87/251 ... ok\n87/254 ... ok\n62/255 ... ok\n82/257 ... ok\n10/258 ... ok\n87/259 ... ok\n87/260 ... ok\n3/261 ... ok\n87/262 ... ok\n63/263 ... ok\n3/264 ... repository is empty\n30/265 ... ok\n93/266 ... ok\n94/267 ... ok\n64/268 ... ok\n26/270 ... ok\n95/271 ... ok\n49/272 ... ok\n62/273 ... ok\n19/274 ... ok\n63/275 ... ok\n19/276 ... ok\n5/277 ... ok\n30/278 ... ok\n77/279 ... ok\n11/280 ... ok\n77/281 ... ok\n87/282 ... ok\n87/284 ... ok\n87/285 ... ok\n87/286 ... ok\n98/287 ... ok\n30/288 ... ok\n62/289 ... ok\n5/290 ... ok\nRunning /opt/gitlab/embedded/service/gitlab-shell/bin/check\nCheck GitLab API access: OK\nRedis available via internal API: OK\n\nAccess to /var/opt/gitlab/.ssh/authorized_keys: OK\ngitlab-shell self-check successful\n\nChecking GitLab Shell ... Finished\n\nChecking Sidekiq ...\n\nRunning? ... yes\nNumber of Sidekiq processes ... 1\n\nChecking Sidekiq ... Finished\n\nReply by email is disabled in config/gitlab.yml\nChecking LDAP ...\n\nServer: ldapmain\nLDAP authentication... Success\nLDAP users with access to your GitLab server (only showing the first 100 results)\n\n(LDAP dump redacted)\n\nChecking LDAP ... Finished\n\nChecking GitLab ...\n\nGit configured correctly? ... yes\nDatabase config exists? ... yes\nAll migrations up? ... yes\nDatabase contains orphaned GroupMembers? ... no\nGitLab config exists? ... yes\nGitLab config up to date? ... yes\nLog directory writable? ... yes\nTmp directory writable? ... yes\nUploads directory exists? ... yes\nUploads directory has correct permissions? ... yes\nUploads directory tmp has correct permissions? ... no\n  Try fixing it:\n  sudo chown -R git /var/opt/gitlab/gitlab-rails/uploads\n  sudo find /var/opt/gitlab/gitlab-rails/uploads -type f -exec chmod 0644 {} \\;\n  sudo find /var/opt/gitlab/gitlab-rails/uploads -type d -not -path /var/opt/gitlab/gitlab-rails/uploads -exec chmod 0700 {} \\;\n  For more information see:\n  doc/install/installation.md in section \"GitLab\"\n  Please fix the error above and rerun the checks.\nInit script exists? ... skipped (omnibus-gitlab has no init script)\nInit script up-to-date? ... skipped (omnibus-gitlab has no init script)\nProjects have namespace: ...\n84/4 ... yes\n84/5 ... yes\n84/6 ... yes\n7/7 ... yes\n84/9 ... yes\n84/10 ... yes\n11/11 ... yes\n11/12 ... yes\n5/17 ... yes\n5/18 ... yes\n5/19 ... yes\n5/20 ... yes\n5/21 ... yes\n10/23 ... yes\n10/24 ... yes\n18/28 ... yes\n12/29 ... yes\n12/30 ... yes\n12/31 ... yes\n11/32 ... yes\n5/33 ... yes\n22/36 ... yes\n20/37 ... yes\n5/39 ... yes\n5/40 ... yes\n5/41 ... yes\n20/42 ... yes\n18/45 ... yes\n26/46 ... yes\n19/48 ... yes\n12/49 ... yes\n10/50 ... yes\n12/53 ... yes\n2/55 ... yes\n18/56 ... yes\n11/57 ... yes\n2/58 ... yes\n28/59 ... yes\n5/60 ... yes\n5/61 ... yes\n2/62 ... yes\n17/63 ... yes\n5/66 ... yes\n17/67 ... yes\n17/68 ... yes\n2/70 ... yes\n17/71 ... yes\n11/72 ... yes\n19/73 ... yes\n19/74 ... yes\n19/76 ... yes\n84/77 ... yes\n10/78 ... yes\n10/79 ... yes\n10/80 ... yes\n30/81 ... yes\n31/82 ... yes\n17/84 ... yes\n22/85 ... yes\n22/87 ... yes\n2/88 ... yes\n2/89 ... yes\n17/90 ... yes\n84/91 ... yes\n84/92 ... yes\n10/94 ... yes\n5/95 ... yes\n10/96 ... yes\n10/97 ... yes\n57/98 ... yes\n41/99 ... yes\n11/100 ... yes\n10/101 ... yes\n2/102 ... yes\n30/103 ... yes\n2/104 ... yes\n33/105 ... yes\n6/106 ... yes\n36/107 ... yes\n37/108 ... yes\n22/109 ... yes\n2/110 ... yes\n19/111 ... yes\n37/112 ... yes\n5/113 ... yes\n2/114 ... yes\n11/115 ... yes\n2/117 ... yes\n2/118 ... yes\n7/120 ... yes\n40/121 ... yes\n41/122 ... yes\n30/123 ... yes\n41/124 ... yes\n17/125 ... yes\n2/126 ... yes\n44/127 ... yes\n46/129 ... yes\n11/130 ... yes\n42/132 ... yes\n19/133 ... yes\n45/137 ... yes\n3/139 ... yes\n41/140 ... yes\n5/141 ... yes\n10/144 ... yes\n30/145 ... yes\n22/146 ... yes\n3/147 ... yes\n17/148 ... yes\n10/149 ... yes\n10/150 ... yes\n48/152 ... yes\n23/153 ... yes\n42/154 ... yes\n42/157 ... yes\n9/159 ... yes\n42/160 ... yes\n22/161 ... yes\n10/162 ... yes\n6/163 ... yes\n6/164 ... yes\n6/165 ... yes\n49/166 ... yes\n5/167 ... yes\n42/168 ... yes\n11/169 ... yes\n42/170 ... yes\n42/171 ... yes\n30/172 ... yes\n11/174 ... yes\n49/175 ... yes\n33/179 ... yes\n19/180 ... yes\n10/181 ... yes\n84/182 ... yes\n84/183 ... yes\n30/184 ... yes\n30/185 ... yes\n60/186 ... yes\n6/187 ... yes\n5/188 ... yes\n30/189 ... yes\n5/190 ... yes\n62/191 ... yes\n10/192 ... yes\n63/193 ... yes\n19/195 ... yes\n2/196 ... yes\n66/197 ... yes\n42/198 ... yes\n49/199 ... yes\n49/200 ... yes\n62/201 ... yes\n67/202 ... yes\n68/203 ... yes\n68/204 ... yes\n49/205 ... yes\n60/206 ... yes\n69/207 ... yes\n17/208 ... yes\n30/209 ... yes\n10/210 ... yes\n45/211 ... yes\n22/212 ... yes\n17/214 ... yes\n17/215 ... yes\n33/216 ... yes\n40/217 ... yes\n63/218 ... yes\n5/221 ... yes\n64/222 ... yes\n75/223 ... yes\n75/224 ... yes\n38/225 ... yes\n7/226 ... yes\n5/227 ... yes\n33/228 ... yes\n30/229 ... yes\n78/230 ... yes\n33/231 ... yes\n33/233 ... yes\n2/235 ... yes\n5/236 ... yes\n5/237 ... yes\n75/238 ... yes\n5/239 ... yes\n5/240 ... yes\n5/241 ... yes\n5/242 ... yes\n5/243 ... yes\n5/244 ... yes\n77/245 ... yes\n26/246 ... yes\n5/247 ... yes\n62/248 ... yes\n17/249 ... yes\n80/250 ... yes\n87/251 ... yes\n87/254 ... yes\n62/255 ... yes\n82/257 ... yes\n10/258 ... yes\n87/259 ... yes\n87/260 ... yes\n3/261 ... yes\n87/262 ... yes\n63/263 ... yes\n3/264 ... yes\n30/265 ... yes\n93/266 ... yes\n94/267 ... yes\n64/268 ... yes\n26/270 ... yes\n95/271 ... yes\n49/272 ... yes\n62/273 ... yes\n19/274 ... yes\n63/275 ... yes\n19/276 ... yes\n5/277 ... yes\n30/278 ... yes\n77/279 ... yes\n11/280 ... yes\n77/281 ... yes\n87/282 ... yes\n87/284 ... yes\n87/285 ... yes\n87/286 ... yes\n98/287 ... yes\n30/288 ... yes\n62/289 ... yes\n5/290 ... yes\nRedis version \u003e= 2.8.0? ... yes\nRuby version \u003e= 2.3.5 ? ... yes (2.4.4)\nGit version \u003e= 2.9.5 ? ... yes (2.17.1)\nGit user has default SSH configuration? ... no\n  Try fixing it:\n  mkdir ~/gitlab-check-backup-1530710676\n  sudo mv /var/opt/gitlab/.ssh/id_rsa ~/gitlab-check-backup-1530710676\n  sudo mv /var/opt/gitlab/.ssh/id_dsa ~/gitlab-check-backup-1530710676\n  sudo mv /var/opt/gitlab/.ssh/id_rsa.pub ~/gitlab-check-backup-1530710676\n  sudo mv /var/opt/gitlab/.ssh/id_dsa.pub ~/gitlab-check-backup-1530710676\n  sudo mv /var/opt/gitlab/.ssh/id_ed25519 ~/gitlab-check-backup-1530710676\n  sudo mv /var/opt/gitlab/.ssh/id_ed25519.pub ~/gitlab-check-backup-1530710676\n  For more information see:\n  doc/ssh/README.md in section \"SSH on the GitLab server\"\n  Please fix the error above and rerun the checks.\nActive users: ... 44\n\nChecking GitLab ... Finished\n\n\u003c/pre\u003e\n\u003c/details\u003e\n\n### Possible fixes\n\nAdd a `nil` check?","state":"closed","created_at":"2018-07-04T13:31:25.012Z","updated_at":"2021-03-03T22:46:38.545Z","closed_at":"2021-03-03T22:46:38.490Z","closed_by":{"id":1931266,"username":"danielgruesso","name":"Daniel Gruesso","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1931266/avatar.png","web_url":"https://gitlab.com/danielgruesso"},"labels":["Category:Source Code Management","[deprecated] Accepting merge requests","[deprecated] üçé","backend","devops::create","good for new contributors","group::source code","missed-SLO","priority::2","section::dev","severity::2","type::bug"],"milestone":{"id":490705,"iid":14,"group_id":9970,"title":"Backlog","description":"Issues that we want to do but are not planned right now. Open for contribution from the community.","state":"active","created_at":"2018-03-22T13:09:23.767Z","updated_at":"2018-10-30T14:56:54.069Z","due_date":null,"start_date":null,"expired":false,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/14"},"assignees":[],"author":{"id":18144,"username":"felixbuenemann","name":"Felix B√ºnemann","state":"active","avatar_url":"https://secure.gravatar.com/avatar/fcd08704d8f15a0006253bd594caa8fd?s=80\u0026d=identicon","web_url":"https://gitlab.com/felixbuenemann"},"type":"ISSUE","assignee":null,"user_notes_count":29,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/23111","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/23111","notes":"https://gitlab.com/api/v4/projects/278964/issues/23111/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/23111/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#23111","relative":"#23111","full":"gitlab-org/gitlab#23111"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":24664904,"iid":23100,"project_id":278964,"title":"GitHub import should handle/ignore bad PRs","description":"Zendesk: https://gitlab.zendesk.com/agent/tickets/99259\n\n\nSome PRs on GitHub no longer have valid corresponding commits in the repo. In this case, GitLab will throw the error below and this and all future PRs fail to import into GitLab. We should handle this more gracefully and at a minimum continue importing all future PRs. Maybe we can also still import the PR while leaving out the Git portion? \n\n```\nRugged::OdbError: object not found - no match for id (f9893d9587b63d12b26b4d5e9eb0233f9d1b3797)\n/opt/gitlab/embedded/service/gitlab-rails/lib/gitlab/git/repository.rb:2389:in `merge_base'\n/opt/gitlab/embedded/service/gitlab-rails/lib/gitlab/git/repository.rb:2389:in `rugged_merge_base'\n/opt/gitlab/embedded/service/gitlab-rails/lib/gitlab/git/repository.rb:558:in `block in merge_base'\n/opt/gitlab/embedded/service/gitla-rails/lib/gitlab/gitaly_client.rb:232:in `block (2 levels) in migrate'\n/opt/gitlab/embedded/service/gitlab-rails/lib/gitlab/gitaly_client.rb:270:in `allow_n_plus_1_calls'\n/opt/gitlab/embedded/service/gitlab-rails/lib/gitlab/gitaly_client.rb:227:in `block in migrate'\n/opt/gitlab/embedded/service/gitlab-rails/lib/gitlab/metrics/influx_db.rb:98:in `measure'\n/opt/gitlab/embedded/service/gitlab-rails/lib/gitlab/gitaly_client.rb:225:in `migrate'\n/opt/gitlab/embedded/service/gitlab-rails/lib/gitlab/git/repository.rb:1338:in `gitaly_migrate'\n/opt/gitlab/embedded/service/gitlab-rails/lib/gitlab/git/repository.rb:554:in `merge_base'\n/opt/gitlab/embedded/service/gitlab-rails/app/models/repository.rb:920:in `merge_base'\n/opt/gitlab/embedded/service/gitlab-rails/app/models/project.rb:588:in `merge_base_commit'\n/opt/gitlab/embedded/service/gitlab-rails/app/models/merge_request_diff.rb:289:in `find_base_sha'\n/opt/gitlab/embedded/service/gitlab-rails/app/models/merge_request_diff.rb:62:in `ensure_commit_shas'\n/opt/gitlab/embedded/service/gitlab-rails/app/models/merge_request_diff.rb:52:in `save_git_content'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activesupport-4.2.10/lib/active_support/callbacks.rb:432:in `block in make_lambda'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activesupport-4.2.10/lib/active_support/callbacks.rb:228:in `block in halting_and_conditional'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activesupport-4.2.10/lib/active_support/callbacks.rb:506:in `block in call'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activesupport-4.2.10/lib/active_support/callbacks.rb:506:in `each'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activesupport-4.2.10/lib/active_support/callbacks.rb:506:in `call'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activesupport-4.2.10/lib/active_support/callbacks.rb:92:in `__run_callbacks__'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activesupport-4.2.10/lib/active_support/callbacks.rb:778:in `_run_create_callbacks'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activerecord-4.2.10/lib/active_record/callbacks.rb:306:in `_create_record'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activerecord-4.2.10/lib/active_record/timestamp.rb:57:in `_create_record'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activerecord-4.2.10/lib/active_record/persistence.rb:504:in `create_or_update'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activerecord-4.2.10/lib/active_record/callbacks.rb:302:in `block in create_or_update'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activesupport-4.2.10/lib/active_support/callbacks.rb:117:in `call'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activesupport-4.2.10/lib/active_support/callbacks.rb:555:in `block (2 levels) in compile'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activesupport-4.2.10/lib/active_support/callbacks.rb:505:in `call'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activesupport-4.2.10/lib/active_support/callbacks.rb:92:in `__run_callbacks__'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activesupport-4.2.10/lib/active_support/callbacks.rb:778:in `_run_save_callbacks'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activerecord-4.2.10/lib/active_record/callbacks.rb:302:in `create_or_update'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activerecord-4.2.10/lib/active_record/persistence.rb:120:in `save'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activerecord-4.2.10/lib/active_record/validations.rb:37:in `save'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activerecord-4.2.10/lib/active_record/attribute_methods/dirty.rb:21:in `save'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activerecord-4.2.10/lib/active_record/transactions.rb:286:in `block (2 levels) in save'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activerecord-4.2.10/lib/active_record/transactions.rb:351:in `block in with_transaction_returning_status'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activerecord-4.2.10/lib/active_record/connection_adapters/abstract/database_statements.rb:211:in `transaction'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activerecord-4.2.10/lib/active_record/transactions.rb:220:in `transaction'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activerecord-4.2.10/lib/active_record/transactions.rb:348:in `with_transaction_returning_status'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activerecord-4.2.10/lib/active_record/transactions.rb:286:in `block in save'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activerecord-4.2.10/lib/active_record/transactions.rb:301:in `rollback_active_record_state!'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activerecord-4.2.10/lib/active_record/transactions.rb:285:in `save'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/state_machines-activerecord-0.4.0/lib/state_machines/integrations/active_record.rb:501:in `block in save'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/state_machines-activerecord-0.4.0/lib/state_machines/integrations/active_record.rb:520:in `block in around_save'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/state_machines-0.4.0/lib/state_machines/transition_collection.rb:150:in `block in run_actions'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/state_machines-0.4.0/lib/state_machines/transition_collection.rb:170:in `catch_exceptions'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/state_machines-0.4.0/lib/state_machines/transition_collection.rb:148:in `run_actions'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/state_machines-0.4.0/lib/state_machines/transition_collection.rb:133:in `run_callbacks'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/state_machines-0.4.0/lib/state_machines/transition_collection.rb:212:in `run_callbacks'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/state_machines-0.4.0/lib/state_machines/transition_collection.rb:63:in `block (2 levels) in perform'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/state_machines-0.4.0/lib/state_machines/transition_collection.rb:63:in `catch'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/state_machines-0.4.0/lib/state_machines/transition_collection.rb:63:in `block in perform'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/state_machines-0.4.0/lib/state_machines/transition_collection.rb:186:in `within_transaction'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/state_machines-0.4.0/lib/state_machines/transition_collection.rb:62:in `perform'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/state_machines-activerecord-0.4.0/lib/state_machines/integrations/active_record.rb:520:in `around_save'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/state_machines-activerecord-0.4.0/lib/state_machines/integrations/active_record.rb:501:in `save'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activerecord-4.2.10/lib/active_record/associations/has_many_association.rb:41:in `insert_record'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activerecord-4.2.10/lib/active_record/associatins/collection_association.rb:506:in `block (2 levels) in _create_record'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activerecord-4.2.10/lib/active_record/associations/collection_association.rb:419:in `replace_on_target'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activerecord-4.2.10/lib/active_record/associations/collection_association.rb:414:in `add_to_target'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activerecord-4.2.10/lib/active_record/associations/collection_association.rb:504:in `block in _create_record'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activerecord-4.2.10/lib/active_record/associations/collection_association.rb:194:in `block in transaction'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activerecord-4.2.10/lib/active_record/connection_adapters/abstract/database_statements.rb:211:in `transaction'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activerecord-4.2.10/lib/active_record/transactions.rb:220:in `transaction'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activerecord-4.2.10/lib/active_record/associations/collection_association.rb:193:in `transaction'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activerecord-4.2.10/lib/active_record/associations/collection_association.rb:503:in `_create_record'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activerecord-4.2.10/lib/active_record/associations/has_many_association.rb:187:in `_create_record'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activerecord-4.2.10/lib/active_record/associations/collection_association.rb:164:in `create'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activerecord-4.2.10/lib/active_record/associations/collection_proxy.rb:290:in `create'\n/opt/gitlab/embedded/service/gitla-rails/lib/gitlab/github_import/importer/pull_request_importer.rb:80:in `block in create_merge_request'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activerecord-4.2.10/lib/active_record/connectio_adapters/abstract/database_statements.rb:213:in `block in transaction'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activerecord-4.2.10/lib/active_record/connection_adapters/abstract/transaction.rb:184:in `within_new_transaction'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activerecord-4.2.10/lib/active_record/connection_adapters/abstract/database_statements.rb:213:in `transaction'\n/opt/gitlab/embedded/lib/ruby/gems2.3.0/gems/activerecord-4.2.10/lib/active_record/transactions.rb:220:in `transaction'\n/opt/gitlab/embedded/service/gitla-rails/lib/gitlab/github_import/importer/pull_request_importer.rb:43:in `create_merge_request'\n/opt/gitlab/embedded/service/gitla-rails/lib/gitlab/github_import/importer/pull_request_importer.rb:25:in `execute'\n/opt/gitlab/embedded/service/gitla-rails/lib/gitlab/github_import/parallel_scheduling.rb:55:in `block in sequential_import'\n/opt/gitlab/embedded/service/gitla-rails/lib/gitlab/github_import/importer/pull_requests_importer.rb:28:in `block in each_object_to_import'\n/opt/gitlab/embedded/service/gitla-rails/lib/gitlab/github_import/parallel_scheduling.rb:99:in `block (2 levels) in each_object_to_import'\n/opt/gitlab/embedded/service/gitlab-rails/lib/gitlab/github_import/parallel_scheduling.rb:96:in `each'\n/opt/gitlab/embedded/service/gitla-rails/lib/gitlab/github_import/parallel_scheduling.rb:96:in `block in each_object_to_import'\n/opt/gitlab/embedded/service/gitlab-rails/lib/gitlab/github_import/client.rb:110:in `each_page'\n/opt/gitlab/embedded/service/gitla-rails/lib/gitlab/github_import/parallel_scheduling.rb:86:in `each_object_to_import'\n/opt/gitlab/embedded/service/gitlabrails/lib/gitlab/github_import/importer/pull_requests_importer.rb:26:in `each_object_to_import'\n/opt/gitlab/embedded/service/gitlab-rails/lib/gitlabgithub_import/parallel_scheduling.rb:52:in `sequential_import'\n/opt/gitlab/embedded/service/gitlab-rails/lib/gitlabgithub_import/parallel_scheduling.rb:33:in `execute'\n/opt/gitlab/embedded/service/gitlab-rails/lib/gitlabgithub_import/sequential_importer.rb:41:in `block in execute'\n/opt/gitlab/embedded/service/gitlab-rails/lib/gitlab/github_import/sequential_importer.rb:40:in `each'\n/opt/gitlab/embedded/service/gitlab-rails/lib/gitlabgithub_import/sequential_importer.rb:40:in `execute'\n/opt/gitlab/embedded/service/gitlab-rails/lib/tasks/import.rake:49:in `block in import!'\n/opt/gitlab/embedded/lib/ruby/2.3.0/benchmark.rb:293:in `measure'\n/opt/gitlab/embedded/service/gitlab-rails/lib/tasks/import.rake:46:in `import!'\n/opt/gitlab/embedded/service/gitlab-rails/lib/tasks/import.rake:27:in `run!'\n/opt/gitlab/embedded/service/gitlab-rails/lib/tasks/import.rake:6:in `run!'\n/opt/gitlab/embedded/service/gitlab-rails/lib/tasks/mport.rake:142:in `block (2 levels) in \u003ctop (required)\u003e'\n/opt/gitlab/embedded/lib/ruby/gems/2.3.0/gems/rake-12.3.0/lib/rake/task.rb:251:in `block in execute'\n/opt/gitlab/embedded/lib/ruby/gems/2.3.0/gems/rake-12.3.0/lib/rake/task.rb:251:in `each'\n/opt/gitlab/embedded/lib/ruby/gems/2.3.0/gems/rake-12.3.0/lib/rake/task.rb:251:in `execute'\n/opt/gitlab/embedded/lib/ruby/gems/2.3.0/gems/rake-1.3.0/lib/rake/task.rb:195:in `block in invoke_with_call_chain'\n/opt/gitlab/embedded/lib/ruby/2.3.0/monitor.rb:214:in `mon_synchronize'\n/opt/gitlab/embedded/lib/ruby/gems/2.3.0/gems/rake-1.3.0/lib/rake/task.rb:188:in `invoke_with_call_chain'\n/opt/gitlab/embedded/lib/ruby/gems/2.3.0/gems/rake-12.3.0/lib/rake/task.rb:181:in `invoke'\n/opt/gitlab/embedded/lib/ruby/gems/2.3.0/gems/rake-12.3.0/lib/rake/application.rb:160:in `invoke_task'\n/opt/gitlab/embedded/lib/ruby/gems/2.3.0/gems/rake-1.3.0/lib/rake/application.rb:116:in `block (2 levels) in top_level'\n/opt/gitlab/embedded/lib/ruby/gems/2.3.0/gems/rake-12.3.0/lib/rake/application.rb:116:in `each'\n/opt/gitlab/embedded/lib/ruby/gems/2.3.0/gems/rake-1.3.0/lib/rake/application.rb:116:in `block in top_level'\n/opt/gitlab/embedded/lib/ruby/gems/2.3.0/gems/rake-1.3.0/lib/rake/application.rb:125:in `run_with_threads'\n/opt/gitlab/embedded/lib/ruby/gems/2.3.0/gems/rake-12.3.0/lib/rake/application.rb:110:in `top_level'\n/opt/gitlab/embedded/lib/ruby/gems/2.3.0/gems/rake-12.3.0/lib/rake/application.rb:83:in `block in run'\n/opt/gitlab/embedded/lib/ruby/gems/2.3.0/gems/rake-1.3.0/lib/rake/application.rb:186:in `standard_exception_handling'\n/opt/gitlab/embedded/lib/ruby/gems/2.3.0/gems/rake-12.3.0/lib/rake/application.rb:80:in `run'\n/opt/gitlab/embedded/lib/ruby/gems/2.3.0/gems/rake-12.3.0/exe/rake:27:in `\u003ctop (required)\u003e'\n/opt/gitlab/embedded/bin/rake:23:in `load'\n/opt/gitlab/embedded/bin/rake:23:in `\u003ctop (required)\u003e'\n/opt/gitlab/embedded/lib/ruby/gems/2.3.0/gems/bundler-1.13.7/lib/bundler/cli/exec.rb:74:in `load'\n/opt/gitlab/embedded/lib/ruby/gems/2.3.0/gems/bundler-1.13.7/lib/bundler/cli/exec.rb:74:in `kernel_load'\n/opt/gitlab/embedded/lib/ruby/gems/2.3.0/gems/bundler-1.13.7/lib/bundler/cli/exec.rb:27:in `run'\n/opt/gitlab/embedded/lib/ruby/gems/2.3.0/gems/bundler-1.13.7/lib/bundler/cli.rb:332:in `exec'\n/opt/gitlab/embedded/lib/ruby/gems/2.3.0/gems/bundle-1.13.7/lib/bundler/vendor/thor/lib/thor/command.rb:27:in `run'\n/opt/gitlab/embedded/lib/ruby/gems/2.3.0/gems/bundle-1.13.7/lib/bundler/vendor/thor/lib/thor/invocation.rb:126:in `invoke_command'\n/opt/gitlab/embedded/lib/ruby/gems/2.3.0/gems/bundle-1.13.7/lib/bundler/vendor/thor/lib/thor.rb:359:in `dispatch'\n/opt/gitlab/embedded/lib/ruby/gems/2.3.0/gems/bundler-1.13.7/lib/bundler/cli.rb:20:in `dispatch'\n/opt/gitlab/embedded/lib/ruby/gems/2.3.0/gems/bundler1.13.7/lib/bundler/vendor/thor/lib/thor/base.rb:440:in `start'\n/opt/gitlab/embedded/lib/ruby/gems/2.3.0/gems/bundler-1.13.7/lib/bundler/cli.rb:11:in `start'\n/opt/gitlab/embedded/lib/ruby/gems/2.3.0/gems/bundler-1.13.7/exe/bundle:34:in `block in \u003ctop(required)\u003e'\n/opt/gitlab/embedded/lib/ruby/gems/2.3.0/gems/bundler-1.13.7/lib/bundler/friendly_errors.rb100i `with_friendly_errors'\n/opt/gitlab/embedded/lib/ruby/gems/2.3.0/gems/bundler-1.13.7/exe/bundle:26:in `\u003ctop (required)\u003e'\n/opt/gitlab/embedded/bin/bundle:23:in `load'\n\n/opt/gitlab/embedded/bin/bundle:23:in `\u003cmain\u003e'\n```\n\n@dbalexandre @rdavila Any thoughts here?\n@stanhu You've been working in import-land recently so I'll mention you, too.","state":"closed","created_at":"2018-07-03T20:54:49.829Z","updated_at":"2022-08-31T08:23:07.868Z","closed_at":"2021-09-21T18:00:47.020Z","closed_by":{"id":3841241,"username":"dstull","name":"Doug Stull","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c2d7b8532bca28f593b193b012841a40?s=80\u0026d=identicon","web_url":"https://gitlab.com/dstull"},"labels":["Category:Importers","Github","Importer:GitHub","Observability","customer","devops::manage","group::import","movingtogitlab","priority::2","section::dev","severity::3","type::bug"],"milestone":{"id":1850126,"iid":62,"group_id":9970,"title":"14.2","description":"","state":"active","created_at":"2021-01-26T16:57:35.404Z","updated_at":"2021-07-22T19:45:42.498Z","due_date":"2021-08-17","start_date":"2021-07-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/62"},"assignees":[{"id":3841241,"username":"dstull","name":"Doug Stull","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c2d7b8532bca28f593b193b012841a40?s=80\u0026d=identicon","web_url":"https://gitlab.com/dstull"}],"author":{"id":13356,"username":"dblessing","name":"Drew Blessing","state":"active","avatar_url":"https://secure.gravatar.com/avatar/b5bf44866b4eeafa2d8114bfe15da02f?s=80\u0026d=identicon","web_url":"https://gitlab.com/dblessing"},"type":"ISSUE","assignee":{"id":3841241,"username":"dstull","name":"Doug Stull","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c2d7b8532bca28f593b193b012841a40?s=80\u0026d=identicon","web_url":"https://gitlab.com/dstull"},"user_notes_count":18,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/23100","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/23100","notes":"https://gitlab.com/api/v4/projects/278964/issues/23100/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/23100/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#23100","relative":"#23100","full":"gitlab-org/gitlab#23100"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":6618,"epic":{"id":332691,"iid":6618,"title":"Manage:Import Customer Escalations","url":"/groups/gitlab-org/-/epics/6618","group_id":9970,"human_readable_end_date":"Dec 16, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12532663,"iid":6802,"project_id":278964,"title":"Show milestones in roadmap","description":"\u003e As a user of roadmaps,\n\n\u003e I need to be able to see current milestones on my roadmap,\n\n\u003e So I can see if my current work is moving forward properly or if I am in danger of missing deadlines\n\n- For viewing milestones on the roadmap, milestones would be viewable on the roadmap and one could click on their titles to navigate to the milestone page\n- We show project or group milestones in this view ‚Äî but only milestones of issues contained in the epics being shown. This gives an indication of how epics are being shaped around milestones.\n- Milestones should be displayed at top of roadmap view but are not fixed, allowing users to scroll past them\n- Users should be able to filter by milestones via Filter Bar, same as they do on Issue and Epic List pages\n\n### Proposal\n\n| Milestones | Hover state |\n| ------ | ------ |\n| ![image](https://gitlab.com/gitlab-org/gitlab/uploads/4ef441ef000b2670c26fefe1c9510de5/image.png) | ![image](https://gitlab.com/gitlab-org/gitlab/uploads/04d83f6a116685fc3702e7255293c8ae/image.png) |\n\n*  Specs: https://gitlab-org.gitlab.io/gitlab-design/hosted/alexis/%236802-show-milestones-in-roadmap-spec-previews/#artboard0\n*  The title of the milestone is horizontal sticky left (8px from the left roadmap column containing the epic titles) when the milestone is longer than the roadmap view or if the start of the milestone has scrolled left off of the roadmap view. This allows the user to view the milestone title at all times. This is fairly similar to what we did with roadmap item content in https://gitlab.com/gitlab-org/gitlab/merge_requests/18957\n*  Titles truncate when they have reached the length of the milestone.\n*  Milestones stack. The height of the `milestone` row grows as the stack grows.\n*  When a user *hovers* on a milestone:\n   * A popover with the milestone title, type (group, subgroup, project), and date appears.\n   * Dashed lines appear at and under the start and end of the milestone to give better reference to these dates while a user is viewing the roadmap.\n   * Milestone hover color is `#2e2e2e`\n*  When a user *clicks* a milestone:\n   * The user is directed to that milestone page (this is something we should research. It is the basic pattern we have currently but ideally we wouldn't be navigating the user away from the roadmap).\n*  Empty states\n    * User has epics but no milestones \n        *  Hide the `milestone` row for MVC and display the epic items (similar to how the roadmap currently looks)\n    * User has milestones but no epics\n        * For MVC I think we could assume that there is not value in seeing milestones on a roadmap with no epic items. In that case a user would see basically the same empty states they see now (either if they have no epics, or no epics with dates, etc), then milestones AND epics once they have added epics or epic dates.\n\n* [Interested Customer](https://gitlab.lightning.force.com/lightning/r/Account/0016100001CXGCsAAP/view)\n* [Interested Customer](https://gitlab.my.salesforce.com/00161000010fYg0)\n* [Interested Prospect](https://gitlab.my.salesforce.com/0064M00000V6EZW)\n\n## Feature flag\n`:milestones_in_roadmap`\n\u003c!-- triage-serverless v3 PLEASE DO NOT REMOVE THIS SECTION --\u003e\n*This page may contain information related to upcoming products, features and functionality.\nIt is important to note that the information presented is for informational purposes only, so please do not rely on the information for purchasing or planning purposes.\nJust like with all projects, the items mentioned on the page are subject to change or delay, and the development, release, and timing of any products, features, or functionality remain at the sole discretion of GitLab Inc.*\n\u003c!-- triage-serverless v3 PLEASE DO NOT REMOVE THIS SECTION --\u003e","state":"closed","created_at":"2018-07-03T17:30:10.134Z","updated_at":"2022-05-19T16:28:10.550Z","closed_at":"2020-03-30T11:46:19.363Z","closed_by":{"id":3507264,"username":"donaldcook","name":"Donald Cook","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3507264/avatar.png","web_url":"https://gitlab.com/donaldcook"},"labels":["Category:Portfolio Management","Enterprise Edition","GitLab Premium","GitLab Ultimate","Technical Writing","backend","customer","devops::plan","direction","docs::feature","documentation","frontend","group::product planning","planning priority","roadmaps","type::feature","workflow::verification"],"milestone":{"id":1104429,"iid":46,"group_id":9970,"title":"12.10","description":"https://about.gitlab.com/releases/2020/04/22/gitlab-12-10-released","state":"closed","created_at":"2019-12-20T15:15:53.243Z","updated_at":"2020-10-08T12:00:39.852Z","due_date":"2020-04-17","start_date":"2020-03-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/46"},"assignees":[{"id":426128,"username":"felipe_artur","name":"Felipe Artur","state":"active","avatar_url":"https://secure.gravatar.com/avatar/dbad92659914f56621cbdd726e283e60?s=80\u0026d=identicon","web_url":"https://gitlab.com/felipe_artur"},{"id":3617348,"username":"uhlexsis","name":"Alexis Ginsberg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3617348/avatar.png","web_url":"https://gitlab.com/uhlexsis"},{"id":4846639,"username":"fguibert","name":"Florie Guibert","state":"active","avatar_url":"https://secure.gravatar.com/avatar/705331e7e375d5832c9fa5309370b55f?s=80\u0026d=identicon","web_url":"https://gitlab.com/fguibert"}],"author":{"id":626804,"username":"pedroms","name":"Pedro Moreira da Silva","state":"active","avatar_url":"https://secure.gravatar.com/avatar/c306f087d191ac15549f3c11e3bed321?s=80\u0026d=identicon","web_url":"https://gitlab.com/pedroms"},"type":"ISSUE","assignee":{"id":426128,"username":"felipe_artur","name":"Felipe Artur","state":"active","avatar_url":"https://secure.gravatar.com/avatar/dbad92659914f56621cbdd726e283e60?s=80\u0026d=identicon","web_url":"https://gitlab.com/felipe_artur"},"user_notes_count":83,"merge_requests_count":1,"upvotes":9,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6802","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6802","notes":"https://gitlab.com/api/v4/projects/278964/issues/6802/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6802/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6802","relative":"#6802","full":"gitlab-org/gitlab#6802"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1997,"epic":{"id":13322,"iid":1997,"title":"Milestones and Start/Due Dates in Roadmaps","url":"/groups/gitlab-org/-/epics/1997","group_id":9970,"human_readable_end_date":"Apr 17, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":24664889,"iid":23088,"project_id":278964,"title":"Web IDE loses location when switching between files","description":"\u003c!---\nPlease read this!\n\nBefore opening a new issue, make sure to search for keywords in the issues\nfiltered by the \"regression\" or \"bug\" label.\n\nFor the Community Edition issue tracker:\n\n- https://gitlab.com/gitlab-org/gitlab-ce/issues?label_name%5B%5D=regression\n- https://gitlab.com/gitlab-org/gitlab-ce/issues?label_name%5B%5D=bug\n\nFor the Enterprise Edition issue tracker:\n\n- https://gitlab.com/gitlab-org/gitlab-ee/issues?label_name%5B%5D=regression\n- https://gitlab.com/gitlab-org/gitlab-ee/issues?label_name%5B%5D=bug\n\nand verify the issue you're about to submit isn't a duplicate.\n---\u003e\n\n### Summary\n\nWhen reviewing an MR in the Web IDE, editor tabs do not remember their file location when switching between files. This is especially annoying when attempting to reference other files while reviewing as you have to re-find your place when you switch back to the initial file.\n\n### Steps to reproduce\n\n1. Create a merge request affecting multiple files with ~300+ lines in at least one file\n2. Open the Web IDE view\n3. Scroll down in one of the files\n4. Switch to another file\n5. Switch back to the original file; position is reset to top\n\n### Example Project\n\n**Project**: https://gitlab.com/mrburrito/web-ide-scroll-issue\n\n**MR exhibiting behavior**: https://gitlab.com/mrburrito/web-ide-scroll-issue/merge_requests/1\n\n### What is the current *bug* behavior?\n\nWhen switching tabs in the Web IDE, file position is reset to line 1.\n\n### What is the expected *correct* behavior?\n\nFile position is maintained when returning to a file that was previously viewed. If I have scrolled to line 200 in `File1`, that scroll position should be remembered after I've viewed `File2` and returned to `File1`.\n\n### Output of checks\n\nThis bug happens on GitLab.com","state":"closed","created_at":"2018-07-03T14:36:26.061Z","updated_at":"2021-09-06T03:03:06.156Z","closed_at":"2021-09-06T03:03:06.133Z","closed_by":{"id":1786152,"username":"gitlab-bot","name":"ü§ñ GitLab Bot ü§ñ","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1786152/avatar.png","web_url":"https://gitlab.com/gitlab-bot"},"labels":["Category:Web IDE","Create [DEPRECATED]","UX","[deprecated] Accepting merge requests","auto closed","devops::create","frontend","group::editor","priority::3","section::dev","severity::3","stale","type::bug","vintage"],"milestone":{"id":490705,"iid":14,"group_id":9970,"title":"Backlog","description":"Issues that we want to do but are not planned right now. Open for contribution from the community.","state":"active","created_at":"2018-03-22T13:09:23.767Z","updated_at":"2018-10-30T14:56:54.069Z","due_date":null,"start_date":null,"expired":false,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/14"},"assignees":[],"author":{"id":434424,"username":"mrburrito","name":"Gordon Shankman","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/434424/avatar.png","web_url":"https://gitlab.com/mrburrito"},"type":"ISSUE","assignee":null,"user_notes_count":9,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/23088","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/23088","notes":"https://gitlab.com/api/v4/projects/278964/issues/23088/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/23088/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#23088","relative":"#23088","full":"gitlab-org/gitlab#23088"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":4258,"epic":{"id":99288,"iid":4258,"title":"Create:Editor - Quality Improvements","url":"/groups/gitlab-org/-/epics/4258","group_id":9970,"human_readable_end_date":"Feb 17, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12524264,"iid":6794,"project_id":278964,"title":"Hashed storage specs use development repositories","description":"This one `spec/services/projects/hashed_storage/migrate_attachments_service_spec.rb:16`, and I suspect some other, depend on what we have in `repositories` directory in local GDK. As we use Project ID to chose the actual name of a hashed repo, the collision with development env is possible and very likely (about 100%)\n\n/cc @brodock","state":"closed","created_at":"2018-07-03T11:29:46.533Z","updated_at":"2019-12-16T14:50:55.629Z","closed_at":"2018-11-09T18:16:49.082Z","closed_by":{"id":59678,"username":"vsizov","name":"Valery Sizov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/59678/avatar.png","web_url":"https://gitlab.com/vsizov"},"labels":["Category:Geo Replication","Enterprise Edition","[deprecated] Accepting merge requests","devops::systems","group::geo","priority::4","severity::3","test","type::bug","workflow::in dev"],"milestone":{"id":569990,"iid":21,"group_id":9970,"title":"11.6","description":"","state":"closed","created_at":"2018-06-16T19:56:12.651Z","updated_at":"2019-01-08T21:40:29.892Z","due_date":"2018-12-22","start_date":"2018-11-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/21"},"assignees":[{"id":59678,"username":"vsizov","name":"Valery Sizov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/59678/avatar.png","web_url":"https://gitlab.com/vsizov"}],"author":{"id":59678,"username":"vsizov","name":"Valery Sizov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/59678/avatar.png","web_url":"https://gitlab.com/vsizov"},"type":"ISSUE","assignee":{"id":59678,"username":"vsizov","name":"Valery Sizov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/59678/avatar.png","web_url":"https://gitlab.com/vsizov"},"user_notes_count":6,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6794","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6794","notes":"https://gitlab.com/api/v4/projects/278964/issues/6794/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6794/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6794","relative":"#6794","full":"gitlab-org/gitlab#6794"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":75,"epic":{"id":140,"iid":75,"title":"Geo: Hashed Storage GA","url":"/groups/gitlab-org/-/epics/75","group_id":9970,"human_readable_end_date":"Jun 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12457311,"iid":6772,"project_id":278964,"title":"Allow to customize maven execution using a specific settings.xml for Dependency Scanning","description":"### Problem to solve\n\nMaven environment can be configured using a `setting.xml` file. We should provide a way to allow customization of Dependency Scanning for Maven projects. \n\n### Further details\n\nExample use case: [configure credentials for fetching custom artifacts from private Maven repository](https://gitlab.com/gitlab-org/gitlab-ee/issues/6711)\n(Include use cases, benefits, and/or goals)\n\n### Proposal\n\nTODO\n\n### What does success look like, and how can we measure that?\n\n(If no way to measure success, link to an issue that will implement a way to measure this)\n\n### Links / references","state":"closed","created_at":"2018-06-29T20:24:33.818Z","updated_at":"2020-11-13T16:55:34.358Z","closed_at":"2019-12-13T16:01:42.461Z","closed_by":{"id":3913516,"username":"NicoleSchwartz","name":"Nicole Schwartz","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3913516/avatar.png","web_url":"https://gitlab.com/NicoleSchwartz"},"labels":["Category:Dependency Scanning","Enterprise Edition","GitLab Ultimate","backend","customer","devops::secure","group::composition analysis","type::feature"],"milestone":null,"assignees":[{"id":4668304,"username":"ifrenkel","name":"Igor Frenkel","state":"active","avatar_url":"https://secure.gravatar.com/avatar/a73e8113c53ac25297ce751e59bbb1d3?s=80\u0026d=identicon","web_url":"https://gitlab.com/ifrenkel"}],"author":{"id":52092,"username":"gonzoyumo","name":"Olivier Gonzalez","state":"active","avatar_url":"https://secure.gravatar.com/avatar/651e0ff81c3995a05269f7c80895fe89?s=80\u0026d=identicon","web_url":"https://gitlab.com/gonzoyumo"},"type":"ISSUE","assignee":{"id":4668304,"username":"ifrenkel","name":"Igor Frenkel","state":"active","avatar_url":"https://secure.gravatar.com/avatar/a73e8113c53ac25297ce751e59bbb1d3?s=80\u0026d=identicon","web_url":"https://gitlab.com/ifrenkel"},"user_notes_count":18,"merge_requests_count":0,"upvotes":11,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6772","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6772","notes":"https://gitlab.com/api/v4/projects/278964/issues/6772/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6772/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6772","relative":"#6772","full":"gitlab-org/gitlab#6772"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":298,"epic":{"id":641,"iid":298,"title":"Dependency Scanning improvements","url":"/groups/gitlab-org/-/epics/298","group_id":9970,"human_readable_end_date":"Apr 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":24664809,"iid":23036,"project_id":278964,"title":"Convert Environment Details page from HAML to Vue with GraphQL","description":"While the [Screen_Shot_2018-06-29_at_21.08.59](/uploads/8274e7c915079bfe0746aee843de0a3a/Screen_Shot_2018-06-29_at_21.08.59.png) is implemented in Vue, the page to show an [Screen_Shot_2018-06-29_at_21.10.19](/uploads/97d3655fd757d60e69fd74dc52b2ee53/Screen_Shot_2018-06-29_at_21.10.19.png) is still implemented in HAML.\n\nWe should refactor this page to\n\n- improve performance when switching between environments overview and individual environment\n- improve performance when triggering actions on an environment\n- reduce maintenance costs and costs for new features (less duplication)\n\nTo complete this issue we need a new API endpoint which lists the deployments of an environment (https://gitlab.com/gitlab-org/gitlab-ce/issues/25084).\n\n## Techincal Proposal\n\n* Use [GraphQL API](https://docs.gitlab.com/ee/api/graphql/reference/#fields-with-arguments-15) to render deployment page.\n* Use `GlTableLite` to render the table\n* Integrate the existing Vue apps on the page: `ee/app/assets/javascripts/environments/components/environment_approval.vue` and `app/assets/javascripts/environments/components/environments_detail_header.vue`\n\n### Logic optimization\n\nhttps://gitlab.com/gitlab-org/gitlab/-/issues/367410\n\n- In deployments index page, Frontend checks if the environment is protected, and if so, the details of the protection (e.g. who can deploy/approve). We can use [this query](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/96221) for this purpose.\n- If the environment is protected and requires an approval, frontend renders the approval button in all rows. When a user clicks the button, frontend renders the approval details. We can use [this query](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/97102) for this purpose.\n- By this reason, we don't need to check `find_approval_rule_for` for every deployment rows. We can drop the legacy path.\n- The frontend will need to be rewritten in Vue in order to use this endpoint: https://gitlab.com/gitlab-org/gitlab/-/issues/23036","state":"closed","created_at":"2018-06-29T19:24:03.949Z","updated_at":"2022-12-21T12:05:44.432Z","closed_at":"2022-12-14T13:43:19.475Z","closed_by":{"id":12455340,"username":"andrei.zubov","name":"Andrei Zubov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/12455340/avatar.png","web_url":"https://gitlab.com/andrei.zubov"},"labels":["Category:Environment Management","Category:Release Orchestration","Deliverable","Release::P1","UX","devops::release","environments","frontend","group::release","maintenance::refactor","section::ops","type::maintenance","workflow::in dev"],"milestone":{"id":2717597,"iid":82,"group_id":9970,"title":"15.7","description":"","state":"active","created_at":"2022-07-29T14:48:31.199Z","updated_at":"2022-07-29T14:48:31.199Z","due_date":"2022-12-17","start_date":"2022-11-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/82"},"assignees":[{"id":12455340,"username":"andrei.zubov","name":"Andrei Zubov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/12455340/avatar.png","web_url":"https://gitlab.com/andrei.zubov"}],"author":{"id":1212235,"username":"winh","name":"Inactive Account","state":"active","avatar_url":"https://secure.gravatar.com/avatar/e34b010c96ff3f44c62cddf66607232a?s=80\u0026d=identicon","web_url":"https://gitlab.com/winh"},"type":"ISSUE","assignee":{"id":12455340,"username":"andrei.zubov","name":"Andrei Zubov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/12455340/avatar.png","web_url":"https://gitlab.com/andrei.zubov"},"user_notes_count":25,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/23036","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":3,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/23036","notes":"https://gitlab.com/api/v4/projects/278964/issues/23036/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/23036/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#23036","relative":"#23036","full":"gitlab-org/gitlab#23036"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":9024,"epic":{"id":626278,"iid":9024,"title":"Improve Environment Details page to show all of the related changes","url":"/groups/gitlab-org/-/epics/9024","group_id":9970,"human_readable_end_date":"Mar 17, 2023","human_readable_timestamp":"\u003cstrong\u003e2\u003c/strong\u003e months remaining"},"iteration":null,"health_status":null},{"id":12454223,"iid":6769,"project_id":278964,"title":"Epics API does not include upvotes or downvotes","description":"The Epics API is inconsistent with the Issues API and does not include upvotes/downvotes on the API.\n\nUpvotes and downvotes is useful information and it should be available via the API.\n\n### Proposal\n\n- Add `upvotes` and `downvotes` to `GET /groups/:id/epics/:epic_iid` resource\n\n### Links / references\n\nhttps://docs.gitlab.com/ee/api/epics.html#single-epic","state":"closed","created_at":"2018-06-29T16:22:23.637Z","updated_at":"2022-05-19T16:29:24.605Z","closed_at":"2019-01-25T04:33:51.435Z","closed_by":{"id":572018,"username":"nick.thomas","name":"Nick Thomas","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/572018/avatar.png","web_url":"https://gitlab.com/nick.thomas"},"labels":["Category:Portfolio Management","Enterprise Edition","backend","devops::plan","epics","type::feature","workflow::in review"],"milestone":{"id":581391,"iid":23,"group_id":9970,"title":"11.8","description":"","state":"closed","created_at":"2018-06-26T15:15:18.359Z","updated_at":"2019-03-08T17:33:19.162Z","due_date":"2019-02-22","start_date":"2019-01-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/23"},"assignees":[{"id":590748,"username":"mdelaossa","name":"Mario de la Ossa","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/590748/avatar.png","web_url":"https://gitlab.com/mdelaossa"}],"author":{"id":1187333,"username":"jramsay-gitlab","name":"James Ramsay (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1187333/avatar.png","web_url":"https://gitlab.com/jramsay-gitlab"},"type":"ISSUE","assignee":{"id":590748,"username":"mdelaossa","name":"Mario de la Ossa","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/590748/avatar.png","web_url":"https://gitlab.com/mdelaossa"},"user_notes_count":3,"merge_requests_count":1,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6769","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6769","notes":"https://gitlab.com/api/v4/projects/278964/issues/6769/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6769/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6769","relative":"#6769","full":"gitlab-org/gitlab#6769"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":12450422,"iid":6766,"project_id":278964,"title":"Performance MR widget is expandable even when there are no changes","description":"We currently show an exclamation mark and allow the content area to be expanded when there are no changes to performance metrics. \n\nInstead of an `!`, we should show a green check or some similar notification. It doesn't need attention.\n\n![image__3_](/uploads/e732d843ac8e92fce1497441332e10c0/image__3_.png)\n\n#### Design\nIt shows a green check mark (`$green-500`) when there are no changes to performance metrics.\n\n\n![ee_6766-performance-mr-widget-is-expandable-even-when-there-are-no-changes](/uploads/cc783ef9bf51d226db25d5cbde80b857/ee_6766-performance-mr-widget-is-expandable-even-when-there-are-no-changes.png)","state":"closed","created_at":"2018-06-29T13:06:11.611Z","updated_at":"2019-08-12T15:20:27.802Z","closed_at":"2018-08-07T22:25:43.963Z","closed_by":{"id":502136,"username":"fatihacet","name":"Fatih Acet","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/502136/avatar.png","web_url":"https://gitlab.com/fatihacet"},"labels":["Deliverable","Enterprise Edition","devops::monitor","type::bug"],"milestone":{"id":494367,"iid":15,"group_id":9970,"title":"11.2","description":"","state":"closed","created_at":"2018-03-27T19:26:05.990Z","updated_at":"2018-11-06T19:16:51.951Z","due_date":"2018-08-22","start_date":"2018-07-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/15"},"assignees":[{"id":577113,"username":"hazelyang","name":"Hazel Yang","state":"active","avatar_url":"https://secure.gravatar.com/avatar/e84e4d70639ad1177276340868d7f074?s=80\u0026d=identicon","web_url":"https://gitlab.com/hazelyang"},{"id":832471,"username":"psimyn","name":"Simon Knox","state":"active","avatar_url":"https://secure.gravatar.com/avatar/3de75939c39eecd6ea2215ec740a8037?s=80\u0026d=identicon","web_url":"https://gitlab.com/psimyn"}],"author":{"id":926632,"username":"joshlambert","name":"Joshua Lambert","state":"active","avatar_url":"https://secure.gravatar.com/avatar/a0bdc5209b11e9c0953f80234dcb4ffb?s=80\u0026d=identicon","web_url":"https://gitlab.com/joshlambert"},"type":"ISSUE","assignee":{"id":577113,"username":"hazelyang","name":"Hazel Yang","state":"active","avatar_url":"https://secure.gravatar.com/avatar/e84e4d70639ad1177276340868d7f074?s=80\u0026d=identicon","web_url":"https://gitlab.com/hazelyang"},"user_notes_count":12,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6766","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6766","notes":"https://gitlab.com/api/v4/projects/278964/issues/6766/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6766/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6766","relative":"#6766","full":"gitlab-org/gitlab#6766"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":12415959,"iid":6752,"project_id":278964,"title":"All Gitlab branches listed in Jira task in Development section","description":"### Summary\nA branch is displayed in all repos in stead of only 1 corresponding.\nAfter creation of a branch \u0026 a commit to it, a branch is listed for all repositories instead of a corresponding one in Jira Development panel (see screenshots below)\n\nJira / Gitlab EE Ul (self hosted) was configured according to https://docs.gitlab.com/ee/integration/jira_development_panel.html\n\n### Steps to reproduce\n\nCreate a branch, commit, see Jira task with all repositories mentioned for a branch (see screenshots below)\n\n![Screen_Shot_2018-06-20_at_13.57.42](/uploads/6e6af983f0ad2afecde197bbfaaef9eb/Screen_Shot_2018-06-20_at_13.57.42.png)\n![Screenshot_from_2018-06-28_14-30-15](/uploads/289ad37c57d6ef0709ff69d6b043066f/Screenshot_from_2018-06-28_14-30-15.png)","state":"closed","created_at":"2018-06-28T11:38:33.478Z","updated_at":"2022-05-19T16:29:24.410Z","closed_at":"2018-08-21T09:13:19.920Z","closed_by":{"id":443319,"username":"smcgivern","name":"Sean McGivern","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/443319/avatar.png","web_url":"https://gitlab.com/smcgivern"},"labels":["Deliverable","Enterprise Edition","Integration::Jira","backend","customer","devops::plan","type::bug"],"milestone":{"id":502939,"iid":17,"group_id":9970,"title":"11.3","description":"","state":"closed","created_at":"2018-04-09T17:59:35.838Z","updated_at":"2018-11-06T19:17:11.721Z","due_date":"2018-09-22","start_date":"2018-08-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/17"},"assignees":[{"id":590748,"username":"mdelaossa","name":"Mario de la Ossa","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/590748/avatar.png","web_url":"https://gitlab.com/mdelaossa"}],"author":{"id":1879000,"username":"vainkop","name":"Valerii Vainkop","state":"active","avatar_url":"https://secure.gravatar.com/avatar/10bb85c5f95b5eda029a0cf89717de93?s=80\u0026d=identicon","web_url":"https://gitlab.com/vainkop"},"type":"ISSUE","assignee":{"id":590748,"username":"mdelaossa","name":"Mario de la Ossa","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/590748/avatar.png","web_url":"https://gitlab.com/mdelaossa"},"user_notes_count":33,"merge_requests_count":1,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6752","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6752","notes":"https://gitlab.com/api/v4/projects/278964/issues/6752/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6752/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6752","relative":"#6752","full":"gitlab-org/gitlab#6752"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":12392480,"iid":6731,"project_id":278964,"title":"Docker image CE 10.8.4 (2268d0c) to gitlab-ee=11.0.1-ee.0 upgrade fail","description":"\u003c!---\nPlease read this!\n\nBefore opening a new issue, make sure to search for keywords in the issues\nfiltered by the \"regression\" or \"bug\" label.\n\nFor the Community Edition issue tracker:\n\n- https://gitlab.com/gitlab-org/gitlab-ce/issues?label_name%5B%5D=regression\n- https://gitlab.com/gitlab-org/gitlab-ce/issues?label_name%5B%5D=bug\n\nFor the Enterprise Edition issue tracker:\n\n- https://gitlab.com/gitlab-org/gitlab-ee/issues?label_name%5B%5D=regression\n- https://gitlab.com/gitlab-org/gitlab-ee/issues?label_name%5B%5D=bug\n\nand verify the issue you're about to submit isn't a duplicate.\n---\u003e\n\n### Summary\n\nJust pull gitlab-ee=11.0.1-ee.0 over 10.8.4 and upgrade crash at migrations . \n\n### Steps to reproduce\n\nPull new image (lastes) over 10.8.4\n\n```\ngit_1    | \ngit_1    | bash[migrate gitlab-rails database] (gitlab::database_migrations line 49) had an error: Mixlib::ShellOut::ShellCommandFailed: Expected process to exit with [0], but received '1'\ngit_1    | ---- Begin output of \"bash\"  \"/tmp/chef-script20180627-43-kqqliz\" ----\ngit_1    | STDOUT: rake aborted!\ngit_1    | StandardError: An error has occurred, this and all later migrations canceled:\ngit_1    | \ngit_1    | PG::DuplicateColumn: ERROR:  column \"issues_template\" of relation \"projects\" already exists\ngit_1    | : ALTER TABLE \"projects\" ADD \"issues_template\" text\ngit_1    | /opt/gitlab/embedded/service/gitlab-rails/config/initializers/postgresql_limit_fix.rb:6:in `add_column'\ngit_1    | /opt/gitlab/embedded/service/gitlab-rails/ee/db/migrate/20150929160851_add_issues_template_to_project.rb:3:in `change'\ngit_1    | /opt/gitlab/embedded/service/gitlab-rails/lib/tasks/gitlab/db.rake:50:in `block (3 levels) in \u003ctop (required)\u003e'\ngit_1    | /opt/gitlab/embedded/bin/bundle:23:in `load'\ngit_1    | /opt/gitlab/embedded/bin/bundle:23:in `\u003cmain\u003e'\ngit_1    | \ngit_1    | Caused by:\ngit_1    | ActiveRecord::StatementInvalid: PG::DuplicateColumn: ERROR:  column \"issues_template\" of relation \"projects\" already exists\ngit_1    | : ALTER TABLE \"projects\" ADD \"issues_template\" text\ngit_1    | /opt/gitlab/embedded/service/gitlab-rails/config/initializers/postgresql_limit_fix.rb:6:in `add_column'\ngit_1    | /opt/gitlab/embedded/service/gitlab-rails/ee/db/migrate/20150929160851_add_issues_template_to_project.rb:3:in `change'\ngit_1    | /opt/gitlab/embedded/service/gitlab-rails/lib/tasks/gitlab/db.rake:50:in `block (3 levels) in \u003ctop (required)\u003e'\ngit_1    | /opt/gitlab/embedded/bin/bundle:23:in `load'\ngit_1    | /opt/gitlab/embedded/bin/bundle:23:in `\u003cmain\u003e'\ngit_1    | \ngit_1    | Caused by:\ngit_1    | PG::DuplicateColumn: ERROR:  column \"issues_template\" of relation \"projects\" already exists\ngit_1    | /opt/gitlab/embedded/service/gitlab-rails/config/initializers/postgresql_limit_fix.rb:6:in `add_column'\ngit_1    | /opt/gitlab/embedded/service/gitlab-rails/ee/db/migrate/20150929160851_add_issues_template_to_project.rb:3:in `change'\ngit_1    | /opt/gitlab/embedded/service/gitlab-rails/lib/tasks/gitlab/db.rake:50:in `block (3 levels) in \u003ctop (required)\u003e'\ngit_1    | /opt/gitlab/embedded/bin/bundle:23:in `load'\ngit_1    | /opt/gitlab/embedded/bin/bundle:23:in `\u003cmain\u003e'\ngit_1    | Tasks: TOP =\u003e db:migrate\ngit_1    | (See full trace by running task with --trace)\ngit_1    | == 20140319135450 InitEESchema: migrating =====================================\ngit_1    | -- add_column(:namespaces, :ldap_cn, :string, {:null=\u003etrue})\ngit_1    |    -\u003e 0.0032s\ngit_1    | -- add_column(:namespaces, :ldap_access, :integer, {:null=\u003etrue})\ngit_1    |    -\u003e 0.0004s\ngit_1    | -- create_table(:git_hooks)\ngit_1    |    -\u003e 0.0215s\ngit_1    | == 20140319135450 InitEESchema: migrated (0.0252s) ============================\ngit_1    | \ngit_1    | == 20140414093351 CreateAppearances: migrating ================================\ngit_1    | -- table_exists?(:appearances)\ngit_1    |    -\u003e 0.0011s\ngit_1    | == 20140414093351 CreateAppearances: migrated (0.0011s) =======================\ngit_1    | \ngit_1    | == 20140508105809 AddMrTemplateToProject: migrating ===========================\ngit_1    | -- add_column(:projects, :merge_requests_template, :text)\ngit_1    |    -\u003e 0.0019s\ngit_1    | == 20140508105809 AddMrTemplateToProject: migrated (0.0019s) ==================\ngit_1    | \ngit_1    | == 20140513095908 AddUsernamePasswordApiVersionToServices: migrating ==========\ngit_1    | -- add_column(:services, :username, :string)\ngit_1    |    -\u003e 0.0014s\ngit_1    | -- add_column(:services, :password, :string)\ngit_1    |    -\u003e 0.0006s\ngit_1    | -- add_column(:services, :api_version, :string)\ngit_1    |    -\u003e 0.0008s\ngit_1    | == 20140513095908 AddUsernamePasswordApiVersionToServices: migrated (0.0028s) =\ngit_1    | \ngit_1    | == 20140811083829 AddUnsubscribedAtFieldToUsers: migrating ====================\ngit_1    | -- add_column(:users, :admin_email_unsubscribed_at, :datetime)\ngit_1    |    -\u003e 0.0012s\ngit_1    | == 20140811083829 AddUnsubscribedAtFieldToUsers: migrated (0.0012s) ===========\ngit_1    | \ngit_1    | == 20140811155127 AddJiraIssueTransitionIdToServices: migrating ===============\ngit_1    | -- add_column(:services, :jira_issue_transition_id, :string, {:default=\u003e\"2\"})\ngit_1    |    -\u003e 0.0230s\ngit_1    | == 20140811155127 AddJiraIssueTransitionIdToServices: migrated (0.0296s) ======\ngit_1    | \ngit_1    | == 20140813090117 AddLdapGroupsTable: migrating ===============================\ngit_1    | -- create_table(:ldap_groups)\ngit_1    |    -\u003e 0.0080s\ngit_1    | == 20140813090117 AddLdapGroupsTable: migrated (0.0081s) ======================\ngit_1    | \ngit_1    | == 20140813133925 RenameLdapGroupToLdapGroupLink: migrating ===================\ngit_1    | -- rename_table(:ldap_groups, :ldap_group_links)\ngit_1    |    -\u003e 0.0153s\ngit_1    | -- execute(\"INSERT INTO ldap_group_links ( group_access, cn, group_id, created_at, updated_at )\\n             SELECT ldap_access, ldap_cn, id, DATE('2018-06-27 15:58:12'), DATE('2018-06-27 15:58:12') FROM namespaces\\n             WHERE ldap_cn IS NOT NULL;\")\ngit_1    |    -\u003e 0.0016s\ngit_1    | == 20140813133925 RenameLdapGroupToLdapGroupLink: migrated (0.0171s) ==========\ngit_1    | \ngit_1    | == 20140907223153 RemoveColumnsForServices: migrating =========================\ngit_1    | -- remove_column(:services, :username, :string)\ngit_1    |    -\u003e 0.0012s\ngit_1    | -- remove_column(:services, :password, :string)\ngit_1    |    -\u003e 0.0004s\ngit_1    | -- remove_column(:services, :jira_issue_transition_id, :string)\ngit_1    |    -\u003e 0.0008s\ngit_1    | -- remove_column(:services, :api_version, :string)\ngit_1    |    -\u003e 0.0004s\ngit_1    | == 20140907223153 RemoveColumnsForServices: migrated (0.0028s) ================\ngit_1    | \ngit_1    | == 20141010132608 AddProviderToLdapGroupLinks: migrating ======================\ngit_1    | -- add_column(:ldap_group_links, :provider, :string)\ngit_1    |    -\u003e 0.0005s\ngit_1    | == 20141010132608 AddProviderToLdapGroupLinks: migrated (0.0005s) =============\ngit_1    | \ngit_1    | == 20141027173526 AddAuthorEmailRegexToGitHook: migrating =====================\ngit_1    | -- add_column(:git_hooks, :author_email_regex, :string)\ngit_1    |    -\u003e 0.0006s\ngit_1    | == 20141027173526 AddAuthorEmailRegexToGitHook: migrated (0.0007s) ============\ngit_1    | \ngit_1    | == 20141030133853 AddMemberCheckToGitHooks: migrating =========================\ngit_1    | -- add_column(:git_hooks, :member_check, :boolean, {:default=\u003efalse, :null=\u003efalse})\ngit_1    |    -\u003e 0.0090s\ngit_1    | == 20141030133853 AddMemberCheckToGitHooks: migrated (0.0091s) ================\ngit_1    | \ngit_1    | == 20141103160516 AddFileNameRegexToGitHooks: migrating =======================\ngit_1    | -- add_column(:git_hooks, :file_name_regex, :string)\ngit_1    |    -\u003e 0.0006s\ngit_1    | == 20141103160516 AddFileNameRegexToGitHooks: migrated (0.0006s) ==============\ngit_1    | \ngit_1    | == 20141212124604 AddGroupMembershipLock: migrating ===========================\ngit_1    | -- add_column(:namespaces, :membership_lock, :boolean, {:default=\u003efalse})\ngit_1    |    -\u003e 0.0379s\ngit_1    | == 20141212124604 AddGroupMembershipLock: migrated (0.0380s) ==================\ngit_1    | \ngit_1    | == 20141213212220 AddHeaderLogosToAppearances: migrating ======================\ngit_1    | -- add_column(:appearances, :dark_logo, :string)\ngit_1    |    -\u003e 0.0015s\ngit_1    | -- add_column(:appearances, :light_logo, :string)\ngit_1    |    -\u003e 0.0005s\ngit_1    | == 20141213212220 AddHeaderLogosToAppearances: migrated (0.0021s) =============\ngit_1    | \ngit_1    | == 20141230100055 RemoveOldFieldsFromNamespace: migrating =====================\ngit_1    | -- remove_column(:namespaces, :ldap_cn)\ngit_1    |    -\u003e 0.0006s\ngit_1    | -- remove_column(:namespaces, :ldap_access)\ngit_1    |    -\u003e 0.0004s\ngit_1    | == 20141230100055 RemoveOldFieldsFromNamespace: migrated (0.0011s) ============\ngit_1    | \ngit_1    | == 20150125163158 AddRebaseSettingToProjects: migrating =======================\ngit_1    | -- add_column(:projects, :merge_requests_rebase_default, :boolean, {:default=\u003etrue})\ngit_1    |    -\u003e 0.0533s\ngit_1    | == 20150125163158 AddRebaseSettingToProjects: migrated (0.0534s) ==============\ngit_1    | \ngit_1    | == 20150225214822 HelpTextToApplicationSettings: migrating ====================\ngit_1    | -- add_column(:application_settings, :help_text, :text)\ngit_1    |    -\u003e 0.0015s\ngit_1    | == 20150225214822 HelpTextToApplicationSettings: migrated (0.0016s) ===========\ngit_1    | \ngit_1    | == 20150312000132 AddGroupIdToWebHooks: migrating =============================\ngit_1    | -- add_column(:web_hooks, :group_id, :integer, {:after=\u003e:project_id})\ngit_1    |    -\u003e 0.0013s\ngit_1    | == 20150312000132 AddGroupIdToWebHooks: migrated (0.0014s) ====================\ngit_1    | \ngit_1    | == 20150324223425 AddIsSampleToGitHooks: migrating ============================\ngit_1    | -- add_column(:git_hooks, :is_sample, :boolean, {:default=\u003efalse})\ngit_1    |    -\u003e 0.0114s\ngit_1    | == 20150324223425 AddIsSampleToGitHooks: migrated (0.0115s) ===================\ngit_1    | \ngit_1    | == 20150501095306 CreateLicenses: migrating ===================================\ngit_1    | -- create_table(:licenses)\ngit_1    |    -\u003e 0.0061s\ngit_1    | == 20150501095306 CreateLicenses: migrated (0.0062s) ==========================\ngit_1    | \ngit_1    | == 20150507194350 CreateHistoricalData: migrating =============================\ngit_1    | -- create_table(:historical_data)\ngit_1    |    -\u003e 0.0038s\ngit_1    | == 20150507194350 CreateHistoricalData: migrated (0.0038s) ====================\ngit_1    | \ngit_1    | == 20150605131047 AddMaxFileSizeToGitHooks: migrating =========================\ngit_1    | -- add_column(:git_hooks, :max_file_size, :integer, {:default=\u003e0})\ngit_1    |    -\u003e 0.0069s\ngit_1    | == 20150605131047 AddMaxFileSizeToGitHooks: migrated (0.0070s) ================\ngit_1    | \ngit_1    | == 20150609113337 CreateApproves: migrating ===================================\ngit_1    | -- create_table(:approvals)\ngit_1    |    -\u003e 0.0045s\ngit_1    | == 20150609113337 CreateApproves: migrated (0.0046s) ==========================\ngit_1    | \ngit_1    | == 20150609125332 AddProjectMergeApproves: migrating ==========================\ngit_1    | -- add_column(:projects, :approvals_before_merge, :integer, {:null=\u003efalse, :default=\u003e0})\ngit_1    |    -\u003e 0.0596s\ngit_1    | == 20150609125332 AddProjectMergeApproves: migrated (0.0597s) =================\ngit_1    | \ngit_1    | == 20150707222220 AddApproversTable: migrating ================================\ngit_1    | -- create_table(:approvers)\ngit_1    |    -\u003e 0.0215s\ngit_1    | == 20150707222220 AddApproversTable: migrated (0.0216s) =======================\ngit_1    | \ngit_1    | == 20150709134649 AddResetApproversToProject: migrating =======================\ngit_1    | -- add_column(:projects, :reset_approvers_on_push, :boolean, {:default=\u003etrue})\ngit_1    |    -\u003e 0.0470s\ngit_1    | == 20150709134649 AddResetApproversToProject: migrated (0.0471s) ==============\ngit_1    | \ngit_1    | == 20150717155058 RenameResetApprovers: migrating =============================\ngit_1    | -- rename_column(:projects, :reset_approvers_on_push, :reset_approvals_on_push)\ngit_1    |    -\u003e 0.0177s\ngit_1    | == 20150717155058 RenameResetApprovers: migrated (0.0179s) ====================\ngit_1    | \ngit_1    | == 20150731200022 RemoveInvalidApprovers: migrating ===========================\ngit_1    | -- execute(\"DELETE FROM approvers WHERE user_id = 0\")\ngit_1    |    -\u003e 0.0007s\ngit_1    | == 20150731200022 RemoveInvalidApprovers: migrated (0.0007s) ==================\ngit_1    | \ngit_1    | == 20150827144737 MigrateRebaseFeature: migrating =============================\ngit_1    | -- execute(\"UPDATE projects SET merge_requests_ff_only_enabled = TRUE WHERE merge_requests_rebase_enabled IS TRUE\")\ngit_1    |    -\u003e 0.0032s\ngit_1    | -- remove_column(:projects, :merge_requests_rebase_default)\ngit_1    |    -\u003e 0.0007s\ngit_1    | == 20150827144737 MigrateRebaseFeature: migrated (0.0040s) ====================\ngit_1    | \ngit_1    | == 20150929160851 AddIssuesTemplateToProject: migrating =======================\ngit_1    | -- add_column(:projects, :issues_template, :text)\ngit_1    | STDERR: \ngit_1    | ---- End output of \"bash\"  \"/tmp/chef-script20180627-43-kqqliz\" ----\ngit_1    | Ran \"bash\"  \"/tmp/chef-script20180627-43-kqqliz\" returned 1\ngit_1    |\n```","state":"closed","created_at":"2018-06-27T16:04:12.747Z","updated_at":"2022-05-19T16:29:23.623Z","closed_at":"2020-11-02T12:18:10.702Z","closed_by":{"id":1786152,"username":"gitlab-bot","name":"ü§ñ GitLab Bot ü§ñ","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1786152/avatar.png","web_url":"https://gitlab.com/gitlab-bot"},"labels":["Enterprise Edition","[deprecated] Accepting merge requests","auto closed","backend","devops::plan","priority::3","section::dev","settings","severity::3","stale","support request","type::bug","vintage"],"milestone":{"id":490705,"iid":14,"group_id":9970,"title":"Backlog","description":"Issues that we want to do but are not planned right now. Open for contribution from the community.","state":"active","created_at":"2018-03-22T13:09:23.767Z","updated_at":"2018-10-30T14:56:54.069Z","due_date":null,"start_date":null,"expired":false,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/14"},"assignees":[],"author":{"id":2515954,"username":"anpavlov","name":"Anton Pavlov","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8caec6354b76d1661c2247c2f56d2fdc?s=80\u0026d=identicon","web_url":"https://gitlab.com/anpavlov"},"type":"ISSUE","assignee":null,"user_notes_count":12,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6731","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6731","notes":"https://gitlab.com/api/v4/projects/278964/issues/6731/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6731/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6731","relative":"#6731","full":"gitlab-org/gitlab#6731"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":12392201,"iid":6727,"project_id":278964,"title":"Link the License Management report in the MR widget with the pipeline level one","description":"### Problem to solve\n\nIn the MR widget, we have a diff view for License Management. We also have a pipeline level view.\n\nWe can link the two together like we do for Security Reports.\n\n### Proposal\n\nA button in the MR widget will bring directly to the related License Management report at the pipeline level. It is something we are doing for Security Reports, so we can be consistent and use the same approach here.\n\n![license-management-report-link](/uploads/eac3ec977dd83ac85e1a226c05535ce2/license-management-report-link.jpg)\n\n- ‚ÄúView full report‚Äù button should be linked to the license management report in the pipeline page (https://gitlab.com/gitlab-org/gitlab-ee/issues/5491).\n- The gap between ‚ÄúView full report‚Äù and ‚ÄúManage licenses‚Äù is `8px` because they are related.\n- The gap between ‚ÄúManage licenses‚Äù and ‚ÄúCollapse‚Äù is `16px`.\n","state":"closed","created_at":"2018-06-27T15:48:52.019Z","updated_at":"2019-11-18T15:59:09.189Z","closed_at":"2018-08-06T11:02:44.317Z","closed_by":{"id":482476,"username":"filipa","name":"Filipa Lacerda","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/482476/avatar.png","web_url":"https://gitlab.com/filipa"},"labels":["Category:License Compliance","Deliverable","Enterprise Edition","GitLab Ultimate","devops::secure","frontend","merge requests","type::feature","workflow::in review"],"milestone":{"id":494367,"iid":15,"group_id":9970,"title":"11.2","description":"","state":"closed","created_at":"2018-03-27T19:26:05.990Z","updated_at":"2018-11-06T19:16:51.951Z","due_date":"2018-08-22","start_date":"2018-07-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/15"},"assignees":[{"id":181229,"username":"leipert","name":"Lukas 'Eipi' Eipert","state":"active","avatar_url":"https://secure.gravatar.com/avatar/19a1f1260fa70323f35bc508927921a2?s=80\u0026d=identicon","web_url":"https://gitlab.com/leipert"},{"id":1125848,"username":"samdbeckham","name":"Sam Beckham","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1125848/avatar.png","web_url":"https://gitlab.com/samdbeckham"},{"id":2003748,"username":"jeethukarthik","name":"Jeethu Karthik","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2003748/avatar.png","web_url":"https://gitlab.com/jeethukarthik"}],"author":{"id":1273957,"username":"bikebilly","name":"Fabio Busatto","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1273957/avatar.png","web_url":"https://gitlab.com/bikebilly"},"type":"ISSUE","assignee":{"id":181229,"username":"leipert","name":"Lukas 'Eipi' Eipert","state":"active","avatar_url":"https://secure.gravatar.com/avatar/19a1f1260fa70323f35bc508927921a2?s=80\u0026d=identicon","web_url":"https://gitlab.com/leipert"},"user_notes_count":10,"merge_requests_count":1,"upvotes":2,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6727","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6727","notes":"https://gitlab.com/api/v4/projects/278964/issues/6727/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6727/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6727","relative":"#6727","full":"gitlab-org/gitlab#6727"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":144,"epic":{"id":257,"iid":144,"title":"License Management MVC","url":"/groups/gitlab-org/-/epics/144","group_id":9970,"human_readable_end_date":"Aug 22, 2018","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12387738,"iid":6709,"project_id":278964,"title":"Group-level Security Dashboard","description":"### Problem to solve\n\nWe have Security Dashboard MVC (https://gitlab.com/gitlab-org/gitlab-ee/issues/6709) for a single project, but Security teams normally want to have a wider view of Security for multiple projects at the same time, for example all the projects in a specific group.\n\n### Proposal\n\nImplement the Security Dashboard as a group level feature. It is accessible at **Overview \u003e Security Dashboard**.\n\nThe Dashboard is organized into three sections:\n1. a summary with a set of colored boxes, one for each severity level (Critical, High, Medium, Low, Unknown)\n  1. each box has a different color\n  1. each box contains the total number of vulnerabilities across all the projects in the group for the given severity\n  1. these counters are not updated when results are filtered\n  1. in this iteration, numbers are not clickable\n1. a filter bar\n  1. users can filter by different properties (Severity, Project, Confidence)\n1. a list of vulnerabilities\n  1. the list is organized into tabs (All, SAST, Dependency Scanning, Container Scanning, DAST)\n    1. _TBD_ what about tabs where no data is available (missing feature/report)\n    1. clicking a tab \"filters\" by that source type only\n    1. tabs titles have numbers showing total\n  1. for each row, information for the given vulnerability is shown\n    1. first line: vulnerability name (clickable, brings to details window)\n    1. second line: project name (_TBD_ clickable, brings to the project-level security dashboard)\n  1. action items are present\n    1. create an issue\n    1. dismiss vulnerability\n  1. items are sorted by severity, TBD secondary value\n  1. lists are paginated\n\nThe details window is the same used for security reports, but it contains also an additional entry with the link to the project.\n\n### Dashboard MVC Design\n\n| Dashboard | \n| --------- |\n| *global changes: vulnerability count headers now sentence case. Labels added above dropdowns. List horizontal lines extended to full-width of list.* \n| ![dashboard-mvc-security-dashboard](/uploads/8f1db9b65b4cf218dbf69fc062b0f47d/dashboard-mvc-security-dashboard.png)|\n| **Empty state** | \n| *change: left aligning paragraph text, change to button text* | \n| ![Security-dashboard-MVC-empty-state](/uploads/9ebacca562e5acda72b46f1a87a829ea/Security-dashboard-MVC-empty-state.png) | \n| **Loading state:** | \n| We will use skeleton loading :skull\\_crossbones: | \n| **Hover state** |\n| ![Security-dashboard-hover-state](/uploads/06505f4ca517d7ae40952df23fce5e05/Security-dashboard-hover-state.png) |\n| **Undo state** | \n| ![dashboard-mvc-security-dashboard-undo-example](/uploads/0f462047c62ddb0a0584ca054455f109/dashboard-mvc-security-dashboard-undo-example.png)| \n| **More information Modal** | \n| ![dashboard-mvc-more-info-modal](/uploads/bea7a5137f6d3d43ad31ff52bbcd0a44/dashboard-mvc-more-info-modal.png)| \n| **Issue created state:** | \n| how do we indicate to the user that they have created an issue on this vulnerability? the issue flag should stay with the vulnerabiltiy until it has been dismissed. |\n| ![Security-dashboard-issue_created](/uploads/276fd5feb4979bf73ea85f5e123241e4/Security-dashboard-issue_created.png)| \n| **Issue created hover state:** | \n| The issue icon now replaces the create new issue icon. The hover state on this new button is the newly created issue name, and the button takes the user to the issue | \n| ![Security-dashboard-issue-created-hover-state](/uploads/14237e4f1a96d77f4fa5bcab63c88bf9/Security-dashboard-issue-created-hover-state.png) | \n| **Popover state for analyzers** |\n| We need a way to inform users that we are currently just showing SAST and that the other tools will be available soon. Clicking the question mark icon will reveal the popover, at this time the question mark icon is replaced by the close icon for the user to dismiss the popover. | \n| ![Security-dashboard-analyzer-popover](/uploads/6a1ac33c9d9cae9ab45334dab066fbe9/Security-dashboard-analyzer-popover.png) | \n| **In-line hover states for icon_buttons** | \n| ![Inline-button-hover-states](/uploads/26cb84f67baef05eb2fbd38f2745685a/Inline-button-hover-states.png) | \n\n### What does success look like, and how can we measure that?\n\nPeople use the Security Dashboard to manage security of their projects. Measure the number of page views for the Group Security Dashboard.","state":"closed","created_at":"2018-06-27T13:22:29.187Z","updated_at":"2022-10-26T15:31:02.223Z","closed_at":"2018-11-08T03:14:25.149Z","closed_by":{"id":52092,"username":"gonzoyumo","name":"Olivier Gonzalez","state":"active","avatar_url":"https://secure.gravatar.com/avatar/651e0ff81c3995a05269f7c80895fe89?s=80\u0026d=identicon","web_url":"https://gitlab.com/gonzoyumo"},"labels":["Deliverable","Enterprise Edition","GitLab Ultimate","[deprecated] Accepting merge requests","backend","devops::secure","direction","frontend","missed-deliverable","missed:11.4","release post item","security dashboard","type::feature"],"milestone":{"id":567672,"iid":20,"group_id":9970,"title":"11.5","description":"","state":"closed","created_at":"2018-06-14T17:32:22.627Z","updated_at":"2018-12-20T06:50:07.124Z","due_date":"2018-11-22","start_date":"2018-10-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/20"},"assignees":[{"id":52092,"username":"gonzoyumo","name":"Olivier Gonzalez","state":"active","avatar_url":"https://secure.gravatar.com/avatar/651e0ff81c3995a05269f7c80895fe89?s=80\u0026d=identicon","web_url":"https://gitlab.com/gonzoyumo"},{"id":1125848,"username":"samdbeckham","name":"Sam Beckham","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1125848/avatar.png","web_url":"https://gitlab.com/samdbeckham"},{"id":2338871,"username":"andyvolpe","name":"Andy Volpe","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2338871/avatar.png","web_url":"https://gitlab.com/andyvolpe"}],"author":{"id":1273957,"username":"bikebilly","name":"Fabio Busatto","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1273957/avatar.png","web_url":"https://gitlab.com/bikebilly"},"type":"ISSUE","assignee":{"id":52092,"username":"gonzoyumo","name":"Olivier Gonzalez","state":"active","avatar_url":"https://secure.gravatar.com/avatar/651e0ff81c3995a05269f7c80895fe89?s=80\u0026d=identicon","web_url":"https://gitlab.com/gonzoyumo"},"user_notes_count":128,"merge_requests_count":0,"upvotes":2,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6709","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":7,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6709","notes":"https://gitlab.com/api/v4/projects/278964/issues/6709/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6709/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6709","relative":"#6709","full":"gitlab-org/gitlab#6709"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":161,"epic":{"id":288,"iid":161,"title":"Security Dashboard MVC","url":"/groups/gitlab-org/-/epics/161","group_id":9970,"human_readable_end_date":"Nov 22, 2018","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12384279,"iid":6702,"project_id":278964,"title":"Pushing new changes to a MR retains prior approvals","description":"\u003c!---\nPlease read this!\n\nBefore opening a new issue, make sure to search for keywords in the issues\nfiltered by the \"regression\" or \"bug\" label.\n\nFor the Community Edition issue tracker:\n\n- https://gitlab.com/gitlab-org/gitlab-ce/issues?label_name%5B%5D=regression\n- https://gitlab.com/gitlab-org/gitlab-ce/issues?label_name%5B%5D=bug\n\nFor the Enterprise Edition issue tracker:\n\n- https://gitlab.com/gitlab-org/gitlab-ee/issues?label_name%5B%5D=regression\n- https://gitlab.com/gitlab-org/gitlab-ee/issues?label_name%5B%5D=bug\n\nand verify the issue you're about to submit isn't a duplicate.\n---\u003e\n\n### Summary\n\nPushing new changes to a MR retains approvals even if _‚ÄúRemove all approvals in a merge request when new commits are pushed to its source branch‚Äù_ is checked\n\n### Steps to reproduce\n\n1. create a new project\n1. verify ‚ÄúRemove all approvals in a merge request when new commits are pushed to its source branch‚Äù is checked in setting\n1. create a MR\n1. approve with another user\n1. push new changes to the MR\n1. verify the approval are not removed\n\n### Example Project\n\n- nolith-tests/mr-accept!1\n- gitlab-pages!97\n\n### What is the current *bug* behavior?\n\nAfter pushing new changes approvals are retained\n\n### What is the expected *correct* behavior?\n\nApprovals should be cleared after new changes are pushed","state":"closed","created_at":"2018-06-27T10:19:32.290Z","updated_at":"2021-08-20T05:36:03.737Z","closed_at":"2018-09-14T13:45:17.017Z","closed_by":{"id":87854,"username":"DouweM","name":"Douwe Maan","state":"active","avatar_url":"https://secure.gravatar.com/avatar/73d1548ae618321220679b3a4fda7fb1?s=80\u0026d=identicon","web_url":"https://gitlab.com/DouweM"},"labels":["Create [DEPRECATED]","Deliverable","Enterprise Edition","approvals","backend","devops::create","merge requests","priority::3","severity::3","type::bug","workflow::in review"],"milestone":{"id":567670,"iid":19,"group_id":9970,"title":"11.4","description":"","state":"closed","created_at":"2018-06-14T17:31:41.249Z","updated_at":"2018-12-20T06:49:55.749Z","due_date":"2018-10-22","start_date":"2018-09-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/19"},"assignees":[{"id":117638,"username":"tiagonbotelho","name":"Tiago Botelho","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/117638/avatar.png","web_url":"https://gitlab.com/tiagonbotelho"}],"author":{"id":376774,"username":"nolith","name":"Alessio Caiazza","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/376774/avatar.png","web_url":"https://gitlab.com/nolith"},"type":"ISSUE","assignee":{"id":117638,"username":"tiagonbotelho","name":"Tiago Botelho","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/117638/avatar.png","web_url":"https://gitlab.com/tiagonbotelho"},"user_notes_count":12,"merge_requests_count":1,"upvotes":2,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6702","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6702","notes":"https://gitlab.com/api/v4/projects/278964/issues/6702/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6702/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6702","relative":"#6702","full":"gitlab-org/gitlab#6702"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":12372654,"iid":6699,"project_id":278964,"title":"Stack trace of error from uploading image for object storage spews into screen","description":"I enabled object storage uploads in my GDK, and then when I attached a file, I saw this stack trace spew into the window:\n\n![image](/uploads/209e112e5c3169b2e7f4e4af3d221e1f/image.png)\n\nLooks like I got this error by spelling the wrong region (`us-wet-1` instead of `us-west-1`).\n\n/cc: @mbergeron","state":"closed","created_at":"2018-06-27T04:32:33.332Z","updated_at":"2022-05-19T16:29:23.410Z","closed_at":"2018-09-09T23:24:31.445Z","closed_by":{"id":711023,"username":"victorwu","name":"Victor Wu","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/711023/avatar.png","web_url":"https://gitlab.com/victorwu"},"labels":["Enterprise Edition","Object Storage","backend","devops::plan","type::bug","workflow::in review"],"milestone":{"id":502939,"iid":17,"group_id":9970,"title":"11.3","description":"","state":"closed","created_at":"2018-04-09T17:59:35.838Z","updated_at":"2018-11-06T19:17:11.721Z","due_date":"2018-09-22","start_date":"2018-08-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/17"},"assignees":[{"id":2220432,"username":"crollison","name":"Chantal Rollison","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2220432/avatar.png","web_url":"https://gitlab.com/crollison"}],"author":{"id":64248,"username":"stanhu","name":"Stan Hu","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/64248/stanhu.jpg","web_url":"https://gitlab.com/stanhu"},"type":"ISSUE","assignee":{"id":2220432,"username":"crollison","name":"Chantal Rollison","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2220432/avatar.png","web_url":"https://gitlab.com/crollison"},"user_notes_count":10,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6699","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6699","notes":"https://gitlab.com/api/v4/projects/278964/issues/6699/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6699/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6699","relative":"#6699","full":"gitlab-org/gitlab#6699"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":24664713,"iid":22986,"project_id":278964,"title":"Frontend support for sharing groups with groups","description":"### Overview\n\nhttps://gitlab.com/gitlab-org/gitlab-ce/issues/33054 covers the backend work for sharing groups with groups. While we have pre-existing UI we can lean on for most of the frontend work, we still may need some FE support to implement the new change.\n\nThe approach should add a tab to the group members page (`groups/GROUP-NAME/-/group_members`) and duplicate our configuration and styling on the project members page:\n\n![image](/uploads/01da3ee5d3116ac6d0fed354a6fc1756/image.png)\n\nThis issue can be closed when gitlab-ce#33054 is done.\n\n### Proposal\n\n| Invite member | Invite group |\n| ------------- | ------------ |\n| ![invite-member](/uploads/ccf8837b38769b6e28ef6631ec55f3c8/invite-member.png) | ![invite-group](/uploads/e8a343af57dfe9734e76c883a269da4d/invite-group.png) |\n\nThe UI for inviting a member to the group will also need to be adapted following the format used in project settings. The following changes will be necessary:\n\n- Change the page title: {+Group m+}{-M-}embers\n- Change the page description to: 'You can invite a new member or a group to `group name`'\n- Add tabs: 'Invite member' and 'Invite group'\n\nCopy for 'Invite member' tab:\n- First field\n  - Label: Select members to invite\n  - Placeholder: Search for members to update or invite\n- Second field\n  - Label: Choose a role permission\n  - Default value: Guest\n  - Help text: [Read more]() about role permissions\n- Third field\n  - Label: Access expiration date\n  - Placeholder: Expiration date\n- Button\n  - Label: Invite\n\nCopy for 'Invite group' tab:\n- First field\n  - Label: Select a group to invite\n  - Placeholder: Search for a group\n- Second field\n  - Label: Max access level\n  - Default value: Guest\n  - Help text: [Read more]() about role permissions\n- Third field\n  - Label: Access expiration date\n  - Placeholder: Expiration date\n- Button\n  - Label: Invite","state":"closed","created_at":"2018-06-26T21:21:05.026Z","updated_at":"2020-01-20T16:14:54.864Z","closed_at":"2020-01-20T16:14:54.810Z","closed_by":{"id":1230286,"username":"xanf","name":"Illya Klymov","state":"active","avatar_url":"https://secure.gravatar.com/avatar/ce4d16557b46210fa57641531b570dd4?s=80\u0026d=identicon","web_url":"https://gitlab.com/xanf"},"labels":["Category:Subgroups","Category:User Management","Deliverable","devops::manage","estimation::completed","frontend","group::spaces DEPRECATED","missed-deliverable","missed:11.4","missed:12.2","missed:12.3","missed:12.4","missed:12.5","priority::1","type::feature","workflow::verification"],"milestone":{"id":891798,"iid":41,"group_id":9970,"title":"12.7","description":"https://about.gitlab.com/releases/2020/01/22/gitlab-12-7-released/","state":"closed","created_at":"2019-05-31T08:38:04.523Z","updated_at":"2020-05-19T13:46:24.737Z","due_date":"2020-01-17","start_date":"2019-12-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/41"},"assignees":[{"id":1086520,"username":"jeremy-gl","name":"Jeremy Watson (ex-GitLab)","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1086520/avatar.png","web_url":"https://gitlab.com/jeremy-gl"},{"id":1230286,"username":"xanf","name":"Illya Klymov","state":"active","avatar_url":"https://secure.gravatar.com/avatar/ce4d16557b46210fa57641531b570dd4?s=80\u0026d=identicon","web_url":"https://gitlab.com/xanf"}],"author":{"id":1086520,"username":"jeremy-gl","name":"Jeremy Watson (ex-GitLab)","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1086520/avatar.png","web_url":"https://gitlab.com/jeremy-gl"},"type":"ISSUE","assignee":{"id":1086520,"username":"jeremy-gl","name":"Jeremy Watson (ex-GitLab)","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1086520/avatar.png","web_url":"https://gitlab.com/jeremy-gl"},"user_notes_count":38,"merge_requests_count":0,"upvotes":4,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/22986","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/22986","notes":"https://gitlab.com/api/v4/projects/278964/issues/22986/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/22986/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#22986","relative":"#22986","full":"gitlab-org/gitlab#22986"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":12867473,"iid":6963,"project_id":278964,"title":"Mobile view for pod logs has an alignment issue","description":"The mobile view, at least on an iPhone X, has an alignment issues with the pod logs and the buttons.\n\n- The buttons are below the header\n- The pod log view is too narrow\n\n![IMG_0355](/uploads/cc4e1ae0cc422d015e9148197161577b/IMG_0355.png)","state":"closed","created_at":"2018-06-25T20:55:54.864Z","updated_at":"2019-08-12T15:20:45.337Z","closed_at":"2018-07-20T18:37:32.615Z","closed_by":{"id":408677,"username":"ClemMakesApps","name":"Clement Ho","state":"active","avatar_url":"https://secure.gravatar.com/avatar/013b4af8b474654bce8039ecd262a84a?s=80\u0026d=identicon","web_url":"https://gitlab.com/ClemMakesApps"},"labels":["Deliverable","Enterprise Edition","devops::monitor","frontend","type::bug"],"milestone":{"id":494367,"iid":15,"group_id":9970,"title":"11.2","description":"","state":"closed","created_at":"2018-03-27T19:26:05.990Z","updated_at":"2018-11-06T19:16:51.951Z","due_date":"2018-08-22","start_date":"2018-07-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/15"},"assignees":[{"id":201566,"username":"annabeldunstone","name":"Annabel Dunstone Gray","state":"active","avatar_url":"https://secure.gravatar.com/avatar/85c0203926134720f9a9aa8c6e264c78?s=80\u0026d=identicon","web_url":"https://gitlab.com/annabeldunstone"}],"author":{"id":926632,"username":"joshlambert","name":"Joshua Lambert","state":"active","avatar_url":"https://secure.gravatar.com/avatar/a0bdc5209b11e9c0953f80234dcb4ffb?s=80\u0026d=identicon","web_url":"https://gitlab.com/joshlambert"},"type":"ISSUE","assignee":{"id":201566,"username":"annabeldunstone","name":"Annabel Dunstone Gray","state":"active","avatar_url":"https://secure.gravatar.com/avatar/85c0203926134720f9a9aa8c6e264c78?s=80\u0026d=identicon","web_url":"https://gitlab.com/annabeldunstone"},"user_notes_count":3,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6963","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6963","notes":"https://gitlab.com/api/v4/projects/278964/issues/6963/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6963/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6963","relative":"#6963","full":"gitlab-org/gitlab#6963"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":12327310,"iid":6674,"project_id":278964,"title":"Extract EE specific files/lines for Create lib/api","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003elib/api/api.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/lib/api/api.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/api/api.rb\nindex 4dd1b459554..872b556cbfb 100644\n--- a/lib/api/api.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/api/api.rb\n@@ -29,6 +29,13 @@ module API\n     prefix :api\n \n     version 'v3', using: :path do\n+      ## EE-specific API V3 endpoints START\n+      # Although the following endpoints are kept behind V3 namespace, they're not\n+      # deprecated neither should be removed when V3 get removed.\n+      # They're needed as a layer to integrate with Jira Development Panel.\n+      mount ::API::V3::Github\n+      ## EE-specific API V3 endpoints END\n+\n       route :any, '*path' do\n         error!('API V3 is no longer supported. Use API V4 instead.', 410)\n       end\n@@ -115,14 +122,17 @@ module API\n     mount ::API::GroupVariables\n     mount ::API::ImportGithub\n     mount ::API::Internal\n+    mount ::API::IssuableBulkUpdate\n     mount ::API::Issues\n     mount ::API::JobArtifacts\n     mount ::API::Jobs\n     mount ::API::Keys\n     mount ::API::Labels\n     mount ::API::Lint\n+    mount ::API::ManagedLicenses\n     mount ::API::Markdown\n     mount ::API::Members\n+    mount ::API::MergeRequestApprovals\n     mount ::API::MergeRequestDiffs\n     mount ::API::MergeRequests\n     mount ::API::Namespaces\n@@ -133,6 +143,7 @@ module API\n     mount ::API::PagesDomains\n     mount ::API::Pipelines\n     mount ::API::PipelineSchedules\n+    mount ::API::ProjectApprovals\n     mount ::API::ProjectClusters\n     mount ::API::ProjectExport\n     mount ::API::ProjectImport\n@@ -172,3 +183,5 @@ module API\n     end\n   end\n end\n+\n+API::API.prepend(::EE::API::Endpoints)\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003elib/api/entities.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/lib/api/entities.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/api/entities.rb\nindex 7c035990fb0..fc625743c10 100644\n--- a/lib/api/entities.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/api/entities.rb\n@@ -485,6 +485,7 @@ module API\n \n     class ProtectedRefAccess \u003c Grape::Entity\n       expose :access_level\n+\n       expose :access_level_description do |protected_ref_access|\n         protected_ref_access.humanize\n       end\n@@ -494,6 +495,7 @@ module API\n       expose :name\n       expose :push_access_levels, using: Entities::ProtectedRefAccess\n       expose :merge_access_levels, using: Entities::ProtectedRefAccess\n+      expose :unprotect_access_levels, using: Entities::ProtectedRefAccess\n     end\n \n     class ProtectedTag \u003c Grape::Entity\n@@ -1552,6 +1554,19 @@ module API\n       end\n     end\n \n+    def self.prepend_entity(klass, with: nil)\n+      if with.nil?\n+        raise ArgumentError, 'You need to pass either the :with or :namespace option!'\n+      end\n+\n+      klass.descendants.each { |descendant| descendant.prepend(with) }\n+      klass.prepend(with)\n+    end\n+\n+    class ManagedLicense \u003c Grape::Entity\n+      expose :id, :name, :approval_status\n+    end\n+\n     class ResourceLabelEvent \u003c Grape::Entity\n       expose :id\n       expose :user, using: Entities::UserBasic\n@@ -1612,3 +1627,17 @@ module API\n     end\n   end\n end\n+\n+API::Entities.prepend_entity(::API::Entities::ApplicationSetting, with: EE::API::Entities::ApplicationSetting)\n+API::Entities.prepend_entity(::API::Entities::Board, with: EE::API::Entities::Board)\n+API::Entities.prepend_entity(::API::Entities::Group, with: EE::API::Entities::Group)\n+API::Entities.prepend_entity(::API::Entities::GroupDetail, with: EE::API::Entities::GroupDetail)\n+API::Entities.prepend_entity(::API::Entities::IssueBasic, with: EE::API::Entities::IssueBasic)\n+API::Entities.prepend_entity(::API::Entities::List, with: EE::API::Entities::List)\n+API::Entities.prepend_entity(::API::Entities::MergeRequestBasic, with: EE::API::Entities::MergeRequestBasic)\n+API::Entities.prepend_entity(::API::Entities::Namespace, with: EE::API::Entities::Namespace)\n+API::Entities.prepend_entity(::API::Entities::Project, with: EE::API::Entities::Project)\n+API::Entities.prepend_entity(::API::Entities::ProtectedRefAccess, with: EE::API::Entities::ProtectedRefAccess)\n+API::Entities.prepend_entity(::API::Entities::UserPublic, with: EE::API::Entities::UserPublic)\n+API::Entities.prepend_entity(::API::Entities::Variable, with: EE::API::Entities::Variable)\n+API::Entities.prepend_entity(::API::Entities::Todo, with: EE::API::Entities::Todo)\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003elib/api/helpers.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/lib/api/helpers.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/api/helpers.rb\nindex 54cd4cd9cdb..cf05da5960e 100644\n--- a/lib/api/helpers.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/api/helpers.rb\n@@ -2,7 +2,10 @@\n \n module API\n   module Helpers\n+    prepend EE::API::Helpers # rubocop: disable Cop/InjectEnterpriseEditionModule\n+\n     include Gitlab::Utils\n+    include Gitlab::Utils::StrongMemoize\n     include Helpers::Pagination\n \n     SUDO_HEADER = \"HTTP_SUDO\".freeze\n@@ -115,7 +118,12 @@ module API\n     def find_project!(id)\n       project = find_project(id)\n \n-      if can?(current_user, :read_project, project)\n+      # CI job token authentication:\n+      # this method grants limited privileged for admin users\n+      # admin users can only access project if they are direct member\n+      ability = job_token_authentication? ? :build_read_project : :read_project\n+\n+      if can?(current_user, ability, project)\n         project\n       else\n         not_found!('Project')\n@@ -133,6 +141,10 @@ module API\n     # rubocop: enable CodeReuse/ActiveRecord\n \n     def find_group!(id)\n+      # CI job token authentication:\n+      # currently we do not allow any group access for CI job token\n+      not_found!('Group') if job_token_authentication?\n+\n       group = find_group(id)\n \n       if can?(current_user, :read_group, group)\n@@ -171,8 +183,9 @@ module API\n     end\n \n     # rubocop: disable CodeReuse/ActiveRecord\n-    def find_project_issue(iid)\n-      IssuesFinder.new(current_user, project_id: user_project.id).find_by!(iid: iid)\n+    def find_project_issue(iid, project_id = nil)\n+      project = project_id ? find_project!(project_id) : user_project\n+      IssuesFinder.new(current_user, project_id: project.id).find_by!(iid: iid)\n     end\n     # rubocop: enable CodeReuse/ActiveRecord\n \n@@ -451,12 +464,34 @@ module API\n \n     private\n \n+    def private_token\n+      params[APIGuard::PRIVATE_TOKEN_PARAM] || env[APIGuard::PRIVATE_TOKEN_HEADER]\n+    end\n+\n+    def job_token_authentication?\n+      initial_current_user \u0026\u0026 @job_token_authentication # rubocop:disable Gitlab/ModuleWithInstanceVariables\n+    end\n+\n+    def warden\n+      env['warden']\n+    end\n+\n+    # Check if the request is GET/HEAD, or if CSRF token is valid.\n+    def verified_request?\n+      Gitlab::RequestForgeryProtection.verified?(env)\n+    end\n+\n+    # Check the Rails session for valid authentication details\n+    def find_user_from_warden\n+      warden.try(:authenticate) if verified_request?\n+    end\n+\n     # rubocop:disable Gitlab/ModuleWithInstanceVariables\n     def initial_current_user\n-      return @initial_current_user if defined?(@initial_current_user)\n+      return @initial_current_user if defined?(@initial_current_user) # rubocop:disable Gitlab/ModuleWithInstanceVariables\n \n       begin\n-        @initial_current_user = Gitlab::Auth::UniqueIpsLimiter.limit_user! { find_current_user! }\n+        @initial_current_user = Gitlab::Auth::UniqueIpsLimiter.limit_user! { find_current_user! } # rubocop:disable Gitlab/ModuleWithInstanceVariables\n       rescue Gitlab::Auth::UnauthorizedError\n         unauthorized!\n       end\n@@ -492,6 +527,10 @@ module API\n       Gitlab::Shell.secret_token\n     end\n \n+    def geo_token\n+      Gitlab::Geo.current_node.system_hook.token\n+    end\n+\n     def send_git_blob(repository, blob)\n       env['api.format'] = :txt\n       content_type 'text/plain'\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003elib/api/protected_branches.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/lib/api/protected_branches.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/api/protected_branches.rb\nindex 5af43448727..2f135e2fc7e 100644\n--- a/lib/api/protected_branches.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/api/protected_branches.rb\n@@ -51,6 +51,24 @@ module API\n         optional :merge_access_level, type: Integer,\n                                       values: ProtectedBranch::MergeAccessLevel.allowed_access_levels,\n                                       desc: 'Access levels allowed to merge (defaults: `40`, maintainer access level)'\n+        optional :unprotect_access_level, type: Integer,\n+                                          values: ProtectedBranch::UnprotectAccessLevel.allowed_access_levels,\n+                                          desc: 'Access levels allowed to unprotect (defaults: `40`, maintainer access level)'\n+        optional :allowed_to_push, type: Array, desc: 'An array of users/groups allowed to push' do\n+          optional :access_level, type: Integer, values: ProtectedBranch::PushAccessLevel.allowed_access_levels\n+          optional :user_id, type: Integer\n+          optional :group_id, type: Integer\n+        end\n+        optional :allowed_to_merge, type: Array, desc: 'An array of users/groups allowed to merge' do\n+          optional :access_level, type: Integer, values: ProtectedBranch::MergeAccessLevel.allowed_access_levels\n+          optional :user_id, type: Integer\n+          optional :group_id, type: Integer\n+        end\n+        optional :allowed_to_unprotect, type: Array, desc: 'An array of users/groups allowed to unprotect' do\n+          optional :access_level, type: Integer, values: ProtectedBranch::UnprotectAccessLevel.allowed_access_levels\n+          optional :user_id, type: Integer\n+          optional :group_id, type: Integer\n+        end\n       end\n       # rubocop: disable CodeReuse/ActiveRecord\n       post ':id/protected_branches' do\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003elib/api/search.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/lib/api/search.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/api/search.rb\nindex f5db692afe5..9b203522acd 100644\n--- a/lib/api/search.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/api/search.rb\n@@ -20,6 +20,8 @@ module API\n         snippet_blobs: Entities::Snippet\n       }.freeze\n \n+      ELASTICSEARCH_SCOPES = %w(wiki_blobs blobs commits).freeze\n+\n       def search(additional_params = {})\n         search_params = {\n           scope: params[:scope],\n@@ -35,6 +37,12 @@ module API\n       end\n \n       def process_results(results)\n+        return [] if results.empty?\n+\n+        if results.is_a?(Elasticsearch::Model::Response::Response)\n+          return paginate(results).map { |blob| Gitlab::Elastic::SearchResults.parse_search_result(blob) }\n+        end\n+\n         paginate(results)\n       end\n \n@@ -45,6 +53,16 @@ module API\n       def entity\n         SCOPE_ENTITY[params[:scope].to_sym]\n       end\n+\n+      def check_elasticsearch_scope!\n+        if ELASTICSEARCH_SCOPES.include?(params[:scope]) \u0026\u0026 !elasticsearch?\n+          render_api_error!({ error: 'Scope not supported without Elasticsearch!' }, 400)\n+        end\n+      end\n+\n+      def elasticsearch?\n+        Gitlab::CurrentSettings.elasticsearch_search?\n+      end\n     end\n \n     resource :search do\n@@ -56,11 +74,15 @@ module API\n         requires :scope,\n           type: String,\n           desc: 'The scope of search, available scopes:\n-            projects, issues, merge_requests, milestones, snippet_titles, snippet_blobs',\n-          values: %w(projects issues merge_requests milestones snippet_titles snippet_blobs)\n+            projects, issues, merge_requests, milestones, snippet_titles, snippet_blobs,\n+            if Elasticsearch enabled: wiki_blobs, blobs, commits',\n+          values: %w(projects issues merge_requests milestones snippet_titles snippet_blobs\n+                     wiki_blobs blobs commits)\n         use :pagination\n       end\n       get do\n+        check_elasticsearch_scope!\n+\n         present search, with: entity\n       end\n     end\n@@ -75,11 +97,14 @@ module API\n         requires :scope,\n           type: String,\n           desc: 'The scope of search, available scopes:\n-            projects, issues, merge_requests, milestones',\n-          values: %w(projects issues merge_requests milestones)\n+            projects, issues, merge_requests, milestones,\n+            if Elasticsearch enabled: wiki_blobs, blobs, commits',\n+          values: %w(projects issues merge_requests milestones wiki_blobs blobs commits)\n         use :pagination\n       end\n       get ':id/(-/)search' do\n+        check_elasticsearch_scope!\n+\n         present search(group_id: user_group.id), with: entity\n       end\n     end\n```\n\n\u003c/details\u003e","state":"closed","created_at":"2018-06-25T17:59:41.927Z","updated_at":"2019-08-12T15:20:46.154Z","closed_at":"2019-04-23T08:12:53.442Z","closed_by":{"id":1884221,"username":"patrickbajao","name":"Patrick Bajao","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1884221/avatar.png","web_url":"https://gitlab.com/patrickbajao"},"labels":["Create [DEPRECATED]","Enterprise Edition","Quality","Stretch","[deprecated] Accepting merge requests","api","backend","backstage [DEPRECATED]","single codebase"],"milestone":{"id":655280,"iid":28,"group_id":9970,"title":"11.11","description":"","state":"closed","created_at":"2018-09-21T19:08:37.027Z","updated_at":"2019-06-10T14:39:00.009Z","due_date":"2019-05-22","start_date":"2019-04-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/28"},"assignees":[{"id":1884221,"username":"patrickbajao","name":"Patrick Bajao","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1884221/avatar.png","web_url":"https://gitlab.com/patrickbajao"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":1884221,"username":"patrickbajao","name":"Patrick Bajao","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1884221/avatar.png","web_url":"https://gitlab.com/patrickbajao"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6674","time_stats":{"time_estimate":60,"total_time_spent":0,"human_time_estimate":"1m","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6674","notes":"https://gitlab.com/api/v4/projects/278964/issues/6674/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6674/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6674","relative":"#6674","full":"gitlab-org/gitlab#6674"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":601,"epic":{"id":2297,"iid":601,"title":"Move all EE specific frontend code behind an EE flag","url":"/groups/gitlab-org/-/epics/601","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12327308,"iid":6673,"project_id":278964,"title":"Extract EE specific files/lines for Discussion lib/api","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003elib/api/discussions.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/lib/api/discussions.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/api/discussions.rb\nindex 91eb6a23701..48440a7d218 100644\n--- a/lib/api/discussions.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/api/discussions.rb\n@@ -7,7 +7,7 @@ module API\n \n     before { authenticate! }\n \n-    NOTEABLE_TYPES = [Issue, Snippet, MergeRequest, Commit].freeze\n+    NOTEABLE_TYPES = [Issue, Snippet, Epic, MergeRequest, Commit].freeze\n \n     NOTEABLE_TYPES.each do |noteable_type|\n       parent_type = noteable_type.parent_class.to_s.underscore\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003elib/api/group_boards.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/lib/api/group_boards.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/api/group_boards.rb\nindex 9a20ee8c8b9..69cf0c32d0d 100644\n--- a/lib/api/group_boards.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/api/group_boards.rb\n@@ -5,6 +5,8 @@ module API\n     include BoardsResponses\n     include PaginationParams\n \n+    prepend EE::API::BoardsResponses # rubocop: disable Cop/InjectEnterpriseEditionModule\n+\n     before do\n       authenticate!\n     end\n@@ -22,7 +24,7 @@ module API\n     resource :groups, requirements: API::NAMESPACE_OR_PROJECT_REQUIREMENTS do\n       segment ':id/boards' do\n         desc 'Find a group board' do\n-          detail 'This feature was introduced in 10.6'\n+          detail 'This feature was introduced in 10.4'\n           success ::API::Entities::Board\n         end\n         get '/:board_id' do\n@@ -30,7 +32,7 @@ module API\n         end\n \n         desc 'Get all group boards' do\n-          detail 'This feature was introduced in 10.6'\n+          detail 'This feature was introduced in 10.4'\n           success Entities::Board\n         end\n         params do\n@@ -46,7 +48,7 @@ module API\n       end\n       segment ':id/boards/:board_id' do\n         desc 'Get the lists of a group board' do\n-          detail 'Does not include backlog and closed lists. This feature was introduced in 10.6'\n+          detail 'Does not include backlog and closed lists. This feature was introduced in 10.4'\n           success Entities::List\n         end\n         params do\n@@ -57,7 +59,7 @@ module API\n         end\n \n         desc 'Get a list of a group board' do\n-          detail 'This feature was introduced in 10.6'\n+          detail 'This feature was introduced in 10.4'\n           success Entities::List\n         end\n         params do\n@@ -68,7 +70,7 @@ module API\n         end\n \n         desc 'Create a new board list' do\n-          detail 'This feature was introduced in 10.6'\n+          detail 'This feature was introduced in 10.4'\n           success Entities::List\n         end\n         params do\n@@ -83,7 +85,7 @@ module API\n         end\n \n         desc 'Moves a board list to a new position' do\n-          detail 'This feature was introduced in 10.6'\n+          detail 'This feature was introduced in 10.4'\n           success Entities::List\n         end\n         params do\n@@ -99,7 +101,7 @@ module API\n         end\n \n         desc 'Delete a board list' do\n-          detail 'This feature was introduced in 10.6'\n+          detail 'This feature was introduced in 10.4'\n           success Entities::List\n         end\n         params do\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003elib/api/issues.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/lib/api/issues.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/api/issues.rb\nindex 94ed9ac6fb1..3acee1841a8 100644\n--- a/lib/api/issues.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/api/issues.rb\n@@ -17,6 +17,8 @@ module API\n       end\n     end\n \n+    prepend EE::API::Issues # rubocop: disable Cop/InjectEnterpriseEditionModule\n+\n     helpers do\n       # rubocop: disable CodeReuse/ActiveRecord\n       def find_issues(args = {})\n@@ -54,6 +56,7 @@ module API\n         optional :scope, type: String, values: %w[created-by-me assigned-to-me created_by_me assigned_to_me all],\n                          desc: 'Return issues for the given scope: `created_by_me`, `assigned_to_me` or `all`'\n         optional :my_reaction_emoji, type: String, desc: 'Return issues reacted by the authenticated user by the given emoji'\n+        optional :confidential, type: Boolean, desc: 'Filter confidential or public issues'\n         use :pagination\n \n         use :issues_params_ee\n@@ -218,8 +221,9 @@ module API\n                               desc: 'Date time when the issue was updated. Available only for admins and project owners.'\n         optional :state_event, type: String, values: %w[reopen close], desc: 'State of the issue'\n         use :issue_params\n-        at_least_one_of :title, :description, :assignee_ids, :assignee_id, :milestone_id, :discussion_locked,\n-                        :labels, :created_at, :due_date, :confidential, :state_event\n+        at_least_one_of :title, :description, :assignee_ids, :assignee_id, :milestone_id,\n+                        :labels, :created_at, :due_date, :confidential, :state_event,\n+                        :weight, :discussion_locked\n       end\n       # rubocop: disable CodeReuse/ActiveRecord\n       put ':id/issues/:issue_iid' do\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003elib/api/notes.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/lib/api/notes.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/api/notes.rb\nindex f7bd092ce50..675f6b2c269 100644\n--- a/lib/api/notes.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/api/notes.rb\n@@ -7,7 +7,7 @@ module API\n \n     before { authenticate! }\n \n-    NOTEABLE_TYPES = [Issue, MergeRequest, Snippet].freeze\n+    NOTEABLE_TYPES = [Issue, MergeRequest, Snippet, Epic].freeze\n \n     NOTEABLE_TYPES.each do |noteable_type|\n       parent_type = noteable_type.parent_class.to_s.underscore\n```\n\n\u003c/details\u003e\n","state":"closed","created_at":"2018-06-25T17:59:39.616Z","updated_at":"2019-08-12T15:20:46.174Z","closed_at":"2019-03-14T14:51:11.040Z","closed_by":{"id":209240,"username":"yorickpeterse","name":"Yorick Peterse","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/209240/avatar.png","web_url":"https://gitlab.com/yorickpeterse"},"labels":["Enterprise Edition","Plan [DEPRECATED]","Quality","api","backend","backstage [DEPRECATED]","single codebase"],"milestone":{"id":655279,"iid":27,"group_id":9970,"title":"11.10","description":"","state":"closed","created_at":"2018-09-21T19:08:16.261Z","updated_at":"2019-05-21T09:17:49.051Z","due_date":"2019-04-22","start_date":"2019-03-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/27"},"assignees":[{"id":209240,"username":"yorickpeterse","name":"Yorick Peterse","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/209240/avatar.png","web_url":"https://gitlab.com/yorickpeterse"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":209240,"username":"yorickpeterse","name":"Yorick Peterse","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/209240/avatar.png","web_url":"https://gitlab.com/yorickpeterse"},"user_notes_count":3,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6673","time_stats":{"time_estimate":144000,"total_time_spent":0,"human_time_estimate":"40h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6673","notes":"https://gitlab.com/api/v4/projects/278964/issues/6673/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6673/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6673","relative":"#6673","full":"gitlab-org/gitlab#6673"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12327306,"iid":6672,"project_id":278964,"title":"Extract EE specific files/lines for CI/CD lib/api","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003elib/api/triggers.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/lib/api/triggers.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/api/triggers.rb\nindex 8fc7c7361e1..0e829c5699b 100644\n--- a/lib/api/triggers.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/api/triggers.rb\n@@ -13,7 +13,7 @@ module API\n       end\n       params do\n         requires :ref, type: String, desc: 'The commit sha or name of a branch or tag', allow_blank: false\n-        requires :token, type: String, desc: 'The unique token of trigger'\n+        requires :token, type: String, desc: 'The unique token of trigger or job token'\n         optional :variables, type: Hash, desc: 'The list of variables to be injected into build'\n       end\n       post \":id/(ref/:ref/)trigger/pipeline\", requirements: { ref: /.+/ } do\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003elib/api/variables.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/lib/api/variables.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/api/variables.rb\nindex 148deb86c4c..921b8887a57 100644\n--- a/lib/api/variables.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/api/variables.rb\n@@ -47,10 +47,17 @@ module API\n         requires :key, type: String, desc: 'The key of the variable'\n         requires :value, type: String, desc: 'The value of the variable'\n         optional :protected, type: String, desc: 'Whether the variable is protected'\n+\n+        # EE\n+        optional :environment_scope, type: String, desc: 'The environment_scope of the variable'\n       end\n       post ':id/variables' do\n         variable_params = declared_params(include_missing: false)\n \n+        # EE\n+        variable_params.delete(:environment_scope) unless\n+            user_project.feature_available?(:variable_environment_scope)\n+\n         variable = user_project.variables.create(variable_params)\n \n         if variable.valid?\n@@ -67,6 +74,9 @@ module API\n         optional :key, type: String, desc: 'The key of the variable'\n         optional :value, type: String, desc: 'The value of the variable'\n         optional :protected, type: String, desc: 'Whether the variable is protected'\n+\n+        # EE\n+        optional :environment_scope, type: String, desc: 'The environment_scope of the variable'\n       end\n       # rubocop: disable CodeReuse/ActiveRecord\n       put ':id/variables/:key' do\n@@ -76,6 +86,10 @@ module API\n \n         variable_params = declared_params(include_missing: false).except(:key)\n \n+        # EE\n+        variable_params.delete(:environment_scope) unless\n+            user_project.feature_available?(:variable_environment_scope)\n+\n         if variable.update(variable_params)\n           present variable, with: Entities::Variable\n         else\n```\n\n\u003c/details\u003e\n","state":"closed","created_at":"2018-06-25T17:59:37.206Z","updated_at":"2019-08-12T15:20:46.225Z","closed_at":"2019-03-27T11:17:46.945Z","closed_by":{"id":209240,"username":"yorickpeterse","name":"Yorick Peterse","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/209240/avatar.png","web_url":"https://gitlab.com/yorickpeterse"},"labels":["Enterprise Edition","[deprecated] Accepting merge requests","api","backend","backstage [DEPRECATED]","devops::verify","single codebase"],"milestone":null,"assignees":[],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":null,"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6672","time_stats":{"time_estimate":144000,"total_time_spent":0,"human_time_estimate":"40h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6672","notes":"https://gitlab.com/api/v4/projects/278964/issues/6672/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6672/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6672","relative":"#6672","full":"gitlab-org/gitlab#6672"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12327126,"iid":6671,"project_id":278964,"title":"Extract EE specific files/lines for Create spec/requests/api","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003espec/requests/api/branches_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/requests/api/branches_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/requests/api/branches_spec.rb\nindex b38cd66986f..1a5c5905591 100644\n--- a/spec/requests/api/branches_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/requests/api/branches_spec.rb\n@@ -413,6 +413,19 @@ describe API::Branches do\n             expect(json_response['developers_can_merge']).to eq(true)\n           end\n         end\n+\n+        context \"when no one can push\" do\n+          let(:protected_branch) { create(:protected_branch, :no_one_can_push, project: project, name: 'protected_branch') }\n+\n+          it \"updates 'developers_can_push' without removing the 'no_one' access level\" do\n+            put api(\"/projects/#{project.id}/repository/branches/#{protected_branch.name}/protect\", user),\n+                params: { developers_can_push: true, developers_can_merge: true }\n+\n+            expect(response).to have_gitlab_http_status(200)\n+            expect(json_response['name']).to eq(protected_branch.name)\n+            expect(protected_branch.reload.push_access_levels.pluck(:access_level)).to include(Gitlab::Access::NO_ACCESS)\n+          end\n+        end\n       end\n     end\n   end\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/requests/api/helpers_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/requests/api/helpers_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/requests/api/helpers_spec.rb\nindex a0c64d295c0..f40c44162c2 100644\n--- a/spec/requests/api/helpers_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/requests/api/helpers_spec.rb\n@@ -23,11 +23,14 @@ describe API::Helpers do\n     }\n   end\n   let(:header) { }\n+  let(:route_authentication_setting) { {} }\n   let(:request) { Grape::Request.new(env)}\n   let(:params) { request.params }\n \n   before do\n     allow_any_instance_of(self.class).to receive(:options).and_return({})\n+    allow_any_instance_of(self.class).to receive(:route_authentication_setting)\n+      .and_return(route_authentication_setting)\n   end\n \n   def warden_authenticate_returns(value)\n@@ -219,6 +222,51 @@ describe API::Helpers do\n         end\n       end\n     end\n+\n+    describe \"when authenticating using a job token\" do\n+      let(:job) { create(:ci_build, user: user) }\n+\n+      context 'when route is allowed to be authenticated' do\n+        let(:route_authentication_setting) { { job_token_allowed: true } }\n+\n+        it \"returns a 401 response for an invalid token\" do\n+          env[Gitlab::Auth::UserAuthFinders::JOB_TOKEN_HEADER] = 'invalid token'\n+\n+          expect { current_user }.to raise_error /401/\n+        end\n+\n+        it \"returns a 403 response for a user without access\" do\n+          env[Gitlab::Auth::UserAuthFinders::JOB_TOKEN_HEADER] = job.token\n+          allow_any_instance_of(Gitlab::UserAccess).to receive(:allowed?).and_return(false)\n+\n+          expect { current_user }.to raise_error /403/\n+        end\n+\n+        it 'returns a 403 response for a user who is blocked' do\n+          user.block!\n+          env[Gitlab::Auth::UserAuthFinders::JOB_TOKEN_HEADER] = job.token\n+\n+          expect { current_user }.to raise_error /403/\n+        end\n+\n+        it \"sets current_user\" do\n+          env[Gitlab::Auth::UserAuthFinders::JOB_TOKEN_HEADER] = job.token\n+\n+          expect(current_user).to eq(user)\n+        end\n+      end\n+\n+      context 'when route is not allowed to be authenticated' do\n+        let(:route_authentication_setting) { { job_token_allowed: false } }\n+\n+        it \"sets current_user to nil\" do\n+          env[Gitlab::Auth::UserAuthFinders::JOB_TOKEN_HEADER] = job.token\n+          allow_any_instance_of(Gitlab::UserAccess).to receive(:allowed?).and_return(true)\n+\n+          expect(current_user).to be_nil\n+        end\n+      end\n+    end\n   end\n \n   describe '.handle_api_exception' do\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/requests/api/protected_branches_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/requests/api/protected_branches_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/requests/api/protected_branches_spec.rb\nindex f90558d77a9..5ec433b3704 100644\n--- a/spec/requests/api/protected_branches_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/requests/api/protected_branches_spec.rb\n@@ -56,6 +56,7 @@ describe API::ProtectedBranches do\n         expect(json_response['name']).to eq(branch_name)\n         expect(json_response['push_access_levels'][0]['access_level']).to eq(::Gitlab::Access::MAINTAINER)\n         expect(json_response['merge_access_levels'][0]['access_level']).to eq(::Gitlab::Access::MAINTAINER)\n+        expect(json_response['unprotect_access_levels']).to eq([])\n       end\n \n       context 'when protected branch does not exist' do\n@@ -66,6 +67,34 @@ describe API::ProtectedBranches do\n           let(:message) { '404 Not found' }\n         end\n       end\n+\n+      context 'with per user/group access levels' do\n+        let(:push_user) { create(:user) }\n+        let(:merge_group) { create(:group) }\n+        let(:unprotect_group) { create(:group) }\n+\n+        before do\n+          project.add_developer(push_user)\n+          project.project_group_links.create(group: merge_group)\n+          project.project_group_links.create(group: unprotect_group)\n+          protected_branch.push_access_levels.create!(user: push_user)\n+          protected_branch.merge_access_levels.create!(group: merge_group)\n+          protected_branch.unprotect_access_levels.create!(group: unprotect_group)\n+        end\n+\n+        it 'returns access level details' do\n+          get api(route, user)\n+\n+          push_user_ids = json_response['push_access_levels'].map {|level| level['user_id']}\n+          merge_group_ids = json_response['merge_access_levels'].map {|level| level['group_id']}\n+          unprotect_group_ids = json_response['unprotect_access_levels'].map {|level| level['group_id']}\n+\n+          expect(response).to have_gitlab_http_status(200)\n+          expect(push_user_ids).to include(push_user.id)\n+          expect(merge_group_ids).to include(merge_group.id)\n+          expect(unprotect_group_ids).to include(unprotect_group.id)\n+        end\n+      end\n     end\n \n     context 'when authenticated as a maintainer' do\n@@ -120,6 +149,7 @@ describe API::ProtectedBranches do\n         expect(json_response['name']).to eq(branch_name)\n         expect(json_response['push_access_levels'][0]['access_level']).to eq(Gitlab::Access::MAINTAINER)\n         expect(json_response['merge_access_levels'][0]['access_level']).to eq(Gitlab::Access::MAINTAINER)\n+        expect(json_response['unprotect_access_levels'][0]['access_level']).to eq(Gitlab::Access::MAINTAINER)\n       end\n \n       it 'protects a single branch and developers can push' do\n@@ -167,6 +197,16 @@ describe API::ProtectedBranches do\n         expect(json_response['merge_access_levels'][0]['access_level']).to eq(Gitlab::Access::NO_ACCESS)\n       end\n \n+      it 'protects a single branch and only admins can unprotect' do\n+        post post_endpoint, params: { name: branch_name, unprotect_access_level: Gitlab::Access::ADMIN }\n+\n+        expect(response).to have_gitlab_http_status(201)\n+        expect(json_response['name']).to eq(branch_name)\n+        expect(json_response['push_access_levels'][0]['access_level']).to eq(Gitlab::Access::MAINTAINER)\n+        expect(json_response['merge_access_levels'][0]['access_level']).to eq(Gitlab::Access::MAINTAINER)\n+        expect(json_response['unprotect_access_levels'][0]['access_level']).to eq(Gitlab::Access::ADMIN)\n+      end\n+\n       it 'protects a single branch and no one can push or merge' do\n         post post_endpoint, params: { name: branch_name, push_access_level: 0, merge_access_level: 0 }\n \n@@ -176,6 +216,100 @@ describe API::ProtectedBranches do\n         expect(json_response['merge_access_levels'][0]['access_level']).to eq(Gitlab::Access::NO_ACCESS)\n       end\n \n+      context 'with granular access' do\n+        let(:invited_group) do\n+          create(:project_group_link, project: project).group\n+        end\n+\n+        let(:project_member) do\n+          create(:project_member, project: project).user\n+        end\n+\n+        it 'can protect a branch while allowing an individual user to push' do\n+          push_user = project_member\n+\n+          post post_endpoint, params: { name: branch_name, allowed_to_push: [{ user_id: push_user.id }] }\n+\n+          expect_protection_to_be_successful\n+          expect(json_response['push_access_levels'][0]['user_id']).to eq(push_user.id)\n+        end\n+\n+        it 'can protect a branch while allowing an individual user to merge' do\n+          merge_user = project_member\n+\n+          post post_endpoint, params: { name: branch_name, allowed_to_merge: [{ user_id: merge_user.id }] }\n+\n+          expect_protection_to_be_successful\n+          expect(json_response['merge_access_levels'][0]['user_id']).to eq(merge_user.id)\n+        end\n+\n+        it 'can protect a branch while allowing an individual user to unprotect' do\n+          unprotect_user = project_member\n+\n+          post post_endpoint, params: { name: branch_name, allowed_to_unprotect: [{ user_id: unprotect_user.id }] }\n+\n+          expect_protection_to_be_successful\n+          expect(json_response['unprotect_access_levels'][0]['user_id']).to eq(unprotect_user.id)\n+        end\n+\n+        it 'can protect a branch while allowing a group to push' do\n+          push_group = invited_group\n+\n+          post post_endpoint, params: { name: branch_name, allowed_to_push: [{ group_id: push_group.id }] }\n+\n+          expect_protection_to_be_successful\n+          expect(json_response['push_access_levels'][0]['group_id']).to eq(push_group.id)\n+        end\n+\n+        it 'can protect a branch while allowing a group to merge' do\n+          merge_group = invited_group\n+\n+          post post_endpoint, params: { name: branch_name, allowed_to_merge: [{ group_id: merge_group.id }] }\n+\n+          expect_protection_to_be_successful\n+          expect(json_response['merge_access_levels'][0]['group_id']).to eq(merge_group.id)\n+        end\n+\n+        it 'can protect a branch while allowing a group to unprotect' do\n+          unprotect_group = invited_group\n+\n+          post post_endpoint, params: { name: branch_name, allowed_to_unprotect: [{ group_id: unprotect_group.id }] }\n+\n+          expect_protection_to_be_successful\n+          expect(json_response['unprotect_access_levels'][0]['group_id']).to eq(unprotect_group.id)\n+        end\n+\n+        it \"fails if users don't all have access to the project\" do\n+          push_user = create(:user)\n+\n+          post post_endpoint, params: { name: branch_name, allowed_to_merge: [{ user_id: push_user.id }] }\n+\n+          expect(response).to have_gitlab_http_status(422)\n+          expect(json_response['message'][0]).to match(/is not a member of the project/)\n+        end\n+\n+        it \"fails if groups aren't all invited to the project\" do\n+          merge_group = create(:group)\n+\n+          post post_endpoint, params: { name: branch_name, allowed_to_merge: [{ group_id: merge_group.id }] }\n+\n+          expect(response).to have_gitlab_http_status(422)\n+          expect(json_response['message'][0]).to match(/does not have access to the project/)\n+        end\n+\n+        it 'avoids creating default access levels unless necessary' do\n+          push_user = project_member\n+\n+          post post_endpoint, params: { name: branch_name, allowed_to_push: [{ user_id: push_user.id }] }\n+\n+          expect(response).to have_gitlab_http_status(201)\n+          expect(json_response['push_access_levels'].count).to eq(1)\n+          expect(json_response['merge_access_levels'].count).to eq(1)\n+          expect(json_response['push_access_levels'][0]['user_id']).to eq(push_user.id)\n+          expect(json_response['push_access_levels'][0]['access_level']).to eq(Gitlab::Access::MAINTAINER)\n+        end\n+      end\n+\n       it 'returns a 409 error if the same branch is protected twice' do\n         post post_endpoint, params: { name: protected_name }\n```\n\n\u003c/details\u003e","state":"closed","created_at":"2018-06-25T17:47:46.803Z","updated_at":"2019-08-12T15:20:46.252Z","closed_at":"2019-04-15T10:00:22.377Z","closed_by":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"labels":["Create [DEPRECATED]","Enterprise Edition","Quality","Stretch","api","backend","backstage [DEPRECATED]","single codebase","test"],"milestone":{"id":655280,"iid":28,"group_id":9970,"title":"11.11","description":"","state":"closed","created_at":"2018-09-21T19:08:37.027Z","updated_at":"2019-06-10T14:39:00.009Z","due_date":"2019-05-22","start_date":"2019-04-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/28"},"assignees":[{"id":1161495,"username":"igor.drozdov","name":"Igor Drozdov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1161495/avatar.png","web_url":"https://gitlab.com/igor.drozdov"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":1161495,"username":"igor.drozdov","name":"Igor Drozdov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1161495/avatar.png","web_url":"https://gitlab.com/igor.drozdov"},"user_notes_count":0,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6671","time_stats":{"time_estimate":57600,"total_time_spent":0,"human_time_estimate":"16h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6671","notes":"https://gitlab.com/api/v4/projects/278964/issues/6671/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6671/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6671","relative":"#6671","full":"gitlab-org/gitlab#6671"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12327125,"iid":6670,"project_id":278964,"title":"Extract EE specific files/lines for Discussion spec/requests/api","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003espec/requests/api/discussions_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/requests/api/discussions_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/requests/api/discussions_spec.rb\nindex 35c448d187d..2f868d0cfa0 100644\n--- a/spec/requests/api/discussions_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/requests/api/discussions_spec.rb\n@@ -31,6 +31,24 @@ describe API::Discussions do\n     end\n   end\n \n+  context 'when noteable is an Epic' do\n+    let(:group) { create(:group, :public) }\n+    let(:ext_group) { create(:group, :public) }\n+    let(:epic) { create(:epic, group: group, author: user) }\n+    let!(:epic_note) { create(:discussion_note, noteable: epic, project: project, author: user) }\n+\n+    before do\n+      group.add_owner(user)\n+      stub_licensed_features(epics: true)\n+    end\n+\n+    it_behaves_like 'discussions API', 'groups', 'epics', 'id' do\n+      let(:parent) { group }\n+      let(:noteable) { epic }\n+      let(:note) { epic_note }\n+    end\n+  end\n+\n   context 'when noteable is a Merge Request' do\n     let!(:noteable) { create(:merge_request_with_diffs, source_project: project, target_project: project, author: user) }\n     let!(:note) { create(:discussion_note_on_merge_request, noteable: noteable, project: project, author: user) }\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/requests/api/issues_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/requests/api/issues_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/requests/api/issues_spec.rb\nindex d10ee6cc320..dd3628fecda 100644\n--- a/spec/requests/api/issues_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/requests/api/issues_spec.rb\n@@ -63,6 +63,10 @@ describe API::Issues do\n     project.add_guest(guest)\n   end\n \n+  before do\n+    stub_licensed_features(multiple_issue_assignees: false, issue_weights: false)\n+  end\n+\n   describe \"GET /issues\" do\n     context \"when unauthenticated\" do\n       it \"returns an array of all issues\" do\n@@ -183,6 +187,18 @@ describe API::Issues do\n         expect_paginated_array_response([issue.id, confidential_issue.id, closed_issue.id])\n       end\n \n+      it 'returns only confidential issues' do\n+        get api('/issues', user), params: { confidential: true, scope: 'all' }\n+\n+        expect_paginated_array_response(confidential_issue.id)\n+      end\n+\n+      it 'returns only public issues' do\n+        get api('/issues', user), params: { confidential: false }\n+\n+        expect_paginated_array_response([issue.id, closed_issue.id])\n+      end\n+\n       it 'returns issues reacted by the authenticated user' do\n         issue2 = create(:issue, project: project, author: user, assignees: [user])\n         create(:award_emoji, awardable: issue2, user: user2, name: 'star')\n@@ -557,6 +573,18 @@ describe API::Issues do\n         expect_paginated_array_response([group_confidential_issue.id, group_issue.id])\n       end\n \n+      it 'returns only confidential issues' do\n+        get api(base_url, user), params: { confidential: true }\n+\n+        expect_paginated_array_response(group_confidential_issue.id)\n+      end\n+\n+      it 'returns only public issues' do\n+        get api(base_url, user), params: { confidential: false }\n+\n+        expect_paginated_array_response([group_closed_issue.id, group_issue.id])\n+      end\n+\n       it 'returns an array of labeled group issues' do\n         get api(base_url, user), params: { labels: group_label.title }\n \n@@ -782,6 +810,18 @@ describe API::Issues do\n       expect_paginated_array_response([issue.id, confidential_issue.id, closed_issue.id])\n     end\n \n+    it 'returns only confidential issues' do\n+      get api(\"#{base_url}/issues\", author), params: { confidential: true }\n+\n+      expect_paginated_array_response(confidential_issue.id)\n+    end\n+\n+    it 'returns only public issues' do\n+      get api(\"#{base_url}/issues\", author), params: { confidential: false }\n+\n+      expect_paginated_array_response([issue.id, closed_issue.id])\n+    end\n+\n     it 'returns project confidential issues for assignee' do\n       get api(\"#{base_url}/issues\", assignee)\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/requests/api/merge_requests_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/requests/api/merge_requests_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/requests/api/merge_requests_spec.rb\nindex b4cd3130dc5..131bc06e62b 100644\n--- a/spec/requests/api/merge_requests_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/requests/api/merge_requests_spec.rb\n@@ -898,6 +898,27 @@ describe API::MergeRequests do\n       expect(json_response['message']).to eq('405 Method Not Allowed')\n     end\n \n+    it 'returns 405 if merge request was not approved' do\n+      project.add_developer(create(:user))\n+      project.update(approvals_before_merge: 1)\n+\n+      put api(\"/projects/#{project.id}/merge_requests/#{merge_request.iid}/merge\", user)\n+\n+      expect(response).to have_gitlab_http_status(406)\n+      expect(json_response['message']).to eq('Branch cannot be merged')\n+    end\n+\n+    it 'returns 200 if merge request was approved' do\n+      approver = create(:user)\n+      project.add_developer(approver)\n+      project.update(approvals_before_merge: 1)\n+      merge_request.approvals.create(user: approver)\n+\n+      put api(\"/projects/#{project.id}/merge_requests/#{merge_request.iid}/merge\", user)\n+\n+      expect(response).to have_gitlab_http_status(200)\n+    end\n+\n     it \"returns 401 if user has no permissions to merge\" do\n       user2 = create(:user)\n       project.add_reporter(user2)\n@@ -984,21 +1005,6 @@ describe API::MergeRequests do\n         expect(squash_commit.message).to eq(merge_request.default_squash_commit_message)\n       end\n     end\n-\n-    describe \"the should_remove_source_branch param\" do\n-      let(:source_repository) { merge_request.source_project.repository }\n-      let(:source_branch) { merge_request.source_branch }\n-\n-      it 'removes the source branch when set' do\n-        put(\n-          api(\"/projects/#{project.id}/merge_requests/#{merge_request.iid}/merge\", user),\n-          params: { should_remove_source_branch: true }\n-        )\n-\n-        expect(response).to have_gitlab_http_status(200)\n-        expect(source_repository.branch_exists?(source_branch)).to be_falsy\n-      end\n-    end\n   end\n \n   describe \"PUT /projects/:id/merge_requests/:merge_request_iid\" do\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/requests/api/notes_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/requests/api/notes_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/requests/api/notes_spec.rb\nindex 424f0a82e43..aadf83a79ee 100644\n--- a/spec/requests/api/notes_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/requests/api/notes_spec.rb\n@@ -182,4 +182,22 @@ describe API::Notes do\n       end\n     end\n   end\n+\n+  context \"when noteable is an Epic\" do\n+    let(:group) { create(:group, :public) }\n+    let(:ext_group) { create(:group, :public) }\n+    let(:epic) { create(:epic, group: group, author: user) }\n+    let!(:epic_note) { create(:note, noteable: epic, project: project, author: user) }\n+\n+    before do\n+      group.add_owner(user)\n+      stub_licensed_features(epics: true)\n+    end\n+\n+    it_behaves_like \"noteable API\", 'groups', 'epics', 'id' do\n+      let(:parent) { group }\n+      let(:noteable) { epic }\n+      let(:note) { epic_note }\n+    end\n+  end\n end\n```\n\n\u003c/details\u003e\n","state":"closed","created_at":"2018-06-25T17:47:44.341Z","updated_at":"2019-08-12T15:20:46.310Z","closed_at":"2019-04-29T18:31:08.260Z","closed_by":{"id":15139,"username":"rspeicher","name":"Robert Speicher","state":"active","avatar_url":"https://secure.gravatar.com/avatar/73c8253932541a7b5cbc5d79493f2bea?s=80\u0026d=identicon","web_url":"https://gitlab.com/rspeicher"},"labels":["Enterprise Edition","Plan [DEPRECATED]","Quality","api","backend","backstage [DEPRECATED]","single codebase","test","workflow::in dev"],"milestone":{"id":655280,"iid":28,"group_id":9970,"title":"11.11","description":"","state":"closed","created_at":"2018-09-21T19:08:37.027Z","updated_at":"2019-06-10T14:39:00.009Z","due_date":"2019-05-22","start_date":"2019-04-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/28"},"assignees":[{"id":194645,"username":"digitalmoksha","name":"Brett Walker","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/194645/avatar.png","web_url":"https://gitlab.com/digitalmoksha"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":194645,"username":"digitalmoksha","name":"Brett Walker","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/194645/avatar.png","web_url":"https://gitlab.com/digitalmoksha"},"user_notes_count":0,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6670","time_stats":{"time_estimate":28800,"total_time_spent":0,"human_time_estimate":"8h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6670","notes":"https://gitlab.com/api/v4/projects/278964/issues/6670/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6670/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6670","relative":"#6670","full":"gitlab-org/gitlab#6670"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12327123,"iid":6669,"project_id":278964,"title":"Extract EE specific files/lines for CI/CD spec/requests/api","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003espec/requests/api/jobs_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/requests/api/jobs_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/requests/api/jobs_spec.rb\nindex 3defe8bbf51..47663dac011 100644\n--- a/spec/requests/api/jobs_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/requests/api/jobs_spec.rb\n@@ -50,6 +50,7 @@ describe API::Jobs do\n   let(:guest) { create(:project_member, :guest, project: project).user }\n \n   before do\n+    stub_licensed_features(cross_project_pipelines: true)\n     project.add_developer(user)\n   end\n \n@@ -603,6 +604,29 @@ describe API::Jobs do\n \n         it_behaves_like 'a valid file'\n       end\n+\n+      context 'when using job_token to authenticate' do\n+        before do\n+          pipeline.reload\n+          pipeline.update(ref: 'master',\n+                          sha: project.commit('master').sha)\n+\n+          get api(\"/projects/#{project.id}/jobs/artifacts/master/download\"), params: { job: job.name, job_token: job.token }\n+        end\n+\n+        context 'when user is reporter' do\n+          it_behaves_like 'a valid file'\n+        end\n+\n+        context 'when user is admin, but not member' do\n+          let(:api_user) { create(:admin) }\n+          let(:job) { create(:ci_build, :artifacts, pipeline: pipeline, user: api_user) }\n+\n+          it 'does not allow to see that artfiact is present' do\n+            expect(response).to have_gitlab_http_status(404)\n+          end\n+        end\n+      end\n     end\n   end\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/requests/api/runner_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/requests/api/runner_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/requests/api/runner_spec.rb\nindex 43c06f7c973..9eabbba7130 100644\n--- a/spec/requests/api/runner_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/requests/api/runner_spec.rb\n@@ -1675,7 +1675,7 @@ describe API::Runner, :clean_gitlab_redis_shared_state do\n               end\n \n               it 'download artifacts' do\n-                expect(response).to have_http_status(200)\n+                expect(response).to have_gitlab_http_status(200)\n                 expect(response.headers.to_h).to include download_headers\n               end\n             end\n```\n\n\u003c/details\u003e\n","state":"closed","created_at":"2018-06-25T17:47:41.921Z","updated_at":"2019-08-12T15:20:46.247Z","closed_at":"2019-04-09T07:17:35.426Z","closed_by":{"id":128633,"username":"rymai","name":"R√©my Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"},"labels":["Deliverable","Enterprise Edition","api","backend","backstage [DEPRECATED]","devops::verify","single codebase","test"],"milestone":{"id":655280,"iid":28,"group_id":9970,"title":"11.11","description":"","state":"closed","created_at":"2018-09-21T19:08:37.027Z","updated_at":"2019-06-10T14:39:00.009Z","due_date":"2019-05-22","start_date":"2019-04-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/28"},"assignees":[{"id":722076,"username":"matteeyah","name":"Matija ƒåupiƒá","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8bc04cc15e0adba406cf56fecd9d910a?s=80\u0026d=identicon","web_url":"https://gitlab.com/matteeyah"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":722076,"username":"matteeyah","name":"Matija ƒåupiƒá","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8bc04cc15e0adba406cf56fecd9d910a?s=80\u0026d=identicon","web_url":"https://gitlab.com/matteeyah"},"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6669","time_stats":{"time_estimate":28800,"total_time_spent":0,"human_time_estimate":"8h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6669","notes":"https://gitlab.com/api/v4/projects/278964/issues/6669/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6669/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6669","relative":"#6669","full":"gitlab-org/gitlab#6669"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12326734,"iid":6666,"project_id":278964,"title":"Extract EE specific files/lines for spec/models (harder but less)","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003espec/models/environment_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/models/environment_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/models/environment_spec.rb\nindex 2d554326f05..042598ae3a9 100644\n--- a/spec/models/environment_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/models/environment_spec.rb\n@@ -533,6 +533,10 @@ describe Environment do\n   end\n \n   describe '#deployment_platform' do\n+    before do\n+      stub_licensed_features(multiple_clusters: true)\n+    end\n+\n     context 'when there is a deployment platform for environment' do\n       let!(:cluster) do\n         create(:cluster, :provided_by_gcp,\n@@ -568,7 +572,7 @@ describe Environment do\n \n       shared_examples 'same behavior between KubernetesService and Platform::Kubernetes' do\n         it 'returns the terminals from the deployment service' do\n-          expect(project.deployment_platform)\n+          expect(environment.deployment_platform)\n             .to receive(:terminals).with(environment)\n             .and_return(:fake_terminals)\n \n@@ -599,6 +603,47 @@ describe Environment do\n     end\n   end\n \n+  describe '#rollout_status' do\n+    shared_examples 'same behavior between KubernetesService and Platform::Kubernetes' do\n+      subject { environment.rollout_status }\n+\n+      context 'when the environment has rollout status' do\n+        before do\n+          allow(environment).to receive(:has_terminals?).and_return(true)\n+        end\n+\n+        it 'returns the rollout status from the deployment service' do\n+          expect(environment.deployment_platform)\n+            .to receive(:rollout_status).with(environment)\n+            .and_return(:fake_rollout_status)\n+\n+          is_expected.to eq(:fake_rollout_status)\n+        end\n+      end\n+\n+      context 'when the environment does not have rollout status' do\n+        before do\n+          allow(environment).to receive(:has_terminals?).and_return(false)\n+        end\n+\n+        it { is_expected.to eq(nil) }\n+      end\n+    end\n+\n+    context 'when user configured kubernetes from Integration \u003e Kubernetes' do\n+      let(:project) { create(:kubernetes_project) }\n+\n+      it_behaves_like 'same behavior between KubernetesService and Platform::Kubernetes'\n+    end\n+\n+    context 'when user configured kubernetes from CI/CD \u003e Clusters' do\n+      let!(:cluster) { create(:cluster, :project, :provided_by_gcp) }\n+      let(:project) { cluster.project }\n+\n+      it_behaves_like 'same behavior between KubernetesService and Platform::Kubernetes'\n+    end\n+  end\n+\n   describe '#has_metrics?' do\n     subject { environment.has_metrics? }\n \n@@ -663,7 +708,7 @@ describe Environment do\n     let(:project) { create(:prometheus_project) }\n     subject { environment.additional_metrics }\n \n-    context 'when the environment has additional metrics' do\n+    context 'when the environment has metrics' do\n       before do\n         allow(environment).to receive(:has_metrics?).and_return(true)\n       end\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/models/namespace_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/models/namespace_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/models/namespace_spec.rb\nindex 475fbe56e4d..f059d02b5f1 100644\n--- a/spec/models/namespace_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/models/namespace_spec.rb\n@@ -374,6 +374,18 @@ describe Namespace do\n     end\n   end\n \n+  describe '#actual_size_limit' do\n+    let(:namespace) { build(:namespace) }\n+\n+    before do\n+      allow_any_instance_of(ApplicationSetting).to receive(:repository_size_limit).and_return(50)\n+    end\n+\n+    it 'returns the correct size limit' do\n+      expect(namespace.actual_size_limit).to eq(50)\n+    end\n+  end\n+\n   describe '#rm_dir', 'callback' do\n     let(:repository_storage_path) do\n       Gitlab::GitalyClient::StorageSettings.allow_disk_access do\n@@ -693,6 +705,118 @@ describe Namespace do\n     end\n   end\n \n+  describe '#membership_lock with subgroups', :nested_groups do\n+    context 'when creating a subgroup' do\n+      let(:subgroup) { create(:group, parent: root_group) }\n+\n+      context 'under a parent with \"Membership lock\" enabled' do\n+        let(:root_group) { create(:group, membership_lock: true) }\n+\n+        it 'enables \"Membership lock\" on the subgroup' do\n+          expect(subgroup.membership_lock).to be_truthy\n+        end\n+      end\n+\n+      context 'under a parent with \"Membership lock\" disabled' do\n+        let(:root_group) { create(:group) }\n+\n+        it 'does not enable \"Membership lock\" on the subgroup' do\n+          expect(subgroup.membership_lock).to be_falsey\n+        end\n+      end\n+\n+      context 'when enabling the parent group \"Membership lock\"' do\n+        let(:root_group) { create(:group) }\n+        let!(:subgroup) { create(:group, parent: root_group) }\n+\n+        it 'the subgroup \"Membership lock\" not changed' do\n+          root_group.update!(membership_lock: true)\n+\n+          expect(subgroup.reload.membership_lock).to be_falsey\n+        end\n+      end\n+\n+      context 'when disabling the parent group \"Membership lock\" (which was already enabled)' do\n+        let(:root_group) { create(:group, membership_lock: true) }\n+\n+        context 'and the subgroup \"Membership lock\" is enabled' do\n+          let(:subgroup) { create(:group, parent: root_group, membership_lock: true) }\n+\n+          it 'the subgroup \"Membership lock\" does not change' do\n+            root_group.update!(membership_lock: false)\n+\n+            expect(subgroup.reload.membership_lock).to be_truthy\n+          end\n+        end\n+\n+        context 'but the subgroup \"Membership lock\" is disabled' do\n+          let(:subgroup) { create(:group, parent: root_group) }\n+\n+          it 'the subgroup \"Membership lock\" does not change' do\n+            root_group.update!(membership_lock: false)\n+\n+            expect(subgroup.reload.membership_lock?).to be_falsey\n+          end\n+        end\n+      end\n+    end\n+\n+    # Note: Group transfers are not yet implemented\n+    context 'when a group is transferred into a root group' do\n+      context 'when the root group \"Membership lock\" is enabled' do\n+        let(:root_group) { create(:group, membership_lock: true) }\n+\n+        context 'when the subgroup \"Membership lock\" is enabled' do\n+          let(:subgroup) { create(:group, membership_lock: true) }\n+\n+          it 'the subgroup \"Membership lock\" does not change' do\n+            subgroup.parent = root_group\n+            subgroup.save!\n+\n+            expect(subgroup.membership_lock).to be_truthy\n+          end\n+        end\n+\n+        context 'when the subgroup \"Membership lock\" is disabled' do\n+          let(:subgroup) { create(:group) }\n+\n+          it 'the subgroup \"Membership lock\" not changed' do\n+            subgroup.parent = root_group\n+            subgroup.save!\n+\n+            expect(subgroup.membership_lock).to be_falsey\n+          end\n+        end\n+      end\n+\n+      context 'when the root group \"Membership lock\" is disabled' do\n+        let(:root_group) { create(:group) }\n+\n+        context 'when the subgroup \"Membership lock\" is enabled' do\n+          let(:subgroup) { create(:group, membership_lock: true) }\n+\n+          it 'the subgroup \"Membership lock\" does not change' do\n+            subgroup.parent = root_group\n+            subgroup.save!\n+\n+            expect(subgroup.membership_lock).to be_truthy\n+          end\n+        end\n+\n+        context 'when the subgroup \"Membership lock\" is disabled' do\n+          let(:subgroup) { create(:group) }\n+\n+          it 'the subgroup \"Membership lock\" does not change' do\n+            subgroup.parent = root_group\n+            subgroup.save!\n+\n+            expect(subgroup.membership_lock).to be_falsey\n+          end\n+        end\n+      end\n+    end\n+  end\n+\n   describe '#find_fork_of?' do\n     let(:project) { create(:project, :public) }\n     let!(:forked_project) { fork_project(project, namespace.owner, namespace: namespace) }\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/models/user_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/models/user_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/models/user_spec.rb\nindex 85b157a9435..cd0e96706f8 100644\n--- a/spec/models/user_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/models/user_spec.rb\n@@ -18,6 +18,10 @@ describe User do\n \n   describe 'delegations' do\n     it { is_expected.to delegate_method(:path).to(:namespace).with_prefix }\n+\n+    # EE\n+    it { is_expected.to delegate_method(:shared_runners_minutes_limit).to(:namespace) }\n+    it { is_expected.to delegate_method(:shared_runners_minutes_limit=).to(:namespace).with_arguments(133) }\n   end\n \n   describe 'associations' do\n@@ -38,6 +42,7 @@ describe User do\n     it { is_expected.to have_many(:spam_logs).dependent(:destroy) }\n     it { is_expected.to have_many(:todos) }\n     it { is_expected.to have_many(:award_emoji).dependent(:destroy) }\n+    it { is_expected.to have_many(:path_locks).dependent(:destroy) }\n     it { is_expected.to have_many(:triggers).dependent(:destroy) }\n     it { is_expected.to have_many(:builds).dependent(:nullify) }\n     it { is_expected.to have_many(:pipelines).dependent(:nullify) }\n@@ -95,6 +100,10 @@ describe User do\n     end\n   end\n \n+  describe 'nested attributes' do\n+    it { is_expected.to respond_to(:namespace_attributes=) }\n+  end\n+\n   describe 'validations' do\n     describe 'username' do\n       it 'validates presence' do\n@@ -377,6 +386,25 @@ describe User do\n         end\n       end\n     end\n+\n+    it 'does not allow a user to be both an auditor and an admin' do\n+      user = build(:user, :admin, :auditor)\n+\n+      expect(user).to be_invalid\n+    end\n+  end\n+\n+  describe \"non_ldap\" do\n+    it \"retuns non-ldap user\" do\n+      described_class.delete_all\n+      create :user\n+      ldap_user = create :omniauth_user, provider: \"ldapmain\"\n+      create :omniauth_user, provider: \"gitlub\"\n+\n+      users = described_class.non_ldap\n+      expect(users.count).to eq 2\n+      expect(users.detect { |user| user.username == ldap_user.username }).to be_nil\n+    end\n   end\n \n   describe \"scopes\" do\n@@ -2514,6 +2542,60 @@ describe User do\n     end\n   end\n \n+  describe 'the GitLab_Auditor_User add-on' do\n+    context 'creating an auditor user' do\n+      it \"does not allow creating an auditor user if the addon isn't enabled\" do\n+        stub_licensed_features(auditor_user: false)\n+\n+        expect(build(:user, :auditor)).to be_invalid\n+      end\n+\n+      it \"does not allow creating an auditor user if no license is present\" do\n+        allow(License).to receive(:current).and_return nil\n+\n+        expect(build(:user, :auditor)).to be_invalid\n+      end\n+\n+      it \"allows creating an auditor user if the addon is enabled\" do\n+        stub_licensed_features(auditor_user: true)\n+\n+        expect(build(:user, :auditor)).to be_valid\n+      end\n+\n+      it \"allows creating a regular user if the addon isn't enabled\" do\n+        stub_licensed_features(auditor_user: false)\n+\n+        expect(build(:user)).to be_valid\n+      end\n+    end\n+\n+    context '#auditor?' do\n+      it \"returns true for an auditor user if the addon is enabled\" do\n+        stub_licensed_features(auditor_user: true)\n+\n+        expect(build(:user, :auditor)).to be_auditor\n+      end\n+\n+      it \"returns false for an auditor user if the addon is not enabled\" do\n+        stub_licensed_features(auditor_user: false)\n+\n+        expect(build(:user, :auditor)).not_to be_auditor\n+      end\n+\n+      it \"returns false for an auditor user if a license is not present\" do\n+        stub_licensed_features(auditor_user: false)\n+\n+        expect(build(:user, :auditor)).not_to be_auditor\n+      end\n+\n+      it \"returns false for a non-auditor user even if the addon is present\" do\n+        stub_licensed_features(auditor_user: true)\n+\n+        expect(build(:user)).not_to be_auditor\n+      end\n+    end\n+  end\n+\n   describe '.ghost' do\n     it \"creates a ghost user if one isn't already present\" do\n       ghost = described_class.ghost\n```\n\n\u003c/details\u003e\n","state":"closed","created_at":"2018-06-25T17:15:41.504Z","updated_at":"2019-08-12T15:32:23.037Z","closed_at":"2019-04-04T12:26:27.825Z","closed_by":{"id":128633,"username":"rymai","name":"R√©my Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"},"labels":["Enterprise Edition","Manage [DEPRECATED]","Quality","[deprecated] Accepting merge requests","backend","backstage [DEPRECATED]","single codebase","test"],"milestone":{"id":655279,"iid":27,"group_id":9970,"title":"11.10","description":"","state":"closed","created_at":"2018-09-21T19:08:16.261Z","updated_at":"2019-05-21T09:17:49.051Z","due_date":"2019-04-22","start_date":"2019-03-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/27"},"assignees":[{"id":128633,"username":"rymai","name":"R√©my Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":128633,"username":"rymai","name":"R√©my Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6666","time_stats":{"time_estimate":28800,"total_time_spent":0,"human_time_estimate":"8h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6666","notes":"https://gitlab.com/api/v4/projects/278964/issues/6666/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6666/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6666","relative":"#6666","full":"gitlab-org/gitlab#6666"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12326604,"iid":6664,"project_id":278964,"title":"Extract EE specific files/lines for Discussion spec/models","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003espec/models/issue_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/models/issue_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/models/issue_spec.rb\nindex 5d18e085a6f..6101df2e099 100644\n--- a/spec/models/issue_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/models/issue_spec.rb\n@@ -765,6 +765,15 @@ describe Issue do\n     end\n   end\n \n+  describe '.confidential_only' do\n+    it 'only returns confidential_only issues' do\n+      create(:issue)\n+      confidential_issue = create(:issue, confidential: true)\n+\n+      expect(described_class.confidential_only).to eq([confidential_issue])\n+    end\n+  end\n+\n   it_behaves_like 'throttled touch' do\n     subject { create(:issue, updated_at: 1.hour.ago) }\n   end\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/models/milestone_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/models/milestone_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/models/milestone_spec.rb\nindex af7e3d3a6c9..c9da5320459 100644\n--- a/spec/models/milestone_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/models/milestone_spec.rb\n@@ -40,6 +40,8 @@ describe Milestone do\n \n   describe \"Associations\" do\n     it { is_expected.to belong_to(:project) }\n+\n+    it { is_expected.to have_many(:boards) }\n     it { is_expected.to have_many(:issues) }\n   end\n```\n\n\u003c/details\u003e\n\u003cbr\u003e","state":"closed","created_at":"2018-06-25T17:06:13.975Z","updated_at":"2019-08-12T15:32:23.058Z","closed_at":"2019-04-08T09:37:05.139Z","closed_by":{"id":128633,"username":"rymai","name":"R√©my Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"},"labels":["Enterprise Edition","Plan [DEPRECATED]","Quality","backend","backstage [DEPRECATED]","single codebase","test","workflow::in review"],"milestone":{"id":655279,"iid":27,"group_id":9970,"title":"11.10","description":"","state":"closed","created_at":"2018-09-21T19:08:16.261Z","updated_at":"2019-05-21T09:17:49.051Z","due_date":"2019-04-22","start_date":"2019-03-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/27"},"assignees":[{"id":128633,"username":"rymai","name":"R√©my Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"},{"id":3717078,"username":"cablett","name":"charlie ablett","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3717078/avatar.png","web_url":"https://gitlab.com/cablett"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":128633,"username":"rymai","name":"R√©my Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"},"user_notes_count":2,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6664","time_stats":{"time_estimate":28800,"total_time_spent":0,"human_time_estimate":"8h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6664","notes":"https://gitlab.com/api/v4/projects/278964/issues/6664/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6664/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6664","relative":"#6664","full":"gitlab-org/gitlab#6664"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12326602,"iid":6663,"project_id":278964,"title":"Extract EE specific files/lines for spec/models/project_*","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003espec/models/project_feature_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/models/project_feature_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/models/project_feature_spec.rb\nindex fee7d65c217..e7c0bc0b6d7 100644\n--- a/spec/models/project_feature_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/models/project_feature_spec.rb\n@@ -64,6 +64,15 @@ describe ProjectFeature do\n           expect(project.feature_available?(:issues, user)).to eq(true)\n         end\n       end\n+\n+      it \"returns true if user is an auditor\" do\n+        user.update_attribute(:auditor, true)\n+\n+        features.each do |feature|\n+          project.project_feature.update_attribute(\"#{feature}_access_level\".to_sym, ProjectFeature::PRIVATE)\n+          expect(project.feature_available?(:issues, user)).to eq(true)\n+        end\n+      end\n     end\n \n     context 'when feature is enabled for everyone' do\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/models/project_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/models/project_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/models/project_spec.rb\nindex 65cf04de13c..52d17344cd2 100644\n--- a/spec/models/project_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/models/project_spec.rb\n@@ -49,6 +49,7 @@ describe Project do\n     it { is_expected.to have_one(:bamboo_service) }\n     it { is_expected.to have_one(:teamcity_service) }\n     it { is_expected.to have_one(:jira_service) }\n+    it { is_expected.to have_one(:github_service) }\n     it { is_expected.to have_one(:redmine_service) }\n     it { is_expected.to have_one(:custom_issue_tracker_service) }\n     it { is_expected.to have_one(:bugzilla_service) }\n@@ -135,15 +136,6 @@ describe Project do\n       end\n     end\n \n-    describe '#boards' do\n-      it 'raises an error when attempting to add more than one board to the project' do\n-        subject.boards.build\n-\n-        expect { subject.boards.build }.to raise_error(Project::BoardLimitExceeded, 'Number of permitted boards exceeded')\n-        expect(subject.boards.size).to eq 1\n-      end\n-    end\n-\n     describe 'ci_pipelines association' do\n       it 'returns only pipelines from ci_sources' do\n         expect(Ci::Pipeline).to receive(:ci_sources).and_call_original\n@@ -163,6 +155,18 @@ describe Project do\n     it { is_expected.to include_module(Sortable) }\n   end\n \n+  describe 'scopes' do\n+    context '#with_wiki_enabled' do\n+      it 'returns a project' do\n+        project = create(:project_empty_repo, wiki_access_level: ProjectFeature::ENABLED)\n+        project1 = create(:project, wiki_access_level: ProjectFeature::DISABLED)\n+\n+        expect(described_class.with_wiki_enabled).to include(project)\n+        expect(described_class.with_wiki_enabled).not_to include(project1)\n+      end\n+    end\n+  end\n+\n   describe '.missing_kubernetes_namespace' do\n     let!(:project) { create(:project) }\n     let!(:cluster) { create(:cluster, :provided_by_user, :group) }\n@@ -253,6 +257,28 @@ describe Project do\n       end\n     end\n \n+    context '#mark_stuck_remote_mirrors_as_failed!' do\n+      it 'fails stuck remote mirrors' do\n+        project = create(:project, :repository, :remote_mirror)\n+\n+        project.remote_mirrors.first.update(\n+          update_status: :started,\n+          last_update_at: 2.days.ago\n+        )\n+\n+        expect do\n+          project.mark_stuck_remote_mirrors_as_failed!\n+        end.to change { project.remote_mirrors.stuck.count }.from(1).to(0)\n+      end\n+    end\n+\n+    context 'mirror' do\n+      subject { build(:project, mirror: true) }\n+\n+      it { is_expected.to validate_presence_of(:import_url) }\n+      it { is_expected.to validate_presence_of(:mirror_user) }\n+    end\n+\n     describe 'import_url' do\n       it 'does not allow an invalid URI as import_url' do\n         project = build(:project, import_url: 'invalid://')\n@@ -349,6 +375,14 @@ describe Project do\n       end\n     end\n \n+    it 'creates import state when mirror gets enabled' do\n+      project2 = create(:project)\n+\n+      expect do\n+        project2.update(mirror: true, import_url: generate(:url), mirror_user: project.creator)\n+      end.to change { ProjectImportState.where(project: project2).count }.from(0).to(1)\n+    end\n+\n     describe 'project pending deletion' do\n       let!(:project_pending_deletion) do\n         create(:project,\n@@ -626,6 +660,14 @@ describe Project do\n     end\n   end\n \n+  describe \"#kerberos_url_to_repo\" do\n+    let(:project) { create(:project, path: \"somewhere\") }\n+\n+    it 'returns valid kerberos url for this repo' do\n+      expect(project.kerberos_url_to_repo).to eq(\"#{Gitlab.config.build_gitlab_kerberos_url}/#{project.namespace.path}/somewhere.git\")\n+    end\n+  end\n+\n   describe \"#readme_url\" do\n     context 'with a non-existing repository' do\n       let(:project) { create(:project) }\n@@ -862,6 +904,92 @@ describe Project do\n     end\n   end\n \n+  describe 'repository size restrictions' do\n+    let(:project) { build(:project) }\n+\n+    before do\n+      allow_any_instance_of(ApplicationSetting).to receive(:repository_size_limit).and_return(50)\n+    end\n+\n+    describe '#changes_will_exceed_size_limit?' do\n+      before do\n+        allow(project).to receive(:repository_and_lfs_size).and_return(49)\n+      end\n+      it 'returns true when changes go over' do\n+        expect(project.changes_will_exceed_size_limit?(5)).to be_truthy\n+      end\n+    end\n+\n+    describe '#actual_size_limit' do\n+      it 'returns the limit set in the application settings' do\n+        expect(project.actual_size_limit).to eq(50)\n+      end\n+\n+      it 'returns the value set in the group' do\n+        group = create(:group, repository_size_limit: 100)\n+        project.update_attribute(:namespace_id, group.id)\n+\n+        expect(project.actual_size_limit).to eq(100)\n+      end\n+\n+      it 'returns the value set locally' do\n+        project.update_attribute(:repository_size_limit, 75)\n+\n+        expect(project.actual_size_limit).to eq(75)\n+      end\n+    end\n+\n+    describe '#size_limit_enabled?' do\n+      it 'returns false when disabled' do\n+        project.update_attribute(:repository_size_limit, 0)\n+\n+        expect(project.size_limit_enabled?).to be_falsey\n+      end\n+\n+      it 'returns true when a limit is set' do\n+        project.update_attribute(:repository_size_limit, 75)\n+\n+        expect(project.size_limit_enabled?).to be_truthy\n+      end\n+    end\n+\n+    describe '#above_size_limit?' do\n+      let(:project) do\n+        create(:project,\n+               statistics: build(:project_statistics))\n+      end\n+\n+      it 'returns true when above the limit' do\n+        allow(project).to receive(:repository_and_lfs_size).and_return(100)\n+\n+        expect(project.above_size_limit?).to be_truthy\n+      end\n+\n+      it 'returns false when not over the limit' do\n+        expect(project.above_size_limit?).to be_falsey\n+      end\n+    end\n+\n+    describe '#size_to_remove' do\n+      it 'returns the correct value' do\n+        allow(project).to receive(:repository_and_lfs_size).and_return(100)\n+\n+        expect(project.size_to_remove).to eq(50)\n+      end\n+    end\n+  end\n+\n+  describe '#repository_size_limit column' do\n+    it 'support values up to 8 exabytes' do\n+      project = create(:project)\n+      project.update_column(:repository_size_limit, 8.exabytes - 1)\n+\n+      project.reload\n+\n+      expect(project.repository_size_limit).to eql(8.exabytes - 1)\n+    end\n+  end\n+\n   describe '#default_issues_tracker?' do\n     it \"is true if used internal tracker\" do\n       project = build(:project)\n@@ -1864,12 +1992,24 @@ describe Project do\n   end\n \n   describe 'handling import URL' do\n-    it 'returns the sanitized URL' do\n-      project = create(:project, :import_started, import_url: 'http://user:pass@test.com')\n+    context 'when project is a mirror' do\n+      it 'returns the full URL' do\n+        project = create(:project, :mirror, import_url: 'http://user:pass@test.com')\n+\n+        project.import_state.finish\n+\n+        expect(project.reload.import_url).to eq('http://user:pass@test.com')\n+      end\n+    end\n+\n+    context 'when project is not a mirror' do\n+      it 'returns the sanitized URL' do\n+        project = create(:project, :import_started, import_url: 'http://user:pass@test.com')\n \n-      project.import_state.finish\n+        project.import_state.finish\n \n-      expect(project.reload.import_url).to eq('http://test.com')\n+        expect(project.reload.import_url).to eq('http://test.com')\n+      end\n     end\n   end\n \n@@ -2149,6 +2289,32 @@ describe Project do\n \n         expect(project.add_import_job).to eq(import_jid)\n       end\n+\n+      context 'without mirror' do\n+        it 'returns nil' do\n+          project = create(:project)\n+\n+          expect(project.add_import_job).to be nil\n+        end\n+      end\n+\n+      context 'without repository' do\n+        it 'schedules RepositoryImportWorker' do\n+          project = create(:project, import_url: generate(:url))\n+\n+          expect(RepositoryImportWorker).to receive(:perform_async).with(project.id).and_return(import_jid)\n+          expect(project.add_import_job).to eq(import_jid)\n+        end\n+      end\n+\n+      context 'with mirror' do\n+        it 'schedules RepositoryUpdateMirrorWorker' do\n+          project = create(:project, :mirror, :repository)\n+\n+          expect(RepositoryUpdateMirrorWorker).to receive(:perform_async).with(project.id).and_return(import_jid)\n+          expect(project.add_import_job).to eq(import_jid)\n+        end\n+      end\n     end\n \n     context 'not forked' do\n@@ -2360,6 +2526,82 @@ describe Project do\n     end\n   end\n \n+  describe '.where_full_path_in' do\n+    context 'without any paths' do\n+      it 'returns an empty relation' do\n+        expect(described_class.where_full_path_in([])).to eq([])\n+      end\n+    end\n+\n+    context 'without any valid paths' do\n+      it 'returns an empty relation' do\n+        expect(described_class.where_full_path_in(%w[foo])).to eq([])\n+      end\n+    end\n+\n+    context 'with valid paths' do\n+      let!(:project1) { create(:project) }\n+      let!(:project2) { create(:project) }\n+\n+      it 'returns the projects matching the paths' do\n+        projects = described_class.where_full_path_in([project1.full_path,\n+                                                       project2.full_path])\n+\n+        expect(projects).to contain_exactly(project1, project2)\n+      end\n+\n+      it 'returns projects regardless of the casing of paths' do\n+        projects = described_class.where_full_path_in([project1.full_path.upcase,\n+                                                       project2.full_path.upcase])\n+\n+        expect(projects).to contain_exactly(project1, project2)\n+      end\n+    end\n+  end\n+\n+  describe '#change_repository_storage' do\n+    let(:project) { create(:project, :repository) }\n+    let(:read_only_project) { create(:project, :repository, repository_read_only: true) }\n+\n+    before do\n+      FileUtils.mkdir('tmp/tests/extra_storage')\n+      stub_storage_settings('extra' =\u003e { 'path' =\u003e 'tmp/tests/extra_storage' })\n+    end\n+\n+    after do\n+      FileUtils.rm_rf('tmp/tests/extra_storage')\n+    end\n+\n+    it 'schedule the transfer of the repository to the new storage and locks the project' do\n+      expect(ProjectUpdateRepositoryStorageWorker).to receive(:perform_async).with(project.id, 'extra')\n+\n+      project.change_repository_storage('extra')\n+      project.save\n+\n+      expect(project).to be_repository_read_only\n+    end\n+\n+    it \"doesn't schedule the transfer if the repository is already read-only\" do\n+      expect(ProjectUpdateRepositoryStorageWorker).not_to receive(:perform_async)\n+\n+      read_only_project.change_repository_storage('extra')\n+      read_only_project.save\n+    end\n+\n+    it \"doesn't lock or schedule the transfer if the storage hasn't changed\" do\n+      expect(ProjectUpdateRepositoryStorageWorker).not_to receive(:perform_async)\n+\n+      project.change_repository_storage(project.repository_storage)\n+      project.save\n+\n+      expect(project).not_to be_repository_read_only\n+    end\n+\n+    it 'throws an error if an invalid repository storage is provided' do\n+      expect { project.change_repository_storage('unknown') }.to raise_error(ArgumentError)\n+    end\n+  end\n+\n   describe '#change_head' do\n     let(:project) { create(:project, :repository) }\n \n@@ -2511,16 +2753,6 @@ describe Project do\n     end\n   end\n \n-  describe '#set_repository_writable!' do\n-    it 'sets repository_read_only to false' do\n-      project = create(:project, :read_only)\n-\n-      expect { project.set_repository_writable! }\n-        .to change(project, :repository_read_only)\n-        .from(true).to(false)\n-    end\n-  end\n-\n   describe '#pushes_since_gc' do\n     let(:project) { create(:project) }\n \n@@ -2557,6 +2789,35 @@ describe Project do\n     end\n   end\n \n+  describe '#repository_and_lfs_size' do\n+    let(:project) { create(:project, :repository) }\n+    let(:size) { 50 }\n+\n+    before do\n+      allow(project.statistics).to receive(:total_repository_size).and_return(size)\n+    end\n+\n+    it 'returns the total repository and lfs size' do\n+      expect(project.repository_and_lfs_size).to eq(size)\n+    end\n+  end\n+\n+  describe '#approver_group_ids=' do\n+    let(:project) { create(:project) }\n+\n+    it 'create approver_groups' do\n+      group = create :group\n+      group1 = create :group\n+\n+      project = create :project\n+\n+      project.approver_group_ids = \"#{group.id}, #{group1.id}\"\n+      project.save!\n+\n+      expect(project.approver_groups.map(\u0026:group)).to match_array([group, group1])\n+    end\n+  end\n+\n   describe '#reset_pushes_since_gc' do\n     let(:project) { create(:project) }\n \n@@ -2873,6 +3134,16 @@ describe Project do\n     end\n   end\n \n+  describe '#create_import_state' do\n+    it 'it is called after save' do\n+      project = create(:project)\n+\n+      expect(project).to receive(:create_import_state)\n+\n+      project.update(mirror: true, mirror_user: project.owner, import_url: 'http://foo.com')\n+    end\n+  end\n+\n   describe 'inside_path' do\n     let!(:project1) { create(:project, namespace: create(:namespace, path: 'name_pace')) }\n     let!(:project2) { create(:project) }\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/models/project_team_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/models/project_team_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/models/project_team_spec.rb\nindex 3537dead5d1..726edc30986 100644\n--- a/spec/models/project_team_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/models/project_team_spec.rb\n@@ -178,18 +178,27 @@ describe ProjectTeam do\n     end\n   end\n \n-  describe '#members_in_project_and_ancestors' do\n-    context 'group project' do\n-      it 'filters out users who are not members of the project' do\n-        group = create(:group)\n-        project = create(:project, group: group)\n-        group_member = create(:group_member, group: group)\n-        old_user = create(:user)\n+  describe '#add_users' do\n+    let(:user1) { create(:user) }\n+    let(:user2) { create(:user) }\n+    let(:project) { create(:project) }\n \n-        ProjectAuthorization.create!(project: project, user: old_user, access_level: Gitlab::Access::GUEST)\n+    it 'add the given users to the team' do\n+      project.team.add_users([user1, user2], :reporter)\n \n-        expect(project.team.members_in_project_and_ancestors).to contain_exactly(group_member.user)\n-      end\n+      expect(project.team.reporter?(user1)).to be(true)\n+      expect(project.team.reporter?(user2)).to be(true)\n+    end\n+  end\n+\n+  describe '#add_user' do\n+    let(:user) { create(:user) }\n+    let(:project) { create(:project) }\n+\n+    it 'add the given user to the team' do\n+      project.team.add_user(user, :reporter)\n+\n+      expect(project.team.reporter?(user)).to be(true)\n     end\n   end\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/models/project_wiki_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/models/project_wiki_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/models/project_wiki_spec.rb\nindex 3ccc706edf2..e699284843c 100644\n--- a/spec/models/project_wiki_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/models/project_wiki_spec.rb\n@@ -54,6 +54,14 @@ describe ProjectWiki do\n     end\n   end\n \n+  describe \"#kerberos_url_to_repo\" do\n+    it 'returns valid kerberos url for this repo' do\n+      gitlab_kerberos_url = Gitlab.config.build_gitlab_kerberos_url\n+      repo_kerberos_url = \"#{gitlab_kerberos_url}/#{subject.full_path}.git\"\n+      expect(subject.kerberos_url_to_repo).to eq(repo_kerberos_url)\n+    end\n+  end\n+\n   describe \"#wiki_base_path\" do\n     it \"returns the wiki base path\" do\n       wiki_base_path = \"#{Gitlab.config.gitlab.relative_url_root}/#{project.full_path}/wikis\"\n```\n\n\u003c/details\u003e\n","state":"closed","created_at":"2018-06-25T17:06:11.697Z","updated_at":"2019-08-12T15:32:23.058Z","closed_at":"2019-04-04T12:26:15.094Z","closed_by":{"id":128633,"username":"rymai","name":"R√©my Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"},"labels":["Enterprise Edition","Manage [DEPRECATED]","Quality","[deprecated] Accepting merge requests","backend","backstage [DEPRECATED]","single codebase","test"],"milestone":{"id":655279,"iid":27,"group_id":9970,"title":"11.10","description":"","state":"closed","created_at":"2018-09-21T19:08:16.261Z","updated_at":"2019-05-21T09:17:49.051Z","due_date":"2019-04-22","start_date":"2019-03-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/27"},"assignees":[{"id":128633,"username":"rymai","name":"R√©my Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":128633,"username":"rymai","name":"R√©my Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6663","time_stats":{"time_estimate":57600,"total_time_spent":0,"human_time_estimate":"16h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6663","notes":"https://gitlab.com/api/v4/projects/278964/issues/6663/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6663/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6663","relative":"#6663","full":"gitlab-org/gitlab#6663"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12326490,"iid":6662,"project_id":278964,"title":"Extract EE specific files/lines for lib/gitlab (harder but less)","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003elib/gitlab/git_access.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/lib/gitlab/git_access.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/gitlab/git_access.rb\nindex 010bd0e520c..dc3ca042781 100644\n--- a/lib/gitlab/git_access.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/gitlab/git_access.rb\n@@ -4,6 +4,9 @@\n # class return an instance of `GitlabAccessStatus`\n module Gitlab\n   class GitAccess\n+    prepend ::EE::Gitlab::GitAccess # rubocop: disable Cop/InjectEnterpriseEditionModule\n+    include ActionView::Helpers::SanitizeHelper\n+    include PathLocksHelper\n     include Gitlab::Utils::StrongMemoize\n \n     UnauthorizedError = Class.new(StandardError)\n@@ -246,18 +249,22 @@ module Gitlab\n       end\n     end\n \n+    # TODO: please clean this up\n     def check_push_access!\n       if project.repository_read_only?\n+        # The repository is temporarily read-only. Please try again later.\n         raise UnauthorizedError, ERROR_MESSAGES[:read_only]\n       end\n \n       if deploy_key?\n         unless deploy_key.can_push_to?(project)\n+          # This deploy key does not have write access to this project.\n           raise UnauthorizedError, ERROR_MESSAGES[:deploy_key_upload]\n         end\n       elsif user\n         # User access is verified in check_change_access!\n       else\n+        # You are not allowed to upload code for this project.\n         raise UnauthorizedError, ERROR_MESSAGES[:upload]\n       end\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003elib/gitlab/usage_data.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/lib/gitlab/usage_data.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/gitlab/usage_data.rb\nindex 0101ccc046a..a671d42104d 100644\n--- a/lib/gitlab/usage_data.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/gitlab/usage_data.rb\n@@ -5,6 +5,8 @@ module Gitlab\n     APPROXIMATE_COUNT_MODELS = [Label, MergeRequest, Note, Todo].freeze\n \n     class \u003c\u003c self\n+      prepend EE::Gitlab::UsageData # rubocop: disable Cop/InjectEnterpriseEditionModule\n+\n       def data(force_refresh: false)\n         Rails.cache.fetch('usage_data', force: force_refresh, expires_in: 2.weeks) { uncached_data }\n       end\n@@ -29,7 +31,7 @@ module Gitlab\n           installation_type: Gitlab::INSTALLATION_TYPE,\n           active_user_count: count(User.active),\n           recorded_at: Time.now,\n-          edition: 'CE'\n+          edition: 'EE'\n         }\n \n         usage_data\n```\n\n\u003c/details\u003e\n","state":"closed","created_at":"2018-06-25T16:58:45.930Z","updated_at":"2019-12-02T11:56:52.496Z","closed_at":"2019-03-18T15:11:13.154Z","closed_by":{"id":15139,"username":"rspeicher","name":"Robert Speicher","state":"active","avatar_url":"https://secure.gravatar.com/avatar/73c8253932541a7b5cbc5d79493f2bea?s=80\u0026d=identicon","web_url":"https://gitlab.com/rspeicher"},"labels":["Deliverable","Enterprise Edition","Manage [DEPRECATED]","backend","backstage [DEPRECATED]","devops::manage","priority::2","single codebase","team::Delivery"],"milestone":{"id":655279,"iid":27,"group_id":9970,"title":"11.10","description":"","state":"closed","created_at":"2018-09-21T19:08:16.261Z","updated_at":"2019-05-21T09:17:49.051Z","due_date":"2019-04-22","start_date":"2019-03-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/27"},"assignees":[{"id":209240,"username":"yorickpeterse","name":"Yorick Peterse","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/209240/avatar.png","web_url":"https://gitlab.com/yorickpeterse"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":209240,"username":"yorickpeterse","name":"Yorick Peterse","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/209240/avatar.png","web_url":"https://gitlab.com/yorickpeterse"},"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6662","time_stats":{"time_estimate":28800,"total_time_spent":0,"human_time_estimate":"8h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6662","notes":"https://gitlab.com/api/v4/projects/278964/issues/6662/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6662/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6662","relative":"#6662","full":"gitlab-org/gitlab#6662"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12326489,"iid":6661,"project_id":278964,"title":"Extract EE specific files/lines for lib/gitlab (easier but more)","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003elib/gitlab/access.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/lib/gitlab/access.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/gitlab/access.rb\nindex ec090aea784..bc54f4e3f18 100644\n--- a/lib/gitlab/access.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/gitlab/access.rb\n@@ -7,6 +7,8 @@\n #\n module Gitlab\n   module Access\n+    extend ::EE::Gitlab::Access # rubocop: disable Cop/InjectEnterpriseEditionModule\n+\n     AccessDeniedError = Class.new(StandardError)\n \n     NO_ACCESS  = 0\n@@ -17,6 +19,7 @@ module Gitlab\n     # @deprecated\n     MASTER     = MAINTAINER\n     OWNER      = 50\n+    ADMIN      = 60\n \n     # Branch protection settings\n     PROTECTION_NONE          = 0\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003elib/gitlab/database.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/lib/gitlab/database.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/gitlab/database.rb\nindex b6ca777e029..abf5105eb8f 100644\n--- a/lib/gitlab/database.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/gitlab/database.rb\n@@ -11,6 +11,10 @@ module Gitlab\n     # https://dev.mysql.com/doc/refman/5.7/en/datetime.html\n     MAX_TIMESTAMP_VALUE = Time.at((1 \u003c\u003c 31) - 1).freeze\n \n+    class \u003c\u003c self\n+      prepend EE::Gitlab::Database # rubocop: disable Cop/InjectEnterpriseEditionModule\n+    end\n+\n     def self.config\n       ActiveRecord::Base.configurations[Rails.env]\n     end\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003elib/gitlab/exclusive_lease.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/lib/gitlab/exclusive_lease.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/gitlab/exclusive_lease.rb\nindex d466d2a514c..dc88334bdb9 100644\n--- a/lib/gitlab/exclusive_lease.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/gitlab/exclusive_lease.rb\n@@ -68,6 +68,18 @@ module Gitlab\n       end\n     end\n \n+    # Try to obtain the lease. Returns the UUID and current TTL, which will be\n+    # zero if it's not taken.\n+    def try_obtain_with_ttl\n+      Gitlab::Redis::SharedState.with do |redis|\n+        output = redis.set(@redis_shared_state_key, @uuid, nx: true, ex: @timeout) \u0026\u0026 @uuid\n+\n+        ttl = output ? 0 : redis.ttl(@redis_shared_state_key)\n+\n+        { ttl: [ttl, 0].max, uuid: output }\n+      end\n+    end\n+\n     # Try to renew an existing lease. Return lease UUID on success,\n     # false if the lease is taken by a different UUID or inexistent.\n     def renew\n@@ -94,5 +106,12 @@ module Gitlab\n         ttl if ttl.positive?\n       end\n     end\n+\n+    # Returns true if the UUID for the key hasn't changed.\n+    def same_uuid?\n+      Gitlab::Redis::SharedState.with do |redis|\n+        redis.get(@redis_shared_state_key) == @uuid\n+      end\n+    end\n   end\n end\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003elib/gitlab/favicon.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/lib/gitlab/favicon.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/gitlab/favicon.rb\nindex 1ae2f9dfd93..c6dc0e1a1a8 100644\n--- a/lib/gitlab/favicon.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/gitlab/favicon.rb\n@@ -10,7 +10,7 @@ module Gitlab\n           elsif Gitlab::Utils.to_boolean(ENV['CANARY'])\n             'favicon-yellow.png'\n           elsif Rails.env.development?\n-            'favicon-blue.png'\n+            'favicon-green.png'\n           else\n             'favicon.png'\n           end\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003elib/gitlab/path_regex.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/lib/gitlab/path_regex.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/gitlab/path_regex.rb\nindex 3c888be0710..eace1e49889 100644\n--- a/lib/gitlab/path_regex.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/gitlab/path_regex.rb\n@@ -233,6 +233,10 @@ module Gitlab\n       }x\n     end\n \n+    def saml_callback_regex\n+      @saml_callback_regex ||= %r(\\A\\/groups\\/(?\u003cgroup\u003e#{full_namespace_route_regex})\\/\\-\\/saml\\/callback\\z).freeze\n+    end\n+\n     private\n \n     def single_line_regexp(regex)\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003elib/gitlab/sidekiq_config.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/lib/gitlab/sidekiq_config.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/gitlab/sidekiq_config.rb\nindex 3b8de64913b..fb303e3fb0c 100644\n--- a/lib/gitlab/sidekiq_config.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/gitlab/sidekiq_config.rb\n@@ -48,7 +48,9 @@ module Gitlab\n     end\n \n     def self.workers\n-      @workers ||= find_workers(Rails.root.join('app', 'workers'))\n+      @workers ||=\n+        find_workers(Rails.root.join('app', 'workers')) +\n+        find_workers(Rails.root.join('ee', 'app', 'workers'))\n     end\n \n     def self.find_workers(root)\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003elib/gitlab/utils.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/lib/gitlab/utils.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/gitlab/utils.rb\nindex 99fa65e0e90..622d67cfb81 100644\n--- a/lib/gitlab/utils.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/gitlab/utils.rb\n@@ -104,6 +104,13 @@ module Gitlab\n       nil\n     end\n \n+    # EE below\n+    def try_megabytes_to_bytes(size)\n+      Integer(size).megabytes\n+    rescue ArgumentError\n+      size\n+    end\n+\n     def bytes_to_megabytes(bytes)\n       bytes.to_f / Numeric::MEGABYTE\n     end\n```\n\n\u003c/details\u003e\n","state":"closed","created_at":"2018-06-25T16:58:42.884Z","updated_at":"2019-12-02T11:56:51.953Z","closed_at":"2019-03-18T15:11:12.723Z","closed_by":{"id":15139,"username":"rspeicher","name":"Robert Speicher","state":"active","avatar_url":"https://secure.gravatar.com/avatar/73c8253932541a7b5cbc5d79493f2bea?s=80\u0026d=identicon","web_url":"https://gitlab.com/rspeicher"},"labels":["Enterprise Edition","backend","backstage [DEPRECATED]","single codebase","team::Delivery"],"milestone":{"id":655279,"iid":27,"group_id":9970,"title":"11.10","description":"","state":"closed","created_at":"2018-09-21T19:08:16.261Z","updated_at":"2019-05-21T09:17:49.051Z","due_date":"2019-04-22","start_date":"2019-03-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/27"},"assignees":[{"id":209240,"username":"yorickpeterse","name":"Yorick Peterse","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/209240/avatar.png","web_url":"https://gitlab.com/yorickpeterse"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":209240,"username":"yorickpeterse","name":"Yorick Peterse","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/209240/avatar.png","web_url":"https://gitlab.com/yorickpeterse"},"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6661","time_stats":{"time_estimate":144000,"total_time_spent":0,"human_time_estimate":"40h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6661","notes":"https://gitlab.com/api/v4/projects/278964/issues/6661/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6661/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6661","relative":"#6661","full":"gitlab-org/gitlab#6661"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12326323,"iid":6660,"project_id":278964,"title":"Extract EE specific files/lines for Create spec/lib/gitlab","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003espec/lib/gitlab/git_access_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/lib/gitlab/git_access_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/lib/gitlab/git_access_spec.rb\nindex 634c370d211..e85e8602e85 100644\n--- a/spec/lib/gitlab/git_access_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/lib/gitlab/git_access_spec.rb\n@@ -800,6 +800,33 @@ describe Gitlab::GitAccess do\n       end\n     end\n \n+    # Run permission checks for a group\n+    def self.run_group_permission_checks(permissions_matrix)\n+      permissions_matrix.each_pair do |role, matrix|\n+        it \"has the correct permissions for group #{role}s\" do\n+          project\n+            .project_group_links\n+            .create(group: group, group_access: Gitlab::Access.sym_options[role])\n+\n+          protected_branch.save\n+\n+          aggregate_failures do\n+            matrix.each do |action, allowed|\n+              check = -\u003e { push_changes(changes[action]) }\n+\n+              if allowed\n+                expect(\u0026check).not_to raise_error,\n+                  -\u003e { \"expected #{action} to be allowed\" }\n+              else\n+                expect(\u0026check).to raise_error(Gitlab::GitAccess::UnauthorizedError),\n+                  -\u003e { \"expected #{action} to be disallowed\" }\n+              end\n+            end\n+          end\n+        end\n+      end\n+    end\n+\n     permissions_matrix = {\n       admin: {\n         any: true,\n@@ -908,6 +935,92 @@ describe Gitlab::GitAccess do\n         run_permission_checks(permissions_matrix.deep_merge(developer: { push_protected_branch: true, push_all: true, merge_into_protected_branch: true }))\n       end\n \n+      context \"user-specific access control\" do\n+        let(:user) { create(:user) }\n+\n+        context \"when a specific user is allowed to push into the #{protected_branch_type} protected branch\" do\n+          let(:protected_branch) { build(:protected_branch, authorize_user_to_push: user, name: protected_branch_name, project: project) }\n+\n+          run_permission_checks(permissions_matrix.deep_merge(developer: { push_protected_branch: true, push_all: true, merge_into_protected_branch: true },\n+                                                              guest: { push_protected_branch: false, merge_into_protected_branch: false },\n+                                                              reporter: { push_protected_branch: false, merge_into_protected_branch: false }))\n+        end\n+\n+        context \"when a specific user is allowed to merge into the #{protected_branch_type} protected branch\" do\n+          let(:protected_branch) { build(:protected_branch, authorize_user_to_merge: user, name: protected_branch_name, project: project) }\n+\n+          before do\n+            create(:merge_request, source_project: project, source_branch: unprotected_branch, target_branch: 'feature', state: 'locked', in_progress_merge_commit_sha: merge_into_protected_branch)\n+          end\n+\n+          run_permission_checks(permissions_matrix.deep_merge(admin: { push_protected_branch: false, push_all: false, merge_into_protected_branch: true },\n+                                                              maintainer: { push_protected_branch: false, push_all: false, merge_into_protected_branch: true },\n+                                                              developer: { push_protected_branch: false, push_all: false, merge_into_protected_branch: true },\n+                                                              guest: { push_protected_branch: false, merge_into_protected_branch: false },\n+                                                              reporter: { push_protected_branch: false, merge_into_protected_branch: false }))\n+        end\n+\n+        context \"when a specific user is allowed to push \u0026 merge into the #{protected_branch_type} protected branch\" do\n+          let(:protected_branch) { build(:protected_branch, authorize_user_to_push: user, authorize_user_to_merge: user, name: protected_branch_name, project: project) }\n+\n+          before do\n+            create(:merge_request, source_project: project, source_branch: unprotected_branch, target_branch: 'feature', state: 'locked', in_progress_merge_commit_sha: merge_into_protected_branch)\n+          end\n+\n+          run_permission_checks(permissions_matrix.deep_merge(developer: { push_protected_branch: true, push_all: true, merge_into_protected_branch: true },\n+                                                              guest: { push_protected_branch: false, merge_into_protected_branch: false },\n+                                                              reporter: { push_protected_branch: false, merge_into_protected_branch: false }))\n+        end\n+      end\n+\n+      context \"group-specific access control\" do\n+        let(:user) { create(:user) }\n+        let(:group) { create(:group) }\n+\n+        before do\n+          group.add_maintainer(user)\n+        end\n+\n+        context \"when a specific group is allowed to push into the #{protected_branch_type} protected branch\" do\n+          let(:protected_branch) { build(:protected_branch, authorize_group_to_push: group, name: protected_branch_name, project: project) }\n+\n+          permissions = permissions_matrix.except(:admin).deep_merge(developer: { push_protected_branch: true, push_all: true, merge_into_protected_branch: true },\n+                                                                     guest: { push_protected_branch: false, merge_into_protected_branch: false },\n+                                                                     reporter: { push_protected_branch: false, merge_into_protected_branch: false })\n+\n+          run_group_permission_checks(permissions)\n+        end\n+\n+        context \"when a specific group is allowed to merge into the #{protected_branch_type} protected branch\" do\n+          let(:protected_branch) { build(:protected_branch, authorize_group_to_merge: group, name: protected_branch_name, project: project) }\n+\n+          before do\n+            create(:merge_request, source_project: project, source_branch: unprotected_branch, target_branch: 'feature', state: 'locked', in_progress_merge_commit_sha: merge_into_protected_branch)\n+          end\n+\n+          permissions = permissions_matrix.except(:admin).deep_merge(maintainer: { push_protected_branch: false, push_all: false, merge_into_protected_branch: true },\n+                                                                     developer: { push_protected_branch: false, push_all: false, merge_into_protected_branch: true },\n+                                                                     guest: { push_protected_branch: false, merge_into_protected_branch: false },\n+                                                                     reporter: { push_protected_branch: false, merge_into_protected_branch: false })\n+\n+          run_group_permission_checks(permissions)\n+        end\n+\n+        context \"when a specific group is allowed to push \u0026 merge into the #{protected_branch_type} protected branch\" do\n+          let(:protected_branch) { build(:protected_branch, authorize_group_to_push: group, authorize_group_to_merge: group, name: protected_branch_name, project: project) }\n+\n+          before do\n+            create(:merge_request, source_project: project, source_branch: unprotected_branch, target_branch: 'feature', state: 'locked', in_progress_merge_commit_sha: merge_into_protected_branch)\n+          end\n+\n+          permissions = permissions_matrix.except(:admin).deep_merge(developer: { push_protected_branch: true, push_all: true, merge_into_protected_branch: true },\n+                                                                     guest: { push_protected_branch: false, merge_into_protected_branch: false },\n+                                                                     reporter: { push_protected_branch: false, merge_into_protected_branch: false })\n+\n+          run_group_permission_checks(permissions)\n+        end\n+      end\n+\n       context \"when no one is allowed to push to the #{protected_branch_name} protected branch\" do\n         let(:protected_branch) { build(:protected_branch, :no_one_can_push, name: protected_branch_name, project: project) }\n```\n\n\u003c/details\u003e\n","state":"closed","created_at":"2018-06-25T16:48:33.474Z","updated_at":"2019-08-12T15:32:23.079Z","closed_at":"2019-05-06T12:41:30.224Z","closed_by":{"id":209240,"username":"yorickpeterse","name":"Yorick Peterse","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/209240/avatar.png","web_url":"https://gitlab.com/yorickpeterse"},"labels":["Create [DEPRECATED]","Deliverable","Enterprise Edition","Quality","backend","backstage [DEPRECATED]","group::source code","single codebase","test","workflow::in review"],"milestone":{"id":655280,"iid":28,"group_id":9970,"title":"11.11","description":"","state":"closed","created_at":"2018-09-21T19:08:37.027Z","updated_at":"2019-06-10T14:39:00.009Z","due_date":"2019-05-22","start_date":"2019-04-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/28"},"assignees":[{"id":1884221,"username":"patrickbajao","name":"Patrick Bajao","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1884221/avatar.png","web_url":"https://gitlab.com/patrickbajao"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":1884221,"username":"patrickbajao","name":"Patrick Bajao","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1884221/avatar.png","web_url":"https://gitlab.com/patrickbajao"},"user_notes_count":3,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6660","time_stats":{"time_estimate":57600,"total_time_spent":0,"human_time_estimate":"16h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6660","notes":"https://gitlab.com/api/v4/projects/278964/issues/6660/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6660/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6660","relative":"#6660","full":"gitlab-org/gitlab#6660"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12326322,"iid":6659,"project_id":278964,"title":"Extract EE specific files/lines for spec/lib/gitlab easier ones","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003espec/lib/gitlab/exclusive_lease_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/lib/gitlab/exclusive_lease_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/lib/gitlab/exclusive_lease_spec.rb\nindex aed7d8d81ce..ee352d85a2d 100644\n--- a/spec/lib/gitlab/exclusive_lease_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/lib/gitlab/exclusive_lease_spec.rb\n@@ -19,6 +19,34 @@ describe Gitlab::ExclusiveLease, :clean_gitlab_redis_shared_state do\n     end\n   end\n \n+  describe '#try_obtain_with_ttl' do\n+    it 'cannot obtain twice before the lease has expired' do\n+      lease = described_class.new(unique_key, timeout: 3600)\n+\n+      ttl_lease = lease.try_obtain_with_ttl\n+\n+      expect(ttl_lease[:uuid]).to be_present\n+      expect(ttl_lease[:ttl]).to eq(0)\n+\n+      second_ttl_lease = lease.try_obtain_with_ttl\n+\n+      expect(second_ttl_lease[:uuid]).to be false\n+      expect(second_ttl_lease[:ttl]).to be \u003e 0\n+    end\n+\n+    it 'can obtain after the lease has expired' do\n+      timeout = 1\n+      lease = described_class.new(unique_key, timeout: 1)\n+\n+      sleep(2 * timeout) # lease should have expired now\n+\n+      ttl_lease = lease.try_obtain_with_ttl\n+\n+      expect(ttl_lease[:uuid]).to be_present\n+      expect(ttl_lease[:ttl]).to eq(0)\n+    end\n+  end\n+\n   describe '#renew' do\n     it 'returns true when we have the existing lease' do\n       lease = described_class.new(unique_key, timeout: 3600)\n@@ -47,6 +75,23 @@ describe Gitlab::ExclusiveLease, :clean_gitlab_redis_shared_state do\n     end\n   end\n \n+  describe '#same_uuid?' do\n+    it 'returns true for an existing lease' do\n+      lease = described_class.new(unique_key, timeout: 3600)\n+      lease.try_obtain\n+\n+      expect(lease.same_uuid?).to eq(true)\n+    end\n+\n+    it 'returns false for a lease that does not exist' do\n+      described_class.new(unique_key, timeout: 3600).try_obtain\n+\n+      lease = described_class.new(unique_key, timeout: 3600)\n+\n+      expect(lease.same_uuid?).to eq(false)\n+    end\n+  end\n+\n   describe '.get_uuid' do\n     it 'gets the uuid if lease with the key associated exists' do\n       uuid = described_class.new(unique_key, timeout: 3600).try_obtain\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/lib/gitlab/sidekiq_config_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/lib/gitlab/sidekiq_config_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/lib/gitlab/sidekiq_config_spec.rb\nindex 0c66d764851..2f9e2034cf8 100644\n--- a/spec/lib/gitlab/sidekiq_config_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/lib/gitlab/sidekiq_config_spec.rb\n@@ -8,6 +8,13 @@ describe Gitlab::SidekiqConfig do\n       expect(workers).to include(PostReceive)\n       expect(workers).to include(MergeWorker)\n     end\n+\n+    it 'includes EE workers' do\n+      workers = described_class.workers\n+\n+      expect(workers).to include(RepositoryUpdateMirrorWorker)\n+      expect(workers).to include(LdapGroupSyncWorker)\n+    end\n   end\n \n   describe '.worker_queues' do\n@@ -20,6 +27,34 @@ describe Gitlab::SidekiqConfig do\n       expect(queues).to include('mailers')\n       expect(queues).to include('default')\n     end\n+\n+    it 'includes EE queues' do\n+      queues = described_class.worker_queues\n+\n+      expect(queues).to include('repository_update_mirror')\n+      expect(queues).to include('ldap_group_sync')\n+    end\n+  end\n+\n+  describe '.expand_queues' do\n+    it 'expands queue namespaces to concrete queue names' do\n+      queues = described_class.expand_queues(%w[cronjob])\n+\n+      expect(queues).to include('cronjob:stuck_import_jobs')\n+      expect(queues).to include('cronjob:stuck_merge_jobs')\n+    end\n+\n+    it 'lets concrete queue names pass through' do\n+      queues = described_class.expand_queues(%w[post_receive])\n+\n+      expect(queues).to include('post_receive')\n+    end\n+\n+    it 'lets unknown queues pass through' do\n+      queues = described_class.expand_queues(%w[unknown])\n+\n+      expect(queues).to include('unknown')\n+    end\n   end\n \n   describe '.expand_queues' do\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/lib/gitlab/usage_data_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/lib/gitlab/usage_data_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/lib/gitlab/usage_data_spec.rb\nindex d3eae80cc56..0666f55be05 100644\n--- a/spec/lib/gitlab/usage_data_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/lib/gitlab/usage_data_spec.rb\n@@ -1,6 +1,7 @@\n require 'spec_helper'\n \n describe Gitlab::UsageData do\n+  let(:project) { create(:project) }\n   let(:projects) { create_list(:project, 3) }\n   let!(:board) { create(:board, project: projects[0]) }\n \n@@ -33,7 +34,7 @@ describe Gitlab::UsageData do\n     subject { described_class.data }\n \n     it \"gathers usage data\" do\n-      expect(subject.keys).to match_array(%i(\n+      expect(subject.keys).to include(*%i(\n         active_user_count\n         counts\n         recorded_at\n@@ -64,7 +65,7 @@ describe Gitlab::UsageData do\n       expect(count_data[:boards]).to eq(1)\n       expect(count_data[:projects]).to eq(3)\n \n-      expect(count_data.keys).to match_array(%i(\n+      expect(count_data.keys).to include(*%i(\n         assignee_lists\n         boards\n         ci_builds\n```\n\n\u003c/details\u003e\n","state":"closed","created_at":"2018-06-25T16:48:30.698Z","updated_at":"2019-08-12T15:32:23.107Z","closed_at":"2019-05-09T16:31:29.922Z","closed_by":{"id":209240,"username":"yorickpeterse","name":"Yorick Peterse","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/209240/avatar.png","web_url":"https://gitlab.com/yorickpeterse"},"labels":["Deliverable","Enterprise Edition","Manage [DEPRECATED]","Quality","[deprecated] Accepting merge requests","backend","backstage [DEPRECATED]","single codebase","test"],"milestone":{"id":693518,"iid":33,"group_id":9970,"title":"12.0","description":"https://about.gitlab.com/releases/2019/06/22/gitlab-12-0-released/","state":"closed","created_at":"2018-10-30T16:47:37.975Z","updated_at":"2020-04-22T19:51:03.475Z","due_date":"2019-06-22","start_date":"2019-05-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/33"},"assignees":[{"id":273486,"username":"jameslopez","name":"James Lopez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/273486/avatar.png","web_url":"https://gitlab.com/jameslopez"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":273486,"username":"jameslopez","name":"James Lopez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/273486/avatar.png","web_url":"https://gitlab.com/jameslopez"},"user_notes_count":0,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6659","time_stats":{"time_estimate":28800,"total_time_spent":0,"human_time_estimate":"8h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6659","notes":"https://gitlab.com/api/v4/projects/278964/issues/6659/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6659/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6659","relative":"#6659","full":"gitlab-org/gitlab#6659"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12326096,"iid":6657,"project_id":278964,"title":"Extract EE specific files/lines for config/initializers","description":"We have the following files containing EE specific code. We should move them to ee/\n\n- config/initializers/0_inflections.rb\n- config/initializers/0_license.rb (file only)\n- config/initializers/0_post_deployment_migrations.rb\n- config/initializers/1_settings.rb\n- config/initializers/8_metrics.rb\n- config/initializers/ar_speed_up_migration_checking.rb\n- config/initializers/console_message.rb\n- config/initializers/elastic_client_setup.rb (file only)\n- config/initializers/geo.rb (file only)\n- config/initializers/health_check.rb\n- config/initializers/jira.rb (file only)\n- config/initializers/load_balancing.rb (file only)\n- config/initializers/sidekiq.rb\n- config/initializers/sidekiq_cluster.rb (file only)\n\nDifferences (if the file exists in CE):\n\n\u003cdetails\u003e\n\u003csummary\u003econfig/initializers/0_inflections.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/config/initializers/0_inflections.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/config/initializers/0_inflections.rb\nindex 1ad9ddca877..4d1f4917275 100644\n--- a/config/initializers/0_inflections.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/config/initializers/0_inflections.rb\n@@ -14,6 +14,14 @@ ActiveSupport::Inflector.inflections do |inflect|\n     award_emoji\n     project_statistics\n     system_note_metadata\n+    event_log\n     project_auto_devops\n+    project_registry\n+    file_registry\n+    job_artifact_registry\n+    vulnerability_feedback\n+    vulnerabilities_feedback\n+    group_view\n   )\n+  inflect.acronym 'EE'\n end\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003econfig/initializers/1_settings.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/config/initializers/1_settings.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/config/initializers/1_settings.rb\nindex dfcf1e648b4..02cd2f849a8 100644\n--- a/config/initializers/1_settings.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/config/initializers/1_settings.rb\n@@ -4,6 +4,10 @@ require_relative '../object_store_settings'\n # Default settings\n Settings['ldap'] ||= Settingslogic.new({})\n Settings.ldap['enabled'] = false if Settings.ldap['enabled'].nil?\n+Settings.ldap['sync_time'] = 3600 if Settings.ldap['sync_time'].nil?\n+Settings.ldap['schedule_sync_daily'] = 1 if Settings.ldap['schedule_sync_daily'].nil?\n+Settings.ldap['schedule_sync_hour'] = 1 if Settings.ldap['schedule_sync_hour'].nil?\n+Settings.ldap['schedule_sync_minute'] = 30 if Settings.ldap['schedule_sync_minute'].nil?\n \n # backwards compatibility, we only have one host\n if Settings.ldap['enabled'] || Rails.env.test?\n@@ -23,11 +27,14 @@ if Settings.ldap['enabled'] || Rails.env.test?\n     server['timeout'] ||= 10.seconds\n     server['block_auto_created_users'] = false if server['block_auto_created_users'].nil?\n     server['allow_username_or_email_login'] = false if server['allow_username_or_email_login'].nil?\n+    server['smartcard_auth'] = false unless %w[optional required].include?(server['smartcard_auth'])\n     server['active_directory'] = true if server['active_directory'].nil?\n     server['attributes'] = {} if server['attributes'].nil?\n     server['lowercase_usernames'] = false if server['lowercase_usernames'].nil?\n     server['provider_name'] ||= \"ldap#{key}\".downcase\n     server['provider_class'] = OmniAuth::Utils.camelize(server['provider_name'])\n+    server['external_groups'] = [] if server['external_groups'].nil?\n+    server['sync_ssh_keys'] = 'sshPublicKey' if server['sync_ssh_keys'].to_s == 'true'\n \n     # For backwards compatibility\n     server['encryption'] ||= server['method']\n@@ -44,6 +51,10 @@ if Settings.ldap['enabled'] || Rails.env.test?\n   end\n end\n \n+Settings['smartcard'] ||= Settingslogic.new({})\n+Settings.smartcard['enabled'] = false if Settings.smartcard['enabled'].nil?\n+Settings.smartcard['client_certificate_required_port'] = 3444 if Settings.smartcard['client_certificate_required_port'].nil?\n+\n Settings['omniauth'] ||= Settingslogic.new({})\n Settings.omniauth['enabled'] = true if Settings.omniauth['enabled'].nil?\n Settings.omniauth['auto_sign_in_with_provider'] = false if Settings.omniauth['auto_sign_in_with_provider'].nil?\n@@ -108,6 +119,7 @@ Settings['issues_tracker'] ||= {}\n # GitLab\n #\n Settings['gitlab'] ||= Settingslogic.new({})\n+Settings.gitlab['default_project_creation'] ||= ::EE::Gitlab::Access::DEVELOPER_MAINTAINER_PROJECT_ACCESS\n Settings.gitlab['default_projects_limit'] ||= 100000\n Settings.gitlab['default_branch_protection'] ||= 2\n Settings.gitlab['default_can_create_group'] = true if Settings.gitlab['default_can_create_group'].nil?\n@@ -142,6 +154,9 @@ Settings.gitlab['webhook_timeout'] ||= 10\n Settings.gitlab['max_attachment_size'] ||= 10\n Settings.gitlab['session_expire_delay'] ||= 10080\n Settings.gitlab['unauthenticated_session_expire_delay'] ||= 2.hours.to_i\n+Settings.gitlab['mirror_max_delay'] ||= 300\n+Settings.gitlab['mirror_max_capacity'] ||= 30\n+Settings.gitlab['mirror_capacity_threshold'] ||= 15\n Settings.gitlab.default_projects_features['issues']             = true if Settings.gitlab.default_projects_features['issues'].nil?\n Settings.gitlab.default_projects_features['merge_requests']     = true if Settings.gitlab.default_projects_features['merge_requests'].nil?\n Settings.gitlab.default_projects_features['wiki']               = true if Settings.gitlab.default_projects_features['wiki'].nil?\n@@ -156,6 +171,13 @@ Settings.gitlab['no_todos_messages'] ||= YAML.load_file(Rails.root.join('config'\n Settings.gitlab['impersonation_enabled'] ||= true if Settings.gitlab['impersonation_enabled'].nil?\n Settings.gitlab['usage_ping_enabled'] = true if Settings.gitlab['usage_ping_enabled'].nil?\n \n+#\n+# Elasticseacrh\n+#\n+Settings['elasticsearch'] ||= Settingslogic.new({})\n+Settings.elasticsearch['enabled'] = false if Settings.elasticsearch['enabled'].nil?\n+Settings.elasticsearch['url'] = ENV['ELASTIC_URL'] || \"http://localhost:9200\"\n+\n #\n # CI\n #\n@@ -215,6 +237,11 @@ Settings.pages['artifacts_server']  ||= Settings.pages['enabled'] if Settings.pa\n Settings.pages['admin'] ||= Settingslogic.new({})\n Settings.pages.admin['certificate'] ||= ''\n \n+#\n+# Geo\n+#\n+Settings.gitlab['geo_status_timeout'] ||= 10\n+\n #\n # External merge request diffs\n #\n@@ -240,6 +267,14 @@ Settings.uploads['base_dir'] = Settings.uploads['base_dir'] || 'uploads/-/system\n Settings.uploads['object_store'] = ObjectStoreSettings.parse(Settings.uploads['object_store'])\n Settings.uploads['object_store']['remote_directory'] ||= 'uploads'\n \n+#\n+# Packages\n+#\n+Settings['packages'] ||= Settingslogic.new({})\n+Settings.packages['enabled']      = true if Settings.packages['enabled'].nil?\n+Settings.packages['storage_path'] = Settings.absolute(Settings.packages['storage_path'] || File.join(Settings.shared['path'], \"packages\"))\n+Settings.packages['object_store'] = ObjectStoreSettings.parse(Settings.packages['object_store'])\n+\n #\n # Mattermost\n #\n@@ -278,6 +313,36 @@ Settings.cron_jobs['admin_email_worker']['job_class'] = 'AdminEmailWorker'\n Settings.cron_jobs['repository_archive_cache_worker'] ||= Settingslogic.new({})\n Settings.cron_jobs['repository_archive_cache_worker']['cron'] ||= '0 * * * *'\n Settings.cron_jobs['repository_archive_cache_worker']['job_class'] = 'RepositoryArchiveCacheWorker'\n+Settings.cron_jobs['historical_data_worker'] ||= Settingslogic.new({})\n+Settings.cron_jobs['historical_data_worker']['cron'] ||= '0 12 * * *'\n+Settings.cron_jobs['historical_data_worker']['job_class'] = 'HistoricalDataWorker'\n+Settings.cron_jobs['ldap_sync_worker'] ||= Settingslogic.new({})\n+Settings.cron_jobs['ldap_sync_worker']['cron'] ||= '30 1 * * *'\n+Settings.cron_jobs['ldap_sync_worker']['job_class'] = 'LdapSyncWorker'\n+Settings.cron_jobs['ldap_group_sync_worker'] ||= Settingslogic.new({})\n+Settings.cron_jobs['ldap_group_sync_worker']['cron'] ||= '0 * * * *'\n+Settings.cron_jobs['ldap_group_sync_worker']['job_class'] = 'LdapAllGroupsSyncWorker'\n+Settings.cron_jobs['geo_metrics_update_worker'] ||= Settingslogic.new({})\n+Settings.cron_jobs['geo_metrics_update_worker']['cron'] ||= '*/1 * * * *'\n+Settings.cron_jobs['geo_metrics_update_worker']['job_class'] ||= 'Geo::MetricsUpdateWorker'\n+Settings.cron_jobs['geo_repository_sync_worker'] ||= Settingslogic.new({})\n+Settings.cron_jobs['geo_repository_sync_worker']['cron'] ||= '*/1 * * * *'\n+Settings.cron_jobs['geo_repository_sync_worker']['job_class'] ||= 'Geo::RepositorySyncWorker'\n+Settings.cron_jobs['geo_file_download_dispatch_worker'] ||= Settingslogic.new({})\n+Settings.cron_jobs['geo_file_download_dispatch_worker']['cron'] ||= '*/1 * * * *'\n+Settings.cron_jobs['geo_file_download_dispatch_worker']['job_class'] ||= 'Geo::FileDownloadDispatchWorker'\n+Settings.cron_jobs['geo_prune_event_log_worker'] ||= Settingslogic.new({})\n+Settings.cron_jobs['geo_prune_event_log_worker']['cron'] ||= '*/5 * * * *'\n+Settings.cron_jobs['geo_prune_event_log_worker']['job_class'] ||= 'Geo::PruneEventLogWorker'\n+Settings.cron_jobs['geo_repository_verification_primary_batch_worker'] ||= Settingslogic.new({})\n+Settings.cron_jobs['geo_repository_verification_primary_batch_worker']['cron'] ||= '*/1 * * * *'\n+Settings.cron_jobs['geo_repository_verification_primary_batch_worker']['job_class'] ||= 'Geo::RepositoryVerification::Primary::BatchWorker'\n+Settings.cron_jobs['geo_repository_verification_secondary_scheduler_worker'] ||= Settingslogic.new({})\n+Settings.cron_jobs['geo_repository_verification_secondary_scheduler_worker']['cron'] ||= '*/1 * * * *'\n+Settings.cron_jobs['geo_repository_verification_secondary_scheduler_worker']['job_class'] ||= 'Geo::RepositoryVerification::Secondary::SchedulerWorker'\n+Settings.cron_jobs['geo_migrated_local_files_clean_up_worker'] ||= Settingslogic.new({})\n+Settings.cron_jobs['geo_migrated_local_files_clean_up_worker']['cron'] ||= '15 */6 * * *'\n+Settings.cron_jobs['geo_migrated_local_files_clean_up_worker']['job_class'] ||= 'Geo::MigratedLocalFilesCleanUpWorker'\n Settings.cron_jobs['import_export_project_cleanup_worker'] ||= Settingslogic.new({})\n Settings.cron_jobs['import_export_project_cleanup_worker']['cron'] ||= '0 * * * *'\n Settings.cron_jobs['import_export_project_cleanup_worker']['job_class'] = 'ImportExportProjectCleanupWorker'\n@@ -310,6 +375,14 @@ Settings.cron_jobs['gitlab_usage_ping_worker'] ||= Settingslogic.new({})\n Settings.cron_jobs['gitlab_usage_ping_worker']['cron'] ||= Settings.__send__(:cron_for_usage_ping)\n Settings.cron_jobs['gitlab_usage_ping_worker']['job_class'] = 'GitlabUsagePingWorker'\n \n+Settings.cron_jobs['pseudonymizer_worker'] ||= Settingslogic.new({})\n+Settings.cron_jobs['pseudonymizer_worker']['cron'] ||= '0 23 * * *'\n+Settings.cron_jobs['pseudonymizer_worker']['job_class'] ||= 'PseudonymizerWorker'\n+\n+Settings.cron_jobs['clear_shared_runners_minutes_worker'] ||= Settingslogic.new({})\n+Settings.cron_jobs['clear_shared_runners_minutes_worker']['cron'] ||= '0 0 1 * *'\n+Settings.cron_jobs['clear_shared_runners_minutes_worker']['job_class'] = 'ClearSharedRunnersMinutesWorker'\n+\n Settings.cron_jobs['stuck_merge_jobs_worker'] ||= Settingslogic.new({})\n Settings.cron_jobs['stuck_merge_jobs_worker']['cron'] ||= '0 */2 * * *'\n Settings.cron_jobs['stuck_merge_jobs_worker']['job_class'] = 'StuckMergeJobsWorker'\n@@ -326,6 +399,10 @@ Settings.cron_jobs['prune_web_hook_logs_worker'] ||= Settingslogic.new({})\n Settings.cron_jobs['prune_web_hook_logs_worker']['cron'] ||= '0 */1 * * *'\n Settings.cron_jobs['prune_web_hook_logs_worker']['job_class'] = 'PruneWebHookLogsWorker'\n \n+Settings.cron_jobs['update_max_seats_used_for_gitlab_com_subscriptions_worker'] ||= Settingslogic.new({})\n+Settings.cron_jobs['update_max_seats_used_for_gitlab_com_subscriptions_worker']['cron'] ||= '0 12 * * *'\n+Settings.cron_jobs['update_max_seats_used_for_gitlab_com_subscriptions_worker']['job_class'] = 'UpdateMaxSeatsUsedForGitlabComSubscriptionsWorker'\n+\n #\n # Sidekiq\n #\n@@ -403,6 +480,14 @@ Settings.backup['upload']['encryption'] ||= nil\n Settings.backup['upload']['encryption_key'] ||= ENV['GITLAB_BACKUP_ENCRYPTION_KEY']\n Settings.backup['upload']['storage_class'] ||= nil\n \n+#\n+# Pseudonymizer\n+#\n+Settings['pseudonymizer'] ||= Settingslogic.new({})\n+Settings.pseudonymizer['manifest'] = Settings.absolute(Settings.pseudonymizer['manifest'] || Rails.root.join(\"config/pseudonymizer.yml\"))\n+Settings.pseudonymizer['upload'] ||= Settingslogic.new({ 'remote_directory' =\u003e nil, 'connection' =\u003e nil })\n+# Settings.pseudonymizer['upload']['multipart_chunk_size'] ||= 104857600\n+\n #\n # Git\n #\n@@ -415,6 +500,21 @@ Settings.git['bin_path'] ||= '/usr/bin/git'\n Settings['satellites'] ||= Settingslogic.new({})\n Settings.satellites['path'] = Settings.absolute(Settings.satellites['path'] || \"tmp/repo_satellites/\")\n \n+#\n+# Kerberos\n+#\n+Settings['kerberos'] ||= Settingslogic.new({})\n+Settings.kerberos['enabled'] = false if Settings.kerberos['enabled'].nil?\n+Settings.kerberos['keytab'] = nil if Settings.kerberos['keytab'].blank? # nil means use default keytab\n+Settings.kerberos['service_principal_name'] = nil if Settings.kerberos['service_principal_name'].blank? # nil means any SPN in keytab\n+Settings.kerberos['use_dedicated_port'] = false if Settings.kerberos['use_dedicated_port'].nil?\n+Settings.kerberos['https'] = Settings.gitlab.https if Settings.kerberos['https'].nil?\n+Settings.kerberos['port'] ||= Settings.kerberos.https ? 8443 : 8088\n+\n+if Settings.kerberos['enabled'] \u0026\u0026 !Settings.omniauth.providers.map(\u0026:name).include?('kerberos_spnego')\n+  Settings.omniauth.providers \u003c\u003c Settingslogic.new({ 'name' =\u003e 'kerberos_spnego' })\n+end\n+\n #\n # Extra customization\n #\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003econfig/initializers/ar_speed_up_migration_checking.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/config/initializers/ar_speed_up_migration_checking.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/config/initializers/ar_speed_up_migration_checking.rb\nindex aae774daa35..f98b246db0b 100644\n--- a/config/initializers/ar_speed_up_migration_checking.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/config/initializers/ar_speed_up_migration_checking.rb\n@@ -10,7 +10,8 @@ if Rails.env.test?\n         # it reads + parses `db/migrate/*` each time. Memoizing it can save 0.5\n         # seconds per spec.\n         def migrations(paths)\n-          (@migrations ||= migrations_unmemoized(paths)).dup\n+          @migrations ||= {}\n+          (@migrations[paths] ||= migrations_unmemoized(paths)).dup\n         end\n       end\n     end\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003econfig/initializers/console_message.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/config/initializers/console_message.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/config/initializers/console_message.rb\nindex f7c26732e6d..55d8e39dc9b 100644\n--- a/config/initializers/console_message.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/config/initializers/console_message.rb\n@@ -6,5 +6,14 @@ if defined?(Rails::Console)\n   puts \" GitLab:\".ljust(justify) + \"#{Gitlab::VERSION} (#{Gitlab.revision})\"\n   puts \" GitLab Shell:\".ljust(justify) + \"#{Gitlab::VersionInfo.parse(Gitlab::Shell.new.version)}\"\n   puts \" #{Gitlab::Database.adapter_name}:\".ljust(justify) + Gitlab::Database.version\n+\n+  # EE-specific start\n+  if Gitlab::Geo.enabled?\n+    puts \" Geo enabled:\".ljust(justify) + 'yes'\n+    puts \" Geo server:\".ljust(justify) + EE::GeoHelper.current_node_human_status\n+  end\n+\n+  # EE specific end\n+\n   puts \"-------------------------------------------------------------------------------------\"\n end\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003econfig/initializers/health_check.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/config/initializers/health_check.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/config/initializers/health_check.rb\nindex 959daa93f78..c8e2a9c8e9d 100644\n--- a/config/initializers/health_check.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/config/initializers/health_check.rb\n@@ -1,4 +1,8 @@\n HealthCheck.setup do |config|\n   config.standard_checks = %w(database migrations cache)\n   config.full_checks = %w(database migrations cache)\n+\n+  config.add_custom_check('geo') do\n+    Gitlab::Geo::HealthCheck.perform_checks\n+  end\n end\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003econfig/initializers/sidekiq.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/config/initializers/sidekiq.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/config/initializers/sidekiq.rb\nindex 69a60a65e77..7dc3e3d67ed 100644\n--- a/config/initializers/sidekiq.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/config/initializers/sidekiq.rb\n@@ -66,6 +66,10 @@ Sidekiq.configure_server do |config|\n   end\n   Sidekiq::Cron::Job.load_from_hash! cron_jobs\n \n+  Gitlab::Mirror.configure_cron_job!\n+\n+  Gitlab::Geo.configure_cron_jobs!\n+\n   Gitlab::SidekiqVersioning.install!\n \n   db_config = Gitlab::Database.config ||\n@@ -74,6 +78,14 @@ Sidekiq.configure_server do |config|\n   ActiveRecord::Base.establish_connection(db_config)\n   Rails.logger.debug(\"Connection Pool size for Sidekiq Server is now: #{ActiveRecord::Base.connection.pool.instance_variable_get('@size')}\")\n \n+  # EE only\n+  if Gitlab::Geo.geo_database_configured?\n+    Rails.configuration.geo_database['pool'] = Sidekiq.options[:concurrency]\n+    Geo::TrackingBase.establish_connection(Rails.configuration.geo_database)\n+\n+    Rails.logger.debug(\"Connection Pool size for Sidekiq Server is now: #{Geo::TrackingBase.connection_pool.size} (Geo tracking database)\")\n+  end\n+\n   # Avoid autoload issue such as 'Mail::Parsers::AddressStruct'\n   # https://github.com/mikel/mail/issues/912#issuecomment-214850355\n   Mail.eager_autoload!\n```\n\n\u003c/details\u003e\n","state":"closed","created_at":"2018-06-25T16:29:02.845Z","updated_at":"2019-12-02T11:56:51.571Z","closed_at":"2019-07-15T22:35:14.799Z","closed_by":{"id":116,"username":"marin","name":"Marin Jankovski","state":"active","avatar_url":"https://secure.gravatar.com/avatar/5154f0b0eda3f798c8a254962d57192f?s=80\u0026d=identicon","web_url":"https://gitlab.com/marin"},"labels":["Enterprise Edition","[deprecated] Accepting merge requests","backend","backstage [DEPRECATED]","missed:11.11","single codebase","team::Delivery"],"milestone":{"id":693520,"iid":34,"group_id":9970,"title":"12.1","description":"https://about.gitlab.com/releases/2019/07/22/gitlab-12-1-released","state":"closed","created_at":"2018-10-30T16:47:58.826Z","updated_at":"2020-04-27T16:30:09.107Z","due_date":"2019-07-22","start_date":"2019-06-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/34"},"assignees":[],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":null,"user_notes_count":6,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6657","time_stats":{"time_estimate":144000,"total_time_spent":0,"human_time_estimate":"40h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6657","notes":"https://gitlab.com/api/v4/projects/278964/issues/6657/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6657/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6657","relative":"#6657","full":"gitlab-org/gitlab#6657"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12325935,"iid":6654,"project_id":278964,"title":"Extract EE specific files/lines for config/routes","description":"We have the following files containing EE specific code. We should move them to ee/\r\n\r\n- config/routes/admin.rb\r\n- config/routes/api.rb\r\n- config/routes/group.rb\r\n- config/routes/profile.rb\r\n- config/routes/project.rb\r\n- config/routes/repository.rb\r\n- config/routes/user.rb\r\n\r\nDifferences:\r\n\r\n\u003cdetails\u003e\r\n\u003csummary\u003econfig/routes/profile.rb\u003c/summary\u003e\r\n\r\n```diff\r\ndiff --git a/config/routes/profile.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/config/routes/profile.rb\r\nindex c1cac3905f1..6f2b8664e3b 100644\r\n--- a/config/routes/profile.rb\r\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/config/routes/profile.rb\r\n@@ -36,6 +36,14 @@ resource :profile, only: [:show, :update] do\r\n         put :resend_confirmation_instructions\r\n       end\r\n     end\r\n+\r\n+    ## EE-specific\r\n+    resource :slack, only: [:edit] do\r\n+      member do\r\n+        get :slack_link\r\n+      end\r\n+    end\r\n+\r\n     resources :chat_names, only: [:index, :new, :create, :destroy] do\r\n       collection do\r\n         delete :deny\r\n@@ -59,5 +67,10 @@ resource :profile, only: [:show, :update] do\r\n     end\r\n \r\n     resources :u2f_registrations, only: [:destroy]\r\n+\r\n+    ## EE-specific\r\n+    resources :pipeline_quota, only: [:index]\r\n+    resources :billings, only: [:index]\r\n+    ## EE-specific\r\n   end\r\n end\r\n```\r\n\r\n\u003c/details\u003e\r\n\u003cdetails\u003e\r\n\u003csummary\u003econfig/routes/project.rb\u003c/summary\u003e\r\n\r\n```diff\r\ndiff --git a/config/routes/project.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/config/routes/project.rb\r\nindex b4ebc7df4fe..f9e4a46b2f4 100644\r\n--- a/config/routes/project.rb\r\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/config/routes/project.rb\r\n@@ -79,9 +79,16 @@ constraints(::Constraints::ProjectUrlConstrainer.new) do\r\n       resource :mattermost, only: [:new, :create]\r\n \r\n       namespace :prometheus do\r\n-        resources :metrics, constraints: { id: %r{[^\\/]+} }, only: [] do\r\n+        resources :metrics, constraints: { id: %r{[^\\/]+} }, only: [:index, :new, :create, :edit, :update, :destroy] do\r\n+          post :validate_query, on: :collection\r\n           get :active_common, on: :collection\r\n         end\r\n+\r\n+        # EE-specific\r\n+        resources :alerts, constraints: { id: /\\d+/ }, only: [:index, :create, :show, :update, :destroy] do\r\n+          post :notify, on: :collection\r\n+        end\r\n+        # EE-specific\r\n       end\r\n \r\n       resources :deploy_keys, constraints: { id: /\\d+/ }, only: [:index, :new, :create, :edit, :update] do\r\n@@ -109,6 +116,15 @@ constraints(::Constraints::ProjectUrlConstrainer.new) do\r\n           get :pipeline_status\r\n           get :ci_environments_status\r\n           post :toggle_subscription\r\n+\r\n+          ## EE-specific\r\n+          get :approvals\r\n+          post :approvals, action: :approve\r\n+          delete :approvals, action: :unapprove\r\n+\r\n+          post :rebase\r\n+          ## EE-specific\r\n+\r\n           post :remove_wip\r\n           post :assign_related_issues\r\n           get :discussions, format: :json\r\n@@ -141,6 +157,23 @@ constraints(::Constraints::ProjectUrlConstrainer.new) do\r\n           post :bulk_update\r\n         end\r\n \r\n+        ## EE-specific\r\n+        resources :approvers, only: :destroy\r\n+        delete 'approvers', to: 'approvers#destroy_via_user_id', as: :approver_via_user_id\r\n+        resources :approver_groups, only: :destroy\r\n+        ## EE-specific\r\n+\r\n+        ## EE-specific\r\n+        scope module: :merge_requests do\r\n+          resources :drafts, only: [:index, :update, :create, :destroy] do\r\n+            collection do\r\n+              post :publish\r\n+              delete :discard\r\n+            end\r\n+          end\r\n+        end\r\n+        ## EE-specific\r\n+\r\n         resources :discussions, only: [:show], constraints: { id: /\\h{40}/ } do\r\n           member do\r\n             post :resolve\r\n@@ -171,6 +204,17 @@ constraints(::Constraints::ProjectUrlConstrainer.new) do\r\n         end\r\n       end\r\n \r\n+      ## EE-specific\r\n+      resources :path_locks, only: [:index, :destroy] do\r\n+        collection do\r\n+          post :toggle\r\n+        end\r\n+      end\r\n+\r\n+      ## EE-specific\r\n+      get '/service_desk' =\u003e 'service_desk#show', as: :service_desk\r\n+      put '/service_desk' =\u003e 'service_desk#update', as: :service_desk_refresh\r\n+\r\n       resource :variables, only: [:show, :update]\r\n \r\n       resources :triggers, only: [:index, :create, :edit, :update, :destroy] do\r\n@@ -186,6 +230,10 @@ constraints(::Constraints::ProjectUrlConstrainer.new) do\r\n         end\r\n       end\r\n \r\n+      ## EE-specific\r\n+      resources :push_rules, constraints: { id: /\\d+/ }, only: [:update]\r\n+      ## EE-specific\r\n+\r\n       resources :pipelines, only: [:index, :new, :create, :show] do\r\n         collection do\r\n           resource :pipelines_settings, path: 'settings', only: [:show, :update]\r\n@@ -200,6 +248,8 @@ constraints(::Constraints::ProjectUrlConstrainer.new) do\r\n           get :builds\r\n           get :failures\r\n           get :status\r\n+          get :security\r\n+          get :licenses\r\n         end\r\n       end\r\n \r\n@@ -219,6 +269,9 @@ constraints(::Constraints::ProjectUrlConstrainer.new) do\r\n           get :metrics\r\n           get :additional_metrics\r\n           get '/terminal.ws/authorize', to: 'environments#terminal_websocket_authorize', constraints: { format: nil }\r\n+\r\n+          # EE\r\n+          get :logs\r\n         end\r\n \r\n         collection do\r\n@@ -235,6 +288,14 @@ constraints(::Constraints::ProjectUrlConstrainer.new) do\r\n         end\r\n       end\r\n \r\n+      ## EE-specific\r\n+      resources :protected_environments, only: [:create, :update, :destroy], constraints: { id: /\\d+/ } do\r\n+        collection do\r\n+          get 'search'\r\n+        end\r\n+      end\r\n+      ## EE-specific\r\n+\r\n       resource :cycle_analytics, only: [:show]\r\n \r\n       namespace :cycle_analytics do\r\n@@ -293,6 +354,10 @@ constraints(::Constraints::ProjectUrlConstrainer.new) do\r\n         namespace :ci do\r\n           resource :lint, only: [:show, :create]\r\n         end\r\n+\r\n+        ## EE-specific\r\n+        resources :feature_flags\r\n+        ## EE-specific\r\n       end\r\n \r\n       draw :legacy_builds\r\n@@ -324,6 +389,12 @@ constraints(::Constraints::ProjectUrlConstrainer.new) do\r\n         end\r\n       end\r\n \r\n+      # EE-specific start\r\n+      namespace :security do\r\n+        resource :dashboard, only: [:show], controller: :dashboard\r\n+      end\r\n+      # EE-specific end\r\n+\r\n       resources :milestones, constraints: { id: /\\d+/ } do\r\n         member do\r\n           post :promote\r\n@@ -348,6 +419,9 @@ constraints(::Constraints::ProjectUrlConstrainer.new) do\r\n         end\r\n       end\r\n \r\n+      ## EE-specific\r\n+      resources :vulnerability_feedback, only: [:index, :create, :destroy], constraints: { id: /\\d+/ }\r\n+\r\n       get :issues, to: 'issues#calendar', constraints: lambda { |req| req.format == :ics }\r\n       resources :issues, concerns: :awardable, constraints: { id: /\\d+/ } do\r\n         member do\r\n@@ -364,7 +438,14 @@ constraints(::Constraints::ProjectUrlConstrainer.new) do\r\n         collection do\r\n           post :bulk_update\r\n           post :import_csv\r\n+\r\n+          ## EE-specific START\r\n+          post :export_csv\r\n+          get :service_desk\r\n+          ## EE-specific END\r\n         end\r\n+\r\n+        resources :issue_links, only: [:index, :create, :destroy], as: 'links', path: 'links'\r\n       end\r\n \r\n       resources :project_members, except: [:show, :new, :edit], constraints: { id: %r{[a-zA-Z./0-9_\\-#%+]+} }, concerns: :access_requestable do\r\n@@ -395,7 +476,7 @@ constraints(::Constraints::ProjectUrlConstrainer.new) do\r\n       get 'noteable/:target_type/:target_id/notes' =\u003e 'notes#index', as: 'noteable_notes'\r\n \r\n       # On CE only index and show are needed\r\n-      resources :boards, only: [:index, :show]\r\n+      resources :boards, only: [:index, :show, :create, :update, :destroy]\r\n \r\n       resources :todos, only: [:create]\r\n \r\n@@ -418,6 +499,11 @@ constraints(::Constraints::ProjectUrlConstrainer.new) do\r\n         end\r\n       end\r\n \r\n+      ## EE-specific\r\n+      resources :approvers, only: :destroy\r\n+      resources :approver_groups, only: :destroy\r\n+      ## EE-specific\r\n+\r\n       resources :runner_projects, only: [:create, :destroy]\r\n       resources :badges, only: [:index] do\r\n         collection do\r\n@@ -431,6 +517,11 @@ constraints(::Constraints::ProjectUrlConstrainer.new) do\r\n           end\r\n         end\r\n       end\r\n+\r\n+      ## EE-specific\r\n+      resources :audit_events, only: [:index]\r\n+      ## EE-specific\r\n+\r\n       namespace :settings do\r\n         get :members, to: redirect(\"%{namespace_id}/%{project_id}/project_members\")\r\n         resource :ci_cd, only: [:show, :update], controller: 'ci_cd' do\r\n@@ -438,6 +529,11 @@ constraints(::Constraints::ProjectUrlConstrainer.new) do\r\n           put :reset_registration_token\r\n         end\r\n         resource :integrations, only: [:show]\r\n+\r\n+        resource :slack, only: [:destroy, :edit, :update] do\r\n+          get :slack_auth\r\n+        end\r\n+\r\n         resource :repository, only: [:show], controller: :repository do\r\n           post :create_deploy_token, path: 'deploy_token/create'\r\n           post :cleanup\r\n@@ -455,6 +551,10 @@ constraints(::Constraints::ProjectUrlConstrainer.new) do\r\n       draw :wiki\r\n       draw :repository\r\n \r\n+      ## EE-specific\r\n+      resources :managed_licenses, only: [:index, :show, :new, :create, :edit, :update, :destroy]\r\n+      ## EE-specific\r\n+\r\n       namespace :settings do\r\n         resource :operations, only: [:show, :update]\r\n       end\r\n```\r\n\r\n\u003c/details\u003e\r\n\u003cdetails\u003e\r\n\u003csummary\u003econfig/routes/repository.rb\u003c/summary\u003e\r\n\r\n```diff\r\ndiff --git a/config/routes/repository.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/config/routes/repository.rb\r\nindex f5201b9ddbb..fb48ec394b3 100644\r\n--- a/config/routes/repository.rb\r\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/config/routes/repository.rb\r\n@@ -58,7 +58,7 @@ scope format: false do\r\n       resource :release, controller: 'tags/releases', only: [:edit, :update]\r\n     end\r\n \r\n-    resources :protected_branches, only: [:index, :show, :create, :update, :destroy]\r\n+    resources :protected_branches, only: [:index, :show, :create, :update, :destroy, :patch], constraints: { id: Gitlab::PathRegex.git_reference_regex }\r\n     resources :protected_tags, only: [:index, :show, :create, :update, :destroy]\r\n   end\r\n```\r\n\r\n\u003c/details\u003e\r\n\u003cdetails\u003e\r\n\u003csummary\u003econfig/routes/user.rb\u003c/summary\u003e\r\n\r\n```diff\r\ndiff --git a/config/routes/user.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/config/routes/user.rb\r\nindex e0ae264e2c0..a6a697416af 100644\r\n--- a/config/routes/user.rb\r\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/config/routes/user.rb\r\n@@ -1,3 +1,8 @@\r\n+## EE-specific\r\n+get  'unsubscribes/:email', to: 'unsubscribes#show', as: :unsubscribe\r\n+post 'unsubscribes/:email', to: 'unsubscribes#create'\r\n+## EE-specific\r\n+\r\n # Allows individual providers to be directed to a chosen controller\r\n # Call from inside devise_scope\r\n def override_omniauth(provider, controller, path_prefix = '/users/auth')\r\n@@ -25,6 +30,17 @@ devise_for :users, controllers: { omniauth_callbacks: :omniauth_callbacks,\r\n devise_scope :user do\r\n   get '/users/auth/:provider/omniauth_error' =\u003e 'omniauth_callbacks#omniauth_error', as: :omniauth_error\r\n   get '/users/almost_there' =\u003e 'confirmations#almost_there'\r\n+\r\n+  ## EE-specific\r\n+  get '/users/auth/kerberos_spnego/negotiate' =\u003e 'omniauth_kerberos_spnego#negotiate'\r\n+  ## EE-specific\r\n+end\r\n+\r\n+scope '-/users', module: :users do\r\n+  resources :terms, only: [:index] do\r\n+    post :accept, on: :member\r\n+    post :decline, on: :member\r\n+  end\r\n end\r\n \r\n scope '-/users', module: :users do\r\n```\r\n\r\n\u003c/details\u003e\r\n","state":"closed","created_at":"2018-06-25T16:17:48.272Z","updated_at":"2019-12-02T11:56:50.697Z","closed_at":"2019-06-27T05:59:39.922Z","closed_by":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"labels":["Enterprise Edition","Quality","backend","backstage [DEPRECATED]","missed:11.10","routing","single codebase","team::Delivery"],"milestone":{"id":693520,"iid":34,"group_id":9970,"title":"12.1","description":"https://about.gitlab.com/releases/2019/07/22/gitlab-12-1-released","state":"closed","created_at":"2018-10-30T16:47:58.826Z","updated_at":"2020-04-27T16:30:09.107Z","due_date":"2019-07-22","start_date":"2019-06-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/34"},"assignees":[{"id":15139,"username":"rspeicher","name":"Robert Speicher","state":"active","avatar_url":"https://secure.gravatar.com/avatar/73c8253932541a7b5cbc5d79493f2bea?s=80\u0026d=identicon","web_url":"https://gitlab.com/rspeicher"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":15139,"username":"rspeicher","name":"Robert Speicher","state":"active","avatar_url":"https://secure.gravatar.com/avatar/73c8253932541a7b5cbc5d79493f2bea?s=80\u0026d=identicon","web_url":"https://gitlab.com/rspeicher"},"user_notes_count":8,"merge_requests_count":2,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6654","time_stats":{"time_estimate":144000,"total_time_spent":0,"human_time_estimate":"40h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6654","notes":"https://gitlab.com/api/v4/projects/278964/issues/6654/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6654/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6654","relative":"#6654","full":"gitlab-org/gitlab#6654"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12325771,"iid":6652,"project_id":278964,"title":"Extract EE specific files/lines for Create app/services","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003eapp/services/git_push_service.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/app/services/git_push_service.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/app/services/git_push_service.rb\nindex 092fd64574d..840e61911fc 100644\n--- a/app/services/git_push_service.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/app/services/git_push_service.rb\n@@ -235,6 +235,8 @@ class GitPushService \u003c BaseService\n   private\n \n   def pipeline_options\n-    {} # to be overriden in EE\n+    {} # to be overridden in EE\n   end\n end\n+\n+GitPushService.prepend(EE::GitPushService)\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003eapp/services/git_tag_push_service.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/app/services/git_tag_push_service.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/app/services/git_tag_push_service.rb\nindex 6fef5b3ed1d..2d4b2ba926d 100644\n--- a/app/services/git_tag_push_service.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/app/services/git_tag_push_service.rb\n@@ -61,6 +61,8 @@ class GitTagPushService \u003c BaseService\n   end\n \n   def pipeline_options\n-    {} # to be overriden in EE\n+    {} # to be overridden in EE\n   end\n end\n+\n+GitTagPushService.prepend(EE::GitTagPushService)\n```\n\n\u003c/details\u003e\n","state":"closed","created_at":"2018-06-25T16:09:15.871Z","updated_at":"2019-08-12T15:32:23.941Z","closed_at":"2019-04-01T20:25:10.685Z","closed_by":{"id":2702368,"username":".luke","name":"Luke Duncalfe","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2702368/avatar.png","web_url":"https://gitlab.com/.luke"},"labels":["Create [DEPRECATED]","Deliverable","Enterprise Edition","Quality","backend","backstage [DEPRECATED]","single codebase"],"milestone":{"id":655279,"iid":27,"group_id":9970,"title":"11.10","description":"","state":"closed","created_at":"2018-09-21T19:08:16.261Z","updated_at":"2019-05-21T09:17:49.051Z","due_date":"2019-04-22","start_date":"2019-03-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/27"},"assignees":[{"id":2702368,"username":".luke","name":"Luke Duncalfe","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2702368/avatar.png","web_url":"https://gitlab.com/.luke"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":2702368,"username":".luke","name":"Luke Duncalfe","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2702368/avatar.png","web_url":"https://gitlab.com/.luke"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6652","time_stats":{"time_estimate":3600,"total_time_spent":0,"human_time_estimate":"1h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6652","notes":"https://gitlab.com/api/v4/projects/278964/issues/6652/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6652/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6652","relative":"#6652","full":"gitlab-org/gitlab#6652"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":24664671,"iid":22959,"project_id":278964,"title":"Remove map-get($grid-breakpoints, xs) for max-width","description":"### Summary\n\nRemove `map-get($grid-breakpoints, xs)` (= `0`) for `max-width`.\n\n### Cases\n\nIn gitlab-foss@21b7e203b3d0b3048cd5f860e602d8a18655f118 (11.3-pre), there are two occurrences:\n```\n$ git grep -n 'max.*map-get..grid-breakpoints, xs'\napp/assets/stylesheets/pages/notes.scss:166:      @include notes-media('max', map-get($grid-breakpoints, xs)) {\napp/assets/stylesheets/pages/notes.scss:442:  @include notes-media('max', map-get($grid-breakpoints, xs)) {\n```\n\n### Ref.\n\n- gitlab-foss#47604 (gitlab-foss!19585)\n- https://getbootstrap.com/docs/4.0/layout/grid/","state":"closed","created_at":"2018-06-25T16:01:06.165Z","updated_at":"2019-09-24T16:05:43.104Z","closed_at":"2019-09-24T16:05:43.036Z","closed_by":{"id":408677,"username":"ClemMakesApps","name":"Clement Ho","state":"active","avatar_url":"https://secure.gravatar.com/avatar/013b4af8b474654bce8039ecd262a84a?s=80\u0026d=identicon","web_url":"https://gitlab.com/ClemMakesApps"},"labels":["bootstrap4","frontend","maintenance::refactor"],"milestone":{"id":731039,"iid":38,"group_id":9970,"title":"12.4","description":"https://about.gitlab.com/releases/2019/10/22/gitlab-12-4-released","state":"closed","created_at":"2018-12-07T12:41:53.212Z","updated_at":"2020-04-27T16:30:43.889Z","due_date":"2019-10-17","start_date":"2019-09-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/38"},"assignees":[{"id":100770,"username":"tnir","name":"Takuya Noguchi","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/100770/canstock6553672_288.png","web_url":"https://gitlab.com/tnir"}],"author":{"id":100770,"username":"tnir","name":"Takuya Noguchi","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/100770/canstock6553672_288.png","web_url":"https://gitlab.com/tnir"},"type":"ISSUE","assignee":{"id":100770,"username":"tnir","name":"Takuya Noguchi","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/100770/canstock6553672_288.png","web_url":"https://gitlab.com/tnir"},"user_notes_count":5,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":"2019-10-07","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/22959","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/22959","notes":"https://gitlab.com/api/v4/projects/278964/issues/22959/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/22959/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#22959","relative":"#22959","full":"gitlab-org/gitlab#22959"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":12325596,"iid":6651,"project_id":278964,"title":"Extract EE specific files/lines for Create app/serializers","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003eapp/serializers/blob_entity.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/app/serializers/blob_entity.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/app/serializers/blob_entity.rb\nindex 3ac61481dea..f0f86449b18 100644\n--- a/app/serializers/blob_entity.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/app/serializers/blob_entity.rb\n@@ -14,4 +14,10 @@ class BlobEntity \u003c Grape::Entity\n   expose :url, if: -\u003e (*) { request.respond_to?(:ref) } do |blob|\n     project_blob_path(request.project, File.join(request.ref, blob.path))\n   end\n+\n+  expose :file_lock, if: -\u003e (*) { request.respond_to?(:ref) }, using: FileLockEntity do |blob|\n+    if request.project.root_ref?(request.ref)\n+      request.project.find_path_lock(blob.path, exact_match: true)\n+    end\n+  end\n end\n```\n\n\u003c/details\u003e\n\n","state":"closed","created_at":"2018-06-25T15:59:17.840Z","updated_at":"2019-08-12T15:32:23.923Z","closed_at":"2019-03-27T14:36:41.503Z","closed_by":{"id":128633,"username":"rymai","name":"R√©my Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"},"labels":["Create [DEPRECATED]","Deliverable","Enterprise Edition","Quality","backend","backstage [DEPRECATED]","single codebase","workflow::in dev"],"milestone":{"id":655279,"iid":27,"group_id":9970,"title":"11.10","description":"","state":"closed","created_at":"2018-09-21T19:08:16.261Z","updated_at":"2019-05-21T09:17:49.051Z","due_date":"2019-04-22","start_date":"2019-03-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/27"},"assignees":[{"id":955795,"username":"fjsanpedro","name":"Francisco Javier L√≥pez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/955795/avatar.png","web_url":"https://gitlab.com/fjsanpedro"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":955795,"username":"fjsanpedro","name":"Francisco Javier L√≥pez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/955795/avatar.png","web_url":"https://gitlab.com/fjsanpedro"},"user_notes_count":0,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6651","time_stats":{"time_estimate":144000,"total_time_spent":0,"human_time_estimate":"40h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6651","notes":"https://gitlab.com/api/v4/projects/278964/issues/6651/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6651/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6651","relative":"#6651","full":"gitlab-org/gitlab#6651"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12325594,"iid":6649,"project_id":278964,"title":"Extract EE specific files/lines for CI/CD app/serializers","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003eapp/serializers/pipeline_details_entity.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/app/serializers/pipeline_details_entity.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/app/serializers/pipeline_details_entity.rb\nindex d78ad4af4dc..1fe175dc8ec 100644\n--- a/app/serializers/pipeline_details_entity.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/app/serializers/pipeline_details_entity.rb\n@@ -7,4 +7,7 @@ class PipelineDetailsEntity \u003c PipelineEntity\n     expose :manual_actions, using: BuildActionEntity\n     expose :scheduled_actions, using: BuildActionEntity\n   end\n+\n+  expose :triggered_by_pipeline, as: :triggered_by, with: TriggeredPipelineEntity\n+  expose :triggered_pipelines, as: :triggered, using: TriggeredPipelineEntity\n end\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003eapp/serializers/pipeline_serializer.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/app/serializers/pipeline_serializer.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/app/serializers/pipeline_serializer.rb\nindex 7451433a841..5d16913bad4 100644\n--- a/app/serializers/pipeline_serializer.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/app/serializers/pipeline_serializer.rb\n@@ -12,6 +12,8 @@ class PipelineSerializer \u003c BaseSerializer\n         :retryable_builds,\n         :cancelable_statuses,\n         :trigger_requests,\n+        { triggered_by_pipeline: [:project, :user] },\n+        { triggered_pipelines: [:project, :user] },\n         :manual_actions,\n         :scheduled_actions,\n         :artifacts,\n```\n\n\u003c/details\u003e\n","state":"closed","created_at":"2018-06-25T15:59:13.622Z","updated_at":"2019-08-12T15:32:24.154Z","closed_at":"2019-04-09T17:48:33.680Z","closed_by":{"id":15139,"username":"rspeicher","name":"Robert Speicher","state":"active","avatar_url":"https://secure.gravatar.com/avatar/73c8253932541a7b5cbc5d79493f2bea?s=80\u0026d=identicon","web_url":"https://gitlab.com/rspeicher"},"labels":["Deliverable","Enterprise Edition","backend","backstage [DEPRECATED]","devops::verify","single codebase"],"milestone":{"id":655280,"iid":28,"group_id":9970,"title":"11.11","description":"","state":"closed","created_at":"2018-09-21T19:08:37.027Z","updated_at":"2019-06-10T14:39:00.009Z","due_date":"2019-05-22","start_date":"2019-04-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/28"},"assignees":[{"id":722076,"username":"matteeyah","name":"Matija ƒåupiƒá","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8bc04cc15e0adba406cf56fecd9d910a?s=80\u0026d=identicon","web_url":"https://gitlab.com/matteeyah"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":722076,"username":"matteeyah","name":"Matija ƒåupiƒá","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8bc04cc15e0adba406cf56fecd9d910a?s=80\u0026d=identicon","web_url":"https://gitlab.com/matteeyah"},"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6649","time_stats":{"time_estimate":57600,"total_time_spent":0,"human_time_estimate":"16h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6649","notes":"https://gitlab.com/api/v4/projects/278964/issues/6649/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6649/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6649","relative":"#6649","full":"gitlab-org/gitlab#6649"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12323968,"iid":6641,"project_id":278964,"title":"Move EE differences for `spec/javascripts/sidebar/assignees_spec.js`","description":"Move EE differences for `spec/javascripts/sidebar/assignees_spec.js`\n\nhttps://leipert-projects.gitlab.io/is-gitlab-pretty-yet/diff/?search=assignees_spec.js","state":"closed","created_at":"2018-06-25T14:54:35.251Z","updated_at":"2022-05-19T16:29:22.414Z","closed_at":"2019-03-27T09:04:56.160Z","closed_by":{"id":482476,"username":"filipa","name":"Filipa Lacerda","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/482476/avatar.png","web_url":"https://gitlab.com/filipa"},"labels":["Enterprise Edition","backstage [DEPRECATED]","devops::plan","frontend","single codebase","test"],"milestone":{"id":655279,"iid":27,"group_id":9970,"title":"11.10","description":"","state":"closed","created_at":"2018-09-21T19:08:16.261Z","updated_at":"2019-05-21T09:17:49.051Z","due_date":"2019-04-22","start_date":"2019-03-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/27"},"assignees":[{"id":1212235,"username":"winh","name":"Inactive Account","state":"active","avatar_url":"https://secure.gravatar.com/avatar/e34b010c96ff3f44c62cddf66607232a?s=80\u0026d=identicon","web_url":"https://gitlab.com/winh"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":1212235,"username":"winh","name":"Inactive Account","state":"active","avatar_url":"https://secure.gravatar.com/avatar/e34b010c96ff3f44c62cddf66607232a?s=80\u0026d=identicon","web_url":"https://gitlab.com/winh"},"user_notes_count":0,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6641","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6641","notes":"https://gitlab.com/api/v4/projects/278964/issues/6641/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6641/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6641","relative":"#6641","full":"gitlab-org/gitlab#6641"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":601,"epic":{"id":2297,"iid":601,"title":"Move all EE specific frontend code behind an EE flag","url":"/groups/gitlab-org/-/epics/601","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12316479,"iid":6630,"project_id":278964,"title":"Extract EE specific files/lines for Create spec/workers","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003espec/workers/project_cache_worker_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/workers/project_cache_worker_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/workers/project_cache_worker_spec.rb\nindex b9b5445562f..a69aacd9441 100644\n--- a/spec/workers/project_cache_worker_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/workers/project_cache_worker_spec.rb\n@@ -49,6 +49,22 @@ describe ProjectCacheWorker do\n         worker.perform(project.id, %w(readme))\n       end\n \n+      context 'when in Geo secondary node' do\n+        before do\n+          allow(Gitlab::Geo).to receive(:secondary?).and_return(true)\n+        end\n+\n+        it 'updates only non database cache' do\n+          expect_any_instance_of(Repository).to receive(:refresh_method_caches)\n+            .and_call_original\n+\n+          expect_any_instance_of(Project).not_to receive(:update_repository_size)\n+          expect_any_instance_of(Project).not_to receive(:update_commit_count)\n+\n+          worker.perform(project.id, %w(readme))\n+        end\n+      end\n+\n       context 'with plain readme' do\n         it 'refreshes the method caches' do\n           allow(MarkupHelper).to receive(:gitlab_markdown?).and_return(false)\n```\n\n\u003c/details\u003e\n","state":"closed","created_at":"2018-06-25T12:44:53.472Z","updated_at":"2019-08-12T15:32:26.217Z","closed_at":"2019-04-25T17:10:00.824Z","closed_by":{"id":955795,"username":"fjsanpedro","name":"Francisco Javier L√≥pez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/955795/avatar.png","web_url":"https://gitlab.com/fjsanpedro"},"labels":["Create [DEPRECATED]","Deliverable","Enterprise Edition","Quality","backend","backstage [DEPRECATED]","group::source code","single codebase","test","workflow::in review"],"milestone":{"id":655280,"iid":28,"group_id":9970,"title":"11.11","description":"","state":"closed","created_at":"2018-09-21T19:08:37.027Z","updated_at":"2019-06-10T14:39:00.009Z","due_date":"2019-05-22","start_date":"2019-04-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/28"},"assignees":[{"id":955795,"username":"fjsanpedro","name":"Francisco Javier L√≥pez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/955795/avatar.png","web_url":"https://gitlab.com/fjsanpedro"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":955795,"username":"fjsanpedro","name":"Francisco Javier L√≥pez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/955795/avatar.png","web_url":"https://gitlab.com/fjsanpedro"},"user_notes_count":0,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6630","time_stats":{"time_estimate":28800,"total_time_spent":0,"human_time_estimate":"8h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6630","notes":"https://gitlab.com/api/v4/projects/278964/issues/6630/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6630/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6630","relative":"#6630","full":"gitlab-org/gitlab#6630"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12315186,"iid":6628,"project_id":278964,"title":"Extract EE specific files/lines for Discussion spec/services","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003espec/services/system_note_service_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/services/system_note_service_spec.rb b/home/felipe/development/gitlab-development-kit/gitlab/spec/services/system_note_service_spec.rb\nindex 4f633d24175..b917de14b2e 100644\n--- a/spec/services/system_note_service_spec.rb\n+++ b/home/felipe/development/gitlab-development-kit/gitlab/spec/services/system_note_service_spec.rb\n@@ -1,17 +1,15 @@\n require 'spec_helper'\n \n describe SystemNoteService do\n-  include ProjectForksHelper\n   include Gitlab::Routing\n   include RepoHelpers\n   include AssetsHelpers\n \n   set(:group)    { create(:group) }\n-  let(:project)  { create(:project, :repository, group: group) }\n+  set(:project)  { create(:project, :repository, group: group) }\n   set(:author)   { create(:user) }\n   let(:noteable) { create(:issue, project: project) }\n   let(:issue)    { noteable }\n-  let(:epic)     { create(:epic) }\n \n   shared_examples_for 'a system note' do\n     let(:expected_noteable) { noteable }\n@@ -621,7 +619,7 @@ describe SystemNoteService do\n \n     context 'commit with cross-reference from fork' do\n       let(:author2) { create(:project_member, :reporter, user: create(:user), project: project).user }\n-      let(:forked_project) { fork_project(project, author2, repository: true) }\n+      let(:forked_project) { Projects::ForkService.new(project, author2).execute }\n       let(:commit2) { forked_project.commit }\n \n       before do\n@@ -898,65 +896,29 @@ describe SystemNoteService do\n     end\n   end\n \n-  describe '.relate_issue' do\n-    let(:noteable_ref) { create(:issue) }\n-\n-    subject { described_class.relate_issue(noteable, noteable_ref, author) }\n-\n-    it_behaves_like 'a system note' do\n-      let(:action) { 'relate' }\n-    end\n-\n-    context 'when issue marks another as related' do\n-      it 'sets the note text' do\n-        expect(subject.note).to eq \"marked this issue as related to #{noteable_ref.to_reference(project)}\"\n-      end\n-    end\n-  end\n-\n-  describe '.unrelate_issue' do\n-    let(:noteable_ref) { create(:issue) }\n-\n-    subject { described_class.unrelate_issue(noteable, noteable_ref, author) }\n-\n-    it_behaves_like 'a system note' do\n-      let(:action) { 'unrelate' }\n-    end\n+  describe '.discussion_continued_in_issue' do\n+    let(:discussion) { create(:diff_note_on_merge_request, project: project).to_discussion }\n+    let(:merge_request) { discussion.noteable }\n+    let(:issue) { create(:issue, project: project) }\n \n-    context 'when issue relation is removed' do\n-      it 'sets the note text' do\n-        expect(subject.note).to eq \"removed the relation with #{noteable_ref.to_reference(project)}\"\n-      end\n+    def reloaded_merge_request\n+      MergeRequest.find(merge_request.id)\n     end\n-  end\n \n-  describe '.approve_mr' do\n-    let(:noteable) { create(:merge_request, source_project: project) }\n-    subject { described_class.approve_mr(noteable, author) }\n+    subject { described_class.discussion_continued_in_issue(discussion, project, author, issue) }\n \n     it_behaves_like 'a system note' do\n-      let(:action) { 'approved' }\n-    end\n-\n-    context 'when merge request approved' do\n-      it 'sets the note text' do\n-        expect(subject.note).to eq \"approved this merge request\"\n-      end\n+      let(:expected_noteable) { discussion.first_note.noteable }\n+      let(:action)              { 'discussion' }\n     end\n-  end\n \n-  describe '.unapprove_mr' do\n-    let(:noteable) { create(:merge_request, source_project: project) }\n-    subject { described_class.unapprove_mr(noteable, author) }\n-\n-    it_behaves_like 'a system note' do\n-      let(:action) { 'unapproved' }\n+    it 'creates a new note in the discussion' do\n+      # we need to completely rebuild the merge request object, or the `@discussions` on the merge request are not reloaded.\n+      expect { subject }.to change { reloaded_merge_request.discussions.first.notes.size }.by(1)\n     end\n \n-    context 'when merge request approved' do\n-      it 'sets the note text' do\n-        expect(subject.note).to eq \"unapproved this merge request\"\n-      end\n+    it 'mentions the created issue in the system note' do\n+      expect(subject.note).to include(issue.to_reference)\n     end\n   end\n \n@@ -982,32 +944,6 @@ describe SystemNoteService do\n     end\n   end\n \n-  describe '.discussion_continued_in_issue' do\n-    let(:discussion) { create(:diff_note_on_merge_request, project: project).to_discussion }\n-    let(:merge_request) { discussion.noteable }\n-    let(:issue) { create(:issue, project: project) }\n-\n-    def reloaded_merge_request\n-      MergeRequest.find(merge_request.id)\n-    end\n-\n-    subject { described_class.discussion_continued_in_issue(discussion, project, author, issue) }\n-\n-    it_behaves_like 'a system note' do\n-      let(:expected_noteable) { discussion.first_note.noteable }\n-      let(:action)              { 'discussion' }\n-    end\n-\n-    it 'creates a new note in the discussion' do\n-      # we need to completely rebuild the merge request object, or the `@discussions` on the merge request are not reloaded.\n-      expect { subject }.to change { reloaded_merge_request.discussions.first.notes.size }.by(1)\n-    end\n-\n-    it 'mentions the created issue in the system note' do\n-      expect(subject.note).to include(issue.to_reference)\n-    end\n-  end\n-\n   describe '.change_time_spent' do\n     # We need a custom noteable in order to the shared examples to be green.\n     let(:noteable) do\n@@ -1271,73 +1207,4 @@ describe SystemNoteService do\n       end\n     end\n   end\n-\n-  describe '.epic_issue' do\n-    let(:noteable) { epic }\n-    let(:project) { nil }\n-\n-    context 'issue added to an epic' do\n-      subject { described_class.epic_issue(epic, issue, author, :added) }\n-\n-      it_behaves_like 'a system note' do\n-        let(:action) { 'epic_issue_added' }\n-      end\n-\n-      it 'creates the note text correctly' do\n-        expect(subject.note).to eq(\"added issue #{issue.to_reference(epic.group)}\")\n-      end\n-    end\n-\n-    context 'issue removed from an epic' do\n-      subject { described_class.epic_issue(epic, issue, author, :removed) }\n-\n-      it_behaves_like 'a system note' do\n-        let(:action) { 'epic_issue_removed' }\n-      end\n-\n-      it 'creates the note text correctly' do\n-        expect(subject.note).to eq(\"removed issue #{issue.to_reference(epic.group)}\")\n-      end\n-    end\n-\n-    context 'invalid type' do\n-      it 'raises an error' do\n-        expect { described_class.issue_on_epic(issue, epic, author, :invalid) }\n-          .not_to change { Note.count }\n-      end\n-    end\n-  end\n-\n-  describe '.issue_on_epic' do\n-    context 'issue added to an epic' do\n-      subject { described_class.issue_on_epic(issue, epic, author, :added) }\n-\n-      it_behaves_like 'a system note' do\n-        let(:action) { 'issue_added_to_epic' }\n-      end\n-\n-      it 'creates the note text correctly' do\n-        expect(subject.note).to eq(\"added to epic #{epic.to_reference(issue.project)}\")\n-      end\n-    end\n-\n-    context 'issue removed from an epic' do\n-      subject { described_class.issue_on_epic(issue, epic, author, :removed) }\n-\n-      it_behaves_like 'a system note' do\n-        let(:action) { 'issue_removed_from_epic' }\n-      end\n-\n-      it 'creates the note text correctly' do\n-        expect(subject.note).to eq(\"removed from epic #{epic.to_reference(issue.project)}\")\n-      end\n-    end\n-\n-    context 'invalid type' do\n-      it 'does not create a new note' do\n-        expect { described_class.issue_on_epic(issue, epic, author, :invalid) }\n-          .not_to change { Note.count }\n-      end\n-    end\n-  end\n end\n```\n\n\u003c/details\u003e\n","state":"closed","created_at":"2018-06-25T12:17:14.304Z","updated_at":"2019-08-12T15:32:26.281Z","closed_at":"2019-04-08T18:10:14.840Z","closed_by":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"labels":["Enterprise Edition","Plan [DEPRECATED]","Quality","backend","backstage [DEPRECATED]","single codebase","test","workflow::in dev"],"milestone":{"id":655280,"iid":28,"group_id":9970,"title":"11.11","description":"","state":"closed","created_at":"2018-09-21T19:08:37.027Z","updated_at":"2019-06-10T14:39:00.009Z","due_date":"2019-05-22","start_date":"2019-04-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/28"},"assignees":[{"id":426128,"username":"felipe_artur","name":"Felipe Artur","state":"active","avatar_url":"https://secure.gravatar.com/avatar/dbad92659914f56621cbdd726e283e60?s=80\u0026d=identicon","web_url":"https://gitlab.com/felipe_artur"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":426128,"username":"felipe_artur","name":"Felipe Artur","state":"active","avatar_url":"https://secure.gravatar.com/avatar/dbad92659914f56621cbdd726e283e60?s=80\u0026d=identicon","web_url":"https://gitlab.com/felipe_artur"},"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6628","time_stats":{"time_estimate":28800,"total_time_spent":0,"human_time_estimate":"8h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6628","notes":"https://gitlab.com/api/v4/projects/278964/issues/6628/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6628/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6628","relative":"#6628","full":"gitlab-org/gitlab#6628"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12315007,"iid":6627,"project_id":278964,"title":"Extract EE specific files/lines for Create spec/services","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003espec/services/delete_branch_service_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/services/delete_branch_service_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/services/delete_branch_service_spec.rb\nindex 9c9fba030e7..ceca12a57b8 100644\n--- a/spec/services/delete_branch_service_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/services/delete_branch_service_spec.rb\n@@ -6,20 +6,24 @@ describe DeleteBranchService do\n   let(:user) { create(:user) }\n   let(:service) { described_class.new(project, user) }\n \n+  shared_examples 'a deleted branch' do |branch_name|\n+    it 'removes the branch' do\n+      expect(branch_exists?(branch_name)).to be true\n+\n+      result = service.execute(branch_name)\n+\n+      expect(result[:status]).to eq :success\n+      expect(branch_exists?(branch_name)).to be false\n+    end\n+  end\n+\n   describe '#execute' do\n     context 'when user has access to push to repository' do\n       before do\n         project.add_developer(user)\n       end\n \n-      it 'removes the branch' do\n-        expect(branch_exists?('feature')).to be true\n-\n-        result = service.execute('feature')\n-\n-        expect(result[:status]).to eq :success\n-        expect(branch_exists?('feature')).to be false\n-      end\n+      it_behaves_like 'a deleted branch', 'feature'\n     end\n \n     context 'when user does not have access to push to repository' do\n@@ -33,6 +37,15 @@ describe DeleteBranchService do\n         expect(branch_exists?('feature')).to be true\n       end\n     end\n+\n+    context 'when there is a push rule matching the branch name' do\n+      before do\n+        project.add_developer(user)\n+        create(:push_rule, branch_name_regex: '^(w*)$')\n+      end\n+\n+      it_behaves_like 'a deleted branch', 'add-pdf-file'\n+    end\n   end\n \n   def branch_exists?(branch_name)\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/services/git_push_service_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/services/git_push_service_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/services/git_push_service_spec.rb\nindex e8fce951155..dcdff077da8 100644\n--- a/spec/services/git_push_service_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/services/git_push_service_spec.rb\n@@ -1,6 +1,6 @@\n require 'spec_helper'\n \n-describe GitPushService, services: true do\n+describe GitPushService do\n   include RepoHelpers\n \n   set(:user)     { create(:user) }\n@@ -203,6 +203,28 @@ describe GitPushService, services: true do\n     end\n   end\n \n+  describe \"ES indexing\" do\n+    before do\n+      stub_ee_application_setting(elasticsearch_search: true, elasticsearch_indexing: true)\n+    end\n+\n+    after do\n+      stub_ee_application_setting(elasticsearch_search: false, elasticsearch_indexing: false)\n+    end\n+\n+    it \"does not trigger indexer when push to non-default branch\" do\n+      expect_any_instance_of(Gitlab::Elastic::Indexer).not_to receive(:run)\n+\n+      execute_service(project, user, oldrev, newrev, 'refs/heads/other')\n+    end\n+\n+    it \"triggers indexer when push to default branch\" do\n+      expect_any_instance_of(Gitlab::Elastic::Indexer).to receive(:run)\n+\n+      execute_service(project, user, oldrev, newrev, ref)\n+    end\n+  end\n+\n   describe \"Push Event\" do\n     context \"with an existing branch\" do\n       let!(:push_data) { push_data_from_service(project, user, oldrev, newrev, ref) }\n@@ -324,7 +346,8 @@ describe GitPushService, services: true do\n       it \"when pushing a branch for the first time with an existing branch permission configured\" do\n         stub_application_setting(default_branch_protection: Gitlab::Access::PROTECTION_DEV_CAN_PUSH)\n \n-        create(:protected_branch, :no_one_can_push, :developers_can_merge, project: project, name: 'master')\n+        create(:protected_branch, :no_one_can_push, :developers_can_merge,\n+               project: project, name: 'master')\n         expect(project).to receive(:execute_hooks)\n         expect(project.default_branch).to eq(\"master\")\n         expect_any_instance_of(ProtectedBranches::CreateService).not_to receive(:execute)\n```\n\n\u003c/details\u003e","state":"closed","created_at":"2018-06-25T12:15:49.783Z","updated_at":"2019-08-12T15:32:26.632Z","closed_at":"2019-05-02T00:54:42.787Z","closed_by":{"id":1884221,"username":"patrickbajao","name":"Patrick Bajao","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1884221/avatar.png","web_url":"https://gitlab.com/patrickbajao"},"labels":["Create [DEPRECATED]","Deliverable","Enterprise Edition","Quality","backend","group::source code","single codebase","test","workflow::in review"],"milestone":{"id":655280,"iid":28,"group_id":9970,"title":"11.11","description":"","state":"closed","created_at":"2018-09-21T19:08:37.027Z","updated_at":"2019-06-10T14:39:00.009Z","due_date":"2019-05-22","start_date":"2019-04-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/28"},"assignees":[{"id":1884221,"username":"patrickbajao","name":"Patrick Bajao","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1884221/avatar.png","web_url":"https://gitlab.com/patrickbajao"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":1884221,"username":"patrickbajao","name":"Patrick Bajao","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1884221/avatar.png","web_url":"https://gitlab.com/patrickbajao"},"user_notes_count":2,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6627","time_stats":{"time_estimate":28800,"total_time_spent":0,"human_time_estimate":"8h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6627","notes":"https://gitlab.com/api/v4/projects/278964/issues/6627/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6627/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6627","relative":"#6627","full":"gitlab-org/gitlab#6627"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12314489,"iid":6624,"project_id":278964,"title":"Extract EE specific files/lines for spec/serializers/issue_serializer_spec.rb","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003espec/serializers/issue_serializer_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/serializers/issue_serializer_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/serializers/issue_serializer_spec.rb\nindex b8255e004d0..437535ba1fb 100644\n--- a/spec/serializers/issue_serializer_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/serializers/issue_serializer_spec.rb\n@@ -9,6 +9,10 @@ describe IssueSerializer do\n       .with_indifferent_access\n   end\n \n+  before do\n+    create(:epic_issue, issue: resource)\n+  end\n+\n   context 'non-sidebar issue serialization' do\n     let(:serializer) { nil }\n```\n\n\u003c/details\u003e","state":"closed","created_at":"2018-06-25T11:59:41.805Z","updated_at":"2022-05-19T17:56:22.423Z","closed_at":"2019-03-18T12:41:53.238Z","closed_by":{"id":128633,"username":"rymai","name":"R√©my Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"},"labels":["Enterprise Edition","Quality","backend","backstage [DEPRECATED]","devops::plan","single codebase","test"],"milestone":{"id":655279,"iid":27,"group_id":9970,"title":"11.10","description":"","state":"closed","created_at":"2018-09-21T19:08:16.261Z","updated_at":"2019-05-21T09:17:49.051Z","due_date":"2019-04-22","start_date":"2019-03-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/27"},"assignees":[{"id":2880930,"username":"engwan","name":"Heinrich Lee Yu","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2880930/avatar.png","web_url":"https://gitlab.com/engwan"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":2880930,"username":"engwan","name":"Heinrich Lee Yu","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2880930/avatar.png","web_url":"https://gitlab.com/engwan"},"user_notes_count":0,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6624","time_stats":{"time_estimate":28800,"total_time_spent":0,"human_time_estimate":"8h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6624","notes":"https://gitlab.com/api/v4/projects/278964/issues/6624/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6624/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6624","relative":"#6624","full":"gitlab-org/gitlab#6624"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12314459,"iid":6623,"project_id":278964,"title":"Extract EE specific files/lines for CI spec/serializers","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003espec/serializers/environment_entity_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/serializers/environment_entity_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/serializers/environment_entity_spec.rb\nindex 791b64dc356..fd628e51317 100644\n--- a/spec/serializers/environment_entity_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/serializers/environment_entity_spec.rb\n@@ -1,14 +1,21 @@\n require 'spec_helper'\n \n describe EnvironmentEntity do\n-  let(:request) { double('request') }\n+  include KubernetesHelpers\n+\n+  let(:user) { create(:user) }\n+  let(:environment) { create(:environment) }\n+\n   let(:entity) do\n-    described_class.new(environment, request: spy('request'))\n+    described_class.new(environment, request: double(current_user: user))\n   end\n \n-  let(:environment) { create(:environment) }\n   subject { entity.as_json }\n \n+  before do\n+    environment.project.add_maintainer(user)\n+  end\n+\n   it 'exposes latest deployment' do\n     expect(subject).to include(:last_deployment)\n   end\n@@ -41,6 +48,29 @@ describe EnvironmentEntity do\n     end\n   end\n \n+  context 'with deployment service ready' do\n+    before do\n+      stub_licensed_features(deploy_board: true)\n+      allow(environment).to receive(:has_terminals?).and_return(true)\n+      allow(environment).to receive(:rollout_status).and_return(kube_deployment_rollout_status)\n+    end\n+\n+    it 'exposes rollout_status' do\n+      expect(subject).to include(:rollout_status)\n+    end\n+  end\n+\n+  context 'when license does not has the GitLab_DeployBoard add-on' do\n+    before do\n+      stub_licensed_features(deploy_board: false)\n+      allow(environment).to receive(:has_terminals?).and_return(true)\n+    end\n+\n+    it 'does not expose rollout_status' do\n+      expect(subject[:rollout_status_path]).to be_blank\n+    end\n+  end\n+\n   context 'with deployment platform' do\n     let(:project) { create(:project, :repository) }\n     let(:environment) { create(:environment, project: project) }\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/serializers/pipeline_details_entity_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/serializers/pipeline_details_entity_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/serializers/pipeline_details_entity_spec.rb\nindex 8e73a3e67c6..ee868c994c7 100644\n--- a/spec/serializers/pipeline_details_entity_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/serializers/pipeline_details_entity_spec.rb\n@@ -136,5 +136,40 @@ describe PipelineDetailsEntity do\n         expect(subject[:flags][:yaml_errors]).to be false\n       end\n     end\n+\n+    context 'when pipeline is triggered by other pipeline' do\n+      let(:pipeline) { create(:ci_empty_pipeline) }\n+\n+      before do\n+        create(:ci_sources_pipeline, pipeline: pipeline)\n+      end\n+\n+      it 'contains an information about depedent pipeline' do\n+        expect(subject[:triggered_by]).to be_a(Hash)\n+        expect(subject[:triggered_by][:path]).not_to be_nil\n+        expect(subject[:triggered_by][:details]).not_to be_nil\n+        expect(subject[:triggered_by][:details][:status]).not_to be_nil\n+        expect(subject[:triggered_by][:project]).not_to be_nil\n+      end\n+    end\n+\n+    context 'when pipeline triggered other pipeline' do\n+      let(:pipeline) { create(:ci_empty_pipeline) }\n+      let(:build) { create(:ci_build, pipeline: pipeline) }\n+\n+      before do\n+        create(:ci_sources_pipeline, source_job: build)\n+        create(:ci_sources_pipeline, source_job: build)\n+      end\n+\n+      it 'contains an information about depedent pipeline' do\n+        expect(subject[:triggered]).to be_a(Array)\n+        expect(subject[:triggered].length).to eq(2)\n+        expect(subject[:triggered].first[:path]).not_to be_nil\n+        expect(subject[:triggered].first[:details]).not_to be_nil\n+        expect(subject[:triggered].first[:details][:status]).not_to be_nil\n+        expect(subject[:triggered].first[:project]).not_to be_nil\n+      end\n+    end\n   end\n end\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/serializers/pipeline_serializer_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/serializers/pipeline_serializer_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/serializers/pipeline_serializer_spec.rb\nindex 2bdcb2a45f6..5550b2bbc9e 100644\n--- a/spec/serializers/pipeline_serializer_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/serializers/pipeline_serializer_spec.rb\n@@ -119,7 +119,7 @@ describe PipelineSerializer do\n         it 'verifies number of queries', :request_store do\n           recorded = ActiveRecord::QueryRecorder.new { subject }\n \n-          expect(recorded.count).to be_within(2).of(31)\n+          expect(recorded.count).to be_within(2).of(38)\n           expect(recorded.cached_count).to eq(0)\n         end\n       end\n@@ -138,7 +138,7 @@ describe PipelineSerializer do\n           # pipeline. With the same ref this check is cached but if refs are\n           # different then there is an extra query per ref\n           # https://gitlab.com/gitlab-org/gitlab-ce/issues/46368\n-          expect(recorded.count).to be_within(2).of(38)\n+          expect(recorded.count).to be_within(2).of(44)\n           expect(recorded.cached_count).to eq(0)\n         end\n       end\n```\n\n\u003c/details\u003e\n","state":"closed","created_at":"2018-06-25T11:57:38.958Z","updated_at":"2019-08-12T15:32:26.977Z","closed_at":"2019-04-10T13:14:52.313Z","closed_by":{"id":3585,"username":"axil","name":"Achilleas Pipinellis","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3585/avatar.png","web_url":"https://gitlab.com/axil"},"labels":["Deliverable","Enterprise Edition","backend","backstage [DEPRECATED]","devops::verify","single codebase","test"],"milestone":{"id":655280,"iid":28,"group_id":9970,"title":"11.11","description":"","state":"closed","created_at":"2018-09-21T19:08:37.027Z","updated_at":"2019-06-10T14:39:00.009Z","due_date":"2019-05-22","start_date":"2019-04-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/28"},"assignees":[{"id":722076,"username":"matteeyah","name":"Matija ƒåupiƒá","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8bc04cc15e0adba406cf56fecd9d910a?s=80\u0026d=identicon","web_url":"https://gitlab.com/matteeyah"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":722076,"username":"matteeyah","name":"Matija ƒåupiƒá","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8bc04cc15e0adba406cf56fecd9d910a?s=80\u0026d=identicon","web_url":"https://gitlab.com/matteeyah"},"user_notes_count":7,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6623","time_stats":{"time_estimate":28800,"total_time_spent":0,"human_time_estimate":"8h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6623","notes":"https://gitlab.com/api/v4/projects/278964/issues/6623/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6623/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6623","relative":"#6623","full":"gitlab-org/gitlab#6623"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12314248,"iid":6620,"project_id":278964,"title":"Extract EE specific files/lines for Create spec/helpers","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003espec/helpers/issuables_helper_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/helpers/issuables_helper_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/helpers/issuables_helper_spec.rb\nindex 8b82dea2524..ec1f61dab37 100644\n--- a/spec/helpers/issuables_helper_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/helpers/issuables_helper_spec.rb\n@@ -176,7 +176,7 @@ describe IssuablesHelper do\n       stub_commonmark_sourcepos_disabled\n     end\n \n-    it 'returns the correct json for an issue' do\n+    it 'returns the correct data for an issue' do\n       issue = create(:issue, author: user, description: 'issue text')\n       @project = issue.project\n \n@@ -185,6 +185,7 @@ describe IssuablesHelper do\n         updateEndpoint: \"/#{@project.full_path}/issues/#{issue.iid}.json\",\n         canUpdate: true,\n         canDestroy: true,\n+        canAdmin: true,\n         issuableRef: \"##{issue.iid}\",\n         markdownPreviewPath: \"/#{@project.full_path}/preview_markdown\",\n         markdownDocsPath: '/help/user/markdown',\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/helpers/merge_requests_helper_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/helpers/merge_requests_helper_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/helpers/merge_requests_helper_spec.rb\nindex 885204062fe..17a5a0a7e9b 100644\n--- a/spec/helpers/merge_requests_helper_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/helpers/merge_requests_helper_spec.rb\n@@ -44,6 +44,20 @@ describe MergeRequestsHelper do\n     end\n   end\n \n+  describe '#render_items_list' do\n+    it \"returns one item in the list\" do\n+      expect(render_items_list([\"user\"])).to eq(\"user\")\n+    end\n+\n+    it \"returns two items in the list\" do\n+      expect(render_items_list(%w(user user1))).to eq(\"user and user1\")\n+    end\n+\n+    it \"returns three items in the list\" do\n+      expect(render_items_list(%w(user user1 user2))).to eq(\"user, user1 and user2\")\n+    end\n+  end\n+\n   describe '#tab_link_for' do\n     let(:merge_request) { create(:merge_request, :simple) }\n     let(:options) { Hash.new }\n```\n\n\u003c/details\u003e\n","state":"closed","created_at":"2018-06-25T11:44:44.588Z","updated_at":"2019-08-12T15:32:27.141Z","closed_at":"2019-04-04T12:23:40.626Z","closed_by":{"id":128633,"username":"rymai","name":"R√©my Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"},"labels":["Create [DEPRECATED]","Deliverable","Enterprise Edition","Quality","[deprecated] Accepting merge requests","backend","single codebase","test"],"milestone":{"id":655279,"iid":27,"group_id":9970,"title":"11.10","description":"","state":"closed","created_at":"2018-09-21T19:08:16.261Z","updated_at":"2019-05-21T09:17:49.051Z","due_date":"2019-04-22","start_date":"2019-03-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/27"},"assignees":[{"id":128633,"username":"rymai","name":"R√©my Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":128633,"username":"rymai","name":"R√©my Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6620","time_stats":{"time_estimate":28800,"total_time_spent":0,"human_time_estimate":"8h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6620","notes":"https://gitlab.com/api/v4/projects/278964/issues/6620/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6620/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6620","relative":"#6620","full":"gitlab-org/gitlab#6620"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12314188,"iid":6618,"project_id":278964,"title":"Extract EE specific files/lines for Create spec/finders","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003espec/finders/merge_requests_finder_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/finders/merge_requests_finder_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/finders/merge_requests_finder_spec.rb\nindex 107da08a0a9..906a729c7ae 100644\n--- a/spec/finders/merge_requests_finder_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/finders/merge_requests_finder_spec.rb\n@@ -68,6 +68,12 @@ describe MergeRequestsFinder do\n       expect(merge_requests.size).to eq(2)\n     end\n \n+    it 'ignores sorting by weight' do\n+      params = { project_id: project1.id, scope: 'authored', state: 'opened', weight: Issue::WEIGHT_ANY }\n+      merge_requests = described_class.new(user, params).execute\n+      expect(merge_requests.size).to eq(2)\n+    end\n+\n     context 'filtering by group' do\n       it 'includes all merge requests when user has access' do\n         params = { group_id: group.id }\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/finders/snippets_finder_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/finders/snippets_finder_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/finders/snippets_finder_spec.rb\nindex 134fb5f2c04..2bafa5d441b 100644\n--- a/spec/finders/snippets_finder_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/finders/snippets_finder_spec.rb\n@@ -171,6 +171,14 @@ describe SnippetsFinder do\n \n       expect(snippets).to include(@snippet1, @snippet2, @snippet3)\n     end\n+\n+    it \"returns all snippets for auditor users\" do\n+      user = create(:user, :auditor)\n+\n+      snippets = described_class.new(user, project: project1).execute\n+\n+      expect(snippets).to include(@snippet1, @snippet2, @snippet3)\n+    end\n   end\n \n   describe '#execute' do\n```\n\n\u003c/details\u003e\n\u003cbr\u003e\n\nThey're all EE only tests or so. (Some we could probably just move to CE)","state":"closed","created_at":"2018-06-25T11:40:57.583Z","updated_at":"2019-08-12T15:32:27.073Z","closed_at":"2019-03-22T18:27:54.015Z","closed_by":{"id":15139,"username":"rspeicher","name":"Robert Speicher","state":"active","avatar_url":"https://secure.gravatar.com/avatar/73c8253932541a7b5cbc5d79493f2bea?s=80\u0026d=identicon","web_url":"https://gitlab.com/rspeicher"},"labels":["Create [DEPRECATED]","Deliverable","Enterprise Edition","Quality","backend","single codebase","test"],"milestone":{"id":655279,"iid":27,"group_id":9970,"title":"11.10","description":"","state":"closed","created_at":"2018-09-21T19:08:16.261Z","updated_at":"2019-05-21T09:17:49.051Z","due_date":"2019-04-22","start_date":"2019-03-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/27"},"assignees":[{"id":128633,"username":"rymai","name":"R√©my Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":128633,"username":"rymai","name":"R√©my Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"},"user_notes_count":0,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6618","time_stats":{"time_estimate":57600,"total_time_spent":0,"human_time_estimate":"16h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6618","notes":"https://gitlab.com/api/v4/projects/278964/issues/6618/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6618/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6618","relative":"#6618","full":"gitlab-org/gitlab#6618"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12314106,"iid":6617,"project_id":278964,"title":"Extract EE specific files/lines for scripts","description":"We have the following files containing EE specific code. We should move them to ee/\n\n## EE only files, maybe just move the file, or add `ee/scripts`\n\n- scripts/ee-files-location-check \n- scripts/ee-specific-lines-check\n- scripts/ee_specific_check/ee_specific_check.rb\n- scripts/prepare_postgres_fdw.sh\n\n## Need to think about it\n\n- scripts/prepare_build.sh\n- scripts/static-analysis\n- scripts/utils.sh\n\nDifferences:\n\n\u003cdetails\u003e\n\u003csummary\u003escripts/lint-rugged\u003c/summary\u003e\n\n```diff\ndiff --git a/scripts/lint-rugged b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/scripts/lint-rugged\nindex e1605b4501b..c8559560ee4 100755\n--- a/scripts/lint-rugged\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/scripts/lint-rugged\n@@ -1,6 +1,9 @@\n #!/usr/bin/env ruby\n \n ALLOWED = [\n+  # https://gitlab.com/gitlab-org/gitaly/issues/760\n+  'lib/elasticsearch/git/repository.rb',\n+\n   # Needed to handle repositories that are not in any storage\n   'lib/gitlab/bare_repository_import/repository.rb',\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003escripts/static-analysis\u003c/summary\u003e\n\n```diff\ndiff --git a/scripts/static-analysis b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/scripts/static-analysis\nindex 642c50ec0a8..92d8983a172 100755\n--- a/scripts/static-analysis\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/scripts/static-analysis\n@@ -26,6 +26,7 @@ def emit_errors(static_analysis)\n end\n \n tasks = [\n+  %w[ruby -rbundler/setup scripts/ee_specific_check/ee_specific_check.rb],\n   %w[bin/rake lint:all],\n   %w[bundle exec license_finder],\n   %w[yarn run eslint],\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003escripts/utils.sh\u003c/summary\u003e\n\n```diff\ndiff --git a/scripts/utils.sh b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/scripts/utils.sh\nindex 4a6567b8a62..6190b813455 100644\n--- a/scripts/utils.sh\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/scripts/utils.sh\n@@ -29,6 +29,135 @@ function setup_db() {\n     if [ \"$GITLAB_DATABASE\" = \"mysql\" ]; then\n         bundle exec rake add_limits_mysql\n     fi\n+\n+    # EE-only\n+    bundle exec rake geo:db:drop geo:db:create geo:db:schema:load geo:db:migrate\n+}\n+\n+function install_api_client_dependencies_with_apk() {\n+  apk add --update openssl curl jq\n+}\n+\n+function install_api_client_dependencies_with_apt() {\n+  apt update \u0026\u0026 apt install jq -y\n+}\n+\n+function install_gitlab_gem() {\n+  gem install gitlab --no-document\n+}\n+\n+function echoerr() {\n+  local header=\"${2}\"\n+\n+  if [ -n \"${header}\" ]; then\n+    printf \"\\n\\033[0;31m** %s **\\n\\033[0m\" \"${1}\" \u003e\u00262;\n+  else\n+    printf \"\\033[0;31m%s\\n\\033[0m\" \"${1}\" \u003e\u00262;\n+  fi\n+}\n+\n+function echoinfo() {\n+  local header=\"${2}\"\n+\n+  if [ -n \"${header}\" ]; then\n+    printf \"\\n\\033[0;33m** %s **\\n\\033[0m\" \"${1}\" \u003e\u00262;\n+  else\n+    printf \"\\033[0;33m%s\\n\\033[0m\" \"${1}\" \u003e\u00262;\n+  fi\n+}\n+\n+function get_job_id() {\n+  local job_name=\"${1}\"\n+  local query_string=\"${2:+\u0026${2}}\"\n+  local api_token=\"${API_TOKEN-${GITLAB_BOT_MULTI_PROJECT_PIPELINE_POLLING_TOKEN}}\"\n+  if [ -z \"${api_token}\" ]; then\n+    echoerr \"Please provide an API token with \\$API_TOKEN or \\$GITLAB_BOT_MULTI_PROJECT_PIPELINE_POLLING_TOKEN.\"\n+    return\n+  fi\n+\n+  local max_page=3\n+  local page=1\n+\n+  while true; do\n+    local url=\"https://gitlab.com/api/v4/projects/${CI_PROJECT_ID}/pipelines/${CI_PIPELINE_ID}/jobs?per_page=100\u0026page=${page}${query_string}\"\n+    echoinfo \"GET ${url}\"\n+\n+    local job_id\n+    job_id=$(curl --silent --show-error --header \"PRIVATE-TOKEN: ${api_token}\" \"${url}\" | jq \"map(select(.name == \\\"${job_name}\\\")) | map(.id) | last\")\n+    [[ \"${job_id}\" == \"null\" \u0026\u0026 \"${page}\" -lt \"$max_page\" ]] || break\n+\n+    let \"page++\"\n+  done\n+\n+  if [[ \"${job_id}\" == \"\" ]]; then\n+    echoerr \"The '${job_name}' job ID couldn't be retrieved!\"\n+  else\n+    echoinfo \"The '${job_name}' job ID is ${job_id}\"\n+    echo \"${job_id}\"\n+  fi\n+}\n+\n+function play_job() {\n+  local job_name=\"${1}\"\n+  local job_id\n+  job_id=$(get_job_id \"${job_name}\" \"scope=manual\");\n+  if [ -z \"${job_id}\" ]; then return; fi\n+\n+  local api_token=\"${API_TOKEN-${GITLAB_BOT_MULTI_PROJECT_PIPELINE_POLLING_TOKEN}}\"\n+  if [ -z \"${api_token}\" ]; then\n+    echoerr \"Please provide an API token with \\$API_TOKEN or \\$GITLAB_BOT_MULTI_PROJECT_PIPELINE_POLLING_TOKEN.\"\n+    return\n+  fi\n+\n+  local url=\"https://gitlab.com/api/v4/projects/${CI_PROJECT_ID}/jobs/${job_id}/play\"\n+  echoinfo \"POST ${url}\"\n+\n+  local job_url\n+  job_url=$(curl --silent --show-error --request POST --header \"PRIVATE-TOKEN: ${api_token}\" \"${url}\" | jq \".web_url\")\n+  echoinfo \"Manual job '${job_name}' started at: ${job_url}\"\n+}\n+\n+function wait_for_job_to_be_done() {\n+  local job_name=\"${1}\"\n+  local query_string=\"${2}\"\n+  local job_id\n+  job_id=$(get_job_id \"${job_name}\" \"${query_string}\")\n+  if [ -z \"${job_id}\" ]; then return; fi\n+\n+  local api_token=\"${API_TOKEN-${GITLAB_BOT_MULTI_PROJECT_PIPELINE_POLLING_TOKEN}}\"\n+  if [ -z \"${api_token}\" ]; then\n+    echoerr \"Please provide an API token with \\$API_TOKEN or \\$GITLAB_BOT_MULTI_PROJECT_PIPELINE_POLLING_TOKEN.\"\n+    return\n+  fi\n+\n+  echoinfo \"Waiting for the '${job_name}' job to finish...\"\n+\n+  local url=\"https://gitlab.com/api/v4/projects/${CI_PROJECT_ID}/jobs/${job_id}\"\n+  echoinfo \"GET ${url}\"\n+\n+  # In case the job hasn't finished yet. Keep trying until the job times out.\n+  local interval=30\n+  local elapsed_seconds=0\n+  while true; do\n+    local job_status\n+    job_status=$(curl --silent --show-error --header \"PRIVATE-TOKEN: ${api_token}\" \"${url}\" | jq \".status\" | sed -e s/\\\"//g)\n+    [[ \"${job_status}\" == \"pending\" || \"${job_status}\" == \"running\" ]] || break\n+\n+    printf \".\"\n+    let \"elapsed_seconds+=interval\"\n+    sleep ${interval}\n+  done\n+\n+  local elapsed_minutes=$((elapsed_seconds / 60))\n+  echoinfo \"Waited '${job_name}' for ${elapsed_minutes} minutes.\"\n+\n+  if [[ \"${job_status}\" == \"failed\" ]]; then\n+    echoerr \"The '${job_name}' failed.\"\n+  elif [[ \"${job_status}\" == \"manual\" ]]; then\n+    echoinfo \"The '${job_name}' is manual.\"\n+  else\n+    echoinfo \"The '${job_name}' passed.\"\n+  fi\n }\n \n function install_api_client_dependencies_with_apk() {\n```\n\n\u003c/details\u003e\n\n\n\n## Just pick EE changes\n\n- scripts/lint-rugged\n- scripts/schema_changed.sh","state":"closed","created_at":"2018-06-25T11:35:15.237Z","updated_at":"2019-12-02T11:56:50.181Z","closed_at":"2019-07-31T12:58:26.632Z","closed_by":{"id":209240,"username":"yorickpeterse","name":"Yorick Peterse","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/209240/avatar.png","web_url":"https://gitlab.com/yorickpeterse"},"labels":["Enterprise Edition","backend","ci-build","missed:11.10","missed:12.0","single codebase","team::Delivery"],"milestone":{"id":693521,"iid":35,"group_id":9970,"title":"12.2","description":"https://about.gitlab.com/releases/2019/08/22/gitlab-12-2-released","state":"closed","created_at":"2018-10-30T16:48:32.567Z","updated_at":"2020-04-27T16:30:20.799Z","due_date":"2019-08-22","start_date":"2019-07-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/35"},"assignees":[{"id":209240,"username":"yorickpeterse","name":"Yorick Peterse","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/209240/avatar.png","web_url":"https://gitlab.com/yorickpeterse"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":209240,"username":"yorickpeterse","name":"Yorick Peterse","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/209240/avatar.png","web_url":"https://gitlab.com/yorickpeterse"},"user_notes_count":3,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6617","time_stats":{"time_estimate":144000,"total_time_spent":0,"human_time_estimate":"40h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6617","notes":"https://gitlab.com/api/v4/projects/278964/issues/6617/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6617/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6617","relative":"#6617","full":"gitlab-org/gitlab#6617"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12313975,"iid":6616,"project_id":278964,"title":"Extract EE specific files/lines for lib/tasks/gitlab","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003elib/tasks/gitlab/backup.rake\u003c/summary\u003e\n\n```diff\ndiff --git a/lib/tasks/gitlab/backup.rake b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/tasks/gitlab/backup.rake\nindex 3a1a36e36ce..3977fc7ad8c 100644\n--- a/lib/tasks/gitlab/backup.rake\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/tasks/gitlab/backup.rake\n@@ -61,7 +61,7 @@ namespace :gitlab do\n       Rake::Task['gitlab:backup:uploads:restore'].invoke unless backup.skipped?('uploads')\n       Rake::Task['gitlab:backup:builds:restore'].invoke unless backup.skipped?('builds')\n       Rake::Task['gitlab:backup:artifacts:restore'].invoke unless backup.skipped?('artifacts')\n-      Rake::Task[\"gitlab:backup:pages:restore\"].invoke unless backup.skipped?('pages')\n+      Rake::Task['gitlab:backup:pages:restore'].invoke unless backup.skipped?('pages')\n       Rake::Task['gitlab:backup:lfs:restore'].invoke unless backup.skipped?('lfs')\n       Rake::Task['gitlab:backup:registry:restore'].invoke unless backup.skipped?('registry')\n       Rake::Task['gitlab:shell:setup'].invoke\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003elib/tasks/gitlab/cleanup.rake\u003c/summary\u003e\n\n```diff\ndiff --git a/lib/tasks/gitlab/cleanup.rake b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/tasks/gitlab/cleanup.rake\nindex 451ba651674..d1cb046d9e4 100644\n--- a/lib/tasks/gitlab/cleanup.rake\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/tasks/gitlab/cleanup.rake\n@@ -36,6 +36,36 @@ namespace :gitlab do\n       end\n     end\n \n+    desc \"GitLab | Cleanup | Delete moved repositories\"\n+    task moved: :gitlab_environment do\n+      warn_user_is_not_gitlab\n+      remove_flag = ENV['REMOVE']\n+\n+      Gitlab.config.repositories.storages.each do |name, repository_storage|\n+        repo_root = repository_storage.legacy_disk_path.chomp('/')\n+        # Look for global repos (legacy, depth 1) and normal repos (depth 2)\n+        IO.popen(%W(find #{repo_root} -mindepth 1 -maxdepth 2 -name *+moved*.git)) do |find|\n+          find.each_line do |path|\n+            path.chomp!\n+\n+            if remove_flag\n+              if FileUtils.rm_rf(path)\n+                puts \"Removed...#{path}\".color(:green)\n+              else\n+                puts \"Cannot remove #{path}\".color(:red)\n+              end\n+            else\n+              puts \"Can be removed: #{path}\".color(:green)\n+            end\n+          end\n+        end\n+      end\n+\n+      unless remove_flag\n+        puts \"To cleanup these repositories run this command with REMOVE=true\".color(:yellow)\n+      end\n+    end\n+\n     desc \"GitLab | Cleanup | Clean repositories\"\n     task repos: :gitlab_environment do\n       move_suffix = \"+orphaned+#{Time.now.to_i}\"\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003elib/tasks/gitlab/info.rake\u003c/summary\u003e\n\n```diff\ndiff --git a/lib/tasks/gitlab/info.rake b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/tasks/gitlab/info.rake\nindex e97d77d20e0..66b8abe3e62 100644\n--- a/lib/tasks/gitlab/info.rake\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/tasks/gitlab/info.rake\n@@ -14,6 +14,8 @@ namespace :gitlab do\n       rake_version = run_and_match(%w(rake --version), /[\\d\\.]+/).try(:to_s)\n       # check redis version\n       redis_version = run_and_match(%w(redis-cli --version), /redis-cli (\\d+\\.\\d+\\.\\d+)/).to_a\n+      # check for system defined proxies\n+      proxies = Gitlab::Proxy.detect_proxy.map {|k, v| \"#{k}: #{v}\"}.join(\"\\n\\t\\t\")\n       # check Git version\n       git_version = run_and_match([Gitlab.config.git.bin_path, '--version'], /git version ([\\d\\.]+)/).to_a\n       # check Go version\n@@ -22,6 +24,7 @@ namespace :gitlab do\n       puts \"\"\n       puts \"System information\".color(:yellow)\n       puts \"System:\\t\\t#{os_name || \"unknown\".color(:red)}\"\n+      puts \"Proxy:\\t\\t#{proxies.present? ? proxies.color(:green) : \"no\"}\"\n       puts \"Current User:\\t#{run_command(%w(whoami))}\"\n       puts \"Using RVM:\\t#{rvm_version.present? ? \"yes\".color(:green) : \"no\"}\"\n       puts \"RVM Version:\\t#{rvm_version}\" if rvm_version.present?\n@@ -35,13 +38,21 @@ namespace :gitlab do\n       puts \"Go Version:\\t#{go_version[1] || \"unknown\".color(:red)}\"\n \n       # check database adapter\n-      database_adapter = ActiveRecord::Base.connection.adapter_name.downcase\n+      database_adapter = Gitlab::Database.adapter_name\n+      database_version = Gitlab::Database.version\n \n       project = Group.new(path: \"some-group\").projects.build(path: \"some-project\")\n       # construct clone URLs\n       http_clone_url = project.http_url_to_repo\n       ssh_clone_url  = project.ssh_url_to_repo\n \n+      geo_node_type =\n+        if Gitlab::Geo.current_node\n+          Gitlab::Geo.current_node.primary ? 'Primary' : 'Secondary'\n+        else\n+          'Undefined'.color(:red)\n+        end\n+\n       omniauth_providers = Gitlab.config.omniauth.providers.map { |provider| provider['name'] }\n \n       puts \"\"\n@@ -50,9 +61,13 @@ namespace :gitlab do\n       puts \"Revision:\\t#{Gitlab.revision}\"\n       puts \"Directory:\\t#{Rails.root}\"\n       puts \"DB Adapter:\\t#{database_adapter}\"\n+      puts \"DB Version:\\t#{database_version}\"\n       puts \"URL:\\t\\t#{Gitlab.config.gitlab.url}\"\n       puts \"HTTP Clone URL:\\t#{http_clone_url}\"\n       puts \"SSH Clone URL:\\t#{ssh_clone_url}\"\n+      puts \"Elasticsearch:\\t#{Gitlab::CurrentSettings.current_application_settings.elasticsearch_indexing? ? \"yes\".color(:green) : \"no\"}\"\n+      puts \"Geo:\\t\\t#{Gitlab::Geo.enabled? ? \"yes\".color(:green) : \"no\"}\"\n+      puts \"Geo node:\\t#{geo_node_type}\" if Gitlab::Geo.enabled?\n       puts \"Using LDAP:\\t#{Gitlab.config.ldap.enabled ? \"yes\".color(:green) : \"no\"}\"\n       puts \"Using Omniauth:\\t#{Gitlab::Auth.omniauth_enabled? ? \"yes\".color(:green) : \"no\"}\"\n       puts \"Omniauth Providers: #{omniauth_providers.join(', ')}\" if Gitlab::Auth.omniauth_enabled?\n```\n\n\u003c/details\u003e\n","state":"closed","created_at":"2018-06-25T11:25:26.695Z","updated_at":"2019-12-02T11:56:49.777Z","closed_at":"2019-07-22T13:10:45.291Z","closed_by":{"id":209240,"username":"yorickpeterse","name":"Yorick Peterse","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/209240/avatar.png","web_url":"https://gitlab.com/yorickpeterse"},"labels":["Enterprise Edition","Quality","[deprecated] Accepting merge requests","backend","backstage [DEPRECATED]","missed:11.10","missed:12.0","rake tasks","single codebase","team::Delivery"],"milestone":{"id":693520,"iid":34,"group_id":9970,"title":"12.1","description":"https://about.gitlab.com/releases/2019/07/22/gitlab-12-1-released","state":"closed","created_at":"2018-10-30T16:47:58.826Z","updated_at":"2020-04-27T16:30:09.107Z","due_date":"2019-07-22","start_date":"2019-06-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/34"},"assignees":[],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":null,"user_notes_count":3,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6616","time_stats":{"time_estimate":57600,"total_time_spent":0,"human_time_estimate":"16h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6616","notes":"https://gitlab.com/api/v4/projects/278964/issues/6616/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6616/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6616","relative":"#6616","full":"gitlab-org/gitlab#6616"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12313575,"iid":6614,"project_id":278964,"title":"Extract EE specific files/lines for spec/policies","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003espec/policies/group_policy_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/policies/group_policy_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/policies/group_policy_spec.rb\nindex be1804c5ce0..6035cbe3f2a 100644\n--- a/spec/policies/group_policy_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/policies/group_policy_spec.rb\n@@ -6,6 +6,7 @@ describe GroupPolicy do\n   let(:developer) { create(:user) }\n   let(:maintainer) { create(:user) }\n   let(:owner) { create(:user) }\n+  let(:auditor) { create(:user, :auditor) }\n   let(:admin) { create(:admin) }\n   let(:group) { create(:group, :private) }\n \n@@ -292,6 +293,107 @@ describe GroupPolicy do\n         expect_allowed(*owner_permissions)\n       end\n     end\n+\n+    context 'auditor' do\n+      let(:current_user) { auditor }\n+\n+      it do\n+        expect_allowed(:read_group)\n+        expect_disallowed(:upload_file)\n+        is_expected.to be_disallowed(*maintainer_permissions)\n+        is_expected.to be_disallowed(*owner_permissions)\n+      end\n+    end\n+  end\n+\n+  describe 'change_share_with_group_lock' do\n+    context 'when the current_user owns the group' do\n+      let(:current_user) { owner }\n+\n+      context 'when the group share_with_group_lock is enabled' do\n+        let(:group) { create(:group, share_with_group_lock: true, parent: parent) }\n+\n+        context 'when the parent group share_with_group_lock is enabled' do\n+          context 'when the group has a grandparent' do\n+            let(:parent) { create(:group, share_with_group_lock: true, parent: grandparent) }\n+\n+            context 'when the grandparent share_with_group_lock is enabled' do\n+              let(:grandparent) { create(:group, share_with_group_lock: true) }\n+\n+              context 'when the current_user owns the parent' do\n+                before do\n+                  parent.add_owner(current_user)\n+                end\n+\n+                context 'when the current_user owns the grandparent' do\n+                  before do\n+                    grandparent.add_owner(current_user)\n+                  end\n+\n+                  it { expect_allowed(:change_share_with_group_lock) }\n+                end\n+\n+                context 'when the current_user does not own the grandparent' do\n+                  it { expect_disallowed(:change_share_with_group_lock) }\n+                end\n+              end\n+\n+              context 'when the current_user does not own the parent' do\n+                it { expect_disallowed(:change_share_with_group_lock) }\n+              end\n+            end\n+\n+            context 'when the grandparent share_with_group_lock is disabled' do\n+              let(:grandparent) { create(:group) }\n+\n+              context 'when the current_user owns the parent' do\n+                before do\n+                  parent.add_owner(current_user)\n+                end\n+\n+                it { expect_allowed(:change_share_with_group_lock) }\n+              end\n+\n+              context 'when the current_user does not own the parent' do\n+                it { expect_disallowed(:change_share_with_group_lock) }\n+              end\n+            end\n+          end\n+\n+          context 'when the group does not have a grandparent' do\n+            let(:parent) { create(:group, share_with_group_lock: true) }\n+\n+            context 'when the current_user owns the parent' do\n+              before do\n+                parent.add_owner(current_user)\n+              end\n+\n+              it { expect_allowed(:change_share_with_group_lock) }\n+            end\n+\n+            context 'when the current_user does not own the parent' do\n+              it { expect_disallowed(:change_share_with_group_lock) }\n+            end\n+          end\n+        end\n+\n+        context 'when the parent group share_with_group_lock is disabled' do\n+          let(:parent) { create(:group) }\n+\n+          it { expect_allowed(:change_share_with_group_lock) }\n+        end\n+      end\n+\n+      context 'when the group share_with_group_lock is disabled' do\n+        it { expect_allowed(:change_share_with_group_lock) }\n+      end\n+    end\n+\n+    context 'when the current_user does not own the group' do\n+      let(:current_user) { create(:user) }\n+\n+      it { expect_disallowed(:change_share_with_group_lock) }\n+    end\n   end\n \n   describe 'change_share_with_group_lock' do\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/policies/namespace_policy_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/policies/namespace_policy_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/policies/namespace_policy_spec.rb\nindex 1fdf95ad716..a7aaeed9ac8 100644\n--- a/spec/policies/namespace_policy_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/policies/namespace_policy_spec.rb\n@@ -3,6 +3,7 @@ require 'spec_helper'\n describe NamespacePolicy do\n   let(:user) { create(:user) }\n   let(:owner) { create(:user) }\n+  let(:auditor) { create(:user, :auditor) }\n   let(:admin) { create(:admin) }\n   let(:namespace) { create(:namespace, owner: owner) }\n \n@@ -30,7 +31,21 @@ describe NamespacePolicy do\n     context 'user who has exceeded project limit' do\n       let(:owner) { create(:user, projects_limit: 0) }\n \n-      it { is_expected.not_to be_allowed(:create_projects) }\n+      it { is_expected.to be_disallowed(:create_projects) }\n+    end\n+  end\n+\n+  context 'auditor' do\n+    let(:current_user) { auditor }\n+\n+    context 'owner' do\n+      let(:namespace) { create(:namespace, owner: auditor) }\n+\n+      it { is_expected.to be_allowed(*owner_permissions) }\n+    end\n+\n+    context 'non-owner' do\n+      it { is_expected.to be_disallowed(*owner_permissions) }\n     end\n   end\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/policies/project_policy_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/policies/project_policy_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/policies/project_policy_spec.rb\nindex 93a468f585b..b44bf520afb 100644\n--- a/spec/policies/project_policy_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/policies/project_policy_spec.rb\n@@ -237,7 +237,7 @@ describe ProjectPolicy do\n     let(:feature_write_abilities) do\n       described_class::READONLY_FEATURES_WHEN_ARCHIVED.flat_map do |feature|\n         described_class.create_update_admin_destroy(feature)\n-      end\n+      end + additional_reporter_permissions + additional_maintainer_permissions\n     end\n \n     let(:other_write_abilities) do\n@@ -383,7 +383,6 @@ describe ProjectPolicy do\n   shared_examples 'project policies as developer' do\n     context 'abilities for non-public projects' do\n       let(:project) { create(:project, namespace: owner.namespace) }\n-\n       subject { described_class.new(developer, project) }\n \n       it do\n@@ -472,6 +471,61 @@ describe ProjectPolicy do\n   it_behaves_like 'project policies as owner'\n   it_behaves_like 'project policies as admin'\n \n+  context 'EE' do\n+    let(:additional_guest_permissions) { [:read_issue_link] }\n+    let(:additional_reporter_permissions) { [:admin_issue_link]}\n+    let(:additional_maintainer_permissions) { [:push_code_to_protected_branches] }\n+    let(:auditor_permissions) do\n+      %i[\n+        download_code download_wiki_code read_project read_board read_list\n+        read_project_for_iids read_issue_iid read_merge_request_iid read_wiki\n+        read_issue read_label read_issue_link read_milestone read_release\n+        read_project_snippet read_project_member read_note read_cycle_analytics\n+        read_pipeline read_build read_commit_status read_container_image\n+        read_environment read_deployment read_merge_request read_pages\n+        create_merge_request_in award_emoji\n+      ]\n+    end\n+\n+    it_behaves_like 'project policies as anonymous'\n+    it_behaves_like 'project policies as guest'\n+    it_behaves_like 'project policies as reporter'\n+    it_behaves_like 'project policies as developer'\n+    it_behaves_like 'project policies as maintainer'\n+    it_behaves_like 'project policies as owner'\n+    it_behaves_like 'project policies as admin'\n+\n+    context 'auditor' do\n+      let(:auditor) { create(:user, :auditor) }\n+\n+      subject { described_class.new(auditor, project) }\n+\n+      context 'who is not a team member' do\n+        it do\n+          is_expected.to be_disallowed(*developer_permissions)\n+          is_expected.to be_disallowed(*maintainer_permissions)\n+          is_expected.to be_disallowed(*owner_permissions)\n+          is_expected.to be_disallowed(*(guest_permissions - auditor_permissions))\n+          is_expected.to be_allowed(*auditor_permissions)\n+        end\n+      end\n+\n+      context 'who is a team member' do\n+        before do\n+          project.add_guest(auditor)\n+        end\n+\n+        it do\n+          is_expected.to be_disallowed(*developer_permissions)\n+          is_expected.to be_disallowed(*maintainer_permissions)\n+          is_expected.to be_disallowed(*owner_permissions)\n+          is_expected.to be_allowed(*(guest_permissions - auditor_permissions))\n+          is_expected.to be_allowed(*auditor_permissions)\n+        end\n+      end\n+    end\n+  end\n+\n   context 'when a public project has merge requests allowing access' do\n     include ProjectForksHelper\n     let(:user) { create(:user) }\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/policies/project_snippet_policy_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/policies/project_snippet_policy_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/policies/project_snippet_policy_spec.rb\nindex d6329e84579..05dba1413f2 100644\n--- a/spec/policies/project_snippet_policy_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/policies/project_snippet_policy_spec.rb\n@@ -96,6 +96,16 @@ describe ProjectSnippetPolicy do\n         expect_disallowed(*author_permissions)\n       end\n     end\n+\n+    context 'external user' do\n+      let(:current_user) { create(:user, :external) }\n+      subject { abilities(current_user, :private) }\n+\n+      it do\n+        is_expected.to be_disallowed(:read_project_snippet)\n+        is_expected.to be_disallowed(*author_permissions)\n+      end\n+    end\n   end\n \n   context 'private snippet' do\n@@ -154,6 +164,16 @@ describe ProjectSnippetPolicy do\n       end\n     end\n \n+    context 'auditor user' do\n+      let(:current_user) { create(:user, :auditor) }\n+      subject { abilities(current_user, :private) }\n+\n+      it do\n+        is_expected.to be_allowed(:read_project_snippet)\n+        is_expected.to be_disallowed(*author_permissions)\n+      end\n+    end\n+\n     context 'admin user' do\n       subject { abilities(create(:admin), :private) }\n```\n\n\u003c/details\u003e\n","state":"closed","created_at":"2018-06-25T11:09:01.692Z","updated_at":"2019-08-12T15:32:27.587Z","closed_at":"2019-04-04T12:21:11.533Z","closed_by":{"id":128633,"username":"rymai","name":"R√©my Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"},"labels":["Enterprise Edition","Manage [DEPRECATED]","Quality","[deprecated] Accepting merge requests","backend","backstage [DEPRECATED]","permissions","single codebase","test"],"milestone":{"id":655279,"iid":27,"group_id":9970,"title":"11.10","description":"","state":"closed","created_at":"2018-09-21T19:08:16.261Z","updated_at":"2019-05-21T09:17:49.051Z","due_date":"2019-04-22","start_date":"2019-03-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/27"},"assignees":[{"id":128633,"username":"rymai","name":"R√©my Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":128633,"username":"rymai","name":"R√©my Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6614","time_stats":{"time_estimate":28800,"total_time_spent":0,"human_time_estimate":"8h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6614","notes":"https://gitlab.com/api/v4/projects/278964/issues/6614/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6614/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6614","relative":"#6614","full":"gitlab-org/gitlab#6614"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12313482,"iid":6613,"project_id":278964,"title":"Extract EE specific files/lines for spec/models/ci","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003espec/models/ci/build_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/models/ci/build_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/models/ci/build_spec.rb\nindex 81ff727b458..3e46ddf0589 100644\n--- a/spec/models/ci/build_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/models/ci/build_spec.rb\n@@ -17,6 +17,7 @@ describe Ci::Build do\n   it { is_expected.to belong_to(:runner) }\n   it { is_expected.to belong_to(:trigger_request) }\n   it { is_expected.to belong_to(:erased_by) }\n+  it { is_expected.to have_many(:sourced_pipelines) }\n   it { is_expected.to have_many(:trace_sections)}\n   it { is_expected.to have_one(:deployment) }\n   it { is_expected.to have_one(:runner_session)}\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/models/ci/pipeline_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/models/ci/pipeline_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/models/ci/pipeline_spec.rb\nindex b9567ab4d65..e2688ce0ac9 100644\n--- a/spec/models/ci/pipeline_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/models/ci/pipeline_spec.rb\n@@ -22,6 +22,10 @@ describe Ci::Pipeline, :mailer do\n   it { is_expected.to have_many(:builds) }\n   it { is_expected.to have_many(:auto_canceled_pipelines) }\n   it { is_expected.to have_many(:auto_canceled_jobs) }\n+  it { is_expected.to have_one(:source_pipeline) }\n+  it { is_expected.to have_many(:sourced_pipelines) }\n+  it { is_expected.to have_one(:triggered_by_pipeline) }\n+  it { is_expected.to have_many(:triggered_pipelines) }\n   it { is_expected.to have_one(:chat_data) }\n \n   it { is_expected.to validate_presence_of(:sha) }\n@@ -481,7 +485,8 @@ describe Ci::Pipeline, :mailer do\n \n   describe 'pipeline stages' do\n     describe '#stage_seeds' do\n-      let(:pipeline) { build(:ci_pipeline, config: config) }\n+      let(:project) { create(:project, :repository) }\n+      let(:pipeline) { build(:ci_pipeline, project: project, config: config) }\n       let(:config) { { rspec: { script: 'rake' } } }\n \n       it 'returns preseeded stage seeds object' do\n@@ -511,7 +516,7 @@ describe Ci::Pipeline, :mailer do\n \n       context 'when refs policy is specified' do\n         let(:pipeline) do\n-          build(:ci_pipeline, ref: 'feature', tag: true, config: config)\n+          build(:ci_pipeline, ref: 'feature', tag: true, project: project, config: config)\n         end\n \n         let(:config) do\n@@ -529,7 +534,9 @@ describe Ci::Pipeline, :mailer do\n       end\n \n       context 'when source policy is specified' do\n-        let(:pipeline) { build(:ci_pipeline, source: :schedule, config: config) }\n+        let(:pipeline) do\n+          build(:ci_pipeline, source: :schedule, project: project, config: config)\n+        end\n \n         let(:config) do\n           { production: { stage: 'deploy', script: 'cap prod', only: ['triggers'] },\n@@ -569,7 +576,7 @@ describe Ci::Pipeline, :mailer do\n           end\n \n           context 'when user configured kubernetes from Integration \u003e Kubernetes' do\n-            let(:project) { create(:kubernetes_project) }\n+            let(:project) { create(:kubernetes_project, :repository) }\n             let(:pipeline) { build(:ci_pipeline, project: project, config: config) }\n \n             it_behaves_like 'same behavior between KubernetesService and Platform::Kubernetes'\n@@ -611,13 +618,15 @@ describe Ci::Pipeline, :mailer do\n \n     describe '#seeds_size' do\n       context 'when refs policy is specified' do\n+        let(:project) { create(:project, :repository) }\n+\n         let(:config) do\n           { production: { stage: 'deploy', script: 'cap prod', only: ['master'] },\n             spinach: { stage: 'test', script: 'spinach', only: ['tags'] } }\n         end\n \n         let(:pipeline) do\n-          build(:ci_pipeline, ref: 'feature', tag: true, config: config)\n+          build(:ci_pipeline, ref: 'feature', tag: true, project: project, config: config)\n         end\n \n         it 'returns real seeds size' do\n@@ -1547,6 +1556,23 @@ describe Ci::Pipeline, :mailer do\n       end\n     end\n \n+    context 'the source is the repository' do\n+      let(:implied_yml) { Gitlab::Template::GitlabCiYmlTemplate.find('Auto-DevOps').content }\n+\n+      before do\n+        pipeline.repository_source!\n+      end\n+\n+      it 'returns the configuration if found' do\n+        allow(pipeline.project.repository).to receive(:gitlab_ci_yml_for)\n+          .and_return('config')\n+\n+        expect(pipeline.ci_yaml_file).to be_a(String)\n+        expect(pipeline.ci_yaml_file).not_to eq(implied_yml)\n+        expect(pipeline.yaml_errors).to be_nil\n+      end\n+    end\n+\n     context 'when pipeline is for auto-devops' do\n       before do\n         pipeline.config_source = 'auto_devops_source'\n@@ -2212,8 +2238,9 @@ describe Ci::Pipeline, :mailer do\n     end\n \n     context 'when pipeline does not have errors' do\n+      let(:project) { create(:project, :repository) }\n       let(:pipeline) do\n-        create(:ci_pipeline, config: { rspec: { script: 'rake test' } })\n+        create(:ci_pipeline, project: project, config: { rspec: { script: 'rake test' } })\n       end\n \n       it 'does not contain yaml errors' do\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/models/ci/variable_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/models/ci/variable_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/models/ci/variable_spec.rb\nindex 02c07a2bd83..e9e55fe9f6e 100644\n--- a/spec/models/ci/variable_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/models/ci/variable_spec.rb\n@@ -4,6 +4,12 @@ describe Ci::Variable do\n   subject { build(:ci_variable) }\n \n   describe 'validations' do\n+    # EE\n+    before do\n+      stub_licensed_features(variable_environment_scope: true)\n+    end\n+\n+    it { is_expected.to include_module(HasEnvironmentScope) }\n     it { is_expected.to include_module(HasVariable) }\n     it { is_expected.to include_module(Presentable) }\n     it { is_expected.to include_module(Maskable) }\n```\n\n\u003c/details\u003e\n","state":"closed","created_at":"2018-06-25T11:04:10.630Z","updated_at":"2019-08-12T15:32:27.759Z","closed_at":"2019-04-04T12:21:31.552Z","closed_by":{"id":128633,"username":"rymai","name":"R√©my Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"},"labels":["Enterprise Edition","[deprecated] Accepting merge requests","backend","backstage [DEPRECATED]","devops::verify","single codebase","test"],"milestone":{"id":655279,"iid":27,"group_id":9970,"title":"11.10","description":"","state":"closed","created_at":"2018-09-21T19:08:16.261Z","updated_at":"2019-05-21T09:17:49.051Z","due_date":"2019-04-22","start_date":"2019-03-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/27"},"assignees":[{"id":128633,"username":"rymai","name":"R√©my Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":128633,"username":"rymai","name":"R√©my Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6613","time_stats":{"time_estimate":28800,"total_time_spent":0,"human_time_estimate":"8h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6613","notes":"https://gitlab.com/api/v4/projects/278964/issues/6613/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6613/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6613","relative":"#6613","full":"gitlab-org/gitlab#6613"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12313451,"iid":6612,"project_id":278964,"title":"Extract EE specific files/lines for spec/lib/gitlab/import_export","description":"We have the following files containing EE specific code. We should move them to ee/\r\n\u003cdetails\u003e\r\n\u003csummary\u003espec/lib/gitlab/import_export/all_models.yml\u003c/summary\u003e\r\n\r\n```diff\r\ndiff --git a/spec/lib/gitlab/import_export/all_models.yml b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/lib/gitlab/import_export/all_models.yml\r\nindex 7baa52ffb4f..929b6222900 100644\r\n--- a/spec/lib/gitlab/import_export/all_models.yml\r\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/lib/gitlab/import_export/all_models.yml\r\n@@ -343,7 +343,6 @@ project:\r\n - fork_network_member\r\n - fork_network\r\n - custom_attributes\r\n-- prometheus_metrics\r\n - lfs_file_locks\r\n - project_badges\r\n - source_of_merge_requests\r\n```\r\n\r\n\u003c/details\u003e\r\n\u003cdetails\u003e\r\n\u003csummary\u003espec/lib/gitlab/import_export/project.json\u003c/summary\u003e\r\n\r\n```diff\r\ndiff --git a/spec/lib/gitlab/import_export/project.json b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/lib/gitlab/import_export/project.json\r\nindex c0b97486eeb..9e54ca28e58 100644\r\n--- a/spec/lib/gitlab/import_export/project.json\r\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/lib/gitlab/import_export/project.json\r\n@@ -2775,7 +2775,8 @@\r\n           \"action\": 1,\r\n           \"author_id\": 1\r\n         }\r\n-      ]\r\n+      ],\r\n+      \"approvals_before_merge\": 1\r\n     },\r\n     {\r\n       \"id\": 26,\r\n```\r\n\r\n\u003c/details\u003e\r\n\u003cdetails\u003e\r\n\u003csummary\u003espec/lib/gitlab/import_export/project_tree_saver_spec.rb\u003c/summary\u003e\r\n\r\n```diff\r\ndiff --git a/spec/lib/gitlab/import_export/project_tree_saver_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/lib/gitlab/import_export/project_tree_saver_spec.rb\r\nindex bc4f867e891..5f56c30c7e0 100644\r\n--- a/spec/lib/gitlab/import_export/project_tree_saver_spec.rb\r\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/lib/gitlab/import_export/project_tree_saver_spec.rb\r\n@@ -42,6 +42,10 @@ describe Gitlab::ImportExport::ProjectTreeSaver do\r\n         expect(saved_project_json).to include({ 'description' =\u003e 'description', 'visibility_level' =\u003e 20 })\r\n       end\r\n \r\n+      it 'has approvals_before_merge set' do\r\n+        expect(saved_project_json['approvals_before_merge']).to eq(1)\r\n+      end\r\n+\r\n       it 'has milestones' do\r\n         expect(saved_project_json['milestones']).not_to be_empty\r\n       end\r\n@@ -287,7 +291,8 @@ describe Gitlab::ImportExport::ProjectTreeSaver do\r\n                      issues: [issue],\r\n                      snippets: [snippet],\r\n                      releases: [release],\r\n-                     group: group\r\n+                     group: group,\r\n+                     approvals_before_merge: 1\r\n                     )\r\n     project_label = create(:label, project: project)\r\n     group_label = create(:group_label, group: group)\r\n```\r\n\r\n\u003c/details\u003e\r\n\u003cdetails\u003e\r\n\u003csummary\u003espec/lib/gitlab/import_export/relation_rename_service_spec.rb\u003c/summary\u003e\r\n\r\n```diff\r\ndiff --git a/spec/lib/gitlab/import_export/relation_rename_service_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/lib/gitlab/import_export/relation_rename_service_spec.rb\r\nindex a20a844a492..15748407f0c 100644\r\n--- a/spec/lib/gitlab/import_export/relation_rename_service_spec.rb\r\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/lib/gitlab/import_export/relation_rename_service_spec.rb\r\n@@ -28,6 +28,7 @@ describe Gitlab::ImportExport::RelationRenameService do\r\n \r\n     before do\r\n       allow(shared).to receive(:export_path).and_return(import_path)\r\n+      allow(ActiveSupport::JSON).to receive(:decode).and_call_original\r\n       allow(ActiveSupport::JSON).to receive(:decode).with(file_content).and_return(json_file)\r\n     end\r\n```\r\n\r\n\u003c/details\u003e\r\n\r\n\u003cbr\u003e\r\n\r\nWe need to think about how to move YAML and JSON files. Maybe we could somehow use another YAML in EE and use `Gitlab::Utils::MergeHash` to merge them?","state":"closed","created_at":"2018-06-25T11:02:23.619Z","updated_at":"2019-08-12T15:32:27.796Z","closed_at":"2019-07-23T12:02:38.945Z","closed_by":{"id":209240,"username":"yorickpeterse","name":"Yorick Peterse","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/209240/avatar.png","web_url":"https://gitlab.com/yorickpeterse"},"labels":["DEPRECATED_import","Deliverable","Enterprise Edition","Manage [DEPRECATED]","Quality","backend","group::import","priority::1","single codebase","test"],"milestone":{"id":693521,"iid":35,"group_id":9970,"title":"12.2","description":"https://about.gitlab.com/releases/2019/08/22/gitlab-12-2-released","state":"closed","created_at":"2018-10-30T16:48:32.567Z","updated_at":"2020-04-27T16:30:20.799Z","due_date":"2019-08-22","start_date":"2019-07-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/35"},"assignees":[{"id":209240,"username":"yorickpeterse","name":"Yorick Peterse","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/209240/avatar.png","web_url":"https://gitlab.com/yorickpeterse"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":209240,"username":"yorickpeterse","name":"Yorick Peterse","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/209240/avatar.png","web_url":"https://gitlab.com/yorickpeterse"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6612","time_stats":{"time_estimate":144000,"total_time_spent":0,"human_time_estimate":"40h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6612","notes":"https://gitlab.com/api/v4/projects/278964/issues/6612/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6612/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6612","relative":"#6612","full":"gitlab-org/gitlab#6612"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12312691,"iid":6610,"project_id":278964,"title":"Extract EE specific files/lines for lib/api/helpers/projects_helpers.rb","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003elib/api/helpers/projects_helpers.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/lib/api/helpers/projects_helpers.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/api/helpers/projects_helpers.rb\nindex e6a72b949f9..9fdaf6068e3 100644\n--- a/lib/api/helpers/projects_helpers.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/api/helpers/projects_helpers.rb\n@@ -31,8 +31,17 @@ module API\n             optional :initialize_with_readme, type: Boolean, desc: \"Initialize a project with a README.md\"\n           end\n \n+          params :optional_project_params_ee do\n+            optional :repository_storage, type: String, desc: 'Which storage shard the repository is on. Available only to admins'\n+            optional :approvals_before_merge, type: Integer, desc: 'How many approvers should approve merge request by default'\n+            optional :external_authorization_classification_label, type: String, desc: 'The classification label for the project'\n+            optional :mirror, type: Boolean, desc: 'Enables pull mirroring in a project'\n+            optional :mirror_trigger_builds, type: Boolean, desc: 'Pull mirroring triggers builds'\n+          end\n+\n           params :optional_project_params do\n             use :optional_project_params_ce\n+            use :optional_project_params_ee\n           end\n         end\n       end\n```\n\n\u003c/details\u003e\n","state":"closed","created_at":"2018-06-25T10:25:40.287Z","updated_at":"2019-08-12T15:32:27.993Z","closed_at":"2019-03-27T11:16:52.053Z","closed_by":{"id":209240,"username":"yorickpeterse","name":"Yorick Peterse","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/209240/avatar.png","web_url":"https://gitlab.com/yorickpeterse"},"labels":["Enterprise Edition","Manage [DEPRECATED]","Quality","[deprecated] Accepting merge requests","api","backend","single codebase"],"milestone":{"id":655280,"iid":28,"group_id":9970,"title":"11.11","description":"","state":"closed","created_at":"2018-09-21T19:08:37.027Z","updated_at":"2019-06-10T14:39:00.009Z","due_date":"2019-05-22","start_date":"2019-04-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/28"},"assignees":[],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":null,"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6610","time_stats":{"time_estimate":57600,"total_time_spent":0,"human_time_estimate":"16h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6610","notes":"https://gitlab.com/api/v4/projects/278964/issues/6610/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6610/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6610","relative":"#6610","full":"gitlab-org/gitlab#6610"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12260085,"iid":6589,"project_id":278964,"title":"Show the full list of licenses in the MR widget if no report is available in the target branch","description":"### Problem to solve\n\nIf you have license management in your merge request, but you don't have any report on `master`, the MR widget doesn't show any entry. We should be able to provide some feedback in this case too.\n\n### Further details\n\nUsers can benefit from license management even if there is no report available on the target branch.\n\n### Proposal\n\nIf there is no report for the target branch (`master`), show the full list of licenses shown in the report.\n\nThe summary text should change to reflect that this is only for the source branch, and not a comparison anymore.\n\n- `License management detected no licenses for the source branch only`\n- `License management detected 1 license for the source branch only`\n- `License management detected [X] licenses for the source branch only`\n\n### What does success look like, and how can we measure that?\n\nIf there is no report in `master`, users can see a list of all the licenses at the MR level.","state":"closed","created_at":"2018-06-22T17:51:16.613Z","updated_at":"2019-11-18T15:59:09.311Z","closed_at":"2018-08-03T12:50:29.039Z","closed_by":{"id":482476,"username":"filipa","name":"Filipa Lacerda","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/482476/avatar.png","web_url":"https://gitlab.com/filipa"},"labels":["Category:License Compliance","Deliverable","Enterprise Edition","GitLab Ultimate","devops::secure","frontend","type::feature","workflow::in review"],"milestone":{"id":494367,"iid":15,"group_id":9970,"title":"11.2","description":"","state":"closed","created_at":"2018-03-27T19:26:05.990Z","updated_at":"2018-11-06T19:16:51.951Z","due_date":"2018-08-22","start_date":"2018-07-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/15"},"assignees":[{"id":1125848,"username":"samdbeckham","name":"Sam Beckham","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1125848/avatar.png","web_url":"https://gitlab.com/samdbeckham"},{"id":2003748,"username":"jeethukarthik","name":"Jeethu Karthik","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2003748/avatar.png","web_url":"https://gitlab.com/jeethukarthik"}],"author":{"id":1273957,"username":"bikebilly","name":"Fabio Busatto","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1273957/avatar.png","web_url":"https://gitlab.com/bikebilly"},"type":"ISSUE","assignee":{"id":1125848,"username":"samdbeckham","name":"Sam Beckham","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1125848/avatar.png","web_url":"https://gitlab.com/samdbeckham"},"user_notes_count":20,"merge_requests_count":2,"upvotes":3,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6589","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6589","notes":"https://gitlab.com/api/v4/projects/278964/issues/6589/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6589/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6589","relative":"#6589","full":"gitlab-org/gitlab#6589"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":144,"epic":{"id":257,"iid":144,"title":"License Management MVC","url":"/groups/gitlab-org/-/epics/144","group_id":9970,"human_readable_end_date":"Aug 22, 2018","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12252759,"iid":6584,"project_id":278964,"title":"Extract EE specific files/lines for spec/support/matchers","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003espec/support/matchers/access_matchers.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/support/matchers/access_matchers.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/support/matchers/access_matchers.rb\nindex 3e4ca8b7ab0..e7a3db94441 100644\n--- a/spec/support/matchers/access_matchers.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/support/matchers/access_matchers.rb\n@@ -15,6 +15,8 @@ module AccessMatchers\n       logout\n     when :admin\n       login_as(create(:admin))\n+    when :auditor\n+      login_as(create(:user, :auditor))\n     when :external\n       login_as(create(:user, external: true))\n     when User\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/support/matchers/markdown_matchers.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/support/matchers/markdown_matchers.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/support/matchers/markdown_matchers.rb\nindex ec4ec6f4038..d1ebcec1802 100644\n--- a/spec/support/matchers/markdown_matchers.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/support/matchers/markdown_matchers.rb\n@@ -159,6 +159,15 @@ module MarkdownMatchers\n     end\n   end\n \n+  # EpicReferenceFilter\n+  matcher :reference_epics do\n+    set_default_markdown_messages\n+\n+    match do |actual|\n+      expect(actual).to have_selector('a.gfm.gfm-epic', count: 5)\n+    end\n+  end\n+\n   # TaskListFilter\n   matcher :parse_task_lists do\n     set_default_markdown_messages\n```\n\n\u003c/details\u003e\n","state":"closed","created_at":"2018-06-22T15:44:19.496Z","updated_at":"2019-08-12T15:32:53.195Z","closed_at":"2019-04-04T12:23:24.238Z","closed_by":{"id":128633,"username":"rymai","name":"R√©my Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"},"labels":["Enterprise Edition","Quality","[deprecated] Accepting merge requests","backend","single codebase","test"],"milestone":{"id":655279,"iid":27,"group_id":9970,"title":"11.10","description":"","state":"closed","created_at":"2018-09-21T19:08:16.261Z","updated_at":"2019-05-21T09:17:49.051Z","due_date":"2019-04-22","start_date":"2019-03-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/27"},"assignees":[{"id":128633,"username":"rymai","name":"R√©my Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":128633,"username":"rymai","name":"R√©my Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6584","time_stats":{"time_estimate":28800,"total_time_spent":0,"human_time_estimate":"8h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6584","notes":"https://gitlab.com/api/v4/projects/278964/issues/6584/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6584/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6584","relative":"#6584","full":"gitlab-org/gitlab#6584"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12252724,"iid":6583,"project_id":278964,"title":"Extract EE specific files/lines for spec/routing","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003espec/routing/admin_routing_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/routing/admin_routing_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/routing/admin_routing_spec.rb\nindex 77baaef7afd..01c05f82f37 100644\n--- a/spec/routing/admin_routing_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/routing/admin_routing_spec.rb\n@@ -136,6 +136,16 @@ describe Admin::DashboardController, \"routing\" do\n   end\n end\n \n+describe Admin::EmailsController, \"routing\" do\n+  it \"to #show\" do\n+    expect(get(\"/admin/email\")).to route_to('admin/emails#show')\n+  end\n+\n+  it \"to #create\" do\n+    expect(post(\"/admin/email\")).to route_to('admin/emails#create')\n+  end\n+end\n+\n # admin_health_check GET    /admin/health_check(.:format) admin/health_check#show\n describe Admin::HealthCheckController, \"routing\" do\n   it \"to #show\" do\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/routing/group_routing_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/routing/group_routing_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/routing/group_routing_spec.rb\nindex 71788028cbf..1e0106d4f2e 100644\n--- a/spec/routing/group_routing_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/routing/group_routing_spec.rb\n@@ -129,5 +129,19 @@ describe \"Groups\", \"routing\" do\n         let(:resource) { create(:group, parent: parent, path: 'activity') }\n       end\n     end\n+\n+    describe 'subgroup \"boards\"' do\n+      it 'shows group show page' do\n+        allow(Group).to receive(:find_by_full_path).with('gitlabhq/boards', any_args).and_return(true)\n+\n+        expect(get('/groups/gitlabhq/boards')).to route_to('groups#show', id: 'gitlabhq/boards')\n+      end\n+\n+      it 'shows boards index page' do\n+        allow(Group).to receive(:find_by_full_path).with('gitlabhq', any_args).and_return(true)\n+\n+        expect(get('/groups/gitlabhq/-/boards')).to route_to('groups/boards#index', group_id: 'gitlabhq')\n+      end\n+    end\n   end\n end\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/routing/project_routing_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/routing/project_routing_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/routing/project_routing_spec.rb\nindex a0d01fc8263..c914d8cd317 100644\n--- a/spec/routing/project_routing_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/routing/project_routing_spec.rb\n@@ -661,4 +661,10 @@ describe 'project routing' do\n       end\n     end\n   end\n+\n+  describe Projects::PipelinesController, 'routing' do\n+    it 'to #security' do\n+      expect(get('/gitlab/gitlabhq/pipelines/12/security')).to route_to('projects/pipelines#security', namespace_id: 'gitlab', project_id: 'gitlabhq', id: '12')\n+    end\n+  end\n end\n```\n\n\u003c/details\u003e\n","state":"closed","created_at":"2018-06-22T15:41:12.552Z","updated_at":"2019-08-12T15:32:53.176Z","closed_at":"2019-04-26T11:27:34.910Z","closed_by":{"id":209240,"username":"yorickpeterse","name":"Yorick Peterse","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/209240/avatar.png","web_url":"https://gitlab.com/yorickpeterse"},"labels":["Deliverable","Enterprise Edition","Manage [DEPRECATED]","Quality","backend","missed-deliverable","missed:11.10","priority::2","single codebase","test"],"milestone":{"id":655280,"iid":28,"group_id":9970,"title":"11.11","description":"","state":"closed","created_at":"2018-09-21T19:08:37.027Z","updated_at":"2019-06-10T14:39:00.009Z","due_date":"2019-05-22","start_date":"2019-04-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/28"},"assignees":[{"id":2982208,"username":"mksionek","name":"Gosia Ksionek","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2982208/avatar.png","web_url":"https://gitlab.com/mksionek"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":2982208,"username":"mksionek","name":"Gosia Ksionek","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2982208/avatar.png","web_url":"https://gitlab.com/mksionek"},"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6583","time_stats":{"time_estimate":28800,"total_time_spent":0,"human_time_estimate":"8h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6583","notes":"https://gitlab.com/api/v4/projects/278964/issues/6583/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6583/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6583","relative":"#6583","full":"gitlab-org/gitlab#6583"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12252692,"iid":6582,"project_id":278964,"title":"Extract EE specific files/lines for spec/models/concerns","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003espec/models/concerns/issuable_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/models/concerns/issuable_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/models/concerns/issuable_spec.rb\nindex 41159348e04..e8bd3e681a0 100644\n--- a/spec/models/concerns/issuable_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/models/concerns/issuable_spec.rb\n@@ -452,6 +452,23 @@ describe Issuable do\n     end\n   end\n \n+  describe '.labels_hash' do\n+    let(:feature_label) { create(:label, title: 'Feature') }\n+    let(:second_label) { create(:label, title: 'Second Label') }\n+    let!(:issues) { create_list(:labeled_issue, 3, labels: [feature_label, second_label]) }\n+    let(:issue_id) { issues.first.id }\n+\n+    it 'maps issue ids to labels titles' do\n+      expect(Issue.labels_hash[issue_id]).to include('Feature')\n+    end\n+\n+    it 'works on relations filtered by multiple labels' do\n+      relation = Issue.with_label(['Feature', 'Second Label'])\n+\n+      expect(relation.labels_hash[issue_id]).to include('Feature', 'Second Label')\n+    end\n+  end\n+\n   describe '#user_notes_count' do\n     let(:project) { create(:project) }\n     let(:issue1) { create(:issue, project: project) }\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/models/concerns/prometheus_adapter_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/models/concerns/prometheus_adapter_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/models/concerns/prometheus_adapter_spec.rb\nindex f4b9c57e71a..2413f9e5db8 100644\n--- a/spec/models/concerns/prometheus_adapter_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/models/concerns/prometheus_adapter_spec.rb\n@@ -4,14 +4,15 @@ describe PrometheusAdapter, :use_clean_rails_memory_store_caching do\n   include PrometheusHelpers\n   include ReactiveCachingHelpers\n \n-  class TestClass\n-    include PrometheusAdapter\n-  end\n-\n   let(:project) { create(:prometheus_project) }\n   let(:service) { project.prometheus_service }\n \n-  let(:described_class) { TestClass }\n+  let(:described_class) do\n+    Class.new do\n+      include PrometheusAdapter\n+    end\n+  end\n+\n   let(:environment_query) { Gitlab::Prometheus::Queries::EnvironmentQuery }\n \n   describe '#query' do\n@@ -74,6 +75,29 @@ describe PrometheusAdapter, :use_clean_rails_memory_store_caching do\n         end\n       end\n     end\n+\n+    describe 'validate_query' do\n+      let(:environment) { build_stubbed(:environment, slug: 'env-slug') }\n+      let(:validation_query) { Gitlab::Prometheus::Queries::ValidateQuery.name }\n+      let(:query) { 'avg(response)' }\n+      let(:validation_respone) { { data: { valid: true } } }\n+\n+      around do |example|\n+        Timecop.freeze { example.run }\n+      end\n+\n+      context 'with valid data' do\n+        subject { service.query(:validate, query) }\n+\n+        before do\n+          stub_reactive_cache(service, validation_respone, validation_query, query)\n+        end\n+\n+        it 'returns query data' do\n+          is_expected.to eq(query: { valid: true })\n+        end\n+      end\n+    end\n   end\n \n   describe '#calculate_reactive_cache' do\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/models/concerns/sha_attribute_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/models/concerns/sha_attribute_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/models/concerns/sha_attribute_spec.rb\nindex 0d3beb6a6e3..b6732c4740f 100644\n--- a/spec/models/concerns/sha_attribute_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/models/concerns/sha_attribute_spec.rb\n@@ -70,6 +70,19 @@ describe ShaAttribute do\n           expect { model.sha_attribute(:name) }.to raise_error(ActiveRecord::NoDatabaseError)\n         end\n       end\n+\n+      # EE-specific start\n+      context 'when Geo database is not configured' do\n+        it 'allows the attribute to be added' do\n+          allow(model).to receive(:table_exists?).and_raise(Geo::TrackingBase::SecondaryNotConfigured.new)\n+\n+          expect(model).not_to receive(:columns)\n+          expect(model).to receive(:attribute)\n+\n+          model.sha_attribute(:name)\n+        end\n+      end\n+      # EE specific end\n     end\n \n     context 'when in production' do\n```\n\n\u003c/details\u003e\n","state":"closed","created_at":"2018-06-22T15:38:46.018Z","updated_at":"2019-08-12T15:32:53.178Z","closed_at":"2019-03-13T15:24:40.747Z","closed_by":{"id":15139,"username":"rspeicher","name":"Robert Speicher","state":"active","avatar_url":"https://secure.gravatar.com/avatar/73c8253932541a7b5cbc5d79493f2bea?s=80\u0026d=identicon","web_url":"https://gitlab.com/rspeicher"},"labels":["Deliverable","Enterprise Edition","Plan [DEPRECATED]","Quality","backend","single codebase","test"],"milestone":{"id":655279,"iid":27,"group_id":9970,"title":"11.10","description":"","state":"closed","created_at":"2018-09-21T19:08:16.261Z","updated_at":"2019-05-21T09:17:49.051Z","due_date":"2019-04-22","start_date":"2019-03-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/27"},"assignees":[{"id":3614911,"username":"rcobb","name":"Ryan Cobb","state":"active","avatar_url":"https://secure.gravatar.com/avatar/7047b7014264f07daf9836e55fc5ef4c?s=80\u0026d=identicon","web_url":"https://gitlab.com/rcobb"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":3614911,"username":"rcobb","name":"Ryan Cobb","state":"active","avatar_url":"https://secure.gravatar.com/avatar/7047b7014264f07daf9836e55fc5ef4c?s=80\u0026d=identicon","web_url":"https://gitlab.com/rcobb"},"user_notes_count":1,"merge_requests_count":2,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6582","time_stats":{"time_estimate":28800,"total_time_spent":0,"human_time_estimate":"8h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6582","notes":"https://gitlab.com/api/v4/projects/278964/issues/6582/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6582/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6582","relative":"#6582","full":"gitlab-org/gitlab#6582"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12252181,"iid":6578,"project_id":278964,"title":"Extract EE specific files/lines for spec/features/security/project/snippet","description":"We have the following files containing EE specific code. We should move them to ee/\r\n\r\n\u003cdetails\u003e\r\n\u003csummary\u003espec/features/security/project/internal_access_spec.rb\u003c/summary\u003e\r\n\r\n```diff\r\ndiff --git a/spec/features/security/project/internal_access_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/security/project/internal_access_spec.rb\r\nindex e23000fa676..75f3ac25eea 100644\r\n--- a/spec/features/security/project/internal_access_spec.rb\r\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/security/project/internal_access_spec.rb\r\n@@ -16,6 +16,7 @@ describe \"Internal Project Access\" do\r\n     subject { project_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -30,6 +31,7 @@ describe \"Internal Project Access\" do\r\n     subject { project_tree_path(project, project.repository.root_ref) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -44,6 +46,7 @@ describe \"Internal Project Access\" do\r\n     subject { project_commits_path(project, project.repository.root_ref, limit: 1) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -58,6 +61,7 @@ describe \"Internal Project Access\" do\r\n     subject { project_commit_path(project, project.repository.commit) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -72,6 +76,7 @@ describe \"Internal Project Access\" do\r\n     subject { project_compare_index_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -86,6 +91,7 @@ describe \"Internal Project Access\" do\r\n     subject { project_settings_members_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -114,6 +120,7 @@ describe \"Internal Project Access\" do\r\n     subject { project_settings_repository_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_denied_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_denied_for(:developer).of(project) }\r\n@@ -129,6 +136,7 @@ describe \"Internal Project Access\" do\r\n     subject { project_blob_path(project, File.join(commit.id, '.gitignore')) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -143,6 +151,7 @@ describe \"Internal Project Access\" do\r\n     subject { edit_project_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_denied_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_denied_for(:developer).of(project) }\r\n@@ -157,6 +166,7 @@ describe \"Internal Project Access\" do\r\n     subject { project_deploy_keys_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_denied_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_denied_for(:developer).of(project) }\r\n@@ -171,6 +181,7 @@ describe \"Internal Project Access\" do\r\n     subject { project_issues_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -200,6 +211,7 @@ describe \"Internal Project Access\" do\r\n     subject { project_snippets_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -214,6 +226,7 @@ describe \"Internal Project Access\" do\r\n     subject { new_project_snippet_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_denied_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -228,6 +241,7 @@ describe \"Internal Project Access\" do\r\n     subject { project_merge_requests_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -242,6 +256,7 @@ describe \"Internal Project Access\" do\r\n     subject { project_new_merge_request_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_denied_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -261,6 +276,7 @@ describe \"Internal Project Access\" do\r\n     end\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -280,6 +296,7 @@ describe \"Internal Project Access\" do\r\n     end\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -294,6 +311,7 @@ describe \"Internal Project Access\" do\r\n     subject { project_settings_integrations_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_denied_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_denied_for(:developer).of(project) }\r\n@@ -308,6 +326,7 @@ describe \"Internal Project Access\" do\r\n     subject { project_pipelines_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -323,6 +342,7 @@ describe \"Internal Project Access\" do\r\n     subject { project_pipeline_path(project, pipeline) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -342,6 +362,7 @@ describe \"Internal Project Access\" do\r\n       end\r\n \r\n       it { is_expected.to be_allowed_for(:admin) }\r\n+      it { is_expected.to be_allowed_for(:auditor) }\r\n       it { is_expected.to be_allowed_for(:owner).of(project) }\r\n       it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n       it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -358,6 +379,7 @@ describe \"Internal Project Access\" do\r\n       end\r\n \r\n       it { is_expected.to be_allowed_for(:admin) }\r\n+      it { is_expected.to be_allowed_for(:auditor) }\r\n       it { is_expected.to be_allowed_for(:owner).of(project) }\r\n       it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n       it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -380,6 +402,7 @@ describe \"Internal Project Access\" do\r\n       end\r\n \r\n       it { is_expected.to be_allowed_for(:admin) }\r\n+      it { is_expected.to be_allowed_for(:auditor) }\r\n       it { is_expected.to be_allowed_for(:owner).of(project) }\r\n       it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n       it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -396,6 +419,7 @@ describe \"Internal Project Access\" do\r\n       end\r\n \r\n       it { is_expected.to be_allowed_for(:admin) }\r\n+      it { is_expected.to be_allowed_for(:auditor) }\r\n       it { is_expected.to be_allowed_for(:owner).of(project) }\r\n       it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n       it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -463,6 +487,7 @@ describe \"Internal Project Access\" do\r\n     subject { project_environments_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -478,6 +503,7 @@ describe \"Internal Project Access\" do\r\n     subject { project_environment_path(project, environment) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -507,6 +533,7 @@ describe \"Internal Project Access\" do\r\n     subject { new_project_environment_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_denied_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -517,6 +544,36 @@ describe \"Internal Project Access\" do\r\n     it { is_expected.to be_denied_for(:visitor) }\r\n   end\r\n \r\n+  context \"when license blocks changes\" do\r\n+    before do\r\n+      allow(License).to receive(:block_changes?).and_return(true)\r\n+    end\r\n+\r\n+    describe \"GET /:project_path/issues/new\" do\r\n+      subject { new_project_issue_path(project) }\r\n+\r\n+      it { is_expected.to be_denied_for(:maintainer).of(project) }\r\n+      it { is_expected.to be_denied_for(:reporter).of(project) }\r\n+      it { is_expected.to be_denied_for(:admin) }\r\n+      it { is_expected.to be_denied_for(:guest).of(project) }\r\n+      it { is_expected.to be_denied_for(:user) }\r\n+      it { is_expected.to be_denied_for(:auditor) }\r\n+      it { is_expected.to be_denied_for(:visitor) }\r\n+    end\r\n+\r\n+    describe \"GET /:project_path/merge_requests/new\" do\r\n+      subject { project_new_merge_request_path(project) }\r\n+\r\n+      it { is_expected.to be_denied_for(:maintainer).of(project) }\r\n+      it { is_expected.to be_denied_for(:reporter).of(project) }\r\n+      it { is_expected.to be_denied_for(:admin) }\r\n+      it { is_expected.to be_denied_for(:guest).of(project) }\r\n+      it { is_expected.to be_denied_for(:user) }\r\n+      it { is_expected.to be_denied_for(:auditor) }\r\n+      it { is_expected.to be_denied_for(:visitor) }\r\n+    end\r\n+  end\r\n+\r\n   describe \"GET /:project_path/container_registry\" do\r\n     let(:container_repository) { create(:container_repository) }\r\n \r\n@@ -529,6 +586,7 @@ describe \"Internal Project Access\" do\r\n     subject { project_container_registry_index_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n```\r\n\r\n\u003c/details\u003e\r\n\u003cdetails\u003e\r\n\u003csummary\u003espec/features/security/project/private_access_spec.rb\u003c/summary\u003e\r\n\r\n```diff\r\ndiff --git a/spec/features/security/project/private_access_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/security/project/private_access_spec.rb\r\nindex f380bc122a7..1e10ded14e8 100644\r\n--- a/spec/features/security/project/private_access_spec.rb\r\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/security/project/private_access_spec.rb\r\n@@ -16,6 +16,7 @@ describe \"Private Project Access\" do\r\n     subject { project_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -30,6 +31,7 @@ describe \"Private Project Access\" do\r\n     subject { project_tree_path(project, project.repository.root_ref) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -44,6 +46,7 @@ describe \"Private Project Access\" do\r\n     subject { project_commits_path(project, project.repository.root_ref, limit: 1) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -58,6 +61,7 @@ describe \"Private Project Access\" do\r\n     subject { project_commit_path(project, project.repository.commit) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -72,6 +76,7 @@ describe \"Private Project Access\" do\r\n     subject { project_compare_index_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -86,6 +91,7 @@ describe \"Private Project Access\" do\r\n     subject { project_settings_members_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -129,6 +135,7 @@ describe \"Private Project Access\" do\r\n     subject { project_blob_path(project, File.join(commit.id, '.gitignore'))}\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -143,6 +150,7 @@ describe \"Private Project Access\" do\r\n     subject { edit_project_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_denied_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_denied_for(:developer).of(project) }\r\n@@ -157,6 +165,7 @@ describe \"Private Project Access\" do\r\n     subject { project_deploy_keys_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_denied_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_denied_for(:developer).of(project) }\r\n@@ -171,6 +180,7 @@ describe \"Private Project Access\" do\r\n     subject { project_issues_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -200,6 +210,7 @@ describe \"Private Project Access\" do\r\n     subject { project_snippets_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -214,6 +225,7 @@ describe \"Private Project Access\" do\r\n     subject { project_merge_requests_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -233,6 +245,7 @@ describe \"Private Project Access\" do\r\n     end\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -252,6 +265,7 @@ describe \"Private Project Access\" do\r\n     end\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -266,6 +280,7 @@ describe \"Private Project Access\" do\r\n     subject { project_settings_integrations_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_denied_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_denied_for(:developer).of(project) }\r\n@@ -280,6 +295,7 @@ describe \"Private Project Access\" do\r\n     subject { project_pipelines_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -307,6 +323,7 @@ describe \"Private Project Access\" do\r\n     subject { project_pipeline_path(project, pipeline) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -333,6 +350,7 @@ describe \"Private Project Access\" do\r\n     subject { project_jobs_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -361,6 +379,7 @@ describe \"Private Project Access\" do\r\n     subject { project_job_path(project, build.id) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -424,6 +443,7 @@ describe \"Private Project Access\" do\r\n     subject { project_environments_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -439,6 +459,7 @@ describe \"Private Project Access\" do\r\n     subject { project_environment_path(project, environment) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -468,6 +489,7 @@ describe \"Private Project Access\" do\r\n     subject { new_project_environment_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_denied_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -520,6 +542,36 @@ describe \"Private Project Access\" do\r\n     it { is_expected.to be_denied_for(:visitor) }\r\n   end\r\n \r\n+  context \"when license blocks changes\" do\r\n+    before do\r\n+      allow(License).to receive(:block_changes?).and_return(true)\r\n+    end\r\n+\r\n+    describe \"GET /:project_path/issues/new\" do\r\n+      subject { new_project_issue_path(project) }\r\n+\r\n+      it { is_expected.to be_denied_for(:maintainer).of(project) }\r\n+      it { is_expected.to be_denied_for(:reporter).of(project) }\r\n+      it { is_expected.to be_denied_for(:admin) }\r\n+      it { is_expected.to be_denied_for(:guest).of(project) }\r\n+      it { is_expected.to be_denied_for(:user) }\r\n+      it { is_expected.to be_denied_for(:auditor) }\r\n+      it { is_expected.to be_denied_for(:visitor) }\r\n+    end\r\n+\r\n+    describe \"GET /:project_path/merge_requests/new\" do\r\n+      subject { project_new_merge_request_path(project) }\r\n+\r\n+      it { is_expected.to be_denied_for(:maintainer).of(project) }\r\n+      it { is_expected.to be_denied_for(:reporter).of(project) }\r\n+      it { is_expected.to be_denied_for(:admin) }\r\n+      it { is_expected.to be_denied_for(:guest).of(project) }\r\n+      it { is_expected.to be_denied_for(:user) }\r\n+      it { is_expected.to be_denied_for(:auditor) }\r\n+      it { is_expected.to be_denied_for(:visitor) }\r\n+    end\r\n+  end\r\n+\r\n   describe \"GET /:project_path/container_registry\" do\r\n     let(:container_repository) { create(:container_repository) }\r\n \r\n@@ -532,6 +584,7 @@ describe \"Private Project Access\" do\r\n     subject { project_container_registry_index_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n```\r\n\r\n\u003c/details\u003e\r\n\u003cdetails\u003e\r\n\u003csummary\u003espec/features/security/project/public_access_spec.rb\u003c/summary\u003e\r\n\r\n```diff\r\ndiff --git a/spec/features/security/project/public_access_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/security/project/public_access_spec.rb\r\nindex 57d56371719..babcf6dcdb9 100644\r\n--- a/spec/features/security/project/public_access_spec.rb\r\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/security/project/public_access_spec.rb\r\n@@ -16,6 +16,7 @@ describe \"Public Project Access\" do\r\n     subject { project_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -30,6 +31,7 @@ describe \"Public Project Access\" do\r\n     subject { project_tree_path(project, project.repository.root_ref) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -44,6 +46,7 @@ describe \"Public Project Access\" do\r\n     subject { project_commits_path(project, project.repository.root_ref, limit: 1) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -58,6 +61,7 @@ describe \"Public Project Access\" do\r\n     subject { project_commit_path(project, project.repository.commit) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -72,6 +76,7 @@ describe \"Public Project Access\" do\r\n     subject { project_compare_index_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -86,6 +91,7 @@ describe \"Public Project Access\" do\r\n     subject { project_settings_members_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -128,6 +134,7 @@ describe \"Public Project Access\" do\r\n     subject { project_pipelines_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -143,6 +150,7 @@ describe \"Public Project Access\" do\r\n     subject { project_pipeline_path(project, pipeline) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -162,6 +170,7 @@ describe \"Public Project Access\" do\r\n       end\r\n \r\n       it { is_expected.to be_allowed_for(:admin) }\r\n+      it { is_expected.to be_allowed_for(:auditor) }\r\n       it { is_expected.to be_allowed_for(:owner).of(project) }\r\n       it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n       it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -178,6 +187,7 @@ describe \"Public Project Access\" do\r\n       end\r\n \r\n       it { is_expected.to be_allowed_for(:admin) }\r\n+      it { is_expected.to be_allowed_for(:auditor) }\r\n       it { is_expected.to be_allowed_for(:owner).of(project) }\r\n       it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n       it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -200,6 +210,7 @@ describe \"Public Project Access\" do\r\n       end\r\n \r\n       it { is_expected.to be_allowed_for(:admin) }\r\n+      it { is_expected.to be_allowed_for(:auditor) }\r\n       it { is_expected.to be_allowed_for(:owner).of(project) }\r\n       it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n       it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -216,6 +227,7 @@ describe \"Public Project Access\" do\r\n       end\r\n \r\n       it { is_expected.to be_allowed_for(:admin) }\r\n+      it { is_expected.to be_allowed_for(:auditor) }\r\n       it { is_expected.to be_allowed_for(:owner).of(project) }\r\n       it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n       it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -283,6 +295,7 @@ describe \"Public Project Access\" do\r\n     subject { project_environments_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -298,6 +311,7 @@ describe \"Public Project Access\" do\r\n     subject { project_environment_path(project, environment) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -327,6 +341,7 @@ describe \"Public Project Access\" do\r\n     subject { new_project_environment_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_denied_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -343,6 +358,7 @@ describe \"Public Project Access\" do\r\n     subject { project_blob_path(project, File.join(commit.id, '.gitignore')) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -356,6 +372,7 @@ describe \"Public Project Access\" do\r\n     subject { edit_project_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_denied_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_denied_for(:developer).of(project) }\r\n@@ -370,6 +387,7 @@ describe \"Public Project Access\" do\r\n     subject { project_deploy_keys_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_denied_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_denied_for(:developer).of(project) }\r\n@@ -384,6 +402,7 @@ describe \"Public Project Access\" do\r\n     subject { project_issues_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -413,6 +432,7 @@ describe \"Public Project Access\" do\r\n     subject { project_snippets_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -427,6 +447,7 @@ describe \"Public Project Access\" do\r\n     subject { new_project_snippet_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_denied_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -441,6 +462,7 @@ describe \"Public Project Access\" do\r\n     subject { project_merge_requests_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -455,6 +477,7 @@ describe \"Public Project Access\" do\r\n     subject { project_new_merge_request_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_denied_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -474,6 +497,7 @@ describe \"Public Project Access\" do\r\n     end\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -493,6 +517,7 @@ describe \"Public Project Access\" do\r\n     end\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -507,6 +532,7 @@ describe \"Public Project Access\" do\r\n     subject { project_settings_integrations_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_denied_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_denied_for(:developer).of(project) }\r\n@@ -517,6 +543,36 @@ describe \"Public Project Access\" do\r\n     it { is_expected.to be_denied_for(:visitor) }\r\n   end\r\n \r\n+  context \"when license blocks changes\" do\r\n+    before do\r\n+      allow(License).to receive(:block_changes?).and_return(true)\r\n+    end\r\n+\r\n+    describe \"GET /:project_path/issues/new\" do\r\n+      subject { new_project_issue_path(project) }\r\n+\r\n+      it { is_expected.to be_denied_for(:maintainer).of(project) }\r\n+      it { is_expected.to be_denied_for(:reporter).of(project) }\r\n+      it { is_expected.to be_denied_for(:admin) }\r\n+      it { is_expected.to be_denied_for(:guest).of(project) }\r\n+      it { is_expected.to be_denied_for(:user) }\r\n+      it { is_expected.to be_denied_for(:auditor) }\r\n+      it { is_expected.to be_denied_for(:visitor) }\r\n+    end\r\n+\r\n+    describe \"GET /:project_path/merge_requests/new\" do\r\n+      subject { project_new_merge_request_path(project) }\r\n+\r\n+      it { is_expected.to be_denied_for(:maintainer).of(project) }\r\n+      it { is_expected.to be_denied_for(:reporter).of(project) }\r\n+      it { is_expected.to be_denied_for(:admin) }\r\n+      it { is_expected.to be_denied_for(:guest).of(project) }\r\n+      it { is_expected.to be_denied_for(:user) }\r\n+      it { is_expected.to be_denied_for(:auditor) }\r\n+      it { is_expected.to be_denied_for(:visitor) }\r\n+    end\r\n+  end\r\n+\r\n   describe \"GET /:project_path/container_registry\" do\r\n     let(:container_repository) { create(:container_repository) }\r\n \r\n@@ -529,6 +585,7 @@ describe \"Public Project Access\" do\r\n     subject { project_container_registry_index_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n```\r\n\r\n\u003c/details\u003e\r\n\u003cdetails\u003e\r\n\u003csummary\u003espec/features/security/project/snippet/internal_access_spec.rb\u003c/summary\u003e\r\n\r\n```diff\r\ndiff --git a/spec/features/security/project/snippet/internal_access_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/security/project/snippet/internal_access_spec.rb\r\nindex 0c58fdf2f12..1dcb7d6448c 100644\r\n--- a/spec/features/security/project/snippet/internal_access_spec.rb\r\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/security/project/snippet/internal_access_spec.rb\r\n@@ -12,6 +12,7 @@ describe \"Internal Project Snippets Access\" do\r\n     subject { project_snippets_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -26,6 +27,7 @@ describe \"Internal Project Snippets Access\" do\r\n     subject { new_project_snippet_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_denied_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -41,6 +43,7 @@ describe \"Internal Project Snippets Access\" do\r\n       subject { project_snippet_path(project, internal_snippet) }\r\n \r\n       it { is_expected.to be_allowed_for(:admin) }\r\n+      it { is_expected.to be_allowed_for(:auditor) }\r\n       it { is_expected.to be_allowed_for(:owner).of(project) }\r\n       it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n       it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -55,6 +58,7 @@ describe \"Internal Project Snippets Access\" do\r\n       subject { project_snippet_path(project, private_snippet) }\r\n \r\n       it { is_expected.to be_allowed_for(:admin) }\r\n+      it { is_expected.to be_allowed_for(:auditor) }\r\n       it { is_expected.to be_allowed_for(:owner).of(project) }\r\n       it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n       it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -71,6 +75,7 @@ describe \"Internal Project Snippets Access\" do\r\n       subject { raw_project_snippet_path(project, internal_snippet) }\r\n \r\n       it { is_expected.to be_allowed_for(:admin) }\r\n+      it { is_expected.to be_allowed_for(:auditor) }\r\n       it { is_expected.to be_allowed_for(:owner).of(project) }\r\n       it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n       it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -85,6 +90,7 @@ describe \"Internal Project Snippets Access\" do\r\n       subject { raw_project_snippet_path(project, private_snippet) }\r\n \r\n       it { is_expected.to be_allowed_for(:admin) }\r\n+      it { is_expected.to be_allowed_for(:auditor) }\r\n       it { is_expected.to be_allowed_for(:owner).of(project) }\r\n       it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n       it { is_expected.to be_allowed_for(:developer).of(project) }\r\n```\r\n\r\n\u003c/details\u003e\r\n\u003cdetails\u003e\r\n\u003csummary\u003espec/features/security/project/snippet/private_access_spec.rb\u003c/summary\u003e\r\n\r\n```diff\r\ndiff --git a/spec/features/security/project/snippet/private_access_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/security/project/snippet/private_access_spec.rb\r\nindex 420f1938763..979e4c93c2e 100644\r\n--- a/spec/features/security/project/snippet/private_access_spec.rb\r\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/security/project/snippet/private_access_spec.rb\r\n@@ -11,6 +11,7 @@ describe \"Private Project Snippets Access\" do\r\n     subject { project_snippets_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -25,6 +26,7 @@ describe \"Private Project Snippets Access\" do\r\n     subject { new_project_snippet_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_denied_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -39,6 +41,7 @@ describe \"Private Project Snippets Access\" do\r\n     subject { project_snippet_path(project, private_snippet) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -53,6 +56,7 @@ describe \"Private Project Snippets Access\" do\r\n     subject { raw_project_snippet_path(project, private_snippet) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n```\r\n\r\n\u003c/details\u003e\r\n\u003cdetails\u003e\r\n\u003csummary\u003espec/features/security/project/snippet/public_access_spec.rb\u003c/summary\u003e\r\n\r\n```diff\r\ndiff --git a/spec/features/security/project/snippet/public_access_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/security/project/snippet/public_access_spec.rb\r\nindex 6c75902c6e9..88d64fa0e30 100644\r\n--- a/spec/features/security/project/snippet/public_access_spec.rb\r\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/security/project/snippet/public_access_spec.rb\r\n@@ -13,6 +13,7 @@ describe \"Public Project Snippets Access\" do\r\n     subject { project_snippets_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -27,6 +28,7 @@ describe \"Public Project Snippets Access\" do\r\n     subject { new_project_snippet_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_denied_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -42,6 +44,7 @@ describe \"Public Project Snippets Access\" do\r\n       subject { project_snippet_path(project, public_snippet) }\r\n \r\n       it { is_expected.to be_allowed_for(:admin) }\r\n+      it { is_expected.to be_allowed_for(:auditor) }\r\n       it { is_expected.to be_allowed_for(:owner).of(project) }\r\n       it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n       it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -56,6 +59,7 @@ describe \"Public Project Snippets Access\" do\r\n       subject { project_snippet_path(project, internal_snippet) }\r\n \r\n       it { is_expected.to be_allowed_for(:admin) }\r\n+      it { is_expected.to be_allowed_for(:auditor) }\r\n       it { is_expected.to be_allowed_for(:owner).of(project) }\r\n       it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n       it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -70,6 +74,7 @@ describe \"Public Project Snippets Access\" do\r\n       subject { project_snippet_path(project, private_snippet) }\r\n \r\n       it { is_expected.to be_allowed_for(:admin) }\r\n+      it { is_expected.to be_allowed_for(:auditor) }\r\n       it { is_expected.to be_allowed_for(:owner).of(project) }\r\n       it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n       it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -86,6 +91,7 @@ describe \"Public Project Snippets Access\" do\r\n       subject { raw_project_snippet_path(project, public_snippet) }\r\n \r\n       it { is_expected.to be_allowed_for(:admin) }\r\n+      it { is_expected.to be_allowed_for(:auditor) }\r\n       it { is_expected.to be_allowed_for(:owner).of(project) }\r\n       it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n       it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -100,6 +106,7 @@ describe \"Public Project Snippets Access\" do\r\n       subject { raw_project_snippet_path(project, internal_snippet) }\r\n \r\n       it { is_expected.to be_allowed_for(:admin) }\r\n+      it { is_expected.to be_allowed_for(:auditor) }\r\n       it { is_expected.to be_allowed_for(:owner).of(project) }\r\n       it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n       it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -114,6 +121,7 @@ describe \"Public Project Snippets Access\" do\r\n       subject { raw_project_snippet_path(project, private_snippet) }\r\n \r\n       it { is_expected.to be_allowed_for(:admin) }\r\n+      it { is_expected.to be_allowed_for(:auditor) }\r\n       it { is_expected.to be_allowed_for(:owner).of(project) }\r\n       it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n       it { is_expected.to be_allowed_for(:developer).of(project) }\r\n```\r\n\r\n\u003c/details\u003e\r\n","state":"closed","created_at":"2018-06-22T15:18:34.427Z","updated_at":"2019-08-12T15:32:53.391Z","closed_at":"2019-05-24T15:05:22.854Z","closed_by":{"id":209240,"username":"yorickpeterse","name":"Yorick Peterse","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/209240/avatar.png","web_url":"https://gitlab.com/yorickpeterse"},"labels":["Deliverable","Enterprise Edition","Manage [DEPRECATED]","Quality","backend","single codebase","test"],"milestone":{"id":693518,"iid":33,"group_id":9970,"title":"12.0","description":"https://about.gitlab.com/releases/2019/06/22/gitlab-12-0-released/","state":"closed","created_at":"2018-10-30T16:47:37.975Z","updated_at":"2020-04-22T19:51:03.475Z","due_date":"2019-06-22","start_date":"2019-05-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/33"},"assignees":[{"id":2982208,"username":"mksionek","name":"Gosia Ksionek","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2982208/avatar.png","web_url":"https://gitlab.com/mksionek"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":2982208,"username":"mksionek","name":"Gosia Ksionek","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2982208/avatar.png","web_url":"https://gitlab.com/mksionek"},"user_notes_count":0,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6578","time_stats":{"time_estimate":57600,"total_time_spent":0,"human_time_estimate":"16h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6578","notes":"https://gitlab.com/api/v4/projects/278964/issues/6578/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6578/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6578","relative":"#6578","full":"gitlab-org/gitlab#6578"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12252168,"iid":6577,"project_id":278964,"title":"Extract EE specific files/lines for spec/features/security/project","description":"We have the following files containing EE specific code. We should move them to ee/\r\n\r\n\u003cdetails\u003e\r\n\u003csummary\u003espec/features/security/project/internal_access_spec.rb\u003c/summary\u003e\r\n\r\n```diff\r\ndiff --git a/spec/features/security/project/internal_access_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/security/project/internal_access_spec.rb\r\nindex e23000fa676..75f3ac25eea 100644\r\n--- a/spec/features/security/project/internal_access_spec.rb\r\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/security/project/internal_access_spec.rb\r\n@@ -16,6 +16,7 @@ describe \"Internal Project Access\" do\r\n     subject { project_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -30,6 +31,7 @@ describe \"Internal Project Access\" do\r\n     subject { project_tree_path(project, project.repository.root_ref) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -44,6 +46,7 @@ describe \"Internal Project Access\" do\r\n     subject { project_commits_path(project, project.repository.root_ref, limit: 1) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -58,6 +61,7 @@ describe \"Internal Project Access\" do\r\n     subject { project_commit_path(project, project.repository.commit) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -72,6 +76,7 @@ describe \"Internal Project Access\" do\r\n     subject { project_compare_index_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -86,6 +91,7 @@ describe \"Internal Project Access\" do\r\n     subject { project_settings_members_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -114,6 +120,7 @@ describe \"Internal Project Access\" do\r\n     subject { project_settings_repository_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_denied_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_denied_for(:developer).of(project) }\r\n@@ -129,6 +136,7 @@ describe \"Internal Project Access\" do\r\n     subject { project_blob_path(project, File.join(commit.id, '.gitignore')) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -143,6 +151,7 @@ describe \"Internal Project Access\" do\r\n     subject { edit_project_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_denied_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_denied_for(:developer).of(project) }\r\n@@ -157,6 +166,7 @@ describe \"Internal Project Access\" do\r\n     subject { project_deploy_keys_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_denied_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_denied_for(:developer).of(project) }\r\n@@ -171,6 +181,7 @@ describe \"Internal Project Access\" do\r\n     subject { project_issues_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -200,6 +211,7 @@ describe \"Internal Project Access\" do\r\n     subject { project_snippets_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -214,6 +226,7 @@ describe \"Internal Project Access\" do\r\n     subject { new_project_snippet_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_denied_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -228,6 +241,7 @@ describe \"Internal Project Access\" do\r\n     subject { project_merge_requests_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -242,6 +256,7 @@ describe \"Internal Project Access\" do\r\n     subject { project_new_merge_request_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_denied_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -261,6 +276,7 @@ describe \"Internal Project Access\" do\r\n     end\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -280,6 +296,7 @@ describe \"Internal Project Access\" do\r\n     end\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -294,6 +311,7 @@ describe \"Internal Project Access\" do\r\n     subject { project_settings_integrations_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_denied_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_denied_for(:developer).of(project) }\r\n@@ -308,6 +326,7 @@ describe \"Internal Project Access\" do\r\n     subject { project_pipelines_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -323,6 +342,7 @@ describe \"Internal Project Access\" do\r\n     subject { project_pipeline_path(project, pipeline) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -342,6 +362,7 @@ describe \"Internal Project Access\" do\r\n       end\r\n \r\n       it { is_expected.to be_allowed_for(:admin) }\r\n+      it { is_expected.to be_allowed_for(:auditor) }\r\n       it { is_expected.to be_allowed_for(:owner).of(project) }\r\n       it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n       it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -358,6 +379,7 @@ describe \"Internal Project Access\" do\r\n       end\r\n \r\n       it { is_expected.to be_allowed_for(:admin) }\r\n+      it { is_expected.to be_allowed_for(:auditor) }\r\n       it { is_expected.to be_allowed_for(:owner).of(project) }\r\n       it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n       it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -380,6 +402,7 @@ describe \"Internal Project Access\" do\r\n       end\r\n \r\n       it { is_expected.to be_allowed_for(:admin) }\r\n+      it { is_expected.to be_allowed_for(:auditor) }\r\n       it { is_expected.to be_allowed_for(:owner).of(project) }\r\n       it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n       it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -396,6 +419,7 @@ describe \"Internal Project Access\" do\r\n       end\r\n \r\n       it { is_expected.to be_allowed_for(:admin) }\r\n+      it { is_expected.to be_allowed_for(:auditor) }\r\n       it { is_expected.to be_allowed_for(:owner).of(project) }\r\n       it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n       it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -463,6 +487,7 @@ describe \"Internal Project Access\" do\r\n     subject { project_environments_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -478,6 +503,7 @@ describe \"Internal Project Access\" do\r\n     subject { project_environment_path(project, environment) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -507,6 +533,7 @@ describe \"Internal Project Access\" do\r\n     subject { new_project_environment_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_denied_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -517,6 +544,36 @@ describe \"Internal Project Access\" do\r\n     it { is_expected.to be_denied_for(:visitor) }\r\n   end\r\n \r\n+  context \"when license blocks changes\" do\r\n+    before do\r\n+      allow(License).to receive(:block_changes?).and_return(true)\r\n+    end\r\n+\r\n+    describe \"GET /:project_path/issues/new\" do\r\n+      subject { new_project_issue_path(project) }\r\n+\r\n+      it { is_expected.to be_denied_for(:maintainer).of(project) }\r\n+      it { is_expected.to be_denied_for(:reporter).of(project) }\r\n+      it { is_expected.to be_denied_for(:admin) }\r\n+      it { is_expected.to be_denied_for(:guest).of(project) }\r\n+      it { is_expected.to be_denied_for(:user) }\r\n+      it { is_expected.to be_denied_for(:auditor) }\r\n+      it { is_expected.to be_denied_for(:visitor) }\r\n+    end\r\n+\r\n+    describe \"GET /:project_path/merge_requests/new\" do\r\n+      subject { project_new_merge_request_path(project) }\r\n+\r\n+      it { is_expected.to be_denied_for(:maintainer).of(project) }\r\n+      it { is_expected.to be_denied_for(:reporter).of(project) }\r\n+      it { is_expected.to be_denied_for(:admin) }\r\n+      it { is_expected.to be_denied_for(:guest).of(project) }\r\n+      it { is_expected.to be_denied_for(:user) }\r\n+      it { is_expected.to be_denied_for(:auditor) }\r\n+      it { is_expected.to be_denied_for(:visitor) }\r\n+    end\r\n+  end\r\n+\r\n   describe \"GET /:project_path/container_registry\" do\r\n     let(:container_repository) { create(:container_repository) }\r\n \r\n@@ -529,6 +586,7 @@ describe \"Internal Project Access\" do\r\n     subject { project_container_registry_index_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n```\r\n\r\n\u003c/details\u003e\r\n\u003cdetails\u003e\r\n\u003csummary\u003espec/features/security/project/private_access_spec.rb\u003c/summary\u003e\r\n\r\n```diff\r\ndiff --git a/spec/features/security/project/private_access_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/security/project/private_access_spec.rb\r\nindex f380bc122a7..1e10ded14e8 100644\r\n--- a/spec/features/security/project/private_access_spec.rb\r\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/security/project/private_access_spec.rb\r\n@@ -16,6 +16,7 @@ describe \"Private Project Access\" do\r\n     subject { project_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -30,6 +31,7 @@ describe \"Private Project Access\" do\r\n     subject { project_tree_path(project, project.repository.root_ref) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -44,6 +46,7 @@ describe \"Private Project Access\" do\r\n     subject { project_commits_path(project, project.repository.root_ref, limit: 1) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -58,6 +61,7 @@ describe \"Private Project Access\" do\r\n     subject { project_commit_path(project, project.repository.commit) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -72,6 +76,7 @@ describe \"Private Project Access\" do\r\n     subject { project_compare_index_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -86,6 +91,7 @@ describe \"Private Project Access\" do\r\n     subject { project_settings_members_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -129,6 +135,7 @@ describe \"Private Project Access\" do\r\n     subject { project_blob_path(project, File.join(commit.id, '.gitignore'))}\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -143,6 +150,7 @@ describe \"Private Project Access\" do\r\n     subject { edit_project_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_denied_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_denied_for(:developer).of(project) }\r\n@@ -157,6 +165,7 @@ describe \"Private Project Access\" do\r\n     subject { project_deploy_keys_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_denied_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_denied_for(:developer).of(project) }\r\n@@ -171,6 +180,7 @@ describe \"Private Project Access\" do\r\n     subject { project_issues_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -200,6 +210,7 @@ describe \"Private Project Access\" do\r\n     subject { project_snippets_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -214,6 +225,7 @@ describe \"Private Project Access\" do\r\n     subject { project_merge_requests_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -233,6 +245,7 @@ describe \"Private Project Access\" do\r\n     end\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -252,6 +265,7 @@ describe \"Private Project Access\" do\r\n     end\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -266,6 +280,7 @@ describe \"Private Project Access\" do\r\n     subject { project_settings_integrations_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_denied_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_denied_for(:developer).of(project) }\r\n@@ -280,6 +295,7 @@ describe \"Private Project Access\" do\r\n     subject { project_pipelines_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -307,6 +323,7 @@ describe \"Private Project Access\" do\r\n     subject { project_pipeline_path(project, pipeline) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -333,6 +350,7 @@ describe \"Private Project Access\" do\r\n     subject { project_jobs_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -361,6 +379,7 @@ describe \"Private Project Access\" do\r\n     subject { project_job_path(project, build.id) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -424,6 +443,7 @@ describe \"Private Project Access\" do\r\n     subject { project_environments_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -439,6 +459,7 @@ describe \"Private Project Access\" do\r\n     subject { project_environment_path(project, environment) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -468,6 +489,7 @@ describe \"Private Project Access\" do\r\n     subject { new_project_environment_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_denied_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -520,6 +542,36 @@ describe \"Private Project Access\" do\r\n     it { is_expected.to be_denied_for(:visitor) }\r\n   end\r\n \r\n+  context \"when license blocks changes\" do\r\n+    before do\r\n+      allow(License).to receive(:block_changes?).and_return(true)\r\n+    end\r\n+\r\n+    describe \"GET /:project_path/issues/new\" do\r\n+      subject { new_project_issue_path(project) }\r\n+\r\n+      it { is_expected.to be_denied_for(:maintainer).of(project) }\r\n+      it { is_expected.to be_denied_for(:reporter).of(project) }\r\n+      it { is_expected.to be_denied_for(:admin) }\r\n+      it { is_expected.to be_denied_for(:guest).of(project) }\r\n+      it { is_expected.to be_denied_for(:user) }\r\n+      it { is_expected.to be_denied_for(:auditor) }\r\n+      it { is_expected.to be_denied_for(:visitor) }\r\n+    end\r\n+\r\n+    describe \"GET /:project_path/merge_requests/new\" do\r\n+      subject { project_new_merge_request_path(project) }\r\n+\r\n+      it { is_expected.to be_denied_for(:maintainer).of(project) }\r\n+      it { is_expected.to be_denied_for(:reporter).of(project) }\r\n+      it { is_expected.to be_denied_for(:admin) }\r\n+      it { is_expected.to be_denied_for(:guest).of(project) }\r\n+      it { is_expected.to be_denied_for(:user) }\r\n+      it { is_expected.to be_denied_for(:auditor) }\r\n+      it { is_expected.to be_denied_for(:visitor) }\r\n+    end\r\n+  end\r\n+\r\n   describe \"GET /:project_path/container_registry\" do\r\n     let(:container_repository) { create(:container_repository) }\r\n \r\n@@ -532,6 +584,7 @@ describe \"Private Project Access\" do\r\n     subject { project_container_registry_index_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n```\r\n\r\n\u003c/details\u003e\r\n\u003cdetails\u003e\r\n\u003csummary\u003espec/features/security/project/public_access_spec.rb\u003c/summary\u003e\r\n\r\n```diff\r\ndiff --git a/spec/features/security/project/public_access_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/security/project/public_access_spec.rb\r\nindex 57d56371719..babcf6dcdb9 100644\r\n--- a/spec/features/security/project/public_access_spec.rb\r\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/security/project/public_access_spec.rb\r\n@@ -16,6 +16,7 @@ describe \"Public Project Access\" do\r\n     subject { project_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -30,6 +31,7 @@ describe \"Public Project Access\" do\r\n     subject { project_tree_path(project, project.repository.root_ref) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -44,6 +46,7 @@ describe \"Public Project Access\" do\r\n     subject { project_commits_path(project, project.repository.root_ref, limit: 1) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -58,6 +61,7 @@ describe \"Public Project Access\" do\r\n     subject { project_commit_path(project, project.repository.commit) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -72,6 +76,7 @@ describe \"Public Project Access\" do\r\n     subject { project_compare_index_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -86,6 +91,7 @@ describe \"Public Project Access\" do\r\n     subject { project_settings_members_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -128,6 +134,7 @@ describe \"Public Project Access\" do\r\n     subject { project_pipelines_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -143,6 +150,7 @@ describe \"Public Project Access\" do\r\n     subject { project_pipeline_path(project, pipeline) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -162,6 +170,7 @@ describe \"Public Project Access\" do\r\n       end\r\n \r\n       it { is_expected.to be_allowed_for(:admin) }\r\n+      it { is_expected.to be_allowed_for(:auditor) }\r\n       it { is_expected.to be_allowed_for(:owner).of(project) }\r\n       it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n       it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -178,6 +187,7 @@ describe \"Public Project Access\" do\r\n       end\r\n \r\n       it { is_expected.to be_allowed_for(:admin) }\r\n+      it { is_expected.to be_allowed_for(:auditor) }\r\n       it { is_expected.to be_allowed_for(:owner).of(project) }\r\n       it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n       it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -200,6 +210,7 @@ describe \"Public Project Access\" do\r\n       end\r\n \r\n       it { is_expected.to be_allowed_for(:admin) }\r\n+      it { is_expected.to be_allowed_for(:auditor) }\r\n       it { is_expected.to be_allowed_for(:owner).of(project) }\r\n       it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n       it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -216,6 +227,7 @@ describe \"Public Project Access\" do\r\n       end\r\n \r\n       it { is_expected.to be_allowed_for(:admin) }\r\n+      it { is_expected.to be_allowed_for(:auditor) }\r\n       it { is_expected.to be_allowed_for(:owner).of(project) }\r\n       it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n       it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -283,6 +295,7 @@ describe \"Public Project Access\" do\r\n     subject { project_environments_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -298,6 +311,7 @@ describe \"Public Project Access\" do\r\n     subject { project_environment_path(project, environment) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -327,6 +341,7 @@ describe \"Public Project Access\" do\r\n     subject { new_project_environment_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_denied_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -343,6 +358,7 @@ describe \"Public Project Access\" do\r\n     subject { project_blob_path(project, File.join(commit.id, '.gitignore')) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -356,6 +372,7 @@ describe \"Public Project Access\" do\r\n     subject { edit_project_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_denied_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_denied_for(:developer).of(project) }\r\n@@ -370,6 +387,7 @@ describe \"Public Project Access\" do\r\n     subject { project_deploy_keys_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_denied_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_denied_for(:developer).of(project) }\r\n@@ -384,6 +402,7 @@ describe \"Public Project Access\" do\r\n     subject { project_issues_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -413,6 +432,7 @@ describe \"Public Project Access\" do\r\n     subject { project_snippets_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -427,6 +447,7 @@ describe \"Public Project Access\" do\r\n     subject { new_project_snippet_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_denied_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -441,6 +462,7 @@ describe \"Public Project Access\" do\r\n     subject { project_merge_requests_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -455,6 +477,7 @@ describe \"Public Project Access\" do\r\n     subject { project_new_merge_request_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_denied_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -474,6 +497,7 @@ describe \"Public Project Access\" do\r\n     end\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -493,6 +517,7 @@ describe \"Public Project Access\" do\r\n     end\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n@@ -507,6 +532,7 @@ describe \"Public Project Access\" do\r\n     subject { project_settings_integrations_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_denied_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_denied_for(:developer).of(project) }\r\n@@ -517,6 +543,36 @@ describe \"Public Project Access\" do\r\n     it { is_expected.to be_denied_for(:visitor) }\r\n   end\r\n \r\n+  context \"when license blocks changes\" do\r\n+    before do\r\n+      allow(License).to receive(:block_changes?).and_return(true)\r\n+    end\r\n+\r\n+    describe \"GET /:project_path/issues/new\" do\r\n+      subject { new_project_issue_path(project) }\r\n+\r\n+      it { is_expected.to be_denied_for(:maintainer).of(project) }\r\n+      it { is_expected.to be_denied_for(:reporter).of(project) }\r\n+      it { is_expected.to be_denied_for(:admin) }\r\n+      it { is_expected.to be_denied_for(:guest).of(project) }\r\n+      it { is_expected.to be_denied_for(:user) }\r\n+      it { is_expected.to be_denied_for(:auditor) }\r\n+      it { is_expected.to be_denied_for(:visitor) }\r\n+    end\r\n+\r\n+    describe \"GET /:project_path/merge_requests/new\" do\r\n+      subject { project_new_merge_request_path(project) }\r\n+\r\n+      it { is_expected.to be_denied_for(:maintainer).of(project) }\r\n+      it { is_expected.to be_denied_for(:reporter).of(project) }\r\n+      it { is_expected.to be_denied_for(:admin) }\r\n+      it { is_expected.to be_denied_for(:guest).of(project) }\r\n+      it { is_expected.to be_denied_for(:user) }\r\n+      it { is_expected.to be_denied_for(:auditor) }\r\n+      it { is_expected.to be_denied_for(:visitor) }\r\n+    end\r\n+  end\r\n+\r\n   describe \"GET /:project_path/container_registry\" do\r\n     let(:container_repository) { create(:container_repository) }\r\n \r\n@@ -529,6 +585,7 @@ describe \"Public Project Access\" do\r\n     subject { project_container_registry_index_path(project) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(project) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(project) }\r\n     it { is_expected.to be_allowed_for(:developer).of(project) }\r\n```\r\n\r\n\u003c/details\u003e\r\n","state":"closed","created_at":"2018-06-22T15:17:50.813Z","updated_at":"2019-08-12T15:32:53.329Z","closed_at":"2019-05-10T14:31:44.364Z","closed_by":{"id":128633,"username":"rymai","name":"R√©my Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"},"labels":["Deliverable","Enterprise Edition","Manage [DEPRECATED]","Quality","backend","single codebase","test"],"milestone":{"id":693518,"iid":33,"group_id":9970,"title":"12.0","description":"https://about.gitlab.com/releases/2019/06/22/gitlab-12-0-released/","state":"closed","created_at":"2018-10-30T16:47:37.975Z","updated_at":"2020-04-22T19:51:03.475Z","due_date":"2019-06-22","start_date":"2019-05-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/33"},"assignees":[{"id":273486,"username":"jameslopez","name":"James Lopez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/273486/avatar.png","web_url":"https://gitlab.com/jameslopez"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":273486,"username":"jameslopez","name":"James Lopez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/273486/avatar.png","web_url":"https://gitlab.com/jameslopez"},"user_notes_count":0,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6577","time_stats":{"time_estimate":28800,"total_time_spent":0,"human_time_estimate":"8h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6577","notes":"https://gitlab.com/api/v4/projects/278964/issues/6577/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6577/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6577","relative":"#6577","full":"gitlab-org/gitlab#6577"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12252136,"iid":6576,"project_id":278964,"title":"Extract EE specific files/lines for spec/features/security/group","description":"We have the following files containing EE specific code. We should move them to ee/\r\n\u003cdetails\u003e\r\n\u003csummary\u003espec/features/security/group/internal_access_spec.rb\u003c/summary\u003e\r\n\r\n```diff\r\ndiff --git a/spec/features/security/group/internal_access_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/security/group/internal_access_spec.rb\r\nindex 51b32ba6c03..2e4eb7ff94c 100644\r\n--- a/spec/features/security/group/internal_access_spec.rb\r\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/security/group/internal_access_spec.rb\r\n@@ -22,6 +22,7 @@ describe 'Internal Group access' do\r\n     subject { group_path(group) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(group) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(group) }\r\n     it { is_expected.to be_allowed_for(:developer).of(group) }\r\n@@ -37,6 +38,7 @@ describe 'Internal Group access' do\r\n     subject { issues_group_path(group) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(group) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(group) }\r\n     it { is_expected.to be_allowed_for(:developer).of(group) }\r\n@@ -53,6 +55,7 @@ describe 'Internal Group access' do\r\n     subject { merge_requests_group_path(group) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(group) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(group) }\r\n     it { is_expected.to be_allowed_for(:developer).of(group) }\r\n@@ -68,6 +71,7 @@ describe 'Internal Group access' do\r\n     subject { group_group_members_path(group) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(group) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(group) }\r\n     it { is_expected.to be_allowed_for(:developer).of(group) }\r\n@@ -83,6 +87,7 @@ describe 'Internal Group access' do\r\n     subject { edit_group_path(group) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_denied_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(group) }\r\n     it { is_expected.to be_denied_for(:maintainer).of(group) }\r\n     it { is_expected.to be_denied_for(:developer).of(group) }\r\n```\r\n\r\n\u003c/details\u003e\r\n\u003cdetails\u003e\r\n\u003csummary\u003espec/features/security/group/private_access_spec.rb\u003c/summary\u003e\r\n\r\n```diff\r\ndiff --git a/spec/features/security/group/private_access_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/security/group/private_access_spec.rb\r\nindex 4705cd12d23..c51132ae939 100644\r\n--- a/spec/features/security/group/private_access_spec.rb\r\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/security/group/private_access_spec.rb\r\n@@ -22,6 +22,7 @@ describe 'Private Group access' do\r\n     subject { group_path(group) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(group) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(group) }\r\n     it { is_expected.to be_allowed_for(:developer).of(group) }\r\n@@ -37,6 +38,7 @@ describe 'Private Group access' do\r\n     subject { issues_group_path(group) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(group) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(group) }\r\n     it { is_expected.to be_allowed_for(:developer).of(group) }\r\n@@ -53,6 +55,7 @@ describe 'Private Group access' do\r\n     subject { merge_requests_group_path(group) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(group) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(group) }\r\n     it { is_expected.to be_allowed_for(:developer).of(group) }\r\n@@ -68,6 +71,7 @@ describe 'Private Group access' do\r\n     subject { group_group_members_path(group) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(group) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(group) }\r\n     it { is_expected.to be_allowed_for(:developer).of(group) }\r\n@@ -83,6 +87,7 @@ describe 'Private Group access' do\r\n     subject { edit_group_path(group) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_denied_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(group) }\r\n     it { is_expected.to be_denied_for(:maintainer).of(group) }\r\n     it { is_expected.to be_denied_for(:developer).of(group) }\r\n```\r\n\r\n\u003c/details\u003e\r\n\u003cdetails\u003e\r\n\u003csummary\u003espec/features/security/group/public_access_spec.rb\u003c/summary\u003e\r\n\r\n```diff\r\ndiff --git a/spec/features/security/group/public_access_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/security/group/public_access_spec.rb\r\nindex 3a53c3c2bc7..ab9e5b63ca8 100644\r\n--- a/spec/features/security/group/public_access_spec.rb\r\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/security/group/public_access_spec.rb\r\n@@ -22,6 +22,7 @@ describe 'Public Group access' do\r\n     subject { group_path(group) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(group) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(group) }\r\n     it { is_expected.to be_allowed_for(:developer).of(group) }\r\n@@ -37,6 +38,7 @@ describe 'Public Group access' do\r\n     subject { issues_group_path(group) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(group) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(group) }\r\n     it { is_expected.to be_allowed_for(:developer).of(group) }\r\n@@ -53,6 +55,7 @@ describe 'Public Group access' do\r\n     subject { merge_requests_group_path(group) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(group) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(group) }\r\n     it { is_expected.to be_allowed_for(:developer).of(group) }\r\n@@ -68,6 +71,7 @@ describe 'Public Group access' do\r\n     subject { group_group_members_path(group) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_allowed_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(group) }\r\n     it { is_expected.to be_allowed_for(:maintainer).of(group) }\r\n     it { is_expected.to be_allowed_for(:developer).of(group) }\r\n@@ -83,6 +87,7 @@ describe 'Public Group access' do\r\n     subject { edit_group_path(group) }\r\n \r\n     it { is_expected.to be_allowed_for(:admin) }\r\n+    it { is_expected.to be_denied_for(:auditor) }\r\n     it { is_expected.to be_allowed_for(:owner).of(group) }\r\n     it { is_expected.to be_denied_for(:maintainer).of(group) }\r\n     it { is_expected.to be_denied_for(:developer).of(group) }\r\n```\r\n\r\n\u003c/details\u003e\r\n","state":"closed","created_at":"2018-06-22T15:16:16.687Z","updated_at":"2019-08-12T15:32:53.855Z","closed_at":"2019-05-17T15:16:58.387Z","closed_by":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"labels":["Deliverable","Enterprise Edition","Manage [DEPRECATED]","Quality","backend","single codebase","test"],"milestone":{"id":693518,"iid":33,"group_id":9970,"title":"12.0","description":"https://about.gitlab.com/releases/2019/06/22/gitlab-12-0-released/","state":"closed","created_at":"2018-10-30T16:47:37.975Z","updated_at":"2020-04-22T19:51:03.475Z","due_date":"2019-06-22","start_date":"2019-05-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/33"},"assignees":[{"id":273486,"username":"jameslopez","name":"James Lopez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/273486/avatar.png","web_url":"https://gitlab.com/jameslopez"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":273486,"username":"jameslopez","name":"James Lopez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/273486/avatar.png","web_url":"https://gitlab.com/jameslopez"},"user_notes_count":0,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6576","time_stats":{"time_estimate":28800,"total_time_spent":0,"human_time_estimate":"8h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6576","notes":"https://gitlab.com/api/v4/projects/278964/issues/6576/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6576/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6576","relative":"#6576","full":"gitlab-org/gitlab#6576"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12252118,"iid":6575,"project_id":278964,"title":"Extract EE specific files/lines for spec/features/security","description":"We have the following files containing EE specific code. We should move them to ee/\r\n\r\n\u003cdetails\u003e\r\n\u003csummary\u003espec/features/security/admin_access_spec.rb\u003c/summary\u003e\r\n\r\n```diff\r\ndiff --git a/spec/features/security/admin_access_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/security/admin_access_spec.rb\r\nindex ff679034a36..e7d3490eafa 100644\r\n--- a/spec/features/security/admin_access_spec.rb\r\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/security/admin_access_spec.rb\r\n@@ -9,6 +9,7 @@ describe \"Admin::Projects\" do\r\n     it { is_expected.to be_allowed_for :admin }\r\n     it { is_expected.to be_denied_for :user }\r\n     it { is_expected.to be_denied_for :visitor }\r\n+    it { is_expected.to be_denied_for :auditor }\r\n   end\r\n \r\n   describe \"GET /admin/users\" do\r\n@@ -17,6 +18,7 @@ describe \"Admin::Projects\" do\r\n     it { is_expected.to be_allowed_for :admin }\r\n     it { is_expected.to be_denied_for :user }\r\n     it { is_expected.to be_denied_for :visitor }\r\n+    it { is_expected.to be_denied_for :auditor }\r\n   end\r\n \r\n   describe \"GET /admin/hooks\" do\r\n@@ -25,5 +27,6 @@ describe \"Admin::Projects\" do\r\n     it { is_expected.to be_allowed_for :admin }\r\n     it { is_expected.to be_denied_for :user }\r\n     it { is_expected.to be_denied_for :visitor }\r\n+    it { is_expected.to be_denied_for :auditor }\r\n   end\r\n end\r\n```\r\n\r\n\u003c/details\u003e\r\n\u003cdetails\u003e\r\n\u003csummary\u003espec/features/security/dashboard_access_spec.rb\u003c/summary\u003e\r\n\r\n```diff\r\ndiff --git a/spec/features/security/dashboard_access_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/security/dashboard_access_spec.rb\r\nindex 07cddc92ac4..7a7775eeabd 100644\r\n--- a/spec/features/security/dashboard_access_spec.rb\r\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/security/dashboard_access_spec.rb\r\n@@ -8,6 +8,7 @@ describe \"Dashboard access\" do\r\n \r\n     it { is_expected.to be_allowed_for :admin }\r\n     it { is_expected.to be_allowed_for :user }\r\n+    it { is_expected.to be_allowed_for :auditor }\r\n     it { is_expected.to be_denied_for :visitor }\r\n   end\r\n \r\n@@ -16,6 +17,7 @@ describe \"Dashboard access\" do\r\n \r\n     it { is_expected.to be_allowed_for :admin }\r\n     it { is_expected.to be_allowed_for :user }\r\n+    it { is_expected.to be_allowed_for :auditor }\r\n     it { is_expected.to be_denied_for :visitor }\r\n   end\r\n \r\n@@ -24,6 +26,7 @@ describe \"Dashboard access\" do\r\n \r\n     it { is_expected.to be_allowed_for :admin }\r\n     it { is_expected.to be_allowed_for :user }\r\n+    it { is_expected.to be_allowed_for :auditor }\r\n     it { is_expected.to be_denied_for :visitor }\r\n   end\r\n \r\n@@ -32,6 +35,7 @@ describe \"Dashboard access\" do\r\n \r\n     it { is_expected.to be_allowed_for :admin }\r\n     it { is_expected.to be_allowed_for :user }\r\n+    it { is_expected.to be_allowed_for :auditor }\r\n     it { is_expected.to be_denied_for :visitor }\r\n   end\r\n \r\n@@ -40,18 +44,21 @@ describe \"Dashboard access\" do\r\n \r\n     it { is_expected.to be_allowed_for :admin }\r\n     it { is_expected.to be_allowed_for :user }\r\n+    it { is_expected.to be_allowed_for :auditor }\r\n     it { is_expected.to be_allowed_for :visitor }\r\n   end\r\n \r\n   describe \"GET /projects/new\" do\r\n     it { expect(new_project_path).to be_allowed_for :admin }\r\n     it { expect(new_project_path).to be_allowed_for :user }\r\n+    it { expect(new_project_path).to be_allowed_for :auditor }\r\n     it { expect(new_project_path).to be_denied_for :visitor }\r\n   end\r\n \r\n   describe \"GET /groups/new\" do\r\n     it { expect(new_group_path).to be_allowed_for :admin }\r\n     it { expect(new_group_path).to be_allowed_for :user }\r\n+    it { expect(new_group_path).to be_allowed_for :auditor }\r\n     it { expect(new_group_path).to be_denied_for :visitor }\r\n   end\r\n \r\n@@ -60,6 +67,7 @@ describe \"Dashboard access\" do\r\n \r\n     it { is_expected.to be_allowed_for :admin }\r\n     it { is_expected.to be_allowed_for :user }\r\n+    it { is_expected.to be_allowed_for :auditor }\r\n     it { is_expected.to be_denied_for :visitor }\r\n   end\r\n end\r\n```\r\n\r\n\u003c/details\u003e\r\n","state":"closed","created_at":"2018-06-22T15:14:40.630Z","updated_at":"2019-08-12T15:32:53.873Z","closed_at":"2019-05-30T14:41:22.833Z","closed_by":{"id":209240,"username":"yorickpeterse","name":"Yorick Peterse","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/209240/avatar.png","web_url":"https://gitlab.com/yorickpeterse"},"labels":["Deliverable","Enterprise Edition","Manage [DEPRECATED]","Quality","backend","single codebase","test"],"milestone":{"id":693518,"iid":33,"group_id":9970,"title":"12.0","description":"https://about.gitlab.com/releases/2019/06/22/gitlab-12-0-released/","state":"closed","created_at":"2018-10-30T16:47:37.975Z","updated_at":"2020-04-22T19:51:03.475Z","due_date":"2019-06-22","start_date":"2019-05-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/33"},"assignees":[{"id":2982208,"username":"mksionek","name":"Gosia Ksionek","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2982208/avatar.png","web_url":"https://gitlab.com/mksionek"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":2982208,"username":"mksionek","name":"Gosia Ksionek","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2982208/avatar.png","web_url":"https://gitlab.com/mksionek"},"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6575","time_stats":{"time_estimate":28800,"total_time_spent":0,"human_time_estimate":"8h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6575","notes":"https://gitlab.com/api/v4/projects/278964/issues/6575/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6575/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6575","relative":"#6575","full":"gitlab-org/gitlab#6575"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12252086,"iid":6574,"project_id":278964,"title":"Extract EE specific files/lines for spec/features/merge_request","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003espec/features/merge_request/user_creates_merge_request_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/features/merge_request/user_creates_merge_request_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/merge_request/user_creates_merge_request_spec.rb\nindex ea2bb1503bb..061a4c4f633 100644\n--- a/spec/features/merge_request/user_creates_merge_request_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/merge_request/user_creates_merge_request_spec.rb\n@@ -3,19 +3,33 @@ require \"spec_helper\"\n describe \"User creates a merge request\", :js do\n   include ProjectForksHelper\n \n+  let(:approver) { create(:user) }\n+  let(:project) do\n+    create(:project,\n+      :repository,\n+      approvals_before_merge: 1,\n+      merge_requests_template: template_text)\n+  end\n+  let(:template_text) { \"This merge request should contain the following.\" }\n   let(:title) { \"Some feature\" }\n-  let(:project) { create(:project, :repository) }\n   let(:user) { create(:user) }\n+  let(:user2) { create(:user) }\n \n   before do\n     stub_feature_flags(approval_rules: false)\n \n     project.add_maintainer(user)\n+    project.add_maintainer(user2)\n+    project.add_maintainer(approver)\n     sign_in(user)\n+\n+    project.approvers.create(user_id: approver.id)\n+\n+    visit(project_new_merge_request_path(project))\n   end\n \n   it \"creates a merge request\" do\n-    visit(project_new_merge_request_path(project))\n+    allow_any_instance_of(Gitlab::AuthorityAnalyzer).to receive(:calculate).and_return([user2])\n \n     find(\".js-source-branch\").click\n     click_link(\"fix\")\n@@ -25,12 +39,38 @@ describe \"User creates a merge request\", :js do\n \n     click_button(\"Compare branches\")\n \n+    expect(find_field(\"merge_request_description\").value).to eq(template_text)\n+\n+    # Approvers\n+    page.within(\"ul .unsaved-approvers\") do\n+      expect(page).to have_content(approver.name)\n+    end\n+\n+    page.within(\".suggested-approvers\") do\n+      expect(page).to have_content(user2.name)\n+    end\n+\n+    click_link(user2.name)\n+\n+    page.within(\"ul.approver-list\") do\n+      expect(page).to have_content(user2.name)\n+    end\n+    # End of approvers\n+\n     fill_in(\"Title\", with: title)\n     click_button(\"Submit merge request\")\n \n     page.within(\".merge-request\") do\n       expect(page).to have_content(title)\n     end\n+\n+    page.within(\".js-issuable-actions\") do\n+      click_link(\"Edit\", match: :first)\n+    end\n+\n+    page.within(\"ul.approver-list\") do\n+      expect(page).to have_content(user2.name)\n+    end\n   end\n \n   context \"to a forked project\" do\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/features/merge_request/user_sees_closing_issues_message_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/features/merge_request/user_sees_closing_issues_message_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/merge_request/user_sees_closing_issues_message_spec.rb\nindex d7c784b14c5..4bea8656033 100644\n--- a/spec/features/merge_request/user_sees_closing_issues_message_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/merge_request/user_sees_closing_issues_message_spec.rb\n@@ -73,4 +73,18 @@ describe 'Merge request \u003e User sees closing issues message', :js do\n       expect(page).to have_content(\"Mentions #{issue_2.to_reference}\")\n     end\n   end\n+\n+  context 'approvals are enabled while closing issues', :js do\n+    before do\n+      project.add_developer(user)\n+    end\n+\n+    let(:project) { create(:project, :public, :repository, approvals_before_merge: 1) }\n+    let(:merge_request_description) { \"Description\\n\\nclosing #{issue_1.to_reference}, #{issue_2.to_reference}\" }\n+\n+    it 'displays closing issue message exactly one time' do\n+      wait_for_requests\n+      expect(page).to have_content(\"Closes #{issue_1.to_reference} and #{issue_2.to_reference}\", count: 1)\n+    end\n+  end\n end\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/features/merge_request/user_selects_branches_for_new_mr_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/features/merge_request/user_selects_branches_for_new_mr_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/merge_request/user_selects_branches_for_new_mr_spec.rb\nindex ae41cf90576..63c083328e3 100644\n--- a/spec/features/merge_request/user_selects_branches_for_new_mr_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/merge_request/user_selects_branches_for_new_mr_spec.rb\n@@ -86,6 +86,27 @@ describe 'Merge request \u003e User selects branches for new MR', :js do\n     expect(target_items.count).to be \u003e 1\n   end\n \n+  context 'when approvals are enabled for the target project' do\n+    before do\n+      project.update(approvals_before_merge: 1)\n+\n+      visit project_new_merge_request_path(project, merge_request: { target_branch: 'master', source_branch: 'feature_conflict' })\n+    end\n+\n+    it 'shows approval settings' do\n+      expect(page).to have_content('Approvers')\n+    end\n+\n+    context 'saving the MR' do\n+      it 'shows the saved MR' do\n+        fill_in 'merge_request_title', with: 'Test'\n+        click_button 'Submit merge request'\n+\n+        expect(page).to have_link('Close merge request')\n+      end\n+    end\n+  end\n+\n   context 'when target project cannot be viewed by the current user' do\n     it 'does not leak the private project name \u0026 namespace' do\n       private_project = create(:project, :private, :repository)\n```\n\n\u003c/details\u003e","state":"closed","created_at":"2018-06-22T15:12:16.637Z","updated_at":"2022-05-19T18:08:54.182Z","closed_at":"2019-04-09T11:49:45.285Z","closed_by":{"id":128633,"username":"rymai","name":"R√©my Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"},"labels":["Enterprise Edition","Quality","backend","backstage [DEPRECATED]","single codebase","test"],"milestone":{"id":655280,"iid":28,"group_id":9970,"title":"11.11","description":"","state":"closed","created_at":"2018-09-21T19:08:37.027Z","updated_at":"2019-06-10T14:39:00.009Z","due_date":"2019-05-22","start_date":"2019-04-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/28"},"assignees":[{"id":2880930,"username":"engwan","name":"Heinrich Lee Yu","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2880930/avatar.png","web_url":"https://gitlab.com/engwan"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":2880930,"username":"engwan","name":"Heinrich Lee Yu","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2880930/avatar.png","web_url":"https://gitlab.com/engwan"},"user_notes_count":0,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6574","time_stats":{"time_estimate":28800,"total_time_spent":0,"human_time_estimate":"8h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6574","notes":"https://gitlab.com/api/v4/projects/278964/issues/6574/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6574/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6574","relative":"#6574","full":"gitlab-org/gitlab#6574"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12252026,"iid":6573,"project_id":278964,"title":"Extract EE specific files/lines for spec/features/boards","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003espec/features/boards/add_issues_modal_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/features/boards/add_issues_modal_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/boards/add_issues_modal_spec.rb\nindex 030993462b5..de26fde6e3d 100644\n--- a/spec/features/boards/add_issues_modal_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/boards/add_issues_modal_spec.rb\n@@ -34,6 +34,14 @@ describe 'Issue Boards add issue modal', :js do\n     end\n   end\n \n+  it 'shows weight filter' do\n+    click_button('Add issues')\n+    wait_for_requests\n+    find('.add-issues-search .filtered-search').click\n+\n+    expect(page.find('.filter-dropdown')).to have_content 'weight'\n+  end\n+\n   context 'modal interaction' do\n     it 'opens modal' do\n       click_button('Add issues')\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/features/boards/boards_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/features/boards/boards_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/boards/boards_spec.rb\nindex ea69ec0319b..d12fd34d9d9 100644\n--- a/spec/features/boards/boards_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/boards/boards_spec.rb\n@@ -6,7 +6,9 @@ describe 'Issue Boards', :js do\n \n   let(:group) { create(:group, :nested) }\n   let(:project) { create(:project, :public, namespace: group) }\n-  let(:board)   { create(:board, project: project) }\n+  let(:milestone) { create(:milestone, title: \"v2.2\", project: project) }\n+  let!(:board) { create(:board, project: project) }\n+  let!(:board_with_milestone) { create(:board, project: project, milestone: milestone) }\n   let(:user)    { create(:user) }\n   let!(:user2)  { create(:user) }\n \n@@ -21,7 +23,7 @@ describe 'Issue Boards', :js do\n \n   context 'no lists' do\n     before do\n-      visit project_board_path(project, board)\n+      visit project_boards_path(project)\n       wait_for_requests\n       expect(page).to have_selector('.board', count: 3)\n     end\n@@ -87,7 +89,7 @@ describe 'Issue Boards', :js do\n     let!(:issue10) { create(:labeled_issue, project: project, title: 'issue +', description: 'A+ great issue', labels: [a_plus]) }\n \n     before do\n-      visit project_board_path(project, board)\n+      visit project_boards_path(project)\n \n       wait_for_requests\n \n@@ -166,7 +168,7 @@ describe 'Issue Boards', :js do\n         create(:labeled_issue, project: project, labels: [planning])\n       end\n \n-      visit project_board_path(project, board)\n+      visit project_boards_path(project)\n       wait_for_requests\n \n       page.within(find('.board:nth-child(2)')) do\n@@ -526,9 +528,25 @@ describe 'Issue Boards', :js do\n     end\n   end\n \n+  context 'locked milestone' do\n+    before do\n+      visit project_board_path(project, board_with_milestone)\n+      wait_for_requests\n+    end\n+\n+    it 'should not have remove button' do\n+      expect(page).to have_selector('.js-visual-token .remove-token', count: 0)\n+    end\n+\n+    it 'should not be able to be backspaced' do\n+      find('.input-token .filtered-search').native.send_key(:backspace)\n+      expect(page).to have_selector('.js-visual-token', count: 1)\n+    end\n+  end\n+\n   context 'keyboard shortcuts' do\n     before do\n-      visit project_board_path(project, board)\n+      visit project_boards_path(project)\n       wait_for_requests\n     end\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/features/boards/sidebar_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/features/boards/sidebar_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/boards/sidebar_spec.rb\nindex ee38e756f9e..99351e28a6a 100644\n--- a/spec/features/boards/sidebar_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/boards/sidebar_spec.rb\n@@ -22,6 +22,7 @@ describe 'Issue Boards', :js do\n   end\n \n   before do\n+    stub_licensed_features(multiple_issue_assignees: false)\n     project.add_maintainer(user)\n \n     sign_in(user)\n```\n\n\u003c/details\u003e\n\n\nCorresponding CE merge request: https://gitlab.com/gitlab-org/gitlab-ce/merge_requests/27110","state":"closed","created_at":"2018-06-22T15:09:06.355Z","updated_at":"2022-05-19T17:26:55.289Z","closed_at":"2019-04-09T10:17:53.659Z","closed_by":{"id":15139,"username":"rspeicher","name":"Robert Speicher","state":"active","avatar_url":"https://secure.gravatar.com/avatar/73c8253932541a7b5cbc5d79493f2bea?s=80\u0026d=identicon","web_url":"https://gitlab.com/rspeicher"},"labels":["Enterprise Edition","Quality","backend","backstage [DEPRECATED]","devops::plan","single codebase","test"],"milestone":{"id":655280,"iid":28,"group_id":9970,"title":"11.11","description":"","state":"closed","created_at":"2018-09-21T19:08:37.027Z","updated_at":"2019-06-10T14:39:00.009Z","due_date":"2019-05-22","start_date":"2019-04-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/28"},"assignees":[{"id":3717078,"username":"cablett","name":"charlie ablett","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3717078/avatar.png","web_url":"https://gitlab.com/cablett"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":3717078,"username":"cablett","name":"charlie ablett","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3717078/avatar.png","web_url":"https://gitlab.com/cablett"},"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6573","time_stats":{"time_estimate":28800,"total_time_spent":0,"human_time_estimate":"8h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6573","notes":"https://gitlab.com/api/v4/projects/278964/issues/6573/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6573/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6573","relative":"#6573","full":"gitlab-org/gitlab#6573"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12251903,"iid":6572,"project_id":278964,"title":"Extract EE specific files/lines for spec/features/admin","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003espec/features/admin/admin_settings_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/features/admin/admin_settings_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/admin/admin_settings_spec.rb\nindex 04f39b807d7..aafeb1817cf 100644\n--- a/spec/features/admin/admin_settings_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/admin/admin_settings_spec.rb\n@@ -192,6 +192,31 @@ describe 'Admin updates settings' do\n     end\n   end\n \n+  describe 'LDAP settings' do\n+    context 'with LDAP enabled' do\n+      it 'Change allow group owners to manage ldap' do\n+        allow(Gitlab::Auth::LDAP::Config).to receive(:enabled?).and_return(true)\n+        visit admin_application_settings_path\n+\n+        page.within('.as-visibility-access') do\n+          find('#application_setting_allow_group_owners_to_manage_ldap').set(false)\n+          click_button 'Save'\n+        end\n+\n+        expect(page).to have_content('Application settings saved successfully')\n+        expect(find('#application_setting_allow_group_owners_to_manage_ldap')).not_to be_checked\n+      end\n+    end\n+\n+    context 'with LDAP disabled' do\n+      it 'Does not show option to allow group owners to manage ldap' do\n+        visit admin_application_settings_path\n+\n+        expect(page).not_to have_css('#application_setting_allow_group_owners_to_manage_ldap')\n+      end\n+    end\n+  end\n+\n   context 'Integrations page' do\n     before do\n       visit integrations_admin_application_settings_path\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/features/admin/admin_users_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/features/admin/admin_users_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/admin/admin_users_spec.rb\nindex b1c6f308bc6..92dd3e3721a 100644\n--- a/spec/features/admin/admin_users_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/admin/admin_users_spec.rb\n@@ -422,6 +422,40 @@ describe \"Admin::Users\" do\n         end\n       end\n     end\n+\n+    describe 'Shared runners quota status' do\n+      before do\n+        user.namespace.update(shared_runners_minutes_limit: 500)\n+      end\n+\n+      context 'with projects with shared runners enabled' do\n+        before do\n+          create(:project, namespace: user.namespace, shared_runners_enabled: true)\n+        end\n+\n+        it 'shows quota' do\n+          visit admin_users_path\n+\n+          click_link user.name\n+\n+          expect(page).to have_content('Pipeline minutes quota: 0 / 500')\n+        end\n+      end\n+\n+      context 'without projects with shared runners enabled' do\n+        before do\n+          create(:project, namespace: user.namespace, shared_runners_enabled: false)\n+        end\n+\n+        it 'does not show quota' do\n+          visit admin_users_path\n+\n+          click_link user.name\n+\n+          expect(page).not_to have_content('Pipeline minutes quota:')\n+        end\n+      end\n+    end\n   end\n \n   describe \"GET /admin/users/:id/edit\" do\n@@ -458,6 +492,21 @@ describe \"Admin::Users\" do\n       end\n     end\n \n+    describe \"Update user account type\" do\n+      before do\n+        allow_any_instance_of(AuditorUserHelper).to receive(:license_allows_auditor_user?).and_return(true)\n+        choose \"user_access_level_auditor\"\n+        click_button \"Save changes\"\n+      end\n+\n+      it \"changes account type to be auditor\" do\n+        user.reload\n+\n+        expect(user).not_to be_admin\n+        expect(user).to be_auditor\n+      end\n+    end\n+\n     describe 'update username to non ascii char' do\n       it do\n         fill_in 'user_username', with: '\\u3042\\u3044'\n@@ -470,6 +519,19 @@ describe \"Admin::Users\" do\n         expect(page).to have_selector(%(form[action=\"/admin/users/#{user.username}\"]))\n       end\n     end\n+\n+    describe 'Update shared runners quota' do\n+      let!(:project) { create(:project, namespace: user.namespace, shared_runners_enabled: true) }\n+\n+      before do\n+        fill_in \"user_namespace_attributes_shared_runners_minutes_limit\", with: \"500\"\n+        click_button \"Save changes\"\n+      end\n+\n+      it \"shows page with new data\" do\n+        expect(page).to have_content('Pipeline minutes quota: 0 / 500')\n+      end\n+    end\n   end\n \n   describe \"GET /admin/users/:id/projects\" do\n```\n\n\u003c/details\u003e\n","state":"closed","created_at":"2018-06-22T15:02:10.218Z","updated_at":"2019-08-12T15:32:53.992Z","closed_at":"2019-05-27T11:19:32.851Z","closed_by":{"id":209240,"username":"yorickpeterse","name":"Yorick Peterse","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/209240/avatar.png","web_url":"https://gitlab.com/yorickpeterse"},"labels":["Deliverable","Enterprise Edition","Manage [DEPRECATED]","Quality","backend","single codebase","test"],"milestone":{"id":693518,"iid":33,"group_id":9970,"title":"12.0","description":"https://about.gitlab.com/releases/2019/06/22/gitlab-12-0-released/","state":"closed","created_at":"2018-10-30T16:47:37.975Z","updated_at":"2020-04-22T19:51:03.475Z","due_date":"2019-06-22","start_date":"2019-05-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/33"},"assignees":[{"id":2982208,"username":"mksionek","name":"Gosia Ksionek","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2982208/avatar.png","web_url":"https://gitlab.com/mksionek"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":2982208,"username":"mksionek","name":"Gosia Ksionek","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2982208/avatar.png","web_url":"https://gitlab.com/mksionek"},"user_notes_count":0,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6572","time_stats":{"time_estimate":28800,"total_time_spent":0,"human_time_estimate":"8h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6572","notes":"https://gitlab.com/api/v4/projects/278964/issues/6572/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6572/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6572","relative":"#6572","full":"gitlab-org/gitlab#6572"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12251796,"iid":6571,"project_id":278964,"title":"Extract EE specific files/lines for spec/features/issues_spec.rb","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003espec/features/issues_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/features/issues_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/issues_spec.rb\nindex 406e80e91aa..a0e7f3f1593 100644\n--- a/spec/features/issues_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/issues_spec.rb\n@@ -57,9 +57,9 @@ describe 'Issues' do\n     describe 'Edit issue' do\n       let!(:issue) do\n         create(:issue,\n-               author: user,\n-               assignees: [user],\n-               project: project)\n+              author: user,\n+              assignees: [user],\n+              project: project)\n       end\n \n       before do\n@@ -75,9 +75,9 @@ describe 'Issues' do\n     describe 'Editing issue assignee' do\n       let!(:issue) do\n         create(:issue,\n-               author: user,\n-               assignees: [user],\n-               project: project)\n+              author: user,\n+              assignees: [user],\n+              project: project)\n       end\n \n       it 'allows user to select unassigned', :js do\n@@ -187,16 +187,27 @@ describe 'Issues' do\n         expect(page).to have_content 'foobar'\n         expect(page.all('.no-comments').first.text).to eq \"0\"\n       end\n+\n+      it 'shows weight on issue row' do\n+        create(:issue, author: user, project: project, weight: 2)\n+\n+        visit project_issues_path(project)\n+\n+        page.within(first('.issuable-info')) do\n+          expect(page).to have_selector('.issue-weight-icon')\n+          expect(page).to have_content(2)\n+        end\n+      end\n     end\n \n     describe 'Filter issue' do\n       before do\n         %w(foobar barbaz gitlab).each do |title|\n           create(:issue,\n-                 author: user,\n-                 assignees: [user],\n-                 project: project,\n-                 title: title)\n+                author: user,\n+                assignees: [user],\n+                project: project,\n+                title: title)\n         end\n \n         @issue = Issue.find_by(title: 'foobar')\n@@ -503,6 +514,8 @@ describe 'Issues' do\n             click_link 'Edit'\n             click_link user.name\n \n+            find('.dropdown-menu-toggle').click\n+\n             page.within '.value .author' do\n               expect(page).to have_content user.name\n             end\n@@ -510,6 +523,8 @@ describe 'Issues' do\n             click_link 'Edit'\n             click_link user.name\n \n+            find('.dropdown-menu-toggle').click\n+\n             page.within '.value .assign-yourself' do\n               expect(page).to have_content \"No assignee\"\n             end\n@@ -534,6 +549,27 @@ describe 'Issues' do\n       end\n     end\n \n+    describe 'update weight from issue#show', :js do\n+      let!(:issue) { create(:issue, project: project) }\n+\n+      before do\n+        visit project_issue_path(project, issue)\n+      end\n+\n+      it 'allows user to update to a weight' do\n+        page.within('.weight') do\n+          expect(page).to have_content \"None\"\n+          click_link 'Edit'\n+\n+          find('.block.weight input').send_keys 1, :enter\n+\n+          page.within('.value') do\n+            expect(page).to have_content \"1\"\n+          end\n+        end\n+      end\n+    end\n+\n     describe 'update milestone from issue#show' do\n       let!(:issue) { create(:issue, project: project, author: user) }\n       let!(:milestone) { create(:milestone, project: project) }\n```\n\n\u003c/details\u003e","state":"closed","created_at":"2018-06-22T14:56:37.208Z","updated_at":"2022-05-19T17:56:22.148Z","closed_at":"2019-03-20T12:40:13.361Z","closed_by":{"id":128633,"username":"rymai","name":"R√©my Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"},"labels":["Enterprise Edition","Quality","[deprecated] Accepting merge requests","backend","backstage [DEPRECATED]","devops::plan","single codebase","test"],"milestone":{"id":655279,"iid":27,"group_id":9970,"title":"11.10","description":"","state":"closed","created_at":"2018-09-21T19:08:16.261Z","updated_at":"2019-05-21T09:17:49.051Z","due_date":"2019-04-22","start_date":"2019-03-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/27"},"assignees":[{"id":2880930,"username":"engwan","name":"Heinrich Lee Yu","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2880930/avatar.png","web_url":"https://gitlab.com/engwan"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":2880930,"username":"engwan","name":"Heinrich Lee Yu","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2880930/avatar.png","web_url":"https://gitlab.com/engwan"},"user_notes_count":0,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6571","time_stats":{"time_estimate":28800,"total_time_spent":0,"human_time_estimate":"8h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6571","notes":"https://gitlab.com/api/v4/projects/278964/issues/6571/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6571/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6571","relative":"#6571","full":"gitlab-org/gitlab#6571"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12251755,"iid":6570,"project_id":278964,"title":"Extract EE specific files/lines for spec/features/protected_*","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003espec/features/protected_branches_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/features/protected_branches_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/protected_branches_spec.rb\nindex 0aff916ec83..4c68c6620be 100644\n--- a/spec/features/protected_branches_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/protected_branches_spec.rb\n@@ -1,6 +1,8 @@\n require 'spec_helper'\n \n describe 'Protected Branches', :js do\n+  include EE::ProtectedBranchHelpers\n+\n   let(:user) { create(:user) }\n   let(:admin) { create(:admin) }\n   let(:project) { create(:project, :repository) }\n@@ -70,8 +72,9 @@ describe 'Protected Branches', :js do\n     describe \"explicit protected branches\" do\n       it \"allows creating explicit protected branches\" do\n         visit project_protected_branches_path(project)\n-        set_defaults\n         set_protected_branch_name('some-branch')\n+        set_allowed_to('merge')\n+        set_allowed_to('push')\n         click_on \"Protect\"\n \n         within(\".protected-branches-list\") { expect(page).to have_content('some-branch') }\n@@ -84,8 +87,9 @@ describe 'Protected Branches', :js do\n         project.repository.add_branch(admin, 'some-branch', commit.id)\n \n         visit project_protected_branches_path(project)\n-        set_defaults\n         set_protected_branch_name('some-branch')\n+        set_allowed_to('merge')\n+        set_allowed_to('push')\n         click_on \"Protect\"\n \n         within(\".protected-branches-list\") { expect(page).to have_content(commit.id[0..7]) }\n@@ -93,8 +97,9 @@ describe 'Protected Branches', :js do\n \n       it \"displays an error message if the named branch does not exist\" do\n         visit project_protected_branches_path(project)\n-        set_defaults\n         set_protected_branch_name('some-branch')\n+        set_allowed_to('merge')\n+        set_allowed_to('push')\n         click_on \"Protect\"\n \n         within(\".protected-branches-list\") { expect(page).to have_content('branch was deleted') }\n@@ -104,8 +109,9 @@ describe 'Protected Branches', :js do\n     describe \"wildcard protected branches\" do\n       it \"allows creating protected branches with a wildcard\" do\n         visit project_protected_branches_path(project)\n-        set_defaults\n         set_protected_branch_name('*-stable')\n+        set_allowed_to('merge')\n+        set_allowed_to('push')\n         click_on \"Protect\"\n \n         within(\".protected-branches-list\") { expect(page).to have_content('*-stable') }\n@@ -118,8 +124,9 @@ describe 'Protected Branches', :js do\n         project.repository.add_branch(admin, 'staging-stable', 'master')\n \n         visit project_protected_branches_path(project)\n-        set_defaults\n         set_protected_branch_name('*-stable')\n+        set_allowed_to('merge')\n+        set_allowed_to('push')\n         click_on \"Protect\"\n \n         within(\".protected-branches-list\") do\n@@ -135,7 +142,8 @@ describe 'Protected Branches', :js do\n \n         visit project_protected_branches_path(project)\n         set_protected_branch_name('*-stable')\n-        set_defaults\n+        set_allowed_to('merge')\n+        set_allowed_to('push')\n         click_on \"Protect\"\n \n         visit project_protected_branches_path(project)\n@@ -150,7 +158,68 @@ describe 'Protected Branches', :js do\n     end\n \n     describe \"access control\" do\n-      include_examples \"protected branches \u003e access control \u003e CE\"\n+      describe 'with ref permissions for users enabled' do\n+        before do\n+          stub_licensed_features(protected_refs_for_users: true)\n+        end\n+\n+        include_examples \"protected branches \u003e access control \u003e EE\"\n+      end\n+\n+      describe 'with ref permissions for users disabled' do\n+        before do\n+          stub_licensed_features(protected_refs_for_users: false)\n+        end\n+\n+        include_examples \"protected branches \u003e access control \u003e CE\"\n+\n+        context 'with existing access levels' do\n+          let(:protected_branch) { create(:protected_branch, project: project) }\n+\n+          it 'shows users that can push to the branch' do\n+            protected_branch.push_access_levels.new(user: create(:user, name: 'Jane'))\n+              .save!(validate: false)\n+\n+            visit project_settings_repository_path(project)\n+\n+            expect(page).to have_content(\"The following user can also push to this branch: \"\\\n+                                         \"Jane\")\n+          end\n+\n+          it 'shows groups that can push to the branch' do\n+            protected_branch.push_access_levels.new(group: create(:group, name: 'Team Awesome'))\n+              .save!(validate: false)\n+\n+            visit project_settings_repository_path(project)\n+\n+            expect(page).to have_content(\"Members of this group can also push to \"\\\n+                                         \"this branch: Team Awesome\")\n+          end\n+\n+          it 'shows users that can merge into the branch' do\n+            protected_branch.merge_access_levels.new(user: create(:user, name: 'Jane'))\n+              .save!(validate: false)\n+\n+            visit project_settings_repository_path(project)\n+\n+            expect(page).to have_content(\"The following user can also merge into \"\\\n+                                         \"this branch: Jane\")\n+          end\n+\n+          it 'shows groups that have can push to the branch' do\n+            protected_branch.merge_access_levels.new(group: create(:group, name: 'Team Awesome'))\n+              .save!(validate: false)\n+            protected_branch.merge_access_levels.new(group: create(:group, name: 'Team B'))\n+              .save!(validate: false)\n+\n+            visit project_settings_repository_path(project)\n+\n+            expect(page).to have_content(\"Members of these groups can also merge into \"\\\n+                                         \"this branch:\")\n+            expect(page).to have_content(/(Team Awesome|Team B) and (Team Awesome|Team B)/)\n+          end\n+        end\n+      end\n     end\n   end\n \n@@ -159,18 +228,4 @@ describe 'Protected Branches', :js do\n     find(\".dropdown-input-field\").set(branch_name)\n     click_on(\"Create wildcard #{branch_name}\")\n   end\n-\n-  def set_defaults\n-    find(\".js-allowed-to-merge\").click\n-    within('.qa-allowed-to-merge-dropdown') do\n-      expect(first(\"li\")).to have_content(\"Roles\")\n-      find(:link, 'No one').click\n-    end\n-\n-    find(\".js-allowed-to-push\").click\n-    within('.qa-allowed-to-push-dropdown') do\n-      expect(first(\"li\")).to have_content(\"Roles\")\n-      find(:link, 'No one').click\n-    end\n-  end\n end\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/features/protected_tags_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/features/protected_tags_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/protected_tags_spec.rb\nindex c8e92cd1c07..fd29c193566 100644\n--- a/spec/features/protected_tags_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/protected_tags_spec.rb\n@@ -8,6 +8,19 @@ describe 'Protected Tags', :js do\n     sign_in(user)\n   end\n \n+  def set_allowed_to(operation, option = 'Maintainers', form: '.new-protected-tag')\n+    within form do\n+      find(\".js-allowed-to-#{operation}\").click\n+      wait_for_requests\n+\n+      within('.dropdown-content') do\n+        Array(option).each { |opt| click_on(opt) }\n+      end\n+\n+      find(\".js-allowed-to-#{operation}\").click # needed to submit form in some cases\n+    end\n+  end\n+\n   def set_protected_tag_name(tag_name)\n     find(\".js-protected-tag-select\").click\n     find(\".dropdown-input-field\").set(tag_name)\n@@ -19,6 +32,7 @@ describe 'Protected Tags', :js do\n     it \"allows creating explicit protected tags\" do\n       visit project_protected_tags_path(project)\n       set_protected_tag_name('some-tag')\n+      set_allowed_to('create')\n       click_on \"Protect\"\n \n       within(\".protected-tags-list\") { expect(page).to have_content('some-tag') }\n@@ -32,6 +46,7 @@ describe 'Protected Tags', :js do\n \n       visit project_protected_tags_path(project)\n       set_protected_tag_name('some-tag')\n+      set_allowed_to('create')\n       click_on \"Protect\"\n \n       within(\".protected-tags-list\") { expect(page).to have_content(commit.id[0..7]) }\n@@ -40,6 +55,7 @@ describe 'Protected Tags', :js do\n     it \"displays an error message if the named tag does not exist\" do\n       visit project_protected_tags_path(project)\n       set_protected_tag_name('some-tag')\n+      set_allowed_to('create')\n       click_on \"Protect\"\n \n       within(\".protected-tags-list\") { expect(page).to have_content('tag was removed') }\n@@ -50,6 +66,7 @@ describe 'Protected Tags', :js do\n     it \"allows creating protected tags with a wildcard\" do\n       visit project_protected_tags_path(project)\n       set_protected_tag_name('*-stable')\n+      set_allowed_to('create')\n       click_on \"Protect\"\n \n       within(\".protected-tags-list\") { expect(page).to have_content('*-stable') }\n@@ -63,6 +80,7 @@ describe 'Protected Tags', :js do\n \n       visit project_protected_tags_path(project)\n       set_protected_tag_name('*-stable')\n+      set_allowed_to('create')\n       click_on \"Protect\"\n \n       within(\".protected-tags-list\") do\n@@ -78,6 +96,7 @@ describe 'Protected Tags', :js do\n \n       visit project_protected_tags_path(project)\n       set_protected_tag_name('*-stable')\n+      set_allowed_to('create')\n       click_on \"Protect\"\n \n       visit project_protected_tags_path(project)\n@@ -92,6 +111,44 @@ describe 'Protected Tags', :js do\n   end\n \n   describe \"access control\" do\n-    include_examples \"protected tags \u003e access control \u003e CE\"\n+    describe 'with ref permissions for users enabled' do\n+      before do\n+        stub_licensed_features(protected_refs_for_users: true)\n+      end\n+\n+      include_examples \"protected tags \u003e access control \u003e EE\"\n+    end\n+\n+    describe 'with ref permissions for users disabled' do\n+      before do\n+        stub_licensed_features(protected_refs_for_users: false)\n+      end\n+\n+      include_examples \"protected tags \u003e access control \u003e CE\"\n+\n+      describe 'with existing access levels' do\n+        let(:protected_tag) { create(:protected_tag, project: project) }\n+\n+        it 'shows users that can push to the branch' do\n+          protected_tag.create_access_levels.new(user: create(:user, name: 'Jane'))\n+            .save!(validate: false)\n+\n+          visit project_settings_repository_path(project)\n+\n+          expect(page).to have_content(\"The following user can also create tags: \"\\\n+                                       \"Jane\")\n+        end\n+\n+        it 'shows groups that can create to the branch' do\n+          protected_tag.create_access_levels.new(group: create(:group, name: 'Team Awesome'))\n+            .save!(validate: false)\n+\n+          visit project_settings_repository_path(project)\n+\n+          expect(page).to have_content(\"Members of this group can also create tags: \"\\\n+                                       \"Team Awesome\")\n+        end\n+      end\n+    end\n   end\n end\n```\n\n\u003c/details\u003e\n","state":"closed","created_at":"2018-06-22T14:53:29.382Z","updated_at":"2019-08-12T15:32:54.243Z","closed_at":"2019-04-26T13:08:23.271Z","closed_by":{"id":11493,"username":"oswaldo","name":"Oswaldo Ferreira","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/11493/avatar.png","web_url":"https://gitlab.com/oswaldo"},"labels":["Create [DEPRECATED]","Deliverable","Enterprise Edition","Quality","backend","backstage [DEPRECATED]","group::source code","single codebase","test","workflow::in review"],"milestone":{"id":655280,"iid":28,"group_id":9970,"title":"11.11","description":"","state":"closed","created_at":"2018-09-21T19:08:37.027Z","updated_at":"2019-06-10T14:39:00.009Z","due_date":"2019-05-22","start_date":"2019-04-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/28"},"assignees":[{"id":11493,"username":"oswaldo","name":"Oswaldo Ferreira","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/11493/avatar.png","web_url":"https://gitlab.com/oswaldo"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":11493,"username":"oswaldo","name":"Oswaldo Ferreira","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/11493/avatar.png","web_url":"https://gitlab.com/oswaldo"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6570","time_stats":{"time_estimate":28800,"total_time_spent":0,"human_time_estimate":"8h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6570","notes":"https://gitlab.com/api/v4/projects/278964/issues/6570/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6570/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6570","relative":"#6570","full":"gitlab-org/gitlab#6570"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12251659,"iid":6569,"project_id":278964,"title":"Extract EE specific files/lines for spec/controllers/admin","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003espec/controllers/admin/applications_controller_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/controllers/admin/applications_controller_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/controllers/admin/applications_controller_spec.rb\nindex 7e1ce70dc7d..e951c8dd380 100644\n--- a/spec/controllers/admin/applications_controller_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/controllers/admin/applications_controller_spec.rb\n@@ -28,6 +28,8 @@ describe Admin::ApplicationsController do\n \n   describe 'POST #create' do\n     it 'creates the application' do\n+      stub_licensed_features(extended_audit_events: true)\n+\n       create_params = attributes_for(:application, trusted: true)\n \n       expect do\n@@ -38,6 +40,7 @@ describe Admin::ApplicationsController do\n \n       expect(response).to redirect_to(admin_application_path(application))\n       expect(application).to have_attributes(create_params.except(:uid, :owner_type))\n+      expect(SecurityEvent.count).to eq(1)\n     end\n \n     it 'renders the application form on errors' do\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/controllers/admin/dashboard_controller_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/controllers/admin/dashboard_controller_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/controllers/admin/dashboard_controller_spec.rb\nindex 6eb9f7867d5..b9ddebf47b5 100644\n--- a/spec/controllers/admin/dashboard_controller_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/controllers/admin/dashboard_controller_spec.rb\n@@ -2,6 +2,27 @@ require 'spec_helper'\n \n describe Admin::DashboardController do\n   describe '#index' do\n+    it \"allows an admin user to access the page\" do\n+      sign_in(create(:user, :admin))\n+      get :index\n+\n+      expect(response).to have_gitlab_http_status(200)\n+    end\n+\n+    it \"does not allow an auditor user to access the page\" do\n+      sign_in(create(:user, :auditor))\n+      get :index\n+\n+      expect(response).to have_gitlab_http_status(404)\n+    end\n+\n+    it \"does not allow a regular user to access the page\" do\n+      sign_in(create(:user))\n+      get :index\n+\n+      expect(response).to have_gitlab_http_status(404)\n+    end\n+\n     context 'with pending_delete projects' do\n       render_views\n```\n\n\u003c/details\u003e\n","state":"closed","created_at":"2018-06-22T14:49:18.489Z","updated_at":"2019-08-12T15:32:54.331Z","closed_at":"2019-05-27T11:20:25.849Z","closed_by":{"id":209240,"username":"yorickpeterse","name":"Yorick Peterse","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/209240/avatar.png","web_url":"https://gitlab.com/yorickpeterse"},"labels":["Deliverable","Enterprise Edition","Manage [DEPRECATED]","Quality","backend","backstage [DEPRECATED]","single codebase","test"],"milestone":{"id":693518,"iid":33,"group_id":9970,"title":"12.0","description":"https://about.gitlab.com/releases/2019/06/22/gitlab-12-0-released/","state":"closed","created_at":"2018-10-30T16:47:37.975Z","updated_at":"2020-04-22T19:51:03.475Z","due_date":"2019-06-22","start_date":"2019-05-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/33"},"assignees":[{"id":2982208,"username":"mksionek","name":"Gosia Ksionek","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2982208/avatar.png","web_url":"https://gitlab.com/mksionek"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":2982208,"username":"mksionek","name":"Gosia Ksionek","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2982208/avatar.png","web_url":"https://gitlab.com/mksionek"},"user_notes_count":0,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6569","time_stats":{"time_estimate":28800,"total_time_spent":0,"human_time_estimate":"8h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6569","notes":"https://gitlab.com/api/v4/projects/278964/issues/6569/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6569/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6569","relative":"#6569","full":"gitlab-org/gitlab#6569"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12251526,"iid":6568,"project_id":278964,"title":"Extract EE specific files/lines for spec/controllers","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003espec/controllers/autocomplete_controller_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/controllers/autocomplete_controller_spec.rb b/../../single-codebase/gitlab-ce/spec/controllers/autocomplete_controller_spec.rb\nindex 3f958c86e84..3f1c0ae8ac4 100644\n--- a/spec/controllers/autocomplete_controller_spec.rb\n+++ b/../../single-codebase/gitlab-ce/spec/controllers/autocomplete_controller_spec.rb\n@@ -335,44 +335,6 @@ describe AutocompleteController do\n         end\n       end\n     end\n-\n-    context 'GET award_emojis' do\n-      let(:user2) { create(:user) }\n-      let!(:award_emoji1) { create_list(:award_emoji, 2, user: user, name: 'thumbsup') }\n-      let!(:award_emoji2) { create_list(:award_emoji, 1, user: user, name: 'thumbsdown') }\n-      let!(:award_emoji3) { create_list(:award_emoji, 3, user: user, name: 'star') }\n-      let!(:award_emoji4) { create_list(:award_emoji, 1, user: user, name: 'tea') }\n-\n-      context 'unauthorized user' do\n-        it 'returns empty json' do\n-          get :award_emojis\n-\n-          expect(json_response).to be_empty\n-        end\n-      end\n-\n-      context 'sign in as user without award emoji' do\n-        it 'returns empty json' do\n-          sign_in(user2)\n-          get :award_emojis\n-\n-          expect(json_response).to be_empty\n-        end\n-      end\n-\n-      context 'sign in as user with award emoji' do\n-        it 'returns json sorted by name count' do\n-          sign_in(user)\n-          get :award_emojis\n-\n-          expect(json_response.count).to eq 4\n-          expect(json_response[0]).to match('name' =\u003e 'star')\n-          expect(json_response[1]).to match('name' =\u003e 'thumbsup')\n-          expect(json_response[2]).to match('name' =\u003e 'tea')\n-          expect(json_response[3]).to match('name' =\u003e 'thumbsdown')\n-        end\n-      end\n-    end\n   end\n \n   context 'GET award_emojis' do\n```\n\n\u003c/details\u003e\n\n\u003cdetails\u003e\n\u003csummary\u003espec/controllers/groups_controller_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/controllers/groups_controller_spec.rb b/../../single-codebase/gitlab-ce/spec/controllers/groups_controller_spec.rb\nindex 3cb71c9e82b..1cd08200552 100644\n--- a/spec/controllers/groups_controller_spec.rb\n+++ b/../../single-codebase/gitlab-ce/spec/controllers/groups_controller_spec.rb\n@@ -141,38 +141,6 @@ describe GroupsController do\n   end\n \n   describe 'POST #create' do\n-    it 'allows creating a group' do\n-      sign_in(user)\n-\n-      expect do\n-        post :create, params: { group: { name: 'new_group', path: \"new_group\" } }\n-      end.to change { Group.count }.by(1)\n-\n-      expect(response).to have_gitlab_http_status(302)\n-    end\n-\n-    context 'authorization' do\n-      it 'allows an admin to create a group' do\n-        sign_in(create(:admin))\n-\n-        expect do\n-          post :create, params: { group: { name: 'new_group', path: \"new_group\" } }\n-        end.to change { Group.count }.by(1)\n-\n-        expect(response).to have_gitlab_http_status(302)\n-      end\n-\n-      it 'allows an auditor with \"can_create_group\" set to true to create a group' do\n-        sign_in(create(:user, :auditor, can_create_group: true))\n-\n-        expect do\n-          post :create, params: { group: { name: 'new_group', path: \"new_group\" } }\n-        end.to change { Group.count }.by(1)\n-\n-        expect(response).to have_gitlab_http_status(302)\n-      end\n-    end\n-\n     context 'when creating subgroups', :nested_groups do\n       [true, false].each do |can_create_group_status|\n         context \"and can_create_group is #{can_create_group_status}\" do\n```\n\u003c/details\u003e\n\n\u003cdetails\u003e\n\u003csummary\u003espec/controllers/projects_controller_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/controllers/projects_controller_spec.rb b/../../single-codebase/gitlab-ce/spec/controllers/projects_controller_spec.rb\nindex 4d3d6eb20d9..7f1bbebd128 100644\n--- a/spec/controllers/projects_controller_spec.rb\n+++ b/../../single-codebase/gitlab-ce/spec/controllers/projects_controller_spec.rb\n@@ -730,32 +730,6 @@ describe ProjectsController do\n     end\n   end\n \n-  describe 'GET edit' do\n-    it 'does not allow an auditor user to access the page' do\n-      sign_in(create(:user, :auditor))\n-\n-      get :edit,\n-          params: {\n-            namespace_id: project.namespace.path,\n-            id: project.path\n-          }\n-\n-      expect(response).to have_gitlab_http_status(404)\n-    end\n-\n-    it 'allows an admin user to access the page' do\n-      sign_in(create(:user, :admin))\n-\n-      get :edit,\n-          params: {\n-            namespace_id: project.namespace.path,\n-            id: project.path\n-          }\n-\n-      expect(response).to have_gitlab_http_status(200)\n-    end\n-  end\n-\n   describe 'POST #preview_markdown' do\n     before do\n       sign_in(user)\n```\n\u003c/details\u003e\n","state":"closed","created_at":"2018-06-22T14:42:57.462Z","updated_at":"2019-08-12T15:32:54.355Z","closed_at":"2019-06-05T13:30:13.092Z","closed_by":{"id":2982208,"username":"mksionek","name":"Gosia Ksionek","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2982208/avatar.png","web_url":"https://gitlab.com/mksionek"},"labels":["Deliverable","Enterprise Edition","Manage [DEPRECATED]","Quality","backend","backstage [DEPRECATED]","single codebase","test"],"milestone":{"id":693518,"iid":33,"group_id":9970,"title":"12.0","description":"https://about.gitlab.com/releases/2019/06/22/gitlab-12-0-released/","state":"closed","created_at":"2018-10-30T16:47:37.975Z","updated_at":"2020-04-22T19:51:03.475Z","due_date":"2019-06-22","start_date":"2019-05-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/33"},"assignees":[{"id":2629166,"username":"lmcandrew","name":"Liam McAndrew","state":"active","avatar_url":"https://secure.gravatar.com/avatar/5801f5e2fd21127836c0be61ec71f06b?s=80\u0026d=identicon","web_url":"https://gitlab.com/lmcandrew"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":2629166,"username":"lmcandrew","name":"Liam McAndrew","state":"active","avatar_url":"https://secure.gravatar.com/avatar/5801f5e2fd21127836c0be61ec71f06b?s=80\u0026d=identicon","web_url":"https://gitlab.com/lmcandrew"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6568","time_stats":{"time_estimate":28800,"total_time_spent":0,"human_time_estimate":"8h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6568","notes":"https://gitlab.com/api/v4/projects/278964/issues/6568/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6568/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6568","relative":"#6568","full":"gitlab-org/gitlab#6568"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12251393,"iid":6567,"project_id":278964,"title":"Extract EE specific files/lines for db/fixtures/development","description":"We have the following files containing EE specific code. We should move them to ee/\r\n\r\n- db/fixtures/development/14_pipelines.rb =\u003e https://gitlab.com/gitlab-org/gitlab-ce/merge_requests/30870\r\n- db/fixtures/development/20_burndown.rb =\u003e https://gitlab.com/gitlab-org/gitlab-ee/merge_requests/14766\r\n- db/fixtures/development/22_epics.rb =\u003e https://gitlab.com/gitlab-org/gitlab-ee/merge_requests/14766\r\n\r\nDifferences:\r\n\r\n\u003cdetails\u003e\r\n\u003csummary\u003edb/fixtures/development/14_pipelines.rb\u003c/summary\u003e\r\n\r\n```diff\r\ndiff --git a/db/fixtures/development/14_pipelines.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/db/fixtures/development/14_pipelines.rb\r\nindex db043e39d2c..ffba934021e 100644\r\n--- a/db/fixtures/development/14_pipelines.rb\r\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/db/fixtures/development/14_pipelines.rb\r\n@@ -79,7 +79,15 @@ class Gitlab::Seeder::Pipelines\r\n \r\n   def create_master_pipelines\r\n     @project.repository.commits('master', limit: 4).map do |commit|\r\n-      create_pipeline!(@project, 'master', commit)\r\n+      create_pipeline!(@project, 'master', commit).tap do |pipeline|\r\n+        random_pipeline.tap do |triggered_by_pipeline|\r\n+          triggered_by_pipeline.sourced_pipelines.create(\r\n+            source_job: triggered_by_pipeline.builds.all.sample,\r\n+            source_project: triggered_by_pipeline.project,\r\n+            project: pipeline.project,\r\n+            pipeline: pipeline)\r\n+        end\r\n+      end\r\n     end\r\n   rescue\r\n     []\r\n@@ -231,6 +239,10 @@ class Gitlab::Seeder::Pipelines\r\n     @project.team.users.sample\r\n   end\r\n \r\n+  def random_pipeline\r\n+    Ci::Pipeline.limit(4).all.sample\r\n+  end\r\n+\r\n   def build_status\r\n     Ci::Build::AVAILABLE_STATUSES.sample\r\n   end\r\n```\r\n\r\n\u003c/details\u003e\r\n","state":"closed","created_at":"2018-06-22T14:35:11.533Z","updated_at":"2019-12-02T11:56:49.368Z","closed_at":"2019-07-23T16:17:46.629Z","closed_by":{"id":15139,"username":"rspeicher","name":"Robert Speicher","state":"active","avatar_url":"https://secure.gravatar.com/avatar/73c8253932541a7b5cbc5d79493f2bea?s=80\u0026d=identicon","web_url":"https://gitlab.com/rspeicher"},"labels":["Enterprise Edition","Quality","backend","backstage [DEPRECATED]","missed:11.10","missed:12.0","single codebase","team::Delivery"],"milestone":{"id":693521,"iid":35,"group_id":9970,"title":"12.2","description":"https://about.gitlab.com/releases/2019/08/22/gitlab-12-2-released","state":"closed","created_at":"2018-10-30T16:48:32.567Z","updated_at":"2020-04-27T16:30:20.799Z","due_date":"2019-08-22","start_date":"2019-07-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/35"},"assignees":[{"id":15139,"username":"rspeicher","name":"Robert Speicher","state":"active","avatar_url":"https://secure.gravatar.com/avatar/73c8253932541a7b5cbc5d79493f2bea?s=80\u0026d=identicon","web_url":"https://gitlab.com/rspeicher"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":15139,"username":"rspeicher","name":"Robert Speicher","state":"active","avatar_url":"https://secure.gravatar.com/avatar/73c8253932541a7b5cbc5d79493f2bea?s=80\u0026d=identicon","web_url":"https://gitlab.com/rspeicher"},"user_notes_count":3,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6567","time_stats":{"time_estimate":144000,"total_time_spent":0,"human_time_estimate":"40h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6567","notes":"https://gitlab.com/api/v4/projects/278964/issues/6567/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6567/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6567","relative":"#6567","full":"gitlab-org/gitlab#6567"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12251275,"iid":6565,"project_id":278964,"title":"Extract EE specific sidekiq-cluster for bin","description":"Move sidekiq-cluster binary to the ee folder\n\n- The binary should be moved to the `ee/bin` folder\n- Docs should be updated to reference the new location https://gitlab.com/gitlab-org/gitlab-ee/blob/master/doc/administration/operations/extra_sidekiq_processes.md\n- Omnibus should be updated to point at the new location https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/files/gitlab-cookbooks/gitlab-ee/templates/default/sv-sidekiq-cluster-run.erb\n\n\u003cdetails\u003e\n\u003csummary\u003eOriginal description\u003c/summary\u003e\nWe have the following files containing EE specific code. We should move them to ee/\n\n- bin/elastic_repo_indexer\n- bin/sidekiq-cluster\n- bin/geo_log_cursor\n\u003c/details\u003e","state":"closed","created_at":"2018-06-22T14:30:06.973Z","updated_at":"2020-03-06T21:36:57.441Z","closed_at":"2019-04-29T17:17:18.375Z","closed_by":{"id":15139,"username":"rspeicher","name":"Robert Speicher","state":"active","avatar_url":"https://secure.gravatar.com/avatar/73c8253932541a7b5cbc5d79493f2bea?s=80\u0026d=identicon","web_url":"https://gitlab.com/rspeicher"},"labels":["Enterprise Edition","Quality","auto updated","backend","group::distribution","priority::2","single codebase","team::Delivery"],"milestone":{"id":655280,"iid":28,"group_id":9970,"title":"11.11","description":"","state":"closed","created_at":"2018-09-21T19:08:37.027Z","updated_at":"2019-06-10T14:39:00.009Z","due_date":"2019-05-22","start_date":"2019-04-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/28"},"assignees":[{"id":888551,"username":"pursultani","name":"Hossein Pursultani","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/888551/avatar.png","web_url":"https://gitlab.com/pursultani"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":888551,"username":"pursultani","name":"Hossein Pursultani","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/888551/avatar.png","web_url":"https://gitlab.com/pursultani"},"user_notes_count":10,"merge_requests_count":1,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6565","time_stats":{"time_estimate":144000,"total_time_spent":0,"human_time_estimate":"40h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6565","notes":"https://gitlab.com/api/v4/projects/278964/issues/6565/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6565/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6565","relative":"#6565","full":"gitlab-org/gitlab#6565"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12250551,"iid":6560,"project_id":278964,"title":"Extract EE specific files/lines for app/services/groups","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003eapp/services/groups/create_service.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/app/services/groups/create_service.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/app/services/groups/create_service.rb\nindex 55a3b9fa7b1..cdc205fafcf 100644\n--- a/app/services/groups/create_service.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/app/services/groups/create_service.rb\n@@ -33,7 +33,7 @@ module Groups\n     private\n \n     def after_build_hook(group, params)\n-      # overriden in EE\n+      # overridden in EE\n     end\n \n     def create_chat_team?\n@@ -69,3 +69,5 @@ module Groups\n     end\n   end\n end\n+\n+Groups::CreateService.prepend(EE::Groups::CreateService)\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003eapp/services/groups/update_service.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/app/services/groups/update_service.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/app/services/groups/update_service.rb\nindex 9ff1da270e2..2e849887296 100644\n--- a/app/services/groups/update_service.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/app/services/groups/update_service.rb\n@@ -31,7 +31,7 @@ module Groups\n     private\n \n     def before_assignment_hook(group, params)\n-      # overriden in EE\n+      # overridden in EE\n     end\n \n     def after_update\n@@ -60,3 +60,5 @@ module Groups\n     end\n   end\n end\n+\n+Groups::UpdateService.prepend(EE::Groups::UpdateService)\n```\n\n\u003c/details\u003e\n","state":"closed","created_at":"2018-06-22T13:51:59.670Z","updated_at":"2019-08-12T15:32:54.901Z","closed_at":"2019-04-26T07:33:12.834Z","closed_by":{"id":654619,"username":"jamedjo","name":"James Edwards-Jones","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/654619/avatar.png","web_url":"https://gitlab.com/jamedjo"},"labels":["Enterprise Edition","Manage [DEPRECATED]","Quality","[deprecated] Accepting merge requests","backend","backstage [DEPRECATED]","single codebase"],"milestone":{"id":693518,"iid":33,"group_id":9970,"title":"12.0","description":"https://about.gitlab.com/releases/2019/06/22/gitlab-12-0-released/","state":"closed","created_at":"2018-10-30T16:47:37.975Z","updated_at":"2020-04-22T19:51:03.475Z","due_date":"2019-06-22","start_date":"2019-05-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/33"},"assignees":[{"id":654619,"username":"jamedjo","name":"James Edwards-Jones","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/654619/avatar.png","web_url":"https://gitlab.com/jamedjo"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":654619,"username":"jamedjo","name":"James Edwards-Jones","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/654619/avatar.png","web_url":"https://gitlab.com/jamedjo"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6560","time_stats":{"time_estimate":3600,"total_time_spent":0,"human_time_estimate":"1h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6560","notes":"https://gitlab.com/api/v4/projects/278964/issues/6560/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6560/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6560","relative":"#6560","full":"gitlab-org/gitlab#6560"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12250219,"iid":6559,"project_id":278964,"title":"Extract EE specific files/lines for spec/support","description":"We have the following files containing EE specific code. We should move them to ee/\n\n- spec/support/db_cleaner.rb\n- spec/support/webmock.rb","state":"closed","created_at":"2018-06-22T13:29:42.668Z","updated_at":"2019-12-11T20:05:46.328Z","closed_at":"2019-03-14T19:57:59.149Z","closed_by":{"id":283999,"username":"dbalexandre","name":"Douglas Barbosa Alexandre","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/283999/avatar.png","web_url":"https://gitlab.com/dbalexandre"},"labels":["Deliverable","Enterprise Edition","Quality","auto updated","backend","backstage [DEPRECATED]","group::geo","maintenance::refactor","priority::4","single codebase","test","workflow::in dev","workflow::ready for development"],"milestone":{"id":655279,"iid":27,"group_id":9970,"title":"11.10","description":"","state":"closed","created_at":"2018-09-21T19:08:16.261Z","updated_at":"2019-05-21T09:17:49.051Z","due_date":"2019-04-22","start_date":"2019-03-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/27"},"assignees":[{"id":128633,"username":"rymai","name":"R√©my Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":128633,"username":"rymai","name":"R√©my Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6559","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6559","notes":"https://gitlab.com/api/v4/projects/278964/issues/6559/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6559/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6559","relative":"#6559","full":"gitlab-org/gitlab#6559"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12247613,"iid":6556,"project_id":278964,"title":"Extract EE specific files/lines for spec/support/shared_examples","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003espec/support/shared_examples/mentionable_shared_examples.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/support/shared_examples/mentionable_shared_examples.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/support/shared_examples/mentionable_shared_examples.rb\nindex 1226841f24c..a3a71949490 100644\n--- a/spec/support/shared_examples/mentionable_shared_examples.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/support/shared_examples/mentionable_shared_examples.rb\n@@ -5,11 +5,13 @@\n # - let(:set_mentionable_text) { lambda { |txt| \"block that assigns txt to the subject's mentionable_text\" } }\n \n shared_context 'mentionable context' do\n+  let(:group)   { create(:group) }\n   let(:project) { subject.project }\n   let(:author)  { subject.author }\n \n   let(:mentioned_issue) { create(:issue, project: project) }\n   let!(:mentioned_mr) { create(:merge_request, source_project: project) }\n+  let(:mentioned_epic) { create(:epic, group: group) }\n   let(:mentioned_commit) { project.commit(\"HEAD~1\") }\n \n   let(:ext_proj)   { create(:project, :public, :repository) }\n@@ -27,6 +29,7 @@ shared_context 'mentionable context' do\n       These references are new:\n         Issue:  #{mentioned_issue.to_reference}\n         Merge:  #{mentioned_mr.to_reference}\n+        Epic:  #{mentioned_epic.to_reference(project)}\n         Commit: #{mentioned_commit.to_reference}\n \n       This reference is a repeat and should only be mentioned once:\n@@ -43,6 +46,8 @@ shared_context 'mentionable context' do\n   end\n \n   before do\n+    stub_licensed_features(epics: true)\n+\n     # Wire the project's repository to return the mentioned commit, and +nil+\n     # for any unrecognized commits.\n     allow_any_instance_of(::Repository).to receive(:commit).and_call_original\n@@ -67,9 +72,10 @@ shared_examples 'a mentionable' do\n   it \"extracts references from its reference property\" do\n     # De-duplicate and omit itself\n     refs = subject.referenced_mentionables\n-    expect(refs.size).to eq(6)\n+    expect(refs.size).to eq(7)\n     expect(refs).to include(mentioned_issue)\n     expect(refs).to include(mentioned_mr)\n+    expect(refs).to include(mentioned_epic)\n     expect(refs).to include(mentioned_commit)\n     expect(refs).to include(ext_issue)\n     expect(refs).to include(ext_mr)\n@@ -77,7 +83,7 @@ shared_examples 'a mentionable' do\n   end\n \n   it 'creates cross-reference notes' do\n-    mentioned_objects = [mentioned_issue, mentioned_mr, mentioned_commit,\n+    mentioned_objects = [mentioned_issue, mentioned_mr, mentioned_epic, mentioned_commit,\n                          ext_issue, ext_mr, ext_commit]\n \n     mentioned_objects.each do |referenced|\n@@ -97,6 +103,7 @@ shared_examples 'an editable mentionable' do\n   let(:new_issues) do\n     [create(:issue, project: project), create(:issue, project: ext_proj)]\n   end\n+  let(:new_epic) { create(:epic, group: group) }\n \n   it 'creates new cross-reference notes when the mentionable text is edited' do\n     subject.save\n@@ -107,6 +114,8 @@ shared_examples 'an editable mentionable' do\n \n       Issue:  #{mentioned_issue.to_reference}\n \n+      Issue:  #{mentioned_epic.to_reference(project)}\n+\n       Commit: #{mentioned_commit.to_reference}\n \n       ---\n@@ -117,23 +126,26 @@ shared_examples 'an editable mentionable' do\n \n       ---\n \n-      These two references are introduced in an edit:\n+      These three references are introduced in an edit:\n \n       Issue: #{new_issues[0].to_reference}\n \n       Cross: #{new_issues[1].to_reference(project)}\n+\n+      Epic: #{new_epic.to_reference(project)}\n     MSG\n \n-    # These three objects were already referenced, and should not receive new\n+    # These four objects were already referenced, and should not receive new\n     # notes\n-    [mentioned_issue, mentioned_commit, ext_issue].each do |oldref|\n+    [mentioned_issue, mentioned_commit, mentioned_epic, ext_issue].each do |oldref|\n       expect(SystemNoteService).not_to receive(:cross_reference)\n         .with(oldref, any_args)\n     end\n \n-    # These two issues are new and should receive reference notes\n+    # These two issues and an epic are new and should receive reference notes\n     # In the case of MergeRequests remember that cannot mention commits included in the MergeRequest\n-    new_issues.each do |newref|\n+    new_mentionables = new_issues + [new_epic]\n+    new_mentionables.each do |newref|\n       expect(SystemNoteService).to receive(:cross_reference)\n         .with(newref, subject.local_reference, author)\n     end\n```\n\n\u003c/details\u003e\n","state":"closed","created_at":"2018-06-22T11:19:51.762Z","updated_at":"2019-08-12T15:32:55.118Z","closed_at":"2019-04-04T12:20:45.092Z","closed_by":{"id":128633,"username":"rymai","name":"R√©my Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"},"labels":["Enterprise Edition","Plan [DEPRECATED]","Quality","[deprecated] Accepting merge requests","backend","backstage [DEPRECATED]","single codebase","test"],"milestone":{"id":655279,"iid":27,"group_id":9970,"title":"11.10","description":"","state":"closed","created_at":"2018-09-21T19:08:16.261Z","updated_at":"2019-05-21T09:17:49.051Z","due_date":"2019-04-22","start_date":"2019-03-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/27"},"assignees":[{"id":128633,"username":"rymai","name":"R√©my Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":128633,"username":"rymai","name":"R√©my Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6556","time_stats":{"time_estimate":28800,"total_time_spent":0,"human_time_estimate":"8h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6556","notes":"https://gitlab.com/api/v4/projects/278964/issues/6556/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6556/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6556","relative":"#6556","full":"gitlab-org/gitlab#6556"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12247555,"iid":6555,"project_id":278964,"title":"Extract EE specific files/lines for spec/support/api","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003espec/support/api/milestones_shared_examples.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/support/api/milestones_shared_examples.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/support/api/milestones_shared_examples.rb\nindex 5f709831ce1..dddad90b89c 100644\n--- a/spec/support/api/milestones_shared_examples.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/support/api/milestones_shared_examples.rb\n@@ -240,7 +240,7 @@ shared_examples_for 'group and project milestones' do |route_definition|\n       get api(issues_route, user)\n \n       expect(response).to have_gitlab_http_status(200)\n-      expect(response).to match_response_schema('public_api/v4/issues')\n+      expect(response).to match_response_schema('public_api/v4/issues', dir: 'ee')\n     end\n \n     it 'returns a 401 error if user not authenticated' do\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/support/api/schema_matcher.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/support/api/schema_matcher.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/support/api/schema_matcher.rb\nindex 6591d56e473..f7d74df0656 100644\n--- a/spec/support/api/schema_matcher.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/support/api/schema_matcher.rb\n@@ -1,6 +1,6 @@\n module SchemaPath\n   def self.expand(schema, dir = '')\n-    Rails.root.join('spec', dir, \"fixtures/api/schemas/#{schema}.json\").to_s\n+    Rails.root.join(dir, 'spec', \"fixtures/api/schemas/#{schema}.json\").to_s\n   end\n end\n```\n\n\u003c/details\u003e\n","state":"closed","created_at":"2018-06-22T11:16:39.026Z","updated_at":"2019-12-02T11:56:47.922Z","closed_at":"2019-04-04T12:20:31.094Z","closed_by":{"id":128633,"username":"rymai","name":"R√©my Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"},"labels":["Enterprise Edition","Quality","[deprecated] Accepting merge requests","api","backend","single codebase","team::Delivery","test"],"milestone":{"id":655279,"iid":27,"group_id":9970,"title":"11.10","description":"","state":"closed","created_at":"2018-09-21T19:08:16.261Z","updated_at":"2019-05-21T09:17:49.051Z","due_date":"2019-04-22","start_date":"2019-03-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/27"},"assignees":[],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":null,"user_notes_count":4,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6555","time_stats":{"time_estimate":28800,"total_time_spent":0,"human_time_estimate":"8h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6555","notes":"https://gitlab.com/api/v4/projects/278964/issues/6555/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6555/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6555","relative":"#6555","full":"gitlab-org/gitlab#6555"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12247279,"iid":6554,"project_id":278964,"title":"Move EE differences for spec/javascripts/vue_shared/components/sidebar/date_picker_spec.js","description":"Move EE differences for spec/javascripts/vue_shared/components/sidebar/date_picker_spec.js\n\nhttps://leipert-projects.gitlab.io/is-gitlab-pretty-yet/diff/?search=date_picker_spec.js","state":"closed","created_at":"2018-06-22T10:57:11.331Z","updated_at":"2022-05-19T16:29:21.442Z","closed_at":"2019-03-27T11:15:31.976Z","closed_by":{"id":113870,"username":"iamphill","name":"Phil Hughes","state":"active","avatar_url":"https://secure.gravatar.com/avatar/533a51534470a11062df393543eab649?s=80\u0026d=identicon","web_url":"https://gitlab.com/iamphill"},"labels":["Enterprise Edition","backstage [DEPRECATED]","devops::plan","frontend","single codebase","test"],"milestone":{"id":655279,"iid":27,"group_id":9970,"title":"11.10","description":"","state":"closed","created_at":"2018-09-21T19:08:16.261Z","updated_at":"2019-05-21T09:17:49.051Z","due_date":"2019-04-22","start_date":"2019-03-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/27"},"assignees":[{"id":1212235,"username":"winh","name":"Inactive Account","state":"active","avatar_url":"https://secure.gravatar.com/avatar/e34b010c96ff3f44c62cddf66607232a?s=80\u0026d=identicon","web_url":"https://gitlab.com/winh"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":1212235,"username":"winh","name":"Inactive Account","state":"active","avatar_url":"https://secure.gravatar.com/avatar/e34b010c96ff3f44c62cddf66607232a?s=80\u0026d=identicon","web_url":"https://gitlab.com/winh"},"user_notes_count":3,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6554","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6554","notes":"https://gitlab.com/api/v4/projects/278964/issues/6554/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6554/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6554","relative":"#6554","full":"gitlab-org/gitlab#6554"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":601,"epic":{"id":2297,"iid":601,"title":"Move all EE specific frontend code behind an EE flag","url":"/groups/gitlab-org/-/epics/601","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12247222,"iid":6553,"project_id":278964,"title":"Extract EE specific files/lines for spec/javascripts/vue_mr_widget/mock_data.js","description":"We have the following files containing EE specific code. We should move them to ee/\n\n- spec/javascripts/vue_mr_widget/mock_data.js","state":"closed","created_at":"2018-06-22T10:52:34.047Z","updated_at":"2019-08-12T15:32:55.275Z","closed_at":"2019-04-29T16:46:21.268Z","closed_by":{"id":482476,"username":"filipa","name":"Filipa Lacerda","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/482476/avatar.png","web_url":"https://gitlab.com/filipa"},"labels":["Create [DEPRECATED]","Deliverable","Enterprise Edition","backstage [DEPRECATED]","devops::create","frontend","single codebase","workflow::in review"],"milestone":{"id":655280,"iid":28,"group_id":9970,"title":"11.11","description":"","state":"closed","created_at":"2018-09-21T19:08:37.027Z","updated_at":"2019-06-10T14:39:00.009Z","due_date":"2019-05-22","start_date":"2019-04-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/28"},"assignees":[{"id":3199302,"username":"dmishunov","name":"Denys Mishunov","state":"active","avatar_url":"https://secure.gravatar.com/avatar/d85e45af29611ac2c1395e3c3d6ec5d6?s=80\u0026d=identicon","web_url":"https://gitlab.com/dmishunov"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":3199302,"username":"dmishunov","name":"Denys Mishunov","state":"active","avatar_url":"https://secure.gravatar.com/avatar/d85e45af29611ac2c1395e3c3d6ec5d6?s=80\u0026d=identicon","web_url":"https://gitlab.com/dmishunov"},"user_notes_count":11,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6553","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6553","notes":"https://gitlab.com/api/v4/projects/278964/issues/6553/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6553/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6553","relative":"#6553","full":"gitlab-org/gitlab#6553"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":601,"epic":{"id":2297,"iid":601,"title":"Move all EE specific frontend code behind an EE flag","url":"/groups/gitlab-org/-/epics/601","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12230219,"iid":6543,"project_id":278964,"title":"Extract EE specific files/lines for some discussion tests","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003espec/presenters/merge_request_presenter_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/presenters/merge_request_presenter_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/presenters/merge_request_presenter_spec.rb\nindex bafcddebbb7..0ae7008f6a1 100644\n--- a/spec/presenters/merge_request_presenter_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/presenters/merge_request_presenter_spec.rb\n@@ -2,7 +2,7 @@ require 'spec_helper'\n \n describe MergeRequestPresenter do\n   let(:resource) { create :merge_request, source_project: project }\n-  let(:project) { create :project }\n+  let(:project) { create(:project, :repository) }\n   let(:user) { create(:user) }\n \n   describe '#ci_status' do\n@@ -392,6 +392,111 @@ describe MergeRequestPresenter do\n     end\n   end\n \n+  describe '#can_push_to_source_branch' do\n+    before do\n+      allow(resource).to receive(:source_branch_exists?) { source_branch_exists }\n+\n+      allow_any_instance_of(Gitlab::UserAccess::RequestCacheExtension)\n+        .to receive(:can_push_to_branch?)\n+        .with(resource.source_branch)\n+        .and_return(can_push_to_branch)\n+    end\n+\n+    subject do\n+      described_class.new(resource, current_user: user).can_push_to_source_branch?\n+    end\n+\n+    context 'when source branch exists AND user can push to source branch' do\n+      let(:source_branch_exists) { true }\n+      let(:can_push_to_branch) { true }\n+\n+      it 'returns true' do\n+        is_expected.to eq(true)\n+      end\n+    end\n+\n+    context 'when source branch does not exists' do\n+      let(:source_branch_exists) { false }\n+      let(:can_push_to_branch) { true }\n+\n+      it 'returns false' do\n+        is_expected.to eq(false)\n+      end\n+    end\n+\n+    context 'when user cannot push to source branch' do\n+      let(:source_branch_exists) { true }\n+      let(:can_push_to_branch) { false }\n+\n+      it 'returns false' do\n+        is_expected.to eq(false)\n+      end\n+    end\n+  end\n+\n+  describe '#rebase_path' do\n+    before do\n+      allow(resource).to receive(:rebase_in_progress?) { rebase_in_progress }\n+      allow(resource).to receive(:should_be_rebased?) { should_be_rebased }\n+\n+      allow_any_instance_of(Gitlab::UserAccess::RequestCacheExtension)\n+        .to receive(:can_push_to_branch?)\n+        .with(resource.source_branch)\n+        .and_return(can_push_to_branch)\n+    end\n+\n+    subject do\n+      described_class.new(resource, current_user: user).rebase_path\n+    end\n+\n+    context 'when can rebase' do\n+      let(:rebase_in_progress) { false }\n+      let(:can_push_to_branch) { true }\n+      let(:should_be_rebased) { true }\n+\n+      before do\n+        allow(resource).to receive(:source_branch_exists?) { true }\n+      end\n+\n+      it 'returns path' do\n+        is_expected\n+          .to eq(\"/#{project.full_path}/merge_requests/#{resource.iid}/rebase\")\n+      end\n+    end\n+\n+    context 'when cannot rebase' do\n+      context 'when rebase in progress' do\n+        let(:rebase_in_progress) { true }\n+        let(:can_push_to_branch) { true }\n+        let(:should_be_rebased) { true }\n+\n+        it 'returns nil' do\n+          is_expected.to be_nil\n+        end\n+      end\n+\n+      context 'when user cannot merge' do\n+        let(:rebase_in_progress) { false }\n+        let(:can_push_to_branch) { false }\n+        let(:should_be_rebased) { true }\n+\n+        it 'returns nil' do\n+          is_expected.to be_nil\n+        end\n+      end\n+\n+      context 'should not be rebased' do\n+        let(:rebase_in_progress) { false }\n+        let(:can_push_to_branch) { true }\n+        let(:should_be_rebased) { false }\n+\n+        it 'returns nil' do\n+          is_expected.to be_nil\n+        end\n+      end\n+    end\n+  end\n+\n   describe '#source_branch_with_namespace_link' do\n     subject do\n       described_class.new(resource, current_user: user).source_branch_with_namespace_link\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/services/boards/issues/create_service_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/services/boards/issues/create_service_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/services/boards/issues/create_service_spec.rb\nindex f0179e35652..c16d0d2a6b1 100644\n--- a/spec/services/boards/issues/create_service_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/services/boards/issues/create_service_spec.rb\n@@ -29,5 +29,23 @@ describe Boards::Issues::CreateService do\n \n       expect(issue.labels).to eq [label]\n     end\n+\n+    it 'adds the board assignee, weight, labels and milestone to the issue' do\n+      board_assignee = create(:user)\n+      project.add_developer(board_assignee)\n+      board_milestone = create(:milestone, project: project)\n+      board_label = create(:label, project: project)\n+      board.update!(assignee: board_assignee,\n+                    milestone: board_milestone,\n+                    label_ids: [board_label.id],\n+                    weight: 4)\n+\n+      issue = service.execute\n+\n+      expect(issue.assignees).to eq([board_assignee])\n+      expect(issue.weight).to eq(board.weight)\n+      expect(issue.milestone).to eq(board_milestone)\n+      expect(issue.labels).to contain_exactly(label, board_label)\n+    end\n   end\n end\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/services/issues/move_service_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/services/issues/move_service_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/services/issues/move_service_spec.rb\nindex 1e088bc7d9b..5da4a638be1 100644\n--- a/spec/services/issues/move_service_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/services/issues/move_service_spec.rb\n@@ -138,6 +138,20 @@ describe Issues::MoveService do\n             .not_to raise_error # Sidekiq::Worker::EnqueueFromTransactionError\n         end\n       end\n+\n+      context 'group issue hooks' do\n+        let!(:hook) { create(:group_hook, group: new_project.group, issues_events: true) }\n+\n+        it 'executes group issue hooks' do\n+          allow_any_instance_of(WebHookService).to receive(:execute)\n+\n+          # Ideally, we'd test that `WebHookWorker.jobs.size` increased by 1,\n+          # but since the entire spec run takes place in a transaction, we never\n+          # actually get to the `after_commit` hook that queues these jobs.\n+          expect { move_service.execute(old_issue, new_project) }\n+            .not_to raise_error # Sidekiq::Worker::EnqueueFromTransactionError\n+        end\n+      end\n     end\n \n     describe 'move permissions' do\n```\n\n\u003c/details\u003e\n\n\u003cbr\u003e\n\nLooks like they're EE only tests and we could just move to the EE spec files.","state":"closed","created_at":"2018-06-21T16:00:20.285Z","updated_at":"2019-08-12T15:32:56.215Z","closed_at":"2019-03-25T15:11:51.325Z","closed_by":{"id":128633,"username":"rymai","name":"R√©my Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"},"labels":["Enterprise Edition","Plan [DEPRECATED]","Quality","[deprecated] Accepting merge requests","backend","backstage [DEPRECATED]","single codebase","test"],"milestone":{"id":655279,"iid":27,"group_id":9970,"title":"11.10","description":"","state":"closed","created_at":"2018-09-21T19:08:16.261Z","updated_at":"2019-05-21T09:17:49.051Z","due_date":"2019-04-22","start_date":"2019-03-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/27"},"assignees":[{"id":443319,"username":"smcgivern","name":"Sean McGivern","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/443319/avatar.png","web_url":"https://gitlab.com/smcgivern"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":443319,"username":"smcgivern","name":"Sean McGivern","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/443319/avatar.png","web_url":"https://gitlab.com/smcgivern"},"user_notes_count":0,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6543","time_stats":{"time_estimate":28800,"total_time_spent":0,"human_time_estimate":"8h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6543","notes":"https://gitlab.com/api/v4/projects/278964/issues/6543/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6543/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6543","relative":"#6543","full":"gitlab-org/gitlab#6543"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12230183,"iid":6542,"project_id":278964,"title":"Extract EE specific files/lines for spec/support/shared_contexts","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003espec/support/shared_contexts/services_shared_context.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/support/shared_contexts/services_shared_context.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/support/shared_contexts/services_shared_context.rb\nindex d92e8318fa0..83b16fea7b1 100644\n--- a/spec/support/shared_contexts/services_shared_context.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/support/shared_contexts/services_shared_context.rb\n@@ -26,6 +26,14 @@ Service.available_services_names.each do |service|\n       end\n     end\n \n+    before do\n+      if service == 'github'\n+        stub_licensed_features(github_project_service_integration: true)\n+        project.clear_memoization(:disabled_services)\n+        project.clear_memoization(:licensed_feature_available)\n+      end\n+    end\n+\n     def initialize_service(service)\n       service_item = project.find_or_initialize_service(service)\n       service_item.properties = service_attrs\n```\n\n\u003c/details\u003e\n","state":"closed","created_at":"2018-06-21T15:56:57.981Z","updated_at":"2019-08-12T15:32:56.209Z","closed_at":"2019-04-04T12:20:14.561Z","closed_by":{"id":128633,"username":"rymai","name":"R√©my Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"},"labels":["Enterprise Edition","Manage [DEPRECATED]","Quality","[deprecated] Accepting merge requests","backend","backstage [DEPRECATED]","single codebase","test"],"milestone":{"id":655279,"iid":27,"group_id":9970,"title":"11.10","description":"","state":"closed","created_at":"2018-09-21T19:08:16.261Z","updated_at":"2019-05-21T09:17:49.051Z","due_date":"2019-04-22","start_date":"2019-03-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/27"},"assignees":[{"id":128633,"username":"rymai","name":"R√©my Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":128633,"username":"rymai","name":"R√©my Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6542","time_stats":{"time_estimate":28800,"total_time_spent":0,"human_time_estimate":"8h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6542","notes":"https://gitlab.com/api/v4/projects/278964/issues/6542/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6542/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6542","relative":"#6542","full":"gitlab-org/gitlab#6542"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12228396,"iid":6539,"project_id":278964,"title":"Extract EE specific files/lines for quick actions tests","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003espec/services/notes/quick_actions_service_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/services/notes/quick_actions_service_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/services/notes/quick_actions_service_spec.rb\nindex 14d62763a5b..fbd808a3efc 100644\n--- a/spec/services/notes/quick_actions_service_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/services/notes/quick_actions_service_spec.rb\n@@ -171,7 +171,7 @@ describe Notes::QuickActionsService do\n     end\n   end\n \n-  context 'CE restriction for issue assignees' do\n+  context 'Issue assignees' do\n     describe '/assign' do\n       let(:project) { create(:project) }\n       let(:maintainer) { create(:user).tap { |u| project.add_maintainer(u) } }\n@@ -193,7 +193,7 @@ describe Notes::QuickActionsService do\n         _, command_params = service.extract_commands(note)\n         service.execute(command_params, note)\n \n-        expect(note.noteable.assignees.count).to eq(1)\n+        expect(note.noteable.assignees.count).to eq(2)\n       end\n     end\n   end\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/services/quick_actions/interpret_service_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/services/quick_actions/interpret_service_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/services/quick_actions/interpret_service_spec.rb\nindex 938764f40b0..d001dca9261 100644\n--- a/spec/services/quick_actions/interpret_service_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/services/quick_actions/interpret_service_spec.rb\n@@ -15,6 +15,8 @@ describe QuickActions::InterpretService do\n   let(:service) { described_class.new(project, developer) }\n \n   before do\n+    stub_licensed_features(multiple_issue_assignees: false)\n+\n     project.add_developer(developer)\n   end\n \n@@ -322,6 +324,23 @@ describe QuickActions::InterpretService do\n       end\n     end\n \n+    shared_examples 'weight command' do\n+      it 'populates weight: 5 if content contains /weight 5' do\n+        _, updates = service.execute(content, issuable)\n+\n+        expect(updates).to eq(weight: 5)\n+      end\n+    end\n+\n+    shared_examples 'clear weight command' do\n+      it 'populates weight: nil if content contains /clear_weight' do\n+        issuable.update(weight: 5)\n+        _, updates = service.execute(content, issuable)\n+\n+        expect(updates).to eq(weight: nil)\n+      end\n+    end\n+\n     shared_examples 'duplicate command' do\n       it 'fetches issue and populates canonical_issue_id if content contains /duplicate issue_reference' do\n         issue_duplicate # populate the issue\n@@ -465,6 +484,29 @@ describe QuickActions::InterpretService do\n           let(:issuable) { build(:merge_request, source_project: project) }\n         end\n       end\n+\n+      context 'not approved merge request can not be merged' do\n+        before do\n+          merge_request.target_project.update(approvals_before_merge: 1)\n+        end\n+\n+        it_behaves_like 'empty command' do\n+          let(:content) { \"/merge\" }\n+          let(:issuable) { build(:merge_request, source_project: project) }\n+        end\n+      end\n+\n+      context 'approved merge request can be merged' do\n+        before do\n+          merge_request.update(approvals_before_merge: 1)\n+          merge_request.approvals.create(user: developer)\n+        end\n+\n+        it_behaves_like 'empty command' do\n+          let(:content) { \"/merge\" }\n+          let(:issuable) { build(:merge_request, source_project: project) }\n+        end\n+      end\n     end\n \n     it_behaves_like 'title command' do\n@@ -827,6 +869,40 @@ describe QuickActions::InterpretService do\n       let(:issuable) { merge_request }\n     end\n \n+    context 'issuable weights licensed' do\n+      before do\n+        stub_licensed_features(issue_weights: true)\n+      end\n+\n+      it_behaves_like 'weight command' do\n+        let(:content) { '/weight 5'}\n+        let(:issuable) { issue }\n+      end\n+\n+      it_behaves_like 'clear weight command' do\n+        let(:content) { '/clear_weight' }\n+        let(:issuable) { issue }\n+      end\n+    end\n+\n+    context 'issuable weights unlicensed' do\n+      before do\n+        stub_licensed_features(issue_weights: false)\n+      end\n+\n+      it 'does not recognise /weight X' do\n+        _, updates = service.execute('/weight 5', issue)\n+\n+        expect(updates).to be_empty\n+      end\n+\n+      it 'does not recognise /clear_weight' do\n+        _, updates = service.execute('/clear_weight', issue)\n+\n+        expect(updates).to be_empty\n+      end\n+    end\n+\n     context '/todo' do\n       let(:content) { '/todo' }\n \n@@ -1526,5 +1602,16 @@ describe QuickActions::InterpretService do\n         end\n       end\n     end\n+\n+    # EE-specific tests\n+\n+    describe 'weight command' do\n+      let(:content) { '/weight 4' }\n+\n+      it 'includes the number' do\n+        _, explanations = service.explain(content, issue)\n+        expect(explanations).to eq(['Sets weight to 4.'])\n+      end\n+    end\n   end\n end\n```\n\n\u003c/details\u003e\n\u003cbr\u003e","state":"closed","created_at":"2018-06-21T14:47:21.633Z","updated_at":"2022-05-19T17:57:38.858Z","closed_at":"2019-04-05T14:29:41.764Z","closed_by":{"id":15139,"username":"rspeicher","name":"Robert Speicher","state":"active","avatar_url":"https://secure.gravatar.com/avatar/73c8253932541a7b5cbc5d79493f2bea?s=80\u0026d=identicon","web_url":"https://gitlab.com/rspeicher"},"labels":["Enterprise Edition","Quality","backend","backstage [DEPRECATED]","devops::plan","single codebase","test"],"milestone":{"id":655279,"iid":27,"group_id":9970,"title":"11.10","description":"","state":"closed","created_at":"2018-09-21T19:08:16.261Z","updated_at":"2019-05-21T09:17:49.051Z","due_date":"2019-04-22","start_date":"2019-03-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/27"},"assignees":[{"id":3483274,"username":"acroitor","name":"Alexandru Croitor","state":"active","avatar_url":"https://secure.gravatar.com/avatar/461378ef52c26eec55e6c15ec09bb9ed?s=80\u0026d=identicon","web_url":"https://gitlab.com/acroitor"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":3483274,"username":"acroitor","name":"Alexandru Croitor","state":"active","avatar_url":"https://secure.gravatar.com/avatar/461378ef52c26eec55e6c15ec09bb9ed?s=80\u0026d=identicon","web_url":"https://gitlab.com/acroitor"},"user_notes_count":2,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6539","time_stats":{"time_estimate":28800,"total_time_spent":0,"human_time_estimate":"8h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6539","notes":"https://gitlab.com/api/v4/projects/278964/issues/6539/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6539/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6539","relative":"#6539","full":"gitlab-org/gitlab#6539"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12227633,"iid":6538,"project_id":278964,"title":"Extract EE specific files/lines for spec/features/issues","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003espec/features/issues/filtered_search/dropdown_hint_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/features/issues/filtered_search/dropdown_hint_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/issues/filtered_search/dropdown_hint_spec.rb\nindex 0e296ab2109..096756f19cc 100644\n--- a/spec/features/issues/filtered_search/dropdown_hint_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/issues/filtered_search/dropdown_hint_spec.rb\n@@ -66,7 +66,7 @@ describe 'Dropdown hint', :js do\n       it 'filters with text' do\n         filtered_search.set('a')\n \n-        expect(find(js_dropdown_hint)).to have_selector('.filter-dropdown .filter-dropdown-item', count: 4)\n+        expect(find(js_dropdown_hint)).to have_selector('.filter-dropdown .filter-dropdown-item', count: 5)\n       end\n     end\n \n@@ -119,6 +119,15 @@ describe 'Dropdown hint', :js do\n         expect_tokens([{ name: 'my-reaction' }])\n         expect_filtered_search_input_empty\n       end\n+\n+      it 'opens the yes-no dropdown when you click on confidential' do\n+        click_hint('confidential')\n+\n+        expect(page).to have_css(js_dropdown_hint, visible: false)\n+        expect(page).to have_css('#js-dropdown-confidential', visible: true)\n+        expect_tokens([{ name: 'confidential' }])\n+        expect_filtered_search_input_empty\n+      end\n     end\n \n     describe 'selecting from dropdown with some input' do\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/features/issues/filtered_search/search_bar_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/features/issues/filtered_search/search_bar_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/issues/filtered_search/search_bar_spec.rb\nindex 891ef884682..c4468922883 100644\n--- a/spec/features/issues/filtered_search/search_bar_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/issues/filtered_search/search_bar_spec.rb\n@@ -86,7 +86,7 @@ describe 'Search bar', :js do\n       expect(find('#js-dropdown-hint')).to have_selector('.filter-dropdown .filter-dropdown-item', count: original_size)\n     end\n \n-    it 'resets the dropdown filters', :quarantine do\n+    it 'resets the dropdown filters' do\n       filtered_search.click\n \n       hint_offset = get_left_style(find('#js-dropdown-hint')['style'])\n@@ -100,7 +100,7 @@ describe 'Search bar', :js do\n       find('.filtered-search-box .clear-search').click\n       filtered_search.click\n \n-      expect(find('#js-dropdown-hint')).to have_selector('.filter-dropdown .filter-dropdown-item', count: 5)\n+      expect(find('#js-dropdown-hint')).to have_selector('.filter-dropdown .filter-dropdown-item', count: 6)\n       expect(get_left_style(find('#js-dropdown-hint')['style'])).to eq(hint_offset)\n     end\n   end\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/features/issues/filtered_search/visual_tokens_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/features/issues/filtered_search/visual_tokens_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/issues/filtered_search/visual_tokens_spec.rb\nindex 9fd661d80ae..a4c34ce85f0 100644\n--- a/spec/features/issues/filtered_search/visual_tokens_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/issues/filtered_search/visual_tokens_spec.rb\n@@ -59,6 +59,13 @@ describe 'Visual tokens', :js do\n       expect(page).to have_css('#js-dropdown-author', visible: false)\n     end\n \n+    it 'ends editing mode when scroll container is clicked' do\n+      find('.scroll-container').click\n+\n+      expect_filtered_search_input_empty\n+      expect(page).to have_css('#js-dropdown-author', visible: false)\n+    end\n+\n     describe 'selecting different author from dropdown' do\n       before do\n         filter_author_dropdown.find('.filter-dropdown-item .dropdown-light-content', text: \"@#{user_rock.username}\").click\n@@ -102,6 +109,13 @@ describe 'Visual tokens', :js do\n       expect(page).to have_css('#js-dropdown-assignee', visible: false)\n     end\n \n+    it 'ends editing mode when scroll container is clicked' do\n+      find('.scroll-container').click\n+\n+      expect_filtered_search_input_empty\n+      expect(page).to have_css('#js-dropdown-assignee', visible: false)\n+    end\n+\n     describe 'selecting static option from dropdown' do\n       before do\n         find(\"#js-dropdown-assignee\").find('.filter-dropdown-item', text: 'None').click\n@@ -153,6 +167,13 @@ describe 'Visual tokens', :js do\n       expect_filtered_search_input_empty\n       expect(page).to have_css('#js-dropdown-milestone', visible: false)\n     end\n+\n+    it 'ends editing mode when scroll container is clicked' do\n+      find('.scroll-container').click\n+\n+      expect_filtered_search_input_empty\n+      expect(page).to have_css('#js-dropdown-milestone', visible: false)\n+    end\n   end\n \n   describe 'editing label token' do\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/features/issues/form_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/features/issues/form_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/issues/form_spec.rb\nindex f2e4c5779df..2fe4256037f 100644\n--- a/spec/features/issues/form_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/issues/form_spec.rb\n@@ -13,6 +13,8 @@ describe 'New/edit issue', :js do\n   let!(:issue)     { create(:issue, project: project, assignees: [user], milestone: milestone) }\n \n   before do\n+    stub_licensed_features(multiple_issue_assignees: false, issue_weights: false)\n+\n     project.add_maintainer(user)\n     project.add_maintainer(user2)\n     sign_in(user)\n@@ -30,8 +32,8 @@ describe 'New/edit issue', :js do\n         # the original method, resulting in infinite recursion when called.\n         # This is likely a bug with helper modules included into dynamically generated view classes.\n         # To work around this, we have to hold on to and call to the original implementation manually.\n-        original_issue_dropdown_options = FormHelper.instance_method(:issue_assignees_dropdown_options)\n-        allow_any_instance_of(FormHelper).to receive(:issue_assignees_dropdown_options).and_wrap_original do |original, *args|\n+        original_issue_dropdown_options = EE::FormHelper.instance_method(:issue_assignees_dropdown_options)\n+        allow_any_instance_of(EE::FormHelper).to receive(:issue_assignees_dropdown_options).and_wrap_original do |original, *args|\n           options = original_issue_dropdown_options.bind(original.receiver).call(*args)\n           options[:data][:per_page] = 2\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/features/issues/gfm_autocomplete_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/features/issues/gfm_autocomplete_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/issues/gfm_autocomplete_spec.rb\nindex c22ad0d20ef..986f3823275 100644\n--- a/spec/features/issues/gfm_autocomplete_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/issues/gfm_autocomplete_spec.rb\n@@ -278,7 +278,7 @@ describe 'GFM autocomplete', :js do\n     end\n   end\n \n-  # This context has jsut one example in each contexts in order to improve spec performance.\n+  # This context has just one example in each contexts in order to improve spec performance.\n   context 'labels', :quarantine do\n     let!(:backend)          { create(:label, project: project, title: 'backend') }\n     let!(:bug)              { create(:label, project: project, title: 'bug') }\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/features/issues/user_uses_quick_actions_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/features/issues/user_uses_quick_actions_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/issues/user_uses_quick_actions_spec.rb\nindex 27cffdc5f8b..6a7a7f00fe4 100644\n--- a/spec/features/issues/user_uses_quick_actions_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/features/issues/user_uses_quick_actions_spec.rb\n@@ -117,6 +117,80 @@ describe 'Issues \u003e User uses quick actions', :js do\n       end\n     end\n \n+    describe 'adding a weight from a note' do\n+      let(:issue) { create(:issue, project: project) }\n+\n+      context 'when the user can update the weight' do\n+        it 'does not create a note, and sets the weight accordingly' do\n+          add_note(\"/weight 5\")\n+\n+          expect(page).not_to have_content '/weight 5'\n+          expect(page).to have_content 'Commands applied'\n+\n+          issue.reload\n+\n+          expect(issue.weight).to eq(5)\n+        end\n+      end\n+\n+      context 'when the current user cannot update the weight' do\n+        let(:guest) { create(:user) }\n+        before do\n+          project.add_guest(guest)\n+          gitlab_sign_out\n+          sign_in(guest)\n+          visit project_issue_path(project, issue)\n+        end\n+\n+        it 'does not create a note or set the weight' do\n+          add_note(\"/weight 5\")\n+\n+          expect(page).not_to have_content 'Commands applied'\n+\n+          issue.reload\n+\n+          expect(issue.weight).not_to eq(5)\n+        end\n+      end\n+    end\n+\n+    describe 'removing weight from a note' do\n+      let(:issue) { create(:issue, project: project, weight: 1) }\n+\n+      context 'when the user can update the weight' do\n+        it 'does not create a note, and removes the weight accordingly' do\n+          add_note(\"/clear_weight\")\n+\n+          expect(page).not_to have_content '/clear_weight'\n+          expect(page).to have_content 'Commands applied'\n+\n+          issue.reload\n+\n+          expect(issue.weight).to eq(nil)\n+        end\n+      end\n+\n+      context 'when the current user cannot update the weight' do\n+        let(:guest) { create(:user) }\n+        before do\n+          project.add_guest(guest)\n+          gitlab_sign_out\n+          sign_in(guest)\n+          visit project_issue_path(project, issue)\n+        end\n+\n+        it 'does create a note or set the weight' do\n+          add_note(\"/clear_weight\")\n+\n+          expect(page).not_to have_content 'Commands applied'\n+\n+          issue.reload\n+\n+          expect(issue.weight).to eq(1)\n+        end\n+      end\n+    end\n+\n     describe 'mark issue as duplicate' do\n       let(:issue) { create(:issue, project: project) }\n       let(:original_issue) { create(:issue, project: project) }\n```\n\n\u003c/details\u003e","state":"closed","created_at":"2018-06-21T14:24:11.462Z","updated_at":"2022-05-19T17:57:38.513Z","closed_at":"2019-04-15T12:14:20.421Z","closed_by":{"id":15139,"username":"rspeicher","name":"Robert Speicher","state":"active","avatar_url":"https://secure.gravatar.com/avatar/73c8253932541a7b5cbc5d79493f2bea?s=80\u0026d=identicon","web_url":"https://gitlab.com/rspeicher"},"labels":["Enterprise Edition","Quality","backend","backstage [DEPRECATED]","devops::plan","single codebase","test","workflow::in review"],"milestone":{"id":655280,"iid":28,"group_id":9970,"title":"11.11","description":"","state":"closed","created_at":"2018-09-21T19:08:37.027Z","updated_at":"2019-06-10T14:39:00.009Z","due_date":"2019-05-22","start_date":"2019-04-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/28"},"assignees":[{"id":426128,"username":"felipe_artur","name":"Felipe Artur","state":"active","avatar_url":"https://secure.gravatar.com/avatar/dbad92659914f56621cbdd726e283e60?s=80\u0026d=identicon","web_url":"https://gitlab.com/felipe_artur"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":426128,"username":"felipe_artur","name":"Felipe Artur","state":"active","avatar_url":"https://secure.gravatar.com/avatar/dbad92659914f56621cbdd726e283e60?s=80\u0026d=identicon","web_url":"https://gitlab.com/felipe_artur"},"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6538","time_stats":{"time_estimate":28800,"total_time_spent":0,"human_time_estimate":"8h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6538","notes":"https://gitlab.com/api/v4/projects/278964/issues/6538/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6538/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6538","relative":"#6538","full":"gitlab-org/gitlab#6538"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12226794,"iid":6536,"project_id":278964,"title":"Extract EE specific files/lines for spec/controllers/groups","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003espec/controllers/groups/boards_controller_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/controllers/groups/boards_controller_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/controllers/groups/boards_controller_spec.rb\nindex 4228e727b52..d57479673c3 100644\n--- a/spec/controllers/groups/boards_controller_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/controllers/groups/boards_controller_spec.rb\n@@ -77,7 +77,7 @@ describe Groups::BoardsController do\n \n     context 'when format is JSON' do\n       it 'return an array with one group board' do\n-        create(:board, group: group)\n+        create(:board, group: group, milestone: create(:milestone, group: group))\n \n         expect(Boards::Visits::LatestService).not_to receive(:new)\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/controllers/groups/group_members_controller_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/controllers/groups/group_members_controller_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/controllers/groups/group_members_controller_spec.rb\nindex 3a801fabafc..4a5d9c98787 100644\n--- a/spec/controllers/groups/group_members_controller_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/controllers/groups/group_members_controller_spec.rb\n@@ -54,6 +54,14 @@ describe Groups::GroupMembersController do\n         expect(group.users).to include group_user\n       end\n \n+      it 'creates an audit event' do\n+        expect do\n+          post :create, params: { group_id: group,\n+                                  user_ids: group_user.id,\n+                                  access_level: Gitlab::Access::GUEST }\n+        end.to change(AuditEvent, :count).by(1)\n+      end\n+\n       it 'adds no user to members' do\n         post :create, params: {\n                         group_id: group,\n@@ -174,6 +182,10 @@ describe Groups::GroupMembersController do\n           expect(response).to have_gitlab_http_status(200)\n           expect(json_response['notice']).to eq \"You left the \\\"#{group.name}\\\" group.\"\n         end\n+\n+        it 'creates an audit event' do\n+          expect { delete :leave, params: { group_id: group } }.to change(AuditEvent, :count).by(1)\n+        end\n       end\n \n       context 'and is an owner' do\n@@ -186,6 +198,10 @@ describe Groups::GroupMembersController do\n \n           expect(response).to have_gitlab_http_status(403)\n         end\n+\n+        it 'does not create an audit event' do\n+          expect { delete :leave, params: { group_id: group } }.not_to change(AuditEvent, :count)\n+        end\n       end\n \n       context 'and is a requester' do\n@@ -201,6 +217,10 @@ describe Groups::GroupMembersController do\n           expect(group.requesters).to be_empty\n           expect(group.users).not_to include user\n         end\n+\n+        it 'creates an audit event' do\n+          expect { delete :leave, params: { group_id: group } }.to change(AuditEvent, :count).by(1)\n+        end\n       end\n     end\n   end\n```\n\n\u003c/details\u003e\n","state":"closed","created_at":"2018-06-21T13:44:09.179Z","updated_at":"2019-08-12T15:32:56.733Z","closed_at":"2019-04-08T14:21:47.401Z","closed_by":{"id":128633,"username":"rymai","name":"R√©my Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"},"labels":["Enterprise Edition","Plan [DEPRECATED]","Quality","backend","backstage [DEPRECATED]","single codebase","test"],"milestone":{"id":655280,"iid":28,"group_id":9970,"title":"11.11","description":"","state":"closed","created_at":"2018-09-21T19:08:37.027Z","updated_at":"2019-06-10T14:39:00.009Z","due_date":"2019-05-22","start_date":"2019-04-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/28"},"assignees":[{"id":426128,"username":"felipe_artur","name":"Felipe Artur","state":"active","avatar_url":"https://secure.gravatar.com/avatar/dbad92659914f56621cbdd726e283e60?s=80\u0026d=identicon","web_url":"https://gitlab.com/felipe_artur"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":426128,"username":"felipe_artur","name":"Felipe Artur","state":"active","avatar_url":"https://secure.gravatar.com/avatar/dbad92659914f56621cbdd726e283e60?s=80\u0026d=identicon","web_url":"https://gitlab.com/felipe_artur"},"user_notes_count":0,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6536","time_stats":{"time_estimate":28800,"total_time_spent":0,"human_time_estimate":"8h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6536","notes":"https://gitlab.com/api/v4/projects/278964/issues/6536/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6536/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6536","relative":"#6536","full":"gitlab-org/gitlab#6536"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12225712,"iid":6535,"project_id":278964,"title":"Extract EE specific files/lines for spec/views","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003espec/views/layouts/_head.html.haml_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/views/layouts/_head.html.haml_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/views/layouts/_head.html.haml_spec.rb\nindex cbb4199954a..41d2fa5b91e 100644\n--- a/spec/views/layouts/_head.html.haml_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/views/layouts/_head.html.haml_spec.rb\n@@ -62,12 +62,21 @@ describe 'layouts/_head' do\n     end\n   end\n \n-  it 'adds selected syntax highlight stylesheet' do\n-    allow_any_instance_of(PreferencesHelper).to receive(:user_color_scheme).and_return(\"solarised-light\")\n+  context 'when an asset_host is set and snowplow url is set' do\n+    let(:asset_host) { 'http://test.host' }\n \n-    render\n+    before do\n+      allow(ActionController::Base).to receive(:asset_host).and_return(asset_host)\n+      allow(Gitlab::CurrentSettings).to receive(:snowplow_enabled?).and_return(true)\n+      allow(Gitlab::CurrentSettings).to receive(:snowplow_collector_uri).and_return('www.snow.plow')\n+    end\n \n-    expect(rendered).to match('\u003clink rel=\"stylesheet\" media=\"all\" href=\"/stylesheets/highlight/themes/solarised-light.css\" /\u003e')\n+    it 'add a snowplow script tag with asset host' do\n+      render\n+      expect(rendered).to match('http://test.host/assets/snowplow/')\n+      expect(rendered).to match('window.snowplow')\n+      expect(rendered).to match('www.snow.plow')\n+    end\n   end\n \n   def stub_helper_with_safe_string(method)\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/views/layouts/nav/sidebar/_project.html.haml_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/views/layouts/nav/sidebar/_project.html.haml_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/views/layouts/nav/sidebar/_project.html.haml_spec.rb\nindex d9f05e5f94f..6d0628d6012 100644\n--- a/spec/views/layouts/nav/sidebar/_project.html.haml_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/views/layouts/nav/sidebar/_project.html.haml_spec.rb\n@@ -15,6 +15,15 @@ describe 'layouts/nav/sidebar/_project' do\n     it 'has board tab' do\n       render\n \n+      expect(rendered).to have_css('a[title=\"Boards\"]')\n+    end\n+\n+    it 'has board tab when multiple issue boards is not available' do\n+      allow(License).to receive(:feature_available?).and_call_original\n+      allow(License).to receive(:feature_available?).with(:multiple_project_issue_boards) { false }\n+\n+      render\n+\n       expect(rendered).to have_css('a[title=\"Board\"]')\n     end\n   end\n```\n\n\u003c/details\u003e\n\u003cbr\u003e\n\nMarking as discussion because there's a difference regarding issue boards.","state":"closed","created_at":"2018-06-21T13:17:25.679Z","updated_at":"2019-08-12T15:32:56.735Z","closed_at":"2019-04-08T09:32:37.913Z","closed_by":{"id":128633,"username":"rymai","name":"R√©my Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"},"labels":["Enterprise Edition","Plan [DEPRECATED]","Quality","backend","backstage [DEPRECATED]","single codebase","test","workflow::in review"],"milestone":{"id":655279,"iid":27,"group_id":9970,"title":"11.10","description":"","state":"closed","created_at":"2018-09-21T19:08:16.261Z","updated_at":"2019-05-21T09:17:49.051Z","due_date":"2019-04-22","start_date":"2019-03-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/27"},"assignees":[{"id":194645,"username":"digitalmoksha","name":"Brett Walker","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/194645/avatar.png","web_url":"https://gitlab.com/digitalmoksha"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":194645,"username":"digitalmoksha","name":"Brett Walker","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/194645/avatar.png","web_url":"https://gitlab.com/digitalmoksha"},"user_notes_count":0,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6535","time_stats":{"time_estimate":28800,"total_time_spent":0,"human_time_estimate":"8h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6535","notes":"https://gitlab.com/api/v4/projects/278964/issues/6535/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6535/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6535","relative":"#6535","full":"gitlab-org/gitlab#6535"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12199631,"iid":6528,"project_id":278964,"title":"Move Gemnasium Maven plugin to GitLab","description":"### Problem to solve\n\nCurrently, the source code of the Gemnasium Maven plugin is hosted on GitHub.\nWe must migrate this repo to GitLab, and update the package on Maven Central accordingly:\n\nhttps://github.com/gemnasium/gemnasium-maven-plugin\n\n/cc @bikebilly\n\n### Intended users\n\n* GitLab security composition and analysis team\n\n### Further details\n\n### Proposal\n\nUpdate maven gemnasium-maven-plugin repo to be synced to the source in gitlab.\n\n### Implementation plan\n\n1. [x] Generate credentials for updating and publishing to maven\n1. [x] Create ci config for [plugin](https://gitlab.com/gitlab-org/security-products/analyzers/gemnasium-maven-plugin) to push changes to maven automatically\n1. [x] Do a push to update the source reference in pom.xml\n\n### Permissions and Security\n\nCurrent owner of the maven repo (@gonzoyumo) will need to generate credentials for updating this repo. They will be hosted under the plugin's project config. \n\n### Documentation\n\nNo change.\n\n### Testing\n\nRe-run the gemnasium-maven qa pipelines to ensure everything continues to run as normal.\n\n### What does success look like\n\nThe gemnasium-maven plugin works exactly as it did before this change.\n\n### What is the type of buyer\n\n~\"GitLab Ultimate\"\n\n### Links / references\n\ngemnasium-maven-plugin is included [here](https://gitlab.com/gitlab-org/security-products/analyzers/gemnasium-maven/blob/3d4756867054c628302060b5cd729c505b9a1fc9/analyze.go#L75)","state":"closed","created_at":"2018-06-20T20:10:16.856Z","updated_at":"2020-03-18T07:10:57.952Z","closed_at":"2020-03-18T04:56:58.733Z","closed_by":{"id":52092,"username":"gonzoyumo","name":"Olivier Gonzalez","state":"active","avatar_url":"https://secure.gravatar.com/avatar/651e0ff81c3995a05269f7c80895fe89?s=80\u0026d=identicon","web_url":"https://gitlab.com/gonzoyumo"},"labels":["Category:Dependency Scanning","Deliverable","Enterprise Edition","auto updated","awaiting feedback","backend","backstage [DEPRECATED]","devops::secure","group::composition analysis","workflow::in review"],"milestone":{"id":1001916,"iid":44,"group_id":9970,"title":"12.9","description":"https://about.gitlab.com/releases/2020/03/22/gitlab-12-9-released","state":"closed","created_at":"2019-09-15T20:54:50.875Z","updated_at":"2020-09-02T11:04:41.671Z","due_date":"2020-03-17","start_date":"2020-02-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/44"},"assignees":[{"id":52092,"username":"gonzoyumo","name":"Olivier Gonzalez","state":"active","avatar_url":"https://secure.gravatar.com/avatar/651e0ff81c3995a05269f7c80895fe89?s=80\u0026d=identicon","web_url":"https://gitlab.com/gonzoyumo"}],"author":{"id":30915,"username":"plafoucriere","name":"Philippe Lafoucri√®re","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/30915/avatar.png","web_url":"https://gitlab.com/plafoucriere"},"type":"ISSUE","assignee":{"id":52092,"username":"gonzoyumo","name":"Olivier Gonzalez","state":"active","avatar_url":"https://secure.gravatar.com/avatar/651e0ff81c3995a05269f7c80895fe89?s=80\u0026d=identicon","web_url":"https://gitlab.com/gonzoyumo"},"user_notes_count":29,"merge_requests_count":0,"upvotes":2,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6528","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":3,"completed_count":3},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"3 of 3 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6528","notes":"https://gitlab.com/api/v4/projects/278964/issues/6528/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6528/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6528","relative":"#6528","full":"gitlab-org/gitlab#6528"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2630,"epic":{"id":19291,"iid":2630,"title":"Technial Debt - Dependency scanning","url":"/groups/gitlab-org/-/epics/2630","group_id":9970,"human_readable_end_date":"Mar 17, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":24664489,"iid":22879,"project_id":278964,"title":"JIRA Integration does not transition issue from merge request","description":"\u003c!---\nPlease read this!\n\nBefore opening a new issue, make sure to search for keywords in the issues\nfiltered by the \"regression\" or \"bug\" label.\n\nFor the Community Edition issue tracker:\n\n- https://gitlab.com/gitlab-org/gitlab-ce/issues?label_name%5B%5D=regression\n- https://gitlab.com/gitlab-org/gitlab-ce/issues?label_name%5B%5D=bug\n\nFor the Enterprise Edition issue tracker:\n\n- https://gitlab.com/gitlab-org/gitlab-ee/issues?label_name%5B%5D=regression\n- https://gitlab.com/gitlab-org/gitlab-ee/issues?label_name%5B%5D=bug\n\nand verify the issue you're about to submit isn't a duplicate.\n---\u003e\n\n### Summary\n\nGitLab sees a JIRA issue as \"Closed\" when it hasn't actually closed the issue.\n\n- Accept Merge Request that closes a JIRA issue (`Fixes EN-9` is in the MR description)\n    - In the widget, `Closes EN-9` is specified.\n- After MR is accepted, we see the following:\n![firefox_2018-06-20_14-04-07](/uploads/78068fe03b4037ecb134cdd0a90dd7af/firefox_2018-06-20_14-04-07.png)\n\nThe issue in JIRA is not transitioned. A link mentioning the merge commit is added:\n![firefox_2018-06-20_14-09-17](/uploads/bfa865aa35468ab010d010796d77f1cd/firefox_2018-06-20_14-09-17.png)\n\n`develop` is the Default Branch specified in project settings.\n\nI tested a *manual* POST to `https://our_jira_instance/rest/api/2/issue/EN-9/transitions` with `{ \"transition\": { \"id\": 41 } }` specified in the JSON body, it successfully transitioned the issue:![firefox_2018-06-20_14-13-47](/uploads/142a790fb1832bd8c3fe44f157e3b50b/firefox_2018-06-20_14-13-47.png)\n\nI believe our JIRA Integration settings are correct:\n\n![firefox_2018-06-20_14-14-59](/uploads/76488a0408c49ff3a8dd2efc0e461aac/firefox_2018-06-20_14-14-59.png)\n\n### Steps to reproduce\n\nSee: Summary\n\n### What is the current *bug* behavior?\n\n- Accept MR that specifies a JIRA issue as Fixed\n- GitLab adds a mention to MR commit in JIRA, and shows `Closed ###` in the MR widget.\n- Issue is not transitioned\n\n### What is the expected *correct* behavior?\n\n- Accept MR that specifies a JIRA issue as Fixed\n- GitLab adds a mention to MR commit in JIRA, and shows `Closed ###` in the MR widget.\n- Issue is transitioned correctly in JIRA\n\n### Relevant logs and/or screenshots\n\nLooking through various GitLab logs and in `atlassian-jira.log`, there are NO mentions of failure. It may be possible that [JiraService::close_issue](https://gitlab.com/gitlab-org/gitlab-ce/blob/master/app/models/project_services/jira_service.rb#L111) is not being called?\n```\n***!188 - Post merge finished on JID 32b19d0aa6be0d7947a5b420 with state merged\n***!188 - Merge process finished on JID  with state merged\nCompleted 200 OK in 249ms (Views: 186.8ms | ActiveRecord: 21.3ms)\nCompleted 200 OK in 515ms (Views: 5.0ms | ActiveRecord: 59.3ms)\nJiraService SUCCESS: Successfully posted to https://our_jira_instance.\n```\n\nThe SUCCESS here is likely the commit mention.\n\n#### Results of GitLab environment info\n\n\u003cdetails\u003e\n\u003csummary\u003eExpand for output related to GitLab environment info\u003c/summary\u003e\n\u003cpre\u003e\nSystem information\nSystem:         Debian 7.11\nCurrent User:   git\nUsing RVM:      no\nRuby Version:   2.3.7p456\nGem Version:    2.6.14\nBundler Version:1.13.7\nRake Version:   12.3.1\nRedis Version:  3.2.11\nGit Version:    2.16.4\nSidekiq Version:5.0.5\nGo Version:     unknown\n\nGitLab information\nVersion:        10.8.4\nRevision:       2268d0c\nDirectory:      /opt/gitlab/embedded/service/gitlab-rails\nDB Adapter:     postgresql\nURL:            https://***\nHTTP Clone URL: https://***\nSSH Clone URL:  git@***:some-group/some-project.git\nUsing LDAP:     yes\nUsing Omniauth: no\n\nGitLab Shell\nVersion:        7.1.2\nRepository storage paths:\n- default:      /var/opt/gitlab/git-data/repositories\nHooks:          /opt/gitlab/embedded/service/gitlab-shell/hooks\nGit:            /opt/gitlab/embedded/bin/git\n\u003c/pre\u003e\n\u003c/details\u003e\n\n#### Results of GitLab application Check\n\n\u003cdetails\u003e\n\u003csummary\u003eExpand for output related to the GitLab application check\u003c/summary\u003e\n\u003cpre\u003e\nChecking GitLab Shell ...\n\nGitLab Shell version \u003e= 7.1.2 ? ... OK (7.1.2)\nRepo base directory exists?\ndefault... yes\nRepo storage directories are symlinks?\ndefault... no\nRepo paths owned by git:root, or git:git?\ndefault... yes\nRepo paths access is drwxrws---?\ndefault... yes\nhooks directories in repos are links: ...\n4/1 ... ok\n7/2 ... ok\n8/3 ... ok\n2/4 ... ok\n2/5 ... ok\n12/6 ... ok\n12/7 ... ok\n4/9 ... ok\n12/10 ... ok\n12/11 ... ok\n12/12 ... ok\n12/13 ... ok\n8/14 ... ok\n4/15 ... ok\n17/16 ... ok\n24/18 ... ok\n24/19 ... ok\n7/20 ... ok\n33/21 ... ok\n3/23 ... ok\n17/24 ... ok\n34/25 ... ok\n8/26 ... ok\n17/28 ... ok\n10/31 ... ok\n2/32 ... ok\n10/33 ... ok\n8/34 ... ok\n4/35 ... ok\n4/36 ... ok\n12/37 ... ok\n10/38 ... ok\n30/39 ... ok\n2/41 ... ok\n12/42 ... ok\n4/44 ... ok\n3/47 ... ok\n17/48 ... ok\n64/49 ... ok\n17/50 ... ok\n17/51 ... ok\n4/52 ... ok\n10/53 ... ok\n17/54 ... ok\n4/55 ... ok\n61/57 ... repository is empty\n4/58 ... ok\n4/59 ... ok\n4/60 ... ok\n4/61 ... ok\n4/62 ... repository is empty\n10/63 ... ok\n4/64 ... ok\n12/65 ... repository is empty\n14/66 ... ok\n2/67 ... ok\n12/68 ... ok\n2/70 ... ok\n2/71 ... ok\n2/72 ... ok\n2/73 ... ok\n2/74 ... ok\n17/77 ... ok\n40/80 ... ok\n10/81 ... ok\n12/82 ... ok\n12/83 ... ok\n17/84 ... ok\n7/86 ... ok\n7/87 ... ok\n7/88 ... ok\n7/89 ... ok\n45/90 ... ok\n45/91 ... ok\n45/92 ... ok\n45/93 ... ok\n7/94 ... ok\n64/95 ... ok\n17/96 ... ok\n17/97 ... ok\n3/98 ... ok\n10/99 ... ok\n10/100 ... ok\n17/101 ... ok\n10/103 ... ok\n7/105 ... ok\n2/106 ... ok\n3/107 ... ok\n10/108 ... ok\n17/109 ... ok\n17/110 ... ok\n17/111 ... ok\n17/112 ... ok\n72/113 ... ok\n23/114 ... ok\n17/115 ... ok\n7/116 ... ok\n17/117 ... ok\n7/119 ... ok\n17/120 ... ok\n10/122 ... ok\n7/123 ... ok\n10/124 ... ok\n17/125 ... ok\n10/126 ... ok\n45/127 ... ok\n75/128 ... ok\n75/129 ... ok\n75/130 ... ok\n75/132 ... ok\n76/133 ... ok\n76/134 ... repository is empty\n2/135 ... ok\n7/136 ... ok\n17/139 ... ok\n72/140 ... ok\n76/141 ... ok\n79/142 ... repository is empty\n10/143 ... ok\n10/144 ... ok\n17/145 ... ok\n82/146 ... ok\n82/147 ... ok\n45/148 ... repository is empty\n80/150 ... ok\n79/151 ... ok\n79/152 ... ok\n80/154 ... ok\n76/156 ... ok\n76/157 ... ok\n79/158 ... ok\n10/159 ... ok\n17/161 ... ok\n7/162 ... ok\n82/163 ... ok\n84/165 ... ok\n76/166 ... ok\n17/167 ... ok\n84/168 ... ok\n82/169 ... ok\n2/170 ... ok\n80/171 ... ok\n84/172 ... ok\n17/173 ... ok\n2/174 ... ok\n17/175 ... ok\n79/176 ... ok\n79/177 ... repository is empty\n85/180 ... ok\n85/181 ... ok\n85/182 ... repository is empty\n85/183 ... ok\n10/184 ... ok\n2/185 ... ok\n2/186 ... ok\n84/187 ... ok\n2/188 ... ok\nRunning /opt/gitlab/embedded/service/gitlab-shell/bin/check\nCheck GitLab API access: OK\nRedis available via internal API: OK\n\nAccess to /var/opt/gitlab/.ssh/authorized_keys: OK\ngitlab-shell self-check successful\n\nChecking GitLab Shell ... Finished\n\nChecking Sidekiq ...\n\nRunning? ... yes\nNumber of Sidekiq processes ... 1\n\nChecking Sidekiq ... Finished\n\nReply by email is disabled in config/gitlab.yml\nChecking LDAP ...\n\nServer: ldapmain\nLDAP authentication... Success\nLDAP users with access to your GitLab server (only showing the first 100 results)\n        - snip -\n\nChecking LDAP ... Finished\n\nChecking GitLab ...\n\nGit configured correctly? ... yes\nDatabase config exists? ... yes\nAll migrations up? ... yes\nDatabase contains orphaned GroupMembers? ... no\nGitLab config exists? ... yes\nGitLab config up to date? ... yes\nLog directory writable? ... yes\nTmp directory writable? ... yes\nUploads directory exists? ... yes\nUploads directory has correct permissions? ... yes\nUploads directory tmp has correct permissions? ... yes\nInit script exists? ... skipped (omnibus-gitlab has no init script)\nInit script up-to-date? ... skipped (omnibus-gitlab has no init script)\nProjects have namespace: ...\n4/1 ... yes\n7/2 ... yes\n8/3 ... yes\n2/4 ... yes\n2/5 ... yes\n12/6 ... yes\n12/7 ... yes\n4/9 ... yes\n12/10 ... yes\n12/11 ... yes\n12/12 ... yes\n12/13 ... yes\n8/14 ... yes\n4/15 ... yes\n17/16 ... yes\n24/18 ... yes\n24/19 ... yes\n7/20 ... yes\n33/21 ... yes\n3/23 ... yes\n17/24 ... yes\n34/25 ... yes\n8/26 ... yes\n17/28 ... yes\n10/31 ... yes\n2/32 ... yes\n10/33 ... yes\n8/34 ... yes\n4/35 ... yes\n4/36 ... yes\n12/37 ... yes\n10/38 ... yes\n30/39 ... yes\n2/41 ... yes\n12/42 ... yes\n4/44 ... yes\n3/47 ... yes\n17/48 ... yes\n64/49 ... yes\n17/50 ... yes\n17/51 ... yes\n4/52 ... yes\n10/53 ... yes\n17/54 ... yes\n4/55 ... yes\n61/57 ... yes\n4/58 ... yes\n4/59 ... yes\n4/60 ... yes\n4/61 ... yes\n4/62 ... yes\n10/63 ... yes\n4/64 ... yes\n12/65 ... yes\n14/66 ... yes\n2/67 ... yes\n12/68 ... yes\n2/70 ... yes\n2/71 ... yes\n2/72 ... yes\n2/73 ... yes\n2/74 ... yes\n17/77 ... yes\n40/80 ... yes\n10/81 ... yes\n12/82 ... yes\n12/83 ... yes\n17/84 ... yes\n7/86 ... yes\n7/87 ... yes\n7/88 ... yes\n7/89 ... yes\n45/90 ... yes\n45/91 ... yes\n45/92 ... yes\n45/93 ... yes\n7/94 ... yes\n64/95 ... yes\n17/96 ... yes\n17/97 ... yes\n3/98 ... yes\n10/99 ... yes\n10/100 ... yes\n17/101 ... yes\n10/103 ... yes\n7/105 ... yes\n2/106 ... yes\n3/107 ... yes\n10/108 ... yes\n17/109 ... yes\n17/110 ... yes\n17/111 ... yes\n17/112 ... yes\n72/113 ... yes\n23/114 ... yes\n17/115 ... yes\n7/116 ... yes\n17/117 ... yes\n7/119 ... yes\n17/120 ... yes\n10/122 ... yes\n7/123 ... yes\n10/124 ... yes\n17/125 ... yes\n10/126 ... yes\n45/127 ... yes\n75/128 ... yes\n75/129 ... yes\n75/130 ... yes\n75/132 ... yes\n76/133 ... yes\n76/134 ... yes\n2/135 ... yes\n7/136 ... yes\n17/139 ... yes\n72/140 ... yes\n76/141 ... yes\n79/142 ... yes\n10/143 ... yes\n10/144 ... yes\n17/145 ... yes\n82/146 ... yes\n82/147 ... yes\n45/148 ... yes\n80/150 ... yes\n79/151 ... yes\n79/152 ... yes\n80/154 ... yes\n76/156 ... yes\n76/157 ... yes\n79/158 ... yes\n10/159 ... yes\n17/161 ... yes\n7/162 ... yes\n82/163 ... yes\n84/165 ... yes\n76/166 ... yes\n17/167 ... yes\n84/168 ... yes\n82/169 ... yes\n2/170 ... yes\n80/171 ... yes\n84/172 ... yes\n17/173 ... yes\n2/174 ... yes\n17/175 ... yes\n79/176 ... yes\n79/177 ... yes\n85/180 ... yes\n85/181 ... yes\n85/182 ... yes\n85/183 ... yes\n10/184 ... yes\n2/185 ... yes\n2/186 ... yes\n84/187 ... yes\n2/188 ... yes\nRedis version \u003e= 2.8.0? ... yes\nRuby version \u003e= 2.3.5 ? ... yes (2.3.7)\nGit version \u003e= 2.9.5 ? ... yes (2.16.4)\nGit user has default SSH configuration? ... yes\nActive users: ... 26\n\nChecking GitLab ... Finished\n\u003c/pre\u003e\n\u003c/details\u003e\n\n### Possible fixes\n\nMaybe related to gitlab-ce#29114.","state":"closed","created_at":"2018-06-20T18:31:59.689Z","updated_at":"2022-11-22T20:21:56.141Z","closed_at":"2019-10-03T12:15:16.445Z","closed_by":{"id":1315742,"username":"arturoherrero","name":"Arturo Herrero","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1315742/avatar.png","web_url":"https://gitlab.com/arturoherrero"},"labels":["Deliverable","Integration::Jira","customer","devops::manage","group::ecosystem [DEPRECATED]","priority::3","severity::3","type::bug"],"milestone":{"id":731039,"iid":38,"group_id":9970,"title":"12.4","description":"https://about.gitlab.com/releases/2019/10/22/gitlab-12-4-released","state":"closed","created_at":"2018-12-07T12:41:53.212Z","updated_at":"2020-04-27T16:30:43.889Z","due_date":"2019-10-17","start_date":"2019-09-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/38"},"assignees":[{"id":1315742,"username":"arturoherrero","name":"Arturo Herrero","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1315742/avatar.png","web_url":"https://gitlab.com/arturoherrero"}],"author":{"id":389812,"username":"rstyrczu","name":"Ryan Styrczula","state":"active","avatar_url":"https://secure.gravatar.com/avatar/9f5e20a8f562731a2b8e53fd61b1d95d?s=80\u0026d=identicon","web_url":"https://gitlab.com/rstyrczu"},"type":"ISSUE","assignee":{"id":1315742,"username":"arturoherrero","name":"Arturo Herrero","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1315742/avatar.png","web_url":"https://gitlab.com/arturoherrero"},"user_notes_count":18,"merge_requests_count":0,"upvotes":10,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/22879","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/22879","notes":"https://gitlab.com/api/v4/projects/278964/issues/22879/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/22879/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#22879","relative":"#22879","full":"gitlab-org/gitlab#22879"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1522,"epic":{"id":8628,"iid":1522,"title":"Jira Integration","url":"/groups/gitlab-org/-/epics/1522","group_id":9970},"iteration":null,"health_status":null},{"id":12192751,"iid":6524,"project_id":278964,"title":"Extract EE specific files/lines for lib/gitlab/import_export","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003elib/gitlab/import_export/import_export.yml\u003c/summary\u003e\n\n```diff\ndiff --git a/lib/gitlab/import_export/import_export.yml b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/gitlab/import_export/import_export.yml\nindex fa54fc17d95..79668a4e4c8 100644\n--- a/lib/gitlab/import_export/import_export.yml\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/lib/gitlab/import_export/import_export.yml\n@@ -66,6 +66,9 @@ project_tree:\n   - protected_branches:\n     - :merge_access_levels\n     - :push_access_levels\n+    - :unprotect_access_levels\n+  - protected_environments:\n+    - :deploy_access_levels\n   - protected_tags:\n     - :create_access_levels\n   - :project_feature\n@@ -112,10 +115,18 @@ excluded_attributes:\n     - :last_activity_at\n     - :last_repository_updated_at\n     - :last_repository_check_at\n+    - :mirror_user_id\n+    - :mirror_trigger_builds\n     - :storage_version\n     - :remote_mirror_available_overridden\n+    - :only_mirror_protected_branches\n+    - :pull_mirror_available_overridden\n+    - :mirror_overwrites_diverged_branches\n     - :description_html\n     - :repository_languages\n+    - :packages_enabled\n+    - :mirror_last_update_at\n+    - :mirror_last_successful_update_at\n     - :bfg_object_map\n   namespaces:\n     - :runners_token\n@@ -123,6 +134,8 @@ excluded_attributes:\n   project_import_state:\n     - :last_error\n     - :jid\n+    - :last_update_at\n+    - :last_successful_update_at\n   prometheus_metrics:\n     - :common\n     - :identifier\n```\n\n\u003c/details\u003e\n\u003cbr\u003e\nPer https://gitlab.com/gitlab-org/gitlab-ee/merge_requests/10430#note_156092283, we need to backport the changes EE makes to `lib/gitlab/import_export/import_export.yml` to CE. This requires that we first backport the EE schema to CE, otherwise many tests will fail. \n\n## :warning: Blocked by\n\n* https://gitlab.com/gitlab-org/gitlab-ee/issues/9686","state":"closed","created_at":"2018-06-20T16:20:32.635Z","updated_at":"2019-08-12T15:32:57.721Z","closed_at":"2019-06-19T12:13:31.436Z","closed_by":{"id":209240,"username":"yorickpeterse","name":"Yorick Peterse","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/209240/avatar.png","web_url":"https://gitlab.com/yorickpeterse"},"labels":["DEPRECATED_import","Deliverable","Enterprise Edition","Manage [DEPRECATED]","backend","backstage [DEPRECATED]","devops::manage","group::import","missed-deliverable","missed:11.10","priority::2","single codebase","test","workflow::blocked"],"milestone":{"id":693518,"iid":33,"group_id":9970,"title":"12.0","description":"https://about.gitlab.com/releases/2019/06/22/gitlab-12-0-released/","state":"closed","created_at":"2018-10-30T16:47:37.975Z","updated_at":"2020-04-22T19:51:03.475Z","due_date":"2019-06-22","start_date":"2019-05-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/33"},"assignees":[{"id":209240,"username":"yorickpeterse","name":"Yorick Peterse","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/209240/avatar.png","web_url":"https://gitlab.com/yorickpeterse"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":209240,"username":"yorickpeterse","name":"Yorick Peterse","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/209240/avatar.png","web_url":"https://gitlab.com/yorickpeterse"},"user_notes_count":16,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6524","time_stats":{"time_estimate":144000,"total_time_spent":0,"human_time_estimate":"40h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6524","notes":"https://gitlab.com/api/v4/projects/278964/issues/6524/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6524/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6524","relative":"#6524","full":"gitlab-org/gitlab#6524"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12192038,"iid":6520,"project_id":278964,"title":"Extract EE specific files/lines for spec/requests","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003espec/requests/git_http_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/requests/git_http_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/requests/git_http_spec.rb\nindex 5b625fd47be..60fedd85e11 100644\n--- a/spec/requests/git_http_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/requests/git_http_spec.rb\n@@ -704,6 +704,115 @@ describe 'Git HTTP requests' do\n             end\n           end\n         end\n+\n+        context \"when Kerberos token is provided\" do\n+          let(:env) { { spnego_request_token: 'opaque_request_token' } }\n+\n+          before do\n+            allow_any_instance_of(Projects::GitHttpController).to receive(:allow_kerberos_spnego_auth?).and_return(true)\n+          end\n+\n+          context \"when authentication fails because of invalid Kerberos token\" do\n+            before do\n+              allow_any_instance_of(Projects::GitHttpController).to receive(:spnego_credentials!).and_return(nil)\n+            end\n+\n+            it \"responds with status 401 Unauthorized\" do\n+              download(path, env) do |response|\n+                expect(response).to have_gitlab_http_status(:unauthorized)\n+              end\n+            end\n+          end\n+\n+          context \"when authentication fails because of unknown Kerberos identity\" do\n+            before do\n+              allow_any_instance_of(Projects::GitHttpController).to receive(:spnego_credentials!).and_return(\"mylogin@FOO.COM\")\n+            end\n+\n+            it \"responds with status 401 Unauthorized\" do\n+              download(path, env) do |response|\n+                expect(response).to have_gitlab_http_status(:unauthorized)\n+              end\n+            end\n+          end\n+\n+          context \"when authentication succeeds\" do\n+            before do\n+              allow_any_instance_of(Projects::GitHttpController).to receive(:spnego_credentials!).and_return(\"mylogin@FOO.COM\")\n+              user.identities.create!(provider: \"kerberos\", extern_uid: \"mylogin@FOO.COM\")\n+            end\n+\n+            context \"when the user has access to the project\" do\n+              before do\n+                project.add_maintainer(user)\n+              end\n+\n+              context \"when the user is blocked\" do\n+                before do\n+                  user.block\n+                  project.add_maintainer(user)\n+                end\n+\n+                it \"responds with status 403 Forbidden\" do\n+                  download(path, env) do |response|\n+                    expect(response).to have_gitlab_http_status(:forbidden)\n+                  end\n+                end\n+              end\n+\n+              context \"when the user isn't blocked\", :redis do\n+                it \"responds with status 200 OK\" do\n+                  download(path, env) do |response|\n+                    expect(response).to have_gitlab_http_status(:ok)\n+                  end\n+                end\n+\n+                it 'updates the user last activity' do\n+                  expect(user.last_activity_on).to be_nil\n+\n+                  download(path, env) do |_response|\n+                    expect(user.reload.last_activity_on).to eql(Date.today)\n+                  end\n+                end\n+              end\n+\n+              it \"complies with RFC4559\" do\n+                allow_any_instance_of(Projects::GitHttpController).to receive(:spnego_response_token).and_return(\"opaque_response_token\")\n+                download(path, env) do |response|\n+                  expect(response.headers['WWW-Authenticate'].split(\"\\n\")).to include(\"Negotiate #{::Base64.strict_encode64('opaque_response_token')}\")\n+                end\n+              end\n+            end\n+\n+            context \"when the user doesn't have access to the project\" do\n+              it \"responds with status 404 Not Found\" do\n+                download(path, env) do |response|\n+                  expect(response).to have_gitlab_http_status(:not_found)\n+                end\n+              end\n+\n+              it \"complies with RFC4559\" do\n+                allow_any_instance_of(Projects::GitHttpController).to receive(:spnego_response_token).and_return(\"opaque_response_token\")\n+                download(path, env) do |response|\n+                  expect(response.headers['WWW-Authenticate'].split(\"\\n\")).to include(\"Negotiate #{::Base64.strict_encode64('opaque_response_token')}\")\n+                end\n+              end\n+            end\n+          end\n+        end\n+\n+        context 'when license is not provided' do\n+          let(:env) { { user: user.username, password: user.password } }\n+\n+          before do\n+            allow(License).to receive(:current).and_return(nil)\n+\n+            project.add_maintainer(user)\n+          end\n+\n+          it_behaves_like 'pulls are allowed'\n+          it_behaves_like 'pushes are allowed'\n+        end\n       end\n \n       context \"when the project path doesn't end in .git\" do\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/requests/lfs_http_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/requests/lfs_http_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/requests/lfs_http_spec.rb\nindex 1781759c54b..f3221429ba0 100644\n--- a/spec/requests/lfs_http_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/requests/lfs_http_spec.rb\n@@ -734,6 +734,34 @@ describe 'Git LFS API and storage' do\n           expect(json_response['objects'].first['actions']['upload']['href']).to eq(\"#{Gitlab.config.gitlab.url}/#{project.full_path}.git/gitlab-lfs/objects/#{sample_oid}/#{sample_size}\")\n           expect(json_response['objects'].first['actions']['upload']['header']).to eq({ 'Authorization' =\u003e authorization, 'Content-Type' =\u003e 'application/octet-stream' })\n         end\n+\n+        ## EE-specific context\n+        context 'and project is above the limit' do\n+          let(:update_lfs_permissions) do\n+            allow_any_instance_of(EE::Project).to receive_messages(\n+              repository_and_lfs_size: 100.megabytes,\n+              actual_size_limit: 99.megabytes)\n+          end\n+\n+          it 'responds with status 406' do\n+            expect(response).to have_gitlab_http_status(406)\n+            expect(json_response['message']).to eql('Your push has been rejected, because this repository has exceeded its size limit of 99 MB by 1 MB. Please contact your GitLab administrator for more information.')\n+          end\n+        end\n+\n+        context 'and project will go over the limit' do\n+          let(:update_lfs_permissions) do\n+            allow_any_instance_of(EE::Project).to receive_messages(\n+              repository_and_lfs_size: 200.megabytes,\n+              actual_size_limit: 300.megabytes)\n+          end\n+\n+          it 'responds with status 406' do\n+            expect(response).to have_gitlab_http_status(406)\n+            expect(json_response['documentation_url']).to include('/help')\n+            expect(json_response['message']).to eql('Your push has been rejected, because this repository has exceeded its size limit of 300 MB by 50 MB. Please contact your GitLab administrator for more information.')\n+          end\n+        end\n       end\n \n       describe 'when request is authenticated' do\n@@ -1177,6 +1205,20 @@ describe 'Git LFS API and storage' do\n             end\n           end\n \n+          context 'and project has limit enabled but will stay under the limit' do\n+            before do\n+              allow_any_instance_of(EE::Project).to receive_messages(\n+                actual_size_limit: 200,\n+                size_limit_enabled?: true)\n+\n+              put_finalize\n+            end\n+\n+            it 'responds with status 200' do\n+              expect(response).to have_gitlab_http_status(200)\n+            end\n+          end\n+\n           context 'invalid tempfiles' do\n             before do\n               lfs_object.destroy\n```\n\n\u003c/details\u003e\n","state":"closed","created_at":"2018-06-20T15:55:41.657Z","updated_at":"2019-08-12T15:32:58.078Z","closed_at":"2019-05-03T11:42:05.059Z","closed_by":{"id":209240,"username":"yorickpeterse","name":"Yorick Peterse","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/209240/avatar.png","web_url":"https://gitlab.com/yorickpeterse"},"labels":["Create [DEPRECATED]","Deliverable","Enterprise Edition","Quality","backend","backstage [DEPRECATED]","group::source code","single codebase","test","workflow::in review"],"milestone":{"id":655280,"iid":28,"group_id":9970,"title":"11.11","description":"","state":"closed","created_at":"2018-09-21T19:08:37.027Z","updated_at":"2019-06-10T14:39:00.009Z","due_date":"2019-05-22","start_date":"2019-04-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/28"},"assignees":[{"id":1884221,"username":"patrickbajao","name":"Patrick Bajao","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1884221/avatar.png","web_url":"https://gitlab.com/patrickbajao"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":1884221,"username":"patrickbajao","name":"Patrick Bajao","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1884221/avatar.png","web_url":"https://gitlab.com/patrickbajao"},"user_notes_count":0,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6520","time_stats":{"time_estimate":28800,"total_time_spent":0,"human_time_estimate":"8h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6520","notes":"https://gitlab.com/api/v4/projects/278964/issues/6520/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6520/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6520","relative":"#6520","full":"gitlab-org/gitlab#6520"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12191914,"iid":6519,"project_id":278964,"title":"Extract EE specific files/lines for spec/services/projects/update_service_spec.rb","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003espec/services/projects/update_service_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/services/projects/update_service_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/services/projects/update_service_spec.rb\nindex 90eaea9c872..94fcef0fcc5 100644\n--- a/spec/services/projects/update_service_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/services/projects/update_service_spec.rb\n@@ -1,6 +1,7 @@\n require 'spec_helper'\n \n-describe Projects::UpdateService do\n+describe Projects::UpdateService, '#execute' do\n+  include StubConfiguration\n   include ProjectForksHelper\n \n   let(:user) { create(:user) }\n@@ -418,6 +419,72 @@ describe Projects::UpdateService do\n     end\n   end\n \n+  describe 'repository_storage' do\n+    let(:admin_user) { create(:user, admin: true) }\n+    let(:user) { create(:user) }\n+    let(:project) { create(:project, :repository) }\n+    let(:opts) { { repository_storage: 'b' } }\n+\n+    before do\n+      FileUtils.mkdir('tmp/tests/storage_b')\n+\n+      storages = {\n+        'default' =\u003e Gitlab.config.repositories.storages.default,\n+        'b' =\u003e { 'path' =\u003e 'tmp/tests/storage_b' }\n+      }\n+      stub_storage_settings(storages)\n+    end\n+\n+    after do\n+      FileUtils.rm_rf('tmp/tests/storage_b')\n+    end\n+\n+    it 'calls the change repository storage method if the storage changed' do\n+      expect(project).to receive(:change_repository_storage).with('b')\n+\n+      update_project(project, admin_user, opts).inspect\n+    end\n+\n+    it \"doesn't call the change repository storage for non-admin users\" do\n+      expect(project).not_to receive(:change_repository_storage)\n+\n+      update_project(project, user, opts).inspect\n+    end\n+  end\n+\n+  context 'repository_size_limit assignment as Bytes' do\n+    let(:admin_user) { create(:user, admin: true) }\n+    let(:project) { create(:project, repository_size_limit: 0) }\n+\n+    context 'when param present' do\n+      let(:opts) { { repository_size_limit: '100' } }\n+\n+      it 'converts from MB to Bytes' do\n+        update_project(project, admin_user, opts)\n+\n+        expect(project.reload.repository_size_limit).to eql(100 * 1024 * 1024)\n+      end\n+    end\n+\n+    context 'when param not present' do\n+      let(:opts) { { repository_size_limit: '' } }\n+\n+      it 'assign nil value' do\n+        update_project(project, admin_user, opts)\n+\n+        expect(project.reload.repository_size_limit).to be_nil\n+      end\n+    end\n+  end\n+\n+  it 'returns an error result when record cannot be updated' do\n+    admin = create(:admin)\n+\n+    result = update_project(project, admin, { name: 'foo\u0026bar' })\n+\n+    expect(result).to eq({ status: :error, message: \"Name can contain only letters, digits, emojis, '_', '.', dash, space. It must start with letter, digit, emoji or '_'.\" })\n+  end\n+\n   def update_project(project, user, opts)\n     described_class.new(project, user, opts).execute\n   end\n```\n\n\u003c/details\u003e\n","state":"closed","created_at":"2018-06-20T15:48:19.206Z","updated_at":"2019-08-12T15:32:58.161Z","closed_at":"2019-04-08T09:32:56.993Z","closed_by":{"id":128633,"username":"rymai","name":"R√©my Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"},"labels":["Enterprise Edition","Plan [DEPRECATED]","Quality","backend","backstage [DEPRECATED]","single codebase","test","workflow::in review"],"milestone":{"id":655279,"iid":27,"group_id":9970,"title":"11.10","description":"","state":"closed","created_at":"2018-09-21T19:08:16.261Z","updated_at":"2019-05-21T09:17:49.051Z","due_date":"2019-04-22","start_date":"2019-03-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/27"},"assignees":[{"id":194645,"username":"digitalmoksha","name":"Brett Walker","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/194645/avatar.png","web_url":"https://gitlab.com/digitalmoksha"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":194645,"username":"digitalmoksha","name":"Brett Walker","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/194645/avatar.png","web_url":"https://gitlab.com/digitalmoksha"},"user_notes_count":0,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6519","time_stats":{"time_estimate":28800,"total_time_spent":0,"human_time_estimate":"8h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6519","notes":"https://gitlab.com/api/v4/projects/278964/issues/6519/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6519/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6519","relative":"#6519","full":"gitlab-org/gitlab#6519"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12191864,"iid":6518,"project_id":278964,"title":"Extract EE specific files/lines for spec/services/lfs","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003espec/services/lfs/lock_file_service_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/services/lfs/lock_file_service_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/services/lfs/lock_file_service_spec.rb\nindex 3e58eea2501..62e7e6eabc2 100644\n--- a/spec/services/lfs/lock_file_service_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/services/lfs/lock_file_service_spec.rb\n@@ -57,6 +57,26 @@ describe Lfs::LockFileService do\n           expect(subject.execute[:status]).to eq(:error)\n         end\n       end\n+\n+      context 'when File Locking is available' do\n+        before do\n+          stub_licensed_features(file_locks: true)\n+        end\n+\n+        it 'creates the Path Lock' do\n+          expect { subject.execute }.to change { PathLock.count }.to(1)\n+        end\n+      end\n+\n+      context 'when File Locking is not available' do\n+        before do\n+          stub_licensed_features(file_locks: false)\n+        end\n+\n+        it 'creates the Path Lock' do\n+          expect { subject.execute }.not_to change { PathLock.count }\n+        end\n+      end\n     end\n   end\n end\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/services/lfs/unlock_file_service_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/services/lfs/unlock_file_service_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/services/lfs/unlock_file_service_spec.rb\nindex fe42ca41633..968133febee 100644\n--- a/spec/services/lfs/unlock_file_service_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/services/lfs/unlock_file_service_spec.rb\n@@ -100,6 +100,34 @@ describe Lfs::UnlockFileService do\n           end\n         end\n       end\n+\n+      describe 'File Locking integraction' do\n+        let(:params) { { id: lock.id } }\n+        let(:current_user) { lock_author }\n+\n+        before do\n+          project.add_developer(lock_author)\n+          project.path_locks.create(path: lock.path, user: lock_author)\n+        end\n+\n+        context 'when File Locking is available' do\n+          it 'deletes the Path Lock' do\n+            expect { subject.execute }.to change { PathLock.count }.to(0)\n+          end\n+        end\n+\n+        context 'when File Locking is not available' do\n+          before do\n+            stub_licensed_features(file_locks: false)\n+          end\n+\n+          # For some reason RSpec is reseting the mock and\n+          # License.feature_available?(:file_locks) returns true when the spec runs.\n+          xit 'does not delete the Path Lock' do\n+            expect { subject.execute }.not_to change { PathLock.count }\n+          end\n+        end\n+      end\n     end\n   end\n end\n```\n\n\u003c/details\u003e\n","state":"closed","created_at":"2018-06-20T15:46:07.053Z","updated_at":"2019-08-12T15:32:58.198Z","closed_at":"2019-03-13T09:29:14.759Z","closed_by":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"labels":["Create [DEPRECATED]","Deliverable","Enterprise Edition","Quality","backend","backstage [DEPRECATED]","single codebase","test","workflow::in review"],"milestone":{"id":655279,"iid":27,"group_id":9970,"title":"11.10","description":"","state":"closed","created_at":"2018-09-21T19:08:16.261Z","updated_at":"2019-05-21T09:17:49.051Z","due_date":"2019-04-22","start_date":"2019-03-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/27"},"assignees":[{"id":1161495,"username":"igor.drozdov","name":"Igor Drozdov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1161495/avatar.png","web_url":"https://gitlab.com/igor.drozdov"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":1161495,"username":"igor.drozdov","name":"Igor Drozdov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1161495/avatar.png","web_url":"https://gitlab.com/igor.drozdov"},"user_notes_count":0,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6518","time_stats":{"time_estimate":28800,"total_time_spent":0,"human_time_estimate":"8h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6518","notes":"https://gitlab.com/api/v4/projects/278964/issues/6518/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6518/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6518","relative":"#6518","full":"gitlab-org/gitlab#6518"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12191820,"iid":6517,"project_id":278964,"title":"Extract EE specific files/lines for spec/services/emails","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003espec/services/emails/create_service_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/services/emails/create_service_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/services/emails/create_service_spec.rb\nindex 54692c88623..3300bdaa1d2 100644\n--- a/spec/services/emails/create_service_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/services/emails/create_service_spec.rb\n@@ -7,6 +7,10 @@ describe Emails::CreateService do\n   subject(:service) { described_class.new(user, opts) }\n \n   describe '#execute' do\n+    before do\n+      stub_licensed_features(extended_audit_events: true)\n+    end\n+\n     it 'creates an email with valid attributes' do\n       expect { service.execute }.to change { Email.count }.by(1)\n       expect(Email.where(opts)).not_to be_empty\n@@ -22,5 +26,9 @@ describe Emails::CreateService do\n \n       expect(user.emails).to eq(Email.where(opts))\n     end\n+\n+    it 'registers a security event' do\n+      expect { service.execute }.to change { SecurityEvent.count }.by(1)\n+    end\n   end\n end\n```\n\n\u003c/details\u003e\n\u003cdetails\u003e\n\u003csummary\u003espec/services/emails/destroy_service_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/services/emails/destroy_service_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/services/emails/destroy_service_spec.rb\nindex c3204fac3df..493229555fa 100644\n--- a/spec/services/emails/destroy_service_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/services/emails/destroy_service_spec.rb\n@@ -6,9 +6,17 @@ describe Emails::DestroyService do\n \n   subject(:service) { described_class.new(user, user: user) }\n \n+  before do\n+    stub_licensed_features(extended_audit_events: true)\n+  end\n+\n   describe '#execute' do\n     it 'removes an email' do\n       expect { service.execute(email) }.to change { user.emails.count }.by(-1)\n     end\n+\n+    it 'registers a security event' do\n+      expect { service.execute(email) }.to change { SecurityEvent.count }.by(1)\n+    end\n   end\n end\n```\n\n\u003c/details\u003e\n","state":"closed","created_at":"2018-06-20T15:43:35.518Z","updated_at":"2019-08-12T15:32:58.223Z","closed_at":"2019-03-22T15:00:51.723Z","closed_by":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"labels":["Enterprise Edition","Plan [DEPRECATED]","Quality","backend","single codebase","test"],"milestone":{"id":655279,"iid":27,"group_id":9970,"title":"11.10","description":"","state":"closed","created_at":"2018-09-21T19:08:16.261Z","updated_at":"2019-05-21T09:17:49.051Z","due_date":"2019-04-22","start_date":"2019-03-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/27"},"assignees":[{"id":443319,"username":"smcgivern","name":"Sean McGivern","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/443319/avatar.png","web_url":"https://gitlab.com/smcgivern"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":443319,"username":"smcgivern","name":"Sean McGivern","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/443319/avatar.png","web_url":"https://gitlab.com/smcgivern"},"user_notes_count":0,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6517","time_stats":{"time_estimate":28800,"total_time_spent":0,"human_time_estimate":"8h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6517","notes":"https://gitlab.com/api/v4/projects/278964/issues/6517/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6517/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6517","relative":"#6517","full":"gitlab-org/gitlab#6517"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12191616,"iid":6516,"project_id":278964,"title":"Extract EE specific files/lines for spec/models/project_services","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003espec/models/project_services/kubernetes_service_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/models/project_services/kubernetes_service_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/models/project_services/kubernetes_service_spec.rb\nindex 9c27357ffaf..71eb2b672aa 100644\n--- a/spec/models/project_services/kubernetes_service_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/models/project_services/kubernetes_service_spec.rb\n@@ -357,17 +357,19 @@ describe KubernetesService, :use_clean_rails_memory_store_caching do\n       it { is_expected.to be_nil }\n     end\n \n-    context 'when kubernetes responds with valid pods' do\n+    context 'when kubernetes responds with valid pods and deployments' do\n       before do\n         stub_kubeclient_pods\n+        stub_kubeclient_deployments\n       end\n \n-      it { is_expected.to eq(pods: [kube_pod]) }\n+      it { is_expected.to eq(pods: [kube_pod], deployments: [kube_deployment]) }\n     end\n \n     context 'when kubernetes responds with 500s' do\n       before do\n         stub_kubeclient_pods(status: 500)\n+        stub_kubeclient_deployments(status: 500)\n       end\n \n       it { expect { subject }.to raise_error(Kubeclient::HttpError) }\n@@ -376,9 +378,48 @@ describe KubernetesService, :use_clean_rails_memory_store_caching do\n     context 'when kubernetes responds with 404s' do\n       before do\n         stub_kubeclient_pods(status: 404)\n+        stub_kubeclient_deployments(status: 404)\n       end\n \n-      it { is_expected.to eq(pods: []) }\n+      it { is_expected.to eq(pods: [], deployments: []) }\n+    end\n+  end\n+\n+  describe \"#deprecated?\" do\n+    let(:kubernetes_service) { create(:kubernetes_service) }\n+\n+    context 'with an active kubernetes service' do\n+      it 'should return false' do\n+        expect(kubernetes_service.deprecated?).to be_falsy\n+      end\n+    end\n+\n+    context 'with a inactive kubernetes service' do\n+      it 'should return true' do\n+        kubernetes_service.update_attribute(:active, false)\n+        expect(kubernetes_service.deprecated?).to be_truthy\n+      end\n+    end\n+  end\n+\n+  describe \"#deprecation_message\" do\n+    let(:kubernetes_service) { create(:kubernetes_service) }\n+\n+    it 'should indicate the service is deprecated' do\n+      expect(kubernetes_service.deprecation_message).to match(/Kubernetes service integration has been deprecated/)\n+    end\n+\n+    context 'if the services is active' do\n+      it 'should return a message' do\n+        expect(kubernetes_service.deprecation_message).to match(/Your Kubernetes cluster information on this page is still editable/)\n+      end\n+    end\n+\n+    context 'if the service is not active' do\n+      it 'should return a message' do\n+        kubernetes_service.update_attribute(:active, false)\n+        expect(kubernetes_service.deprecation_message).to match(/Fields on this page are now uneditable/)\n+      end\n     end\n   end\n```\n\n\u003c/details\u003e\n","state":"closed","created_at":"2018-06-20T15:33:55.689Z","updated_at":"2019-08-19T07:44:13.960Z","closed_at":"2019-03-20T11:16:44.763Z","closed_by":{"id":15139,"username":"rspeicher","name":"Robert Speicher","state":"active","avatar_url":"https://secure.gravatar.com/avatar/73c8253932541a7b5cbc5d79493f2bea?s=80\u0026d=identicon","web_url":"https://gitlab.com/rspeicher"},"labels":["Deliverable","Enterprise Edition","Quality","backend","backstage [DEPRECATED]","group::configure","single codebase","test"],"milestone":{"id":655279,"iid":27,"group_id":9970,"title":"11.10","description":"","state":"closed","created_at":"2018-09-21T19:08:16.261Z","updated_at":"2019-05-21T09:17:49.051Z","due_date":"2019-04-22","start_date":"2019-03-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/27"},"assignees":[{"id":3167938,"username":"tigerwnz","name":"Tiger Watson","state":"active","avatar_url":"https://secure.gravatar.com/avatar/eb2c062f746fe8a57d693ee307942aa5?s=80\u0026d=identicon","web_url":"https://gitlab.com/tigerwnz"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":3167938,"username":"tigerwnz","name":"Tiger Watson","state":"active","avatar_url":"https://secure.gravatar.com/avatar/eb2c062f746fe8a57d693ee307942aa5?s=80\u0026d=identicon","web_url":"https://gitlab.com/tigerwnz"},"user_notes_count":3,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6516","time_stats":{"time_estimate":28800,"total_time_spent":0,"human_time_estimate":"8h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6516","notes":"https://gitlab.com/api/v4/projects/278964/issues/6516/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6516/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6516","relative":"#6516","full":"gitlab-org/gitlab#6516"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12191444,"iid":6515,"project_id":278964,"title":"Extract EE specific files/lines for unicorn spec","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003espec/support/webmock.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/support/webmock.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/support/webmock.rb\nindex af2906b7568..90372c68529 100644\n--- a/spec/support/webmock.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/support/webmock.rb\n@@ -1,4 +1,16 @@\n require 'webmock'\n require 'webmock/rspec'\n \n-WebMock.disable_net_connect!(allow_localhost: true)\n+def webmock_setup_defaults\n+  allowed = %w[elasticsearch registry.gitlab.com-gitlab-org-test-elastic-image]\n+\n+  if ENV.key?('ELASTIC_URL')\n+    url = URI.parse(ENV['ELASTIC_URL'])\n+    allowed \u003c\u003c url.host\n+    allowed.uniq!\n+  end\n+\n+  WebMock.disable_net_connect!(allow_localhost: true, allow: allowed)\n+end\n+\n+webmock_setup_defaults\n```\n\n\u003c/details\u003e\n","state":"closed","created_at":"2018-06-20T15:27:19.974Z","updated_at":"2019-08-12T15:32:58.260Z","closed_at":"2019-05-28T12:46:18.134Z","closed_by":{"id":116,"username":"marin","name":"Marin Jankovski","state":"active","avatar_url":"https://secure.gravatar.com/avatar/5154f0b0eda3f798c8a254962d57192f?s=80\u0026d=identicon","web_url":"https://gitlab.com/marin"},"labels":["Enterprise Edition","Quality","[deprecated] Accepting merge requests","backend","single codebase","test"],"milestone":{"id":655279,"iid":27,"group_id":9970,"title":"11.10","description":"","state":"closed","created_at":"2018-09-21T19:08:16.261Z","updated_at":"2019-05-21T09:17:49.051Z","due_date":"2019-04-22","start_date":"2019-03-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/27"},"assignees":[],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":null,"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6515","time_stats":{"time_estimate":28800,"total_time_spent":0,"human_time_estimate":"8h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6515","notes":"https://gitlab.com/api/v4/projects/278964/issues/6515/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6515/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6515","relative":"#6515","full":"gitlab-org/gitlab#6515"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":24664459,"iid":22868,"project_id":278964,"title":"Alignment of 'Remove' button in Broadcast Messages (Admin Area) seems not okay","description":"### Problem to solve\nAlignment of 'Remove' button in Broadcast Messages (Admin Area) seems not okay\n\n### Further details\nThe button is not aligned properly\n*  Replicated on Firefox and Chrome\n\n### Proposal\nMinor correction required in alignment parameters for 'Remove' button in Broadcast Messages (Admin Area)\n\n### Links / references\nhttps://gitlab.example.com/admin/broadcast_messages\n\n![Broadcast_Messages___Admin_Area___GitLab](/uploads/4f30698bffa39a68a99e2ae29900868f/Broadcast_Messages___Admin_Area___GitLab.png)","state":"closed","created_at":"2018-06-20T09:04:55.589Z","updated_at":"2020-09-28T14:18:02.127Z","closed_at":"2020-05-28T16:51:44.604Z","closed_by":{"id":5413811,"username":"peterhegman","name":"Peter Hegman","state":"active","avatar_url":"https://secure.gravatar.com/avatar/459d8635e9ab17a052c00ead1d7bf1e6?s=80\u0026d=identicon","web_url":"https://gitlab.com/peterhegman"},"labels":["Category:Authentication and Authorization","Manage [DEPRECATED]","admin dashboard","devops::manage","estimation::completed","frontend","group::authentication and authorization","priority::4","severity::4","type::bug","workflow::verification"],"milestone":{"id":1112145,"iid":47,"group_id":9970,"title":"13.1","description":"","state":"closed","created_at":"2020-01-03T12:28:30.160Z","updated_at":"2020-10-08T12:01:07.361Z","due_date":"2020-06-17","start_date":"2020-05-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/47"},"assignees":[{"id":5413811,"username":"peterhegman","name":"Peter Hegman","state":"active","avatar_url":"https://secure.gravatar.com/avatar/459d8635e9ab17a052c00ead1d7bf1e6?s=80\u0026d=identicon","web_url":"https://gitlab.com/peterhegman"}],"author":{"id":911009,"username":"sushil-akkawar","name":"Sushil Akkawar","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/911009/avatar.png","web_url":"https://gitlab.com/sushil-akkawar"},"type":"ISSUE","assignee":{"id":5413811,"username":"peterhegman","name":"Peter Hegman","state":"active","avatar_url":"https://secure.gravatar.com/avatar/459d8635e9ab17a052c00ead1d7bf1e6?s=80\u0026d=identicon","web_url":"https://gitlab.com/peterhegman"},"user_notes_count":5,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/22868","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/22868","notes":"https://gitlab.com/api/v4/projects/278964/issues/22868/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/22868/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#22868","relative":"#22868","full":"gitlab-org/gitlab#22868"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":12161885,"iid":6508,"project_id":278964,"title":"Geo: Project sync failures usually double-increment `*_retry_count`","description":"### Summary\n\nProject sync failures usually double-increment `*_retry_count`. Not a huge deal, but inaccurate and unexpected.\n\n### How\n\n* `sync_repository` calls `fetch_repository`\n* `fetch_repository` calls `update_registry!(started_at: DateTime.now)`\n* We rescue certain exceptions in `sync_repository` and call `fail_registry!`\n* Both `update_registry!` and `fail_registry!` increment `repository_retry_count`/`wiki_retry_count`\n\n### TODO\n\n- [ ] Move `update_registry!` start call earlier to guarantee that it has been called by the time `fail_registry!` can be called\n- [ ] Remove increment from `fail_registry!`\n- [ ] Ensure in-progress syncs are not counted as failed (I think this bug was introduced while fixing this problem a long time ago)","state":"closed","created_at":"2018-06-20T00:19:14.886Z","updated_at":"2019-12-16T14:50:56.504Z","closed_at":"2019-05-02T15:38:28.209Z","closed_by":{"id":59678,"username":"vsizov","name":"Valery Sizov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/59678/avatar.png","web_url":"https://gitlab.com/vsizov"},"labels":["Category:Geo Replication","Enterprise Edition","auto updated","awaiting feedback","bug::performance","devops::systems","group::geo","priority::4","severity::4","type::bug","workflow::in review"],"milestone":{"id":655280,"iid":28,"group_id":9970,"title":"11.11","description":"","state":"closed","created_at":"2018-09-21T19:08:37.027Z","updated_at":"2019-06-10T14:39:00.009Z","due_date":"2019-05-22","start_date":"2019-04-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/28"},"assignees":[{"id":59678,"username":"vsizov","name":"Valery Sizov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/59678/avatar.png","web_url":"https://gitlab.com/vsizov"}],"author":{"id":1144264,"username":"mkozono","name":"Michael Kozono","state":"active","avatar_url":"https://secure.gravatar.com/avatar/6243abba3cf112e6df4a5a644c5f86aa?s=80\u0026d=identicon","web_url":"https://gitlab.com/mkozono"},"type":"ISSUE","assignee":{"id":59678,"username":"vsizov","name":"Valery Sizov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/59678/avatar.png","web_url":"https://gitlab.com/vsizov"},"user_notes_count":7,"merge_requests_count":1,"upvotes":3,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6508","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":3,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 3 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6508","notes":"https://gitlab.com/api/v4/projects/278964/issues/6508/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6508/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6508","relative":"#6508","full":"gitlab-org/gitlab#6508"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1529,"epic":{"id":8648,"iid":1529,"title":"Geo: Status report","url":"/groups/gitlab-org/-/epics/1529","group_id":9970,"human_readable_end_date":"Dec 17, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12156560,"iid":6497,"project_id":278964,"title":"Extract EE specific files/lines for merge request feature tests","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003espec/fixtures/api/schemas/public_api/v4/merge_requests.json\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/fixtures/api/schemas/public_api/v4/merge_requests.json b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/fixtures/api/schemas/public_api/v4/merge_requests.json\nindex 6df27bf32b9..261c81e9728 100644\n--- a/spec/fixtures/api/schemas/public_api/v4/merge_requests.json\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/fixtures/api/schemas/public_api/v4/merge_requests.json\n@@ -101,6 +101,7 @@\n       \"force_remove_source_branch\": { \"type\": [\"boolean\", \"null\"] },\n       \"discussion_locked\": { \"type\": [\"boolean\", \"null\"] },\n       \"web_url\": { \"type\": \"uri\" },\n+      \"approvals_before_merge\": { \"type\": [\"integer\", \"null\"] },\n       \"squash\": { \"type\": \"boolean\" },\n       \"time_stats\": {\n         \"time_estimate\": { \"type\": \"integer\" },\n@@ -119,7 +120,7 @@\n       \"labels\", \"work_in_progress\", \"milestone\", \"merge_when_pipeline_succeeds\",\n       \"merge_status\", \"sha\", \"merge_commit_sha\", \"user_notes_count\",\n       \"should_remove_source_branch\", \"force_remove_source_branch\",\n-      \"web_url\", \"squash\"\n+      \"web_url\", \"approvals_before_merge\", \"squash\"\n     ],\n     \"additionalProperties\": false\n   }\n```\n\n\u003c/details\u003e\n","state":"closed","created_at":"2018-06-19T18:29:31.502Z","updated_at":"2019-08-12T15:33:14.307Z","closed_at":"2019-03-15T08:35:27.774Z","closed_by":{"id":1884221,"username":"patrickbajao","name":"Patrick Bajao","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1884221/avatar.png","web_url":"https://gitlab.com/patrickbajao"},"labels":["Create [DEPRECATED]","Deliverable","Enterprise Edition","Quality","backend","merge requests","single codebase","test","workflow::in dev"],"milestone":{"id":655279,"iid":27,"group_id":9970,"title":"11.10","description":"","state":"closed","created_at":"2018-09-21T19:08:16.261Z","updated_at":"2019-05-21T09:17:49.051Z","due_date":"2019-04-22","start_date":"2019-03-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/27"},"assignees":[{"id":1884221,"username":"patrickbajao","name":"Patrick Bajao","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1884221/avatar.png","web_url":"https://gitlab.com/patrickbajao"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":1884221,"username":"patrickbajao","name":"Patrick Bajao","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1884221/avatar.png","web_url":"https://gitlab.com/patrickbajao"},"user_notes_count":2,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6497","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6497","notes":"https://gitlab.com/api/v4/projects/278964/issues/6497/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6497/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6497","relative":"#6497","full":"gitlab-org/gitlab#6497"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":12156259,"iid":6495,"project_id":278964,"title":"Extract EE specific files/lines for some spec/lib","description":"We have the following files containing EE specific code. We should move them to ee/\n\n\u003cdetails\u003e\n\u003csummary\u003espec/lib/system_check/app/git_user_default_ssh_config_check_spec.rb\u003c/summary\u003e\n\n```diff\ndiff --git a/spec/lib/system_check/app/git_user_default_ssh_config_check_spec.rb b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/lib/system_check/app/git_user_default_ssh_config_check_spec.rb\nindex a0fb86345f3..8ba9f34da3c 100644\n--- a/spec/lib/system_check/app/git_user_default_ssh_config_check_spec.rb\n+++ b/home/yorickpeterse/Projects/gitlab/gdk-ee/gitlab/spec/lib/system_check/app/git_user_default_ssh_config_check_spec.rb\n@@ -1,6 +1,8 @@\n require 'spec_helper'\n \n describe SystemCheck::App::GitUserDefaultSSHConfigCheck do\n+  include ::EE::GeoHelpers\n+\n   let(:username) { '_this_user_will_not_exist_unless_it_is_stubbed' }\n   let(:base_dir) { Dir.mktmpdir }\n   let(:home_dir) { File.join(base_dir, \"/var/lib/#{username}\") }\n@@ -70,6 +72,7 @@ describe SystemCheck::App::GitUserDefaultSSHConfigCheck do\n   end\n \n   def stub_user\n+    allow(File).to receive(:expand_path).and_call_original\n     allow(File).to receive(:expand_path).with(\"~#{username}\").and_return(home_dir)\n   end\n```\n\n\u003c/details\u003e\n","state":"closed","created_at":"2018-06-19T18:17:43.710Z","updated_at":"2019-08-12T15:33:14.376Z","closed_at":"2019-05-27T11:21:27.747Z","closed_by":{"id":209240,"username":"yorickpeterse","name":"Yorick Peterse","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/209240/avatar.png","web_url":"https://gitlab.com/yorickpeterse"},"labels":["Deliverable","Enterprise Edition","Manage [DEPRECATED]","Quality","backend","backstage [DEPRECATED]","single codebase","test"],"milestone":{"id":693518,"iid":33,"group_id":9970,"title":"12.0","description":"https://about.gitlab.com/releases/2019/06/22/gitlab-12-0-released/","state":"closed","created_at":"2018-10-30T16:47:37.975Z","updated_at":"2020-04-22T19:51:03.475Z","due_date":"2019-06-22","start_date":"2019-05-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/33"},"assignees":[{"id":2982208,"username":"mksionek","name":"Gosia Ksionek","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2982208/avatar.png","web_url":"https://gitlab.com/mksionek"}],"author":{"id":423915,"username":"godfat","name":"Lin Jen-Shin","state":"active","avatar_url":"https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80\u0026d=identicon","web_url":"https://gitlab.com/godfat"},"type":"ISSUE","assignee":{"id":2982208,"username":"mksionek","name":"Gosia Ksionek","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2982208/avatar.png","web_url":"https://gitlab.com/mksionek"},"user_notes_count":0,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitlab/-/issues/6495","time_stats":{"time_estimate":28800,"total_time_spent":0,"human_time_estimate":"8h","human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/278964/issues/6495","notes":"https://gitlab.com/api/v4/projects/278964/issues/6495/notes","award_emoji":"https://gitlab.com/api/v4/projects/278964/issues/6495/award_emoji","project":"https://gitlab.com/api/v4/projects/278964","closed_as_duplicate_of":null},"references":{"short":"#6495","relative":"#6495","full":"gitlab-org/gitlab#6495"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":557,"epic":{"id":2152,"iid":557,"title":"Move all EE specific backend code to the ee/ directory","url":"/groups/gitlab-org/-/epics/557","group_id":9970,"human_readable_end_date":"May 22, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null}]