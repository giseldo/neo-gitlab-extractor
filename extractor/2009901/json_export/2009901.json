[{"id":33319034,"iid":2664,"project_id":2009901,"title":"Include Praefect usage in the usage ping","description":"GitLab features a [Usage Ping](https:\/\/docs.gitlab.com\/ee\/user\/admin_area\/settings\/usage_statistics.html#usage-ping-core-only), which sends a simple JSON to GitLab servers for us to track certain data from customers. For example, it shows the version of Git installed for internal analysis which is used to determine when and if we can deprecate Git versions.\n\n### Proposal\n\n- [x] Extend the usage ping to send data regarding Praefect usage\n- [x] Extend the version app that records the version ping, to accept this new parameter.","state":"closed","created_at":1586954328664,"updated_at":1593405543985,"closed_at":1590997475217,"closed_by":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"labels":["Category:Gitaly","Deliverable","devops::create","group::gitaly","missed-deliverable","missed:13.0","workflow::in dev"],"milestone":{"id":1112145,"iid":47,"group_id":9970,"title":"13.1","description":"","state":"closed","created_at":"2020-01-03T12:28:30.160Z","updated_at":"2020-10-08T12:01:07.361Z","due_date":"2020-06-17","start_date":"2020-05-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/47"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"user_notes_count":8,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2664","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":2,"completed_count":2},"weight":3,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2664","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2664\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2664\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2664","relative":"#2664","full":"gitlab-org\/gitaly#2664"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":3744.0,"epic":{"id":73949,"iid":3744,"title":"Create:Gitaly Instrumentation","url":"\/groups\/gitlab-org\/-\/epics\/3744","group_id":9970,"human_readable_end_date":"May 17, 2021","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":null},{"id":33293341,"iid":2659,"project_id":2009901,"title":"Omnibus Praefect dashboard improvements from demo","description":"From the 2020-04-14 demo, we noticed the following potential improvements:\n\n- The table containing the latest known elected primary should also include the instance name (e.g. IP or hostname).\n- The replication queue size could be further broken down by Praefect instance and virtual storage.\n- Need a panel for the replication delay metric (`gitaly_praefect_replication_delay`).\n- Virtual storage flapping should use two labels (`{{instance}} {{gitaly_storage}}`)\n\nFrom the 2020-04-17 demo, we noticed we should also include:\n\n- A panel for the query `rate(grpc_server_handled_total{job=\"praefect\",grpc_code!=\"OK\"}[5m])`\n- A panel for the node up time: `gitaly_praefect_node_last_healthcheck_up`","state":"closed","created_at":1586912765551,"updated_at":1590678697480,"closed_at":1589904878610,"closed_by":{"id":787914,"username":"ibaum","name":"Ian Baum","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/7c508dc85ddd5049564a95662311543b?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/ibaum"},"labels":["Deliverable","Observability","demo","devops::create","group::gitaly","group::gitaly::cluster","priority::2","workflow::in review"],"milestone":{"id":991112,"iid":42,"group_id":9970,"title":"13.0","description":"","state":"closed","created_at":"2019-09-04T15:20:39.024Z","updated_at":"2020-10-08T12:00:55.725Z","due_date":"2020-05-17","start_date":"2020-04-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/42"},"assignees":[{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"}],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"type":"ISSUE","assignee":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"user_notes_count":3,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2659","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2659","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2659\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2659\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2659","relative":"#2659","full":"gitlab-org\/gitaly#2659"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2658.0,"epic":{"id":20748,"iid":2658,"title":"\ud83d\ude80 Gitaly HA (generally available)","url":"\/groups\/gitlab-org\/-\/epics\/2658","group_id":9970,"human_readable_end_date":"May 17, 2020","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":"on_track","task_status":"0 of 0 checklist items completed"},{"id":33252162,"iid":2653,"project_id":2009901,"title":"ReplicateRepository should create a bitmap when there's none","description":"ReplicateRepository is used in multiple cases, one of which is moving a repository across shards. In https:\/\/gitlab.com\/gitlab-org\/gitlab\/commit\/888ffdfa7f5dc3af5c1653d5064199027ac9be4a#dab876ea293e0f990ba0851665c089cfe2c7e0c5_92_99 @nick.thomas describes a good case where we should ensure that Gitaly writes bitmaps:\n\n>>>\n    Run housekeeping after moving a repository between shards\n    \n    The current inter-shard move is implemented as a `git fetch` from the\n    original shard to an empty repository on the new shard. The repository\n    on the new shard lacks bitmaps, and may be less well packed, than the\n    repository on the old shard. This has a measurable performance impact.\n    \n    We may be changing from \"FetchInternalRemote\" to \"ReplicateRepository\"\n    in the future, but until then, forcing housekeeping to run is a good\n    performance optimisation - we trade off some short-term I\/O load on the\n    new shard for better performance across a wide range of RPCs, including\n    an order-of-magnitude improvement in `IsAncestor`, which is the find\n    that motivated this change.\n>>>\n\nThat change is behind a feature flag, part of closing this issue is removing the flag, and making sure we're using the ReplicateRepository RPC.","state":"closed","created_at":1586851394182,"updated_at":1589267616034,"closed_at":1589264159835,"closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"labels":["Category:Gitaly","devops::create","group::gitaly","type::feature","workflow::in review"],"milestone":{"id":991112,"iid":42,"group_id":9970,"title":"13.0","description":"","state":"closed","created_at":"2019-09-04T15:20:39.024Z","updated_at":"2020-10-08T12:00:55.725Z","due_date":"2020-05-17","start_date":"2020-04-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/42"},"assignees":[{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"type":"ISSUE","assignee":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"},"user_notes_count":7,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2653","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2653","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2653\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2653\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2653","relative":"#2653","full":"gitlab-org\/gitaly#2653"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2307.0,"epic":{"id":15983,"iid":2307,"title":"\ud83d\ude9c Improve Gitaly data migration tools","url":"\/groups\/gitlab-org\/-\/epics\/2307","group_id":9970,"human_readable_end_date":"Jul 17, 2022","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":33235781,"iid":2650,"project_id":2009901,"title":"Horizontal scaling of a single shard MVC","description":"## Problem to solve\n\nWhen hundreds of developers are working on a mono repo (perhaps 5GB), it is possible to saturate a single server with reads and writes. CI servers add to this load. There is no way to horizontally scale reads without NFS today.\n\n## Further details\n\nThe current workaround for this is:\n\n- install a load balancer between GitLab and a Gitaly storage\n- the load balancer should distribute reads and writes across all many Gitaly nodes\n- Gitaly nodes are kept in sync by a shared NFS volume that is mounted to each Gitaly nodes\n\nThis relies on NFS to keep all nodes completely consistent.\n\n## Proposal\n\nWhen using Praefect for Gitaly HA, each repository is replicated some number of times. Only the primary node services reads.\n\nUsing the Praefect tracking database:\n\n- randomly distributes reads to any node where the replication queue is empty for that repository.\n\n![praefect-distribute-reads](\/uploads\/da214c773640e33de80060b63c364d3e\/praefect-distribute-reads.png)\n\n## Links \/ references","state":"closed","created_at":1586823622486,"updated_at":1605736093679,"closed_at":1589817672727,"closed_by":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"labels":["Deliverable","bug::performance","devops::create","direction","group::gitaly","group::gitaly::cluster","type::feature","workflow::ready for development"],"milestone":{"id":991112,"iid":42,"group_id":9970,"title":"13.0","description":"","state":"closed","created_at":"2019-09-04T15:20:39.024Z","updated_at":"2020-10-08T12:00:55.725Z","due_date":"2020-05-17","start_date":"2020-04-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/42"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"}],"author":{"id":1187333,"username":"jramsay-gitlab","name":"James Ramsay (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/1187333\/avatar.png","web_url":"https:\/\/gitlab.com\/jramsay-gitlab"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"user_notes_count":6,"merge_requests_count":1,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2650","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2650","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2650\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2650\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2650","relative":"#2650","full":"gitlab-org\/gitaly#2650"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2013.0,"epic":{"id":13406,"iid":2013,"title":"\ud83c\udf3f Gitaly Cluster: Distribute Git read operations across Gitaly nodes","url":"\/groups\/gitlab-org\/-\/epics\/2013","group_id":9970,"human_readable_end_date":"Mar 17, 2021","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":33100397,"iid":2642,"project_id":2009901,"title":"Smarter Praefect election process","description":"## Problem to solve\n\nRight now our primary election process in Praefect treats all Gitaly nodes that are up as possible candidates for election. However, what happens if a secondary fails replication or becomes out of sync? We need to consider marking the Gitaly node as \"unelectable\" and taking it out of the rotation. \n\n## Further Details\n\nWe probably need to consider a number of inputs:\n\n1. Are there any jobs left in the replication queue? If there is a node that is up that has an empty queue, we'd prefer that one over another one.\n1. Failure rates of the replication queue: If a node is unable to sync with the current primary for a number of repositories, that is indicative that something went out of sync, and we may need to do a repair.\n\nIdeas for consideration:\n\n1. During the election process, sort nodes by descending number of outstanding jobs.\n1. Track a metric of the `FetchInternalRemote` and\/or `ReplicateRepository` RPCs in Praefect\n\n## Proposal\n\nWhen promoting a secondary to a new primary, use the Gitaly node with least pending replication jobs.\n\n## Links \/ references","state":"closed","created_at":1586439546670,"updated_at":1589785714634,"closed_at":1588262656390,"closed_by":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"},"labels":["Deliverable","devops::create","group::gitaly","group::gitaly::cluster","priority::2","type::feature","workflow::in dev"],"milestone":{"id":991112,"iid":42,"group_id":9970,"title":"13.0","description":"","state":"closed","created_at":"2019-09-04T15:20:39.024Z","updated_at":"2020-10-08T12:00:55.725Z","due_date":"2020-05-17","start_date":"2020-04-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/42"},"assignees":[{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"}],"author":{"id":64248,"username":"stanhu","name":"Stan Hu","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/64248\/stanhu.jpg","web_url":"https:\/\/gitlab.com\/stanhu"},"type":"ISSUE","assignee":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"},"user_notes_count":6,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2642","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2642","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2642\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2642\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2642","relative":"#2642","full":"gitlab-org\/gitaly#2642"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2658.0,"epic":{"id":20748,"iid":2658,"title":"\ud83d\ude80 Gitaly HA (generally available)","url":"\/groups\/gitlab-org\/-\/epics\/2658","group_id":9970,"human_readable_end_date":"May 17, 2020","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":33025854,"iid":2635,"project_id":2009901,"title":"2PC via pre-receive hook","description":"As a result of the experiments in #2466 and #2529, we have concluded that the most promising way to implement strong consistency for reference updates is by going via Git hooks: given a reference update, a hook will execute on each Gitaly node that reports back to Praefect. Praefect will collect these reports from all Gitaly nodes that take part in the current update and, if all nodes post the same update, send them a message to go ahead.\n\nWhile the mid-term goal is to hook directly into the reference transaction handling code in order to handle all kinds of reference updates and not only those invoked via git-receive-pack(1), this requires a new set of hooks on Git's side. We thus decided to implement a first POC of this mechanism by using the Git pre-receive hook, which executes after all reference updates have been announced by the Git client. This should give us a better picture of how the mechanism will work in the end.\n\nThe following diagram depicts the 3PC via a pre-receive hook:\n\n```mermaid\nsequenceDiagram\n  Praefect->>+Gitaly: ReceivePack\n  Gitaly->>+Git: git receive-pack\n  Git->>+Hook: update HEAD master\n  Hook->>+Gitaly: TX: update HEAD master\n  Gitaly->>+Praefect: TX: update HEAD master\n  Praefect->>+Praefect: TX: collect votes\n  Praefect->>+Gitaly: TX: commit\n  Gitaly->>+Hook: TX: commit\n  Hook->>+Git: exit 0\n  Git->>+Gitaly: exit 0\n  Gitaly->>+Praefect: success\n```\n\nThe 2PC voting protocol will start as soon as a first \"TX\" message is received on the Praefect node. Each of the pre-receive hooks will block until it receives a message from Praefect telling to to either go on with the update or to abort. In case the vote was successful, the hook will exit with `0` to indicate success, otherwise it will return an error code and thus abort the reference update.\n\nThe main goal of this issue is to establish a communication channel between hook and Praefect to allow for transaction handling. The communication channel should be implemented transparent to Gitaly nodes as much as possible so that Gitaly does not need to know if and how many transactions a given Git transaction is going to start. This ensures we can swap out the hooks in the future and start multiple transactions for a single Git command.","state":"closed","created_at":1586333516928,"updated_at":1590106352601,"closed_at":1590103863780,"closed_by":{"id":1187333,"username":"jramsay-gitlab","name":"James Ramsay (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/1187333\/avatar.png","web_url":"https:\/\/gitlab.com\/jramsay-gitlab"},"labels":["Category:Gitaly","Deliverable","devops::create","direction","group::gitaly","type::feature","workflow::in review"],"milestone":{"id":991112,"iid":42,"group_id":9970,"title":"13.0","description":"","state":"closed","created_at":"2019-09-04T15:20:39.024Z","updated_at":"2020-10-08T12:00:55.725Z","due_date":"2020-05-17","start_date":"2020-04-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/42"},"assignees":[{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"}],"author":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"type":"ISSUE","assignee":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"user_notes_count":7,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2635","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":7,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2635","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2635\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2635\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2635","relative":"#2635","full":"gitlab-org\/gitaly#2635"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1189.0,"epic":{"id":5989,"iid":1189,"title":"Gitaly Cluster: strong consistency","url":"\/groups\/gitlab-org\/-\/epics\/1189","group_id":9970,"human_readable_end_date":"Sep 17, 2021","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":"on_track","task_status":"0 of 0 checklist items completed"},{"id":33016702,"iid":2634,"project_id":2009901,"title":"Remove primary in praefect config once SQL election is merged and the default","description":"SQL leader election has now been merged https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2547, meaning we no longer need the idea of a \"default\" primary in the config.\n\nWe should remove this in:\n\n- [x] Praefect example config toml in gitaly\n- [x] GDK\n- [ ] Omnibus\n- [x] Gitaly Cluster admin docs","state":"closed","created_at":1586306100797,"updated_at":1610035633447,"closed_at":1600813079940,"closed_by":{"id":787914,"username":"ibaum","name":"Ian Baum","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/7c508dc85ddd5049564a95662311543b?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/ibaum"},"labels":["Category:Gitaly","Deliverable","devops::create","group::gitaly","group::gitaly::cluster","missed-deliverable","missed:13.4","section::dev","workflow::in dev"],"milestone":{"id":1233754,"iid":52,"group_id":9970,"title":"13.5","description":"https:\/\/about.gitlab.com\/releases\/2020\/10\/22\/gitlab-13-5-released\/","state":"closed","created_at":"2020-04-09T17:39:21.990Z","updated_at":"2022-04-21T07:21:12.213Z","due_date":"2020-10-17","start_date":"2020-09-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/52"},"assignees":[{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"}],"author":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"},"type":"ISSUE","assignee":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"user_notes_count":5,"merge_requests_count":2,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2634","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":4,"completed_count":3},"weight":2,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2634","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2634\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2634\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2634","relative":"#2634","full":"gitlab-org\/gitaly#2634"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1491.0,"epic":{"id":8450,"iid":1491,"title":"\ud83c\udf3b Improved Gitaly Cluster admin experience","url":"\/groups\/gitlab-org\/-\/epics\/1491","group_id":9970,"human_readable_end_date":"Apr 22, 2020","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":null},{"id":32979230,"iid":2630,"project_id":2009901,"title":"Option for failover to put out-of-date repositories in read-only mode","description":"## Problem to solve\n\nPraefect has a failover mechanism, where if it detects that a Gitaly node is unresponsive, it will promote a secondary storage server to primary. If this secondary server could be missing data still from the old primary. This in itself would allow Gitaly to serve stale data. However, after serveral mutations on the repository, it could end up in a state where data-loss occurs. As such, the current implementation is great for demo's, or instances where velocity is more important than data integrity. The current approach will not work for gitlab.com\n\n## Solution\n\nIn <issue link> we're working on reporting of potential data loss, this issue proposes the next iteration of it; putting each of those repositories in a read only state, until manual intervention from an admin to mark it operational again. Allowing all administrators to use the current failover mechanism, and resolve data integrety issues manually.  \n\n\n### Additional benefits\n\nWhen moving a repository on a shard, it's put in read only mode for a brief period of time. This is a loosely defined contract right now. Having a praefect managed read only mode for repositories put stronger data integrity.\n\nThis approach could remove the need for https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2601","state":"closed","created_at":1586251480375,"updated_at":1591854392837,"closed_at":1589283380936,"closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"labels":["Category:Gitaly","devops::create","group::gitaly","group::gitaly::cluster","priority::1","type::feature","workflow::in dev"],"milestone":{"id":991112,"iid":42,"group_id":9970,"title":"13.0","description":"","state":"closed","created_at":"2019-09-04T15:20:39.024Z","updated_at":"2020-10-08T12:00:55.725Z","due_date":"2020-05-17","start_date":"2020-04-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/42"},"assignees":[{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/5522960\/avatar.png","web_url":"https:\/\/gitlab.com\/samihiltunen"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"type":"ISSUE","assignee":{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/5522960\/avatar.png","web_url":"https:\/\/gitlab.com\/samihiltunen"},"user_notes_count":6,"merge_requests_count":2,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2630","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2630","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2630\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2630\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2630","relative":"#2630","full":"gitlab-org\/gitaly#2630"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2658.0,"epic":{"id":20748,"iid":2658,"title":"\ud83d\ude80 Gitaly HA (generally available)","url":"\/groups\/gitlab-org\/-\/epics\/2658","group_id":9970,"human_readable_end_date":"May 17, 2020","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":32967456,"iid":2627,"project_id":2009901,"title":"Stale packed-refs.new files prevents branches from being deleted","description":"We saw in https:\/\/gitlab.com\/gitlab-org\/gitlab\/-\/issues\/213620#note_318864514, that somehow the `gitlab-org\/gitlab` repository had a stale\/aborted `packed-refs.new` file that prevented branches from being deleted inside the `MergeRequestWorker`, causing that worker to retry 4 times unnecessarily:\n\n```\nroot@file-cny-01-stor-gprd.c.gitlab-production.internal:\/var\/log\/gitlab\/gitlab-rails# sudo ls -al \/var\/opt\/gitlab\/git-data\/repositories\/@hashed\/a6\/80\/a68072e80f075e89bc74a300101a9e71e8363bdb542182580162553462480a52.git\ntotal 34168\ndrwxr-s---   7 git root     4096 Apr  7 02:50 .\ndrwxr-s---   5 git root     4096 Dec 12 09:21 ..\n-rw-r--r--   1 git root      409 Apr  7 00:05 config\n-rw-r--r--   1 git root       73 Dec 12 09:17 description\n-rw-r--r--   1 git root   156636 Apr  7 02:54 FETCH_HEAD\ndrwxr-sr-x   2 git root     4096 Apr  7 00:05 gitlab-worktree\n-rw-r--r--   1 git root       23 Feb  5 07:35 HEAD\ndrwxr-sr-x   2 git root     4096 Dec 12 09:17 hooks\ndrwxr-sr-x   2 git root     4096 Apr  7 02:54 info\n-rw-r--r--   1 git root   301751 Apr  7 02:13 language-stats.cache\ndrwxr-sr-x 260 git root     4096 Apr  7 02:56 objects\n-rw-r--r--   1 git root 30427806 Apr  6 11:07 packed-refs\n-rw-r--r--   1 git root  4055040 Apr  6 11:08 packed-refs.new\ndrwxr-sr-x  11 git root     4096 Dec 12 09:21 refs\nroot@file-cny-01-stor-gprd.c.gitlab-production.internal:\/var\/log\/gitlab\/gitlab-rails# date\nTue Apr  7 02:56:39 UTC 2020\n```\n\nAttached are the files:\n\n[packed-refs.tar.gz](\/uploads\/d12f6d32ef38a805943bff296b25a722\/packed-refs.tar.gz)\n\nIt almost looks like the writes to `packed-refs.new` got aborted at 11:08:\n\n![image](\/uploads\/4e1d6697a1c911a5e0963dab6ed7a7b4\/image.png)\n\nFew questions\/issues:\n\n1. What left this `packed-refs.new` around? I presume it was a `git pack-refs`. I see a `PackRefs` RPC that completed successfully at 11:05: https:\/\/log.gprd.gitlab.net\/goto\/b30757c2d0feb12c7ea3dd7590d93760 \n1. Should we run `Cleanup()` on stale `packed-refs.new` files?\n1. https:\/\/gitlab.com\/gitlab-org\/gitlab\/-\/issues\/213620: `MergeRequestWorker` should be idempotent here: why did the deletion of the branch cause duplicate merge commits? \n1. These error messages only went to `githost.log`: https:\/\/gitlab.com\/gitlab-org\/gitaly\/blob\/981ff509c05475c65480f11c92101f0a4d5f5158\/ruby\/lib\/gitlab\/git\/operation_service.rb#L209. Can we just port this RPC to Go and use structured logging here?","state":"closed","created_at":1586231473467,"updated_at":1590376413327,"closed_at":1590373370371,"closed_by":{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/228150\/avatar.png","web_url":"https:\/\/gitlab.com\/proglottis"},"labels":["Category:Gitaly","devops::create","group::gitaly","priority::2","severity::2","type::bug"],"milestone":{"id":1112145,"iid":47,"group_id":9970,"title":"13.1","description":"","state":"closed","created_at":"2020-01-03T12:28:30.160Z","updated_at":"2020-10-08T12:01:07.361Z","due_date":"2020-06-17","start_date":"2020-05-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/47"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"}],"author":{"id":64248,"username":"stanhu","name":"Stan Hu","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/64248\/stanhu.jpg","web_url":"https:\/\/gitlab.com\/stanhu"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"user_notes_count":6,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2627","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2627","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2627\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2627\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2627","relative":"#2627","full":"gitlab-org\/gitaly#2627"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":32951949,"iid":2626,"project_id":2009901,"title":"Documentation: two sources of truth for GL_REPOSITORY","description":"When receiving a git push, Gitaly will make HTTP callbacks to gitlab-rails. This is done via the Git `pre-receive` and `post-receive` hooks.\n\nIn these callbacks, Gitaly must tell gitlab-rails what repo the hooks are running in. We use an opaque token called GL_REPOSITORY for this. This token comes in as an RPC request field, and gets handed down into the Git hook via an environment variable on the `git receive-pack` process.\n\nThere are three groups of RPC's where we need GL_REPOSITORY to make callback requests:\n\n- SSHService.SSHReceivePack (git push via SSH)\n- SmartHTTPService.PostReceivePack (git push via HTTP)\n- OperationsService.UserCommitfiles, OperationsService.UserMergeBranch, etc. (RPC's that modify a repo on while impersonating a user)\n\nIn the case of OperationsService, we always pass GL_REPOSITORY [via the Repository protobuf message](https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/blob\/dca26f3a6d09e3cea5d05373bd2c35ddc03c05c8\/proto\/shared.proto#L42).\n\nIn the case of SSHReceivePack and PostReceivePack, however, we have a confusing situation. These RPC's were implemented before we had a GL_REPOSITORY field on the Repository message. What we do there instead is that we explicitly pass in the value via the request message ([example 1](https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/blob\/master\/proto\/smarthttp.proto#L82)) and [example 2](https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/blob\/master\/proto\/ssh.proto#L66)).\n\nThe purpose of this issue is to discuss if this is a problem or not, and if so, what we want to do about it.","state":"closed","created_at":1586190861400,"updated_at":1588273875820,"closed_at":1588271985470,"closed_by":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"},"labels":["Category:Gitaly","devops::create","documentation","group::gitaly","missed:12.10","workflow::ready for development"],"milestone":{"id":991112,"iid":42,"group_id":9970,"title":"13.0","description":"","state":"closed","created_at":"2019-09-04T15:20:39.024Z","updated_at":"2020-10-08T12:00:55.725Z","due_date":"2020-05-17","start_date":"2020-04-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/42"},"assignees":[{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"}],"author":{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/513969\/avatar.png","web_url":"https:\/\/gitlab.com\/jacobvosmaer-gitlab"},"type":"ISSUE","assignee":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"},"user_notes_count":5,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2626","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2626","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2626\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2626\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2626","relative":"#2626","full":"gitlab-org\/gitaly#2626"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":32839108,"iid":2620,"project_id":2009901,"title":"Praefect gRPC logs should not be visible when running subcommands","description":"The Praefect gRPC logs are appearing in the terminal when running subcommands. This is a regression and not desirable since it makes too much noise.","state":"closed","created_at":1585927713762,"updated_at":1587342302066,"closed_at":1586915747144,"closed_by":{"id":1187333,"username":"jramsay-gitlab","name":"James Ramsay (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/1187333\/avatar.png","web_url":"https:\/\/gitlab.com\/jramsay-gitlab"},"labels":["[deprecated] Accepting merge requests","demo","devops::create","group::gitaly","group::gitaly::cluster","priority::3","severity::3","type::bug"],"milestone":null,"assignees":[],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"type":"ISSUE","assignee":null,"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2620","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2620","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2620\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2620\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2500"},"references":{"short":"#2620","relative":"#2620","full":"gitlab-org\/gitaly#2620"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2658.0,"epic":{"id":20748,"iid":2658,"title":"\ud83d\ude80 Gitaly HA (generally available)","url":"\/groups\/gitlab-org\/-\/epics\/2658","group_id":9970,"human_readable_end_date":"May 17, 2020","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":32804854,"iid":2618,"project_id":2009901,"title":"Automatically clean up after moving a project to a different shard","description":"## Problem to solve\n\nMoving a project from one shard to another leaves behind the repo on the original shard, and it isn't cleaned up automatically. This means manual work is required to reclaim space\n\n## Proposal\n\nIf a project is moved to a new shard successfully, the space should be reclaimed on the old shard by deleting the repo\n\n## Links \/ references","state":"closed","created_at":1585871400882,"updated_at":1597827204065,"closed_at":1597827204030,"closed_by":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"labels":["Category:Gitaly","Deliverable","devops::create","feature flag","group::gitaly","missed-deliverable","missed:13.0","missed:13.1","missed:13.2","workflow::in dev"],"milestone":{"id":1233752,"iid":50,"group_id":9970,"title":"13.3","description":"https:\/\/about.gitlab.com\/releases\/2020\/08\/22\/gitlab-13-3-released\/","state":"closed","created_at":"2020-04-09T17:39:21.090Z","updated_at":"2022-04-13T14:50:18.976Z","due_date":"2020-08-17","start_date":"2020-07-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/50"},"assignees":[{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/228150\/avatar.png","web_url":"https:\/\/gitlab.com\/proglottis"}],"author":{"id":1187333,"username":"jramsay-gitlab","name":"James Ramsay (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/1187333\/avatar.png","web_url":"https:\/\/gitlab.com\/jramsay-gitlab"},"type":"ISSUE","assignee":{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/228150\/avatar.png","web_url":"https:\/\/gitlab.com\/proglottis"},"user_notes_count":12,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2618","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2618","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2618\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2618\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2618","relative":"#2618","full":"gitlab-org\/gitaly#2618"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2307.0,"epic":{"id":15983,"iid":2307,"title":"\ud83d\ude9c Improve Gitaly data migration tools","url":"\/groups\/gitlab-org\/-\/epics\/2307","group_id":9970,"human_readable_end_date":"Jul 17, 2022","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":32791485,"iid":2615,"project_id":2009901,"title":"Praefect: Enable database replication queue by default","description":"As of now by default Praefect uses in-memory implementation of the replication queue.  \nThis can be switched to Postgres implementation by providing configuration parameter [`postgres_queue_enabled`](https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/blob\/cc314adf47d3eed96d824f35ae601e891e2e70e2\/internal\/praefect\/config\/config.go#L33) with value `true`.\nOnce Postgres implementation tested enough this parameter must be removed and Postgres implementation must become default.\n\n\/cc @zj-gitlab @jramsay","state":"closed","created_at":1585842274984,"updated_at":1590653322126,"closed_at":1589996963170,"closed_by":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"labels":["Category:Gitaly","Deliverable","devops::create","group::gitaly","group::gitaly::cluster","priority::3","workflow::in dev"],"milestone":{"id":991112,"iid":42,"group_id":9970,"title":"13.0","description":"","state":"closed","created_at":"2019-09-04T15:20:39.024Z","updated_at":"2020-10-08T12:00:55.725Z","due_date":"2020-05-17","start_date":"2020-04-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/42"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"}],"author":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"user_notes_count":3,"merge_requests_count":1,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2615","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2615","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2615\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2615\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2615","relative":"#2615","full":"gitlab-org\/gitaly#2615"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1491.0,"epic":{"id":8450,"iid":1491,"title":"\ud83c\udf3b Improved Gitaly Cluster admin experience","url":"\/groups\/gitlab-org\/-\/epics\/1491","group_id":9970,"human_readable_end_date":"Apr 22, 2020","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":32783997,"iid":2613,"project_id":2009901,"title":"Praefect: same storage name can't be used for different virtual storages","description":"If you have setup with multiple virtual storages and each storage has node with name `node-1` only one node will be used for processing.  \nAnother node will be treated as duplicate and skipped, [here is the code](https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/blob\/19fd0676954fd87cee2f0108efd3caaf20c5c266\/internal\/praefect\/datastore\/datastore.go#L168-170).\n\nExpected: all nodes must be bound to proper virtual storage so all operations can be routed properly.\n\n\/cc @zj-gitlab @jramsay","state":"closed","created_at":1585835266967,"updated_at":1592464048137,"closed_at":1590752836467,"closed_by":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"labels":["Category:Gitaly","Deliverable","devops::create","group::gitaly","group::gitaly::cluster","missed-deliverable","missed:13.0","priority::3","severity::3","type::bug","workflow::ready for development"],"milestone":{"id":1112145,"iid":47,"group_id":9970,"title":"13.1","description":"","state":"closed","created_at":"2020-01-03T12:28:30.160Z","updated_at":"2020-10-08T12:01:07.361Z","due_date":"2020-06-17","start_date":"2020-05-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/47"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"}],"author":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"user_notes_count":2,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2613","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2613","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2613\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2613\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2613","relative":"#2613","full":"gitlab-org\/gitaly#2613"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1491.0,"epic":{"id":8450,"iid":1491,"title":"\ud83c\udf3b Improved Gitaly Cluster admin experience","url":"\/groups\/gitlab-org\/-\/epics\/1491","group_id":9970,"human_readable_end_date":"Apr 22, 2020","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":"on_track","task_status":"0 of 0 checklist items completed"},{"id":32774722,"iid":2611,"project_id":2009901,"title":"WalkRepos should handle a directory being deleted during file walking","description":"[`service\/internalgitaly.WalkRepos`](https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/blob\/f3f4ae8bc2945b8363835e6c6862a7044311aa9e\/internal\/service\/internalgitaly\/walkrepos.go#L36) should handle a possible `not exists` errors. This can happen if a repository is deleted by another RPC during the file walk.","state":"closed","created_at":1585821600043,"updated_at":1587658515337,"closed_at":1587655343842,"closed_by":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"labels":["Category:Gitaly","Gitaly","devops::create","group::gitaly","priority::3","severity::2","type::bug","workflow::ready for development"],"milestone":{"id":991112,"iid":42,"group_id":9970,"title":"13.0","description":"","state":"closed","created_at":"2019-09-04T15:20:39.024Z","updated_at":"2020-10-08T12:00:55.725Z","due_date":"2020-05-17","start_date":"2020-04-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/42"},"assignees":[{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/5522960\/avatar.png","web_url":"https:\/\/gitlab.com\/samihiltunen"}],"author":{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/5522960\/avatar.png","web_url":"https:\/\/gitlab.com\/samihiltunen"},"type":"ISSUE","assignee":{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/5522960\/avatar.png","web_url":"https:\/\/gitlab.com\/samihiltunen"},"user_notes_count":3,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2611","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2611","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2611\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2611\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2611","relative":"#2611","full":"gitlab-org\/gitaly#2611"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":32760295,"iid":2608,"project_id":2009901,"title":"Detect node failure by read\/write failures","description":"### Problem to solve\n\nHealth checks can often succeed even if there is a problem with the server, Gitaly or Git. For example, the Gitaly process may be running just fine and respond with a healthy signal even though the persistent disk is not available which would prevent any Git operation from succeeding.\n\n### Further details\n\nHealth checks are relatively slow to detect failures (seconds), and are performed less frequently to the total number of Git operations. For example, a busy Gitaly node may be handle hundreds of requests per second (get commit, get file, list something etc). If multiple health checks must fail before failover, this means thousands of operations have failed before the system notices a failure.\n\n### Proposal\n\nPraefect should monitor Gitaly RPC success\/failures and mark a node as bad if there multiple failues in a row. For example, if 5 or 10 RPCs fail in a row, this is a strong signal that the node isn't working.\n\nWorst case scenario we fail over to an up to date replica because strong consistency means we always have an up to date replica https:\/\/gitlab.com\/groups\/gitlab-org\/-\/epics\/1189.\n\n### Testing\n\nFunctional end-to-end coverage will be provided by a new [failover test](https:\/\/gitlab.com\/gitlab-org\/quality\/testcases\/-\/issues\/836). And broad coverage by [running the entire end-to-end test suite against environments using Praefect for storage](https:\/\/gitlab.com\/gitlab-org\/gitlab-qa\/-\/blob\/master\/docs\/what_tests_can_be_run.md#testintegrationpraefect-ceeefull-image-address) (including Staging).\n\nPerformance end-to-end testing will be implemented as part of https:\/\/gitlab.com\/gitlab-org\/quality\/performance\/-\/issues\/231 (see https:\/\/gitlab.com\/gitlab-org\/quality\/team-tasks\/-\/issues\/451 for a more detailed plan of performance tests under failure conditions).\n\n### Links \/ references","state":"closed","created_at":1585785974058,"updated_at":1627579590259,"closed_at":1598957212978,"closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"labels":["Category:Gitaly","Deliverable","devops::create","group::gitaly","group::gitaly::cluster","missed-deliverable","missed:13.1","missed:13.2","quad-planning::complete-action","type::feature","workflow::in review"],"milestone":{"id":1233753,"iid":51,"group_id":9970,"title":"13.4","description":"https:\/\/about.gitlab.com\/releases\/2020\/09\/22\/gitlab-13-4-released\/","state":"closed","created_at":"2020-04-09T17:39:21.662Z","updated_at":"2022-04-13T14:50:33.769Z","due_date":"2020-09-17","start_date":"2020-08-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/51"},"assignees":[{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/5522960\/avatar.png","web_url":"https:\/\/gitlab.com\/samihiltunen"}],"author":{"id":1187333,"username":"jramsay-gitlab","name":"James Ramsay (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/1187333\/avatar.png","web_url":"https:\/\/gitlab.com\/jramsay-gitlab"},"type":"ISSUE","assignee":{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/5522960\/avatar.png","web_url":"https:\/\/gitlab.com\/samihiltunen"},"user_notes_count":16,"merge_requests_count":2,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2608","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":1,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2608","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2608\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2608\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2608","relative":"#2608","full":"gitlab-org\/gitaly#2608"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2983.0,"epic":{"id":36565,"iid":2983,"title":"\ud83e\udd84 HA Gitaly: improved availability","url":"\/groups\/gitlab-org\/-\/epics\/2983","group_id":9970,"human_readable_end_date":"Jan 17, 2021","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":32409342,"iid":2580,"project_id":2009901,"title":"Expose node level metrics even if automatic failover is disabled","description":"Currently, node metrics such as `gitaly_praefect_primaries` and `gitaly_praefect_node_latency` get populated when `failover_enabled = true`. We should populate these metrics regardless.\n\nThis involves refactoring the node manager so that it does healthchecks on the nodes even if `failover_enabled = false`.\n\nHere is where we start the health checks: https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/blob\/master\/internal\/praefect\/nodes\/manager.go#L164\n\nThe easiest way is to probably prevent node promotion with `failoverEnabled` in https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/blob\/master\/internal\/praefect\/nodes\/manager.go#L164","state":"closed","created_at":1585090868037,"updated_at":1595056013647,"closed_at":1594361362726,"closed_by":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"labels":["Category:Gitaly","Deliverable","demo","devops::create","group::gitaly","group::gitaly::cluster","missed-deliverable","missed:13.0","missed:13.1","workflow::ready for development"],"milestone":{"id":1233746,"iid":49,"group_id":9970,"title":"13.2","description":"https:\/\/about.gitlab.com\/releases\/2020\/07\/22\/gitlab-13-2-released\/","state":"closed","created_at":"2020-04-09T17:28:01.032Z","updated_at":"2022-04-13T14:48:24.167Z","due_date":"2020-07-17","start_date":"2020-06-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/49"},"assignees":[{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/228150\/avatar.png","web_url":"https:\/\/gitlab.com\/proglottis"}],"author":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"},"type":"ISSUE","assignee":{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/228150\/avatar.png","web_url":"https:\/\/gitlab.com\/proglottis"},"user_notes_count":6,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2580","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2580","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2580\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2580\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2580","relative":"#2580","full":"gitlab-org\/gitaly#2580"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1491.0,"epic":{"id":8450,"iid":1491,"title":"\ud83c\udf3b Improved Gitaly Cluster admin experience","url":"\/groups\/gitlab-org\/-\/epics\/1491","group_id":9970,"human_readable_end_date":"Apr 22, 2020","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":"on_track","task_status":"0 of 0 checklist items completed"},{"id":32242603,"iid":2563,"project_id":2009901,"title":"On startup, Praefect can't talk to gitaly nodes before it picks up replication jobs","description":"During our demo on 3\/20\/20, we observed that when praefect is brought up when the sql replication queue has jobs in `ready`, praefect picks up the jobs immediately and tries to replicate, but failed because it couldn't talk to gitaly.\n\nTo reproduce:\n\n1. bring praefect down\n1. create replication jobs on the sql database\n1. bring praefect up\n\nin the logs, praefect will complain that it cannot talk to gitaly, and the jobs will fail.","state":"closed","created_at":1584722459315,"updated_at":1588698878013,"closed_at":1588695355749,"closed_by":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"},"labels":["Category:Gitaly","auto updated","devops::create","group::gitaly","type::bug","workflow::ready for development"],"milestone":{"id":991112,"iid":42,"group_id":9970,"title":"13.0","description":"","state":"closed","created_at":"2019-09-04T15:20:39.024Z","updated_at":"2020-10-08T12:00:55.725Z","due_date":"2020-05-17","start_date":"2020-04-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/42"},"assignees":[{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"}],"author":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"},"type":"ISSUE","assignee":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"},"user_notes_count":6,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2563","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2563","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2563\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2563\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2563","relative":"#2563","full":"gitlab-org\/gitaly#2563"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":32212850,"iid":2559,"project_id":2009901,"title":"Drop Golang 1.12 support","description":"With the release of Go 1.14, the support stops for Go 1.13 as per the Golang policy to support the last two releases. This means that Gitaly now supports being compiled by an unsupported Golang version.\n\nAction items:\n- [x] Remove Go 1.12 from our Pipeline\n- [ ] Remove Go 1.12 from the docs at this project, and GitLab","state":"closed","created_at":1584691166937,"updated_at":1614983257833,"closed_at":1586181629102,"closed_by":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"labels":["Category:Gitaly","[deprecated] Accepting merge requests","auto updated","backstage [DEPRECATED]","devops::create","group::gitaly","workflow::production"],"milestone":{"id":1104429,"iid":46,"group_id":9970,"title":"12.10","description":"https:\/\/about.gitlab.com\/releases\/2020\/04\/22\/gitlab-12-10-released","state":"closed","created_at":"2019-12-20T15:15:53.243Z","updated_at":"2020-10-08T12:00:39.852Z","due_date":"2020-04-17","start_date":"2020-03-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/46"},"assignees":[],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"type":"ISSUE","assignee":null,"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2559","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":2,"completed_count":1},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2559","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2559\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2559\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2559","relative":"#2559","full":"gitlab-org\/gitaly#2559"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":5153.0,"epic":{"id":177675,"iid":5153,"title":"Upgrade Go to 1.14.x","url":"\/groups\/gitlab-org\/-\/epics\/5153","group_id":9970,"human_readable_end_date":"Feb 24, 2021","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":null},{"id":32114771,"iid":2553,"project_id":2009901,"title":"Enable partial clone with blob size filter by default","description":"## Problem to solve\n\nOnce it is possible to enable blob and sparsity filters independently, we should enable blob filters by default since they are low risk and make it easy for customers to try out partial clone.\n\n## Proposal\n\nCurrently we have one feature flag `gitaly_upload_pack_filter` to control both blob and sparsity filters.\n\n- reuse the existing feature flag `gitaly_upload_pack_filter` for blob filters, and default to enabled\n- create a new feature flag `gitaly_upload_pack_filter_sparsity` for sparsity filters, and default to false\n\n## Links\/references","state":"closed","created_at":1584504041679,"updated_at":1589785714703,"closed_at":1588673140790,"closed_by":{"id":138401,"username":"chriscool","name":"Christian Couder","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/138401\/avatar.png","web_url":"https:\/\/gitlab.com\/chriscool"},"labels":["Category:Gitaly","Deliverable","devops::create","direction","group::gitaly","missed-deliverable","missed:12.10","workflow::ready for development"],"milestone":{"id":991112,"iid":42,"group_id":9970,"title":"13.0","description":"","state":"closed","created_at":"2019-09-04T15:20:39.024Z","updated_at":"2020-10-08T12:00:55.725Z","due_date":"2020-05-17","start_date":"2020-04-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/42"},"assignees":[{"id":138401,"username":"chriscool","name":"Christian Couder","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/138401\/avatar.png","web_url":"https:\/\/gitlab.com\/chriscool"}],"author":{"id":1187333,"username":"jramsay-gitlab","name":"James Ramsay (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/1187333\/avatar.png","web_url":"https:\/\/gitlab.com\/jramsay-gitlab"},"type":"ISSUE","assignee":{"id":138401,"username":"chriscool","name":"Christian Couder","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/138401\/avatar.png","web_url":"https:\/\/gitlab.com\/chriscool"},"user_notes_count":5,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2553","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2553","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2553\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2553\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2553","relative":"#2553","full":"gitlab-org\/gitaly#2553"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":958.0,"epic":{"id":5319,"iid":958,"title":"Minimal partial clone support","url":"\/groups\/gitlab-org\/-\/epics\/958","group_id":9970,"human_readable_end_date":"May 17, 2020","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":32070182,"iid":2547,"project_id":2009901,"title":"SQL for failover and leader election","description":"## Problem to solve\n\nIt is important that multiple Praefect proxies\/routers can be run at the same time so that there is no single point of failure. These need to be consistent in choosing the same primary node else different Praefects will route requests inconsistently causing data loss.\n\n## Further details\n\nThere have been investigations in Consul https:\/\/gitlab.com\/gitlab-org\/gitaly\/issues\/2037 https:\/\/gitlab.com\/gitlab-org\/gitaly\/issues\/2458 for GitLab Omnibus, since this is a good application of Consul. However, Consul isn't likely to be ideal in a Kubernetes environment.\n\nSince we already have a PostgreSQL database as part of the current architecture, and is seems like viable first iteration (spike https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/merge_requests\/1883) we will use this for providing failover and leader election. We plan to keep open the possibility for supporting Consul and K8s features for these problems.\n\n## Proposal\n\n1. We do some lightweight refactoring to prepare the Praefect code to support both SQL and Consul\n1. We aim to incorporate the SQL PoC approach first and roll out two Praefect nodes on GitLab.com.\n1. Focus on getting failover metrics etc. so we have more data on how this performs\n\n## Links \/ references","state":"closed","created_at":1584435151361,"updated_at":1587766234914,"closed_at":1586442097573,"closed_by":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"labels":["Category:Gitaly","Deliverable","auto updated","devops::create","direction","group::gitaly","group::gitaly::cluster","priority::1","type::feature","workflow::in review"],"milestone":{"id":1104429,"iid":46,"group_id":9970,"title":"12.10","description":"https:\/\/about.gitlab.com\/releases\/2020\/04\/22\/gitlab-12-10-released","state":"closed","created_at":"2019-12-20T15:15:53.243Z","updated_at":"2020-10-08T12:00:39.852Z","due_date":"2020-04-17","start_date":"2020-03-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/46"},"assignees":[{"id":64248,"username":"stanhu","name":"Stan Hu","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/64248\/stanhu.jpg","web_url":"https:\/\/gitlab.com\/stanhu"}],"author":{"id":1187333,"username":"jramsay-gitlab","name":"James Ramsay (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/1187333\/avatar.png","web_url":"https:\/\/gitlab.com\/jramsay-gitlab"},"type":"ISSUE","assignee":{"id":64248,"username":"stanhu","name":"Stan Hu","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/64248\/stanhu.jpg","web_url":"https:\/\/gitlab.com\/stanhu"},"user_notes_count":8,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2547","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":6,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2547","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2547\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2547\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2547","relative":"#2547","full":"gitlab-org\/gitaly#2547"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2657.0,"epic":{"id":20747,"iid":2657,"title":"\ud83d\udea8 Gitaly HA (beta)","url":"\/groups\/gitlab-org\/-\/epics\/2657","group_id":9970,"human_readable_end_date":"May 17, 2020","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":"on_track","task_status":"0 of 0 checklist items completed"},{"id":32037158,"iid":2546,"project_id":2009901,"title":"Document how to keep Praefect's SQL schema up to date","description":"Praefect has its own SQL database. Every time you deploy a new version of Praefect you need to make sure you run any pending SQL migrations.\n\nThe status quo in multi-node GitLab installations is that the local administrators must have their own process for running database migrations. In the gitlab-rails case this means running `rake db:migrate`. https:\/\/docs.gitlab.com\/omnibus\/update\/#zero-downtime-updates\n\nI think we should extend this documentation with information on how to run Praefect migrations.","state":"closed","created_at":1584364413347,"updated_at":1589785714737,"closed_at":1587708284241,"closed_by":{"id":4849,"username":"balasankarc","name":"Balasankar 'Balu' C","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4849\/avatar.png","web_url":"https:\/\/gitlab.com\/balasankarc"},"labels":["Deliverable","devops::create","group::gitaly","group::gitaly::cluster","missed-deliverable","missed:12.10","priority::2","workflow::in review"],"milestone":{"id":991112,"iid":42,"group_id":9970,"title":"13.0","description":"","state":"closed","created_at":"2019-09-04T15:20:39.024Z","updated_at":"2020-10-08T12:00:55.725Z","due_date":"2020-05-17","start_date":"2020-04-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/42"},"assignees":[{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/513969\/avatar.png","web_url":"https:\/\/gitlab.com\/jacobvosmaer-gitlab"}],"author":{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/513969\/avatar.png","web_url":"https:\/\/gitlab.com\/jacobvosmaer-gitlab"},"type":"ISSUE","assignee":{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/513969\/avatar.png","web_url":"https:\/\/gitlab.com\/jacobvosmaer-gitlab"},"user_notes_count":0,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2546","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2546","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2546\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2546\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2546","relative":"#2546","full":"gitlab-org\/gitaly#2546"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2657.0,"epic":{"id":20747,"iid":2657,"title":"\ud83d\udea8 Gitaly HA (beta)","url":"\/groups\/gitlab-org\/-\/epics\/2657","group_id":9970,"human_readable_end_date":"May 17, 2020","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":"on_track","task_status":"0 of 0 checklist items completed"},{"id":31850391,"iid":2530,"project_id":2009901,"title":"Add praefect replication delay metric","description":"Per demo on 3\/10, a useful metric would be the total time from when a replication job is created to when it is completed. This would give us total \"replication delay\".\n\nAdditionally, this metric should be graphed in Grafana: https:\/\/dashboards.gitlab.net\/d\/8EAXC-AWz\/praefect?orgId=1&from=now-24h&to=now\n","state":"closed","created_at":1583881163516,"updated_at":1587193701459,"closed_at":1586193594869,"closed_by":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"},"labels":["Deliverable","demo","devops::create","group::gitaly","group::gitaly::cluster","workflow::in review"],"milestone":{"id":1104429,"iid":46,"group_id":9970,"title":"12.10","description":"https:\/\/about.gitlab.com\/releases\/2020\/04\/22\/gitlab-12-10-released","state":"closed","created_at":"2019-12-20T15:15:53.243Z","updated_at":"2020-10-08T12:00:39.852Z","due_date":"2020-04-17","start_date":"2020-03-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/46"},"assignees":[{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"}],"author":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"},"type":"ISSUE","assignee":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"user_notes_count":3,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2530","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2530","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2530\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2530\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2530","relative":"#2530","full":"gitlab-org\/gitaly#2530"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2657.0,"epic":{"id":20747,"iid":2657,"title":"\ud83d\udea8 Gitaly HA (beta)","url":"\/groups\/gitlab-org\/-\/epics\/2657","group_id":9970,"human_readable_end_date":"May 17, 2020","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":31685325,"iid":2525,"project_id":2009901,"title":"Turn on info-ref advertisement cache by default","description":"Right now, info-ref advertisement caching is guarded by a feature flag. We have been running the feature on GitLab.com for a while now without major incidents (last incident was `TODO: link issue with cache walker incident`). This should be enabled by default.","state":"closed","created_at":1583515980467,"updated_at":1587193701566,"closed_at":1587041159284,"closed_by":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"labels":["Category:Gitaly","Deliverable","bug::performance","devops::create","group::gitaly","workflow::in review"],"milestone":{"id":1104429,"iid":46,"group_id":9970,"title":"12.10","description":"https:\/\/about.gitlab.com\/releases\/2020\/04\/22\/gitlab-12-10-released","state":"closed","created_at":"2019-12-20T15:15:53.243Z","updated_at":"2020-10-08T12:00:39.852Z","due_date":"2020-04-17","start_date":"2020-03-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/46"},"assignees":[{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"}],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"type":"ISSUE","assignee":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"user_notes_count":2,"merge_requests_count":0,"upvotes":2,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2525","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2525","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2525\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2525\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2525","relative":"#2525","full":"gitlab-org\/gitaly#2525"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1190.0,"epic":{"id":6002,"iid":1190,"title":"Reduce worst Gitaly IO hotspots","url":"\/groups\/gitlab-org\/-\/epics\/1190","group_id":9970,"human_readable_end_date":"Apr 17, 2020","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":31631137,"iid":2524,"project_id":2009901,"title":"Add GetFullestShard, GetBusiestShard, GetFastestGrowingProject, GetBusiestProject grpc methods","description":"As a gitlab admin, I would like to balance git repository storage between shards based on project activity and growth.\n\nGitaly now provides information about current disk usage and availability per shard.\n\nThe following GRPC methods could be very useful in selecting specific projects for relocation.\n\n- `GetFullestShard`\n- `GetBusiestShard`\n- `GetFastestGrowingProject`\n- `GetBusiestProject`\n\nWhile this information *could* be examined using monitoring, it would be useful to integrate such informatics into the `gitlab-rails` app, in order to ultimately expose this information through the admin api, supporting admin tooling.","state":"closed","created_at":1583431565158,"updated_at":1635331584884,"closed_at":1583543121744,"closed_by":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4006601\/avatar.png","web_url":"https:\/\/gitlab.com\/nnelson"},"labels":["Category:Gitaly","Eng-Consumer::Infrastructure","Eng-Producer::Development","Engineering Allocation","devops::create","group::gitaly","infradev","infrastructure"],"milestone":{"id":490705,"iid":14,"group_id":9970,"title":"Backlog","description":"Issues that we want to do but are not planned right now. Open for contribution from the community.","state":"active","created_at":"2018-03-22T13:09:23.767Z","updated_at":"2018-10-30T14:56:54.069Z","due_date":null,"start_date":null,"expired":false,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/14"},"assignees":[],"author":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4006601\/avatar.png","web_url":"https:\/\/gitlab.com\/nnelson"},"type":"ISSUE","assignee":null,"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2524","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":8,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2524","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2524\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2524\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2524","relative":"#2524","full":"gitlab-org\/gitaly#2524"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":31270038,"iid":2502,"project_id":2009901,"title":"Add praefect storage to the performance bar","description":"## Problem to solve\n\nWhen using Gitaly HA it is hard to reconcile what you see in the browser, with what is happening on the server. Which node is primary? If I stop a node, which node is promoted to primary. This would be easy to know if there was information in the performance bar about this.\n\n## Proposal\n\nInclude information in the performance bar about which Gitaly node in the cluster responded to the request.\n\n## Links \/ references","state":"closed","created_at":1582677158002,"updated_at":1587455456335,"closed_at":1584940996375,"closed_by":{"id":1187333,"username":"jramsay-gitlab","name":"James Ramsay (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/1187333\/avatar.png","web_url":"https:\/\/gitlab.com\/jramsay-gitlab"},"labels":["[deprecated] Accepting merge requests","demo","devops::create","group::gitaly","group::gitaly::cluster","workflow::ready for development"],"milestone":null,"assignees":[],"author":{"id":1187333,"username":"jramsay-gitlab","name":"James Ramsay (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/1187333\/avatar.png","web_url":"https:\/\/gitlab.com\/jramsay-gitlab"},"type":"ISSUE","assignee":null,"user_notes_count":6,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2502","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2502","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2502\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2502\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2502","relative":"#2502","full":"gitlab-org\/gitaly#2502"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":31269946,"iid":2500,"project_id":2009901,"title":"Praefect dial-nodes has even more garbage output","description":"## Problem to solve\n\nIn the demo today we observed large amounts of garbage output. This seems like a regression.\n\n## Proposal\n\nRemove the noise from the output","state":"closed","created_at":1582676676869,"updated_at":1589785714812,"closed_at":1589502444644,"closed_by":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"},"labels":["Deliverable","demo","devops::create","group::gitaly","group::gitaly::cluster","type::bug","workflow::ready for development"],"milestone":{"id":991112,"iid":42,"group_id":9970,"title":"13.0","description":"","state":"closed","created_at":"2019-09-04T15:20:39.024Z","updated_at":"2020-10-08T12:00:55.725Z","due_date":"2020-05-17","start_date":"2020-04-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/42"},"assignees":[{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/228150\/avatar.png","web_url":"https:\/\/gitlab.com\/proglottis"}],"author":{"id":1187333,"username":"jramsay-gitlab","name":"James Ramsay (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/1187333\/avatar.png","web_url":"https:\/\/gitlab.com\/jramsay-gitlab"},"type":"ISSUE","assignee":{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/228150\/avatar.png","web_url":"https:\/\/gitlab.com\/proglottis"},"user_notes_count":3,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2500","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2500","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2500\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2500\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2500","relative":"#2500","full":"gitlab-org\/gitaly#2500"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2658.0,"epic":{"id":20748,"iid":2658,"title":"\ud83d\ude80 Gitaly HA (generally available)","url":"\/groups\/gitlab-org\/-\/epics\/2658","group_id":9970,"human_readable_end_date":"May 17, 2020","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":27970392,"iid":2237,"project_id":2009901,"title":"Gitaly should perform better Rails-side validation","description":"For example, this API query alone causes dozens of 500 errors per minute: https:\/\/log.gitlab.net\/goto\/bb1a0ad5013edecd5f0e31daa4c12df0\n\nThe Gitaly ruby client should do more basic client side validation, to ensure refs are valid (don't contain whitespace) etc. \n\nThis will prevent a remote GRPC call, git spawn etc, only to error with a basic validation error. \n\nMore examples of this: https:\/\/log.gitlab.net\/goto\/a5a4ce0c321fb5c3703286ced55d1df3","state":"closed","created_at":1575539307417,"updated_at":1589984157487,"closed_at":1589570052169,"closed_by":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"labels":["Category:Gitaly","Mechanical Sympathy","devops::create","group::gitaly","priority::3","severity::2","type::bug","workflow::ready for development"],"milestone":{"id":991112,"iid":42,"group_id":9970,"title":"13.0","description":"","state":"closed","created_at":"2019-09-04T15:20:39.024Z","updated_at":"2020-10-08T12:00:55.725Z","due_date":"2020-05-17","start_date":"2020-04-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/42"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"}],"author":{"id":895869,"username":"andrewn","name":"Andrew Newdigate","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/895869\/avatar.png","web_url":"https:\/\/gitlab.com\/andrewn"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"user_notes_count":8,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2237","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2237","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2237\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2237\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2237","relative":"#2237","full":"gitlab-org\/gitaly#2237"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":27479933,"iid":2204,"project_id":2009901,"title":"Remove old praefect config virtual_storage_name and nodes","description":"Once https:\/\/gitlab.com\/gitlab-org\/omnibus-gitlab\/merge_requests\/3754 and gdk is updated with the change to allow multiple praefect virtual storages, we can remove the backwards compatible support in praefect.\n\nalso we need to remove the text fixture in `internal\/praefect\/config\/testdata\/single-virtual-storage.config.toml`","state":"closed","created_at":1574452703670,"updated_at":1588151876247,"closed_at":1588151049042,"closed_by":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"labels":["Category:Gitaly","auto updated","devops::create","group::gitaly","group::gitaly::cluster","maintenance::refactor","workflow::ready for development"],"milestone":{"id":991112,"iid":42,"group_id":9970,"title":"13.0","description":"","state":"closed","created_at":"2019-09-04T15:20:39.024Z","updated_at":"2020-10-08T12:00:55.725Z","due_date":"2020-05-17","start_date":"2020-04-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/42"},"assignees":[{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"}],"author":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"},"type":"ISSUE","assignee":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"},"user_notes_count":4,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2204","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2204","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2204\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2204\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2204","relative":"#2204","full":"gitlab-org\/gitaly#2204"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":27083225,"iid":2167,"project_id":2009901,"title":"Observe which projects suffered dataloss from failover","description":"## Problem to solve\n\nAs an administrator, when a failover occurs, I want to know which repositories have experienced dataloss. This provides me an indication of which developers have been effected and where to target efforts for recovering missing data where possible. For example, letting a team know that they might need to re-push their feature branches.\n\n## Further details\n\nAt a minimum, we should be able to which specific projects suffered dataloss, caused by replication operations that cannot be completed due to incomplete replication queue.\n\nA possible future improvement could also be to summarize the number of replication jobs lost for each repo, and perhaps even count per ref, per repository.\n\n## Proposal\n\nStore failed replication jobs for some period of time in the Praefect database, and provide a method for reporting on this.\n\nPerhaps the MVC, would be command that can be run on any Praefect server to:\n\n- dump all the failed replication jobs (this could be useful for analysis)\n- summarize failed replication jobs\n","state":"closed","created_at":1573810030660,"updated_at":1587386208061,"closed_at":1587339067829,"closed_by":{"id":1187333,"username":"jramsay-gitlab","name":"James Ramsay (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/1187333\/avatar.png","web_url":"https:\/\/gitlab.com\/jramsay-gitlab"},"labels":["Deliverable","backstage [DEPRECATED]","devops::create","direction","group::gitaly","group::gitaly::cluster","priority::2","workflow::in review"],"milestone":{"id":1104429,"iid":46,"group_id":9970,"title":"12.10","description":"https:\/\/about.gitlab.com\/releases\/2020\/04\/22\/gitlab-12-10-released","state":"closed","created_at":"2019-12-20T15:15:53.243Z","updated_at":"2020-10-08T12:00:39.852Z","due_date":"2020-04-17","start_date":"2020-03-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/46"},"assignees":[{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/5522960\/avatar.png","web_url":"https:\/\/gitlab.com\/samihiltunen"}],"author":{"id":1187333,"username":"jramsay-gitlab","name":"James Ramsay (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/1187333\/avatar.png","web_url":"https:\/\/gitlab.com\/jramsay-gitlab"},"type":"ISSUE","assignee":{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/5522960\/avatar.png","web_url":"https:\/\/gitlab.com\/samihiltunen"},"user_notes_count":16,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2167","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2167","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2167\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2167\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2167","relative":"#2167","full":"gitlab-org\/gitaly#2167"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2657.0,"epic":{"id":20747,"iid":2657,"title":"\ud83d\udea8 Gitaly HA (beta)","url":"\/groups\/gitlab-org\/-\/epics\/2657","group_id":9970,"human_readable_end_date":"May 17, 2020","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":"on_track","task_status":"0 of 0 checklist items completed"},{"id":26989784,"iid":2160,"project_id":2009901,"title":"Use `--end-of-options` in the GitDSL","description":"Requires the minimum version of Git 2.24: https:\/\/gitlab.com\/gitlab-org\/gitaly\/issues\/2170\n\nFrom the GH release blog: https:\/\/github.blog\/2019-11-03-highlights-from-git-2-24\/#tidbits\n\n>>>\nGit 2.24 has a new way to prevent this sort of option injection attack using --end-of-options. When Git sees this as an argument to any command, it knows to treat the remaining arguments as such, and won\u2019t interpret them as more options.\n\nSo, instead of the string previously mentioned, you could write the following to get the history of your (admittedly, pretty oddly named) branch:\n\n$ git log --end-of-options --super-dangerous-option\n\nNot using the standard -- was an intentional choice here, since this is already a widely-used mechanism in Git to separate reference names from files. In this example, you could have also written git log --end-of-options --super-dangerous-option ^master -- path\/to\/file to get only the history over that range which modified that specific file.\n>>>\n\nExample of the Git behaviour:\n\n```\n$ git diff --end-of-options --name-only HEAD~ HEAD\nfatal: option '--name-only' must come before non-option arguments\n```","state":"closed","created_at":1573580032832,"updated_at":1592464048236,"closed_at":1590140882232,"closed_by":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"labels":["Category:Gitaly","Deliverable","devops::create","group::gitaly","security","type::feature","workflow::in review"],"milestone":{"id":1112145,"iid":47,"group_id":9970,"title":"13.1","description":"","state":"closed","created_at":"2020-01-03T12:28:30.160Z","updated_at":"2020-10-08T12:01:07.361Z","due_date":"2020-06-17","start_date":"2020-05-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/47"},"assignees":[{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"type":"ISSUE","assignee":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"user_notes_count":5,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2160","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2160","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2160\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2160\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2160","relative":"#2160","full":"gitlab-org\/gitaly#2160"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1893.0,"epic":{"id":12146,"iid":1893,"title":"\ud83e\uddef Git DSL for Gitaly","url":"\/groups\/gitlab-org\/-\/epics\/1893","group_id":9970,"human_readable_end_date":"Jun 17, 2020","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":26782454,"iid":2146,"project_id":2009901,"title":"Add GetStorageDiskStatistics grpc","description":"It may also be useful to implement a method for obtaining a collection of disk space statistics.  In fact, this could reduce overall load on the server, by avoiding the need to invoke multiple remote procedure calls to obtain separate details.\n\nSo this issue is to suggest the feature addition of a `grpc` resembling `GetStorageDiskStatistics` which would return a collection, ideally a dictionary, containing at least the disk `avail` and disk `used` portions of the output of a `df \/var\/opt\/gitlab` invocation on the given target storage node system.","state":"closed","created_at":1573065420993,"updated_at":1574671732444,"closed_at":1574671732333,"closed_by":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"labels":["Category:Gitaly","devops::create","group::gitaly","missed:12.5","production request","type::feature","workflow::in review"],"milestone":{"id":891797,"iid":40,"group_id":9970,"title":"12.6","description":"https:\/\/about.gitlab.com\/releases\/2019\/12\/22\/gitlab-12-6-released","state":"closed","created_at":"2019-05-31T08:38:03.539Z","updated_at":"2020-04-27T16:27:13.329Z","due_date":"2019-12-17","start_date":"2019-11-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/40"},"assignees":[{"id":2207885,"username":"maxmati","name":"Mateusz Nowotynski","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/321da2d4dd336295456ea3921eab40d3?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/maxmati"}],"author":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4006601\/avatar.png","web_url":"https:\/\/gitlab.com\/nnelson"},"type":"ISSUE","assignee":{"id":2207885,"username":"maxmati","name":"Mateusz Nowotynski","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/321da2d4dd336295456ea3921eab40d3?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/maxmati"},"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2146","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2146","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2146\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2146\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2146","relative":"#2146","full":"gitlab-org\/gitaly#2146"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":26778710,"iid":2144,"project_id":2009901,"title":"Add GetStorageDiskUsed grpc","description":"Currently, `gitlab-rails` acquires disk usage information for individual project repositories from `gitaly` which ultimately appears to use `du` (https:\/\/gitlab.com\/gitlab-org\/gitaly\/blob\/master\/internal\/service\/repository\/size.go#L36).\n\nAs an SRE, I am responsible for managing storage node configuration through the gitlab rails web application admin section, and also adding new nodes as needed.  Automating these procedures would be very helpful for our team.  To accomplish this, some data is required.\n\nI would like to have reliable access to the disk `used` (amount of disk in current use) statistic.\n\nOnly as an example, not an implementation recommendation: `ssh file-34-stor-gprd.c.gitlab-production.internal 'df \/var\/opt\/gitlab --output=used | tail -n1' #=> 13710976516`\n\nAfter having spoken with @pokstad1 and @jacobvosmaer-gitlab , I think the best suggestion is to implement a `grpc` resembling `GetStorageDiskUsed` which will return the parsed results of such an `df` operation with the relevant detail or details.","state":"closed","created_at":1573057500923,"updated_at":1573124225838,"closed_at":1573124131176,"closed_by":{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/513969\/avatar.png","web_url":"https:\/\/gitlab.com\/jacobvosmaer-gitlab"},"labels":["Category:Gitaly","devops::create","group::gitaly","production request","type::feature"],"milestone":null,"assignees":[],"author":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4006601\/avatar.png","web_url":"https:\/\/gitlab.com\/nnelson"},"type":"ISSUE","assignee":null,"user_notes_count":3,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2144","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2144","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2144\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2144\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2144","relative":"#2144","full":"gitlab-org\/gitaly#2144"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":26778708,"iid":2143,"project_id":2009901,"title":"Add GetStorageDiskAvail grpc","description":"Currently, `gitlab-rails` acquires disk usage information for individual project repositories from `gitaly` which ultimately appears to use `du` (https:\/\/gitlab.com\/gitlab-org\/gitaly\/blob\/master\/internal\/service\/repository\/size.go#L36).\n\nAs an SRE, I am responsible for managing storage node configuration through the gitlab rails web application admin section, and also adding new nodes as needed.  Automating these procedures would be very helpful for our team.  To accomplish this, some data is required.\n\nI would like to have reliable access to the disk `avail` (amount of remaining -- unused -- disk space available for use) statistic.\n\nOnly as an example, not an implementation recommendation: `ssh file-34-stor-gprd.c.gitlab-production.internal 'df \/var\/opt\/gitlab --output=avail | tail -n1' #=> 2933905600`\n\nAfter having spoken with @pokstad1 and @jacobvosmaer-gitlab , I think the best suggestion is to implement a `grpc` resembling `GetStorageDiskAvail` which will return the parsed results of such an `df` operation with the relevant detail or details.","state":"closed","created_at":1573057496858,"updated_at":1573124118058,"closed_at":1573124118024,"closed_by":{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/513969\/avatar.png","web_url":"https:\/\/gitlab.com\/jacobvosmaer-gitlab"},"labels":["Category:Gitaly","devops::create","group::gitaly","production request","type::feature"],"milestone":null,"assignees":[],"author":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4006601\/avatar.png","web_url":"https:\/\/gitlab.com\/nnelson"},"type":"ISSUE","assignee":null,"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2143","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2143","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2143\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2143\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2143","relative":"#2143","full":"gitlab-org\/gitaly#2143"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":26718942,"iid":2137,"project_id":2009901,"title":"Remove WikiService#get_formatted_data RPC","description":"Depends on: https:\/\/gitlab.com\/gitlab-org\/gitlab\/merge_requests\/19627\n\nThe RPC has gone unused, and can be removed from both our `Protobuf` schema, as well as the Golang + Ruby code that's related.","state":"closed","created_at":1572964964005,"updated_at":1573079042705,"closed_at":1573079042661,"closed_by":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"},"labels":["Category:Gitaly","backstage [DEPRECATED]","devops::create","group::gitaly","workflow::in review"],"milestone":{"id":891796,"iid":39,"group_id":9970,"title":"12.5","description":"https:\/\/about.gitlab.com\/releases\/2019\/11\/22\/gitlab-12-5-released","state":"closed","created_at":"2019-05-31T08:38:03.087Z","updated_at":"2020-04-27T16:27:03.474Z","due_date":"2019-11-17","start_date":"2019-10-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/39"},"assignees":[{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"type":"ISSUE","assignee":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2137","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2137","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2137\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2137\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2137","relative":"#2137","full":"gitlab-org\/gitaly#2137"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":26227127,"iid":2108,"project_id":2009901,"title":"Gitaly spikes to 100% CPU usage when a moved project's branch details are called via API","description":"### Summary\n\nThis will affect all environments when customers move workload in different shards. We did find this out while testing out our new [50k Reference Architecture](https:\/\/docs.gitlab.com\/ee\/administration\/high_availability\/README.html#50000-user-configuration) I noticed that one of the 4 Gitaly nodes was spiking to 100% when performance testing was done against the [Repository Branch Details API](https:\/\/docs.gitlab.com\/ee\/api\/branches.html#get-single-repository-branch).\n\n![image](\/uploads\/5b0c199a53a039bda4c9f4445691d940\/image.png)\n\nhttp:\/\/50k.testbed.gitlab.net\/-\/grafana\/dashboard\/snapshot\/KDpnPrAq5Cj3sH75cGenTJE400E3G0X8\n\nIn this setup we have 4 identical Gitaly nodes (64 CPU, 240GB Memory) that each have a copy of the same large project on each. Our test tool then tests the environment at a rate of 1000 RPS and makes calls equally to each of the 4 project copies (so approximately 250 RPS to each Gitaly node). The other copies of the prohect only should around 20% usage.\n\nThe only difference that applied here is how the copy of the project was imported to the affected Gitaly node - It was specifically moved from another Gitaly node via the [Project Edit API](https:\/\/docs.gitlab.com\/ee\/api\/projects.html#edit-project) where as all the others were imported to their Gitaly nodes directly via UI settings.\n\nTo verify this I imported another copy of the project today in the same way to another Gitaly node and was able to reproduce the issue successfully.\n\nOf note the affected node shows numerous Git operations (details in the logs section below). Interestingly not all Linux task managers showed these Git operations but `top` did and they were averaging around 20% CPU usage.\n\n### Steps to reproduce\n\n1. Import a Project to an environment that has at least 2 Gitaly nodes (API was used in this case and the specific project is [a copy of `gitlab-foss`](https:\/\/gitlab.com\/gitlab-org\/quality\/performance-data\/blob\/master\/gitlabhq_export.tar.gz)).\n1. Move the project to the other Gitaly node via the [Project Edit API](https:\/\/docs.gitlab.com\/ee\/api\/projects.html#edit-project).\n1. Set up a way to monitor the CPU use on the Gitaly node that now contains the project (e.g. Prometheus or even just watching `top` on the node directly)\n1. [Prepare the GitLab Performance Tool](https:\/\/gitlab.com\/gitlab-org\/quality\/performance#documentation) and the proceed to run the `api_v4_projects_repository_branches_branch` test against the environment. The RPS rate will be dependent on your environment but `20s_20rps` should do, e.g.\n    * `ACCESS_TOKEN=<token> .\/run-k6 -e environments\/<environment>.json -s scenarios\/20s_20rps.json -t tests\/api_v4_projects_repository_branches_branch.js`\n1. As the test is running note that the CPU usage spikes massively to 100%.\n\n### Example Project\n\nWe use a copy of [`gitlab-foss`](https:\/\/gitlab.com\/gitlab-org\/quality\/performance-data\/blob\/master\/gitlabhq_export.tar.gz). It's specifically a backup of our own backup on GitHub, [gitlabhq](https:\/\/github.com\/gitlabhq\/gitlabhq), as that's sanitised and doesn't contain private data.\n\n### What is the current *bug* behavior?\n\nGitaly CPU usage spikes massively to 100% when the [Repository Branch Details API](https:\/\/docs.gitlab.com\/ee\/api\/branches.html#get-single-repository-branch) endpoint is polled for a project that's been moved to the Gitaly node via the [Project Edit API](https:\/\/docs.gitlab.com\/ee\/api\/projects.html#edit-project).\n\n### What is the expected *correct* behavior?\n\nThat the Gitaly node shows the same CPU usage as others where the project is the same but hasn't been moved via the [Project Edit API](https:\/\/docs.gitlab.com\/ee\/api\/projects.html#edit-project).\n\n### Relevant logs and\/or screenshots\n\n[Perf Output](https:\/\/docs.gitlab.com\/ee\/administration\/troubleshooting\/sidekiq.html#process-profiling-with-perf), taken over a couple of minutes as a long version of the test was running:\n```\nSamples: 59M of event 'cpu-clock', Event count (approx.): 14942880250000\nOverhead  Command  Shared Object           Symbol\n  27.56%  git      libz.so.1.2.11          [.] inflate\n  21.79%  git      libz.so.1.2.11          [.] inflate_table\n   9.28%  git      libz.so.1.2.11          [.] inflate_fast\n   3.59%  git      libc-2.27.so            [.] 0x000000000018adb8\n   3.53%  git      git                     [.] lookup_object\n   2.27%  git      libz.so.1.2.11          [.] adler32_z\n   1.69%  git      git                     [.] clear_commit_marks_1\n   1.61%  git      git                     [.] create_object\n   1.49%  git      git                     [.] hashmap_get\n   1.40%  git      git                     [.] parse_commit_buffer\n   1.16%  git      git                     [.] nth_packed_object_offset\n   1.13%  git      [kernel.kallsyms]       [k] __do_page_fault\n   1.09%  git      [kernel.kallsyms]       [k] clear_page_erms\n   0.91%  git      git                     [.] get_sha1_hex\n   0.61%  git      git                     [.] bsearch_hash\n   0.50%  git      git                     [.] compare_commits_by_gen_then_commit_date\n   0.46%  git      libc-2.27.so            [.] 0x00000000000950dd\n   0.43%  git      [kernel.kallsyms]       [k] _raw_spin_unlock_irqrestore\n   0.42%  git      git                     [.] unpack_object_header_buffer\n   0.40%  git      [kernel.kallsyms]       [k] unmap_page_range\n   0.39%  git      [kernel.kallsyms]       [k] get_page_from_freelist\n   0.37%  git      libc-2.27.so            [.] malloc\n   0.37%  git      [kernel.kallsyms]       [k] filemap_map_pages\n   0.36%  git      git                     [.] prio_queue_get\n   0.36%  git      [kernel.kallsyms]       [k] try_charge\n   0.35%  git      git                     [.] paint_down_to_common\n   0.35%  git      [kernel.kallsyms]       [k] __d_lookup_rcu\n   0.34%  git      git                     [.] prio_queue_put\n   0.29%  git      [kernel.kallsyms]       [k] do_syscall_64\n```\n\n[Go Tool `pprof` output](https:\/\/gitlab.com\/gitlab-com\/runbooks\/blob\/master\/howto\/gitaly-profiling.md#1-download-the-profiles). Top 30 Cumulative:\n```\nShowing nodes accounting for 4.24s, 23.30% of 18.20s total\nDropped 581 nodes (cum <= 0.09s)\nShowing top 30 nodes out of 272\n      flat  flat%   sum%        cum   cum%\n         0     0%     0%      7.48s 41.10%  google.golang.org\/grpc.(*Server).serveStreams.func1.1\n         0     0%     0%      7.47s 41.04%  google.golang.org\/grpc.(*Server).handleStream\n     0.01s 0.055% 0.055%      7.47s 41.04%  google.golang.org\/grpc.(*Server).processUnaryRPC\n         0     0% 0.055%      6.93s 38.08%  github.com\/grpc-ecosystem\/go-grpc-middleware.ChainUnaryServer.func1\n         0     0% 0.055%      6.92s 38.02%  github.com\/grpc-ecosystem\/go-grpc-middleware\/tags.UnaryServerInterceptor.func1\n     0.01s 0.055%  0.11%      6.84s 37.58%  github.com\/grpc-ecosystem\/go-grpc-middleware.ChainUnaryServer.func1.1\n         0     0%  0.11%      6.84s 37.58%  gitlab.com\/gitlab-org\/labkit\/correlation\/grpc.UnaryServerCorrelationInterceptor.func1\n         0     0%  0.11%      6.82s 37.47%  gitlab.com\/gitlab-org\/gitaly\/internal\/middleware\/metadatahandler.UnaryInterceptor\n         0     0%  0.11%      6.75s 37.09%  github.com\/grpc-ecosystem\/go-grpc-prometheus.(*ServerMetrics).UnaryServerInterceptor.func1\n     0.01s 0.055%  0.16%      6.64s 36.48%  github.com\/grpc-ecosystem\/go-grpc-middleware\/logging\/logrus.UnaryServerInterceptor.func1\n         0     0%  0.16%      5.75s 31.59%  github.com\/grpc-ecosystem\/go-grpc-middleware\/auth.UnaryServerInterceptor.func1\n         0     0%  0.16%      5.75s 31.59%  gitlab.com\/gitlab-org\/gitaly\/internal\/middleware\/cancelhandler.Unary\n         0     0%  0.16%      5.75s 31.59%  gitlab.com\/gitlab-org\/gitaly\/internal\/middleware\/limithandler.(*LimiterMiddleware).UnaryInterceptor.func1\n         0     0%  0.16%      5.75s 31.59%  gitlab.com\/gitlab-org\/gitaly\/internal\/middleware\/sentryhandler.UnaryLogHandler\n         0     0%  0.16%      5.64s 30.99%  github.com\/grpc-ecosystem\/go-grpc-middleware\/tracing\/opentracing.UnaryServerInterceptor.func1\n     0.02s  0.11%  0.27%      5.61s 30.82%  gitlab.com\/gitlab-org\/gitaly\/internal\/middleware\/cache.UnaryInvalidator.func1\n     0.01s 0.055%  0.33%      5.58s 30.66%  gitlab.com\/gitlab-org\/gitaly\/internal\/middleware\/panichandler.UnaryPanicHandler\n         0     0%  0.33%      4.06s 22.31%  gitlab.com\/gitlab-org\/gitaly\/proto\/go\/gitalypb._RefService_FindBranch_Handler\n         0     0%  0.33%      3.87s 21.26%  runtime.mcall\n     3.84s 21.10% 21.43%      3.84s 21.10%  runtime.futex\n     0.04s  0.22% 21.65%      3.76s 20.66%  runtime.schedule\n         0     0% 21.65%      3.55s 19.51%  gitlab.com\/gitlab-org\/gitaly\/proto\/go\/gitalypb._RefService_FindBranch_Handler.func1\n     0.02s  0.11% 21.76%      3.54s 19.45%  gitlab.com\/gitlab-org\/gitaly\/internal\/service\/ref.(*server).FindBranch\n     0.26s  1.43% 23.19%      3.42s 18.79%  runtime.findrunnable\n     0.01s 0.055% 23.24%      3.41s 18.74%  gitlab.com\/gitlab-org\/gitaly\/internal\/command.New\n         0     0% 23.24%      3.41s 18.74%  gitlab.com\/gitlab-org\/gitaly\/internal\/git.BareCommand\n     0.01s 0.055% 23.30%      3.17s 17.42%  runtime.futexsleep\n         0     0% 23.30%      2.97s 16.32%  runtime.park_m\n         0     0% 23.30%      2.34s 12.86%  gitlab.com\/gitlab-org\/gitaly\/internal\/git.Command\n         0     0% 23.30%      2.19s 12.03%  gitlab.com\/gitlab-org\/gitaly\/proto\/go\/gitalypb._CommitService_CommitIsAncestor_Handler\n```\n\n### Output of checks\n\n#### Results of GitLab environment info\n\n<details>\n<summary>Expand for output related to GitLab environment info<\/summary>\n<pre>\n\n```\nSystem information\nSystem:\t\tUbuntu 18.04\nProxy:\t\tno\nCurrent User:\tgit\nUsing RVM:\tno\nRuby Version:\t2.6.3p62\nGem Version:\t2.7.9\nBundler Version:1.17.3\nRake Version:\t12.3.2\nRedis Version:\t3.2.12\nGit Version:\t2.22.0\nSidekiq Version:5.2.7\nGo Version:\tunknown\n\nGitLab information\nVersion:\t12.3.5-ee\nRevision:\t9dbaa740018\nDirectory:\t\/opt\/gitlab\/embedded\/service\/gitlab-rails\nDB Adapter:\tPostgreSQL\nDB Version:\t10.9\nURL:\t\thttp:\/\/50k.testbed.gitlab.net\nHTTP Clone URL:\thttp:\/\/50k.testbed.gitlab.net\/some-group\/some-project.git\nSSH Clone URL:\tgit@50k.testbed.gitlab.net:some-group\/some-project.git\nElasticsearch:\tno\nGeo:\t\tno\nUsing LDAP:\tno\nUsing Omniauth:\tyes\nOmniauth Providers:\n\nGitLab Shell\nVersion:\t10.0.0\nRepository storage paths:\n- default: \t\/var\/opt\/gitlab\/git-data\/repositories\n- storage1: \t\/var\/opt\/gitlab\/git-data\/repositories\n- storage2: \t\/var\/opt\/gitlab\/git-data\/repositories\n- storage3: \t\/var\/opt\/gitlab\/git-data\/repositories\n- storage4: \t\/var\/opt\/gitlab\/git-data\/repositories\nGitLab Shell path:\t\t\/opt\/gitlab\/embedded\/service\/gitlab-shell\nGit:\t\t\/opt\/gitlab\/embedded\/bin\/git\n```\n\n<\/pre>\n<\/details>\n\n#### Results of GitLab application Check\n\n<details>\n<summary>Expand for output related to the GitLab application check<\/summary>\n<pre>\n\n```\nChecking GitLab subtasks ...\n\nChecking GitLab Shell ...\n\nGitLab Shell: ... GitLab Shell version >= 10.0.0 ? ... OK (10.0.0)\nRunning \/opt\/gitlab\/embedded\/service\/gitlab-shell\/bin\/check\nCheck GitLab API access: OK\nRedis available via internal API: OK\n\ngitlab-shell self-check successful\n\nChecking GitLab Shell ... Finished\n\nChecking Gitaly ...\n\nGitaly: ... default ... OK\nstorage1 ... OK\nstorage2 ... OK\nstorage3 ... OK\nstorage4 ... OK\n\nChecking Gitaly ... Finished\n\nChecking Sidekiq ...\n\nSidekiq: ... Running? ... no\n  Try fixing it:\n  sudo -u git -H RAILS_ENV=production bin\/background_jobs start\n  For more information see:\n  doc\/install\/installation.md in section \"Install Init Script\"\n  see log\/sidekiq.log for possible errors\n  Please fix the error above and rerun the checks.\n\nChecking Sidekiq ... Finished\n\nChecking Incoming Email ...\n\nIncoming Email: ... Reply by email is disabled in config\/gitlab.yml\n\nChecking Incoming Email ... Finished\n\nChecking LDAP ...\n\nLDAP: ... LDAP is disabled in config\/gitlab.yml\n\nChecking LDAP ... Finished\n\nChecking GitLab App ...\n\nGit configured correctly? ... yes\nDatabase config exists? ... yes\nAll migrations up? ... yes\nDatabase contains orphaned GroupMembers? ... no\nGitLab config exists? ... yes\nGitLab config up to date? ... yes\nLog directory writable? ... yes\nTmp directory writable? ... yes\nUploads directory exists? ... yes\nUploads directory has correct permissions? ... yes\nUploads directory tmp has correct permissions? ... yes\nInit script exists? ... skipped (omnibus-gitlab has no init script)\nInit script up-to-date? ... skipped (omnibus-gitlab has no init script)\nProjects have namespace: ...\n2\/1 ... yes\n2\/19 ... yes\n2\/20 ... yes\n2\/31 ... yes\n2\/33 ... yes\n21\/35 ... yes\n2\/43 ... yes\n2\/44 ... yes\n1\/45 ... yes\n1\/46 ... yes\nRedis version >= 2.8.0? ... yes\nRuby version >= 2.5.3 ? ... yes (2.6.3)\nGit version >= 2.22.0 ? ... yes (2.22.0)\nGit user has default SSH configuration? ... yes\nActive users: ... 1\nIs authorized keys file accessible? ... yes\nElasticsearch version 5.6 - 6.x? ... skipped (elasticsearch is disabled)\n\nChecking GitLab App ... Finished\n\n\nChecking GitLab subtasks ... Finished\n```\n\nNote that the Sidekiq error above is due to this being a HA environment where they run on separate nodes.\n\n<\/pre>\n<\/details>","state":"closed","created_at":1571824708902,"updated_at":1667476505368,"closed_at":1576858359857,"closed_by":{"id":4554599,"username":"m_gill","name":"Michelle Gill","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4554599\/avatar.png","web_url":"https:\/\/gitlab.com\/m_gill"},"labels":["Deliverable","Quality:performance-issues","backend","bug::performance","devops::create","group::source code","performance-refinement","priority::2","severity::3","type::bug","workflow::verification"],"milestone":{"id":891797,"iid":40,"group_id":9970,"title":"12.6","description":"https:\/\/about.gitlab.com\/releases\/2019\/12\/22\/gitlab-12-6-released","state":"closed","created_at":"2019-05-31T08:38:03.539Z","updated_at":"2020-04-27T16:27:13.329Z","due_date":"2019-12-17","start_date":"2019-11-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/40"},"assignees":[{"id":572018,"username":"nick.thomas","name":"Nick Thomas","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/572018\/avatar.png","web_url":"https:\/\/gitlab.com\/nick.thomas"}],"author":{"id":3769272,"username":"grantyoung","name":"Grant Young","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3769272\/avatar.png","web_url":"https:\/\/gitlab.com\/grantyoung"},"type":"ISSUE","assignee":{"id":572018,"username":"nick.thomas","name":"Nick Thomas","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/572018\/avatar.png","web_url":"https:\/\/gitlab.com\/nick.thomas"},"user_notes_count":49,"merge_requests_count":0,"upvotes":2,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2108","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2108","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2108\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2108\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2108","relative":"#2108","full":"gitlab-org\/gitaly#2108"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":26167524,"iid":2106,"project_id":2009901,"title":"Remove repository field inside of ConflictFileHeader","description":"In https:\/\/gitlab.com\/gitlab-org\/gitlab\/merge_requests\/18692, we changed the client behavior to use the repository being passed into the request rather than wait for the very same repository object to get attached to the response. \n\nOnce that is merged, in 12.6 we can remove the `repository` field in `ConflictFileHeader` completely.","state":"closed","created_at":1571677168196,"updated_at":1575314792407,"closed_at":1575314792350,"closed_by":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"},"labels":["Category:Gitaly","devops::create","group::gitaly","workflow::in dev"],"milestone":{"id":891797,"iid":40,"group_id":9970,"title":"12.6","description":"https:\/\/about.gitlab.com\/releases\/2019\/12\/22\/gitlab-12-6-released","state":"closed","created_at":"2019-05-31T08:38:03.539Z","updated_at":"2020-04-27T16:27:13.329Z","due_date":"2019-12-17","start_date":"2019-11-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/40"},"assignees":[{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"}],"author":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"},"type":"ISSUE","assignee":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2106","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2106","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2106\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2106\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2106","relative":"#2106","full":"gitlab-org\/gitaly#2106"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":25228249,"iid":2026,"project_id":2009901,"title":"Praefect as pass through proxy by default in the GDK","description":"Currently one could run Praefect in the GDK, after running `rake praefect:enable`. Given we're confident that praefect works, especially if there's only one Gitaly storage node, the daemon should be enabled by default.\n\nThe thing to consider is that users don't like to reseed their GDK, as it takes long. So the changes should have good forward compatibility.","state":"closed","created_at":1569315645647,"updated_at":1572549573616,"closed_at":1572549573547,"closed_by":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"labels":["Category:Gitaly","Deliverable","devops::create","group::gitaly","type::feature","workflow::in review"],"milestone":{"id":891796,"iid":39,"group_id":9970,"title":"12.5","description":"https:\/\/about.gitlab.com\/releases\/2019\/11\/22\/gitlab-12-5-released","state":"closed","created_at":"2019-05-31T08:38:03.087Z","updated_at":"2020-04-27T16:27:03.474Z","due_date":"2019-11-17","start_date":"2019-10-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/39"},"assignees":[{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"type":"ISSUE","assignee":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2026","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2026","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2026\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2026\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2026","relative":"#2026","full":"gitlab-org\/gitaly#2026"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1877.0,"epic":{"id":11992,"iid":1877,"title":"\ud83c\udfdd HA Gitaly: minimal reverse proxy","url":"\/groups\/gitlab-org\/-\/epics\/1877","group_id":9970,"human_readable_end_date":"Nov 17, 2019","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":24662617,"iid":1924,"project_id":2009901,"title":"Pass through FindRemoteRepository in Praefect to any gitaly node","description":"We can proxy it to any of the praefect gitaly nodes since this RPC call is not dependent on a repository.","state":"closed","created_at":1568153086914,"updated_at":1569953469852,"closed_at":1569953469671,"closed_by":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"},"labels":["Deliverable","[deprecated] Accepting merge requests","devops::create","group::gitaly","group::gitaly::cluster","workflow::ready for development"],"milestone":{"id":731039,"iid":38,"group_id":9970,"title":"12.4","description":"https:\/\/about.gitlab.com\/releases\/2019\/10\/22\/gitlab-12-4-released","state":"closed","created_at":"2018-12-07T12:41:53.212Z","updated_at":"2020-04-27T16:30:43.889Z","due_date":"2019-10-17","start_date":"2019-09-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/38"},"assignees":[{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"}],"author":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"},"type":"ISSUE","assignee":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"},"user_notes_count":6,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/1924","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1924","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1924\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1924\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#1924","relative":"#1924","full":"gitlab-org\/gitaly#1924"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1877.0,"epic":{"id":11992,"iid":1877,"title":"\ud83c\udfdd HA Gitaly: minimal reverse proxy","url":"\/groups\/gitlab-org\/-\/epics\/1877","group_id":9970,"human_readable_end_date":"Nov 17, 2019","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":24637979,"iid":1921,"project_id":2009901,"title":"Remove get-commit-signatures feature flag","description":"`GetCommitSignatures` has been rewritten using Go in https:\/\/gitlab.com\/gitlab-org\/gitaly\/issues\/1604. The new RPC is under a feature flag and already [enabled in gitlab.com](https:\/\/gitlab.com\/gitlab-org\/gitaly\/issues\/1907). The feature flag can now be removed from both gitaly and gitlab-ce.  \n\n#### TODO \n\n- [ ] Remove the feature flag from go first: https:\/\/gitlab.com\/gitlab-org\/gitaly\/merge_requests\/1484\n- [ ] Remove feature flag from gitlab-ce: https:\/\/gitlab.com\/gitlab-org\/gitlab\/merge_requests\/16550","state":"closed","created_at":1568119081716,"updated_at":1568398852903,"closed_at":1568398852807,"closed_by":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"},"labels":["Gitaly","Gitaly-Ruby","backstage [DEPRECATED]","devops::create","feature flag","group::gitaly"],"milestone":{"id":731038,"iid":37,"group_id":9970,"title":"12.3","description":"https:\/\/about.gitlab.com\/releases\/2019\/09\/22\/gitlab-12-3-released\/","state":"closed","created_at":"2018-12-07T12:40:55.400Z","updated_at":"2020-04-23T21:06:04.173Z","due_date":"2019-09-17","start_date":"2019-08-08","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/37"},"assignees":[{"id":426128,"username":"felipe_artur","name":"Felipe Artur","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/dbad92659914f56621cbdd726e283e60?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/felipe_artur"}],"author":{"id":426128,"username":"felipe_artur","name":"Felipe Artur","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/dbad92659914f56621cbdd726e283e60?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/felipe_artur"},"type":"ISSUE","assignee":{"id":426128,"username":"felipe_artur","name":"Felipe Artur","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/dbad92659914f56621cbdd726e283e60?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/felipe_artur"},"user_notes_count":2,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/1921","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":2,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1921","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1921\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1921\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#1921","relative":"#1921","full":"gitlab-org\/gitaly#1921"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":null},{"id":24637373,"iid":1920,"project_id":2009901,"title":"Remove ruby implementation for GetCommitSignatures RPC","description":"GetCommitSignatures RPC has been rewritten using Go in https:\/\/gitlab.com\/gitlab-org\/gitaly\/issues\/1604. [The old RPC that uses ruby can be removed](https:\/\/gitlab.com\/gitlab-org\/gitaly\/blob\/master\/internal\/service\/commit\/commit_signatures.go#L37).  \n\nMethod signature:  \n\n``` go\nfunc rubyGetCommitSignatures(s *server, request *gitalypb.GetCommitSignaturesRequest, stream gitalypb.CommitService_GetCommitSignaturesServer) error {\n```  \n\n## TODO\n\n- [ ] Remove `rubyGetCommitSignatures` go function\n- [ ] Fix broken specs\n- [ ] if possible remove all ruby code related to`GitalyServer::CommitService#get_commit_signatures`","state":"closed","created_at":1568117930144,"updated_at":1568925954299,"closed_at":1568925954245,"closed_by":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"},"labels":["Gitaly","Gitaly-Ruby","[deprecated] Accepting merge requests","backstage [DEPRECATED]","devops::create","group::gitaly","workflow::ready for development"],"milestone":{"id":731039,"iid":38,"group_id":9970,"title":"12.4","description":"https:\/\/about.gitlab.com\/releases\/2019\/10\/22\/gitlab-12-4-released","state":"closed","created_at":"2018-12-07T12:41:53.212Z","updated_at":"2020-04-27T16:30:43.889Z","due_date":"2019-10-17","start_date":"2019-09-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/38"},"assignees":[{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"}],"author":{"id":426128,"username":"felipe_artur","name":"Felipe Artur","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/dbad92659914f56621cbdd726e283e60?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/felipe_artur"},"type":"ISSUE","assignee":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"user_notes_count":0,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/1920","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":3,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1920","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1920\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1920\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#1920","relative":"#1920","full":"gitlab-org\/gitaly#1920"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":null},{"id":24395322,"iid":1907,"project_id":2009901,"title":"Roll out get_commit_signatures feature flag","description":"<!-- Title suggestion: [Feature flag] Enable description of feature -->\n\n## What\n\nRemove the `get_commit_signatures` feature flag\n\n## Owners\n\n- Team: Gitaly\n- Most appropriate slack channel to reach out to: `#g_gitaly`\n- Best individual to reach out to: @felipe_artur \n\n## Expectations\n\nCommit signatures request should use use go version of the RPC  \nwhich is expected to be more performant.\n\n### What release does this feature occur in first?\n\n12.3\n\n### What are we expecting to happen?\n\nBetter performance of the RPC\n\n### What might happen if this goes wrong?\n\nWorst case scenario: Stop showing if commit signatures are verified  \nbecause of some exception.  \n\nWe may not see commits page broken because that RPC is made async.\n\n### What can we monitor to detect problems with this?\n\n* https:\/\/dashboards.gitlab.net\/d\/000000199\/gitaly-feature-status?from=now-12h&to=now&orgId=1&var-method=GetCommitSignatures&var-job=gitaly&refresh=5m  \n\n* https:\/\/sentry.gitlab.net\/gitlab\/gitaly-production\/\n\n* https:\/\/sentry.gitlab.net\/gitlab\/gitaly-production\/?query=GetCommitSignatures\n\n## Beta groups\/projects\n\nIf applicable, any groups\/projects that are happy to have this feature turned on early. Some organizations may wish to test big changes they are interested in with a small subset of users ahead of time for example.\n\n- `gitlab-org\/gitlab-ce`\/`gitlab-org\/gitaly` projects\n- `gitlab-org`\/`gitlab-com` groups\n- ...\n\n## Roll Out Steps\n\n- [x] [Read the documentation of feature flags](https:\/\/docs.gitlab.com\/ee\/development\/rolling_out_changes_using_feature_flags.html)\n- [x] Enable on staging\n- [x] Test on staging\n- [x] Ensure that documentation has been updated\n- [x] Enable on GitLab.com for individual groups\/projects listed above and verify behaviour\n- [x] Announce on the issue an estimated time this will be enabled on GitLab.com\n- [x] Enable on GitLab.com by running chatops command in `#production`\n- [ ] Cross post chatops slack command to `#support_gitlab-com` and in your team channel\n- [x] Announce on the issue that the flag has been enabled\n- [x] Remove feature flag and add changelog entry","state":"closed","created_at":1567445370955,"updated_at":1568645535379,"closed_at":1568639648113,"closed_by":{"id":426128,"username":"felipe_artur","name":"Felipe Artur","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/dbad92659914f56621cbdd726e283e60?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/felipe_artur"},"labels":["Gitaly","backstage [DEPRECATED]","devops::create","feature flag","group::gitaly","workflow::verification"],"milestone":{"id":731038,"iid":37,"group_id":9970,"title":"12.3","description":"https:\/\/about.gitlab.com\/releases\/2019\/09\/22\/gitlab-12-3-released\/","state":"closed","created_at":"2018-12-07T12:40:55.400Z","updated_at":"2020-04-23T21:06:04.173Z","due_date":"2019-09-17","start_date":"2019-08-08","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/37"},"assignees":[{"id":426128,"username":"felipe_artur","name":"Felipe Artur","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/dbad92659914f56621cbdd726e283e60?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/felipe_artur"}],"author":{"id":426128,"username":"felipe_artur","name":"Felipe Artur","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/dbad92659914f56621cbdd726e283e60?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/felipe_artur"},"type":"ISSUE","assignee":{"id":426128,"username":"felipe_artur","name":"Felipe Artur","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/dbad92659914f56621cbdd726e283e60?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/felipe_artur"},"user_notes_count":13,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/1907","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":10,"completed_count":9},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1907","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1907\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1907\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#1907","relative":"#1907","full":"gitlab-org\/gitaly#1907"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":null},{"id":24173138,"iid":1891,"project_id":2009901,"title":"Remove `ensure_storage_path_exists` from gitlab-ce","description":"as discussed in https:\/\/gitlab.com\/gitlab-org\/gitaly\/issues\/1807#note_208197834, the first step to deprecating the Namespace service is to get rid of `ensure_storage_path_exists` calls\n\nThere are two parts to this issue:\n\n- Modify RenameNamespace to create the parent directory of the destination dir\n- Remove calls to `ensure_storage_path_exists` calls in gitlab-ce","state":"closed","created_at":1566837460687,"updated_at":1571229527065,"closed_at":1571044364194,"closed_by":{"id":128633,"username":"rymai","name":"R\u00e9my Coutable","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/263da227929cc0035cb0eba512bcf81a?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/rymai"},"labels":["Deliverable","backstage [DEPRECATED]","devops::create","group::gitaly","group::gitaly::cluster","workflow::in review"],"milestone":{"id":731039,"iid":38,"group_id":9970,"title":"12.4","description":"https:\/\/about.gitlab.com\/releases\/2019\/10\/22\/gitlab-12-4-released","state":"closed","created_at":"2018-12-07T12:41:53.212Z","updated_at":"2020-04-27T16:30:43.889Z","due_date":"2019-10-17","start_date":"2019-09-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/38"},"assignees":[{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"}],"author":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"},"type":"ISSUE","assignee":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"},"user_notes_count":3,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/1891","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1891","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1891\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1891\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#1891","relative":"#1891","full":"gitlab-org\/gitaly#1891"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1877.0,"epic":{"id":11992,"iid":1877,"title":"\ud83c\udfdd HA Gitaly: minimal reverse proxy","url":"\/groups\/gitlab-org\/-\/epics\/1877","group_id":9970,"human_readable_end_date":"Nov 17, 2019","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":23984510,"iid":1875,"project_id":2009901,"title":"Remove deprecated message handling code","description":"The following discussion from !1410 should be addressed:\n\n- [ ] @zj-gitlab started a [discussion](https:\/\/gitlab.com\/gitlab-org\/gitaly\/merge_requests\/1410#note_205645542): \n\n    > Post merge I'll create an issue to remove this code in %\"12.4\"\n\nRemove in %\"12.4\", because gitlab-ce\/gitlab-ee must be using the new `:messages` param (https:\/\/gitlab.com\/gitlab-org\/gitlab-ce\/merge_requests\/31640 is currently targeting %\"12.3\").","state":"closed","created_at":1566329893416,"updated_at":1569222780883,"closed_at":1569222780832,"closed_by":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"labels":["auto updated","backstage [DEPRECATED]","devops::create","group::gitaly"],"milestone":{"id":731039,"iid":38,"group_id":9970,"title":"12.4","description":"https:\/\/about.gitlab.com\/releases\/2019\/10\/22\/gitlab-12-4-released","state":"closed","created_at":"2018-12-07T12:41:53.212Z","updated_at":"2020-04-27T16:30:43.889Z","due_date":"2019-10-17","start_date":"2019-09-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/38"},"assignees":[{"id":1144264,"username":"mkozono","name":"Michael Kozono","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/6243abba3cf112e6df4a5a644c5f86aa?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/mkozono"}],"author":{"id":1144264,"username":"mkozono","name":"Michael Kozono","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/6243abba3cf112e6df4a5a644c5f86aa?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/mkozono"},"type":"ISSUE","assignee":{"id":1144264,"username":"mkozono","name":"Michael Kozono","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/6243abba3cf112e6df4a5a644c5f86aa?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/mkozono"},"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/1875","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":1,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1875","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1875\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1875\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#1875","relative":"#1875","full":"gitlab-org\/gitaly#1875"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":null},{"id":23159924,"iid":1808,"project_id":2009901,"title":"Deprecate ListDirectories RPC","description":"This RPC is only used in cleanup rake tasks, as far as I can tell. E.g. https:\/\/gitlab.com\/gitlab-org\/gitlab-ce\/blob\/master\/lib\/tasks\/gitlab\/cleanup.rake#L7\n\nThis is problematic for Gitaly HA because we there will be directories on multiple different Gitaly servers and we don't want to directly expose those Gitaly servers.\n\nWe should take a look at the things that use ListDirectories, and reimplement whatever it is they do inside Gitaly. In some cases it might be automated cleanup; in other cases we might need a new RPC. In the latter case that RPC should express what we want to happen, and leave the actual work to Gitaly.","state":"closed","created_at":1564062405607,"updated_at":1573662343720,"closed_at":1573201763819,"closed_by":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"labels":["Deliverable","auto updated","backstage [DEPRECATED]","devops::create","group::gitaly","group::gitaly::cluster","workflow::in review"],"milestone":{"id":891796,"iid":39,"group_id":9970,"title":"12.5","description":"https:\/\/about.gitlab.com\/releases\/2019\/11\/22\/gitlab-12-5-released","state":"closed","created_at":"2019-05-31T08:38:03.087Z","updated_at":"2020-04-27T16:27:03.474Z","due_date":"2019-11-17","start_date":"2019-10-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/39"},"assignees":[{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"}],"author":{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/513969\/avatar.png","web_url":"https:\/\/gitlab.com\/jacobvosmaer-gitlab"},"type":"ISSUE","assignee":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"},"user_notes_count":9,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/1808","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1808","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1808\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1808\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#1808","relative":"#1808","full":"gitlab-org\/gitaly#1808"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1877.0,"epic":{"id":11992,"iid":1877,"title":"\ud83c\udfdd HA Gitaly: minimal reverse proxy","url":"\/groups\/gitlab-org\/-\/epics\/1877","group_id":9970,"human_readable_end_date":"Nov 17, 2019","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":21848253,"iid":1728,"project_id":2009901,"title":"remote: warning: ignoring extra bitmap file when pulling from a deduplicated repo","description":"Seen today on the gitlab-org\/gitlab-pages repository:\n\n```\n$ git fetch upstream master\nremote: warning: ignoring extra bitmap file: \/var\/opt\/gitlab\/git-data\/repositories\/@pools\/81\/17\/811786ad1ae74adfdd20dd0372abaaebc6246e343aebd01da0bfc4c02bf0106c.git\/objects\/pack\/pack-1d59d5e04b0538cfc7fb23125f81c317aafd0b10.pack\n```\n\nI think we try to avoid displaying server-side paths to the client in other cases. Other than that, it didn't seem to affect anything - the fetch succeeded and had all the objects I expected.","state":"closed","created_at":1560357371114,"updated_at":1611744487766,"closed_at":1589800419442,"closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"labels":["Category:Gitaly","SLO::Missed","devops::create","git object deduplication","group::gitaly","missed-deliverable","missed:12.1","missed:12.5","missed:12.6","missed:12.7","priority::2","severity::4","type::bug","workflow::in review"],"milestone":{"id":991112,"iid":42,"group_id":9970,"title":"13.0","description":"","state":"closed","created_at":"2019-09-04T15:20:39.024Z","updated_at":"2020-10-08T12:00:55.725Z","due_date":"2020-05-17","start_date":"2020-04-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/42"},"assignees":[{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"}],"author":{"id":572018,"username":"nick.thomas","name":"Nick Thomas","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/572018\/avatar.png","web_url":"https:\/\/gitlab.com\/nick.thomas"},"type":"ISSUE","assignee":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"user_notes_count":41,"merge_requests_count":1,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/1728","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1728","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1728\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1728\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#1728","relative":"#1728","full":"gitlab-org\/gitaly#1728"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":189.0,"epic":{"id":385,"iid":189,"title":"Create forks of public projects with deduplicated Git objects","url":"\/groups\/gitlab-org\/-\/epics\/189","group_id":9970,"human_readable_end_date":"May 17, 2020","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":21331132,"iid":1690,"project_id":2009901,"title":"Remove Rugged patches from gitlab","description":"We have been forced to walk back part of the Gitaly migration project because it turned out that in certain scenarios, the old gitlab-ce code that used Rugged is still significantly more performant than the new Gitaly code. Specifically, this is the case for some GitLab installations that host their Git repository data on slow NFS servers.\n\nThe code in question can be found here: https:\/\/gitlab.com\/gitlab-org\/gitlab-ce\/tree\/master\/lib\/gitlab\/git\/rugged_impl\n\nThis is blocking us from completing the Gitaly migration project. These rugged patches should be removed again. This issue is meant to track their removal.\n\n## Current Plan of Record for 14.3 and beyond\n\n_Summary of the discussion in the below thread_\n\nWe don't believe that the Rugged patches are necessary for our customers utilizing NFS as we believe that [performance issues necessitating these patches are mitigated](https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/1690#note_584475955).\n\nAs the Rugged patches create an additional maintenance concern for the Gitaly team, as well as not supporting the direction of moving customers requiring HA towards Gitaly Cluster. We therefore feel that they should be removed.\n\nStarting in %\"14.3\", we will default to disabling the Rugged patches. As stated above, we don't believe that this will cause any performance issues for our users.\n\n### Mitigations pending customer issues\n\n- The Rugged patches are currently behind a feature flag. Starting in %\"14.3\" we will be defaulting this feature flag to disable Rugged, but we will not be removing the feature flag. If customers notice performance degradation, they can re-enable the Rugged patches via the feature flag. \n\n- Pending significant customer performance issues, the current plan is to remove the Rugged patches a couple of releases past %\"14.3\"  and the associated feature flag.","state":"closed","created_at":1558959583930,"updated_at":1680185566704,"closed_at":1680185566419,"closed_by":{"id":4586870,"username":"mjwood","name":"Mark Wood","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/4376afce32152d684a9563d594dbb257?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/mjwood"},"labels":["Category:Gitaly","[deprecated] Accepting merge requests","customer","devops::systems","group::gitaly","section::dev","type::feature"],"milestone":{"id":490705,"iid":14,"group_id":9970,"title":"Backlog","description":"Issues that we want to do but are not planned right now. Open for contribution from the community.","state":"active","created_at":"2018-03-22T13:09:23.767Z","updated_at":"2018-10-30T14:56:54.069Z","due_date":null,"start_date":null,"expired":false,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/14"},"assignees":[],"author":{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/513969\/avatar.png","web_url":"https:\/\/gitlab.com\/jacobvosmaer-gitlab"},"type":"ISSUE","assignee":null,"user_notes_count":87,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/1690","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1690","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1690\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1690\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#1690","relative":"#1690","full":"gitlab-org\/gitaly#1690"},"severity":"UNKNOWN","moved_to_id":126003579.0,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":27219683,"iid":2180,"project_id":2009901,"title":"GetCommitSignatures' messages can be too large","description":"https:\/\/sentry.gitlab.net\/gitlab\/gitlabcom\/issues\/736414\/\n\n```\nGRPC::ResourceExhausted: 8:Received message larger than max (6302368 vs. 4194304)\n  grpc\/generic\/active_call.rb:31:in `check_status'\n    fail GRPC::BadStatus.new_status_exception(\n  grpc\/generic\/active_call.rb:181:in `attach_status_results_and_complete_call'\n    recv_status_batch_result.check_status\n  grpc\/generic\/active_call.rb:170:in `receive_and_check_status'\n    attach_status_results_and_complete_call(batch_result)\n  grpc\/generic\/active_call.rb:338:in `each_remote_read_then_finish'\n    receive_and_check_status\n  gitlab\/gitaly_client\/commit_service.rb:440:in `each'\n    response.flat_map do |message|\n...\n(158 additional frame(s) were not displayed)\n\nGitlab::Git::CommandError: 8:Received message larger than max (6302368 vs. 4194304)\n  gitlab\/git\/wraps_gitaly_errors.rb:13:in `rescue in wrapped_gitaly_errors'\n    raise Gitlab::Git::CommandError.new(e)\n  gitlab\/git\/wraps_gitaly_errors.rb:6:in `wrapped_gitaly_errors'\n    def wrapped_gitaly_errors(&block)\n  gitlab\/metrics\/instrumentation.rb:161:in `block in wrapped_gitaly_errors'\n    .measure { super }\n  gitlab\/metrics\/method_call.rb:36:in `measure'\n    retval = yield\n  gitlab\/metrics\/instrumentation.rb:161:in `wrapped_gitaly_errors'\n    .measure { super }\n...\n(150 additional frame(s) were not displayed)\n\nGitlab::Git::CommandError: 8:Received message larger than max (6302368 vs. 4194304)\n```","state":"closed","created_at":1557139327284,"updated_at":1587593376313,"closed_at":1587592337806,"closed_by":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"},"labels":["Category:Gitaly","SLO::Missed","customer","devops::create","group::gitaly","priority::2","severity::3","type::bug","workflow::ready for development"],"milestone":{"id":991112,"iid":42,"group_id":9970,"title":"13.0","description":"","state":"closed","created_at":"2019-09-04T15:20:39.024Z","updated_at":"2020-10-08T12:00:55.725Z","due_date":"2020-05-17","start_date":"2020-04-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/42"},"assignees":[{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"}],"author":{"id":402401,"username":"jobbot","name":"Bot","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/aaa6738f1ebf25404010884af511b0e7?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/jobbot"},"type":"ISSUE","assignee":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"},"user_notes_count":11,"merge_requests_count":0,"upvotes":2,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2180","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2180","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2180\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2180\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2180","relative":"#2180","full":"gitlab-org\/gitaly#2180"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":20590064,"iid":1649,"project_id":2009901,"title":"Fail to start if the pid file is empty","description":"``gitaly`` cannot start if the pid file is empty.\n\nFirst found [here](https:\/\/forum.gitlab.com\/t\/gitaly-fail-14-connect-failed\/26137).\n\nI cannot figure out how the pid file becomes empty, but probably we can handle this situation?","state":"closed","created_at":1557045423357,"updated_at":1590419627831,"closed_at":1590419393051,"closed_by":{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/5522960\/avatar.png","web_url":"https:\/\/gitlab.com\/samihiltunen"},"labels":["Category:Gitaly","customer","devops::create","group::gitaly","severity::2","type::bug"],"milestone":{"id":1112145,"iid":47,"group_id":9970,"title":"13.1","description":"","state":"closed","created_at":"2020-01-03T12:28:30.160Z","updated_at":"2020-10-08T12:01:07.361Z","due_date":"2020-06-17","start_date":"2020-05-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/47"},"assignees":[{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/5522960\/avatar.png","web_url":"https:\/\/gitlab.com\/samihiltunen"}],"author":{"id":922506,"username":"XiaofengWang","name":"Xiaofeng Wang","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/69be270b80d0602ea4fd7eafc744d9e8?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/XiaofengWang"},"type":"ISSUE","assignee":{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/5522960\/avatar.png","web_url":"https:\/\/gitlab.com\/samihiltunen"},"user_notes_count":9,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/1649","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1649","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1649\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1649\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#1649","relative":"#1649","full":"gitlab-org\/gitaly#1649"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":17980204,"iid":1480,"project_id":2009901,"title":"CalculateChecksum: invalid memory address or nil pointer","description":"Seen 553 instances of this in 4 hours of customer's Gitaly logs (ZenDesk: https:\/\/gitlab.zendesk.com\/agent\/tickets\/111902):\n\n```\n2019-02-04_22:21:04.33575 time=\"2019-02-04T22:21:04Z\" level=error msg=\"grpc panic\" error=\"runtime error: invalid memory address or nil pointer dereference\" method=\/gitaly.RepositoryService\/CalculateChecksum\n```\n\nThey are running GitLab 11.5.4.\n\nUnfortunately I don't see a backtrace, but I think we need to fix this ASAP.\n\n\/cc: @dbalexandre","state":"closed","created_at":1549383264155,"updated_at":1576597859898,"closed_at":1549563290586,"closed_by":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"},"labels":["Category:Geo Replication","customer","devops::systems","group::geo","type::bug","workflow::in review"],"milestone":{"id":581391,"iid":23,"group_id":9970,"title":"11.8","description":"","state":"closed","created_at":"2018-06-26T15:15:18.359Z","updated_at":"2019-03-08T17:33:19.162Z","due_date":"2019-02-22","start_date":"2019-01-08","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/23"},"assignees":[{"id":283999,"username":"dbalexandre","name":"Douglas Barbosa Alexandre","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/283999\/avatar.png","web_url":"https:\/\/gitlab.com\/dbalexandre"}],"author":{"id":64248,"username":"stanhu","name":"Stan Hu","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/64248\/stanhu.jpg","web_url":"https:\/\/gitlab.com\/stanhu"},"type":"ISSUE","assignee":{"id":283999,"username":"dbalexandre","name":"Douglas Barbosa Alexandre","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/283999\/avatar.png","web_url":"https:\/\/gitlab.com\/dbalexandre"},"user_notes_count":4,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/1480","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1480","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1480\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1480\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#1480","relative":"#1480","full":"gitlab-org\/gitaly#1480"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":16771769,"iid":1439,"project_id":2009901,"title":"Deleting tag fails when branch and tag exists with the same name","description":"While testing https:\/\/gitlab.com\/gitlab-org\/gitaly\/merge_requests\/1006, I have a test that attempts to delete the tag `v1.1.0`, but this fails because https:\/\/gitlab.com\/gitlab-org\/gitlab-test has both `refs\/heads\/v1.1.0` and `refs\/tags\/v1.1.0`:\n\n```\ntime=\"2018-12-18T11:21:15-08:00\" level=info msg=\"I, [2018-12-18T11:21:15.603634 #38932]  INFO -- : Pushing deleted branches from \/Users\/stanhu\/gitlab\/gitaly\/internal\/testhelper\/testdata\/data\/TestSuccessfulUpdateRemoteMirrorRequestWithWildcards066627066 to remote remote_mirror_2: [\\\"v1.1.0\\\"]\" supervisor.args=\"[bundle exec bin\/ruby-cd \/Users\/stanhu\/gitlab\/gitaly\/_build\/src\/gitlab.com\/gitlab-org\/gitaly\/internal\/service\/remote \/Users\/stanhu\/gitlab\/gitaly\/_build\/src\/gitlab.com\/gitlab-org\/gitaly\/ruby\/bin\/gitaly-ruby 38900 \/var\/folders\/jf\/z0tr5kvs589dk92xkzkk49wc0000gn\/T\/gitaly-ruby944237139\/socket.1]\" supervisor.name=gitaly-ruby.1\n--- FAIL: TestSuccessfulUpdateRemoteMirrorRequestWithWildcards (1.17s)\n    test_hook.go:39: time=\"2018-12-18T11:21:15-08:00\" level=error msg=\"finished streaming call with code Unknown\" error=\"rpc error: code = Unknown desc = Gitlab::Git::CommandError: warning: refname '1942eed5cc108b19c7405106e81fa96125d0be22' is ambiguous.\\nGit normally never creates a ref that ends with 40 hex characters\\nbecause it will be ignored when you just specify 40-hex. These refs\\nmay be created by mistake. For example,\\n\\n  git checkout -b $br $(git rev-parse ...)\\n\\nwhere \\\"$br\\\" is somehow empty and a 40-hex ref is created. Please\\nexamine these refs and maybe delete them. Turn this message off by\\nrunning \\\"git config advice.objectNameWarning false\\\"\\nTo \/Users\/stanhu\/gitlab\/gitaly\/internal\/testhelper\/testdata\/data\/TestSuccessfulUpdateRemoteMirrorRequestWithWildcards080387857\\n * [new branch]      11-0-stable -> 11-0-stable\\n * [new branch]      11-1-stable -> 11-1-stable\\nwarning: refname '1942eed5cc108b19c7405106e81fa96125d0be22' is ambiguous.\\nGit normally never creates a ref that ends with 40 hex characters\\nbecause it will be ignored when you just specify 40-hex. These refs\\nmay be created by mistake. For example,\\n\\n  git checkout -b $br $(git rev-parse ...)\\n\\nwhere \\\"$br\\\" is somehow empty and a 40-hex ref is created. Please\\nexamine these refs and maybe delete them. Turn this message off by\\nrunning \\\"git config advice.objectNameWarning false\\\"\\nTo \/Users\/stanhu\/gitlab\/gitaly\/internal\/testhelper\/testdata\/data\/TestSuccessfulUpdateRemoteMirrorRequestWithWildcards080387857\\n + f4e6814...33fde33 v1.0.0 -> v1.0.0 (forced update)\\n * [new tag]         new-tag -> new-tag\\nerror: dst refspec v1.1.0 matches more than one.\\nerror: failed to push some refs to '\/Users\/stanhu\/gitlab\/gitaly\/internal\/testhelper\/testdata\/data\/TestSuccessfulUpdateRemoteMirrorRequestWithWildcards080387857'\\n\" grpc.code=Unknown grpc.method=UpdateRemoteMirror grpc.service=gitaly.RemoteService grpc.start_time=\"2018-12-18T11:21:15-08:00\" grpc.time_ms=425.41 span.kind=server system=grpc test=TestSuccessfulUpdateRemoteMirrorRequestWithWildcards\n\n    require.go:794:\n                Error Trace:    update_remote_mirror_test.go:138\n                Error:          Received unexpected error:\n                                rpc error: code = Unknown desc = Gitlab::Git::CommandError: warning: refname '1942eed5cc108b19c7405106e81fa96125d0be22' is ambiguous.\n                                Git normally never creates a ref that ends with 40 hex characters\n                                because it will be ignored when you just specify 40-hex. These refs\n                                may be created by mistake. For example,\n\n                                  git checkout -b $br $(git rev-parse ...)\n\n```\n\nThis is similar to https:\/\/gitlab.com\/gitlab-org\/gitaly\/issues\/1329.","state":"closed","created_at":1545161514299,"updated_at":1589785714882,"closed_at":1587552784418,"closed_by":{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/513969\/avatar.png","web_url":"https:\/\/gitlab.com\/jacobvosmaer-gitlab"},"labels":["Category:Gitaly","Deliverable","devops::create","group::gitaly","missed-deliverable","missed:12.10","priority::3","type::bug","workflow::in review"],"milestone":{"id":991112,"iid":42,"group_id":9970,"title":"13.0","description":"","state":"closed","created_at":"2019-09-04T15:20:39.024Z","updated_at":"2020-10-08T12:00:55.725Z","due_date":"2020-05-17","start_date":"2020-04-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/42"},"assignees":[{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/5522960\/avatar.png","web_url":"https:\/\/gitlab.com\/samihiltunen"}],"author":{"id":64248,"username":"stanhu","name":"Stan Hu","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/64248\/stanhu.jpg","web_url":"https:\/\/gitlab.com\/stanhu"},"type":"ISSUE","assignee":{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/5522960\/avatar.png","web_url":"https:\/\/gitlab.com\/samihiltunen"},"user_notes_count":6,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/1439","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1439","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1439\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1439\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#1439","relative":"#1439","full":"gitlab-org\/gitaly#1439"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":16750530,"iid":1437,"project_id":2009901,"title":"Remove Gitlab::GitLogger","description":"The Gitlab::GitLogger logs just one error, which is returned to the client too. I think in that case that should be enough because of the interceptors we use.\n\n\/cc @johncai @jacobvosmaer\\-gitlab","state":"closed","created_at":1545130131560,"updated_at":1552398516911,"closed_at":1552398516882,"closed_by":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"labels":["maintenance::refactor"],"milestone":null,"assignees":[{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"type":"ISSUE","assignee":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/1437","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1437","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1437\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1437\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#1437","relative":"#1437","full":"gitlab-org\/gitaly#1437"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":16732142,"iid":1436,"project_id":2009901,"title":"Snapshots don't work with dedup","description":"Gitaly's snapshots won't work for repositories that use object pool as we ignore `objects\/info\/alternates`. Theoretically, it's possible to include objects from an object pool to the TAR archive.\n\nSee https:\/\/gitlab.com\/gitlab-org\/gitaly\/issues\/1410 for details","state":"closed","created_at":1545079812912,"updated_at":1576597859809,"closed_at":1550608079463,"closed_by":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"},"labels":["devops::create","forking","group::gitaly","priority::3","regression","severity::3","type::bug"],"milestone":{"id":523180,"iid":18,"group_id":9970,"title":"11.9","description":"https:\/\/about.gitlab.com\/releases\/2019\/03\/22\/gitlab-11-9-released\/","state":"closed","created_at":"2018-05-09T14:56:19.024Z","updated_at":"2020-04-30T19:56:35.917Z","due_date":"2019-03-22","start_date":"2019-02-08","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/18"},"assignees":[{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"}],"author":{"id":59678,"username":"vsizov","name":"Valery Sizov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/59678\/avatar.png","web_url":"https:\/\/gitlab.com\/vsizov"},"type":"ISSUE","assignee":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"},"user_notes_count":14,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/1436","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1436","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1436\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1436\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#1436","relative":"#1436","full":"gitlab-org\/gitaly#1436"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":189.0,"epic":{"id":385,"iid":189,"title":"Create forks of public projects with deduplicated Git objects","url":"\/groups\/gitlab-org\/-\/epics\/189","group_id":9970,"human_readable_end_date":"May 17, 2020","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":16209276,"iid":1410,"project_id":2009901,"title":"Support Geo for dedupped repositories","description":"Geo needs to perform the same operation on the secondairies. Not sure what is required from the Gitaly team, so please consider this a tracking issue.","state":"closed","created_at":1543486507787,"updated_at":1576496809568,"closed_at":1546939058097,"closed_by":{"id":59678,"username":"vsizov","name":"Valery Sizov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/59678\/avatar.png","web_url":"https:\/\/gitlab.com\/vsizov"},"labels":["Deliverable","devops::create","forking","group::gitaly","product discovery [DEPRECATED]","workflow::in review"],"milestone":{"id":581385,"iid":22,"group_id":9970,"title":"11.7","description":"","state":"closed","created_at":"2018-06-26T15:14:47.054Z","updated_at":"2019-02-07T18:12:10.925Z","due_date":"2019-01-22","start_date":"2018-12-08","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/22"},"assignees":[{"id":59678,"username":"vsizov","name":"Valery Sizov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/59678\/avatar.png","web_url":"https:\/\/gitlab.com\/vsizov"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"type":"ISSUE","assignee":{"id":59678,"username":"vsizov","name":"Valery Sizov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/59678\/avatar.png","web_url":"https:\/\/gitlab.com\/vsizov"},"user_notes_count":43,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/1410","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":13,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1410","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1410\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1410\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#1410","relative":"#1410","full":"gitlab-org\/gitaly#1410"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":189.0,"epic":{"id":385,"iid":189,"title":"Create forks of public projects with deduplicated Git objects","url":"\/groups\/gitlab-org\/-\/epics\/189","group_id":9970,"human_readable_end_date":"May 17, 2020","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":15695396,"iid":1392,"project_id":2009901,"title":"Stop symlinking the hooks directory","description":"Part of: https:\/\/gitlab.com\/gitlab-org\/gitaly\/issues\/1226\n\nThe hooks are now executed by setting them explicitly each git shellout, instead of executing the `path\/to\/repo.git\/hooks` which is symlinked to the `gitlab-shell\/hooks` dir.\n\nThe symlinking still happens, but this could stop. Downside of stopping doing so, is that a client could not downgrade the GitLab version with a minor release as the projects that got created in the mean time wouldn't have the symlink.\n\nThe cost to keep symlinking is low, but I'd recommend removing the symlinking around %\"12.0\" to avoid confusion and have one way of doing so.\n\nAdded this to that milestone, feel free to remove @jramsay :)","state":"closed","created_at":1541751978468,"updated_at":1568817115658,"closed_at":1557590880310,"closed_by":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"labels":["Deliverable","devops::create","group::gitaly","maintenance::refactor"],"milestone":{"id":693518,"iid":33,"group_id":9970,"title":"12.0","description":"https:\/\/about.gitlab.com\/releases\/2019\/06\/22\/gitlab-12-0-released\/","state":"closed","created_at":"2018-10-30T16:47:37.975Z","updated_at":"2020-04-22T19:51:03.475Z","due_date":"2019-06-22","start_date":"2019-05-08","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/33"},"assignees":[{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"type":"ISSUE","assignee":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"user_notes_count":6,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/1392","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1392","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1392\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1392\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#1392","relative":"#1392","full":"gitlab-org\/gitaly#1392"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":15977073,"iid":1403,"project_id":2009901,"title":"Importing Project on same instance from URL fails","description":"### Summary\n\nImport a repository from the same GitLab instance during project creation is failing with the error message below displayed on the empty repository's import screen.\n\n```\nEvery import attempt has failed: Error importing repository https:\/\/ckgltest.s.co.zw\/root\/greenie.git into root\/greenie-import - 13:CreateRepositoryFromURL: clone cmd wait: exit status 128. Please try again.\n```\n\n### Steps to reproduce\n\n* Create a new project and select import by Git URL.\n* Enter the URL of another project within our GitLab instance and run the import.\n\n### Example Project\n\nFailed to reproduce on GitLab.com but reproduced successfully on 11.0.3-ee\n\n### What is the expected *correct* behavior?\n\nProject should be imported without errors. This was working for the [customer](https:\/\/gitlab.zendesk.com\/agent\/tickets\/100000)  before upgrading to 11.0\n\n### Relevant logs and\/or screenshots\n\n![Screen_Shot_2018-07-10_at_09.56.45](\/uploads\/f979d9588b839bce7509f23948d0c01e\/Screen_Shot_2018-07-10_at_09.56.45.png)","state":"closed","created_at":1531209980274,"updated_at":1592379363738,"closed_at":1592379363669,"closed_by":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"labels":["Category:Gitaly","bug::performance","customer","devops::create","group::gitaly","missed:13.0","priority::3","regression","regression:11.3","severity::3","type::bug","workflow::in dev"],"milestone":null,"assignees":[{"id":1349468,"username":"ckatanda","name":"Chenjerai Katanda","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/1349468\/avatar.png","web_url":"https:\/\/gitlab.com\/ckatanda"}],"author":{"id":1349468,"username":"ckatanda","name":"Chenjerai Katanda","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/1349468\/avatar.png","web_url":"https:\/\/gitlab.com\/ckatanda"},"type":"ISSUE","assignee":{"id":1349468,"username":"ckatanda","name":"Chenjerai Katanda","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/1349468\/avatar.png","web_url":"https:\/\/gitlab.com\/ckatanda"},"user_notes_count":47,"merge_requests_count":0,"upvotes":7,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/1403","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1403","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1403\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/1403\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#1403","relative":"#1403","full":"gitlab-org\/gitaly#1403"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":5257325,"iid":203,"project_id":2009901,"title":"Go 1.8","description":"This is a placeholder issue to discuss upgrading Go to 1.8, now that https:\/\/gitlab.com\/gitlab-org\/omnibus-gitlab\/issues\/2279 is merged. \n\n- Update CI to stop testing on Go 1.5 \/ 1.6 and 1.7. \n- Update documentation for developer requirements\n- Discuss any potential code changes that may follow on from this change in future (for example, related to context)","state":"closed","created_at":1493714478269,"updated_at":1565166525047,"closed_at":1496747966402,"closed_by":null,"labels":["devops::systems","group::distribution"],"milestone":{"id":286698,"iid":12,"project_id":2009901,"title":"9.3","description":"","state":"closed","created_at":"2017-03-21T10:10:13.485Z","updated_at":"2017-07-06T12:27:27.330Z","due_date":"2017-06-07","start_date":"2017-05-23","expired":true,"web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/milestones\/12"},"assignees":[],"author":{"id":895869,"username":"andrewn","name":"Andrew Newdigate","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/895869\/avatar.png","web_url":"https:\/\/gitlab.com\/andrewn"},"type":"ISSUE","assignee":null,"user_notes_count":2,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/203","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/203","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/203\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/203\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#203","relative":"#203","full":"gitlab-org\/gitaly#203"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":5200506,"iid":201,"project_id":2009901,"title":"Gitlab-shell hooks can no longer send absolute paths to gitlab-ce","description":"~\"Client Implementation\": https:\/\/gitlab.com\/gitlab-org\/gitlab-ce\/issues\/29925\r\n\r\nAdditional tasks: \r\n  - https:\/\/gitlab.com\/gitlab-org\/gitaly\/issues\/150\r\n  - https:\/\/gitlab.com\/gitlab-org\/gitaly\/issues\/151","state":"closed","created_at":1493215490413,"updated_at":1499266088143,"closed_at":1498724347042,"closed_by":null,"labels":["Setup","Sharding"],"milestone":{"id":325402,"iid":20,"project_id":2009901,"title":"Milestone 2017-06-16","description":"### GitLab 9.3 Cutoff\r\n\r\n- What do we need to deliver for GitLab 9.3?","state":"closed","created_at":"2017-06-05T13:18:07.281Z","updated_at":"2017-07-06T12:50:40.535Z","due_date":"2017-06-16","start_date":"2017-06-05","expired":true,"web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/milestones\/20"},"assignees":[{"id":367626,"username":"alejandro","name":"Alejandro Rodr\u00edguez","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/367626\/avatar.png","web_url":"https:\/\/gitlab.com\/alejandro"}],"author":{"id":895869,"username":"andrewn","name":"Andrew Newdigate","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/895869\/avatar.png","web_url":"https:\/\/gitlab.com\/andrewn"},"type":"ISSUE","assignee":{"id":367626,"username":"alejandro","name":"Alejandro Rodr\u00edguez","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/367626\/avatar.png","web_url":"https:\/\/gitlab.com\/alejandro"},"user_notes_count":2,"merge_requests_count":6,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/201","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/201","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/201\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/201\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#201","relative":"#201","full":"gitlab-org\/gitaly#201"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":5200434,"iid":200,"project_id":2009901,"title":"Test how GitLab behaves when Gitaly is Down","description":"@pcarranza's idea:\n> test how does GitLab behaves when a Gitaly server is down - we need better resiliency when an NFS server goes down, since it will happen again and we will be running Gitaly on those hosts, we need to be sure that the application will survive when they go dark. For this I propose that we actually test how gRPC behaves and we code for resiliency from now and not as an afterthought.","state":"closed","created_at":1493214934459,"updated_at":1520282529281,"closed_at":1519664323507,"closed_by":null,"labels":[],"milestone":null,"assignees":[{"id":895869,"username":"andrewn","name":"Andrew Newdigate","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/895869\/avatar.png","web_url":"https:\/\/gitlab.com\/andrewn"}],"author":{"id":895869,"username":"andrewn","name":"Andrew Newdigate","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/895869\/avatar.png","web_url":"https:\/\/gitlab.com\/andrewn"},"type":"ISSUE","assignee":{"id":895869,"username":"andrewn","name":"Andrew Newdigate","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/895869\/avatar.png","web_url":"https:\/\/gitlab.com\/andrewn"},"user_notes_count":18,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/200","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/200","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/200\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/200\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#200","relative":"#200","full":"gitlab-org\/gitaly#200"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":5200084,"iid":199,"project_id":2009901,"title":"Client Implementation: CommitDiff changes for deltas_only","description":"~Conversation: #222 \r\n\r\n~\"RPC Design\": https:\/\/gitlab.com\/gitlab-org\/gitaly-proto\/merge_requests\/15 \r\n\r\n~\"Server Implementation\": #178\r\n\r\n----------------------------------------------\r\n\r\nUpdate GitLab-CE with the CommitDiff changes for `deltas_only`","state":"closed","created_at":1493212827666,"updated_at":1495559572869,"closed_at":1494792200971,"closed_by":null,"labels":[],"milestone":{"id":305102,"iid":17,"project_id":2009901,"title":"Milestone 2017-05-19","description":"[GitLab 9.2 release](https:\/\/gitlab.com\/gitlab-org\/gitlab-ce\/milestones\/36) has been cut, which means that the Gitaly team can start testing Gitaly running across a network. \r\n\r\nThemes: ~\"Acceptance Testing\" \r\n\r\n## Testing\r\n\r\nOur **top priority** for this release is to [test our implementations](https:\/\/gitlab.com\/gitlab-org\/gitaly\/issues?scope=all&utf8=%E2%9C%93&state=opened&label_name[]=Acceptance%20Testing&milestone_title=Milestone%202017-05-19).\r\n\r\n@jacobvosmaer-gitlab will focus on testing [Gitaly running across the network](https:\/\/gitlab.com\/gitlab-org\/gitaly\/issues\/181) and how [GitLab handled Gitaly failures](https:\/\/gitlab.com\/gitlab-org\/gitaly\/issues\/200).\r\n\r\n@eReGeBe @ahmadsherif and @bkc will focus on testing the migrations: \r\n\r\n- #215 \r\n- #211\r\n- #210 \r\n- #209 \r\n- #184\r\n\r\n@andrewn has added some documentation about what we expect from the [acceptance testing]( \r\nhttps:\/\/gitlab.com\/gitlab-org\/gitaly\/merge_requests\/144\/diffs#36e74ccc6a563cded188bd7806cb126dff075937)\r\n\r\n\r\n## Waiting for 9.2 RC1\r\n\r\nThere may be some slacktime between the start of the iteration and the availability of 9.2RC1. \r\n\r\nDuring this time, please focus on\r\n\r\n- Completing work left over from the last iteration\r\n- Other tasks assigned to you for this milestone\r\n- If you are still available, speak to @andrewn or pick a task from ~\"To Do\"\r\n\r\nPlease note that once 9.2 is available on staging, you'll need to switch across to testing as this is our top priority. If we leave testing too late, we may miss the release and will need to delay some of the feature flags by another release.\r\n\r\n\r\n\r\n","state":"closed","created_at":"2017-04-26T12:05:56.503Z","updated_at":"2017-07-06T08:50:46.869Z","due_date":"2017-05-19","start_date":"2017-05-08","expired":true,"web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/milestones\/17"},"assignees":[{"id":506061,"username":"ahmadsherif","name":"Ahmad Sherif","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/bd6d0ec4213b91601956c9f801cbfe9b?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/ahmadsherif"}],"author":{"id":895869,"username":"andrewn","name":"Andrew Newdigate","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/895869\/avatar.png","web_url":"https:\/\/gitlab.com\/andrewn"},"type":"ISSUE","assignee":{"id":506061,"username":"ahmadsherif","name":"Ahmad Sherif","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/bd6d0ec4213b91601956c9f801cbfe9b?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/ahmadsherif"},"user_notes_count":0,"merge_requests_count":6,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/199","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/199","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/199\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/199\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#199","relative":"#199","full":"gitlab-org\/gitaly#199"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":5200076,"iid":198,"project_id":2009901,"title":"Client Implementation: CommitDiff changes for whitespace_changes_only and path","description":"~\"RPC Design\": https:\/\/gitlab.com\/gitlab-org\/gitaly-proto\/merge_requests\/15 \r\n\r\n~\"Server Implementation\": #178\r\n\r\n----------------------------------------------\r\n\r\nUpdate GitLab-CE with the CommitDiff changes for `whitespace_changes_only` and `path`","state":"closed","created_at":1493212769697,"updated_at":1494199889974,"closed_at":1494197975526,"closed_by":null,"labels":[],"milestone":{"id":303689,"iid":16,"project_id":2009901,"title":"Milestone 2017-05-05","description":"This release will coincide with the GitLab CE cutoff for [GitLab 9.2](https:\/\/gitlab.com\/gitlab-org\/gitlab-ce\/milestones\/36)\r\n\r\n## Themes\r\n\r\nThe themes for this milestone are, in descending priority:\r\n\r\n1. **Re-enable disabled Gitaly features on GitLab.com**: trackdown all bugs in Gitaly that are currently leading to it being disabled.\r\n\r\n2. **Move Gitaly closer to the data**: move Gitaly onto the NFS servers. Solve problems related to:\r\n  1. Git-hooks\r\n  2. Production buy-in and support\r\n  \r\n3. **Git SSH and HTTP support**:","state":"closed","created_at":"2017-04-24T10:47:39.880Z","updated_at":"2017-05-09T08:10:09.101Z","due_date":"2017-05-05","start_date":"2017-04-24","expired":true,"web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/milestones\/16"},"assignees":[{"id":506061,"username":"ahmadsherif","name":"Ahmad Sherif","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/bd6d0ec4213b91601956c9f801cbfe9b?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/ahmadsherif"}],"author":{"id":895869,"username":"andrewn","name":"Andrew Newdigate","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/895869\/avatar.png","web_url":"https:\/\/gitlab.com\/andrewn"},"type":"ISSUE","assignee":{"id":506061,"username":"ahmadsherif","name":"Ahmad Sherif","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/bd6d0ec4213b91601956c9f801cbfe9b?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/ahmadsherif"},"user_notes_count":0,"merge_requests_count":2,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/198","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/198","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/198\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/198\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#198","relative":"#198","full":"gitlab-org\/gitaly#198"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":5199436,"iid":197,"project_id":2009901,"title":"Address unicorn grpc preforking issues in gitlab-ce","description":"Resolved by: https:\/\/gitlab.com\/gitlab-org\/gitlab-ce\/issues\/31143","state":"closed","created_at":1493208917921,"updated_at":1495111709000,"closed_at":1493399595999,"closed_by":null,"labels":["GRPC","type::bug"],"milestone":{"id":303689,"iid":16,"project_id":2009901,"title":"Milestone 2017-05-05","description":"This release will coincide with the GitLab CE cutoff for [GitLab 9.2](https:\/\/gitlab.com\/gitlab-org\/gitlab-ce\/milestones\/36)\r\n\r\n## Themes\r\n\r\nThe themes for this milestone are, in descending priority:\r\n\r\n1. **Re-enable disabled Gitaly features on GitLab.com**: trackdown all bugs in Gitaly that are currently leading to it being disabled.\r\n\r\n2. **Move Gitaly closer to the data**: move Gitaly onto the NFS servers. Solve problems related to:\r\n  1. Git-hooks\r\n  2. Production buy-in and support\r\n  \r\n3. **Git SSH and HTTP support**:","state":"closed","created_at":"2017-04-24T10:47:39.880Z","updated_at":"2017-05-09T08:10:09.101Z","due_date":"2017-05-05","start_date":"2017-04-24","expired":true,"web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/milestones\/16"},"assignees":[{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/513969\/avatar.png","web_url":"https:\/\/gitlab.com\/jacobvosmaer-gitlab"}],"author":{"id":895869,"username":"andrewn","name":"Andrew Newdigate","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/895869\/avatar.png","web_url":"https:\/\/gitlab.com\/andrewn"},"type":"ISSUE","assignee":{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/513969\/avatar.png","web_url":"https:\/\/gitlab.com\/jacobvosmaer-gitlab"},"user_notes_count":1,"merge_requests_count":6,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/197","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/197","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/197\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/197\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#197","relative":"#197","full":"gitlab-org\/gitaly#197"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":5198569,"iid":196,"project_id":2009901,"title":"Document changelog process in CONTRIBUTING","description":"Also automation in release script.","state":"closed","created_at":1493202812869,"updated_at":1493904929214,"closed_at":1493899402958,"closed_by":null,"labels":["documentation"],"milestone":{"id":303689,"iid":16,"project_id":2009901,"title":"Milestone 2017-05-05","description":"This release will coincide with the GitLab CE cutoff for [GitLab 9.2](https:\/\/gitlab.com\/gitlab-org\/gitlab-ce\/milestones\/36)\r\n\r\n## Themes\r\n\r\nThe themes for this milestone are, in descending priority:\r\n\r\n1. **Re-enable disabled Gitaly features on GitLab.com**: trackdown all bugs in Gitaly that are currently leading to it being disabled.\r\n\r\n2. **Move Gitaly closer to the data**: move Gitaly onto the NFS servers. Solve problems related to:\r\n  1. Git-hooks\r\n  2. Production buy-in and support\r\n  \r\n3. **Git SSH and HTTP support**:","state":"closed","created_at":"2017-04-24T10:47:39.880Z","updated_at":"2017-05-09T08:10:09.101Z","due_date":"2017-05-05","start_date":"2017-04-24","expired":true,"web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/milestones\/16"},"assignees":[{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/513969\/avatar.png","web_url":"https:\/\/gitlab.com\/jacobvosmaer-gitlab"}],"author":{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/513969\/avatar.png","web_url":"https:\/\/gitlab.com\/jacobvosmaer-gitlab"},"type":"ISSUE","assignee":{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/513969\/avatar.png","web_url":"https:\/\/gitlab.com\/jacobvosmaer-gitlab"},"user_notes_count":0,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/196","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/196","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/196\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/196\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#196","relative":"#196","full":"gitlab-org\/gitaly#196"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":5197911,"iid":195,"project_id":2009901,"title":"RPC Design: Commit::TreeEntry Endpoint","description":"~\"Migration Analysis\": #169 \r\n\r\n~Conversation: #310 \r\n\r\n------------------------------------\r\n\r\nGoal: develop the RPC interfaces required to migrate `Projects::RawController#show`","state":"closed","created_at":1493198510325,"updated_at":1497293984545,"closed_at":1497293983709,"closed_by":null,"labels":["RPC Design"],"milestone":{"id":325402,"iid":20,"project_id":2009901,"title":"Milestone 2017-06-16","description":"### GitLab 9.3 Cutoff\r\n\r\n- What do we need to deliver for GitLab 9.3?","state":"closed","created_at":"2017-06-05T13:18:07.281Z","updated_at":"2017-07-06T12:50:40.535Z","due_date":"2017-06-16","start_date":"2017-06-05","expired":true,"web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/milestones\/20"},"assignees":[{"id":506061,"username":"ahmadsherif","name":"Ahmad Sherif","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/bd6d0ec4213b91601956c9f801cbfe9b?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/ahmadsherif"}],"author":{"id":895869,"username":"andrewn","name":"Andrew Newdigate","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/895869\/avatar.png","web_url":"https:\/\/gitlab.com\/andrewn"},"type":"ISSUE","assignee":{"id":506061,"username":"ahmadsherif","name":"Ahmad Sherif","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/bd6d0ec4213b91601956c9f801cbfe9b?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/ahmadsherif"},"user_notes_count":12,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/195","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/195","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/195\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/195\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#195","relative":"#195","full":"gitlab-org\/gitaly#195"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":5197872,"iid":194,"project_id":2009901,"title":"Migration Analysis: Workhorse Sendblob","description":"~Conversation: #212 \r\n\r\nPerform an analysis of the migration of Workhorse's `sendblob`.\r\n\r\nOutput:\r\n* List of existing RPCs to be used\r\n* List of new RPCs required\r\n* Risks\r\n* Estimated effort","state":"closed","created_at":1493198204928,"updated_at":1528808362839,"closed_at":1494316343383,"closed_by":null,"labels":["Migration Analysis"],"milestone":{"id":325402,"iid":20,"project_id":2009901,"title":"Milestone 2017-06-16","description":"### GitLab 9.3 Cutoff\r\n\r\n- What do we need to deliver for GitLab 9.3?","state":"closed","created_at":"2017-06-05T13:18:07.281Z","updated_at":"2017-07-06T12:50:40.535Z","due_date":"2017-06-16","start_date":"2017-06-05","expired":true,"web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/milestones\/20"},"assignees":[],"author":{"id":895869,"username":"andrewn","name":"Andrew Newdigate","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/895869\/avatar.png","web_url":"https:\/\/gitlab.com\/andrewn"},"type":"ISSUE","assignee":null,"user_notes_count":4,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/194","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/194","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/194\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/194\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#194","relative":"#194","full":"gitlab-org\/gitaly#194"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":5197697,"iid":193,"project_id":2009901,"title":"Define the GitLab Shell <-> Gitaly CLI Stub interface","description":"Blocking: #124 \r\n\r\nRelated: https:\/\/gitlab.com\/gitlab-org\/gitlab-shell\/issues\/80\r\n\r\n----------------------------------\r\n\r\nAs part of https:\/\/gitlab.com\/gitlab-org\/gitaly\/issues\/124 we need to have a way of communicating between GitLab-Shell and a GitLab CLI interface.\r\n\r\nDo we use environment variables? Configuration file? Arguments?\r\n\r\nhttps:\/\/gitlab.com\/gitlab-org\/gitaly\/issues\/124 is blocked on this but work will be able to continue once it's done.","state":"closed","created_at":1493197866888,"updated_at":1499266088094,"closed_at":1495554100845,"closed_by":null,"labels":[],"milestone":{"id":305102,"iid":17,"project_id":2009901,"title":"Milestone 2017-05-19","description":"[GitLab 9.2 release](https:\/\/gitlab.com\/gitlab-org\/gitlab-ce\/milestones\/36) has been cut, which means that the Gitaly team can start testing Gitaly running across a network. \r\n\r\nThemes: ~\"Acceptance Testing\" \r\n\r\n## Testing\r\n\r\nOur **top priority** for this release is to [test our implementations](https:\/\/gitlab.com\/gitlab-org\/gitaly\/issues?scope=all&utf8=%E2%9C%93&state=opened&label_name[]=Acceptance%20Testing&milestone_title=Milestone%202017-05-19).\r\n\r\n@jacobvosmaer-gitlab will focus on testing [Gitaly running across the network](https:\/\/gitlab.com\/gitlab-org\/gitaly\/issues\/181) and how [GitLab handled Gitaly failures](https:\/\/gitlab.com\/gitlab-org\/gitaly\/issues\/200).\r\n\r\n@eReGeBe @ahmadsherif and @bkc will focus on testing the migrations: \r\n\r\n- #215 \r\n- #211\r\n- #210 \r\n- #209 \r\n- #184\r\n\r\n@andrewn has added some documentation about what we expect from the [acceptance testing]( \r\nhttps:\/\/gitlab.com\/gitlab-org\/gitaly\/merge_requests\/144\/diffs#36e74ccc6a563cded188bd7806cb126dff075937)\r\n\r\n\r\n## Waiting for 9.2 RC1\r\n\r\nThere may be some slacktime between the start of the iteration and the availability of 9.2RC1. \r\n\r\nDuring this time, please focus on\r\n\r\n- Completing work left over from the last iteration\r\n- Other tasks assigned to you for this milestone\r\n- If you are still available, speak to @andrewn or pick a task from ~\"To Do\"\r\n\r\nPlease note that once 9.2 is available on staging, you'll need to switch across to testing as this is our top priority. If we leave testing too late, we may miss the release and will need to delay some of the feature flags by another release.\r\n\r\n\r\n\r\n","state":"closed","created_at":"2017-04-26T12:05:56.503Z","updated_at":"2017-07-06T08:50:46.869Z","due_date":"2017-05-19","start_date":"2017-05-08","expired":true,"web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/milestones\/17"},"assignees":[{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/513969\/avatar.png","web_url":"https:\/\/gitlab.com\/jacobvosmaer-gitlab"}],"author":{"id":895869,"username":"andrewn","name":"Andrew Newdigate","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/895869\/avatar.png","web_url":"https:\/\/gitlab.com\/andrewn"},"type":"ISSUE","assignee":{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/513969\/avatar.png","web_url":"https:\/\/gitlab.com\/jacobvosmaer-gitlab"},"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/193","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/193","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/193\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/193\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#193","relative":"#193","full":"gitlab-org\/gitaly#193"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":5002397,"iid":184,"project_id":2009901,"title":"Validate SmartHTTP::PostUploadPack","description":"~Conversation: https:\/\/gitlab.com\/gitlab-org\/gitaly\/issues\/219\n\nSee the [Migration Process documentation](https:\/\/gitlab.com\/gitlab-org\/gitaly\/blob\/master\/doc\/MIGRATION_PROCESS.md#acceptance-testing-acceptance-testing) \nfor more information on the Acceptance Testing stage of the process.\n\nFeature Toggle Environment Variable: `GITALY_POST_UPLOAD_PACK`\n\n--------------------------------------------------------------------------------\n\n- [x] [Chef recipes](https:\/\/dev.gitlab.org\/cookbooks\/chef-repo) to enable\/disable this feature https:\/\/dev.gitlab.org\/cookbooks\/chef-repo\/merge_requests\/684\n- [x] [Grafana dashboard](https:\/\/gitlab.com\/gitlab-org\/grafana-dashboards\/) for monitoring https:\/\/gitlab.com\/gitlab-org\/gitaly-dashboards\/merge_requests\/5\n- [ ] Environments\n    - [x] `dev.gitlab.org` https:\/\/dev.gitlab.org\/cookbooks\/chef-repo\/merge_requests\/685\n    - [x] Staging https:\/\/dev.gitlab.org\/cookbooks\/chef-repo\/merge_requests\/684\n    - [x] `gitlab.com` https:\/\/dev.gitlab.org\/cookbooks\/chef-repo\/merge_requests\/696 https:\/\/docs.google.com\/document\/d\/1SmZvlT7D1dXsEtRPZc0xWR0jGmPmLztlGkG4_L9DQeU\/edit\n- [ ] Test Results (post as comments on this issue)\n    - [ ] Did the migration perform as expected? \n    - [ ] Did the code have reasonable performance characteristics?\n    - [ ] Did error rates jump to an unacceptable level?\n- [ ] Have the changes been rolled back pending final review?\n- [ ] Runbook Added (link to MR)\n- [ ] Prometheus Alerts Added (link to MR)\n\n-----------------------------------------------------------------------------------\n\nWe now (9.1) have a feature flag GITALY_POST_UPLOAD_PACK in gitlab-ce. We should validate that it works:\n\n- [x] test in omnibus nightly\n- [x] test in RC omnibus package\n- [x] test in staging (apply setting, do manual clones, look at prometheus counters for errors and to see if the RPC is being used)\n- [x] test in production for a few hours (same as staging)\n- [ ] test in production for a week\n- [ ] enable feature flag by default in omnibus\n\n----\n## Staging steps\n\n- update `gitlab-staging-worker` role (make sure change is on chef.gitlab.com, not just in the chef-repo)\n- `knife ssh -C 1 role:gitlab-staging-worker 'sudo chef-client; sleep 60; sudo gitlab-ctl term unicorn; echo done $?'` (`-C 1` is probably too slow for production)\n- `knife ssh role:gitlab-staging-worker 'for p in $(pgrep -f \"unicorn master\"); do ps -o pid,etime,args -p $p; sudo cat  \/proc\/$p\/environ | xargs --null --max-args=1; done' | grep GITALY`\n - check [gitaly staging prometheus dashbord](https:\/\/performance.gitlab.net\/dashboard\/db\/gitaly?orgId=1&var-job=gitaly-staging)\n- check [Sentry for staging](https:\/\/sentry.gitlap.com\/gitlab\/staginggitlabcom\/)\n- manual tests\n- revert config change\n\n## Local omnibus steps\n\nIn gitlab.rb:\n\n```ruby\ngitlab_rails['env'] = {'GITALY_POST_UPLOAD_PACK' => '1'}\n```\n\nTo apply or revert:\n\n```\nsudo gitlab-ctl reconfigure\nsleep 60 # wait for unicorn to reload\nsudo gitlab-ctl term unicorn\n# test environment of unicorn master. should print a match\nfor p in $(pgrep -f 'unicorn master'); do ps -o pid,etime,args -p $p; sudo cat  \/proc\/$p\/environ | xargs --null --max-args=1 | grep GITALY; done\n```\n\nThe rigmarole with `gitlab-ctl term` is because of https:\/\/gitlab.com\/gitlab-org\/omnibus-gitlab\/issues\/2002","state":"closed","created_at":1491835486799,"updated_at":1504610432304,"closed_at":1504255522927,"closed_by":null,"labels":[],"milestone":null,"assignees":[{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/513969\/avatar.png","web_url":"https:\/\/gitlab.com\/jacobvosmaer-gitlab"}],"author":{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/513969\/avatar.png","web_url":"https:\/\/gitlab.com\/jacobvosmaer-gitlab"},"type":"ISSUE","assignee":{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/513969\/avatar.png","web_url":"https:\/\/gitlab.com\/jacobvosmaer-gitlab"},"user_notes_count":49,"merge_requests_count":6,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/184","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":19,"completed_count":9},"weight":3,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/184","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/184\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/184\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#184","relative":"#184","full":"gitlab-org\/gitaly#184"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":null},{"id":4985014,"iid":181,"project_id":2009901,"title":"Gitaly-on-NFS staging test plan","description":"How will we test this on staging with 9.1. RCx.\r\n\r\n- [x] make sure Gitaly over TCP works in omnibus\r\n- [x] test with localhost\r\n- [x] test with remote host and different repository root\r\n- [ ] instructions to prepare staging\r\n- [x] wait for package with all required capabilities to be deployed on staging\r\n- [ ] schedule time with someone with production access to run experiments on staging\r\n\r\nParallel production issue: https:\/\/gitlab.com\/gitlab-com\/infrastructure\/issues\/1777\r\n\r\nMerge Request with (some of) the required staging configuration changes https:\/\/dev.gitlab.org\/cookbooks\/chef-repo\/merge_requests\/637","state":"closed","created_at":1491581251432,"updated_at":1531942134871,"closed_at":1496669982879,"closed_by":null,"labels":[],"milestone":{"id":315744,"iid":19,"project_id":2009901,"title":"Milestone 2017-06-02","description":"","state":"closed","created_at":"2017-05-17T14:34:14.380Z","updated_at":"2017-07-06T08:51:21.797Z","due_date":"2017-06-02","start_date":"2017-05-22","expired":true,"web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/milestones\/19"},"assignees":[{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/513969\/avatar.png","web_url":"https:\/\/gitlab.com\/jacobvosmaer-gitlab"}],"author":{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/513969\/avatar.png","web_url":"https:\/\/gitlab.com\/jacobvosmaer-gitlab"},"type":"ISSUE","assignee":{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/513969\/avatar.png","web_url":"https:\/\/gitlab.com\/jacobvosmaer-gitlab"},"user_notes_count":41,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/181","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":6,"completed_count":4},"weight":3,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/181","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/181\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/181\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#181","relative":"#181","full":"gitlab-org\/gitaly#181"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":null},{"id":4976958,"iid":178,"project_id":2009901,"title":"Operation `CommitDiff ` on service `Diff` doesn't implement the full functionality expected by Gitlab CE","description":"~Conversation: gitlab-org\/gitaly#222\r\n\r\nThe following flags are not supported:\r\n\r\n- [ ] deltas_only\r\n- [ ] ignore_whitespace_change\r\n- [ ] paths\r\n\r\nBecause of this reason, we can't fully migrate this operation to Gitaly. We should implement support for these flags. This will require changes in gitaly-proto.\r\n\r\n\/cc @jacobvosmaer-gitlab @andrewn @ahmadsherif ","state":"closed","created_at":1491509945747,"updated_at":1494335776361,"closed_at":1493994457998,"closed_by":null,"labels":["Server Implementation","type::bug"],"milestone":{"id":303689,"iid":16,"project_id":2009901,"title":"Milestone 2017-05-05","description":"This release will coincide with the GitLab CE cutoff for [GitLab 9.2](https:\/\/gitlab.com\/gitlab-org\/gitlab-ce\/milestones\/36)\r\n\r\n## Themes\r\n\r\nThe themes for this milestone are, in descending priority:\r\n\r\n1. **Re-enable disabled Gitaly features on GitLab.com**: trackdown all bugs in Gitaly that are currently leading to it being disabled.\r\n\r\n2. **Move Gitaly closer to the data**: move Gitaly onto the NFS servers. Solve problems related to:\r\n  1. Git-hooks\r\n  2. Production buy-in and support\r\n  \r\n3. **Git SSH and HTTP support**:","state":"closed","created_at":"2017-04-24T10:47:39.880Z","updated_at":"2017-05-09T08:10:09.101Z","due_date":"2017-05-05","start_date":"2017-04-24","expired":true,"web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/milestones\/16"},"assignees":[{"id":506061,"username":"ahmadsherif","name":"Ahmad Sherif","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/bd6d0ec4213b91601956c9f801cbfe9b?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/ahmadsherif"}],"author":{"id":367626,"username":"alejandro","name":"Alejandro Rodr\u00edguez","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/367626\/avatar.png","web_url":"https:\/\/gitlab.com\/alejandro"},"type":"ISSUE","assignee":{"id":506061,"username":"ahmadsherif","name":"Ahmad Sherif","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/bd6d0ec4213b91601956c9f801cbfe9b?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/ahmadsherif"},"user_notes_count":8,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/178","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":3,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/178","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/178\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/178\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#178","relative":"#178","full":"gitlab-org\/gitaly#178"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":null},{"id":4700826,"iid":123,"project_id":2009901,"title":"Forward Git SSH sessions from gitlab-shell to Gitaly Server Implementation","description":"~Conversation: gitlab-org\/gitaly#218\r\n\r\nDepends on ~\"Migration Analysis\" #91\r\n\r\nDepends on ~\"RPC Design\" https:\/\/gitlab.com\/gitlab-org\/gitaly-proto\/merge_requests\/5\r\n\r\n-------------------\r\n\r\n### ~\"Server Implementation\" Forward Git SSH sessions from gitlab-shell to Gitaly\r\n\r\nGoal: allow Gitaly to monitor and control the git upload-pack and git receive-pack server-side processes spawned by the Git SSH transport.\r\n\r\n\r\nWe already have a protocol for this. https:\/\/gitlab.com\/gitlab-org\/gitaly-proto\/blob\/v0.5.0\/ssh.proto \r\n\r\nWe want to be able to run two commands on behalf of SSH clients: `git upload-pack` and `git receive-pack`. Each has its own RPC `SSHUploadPack` and `SSHReceivePack`.\r\n\r\nThe idea behind the current proto is:\r\n\r\n- read first request message to get Repository and some metadata (GL_ID variable) in case of receive-pack\r\n- start the git process requested for the correct git repository path\r\n- in a goroutine: copy the rest of the request stream to stdin\r\n- in two goroutines: copy the stdout and stderr streams to the response\r\n- wait for the git command, out and err streams to finish\r\n- send final response message containing the git exit code","state":"closed","created_at":1489407071416,"updated_at":1528808357478,"closed_at":1494844980812,"closed_by":null,"labels":["Server Implementation"],"milestone":{"id":305102,"iid":17,"project_id":2009901,"title":"Milestone 2017-05-19","description":"[GitLab 9.2 release](https:\/\/gitlab.com\/gitlab-org\/gitlab-ce\/milestones\/36) has been cut, which means that the Gitaly team can start testing Gitaly running across a network. \r\n\r\nThemes: ~\"Acceptance Testing\" \r\n\r\n## Testing\r\n\r\nOur **top priority** for this release is to [test our implementations](https:\/\/gitlab.com\/gitlab-org\/gitaly\/issues?scope=all&utf8=%E2%9C%93&state=opened&label_name[]=Acceptance%20Testing&milestone_title=Milestone%202017-05-19).\r\n\r\n@jacobvosmaer-gitlab will focus on testing [Gitaly running across the network](https:\/\/gitlab.com\/gitlab-org\/gitaly\/issues\/181) and how [GitLab handled Gitaly failures](https:\/\/gitlab.com\/gitlab-org\/gitaly\/issues\/200).\r\n\r\n@eReGeBe @ahmadsherif and @bkc will focus on testing the migrations: \r\n\r\n- #215 \r\n- #211\r\n- #210 \r\n- #209 \r\n- #184\r\n\r\n@andrewn has added some documentation about what we expect from the [acceptance testing]( \r\nhttps:\/\/gitlab.com\/gitlab-org\/gitaly\/merge_requests\/144\/diffs#36e74ccc6a563cded188bd7806cb126dff075937)\r\n\r\n\r\n## Waiting for 9.2 RC1\r\n\r\nThere may be some slacktime between the start of the iteration and the availability of 9.2RC1. \r\n\r\nDuring this time, please focus on\r\n\r\n- Completing work left over from the last iteration\r\n- Other tasks assigned to you for this milestone\r\n- If you are still available, speak to @andrewn or pick a task from ~\"To Do\"\r\n\r\nPlease note that once 9.2 is available on staging, you'll need to switch across to testing as this is our top priority. If we leave testing too late, we may miss the release and will need to delay some of the feature flags by another release.\r\n\r\n\r\n\r\n","state":"closed","created_at":"2017-04-26T12:05:56.503Z","updated_at":"2017-07-06T08:50:46.869Z","due_date":"2017-05-19","start_date":"2017-05-08","expired":true,"web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/milestones\/17"},"assignees":[],"author":{"id":895869,"username":"andrewn","name":"Andrew Newdigate","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/895869\/avatar.png","web_url":"https:\/\/gitlab.com\/andrewn"},"type":"ISSUE","assignee":null,"user_notes_count":0,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/123","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/123","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/123\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/123\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#123","relative":"#123","full":"gitlab-org\/gitaly#123"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":4447094,"iid":94,"project_id":2009901,"title":"`make test` requires all files to be checked in","description":"Currently, the test suite is checking that all files are checked in and failing if there are any local changes:\n \n```\nnotice-up-to-date:\tnotice\n\tgit ls-files --error-unmatch NOTICE # NOTICE is a tracked file\n\tgit diff --exit-code # there are no changed files\n```\n\nThis is happening here: `git diff --exit-code`\n\nI would question why we have this at all:\n1. In a local development environment, we would expect there to be uncommitted changes.\n2. In a CI environment, this would not serve a purpose either\n\nWe should be able to run `make test` without requiring all changes to be committed.","state":"closed","created_at":1487594984183,"updated_at":1565166527591,"closed_at":null,"closed_by":null,"labels":["devops::systems","group::distribution"],"milestone":null,"assignees":[{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/513969\/avatar.png","web_url":"https:\/\/gitlab.com\/jacobvosmaer-gitlab"}],"author":{"id":895869,"username":"andrewn","name":"Andrew Newdigate","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/895869\/avatar.png","web_url":"https:\/\/gitlab.com\/andrewn"},"type":"ISSUE","assignee":{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/513969\/avatar.png","web_url":"https:\/\/gitlab.com\/jacobvosmaer-gitlab"},"user_notes_count":0,"merge_requests_count":1,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/94","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/94","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/94\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/94\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#94","relative":"#94","full":"gitlab-org\/gitaly#94"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":124674510,"iid":4827,"project_id":2009901,"title":"FindChangedPaths returns paths that are not changed from merge commit","description":"<!--\nIf possible, please select a relevant template from the \"Choose a template\" dropdown above.\n-->\n\n<!-- template sourced from https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/blob\/master\/.gitlab\/issue_templates\/Default.md -->\n\nRelated Gitlab Issue: https:\/\/gitlab.com\/gitlab-org\/gitlab\/-\/issues\/23625\n\nWhen a user pushes a list of changes to gitlab we perform diff checks on the changes. If those changes include a merge commit the returned changed paths may also include changes that are already in history.\n\nWe can solve the gitlab issue linked above by using [-c](https:\/\/git-scm.com\/docs\/git-diff-tree#Documentation\/git-diff-tree.txt--c) instead of [-m](https:\/\/git-scm.com\/docs\/git-diff-tree#Documentation\/git-diff-tree.txt--m) in the [FindChangedPaths git-diff-tree cmd](https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/blob\/master\/internal\/gitaly\/service\/diff\/find_changed_paths.go#L61). `-c` combines the diffs and only returns changes that are different in all parents e.g. conflict resolutions (where different from all parents) and other manual changes introduced during the merge.\n\nI discussed this in slack with @jcaigitlab and @pks-gitlab. \n\n@pks-gitlab pointed out that this would be a breaking change so rather than changing the flag we should introduce an enum to allow the client to specify how the output should be formatted. \n\nNote: the [output format for a merge commit](https:\/\/git-scm.com\/docs\/git-diff-tree#_diff_format_for_merges) when using `-c` is different to `-m` (each parent has a mode and sha and a status) so the `nextPath` function will need to return multiple `gitalypb.ChangedPaths` for each merge commit.","state":"closed","created_at":1677836990600,"updated_at":1682078726100,"closed_at":1681453915614,"closed_by":{"id":660180,"username":"toon","name":"Toon Claes","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/660180\/avatar.png","web_url":"https:\/\/gitlab.com\/toon"},"labels":["Git-LFS","feature::addition","group::gitaly","group::gitaly::git","priority::2","severity::3","type::feature","workflow::in dev"],"milestone":{"id":2910456,"iid":86,"group_id":9970,"title":"15.11","description":"","state":"active","created_at":"2022-12-13T20:08:46.985Z","updated_at":"2022-12-13T20:08:46.985Z","due_date":"2023-04-17","start_date":"2023-03-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/86"},"assignees":[{"id":660180,"username":"toon","name":"Toon Claes","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/660180\/avatar.png","web_url":"https:\/\/gitlab.com\/toon"}],"author":{"id":11390638,"username":"jwoodwardgl","name":"Joe Woodward","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/11390638\/avatar.png","web_url":"https:\/\/gitlab.com\/jwoodwardgl"},"type":"ISSUE","assignee":{"id":660180,"username":"toon","name":"Toon Claes","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/660180\/avatar.png","web_url":"https:\/\/gitlab.com\/toon"},"user_notes_count":15,"merge_requests_count":0,"upvotes":6,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/4827","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":1,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/4827","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/4827\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/4827\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#4827","relative":"#4827","full":"gitlab-org\/gitaly#4827"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":118373307,"iid":4612,"project_id":2009901,"title":"Add support for generating patch-ids","description":"Users who interact with MR pages are often distanced from the actual mechanics of git that underlie the diffs, which is a strength of our product. However, by gently obfuscating the concept of commits and branches, we find users are often confused about the implications of those concepts. One area this arises in particular is approval rules behavior around rebases. Often users want approval rules to be reset when new code enters the diff; this is a fairly basic security requirement, as it helps ensure that unreviewed\/unapproved code doesn't enter an MR.\n\nThis sensible behavior is broken in a situation where a rebase occurs, as git generates new commit SHAs, which look like \"new code\" to our app. While we can work around this with rebase commit SHAs and disabling approval rule resets for UI-generated rebases, if someone rebases via the command line, we have no way of detecting that -- we only see new commits coming in via the push. This would lead to a disjointed UX and rebase changes behavior depending on which execution method is chosen.\n\n+ https:\/\/gitlab.com\/gitlab-org\/gitlab\/-\/issues\/216144+\n+ https:\/\/gitlab.com\/gitlab-org\/gitlab\/-\/issues\/337888+\n\nThe real question we're attempting to answer is \"has a meaningful, programmatic change been made in the diff\" which is only detectable by comparing `merge_request_diff` data. Rather than attempt to compare 2 diffs themselves (potentially quite large text blobs) we would instead like the ability to generate a representation of the raw diff, allowing us to compare for _actual_ changes in the code. This would allow us to detect not only for the case of \"this is just a rebase, no need to reset approvals\" but potentially to trigger (or not..) additional management behavior in the review cycle (such as notifying previous reviewers that a change has been made..)\n\nOne approach towards accomplishing this would be to add support for [`git patch-id`](https:\/\/git-scm.com\/docs\/git-patch-id) as a new RPC, allowing us (Rails) to request as needed, storing the result in the DB. This would allow us to quickly and efficiently compare the gestalt of a series of commits, rather than giant diffs, or even commits themselves (which potentially can be added, removed, squashed, etc during rebasing without impacting the resulting diff..)\n\n(This was previously opened in https:\/\/gitlab.com\/gitlab-org\/gitlab\/-\/issues\/378954 and includes some initial discussions and feedback from Rails-side stakeholders here https:\/\/gitlab.com\/gitlab-org\/gitlab\/-\/issues\/378954#note_1149000248)","state":"closed","created_at":1667931334682,"updated_at":1683198768616,"closed_at":1671618816479,"closed_by":{"id":12190999,"username":"knayakgl","name":"karthik nayak","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/12190999\/avatar.png","web_url":"https:\/\/gitlab.com\/knayakgl"},"labels":["Deliverable","Technical Writing","Track Health Status [DEPRECATED]","backend","devops::create","docs::feature","documentation","feature::addition","group::code review","group::gitaly::git","missed-deliverable","missed:15.7","quad-planning::complete-no-action","section::dev","type::feature","workflow::complete"],"milestone":{"id":2745648,"iid":83,"group_id":9970,"title":"15.8","description":"","state":"active","created_at":"2022-08-22T16:57:34.875Z","updated_at":"2022-08-22T16:57:34.875Z","due_date":"2023-01-17","start_date":"2022-12-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/83"},"assignees":[{"id":4901936,"username":"dskim_gitlab","name":"Sincheol (David) Kim","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/84a984a56c54d1d31338678421cecc32?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/dskim_gitlab"}],"author":{"id":40375,"username":"kerrizor","name":"Kerri Miller","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/40375\/avatar.png","web_url":"https:\/\/gitlab.com\/kerrizor"},"type":"ISSUE","assignee":{"id":4901936,"username":"dskim_gitlab","name":"Sincheol (David) Kim","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/84a984a56c54d1d31338678421cecc32?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/dskim_gitlab"},"user_notes_count":37,"merge_requests_count":1,"upvotes":5,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/4612","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":3,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/4612","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/4612\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/4612\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#4612","relative":"#4612","full":"gitlab-org\/gitaly#4612"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":"on_track","task_status":"0 of 0 checklist items completed"},{"id":117061447,"iid":4546,"project_id":2009901,"title":"Introduce new WhitespaceChanges enum and deprecate ignore_whitespace_change","description":"Following from this comment: https:\/\/gitlab.com\/groups\/gitlab-org\/-\/epics\/9028#note_1138747850 from @pks-t \n\nultimately this is a backwards-incompatible change in Gitaly that might also impact other users of it. How about we amend the `CommitDiff` RPC to expose a new enum `WhitespaceChanges` or similar that deprecates the `ignore_whitespace_change` field? It could either be `Unspecified` (we look at `ignore_whitespace_change`), `DontIgnore`, `Ignore` or `IgnoreAll` so that you can then control yourself how exactly to render the diff?\n\n\n### Availability & Testing\nAs the change in this issue is adding a new field, and potentially marking another as deprecated there shouldn't be any major issue here. Any change in behaviour in rails shouldn't happen until https:\/\/gitlab.com\/gitlab-org\/gitlab\/-\/issues\/378213.  \n- We should ensure that `omnibus-gitlab-mirror` trigged by the `trigger-qa` job passes to confirm no unexpected downstream impact","state":"closed","created_at":1666040670158,"updated_at":1676981140103,"closed_at":1675258298795,"closed_by":{"id":12190999,"username":"knayakgl","name":"karthik nayak","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/12190999\/avatar.png","web_url":"https:\/\/gitlab.com\/knayakgl"},"labels":["[deprecated] Accepting merge requests","[deprecated] good for new contributors","devops::systems","feature::addition","group::gitaly","group::gitaly::git","missed:15.8","quad-planning::complete-action","section::enablement","type::feature"],"milestone":{"id":2745650,"iid":84,"group_id":9970,"title":"15.9","description":"","state":"active","created_at":"2022-08-22T16:58:02.303Z","updated_at":"2022-08-22T16:58:02.303Z","due_date":"2023-02-17","start_date":"2023-01-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/84"},"assignees":[{"id":12190999,"username":"knayakgl","name":"karthik nayak","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/12190999\/avatar.png","web_url":"https:\/\/gitlab.com\/knayakgl"}],"author":{"id":5918904,"username":"marc_shaw","name":"Marc Shaw","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/78c946cb19e40815a2b5d97cefecec6a?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/marc_shaw"},"type":"ISSUE","assignee":{"id":12190999,"username":"knayakgl","name":"karthik nayak","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/12190999\/avatar.png","web_url":"https:\/\/gitlab.com\/knayakgl"},"user_notes_count":15,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/4546","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/4546","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/4546\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/4546\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#4546","relative":"#4546","full":"gitlab-org\/gitaly#4546"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":9028.0,"epic":{"id":626878,"iid":9028,"title":"Hide whitespace changes doesn't hide all whitespace changes","url":"\/groups\/gitlab-org\/-\/epics\/9028","group_id":9970,"human_readable_end_date":"Mar 17, 2023","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":108947683,"iid":4251,"project_id":2009901,"title":"Optionally skip computing flattened paths in GetTreeEntries","description":"Computing flattened paths in GetTreeEntries can be excessively expensive. We should add a flag to optionally skip this step so that clients only need to request them in case they're really needed.","state":"closed","created_at":1653286280659,"updated_at":1658235934909,"closed_at":1657292459781,"closed_by":{"id":1161495,"username":"igor.drozdov","name":"Igor Drozdov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/1161495\/avatar.png","web_url":"https:\/\/gitlab.com\/igor.drozdov"},"labels":["Category:Gitaly","bug::performance","devops::systems","group::gitaly","section::enablement","type::bug","workflow::verification"],"milestone":{"id":2453024,"iid":74,"group_id":9970,"title":"15.2","description":"","state":"active","created_at":"2022-02-03T22:24:46.818Z","updated_at":"2022-02-03T22:26:32.010Z","due_date":"2022-07-17","start_date":"2022-06-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/74"},"assignees":[{"id":1161495,"username":"igor.drozdov","name":"Igor Drozdov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/1161495\/avatar.png","web_url":"https:\/\/gitlab.com\/igor.drozdov"}],"author":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"type":"ISSUE","assignee":{"id":1161495,"username":"igor.drozdov","name":"Igor Drozdov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/1161495\/avatar.png","web_url":"https:\/\/gitlab.com\/igor.drozdov"},"user_notes_count":5,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/4251","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/4251","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/4251\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/4251\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#4251","relative":"#4251","full":"gitlab-org\/gitaly#4251"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":8122.0,"epic":{"id":528380,"iid":8122,"title":"Improve design of Gitaly's GetTreeEntries RPC","url":"\/groups\/gitlab-org\/-\/epics\/8122","group_id":9970,"human_readable_end_date":"Sep 17, 2022","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":107255388,"iid":4196,"project_id":2009901,"title":"Remove overlay2 driver specification on CI","description":"Updates !1148\n\nhttps:\/\/docs.gitlab.com\/ee\/ci\/docker\/using_docker_build.html#use-the-overlayfs-driver\n\n> The shared runners on GitLab.com use the overlay2 driver by default.\n\nPart of &7935","state":"closed","created_at":1651026877082,"updated_at":1652924402714,"closed_at":1651125249828,"closed_by":{"id":660180,"username":"toon","name":"Toon Claes","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/660180\/avatar.png","web_url":"https:\/\/gitlab.com\/toon"},"labels":["Category:Gitaly","Community contribution","devops::create","group::gitaly","maintenance::pipelines","section::dev","test","type::maintenance"],"milestone":{"id":2095271,"iid":65,"group_id":9970,"title":"15.0","description":"","state":"active","created_at":"2021-06-08T15:35:34.814Z","updated_at":"2021-11-02T18:23:35.115Z","due_date":"2022-05-17","start_date":"2022-04-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/65"},"assignees":[{"id":100770,"username":"tnir","name":"Takuya Noguchi","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/100770\/canstock6553672_288.png","web_url":"https:\/\/gitlab.com\/tnir"}],"author":{"id":100770,"username":"tnir","name":"Takuya Noguchi","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/100770\/canstock6553672_288.png","web_url":"https:\/\/gitlab.com\/tnir"},"type":"ISSUE","assignee":{"id":100770,"username":"tnir","name":"Takuya Noguchi","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/100770\/canstock6553672_288.png","web_url":"https:\/\/gitlab.com\/tnir"},"user_notes_count":2,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":"2022-05-04","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/4196","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/4196","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/4196\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/4196\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#4196","relative":"#4196","full":"gitlab-org\/gitaly#4196"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":7935.0,"epic":{"id":507749,"iid":7935,"title":"Remove overlay2 driver specification on shared-gitlab-org Runners on .com","url":"\/groups\/gitlab-org\/-\/epics\/7935","group_id":9970,"human_readable_end_date":"Jun 17, 2022","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":"on_track","task_status":"0 of 0 checklist items completed"},{"id":94969384,"iid":3817,"project_id":2009901,"title":"[Feature flag] Enable pagination token exact match","description":"<!-- Title suggestion: [Feature flag] Enable description of feature -->\n\n## What\n\nEnable the `exact_pagination_token_match` feature flag ...\n\n## Owners\n\n* Team: ~\"group::source code\"\n* Most appropriate slack channel to reach out to: `#g_create_source-code-be`\n* Best individual to reach out to: @vyaklushin\n\n## Expectations\n\n### What release does this feature occur in first?\n\nhttps:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/commit\/69eac9a0db256b27a8872f6e871e5d7e61485471 \n14.3.0-rc42\n\n\n\n### What are we expecting to happen?\n\nGitaly will return an error when page token is not found.\n\nPreviously, it would try to return the next element of the collection that goes after the unknown page token. \n\n### What might happen if this goes wrong?\n\nUsers can see an error when requesting a list of branches.\n\n### What can we monitor to detect problems with this?\n\nhttps:\/\/log.gprd.gitlab.net\/goto\/9e72ab5de811c34415eb741c3696eaff\n\n## Beta groups\/projects\n\nIf applicable, any groups\/projects that are happy to have this feature turned on early. Some organizations may wish to test big changes they are interested in with a small subset of users ahead of time for example.\n\n- `gitlab-org\/gitlab` \/ `gitlab-org\/gitaly` projects\n- `gitlab-org`\/`gitlab-com` groups\n- ...\n\n## Roll Out Steps\n\n- [x] [Read the documentation of feature flags](https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/blob\/master\/doc\/PROCESS.md#feature-flags)\n- [x] Add ~\"featureflag::staging\" to this issue ([howto](https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/blob\/master\/doc\/PROCESS.md#feature-flag-labels))\n- [x] Is the required code deployed? ([howto](https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/blob\/master\/doc\/PROCESS.md#is-the-required-code-deployed))\n- [x] Do we need to create a [change management issue](https:\/\/about.gitlab.com\/handbook\/engineering\/infrastructure\/change-management\/#feature-flags-and-the-change-management-process)? ([howto](https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/blob\/master\/doc\/PROCESS.md#do-we-need-a-change-management-issue))\n- [x] Enable on staging ([howto](https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/blob\/master\/doc\/PROCESS.md#enable-on-staging))\n- [x] Test on staging ([howto](https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/blob\/master\/doc\/PROCESS.md#test-on-staging))\n- [x] Verify the feature flag was used by checking Prometheus metric [`gitaly_feature_flag_checks_total`](https:\/\/prometheus.gstg.gitlab.net\/graph?g0.expr=sum%20by%20(flag)%20(rate(gitaly_feature_flag_checks_total%5B5m%5D))&g0.tab=1&g0.stacked=0&g0.range_input=1h)\n- [x] Announce on this issue an estimated time this will be enabled on GitLab.com\n- [x] Add ~\"featureflag::production\" to this issue\n- [x] Enable on GitLab.com by running chatops command in `#production` ([howto](https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/blob\/master\/doc\/PROCESS.md#enable-in-production))\n- [x] Cross post chatops slack command to `#support_gitlab-com` and in your team channel\n- [x] Verify the feature flag is being used by checking Prometheus metric [`gitaly_feature_flag_checks_total`](https:\/\/prometheus.gprd.gitlab.net\/graph?g0.expr=sum%20by%20(flag)%20(rate(gitaly_feature_flag_checks_total%5B5m%5D))&g0.tab=1&g0.stacked=0&g0.range_input=1h)\n- [x] Announce on the issue that the flag has been enabled\n- [x] Did you set the feature to both `100%` **and** `true` ([howto](https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/blob\/master\/doc\/PROCESS.md#enable-in-production))\n- [x] Submit a MR to have the feature `OnByDefault: true` and add changelog entry ([howto](https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/blob\/master\/doc\/PROCESS.md#feature-lifecycle-after-it-is-live))\n- [x] Have that MR merged\n- [x] Possibly wait for at least one deployment cycle ([howto](https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/blob\/master\/doc\/PROCESS.md#two-phase-ruby-to-go-rollouts))\n- [x] Submit an MR to remove the pre-feature code from the codebase and add changelog entry ([howto](https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/blob\/master\/doc\/PROCESS.md#feature-lifecycle-after-it-is-live))\n- [x] Have that MR merged\n- [x] Remove the feature flag via chatops ([howto](https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/blob\/master\/doc\/PROCESS.md#remove-the-feature-flag-via-chatops))\n- [x] Close this issue","state":"closed","created_at":1633532656913,"updated_at":1659704693617,"closed_at":1659677954515,"closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"labels":["Category:Gitaly","Stretch","devops::systems","feature flag","featureflag::production","group::gitaly","section::enablement","type::feature","workflow::verification"],"milestone":{"id":2453025,"iid":75,"group_id":9970,"title":"15.3","description":"","state":"active","created_at":"2022-02-03T22:28:50.229Z","updated_at":"2022-02-03T22:28:50.229Z","due_date":"2022-08-17","start_date":"2022-07-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/75"},"assignees":[{"id":421631,"username":"vyaklushin","name":"Vasilii Iakliushin","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/421631\/avatar.png","web_url":"https:\/\/gitlab.com\/vyaklushin"}],"author":{"id":421631,"username":"vyaklushin","name":"Vasilii Iakliushin","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/421631\/avatar.png","web_url":"https:\/\/gitlab.com\/vyaklushin"},"type":"ISSUE","assignee":{"id":421631,"username":"vyaklushin","name":"Vasilii Iakliushin","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/421631\/avatar.png","web_url":"https:\/\/gitlab.com\/vyaklushin"},"user_notes_count":7,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3817","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":21,"completed_count":21},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3817","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3817\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3817\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3817","relative":"#3817","full":"gitlab-org\/gitaly#3817"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":null},{"id":88793588,"iid":3666,"project_id":2009901,"title":"Cleanup fallback logic for gitaly-git2go binary path resolution","description":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/merge_requests\/3587 is merged and deployed on the gitlab.com.  \nIt is safe to remove [fallback logic](https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/blob\/8a6d0e26de9d584941267d2b68c94b37bc30e092\/internal\/git2go\/command.go#L31-39) to define the path to the `gitaly-git2go` binary. \n\n\/cc @zj-gitlab","state":"closed","created_at":1623833164710,"updated_at":1627575016414,"closed_at":1627575016395,"closed_by":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"labels":["Category:Gitaly","devops::create","group::gitaly","section::dev","workflow::in dev"],"milestone":{"id":1850126,"iid":62,"group_id":9970,"title":"14.2","description":"","state":"active","created_at":"2021-01-26T16:57:35.404Z","updated_at":"2021-07-22T19:45:42.498Z","due_date":"2021-08-17","start_date":"2021-07-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/62"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"}],"author":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"user_notes_count":2,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3666","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3666","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3666\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3666\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3666","relative":"#3666","full":"gitlab-org\/gitaly#3666"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":81575543,"iid":3530,"project_id":2009901,"title":"Geo: Help Praefect recover after it does an internal failover","description":"From https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3493#note_536442781:\n\n> Praefect responds with code `FailedPrecondition` and message `repository is in read-only mode`: https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/blob\/f1b141704f05163c5cf95185151570b844cc8b1c\/internal\/praefect\/coordinator.go#L33\n\n## Proposal\n\nWhen a secondary encounters this particular error while syncing, Geo should schedule the next retry at of this repository later than it usually would. For example, we could set a floor of 1 minute. And\/or we could double the calculated delay.","state":"closed","created_at":1616599628593,"updated_at":1635429501736,"closed_at":1616599648127,"closed_by":{"id":1144264,"username":"mkozono","name":"Michael Kozono","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/6243abba3cf112e6df4a5a644c5f86aa?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/mkozono"},"labels":["Enterprise Edition","GitLab Premium","devops::systems","group::geo","section::enablement","type::maintenance"],"milestone":null,"assignees":[],"author":{"id":1144264,"username":"mkozono","name":"Michael Kozono","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/6243abba3cf112e6df4a5a644c5f86aa?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/mkozono"},"type":"ISSUE","assignee":null,"user_notes_count":0,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3530","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3530","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3530\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3530\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3530","relative":"#3530","full":"gitlab-org\/gitaly#3530"},"severity":"UNKNOWN","moved_to_id":81575571.0,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":80369000,"iid":3499,"project_id":2009901,"title":"Update docs for the minimum version of Ruby to 2.7","description":"While !2633 upgrades Ruby to 2.7, docs for the minimum version of Ruby has not been updated.\n\nUpdating the docs is required.","state":"closed","created_at":1614984635388,"updated_at":1615218658084,"closed_at":1615218658020,"closed_by":{"id":660180,"username":"toon","name":"Toon Claes","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/660180\/avatar.png","web_url":"https:\/\/gitlab.com\/toon"},"labels":["Category:Gitaly","Gitaly-Ruby","Ruby","devops::create","docs-only","documentation","group::gitaly","ruby","section::dev"],"milestone":{"id":1233761,"iid":57,"group_id":9970,"title":"13.10","description":"https:\/\/about.gitlab.com\/releases\/archives.html","state":"closed","created_at":"2020-04-09T17:44:14.646Z","updated_at":"2022-04-21T07:22:00.171Z","due_date":"2021-03-17","start_date":"2021-02-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/57"},"assignees":[{"id":100770,"username":"tnir","name":"Takuya Noguchi","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/100770\/canstock6553672_288.png","web_url":"https:\/\/gitlab.com\/tnir"}],"author":{"id":100770,"username":"tnir","name":"Takuya Noguchi","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/100770\/canstock6553672_288.png","web_url":"https:\/\/gitlab.com\/tnir"},"type":"ISSUE","assignee":{"id":100770,"username":"tnir","name":"Takuya Noguchi","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/100770\/canstock6553672_288.png","web_url":"https:\/\/gitlab.com\/tnir"},"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3499","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3499","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3499\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3499\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3499","relative":"#3499","full":"gitlab-org\/gitaly#3499"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":78723064,"iid":3446,"project_id":2009901,"title":"[Gitaly] Make Ruby 3.0.x the default Ruby","description":"Part of &5149\n\nOnce we have a [Ruby 3 build for gitaly-ruby](https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3715), we actually want to switch the default Ruby over as well, which should happen as a separate step. \n\n**NOTE**: We had to roll back the Ruby 3 build due to a grpc rollback.","state":"closed","created_at":1612880087646,"updated_at":1675333802174,"closed_at":1650889151968,"closed_by":{"id":4087087,"username":"alipniagov","name":"Aleksei Lipniagov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4087087\/avatar.png","web_url":"https:\/\/gitlab.com\/alipniagov"},"labels":["Category:Gitaly","Ruby","devops::create","group::gitaly","maintenance::dependency","missed:14.0","missed:14.1","missed:14.2","missed:14.3","missed:14.4","missed:14.5","missed:14.6","missed:14.7","missed:14.8","rails6.1","ruby","section::dev","workflow::production"],"milestone":{"id":1212252,"iid":48,"group_id":9970,"title":"Next 1-3 releases","description":"Issues which are not quite ready to schedule, but should be considered as part of the near-term roadmap.","state":"active","created_at":"2020-03-26T20:39:10.889Z","updated_at":"2020-03-26T20:39:10.889Z","due_date":null,"start_date":null,"expired":false,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/48"},"assignees":[{"id":100770,"username":"tnir","name":"Takuya Noguchi","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/100770\/canstock6553672_288.png","web_url":"https:\/\/gitlab.com\/tnir"}],"author":{"id":100770,"username":"tnir","name":"Takuya Noguchi","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/100770\/canstock6553672_288.png","web_url":"https:\/\/gitlab.com\/tnir"},"type":"ISSUE","assignee":{"id":100770,"username":"tnir","name":"Takuya Noguchi","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/100770\/canstock6553672_288.png","web_url":"https:\/\/gitlab.com\/tnir"},"user_notes_count":15,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3446","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3446","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3446\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3446\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3446","relative":"#3446","full":"gitlab-org\/gitaly#3446"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":5149.0,"epic":{"id":176983,"iid":5149,"title":"Update supported Ruby version to 3.0.5","url":"\/groups\/gitlab-org\/-\/epics\/5149","group_id":9970,"human_readable_end_date":"Mar 17, 2023","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":77995430,"iid":3431,"project_id":2009901,"title":"Enable Prometheus by default","description":"Gitaly does not enable Prometheus by default, only when administrators configure the buckets. This issue proposes to have default buckets of:\n\n```\ngrpc_latency_buckets = [0.001, 0.005, 0.025, 0.1, 0.5, 1.0, 10.0, 30.0, 60.0, 300.0, 1500.0]\n```\n\nThe config value remains to override what the default value is.\n\nSee also: https:\/\/gitlab.com\/gitlab-com\/gl-infra\/infrastructure\/-\/issues\/9490#note_495908357","state":"closed","created_at":1611837248629,"updated_at":1626318465349,"closed_at":1626318465327,"closed_by":{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/228150\/avatar.png","web_url":"https:\/\/gitlab.com\/proglottis"},"labels":["Category:Gitaly","devops::create","group::gitaly","missed:13.12","missed:14.0","section::dev","workflow::in review"],"milestone":{"id":1850118,"iid":61,"group_id":9970,"title":"14.1","description":"","state":"closed","created_at":"2021-01-26T16:56:41.887Z","updated_at":"2022-04-21T07:25:22.879Z","due_date":"2021-07-17","start_date":"2021-06-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/61"},"assignees":[{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/5522960\/avatar.png","web_url":"https:\/\/gitlab.com\/samihiltunen"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"type":"ISSUE","assignee":{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/5522960\/avatar.png","web_url":"https:\/\/gitlab.com\/samihiltunen"},"user_notes_count":2,"merge_requests_count":1,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3431","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3431","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3431\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3431\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3431","relative":"#3431","full":"gitlab-org\/gitaly#3431"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":77882837,"iid":3427,"project_id":2009901,"title":"Praefect: Use millisecond precision for JSON logs time field","description":"### Problem to solve\n\nA customer [reported](https:\/\/gitlab.com\/gitlab-com\/account-management\/emea\/manomano\/-\/issues\/53) that times in Praefect logs are not standardized. Some items have millisecond precision (thanks to https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/merge_requests\/1887), but others don't.\n\nFrom the customer:\n```\nWe are trying to ingest logs on Datalog and are facing dates on logs that aren't standardized.  Example on the same file (\/var\/log\/gitlab\/praefect\/current):\n\n{\"gitaly\":15927,\"level\":\"warning\",\"msg\":\"forwarding signal\",\"signal\":23,\"time\":\"2020-12-09T15:24:49Z\",\"wrapper\":15937}\n{\"correlation_id\":\"M2qIAurFTg7\",\"grpc.code\":\"OK\",\"grpc.meta.auth_version\":\"v2\",\"grpc.meta.client_name\":\"gitlab-web\",\"grpc.meta.deadline_type\":\"regular\",\"grpc.method\":\"FindCommit\",\"grpc.request.deadline\":\"2020-12-09T14:39:10Z\",\"grpc.request.fullMethod\":\"\/gitaly.CommitService\/FindCommit\",\"grpc.service\":\"gitaly.CommitService\",\"grpc.start_time\":\"2020-12-09T14:38:41Z\",\"grpc.time_ms\":4.497,\"level\":\"info\",\"msg\":\"finished streaming call with code OK\",\"peer.address\":\"REDACTED:11670\",\"pid\":15927,\"relative_path\":\"@hashed\/e7\/f6\/REDACTED.git\",\"span.kind\":\"server\",\"system\":\"grpc\",\"time\":\"2020-12-09T14:38:41.010Z\",\"virtual_storage\":\"distributed\"}\n```\n\nNotice that the first `time` does not have millisecond precision, but the last `time` does.\n\n### Proposal\n\nPraefect log entries should have times with millisecond precision (ISO 8601.3).","state":"closed","created_at":1611683852299,"updated_at":1613169745549,"closed_at":1613072275629,"closed_by":{"id":64248,"username":"stanhu","name":"Stan Hu","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/64248\/stanhu.jpg","web_url":"https:\/\/gitlab.com\/stanhu"},"labels":["Category:Gitaly","[deprecated] Accepting merge requests","backend","devops::create","feature::enhancement","group::gitaly","section::dev","type::feature","workflow::ready for development"],"milestone":{"id":1233761,"iid":57,"group_id":9970,"title":"13.10","description":"https:\/\/about.gitlab.com\/releases\/archives.html","state":"closed","created_at":"2020-04-09T17:44:14.646Z","updated_at":"2022-04-21T07:22:00.171Z","due_date":"2021-03-17","start_date":"2021-02-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/57"},"assignees":[],"author":{"id":4512390,"username":"djensen","name":"Dan Jensen","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4512390\/avatar.png","web_url":"https:\/\/gitlab.com\/djensen"},"type":"ISSUE","assignee":null,"user_notes_count":10,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3427","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3427","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3427\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3427\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3427","relative":"#3427","full":"gitlab-org\/gitaly#3427"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2575.0,"epic":{"id":18891,"iid":2575,"title":"Standardize timestamp format in log files (epic)","url":"\/groups\/gitlab-org\/-\/epics\/2575","group_id":9970,"human_readable_end_date":"Mar 17, 2021","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":77822925,"iid":3425,"project_id":2009901,"title":"Enforce default limit for recursive calls to GetTreeEntries","description":"## Background\n\nIn some repositories with very large trees (https:\/\/gitlab.com\/gitlab-org\/gitlab\/-\/issues\/232072), recursive calls to GetTreeEntries can consume too much system resources to complete.\n\n## Proposal\n\nEnforce a default limit for the number of tree entries that can be recursively fetched by GetTreeEntries. Require an explicit override for requests that want more than the default limit.","state":"closed","created_at":1611605132034,"updated_at":1627580347637,"closed_at":1627580347619,"closed_by":{"id":64248,"username":"stanhu","name":"Stan Hu","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/64248\/stanhu.jpg","web_url":"https:\/\/gitlab.com\/stanhu"},"labels":["Application Limits","Category:Gitaly","customer","devops::create","group::gitaly","section::dev"],"milestone":null,"assignees":[],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"type":"ISSUE","assignee":null,"user_notes_count":9,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3425","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3425","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3425\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3425\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3425","relative":"#3425","full":"gitlab-org\/gitaly#3425"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":77019673,"iid":3405,"project_id":2009901,"title":"[Feature flag] Enable Go implementation of FetchSourceBranch","description":"## What\n\nEnable the `gitaly_go_fetch_source_branch` feature flag, which switches over from the Ruby implementation of FetchSourceBranch to the Go implementation. FetchSourceBranch is used \n\n- when creating merge requests across forks, FetchSourceBranch is used to get changes from the source repo into the target repo.\n- when doing cross-repository diffs.\n\nThe feature flag has been rolled out in the past but caused severe performance regressions https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2741#note_374138071. There's been some changes to mitigate those regressions and avoid needless duplication of work when objects are already contained in the target repository https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/merge_requests\/2980.\n\n## Owners\n\n- Team: Gitaly\n- Most appropriate slack channel to reach out to: `#g_create_gitaly`\n- Best individual to reach out to: @pks-t\n\n## Expectations\n\n### What release does this feature occur in first?\n\n%13.2 via f0a5bdd7f04fb2819b62ed7afd466daabf672d15, improved performance in %13.8 via f382aa9588e4c818a4a70eefe7b3a8ebf790f91c.\n\n### What are we expecting to happen?\n\nNo change in behaviour is expected. Ideally, performance metrics for `FetchSourceBranch` shouldn't change.\n\n### What might happen if this goes wrong?\n\n- Errors when creating merge requests from forks.\n- Errors when diffing across repositories.\n- Latency regresses.\n\n### What can we monitor to detect problems with this?\n\n- https:\/\/dashboards.gitlab.net\/d\/000000199\/gitaly-feature-status?var-environment=gprd&var-method=FetchSourceBranch\n\n## Roll Out Steps\n\n- [x] [Read the documentation of feature flags](https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/blob\/master\/doc\/PROCESS.md#feature-flags)\n- [x] Add ~\"featureflag::staging\" to this issue\n- [x] Is the required code deployed? ([howto](https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/blob\/master\/doc\/PROCESS.md#is-the-required-code-deployed))\n- [x] Enable on staging ([howto](https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/blob\/master\/doc\/PROCESS.md#enable-on-staging))\n- [x] Test on staging ([howto](https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/blob\/master\/doc\/PROCESS.md#test-on-staging))\n- [ ] Ensure that documentation has been updated\n- [x] Announce on this issue an estimated time this will be enabled on GitLab.com\n- [x] Add ~\"featureflag::production\" to this issue\n- [x] Enable on GitLab.com by running chatops command in `#production` ([howto](https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/blob\/master\/doc\/PROCESS.md#enable-in-production))\n- [ ] Cross post chatops slack command to `#support_gitlab-com` and in your team channel\n- [x] Announce on the issue that the flag has been enabled\n- [x] Remove feature flag and add changelog entry\n- [ ] Close this issue","state":"closed","created_at":1610366150294,"updated_at":1614158149252,"closed_at":1614158149183,"closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"labels":["Category:Gitaly","devops::create","feature flag","featureflag::production","group::gitaly","section::dev","workflow::in dev"],"milestone":{"id":1233761,"iid":57,"group_id":9970,"title":"13.10","description":"https:\/\/about.gitlab.com\/releases\/archives.html","state":"closed","created_at":"2020-04-09T17:44:14.646Z","updated_at":"2022-04-21T07:22:00.171Z","due_date":"2021-03-17","start_date":"2021-02-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/57"},"assignees":[{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"}],"author":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"type":"ISSUE","assignee":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"user_notes_count":9,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3405","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":13,"completed_count":10},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3405","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3405\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3405\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3405","relative":"#3405","full":"gitlab-org\/gitaly#3405"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":null},{"id":76044947,"iid":3381,"project_id":2009901,"title":"Remove Ruby implementation of UserUpdateSubmodule RPC","description":"Once the feature flag for the Go implementation for UserUpdateSubmodule has been removed in the previous release (https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3380), it is now a safe time to remove the old Ruby implementation.","state":"closed","created_at":1607965261257,"updated_at":1621858972348,"closed_at":1621858972327,"closed_by":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"labels":["Category:Gitaly","devops::create","group::gitaly","missed:13.10","missed:13.11","missed:13.12","missed:13.9","section::dev","workflow::in dev"],"milestone":{"id":1850113,"iid":60,"group_id":9970,"title":"14.0","description":"","state":"closed","created_at":"2021-01-26T16:55:07.714Z","updated_at":"2022-04-21T07:25:17.749Z","due_date":"2021-06-17","start_date":"2021-05-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/60"},"assignees":[{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"}],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"type":"ISSUE","assignee":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"user_notes_count":2,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3381","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3381","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3381\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3381\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3381","relative":"#3381","full":"gitlab-org\/gitaly#3381"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":76044879,"iid":3380,"project_id":2009901,"title":"Remove feature flag gitaly_go_user_update_submodule","description":"Once no issues have been found with the feature flag `gitaly_go_user_update_submodule` turned on by default, remove it.\n\nFollow up from #3290","state":"closed","created_at":1607965142672,"updated_at":1620808914389,"closed_at":1620808914337,"closed_by":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"labels":["Category:Gitaly","devops::create","group::gitaly","missed:13.8","section::dev","workflow::in dev"],"milestone":{"id":1233762,"iid":58,"group_id":9970,"title":"13.12","description":"https:\/\/about.gitlab.com\/releases\/archives.html","state":"closed","created_at":"2020-04-09T17:44:14.948Z","updated_at":"2022-04-21T07:22:18.898Z","due_date":"2021-05-17","start_date":"2021-04-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/58"},"assignees":[{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"}],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"type":"ISSUE","assignee":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"user_notes_count":1,"merge_requests_count":2,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3380","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3380","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3380\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3380\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3380","relative":"#3380","full":"gitlab-org\/gitaly#3380"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2862.0,"epic":{"id":30693,"iid":2862,"title":"\ud83c\udfcd Remove the Gitaly-Ruby sidecar","url":"\/groups\/gitlab-org\/-\/epics\/2862","group_id":9970,"human_readable_end_date":"May 17, 2023","human_readable_timestamp":"<strong>11<\/strong> days remaining"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":74220736,"iid":3288,"project_id":2009901,"title":"Logging format 'text' considered invalid","description":"When using logging format `text` for `gitaly` chart it's considered `invalid`.\nIn documentation `format` value of `[logging]` section should accept: `json` or `text`\n\n![image](\/uploads\/457e603e92498e00f4d61496126e8567\/image.png)\n\nGitaly pod logs:\n```\nroot@ip-10-2-4-231:~# kubectl logs -n gitlab gitlab-gitaly-0\n+ \/scripts\/set-config \/etc\/gitaly\/templates \/etc\/gitaly\nBegin parsing .erb files from \/etc\/gitaly\/templates\nWriting \/etc\/gitaly\/config.toml\nCopying other config files found in \/etc\/gitaly\/templates\n+ exec \/bin\/sh -c '\"\/scripts\/process-wrapper\"'\nStarting Gitaly\n\n*** \/var\/log\/gitaly\/gitaly.log ***\ntime=\"2020-11-11T19:06:22Z\" level=info msg=\"Starting Gitaly\" version=\"Gitaly, version 13.5.3\"\ntime=\"2020-11-11T19:06:22Z\" level=warning msg=\"git path not configured. Using default path resolution\" resolvedPath=\/usr\/local\/bin\/git\ntime=\"2020-11-11T19:06:22Z\" level=info msg=\"clearing disk cache object folder\" path=\/home\/git\/repositories\ntime=\"2020-11-11T19:06:22Z\" level=info msg=\"moving disk cache object folder to \/home\/git\/repositories\/+gitaly\/tmp\/diskcache085180550\" path=\/home\/git\/repositories\ntime=\"2020-11-11T19:06:22Z\" level=info msg=\"disk cache object folder doesn't exist, no need to remove\" path=\/home\/git\/repositories\ntime=\"2020-11-11T19:06:22Z\" level=info msg=\"Starting file walker for \/home\/git\/repositories\/+gitaly\/cache\" path=\/home\/git\/repositories\/+gitaly\/cache\ntime=\"2020-11-11T19:06:22Z\" level=info msg=\"Starting file walker for \/home\/git\/repositories\/+gitaly\/state\" path=\/home\/git\/repositories\/+gitaly\/state\ntime=\"2020-11-11T19:06:22Z\" level=info msg=\"cleared all cache object files in \/home\/git\/repositories\/+gitaly\/tmp\/diskcache085180550 after 4.352483ms\" path=\/home\/git\/repositories\ntime=\"2020-11-11T19:06:23Z\" level=fatal msg=\"invalid logger format\" format=text\n```\n\nLogging section for the `gitaly` ConfigMap using `text` as format:\n```\nroot@ip-10-2-4-231:~# kubectl get cm -n gitlab gitlab-gitaly -o yaml | grep 'logging' -A5\n    [logging]\n    format = \"text\"\n    dir = \"\/var\/log\/gitaly\"\n\n    [auth]\n    token = \"<%= File.read('\/etc\/gitlab-secrets\/gitaly\/gitaly_token').strip.dump[1..-2] %>\"\n```\n\n---\n\n### Normal behavior\n\nThe working logging section for the `gitaly` ConfigMap with `json` value:\n```\nroot@ip-10-2-4-231:~# kubectl get cm -n gitlab gitlab-gitaly -o yaml | grep 'logging' -A5\n    [logging]\n    format = \"json\"\n    dir = \"\/var\/log\/gitaly\"\n\n    [auth]\n    token = \"<%= File.read('\/etc\/gitlab-secrets\/gitaly\/gitaly_token').strip.dump[1..-2] %>\"\n```\n\nGitaly log when using `json` as `[logging]` value for the `format`:\n```\nroot@ip-10-2-4-231:~# kubectl logs -n gitlab gitlab-gitaly-0\n+ \/scripts\/set-config \/etc\/gitaly\/templates \/etc\/gitaly\nBegin parsing .erb files from \/etc\/gitaly\/templates\nWriting \/etc\/gitaly\/config.toml\nCopying other config files found in \/etc\/gitaly\/templates\n+ exec \/bin\/sh -c '\"\/scripts\/process-wrapper\"'\nStarting Gitaly\n\n*** \/var\/log\/gitaly\/gitaly.log ***\ntime=\"2020-11-11T19:27:11Z\" level=info msg=\"Starting Gitaly\" version=\"Gitaly, version 13.5.3\"\ntime=\"2020-11-11T19:27:11Z\" level=warning msg=\"git path not configured. Using default path resolution\" resolvedPath=\/usr\/local\/bin\/git\ntime=\"2020-11-11T19:27:11Z\" level=info msg=\"clearing disk cache object folder\" path=\/home\/git\/repositories\ntime=\"2020-11-11T19:27:11Z\" level=info msg=\"moving disk cache object folder to \/home\/git\/repositories\/+gitaly\/tmp\/diskcache451226427\" path=\/home\/git\/repositories\ntime=\"2020-11-11T19:27:11Z\" level=info msg=\"disk cache object folder doesn't exist, no need to remove\" path=\/home\/git\/repositories\ntime=\"2020-11-11T19:27:11Z\" level=info msg=\"Starting file walker for \/home\/git\/repositories\/+gitaly\/cache\" path=\/home\/git\/repositories\/+gitaly\/cache\ntime=\"2020-11-11T19:27:11Z\" level=info msg=\"Starting file walker for \/home\/git\/repositories\/+gitaly\/state\" path=\/home\/git\/repositories\/+gitaly\/state\ntime=\"2020-11-11T19:27:11Z\" level=info msg=\"cleared all cache object files in \/home\/git\/repositories\/+gitaly\/tmp\/diskcache451226427 after 4.46173ms\" path=\/home\/git\/repositories\n{\"address\":\"\/home\/git\/internal.sock\",\"level\":\"info\",\"msg\":\"listening at unix address\",\"time\":\"2020-11-11T19:27:12.101Z\"}\n{\"address\":\"0.0.0.0:8075\",\"level\":\"info\",\"msg\":\"listening at tcp address\",\"time\":\"2020-11-11T19:27:12.101Z\"}\n{\"address\":\":9236\",\"level\":\"info\",\"msg\":\"starting prometheus listener\",\"time\":\"2020-11-11T19:27:12.105Z\"}\n{\"level\":\"info\",\"msg\":\"finished tempdir cleaner walk\",\"storage\":\"default\",\"time\":\"2020-11-11T19:27:12.105Z\",\"time_ms\":6}\n{\"level\":\"info\",\"msg\":\"starting RSS monitor\",\"supervisor.name\":\"gitaly-ruby.1\",\"supervisor.rss_threshold\":209715200,\"time\":\"2020-11-11T19:27:12.106Z\"}\n{\"level\":\"info\",\"msg\":\"starting RSS monitor\",\"supervisor.name\":\"gitaly-ruby.0\",\"supervisor.rss_threshold\":209715200,\"time\":\"2020-11-11T19:27:12.106Z\"}\n{\"level\":\"warning\",\"msg\":\"spawned\",\"supervisor.args\":[\"bundle\",\"exec\",\"bin\/ruby-cd\",\"\/\",\"\/srv\/gitaly-ruby\/bin\/gitaly-ruby\",\"10\",\"\/home\/git\/ruby.1\"],\"supervisor.name\":\"gitaly-ruby.1\",\"supervisor.pid\":25,\"time\":\"2020-11-11T19:27:12.107Z\"}\n{\"level\":\"warning\",\"msg\":\"spawned\",\"supervisor.args\":[\"bundle\",\"exec\",\"bin\/ruby-cd\",\"\/\",\"\/srv\/gitaly-ruby\/bin\/gitaly-ruby\",\"10\",\"\/home\/git\/ruby.0\"],\"supervisor.name\":\"gitaly-ruby.0\",\"supervisor.pid\":26,\"time\":\"2020-11-11T19:27:12.108Z\"}\n{\"level\":\"info\",\"msg\":\"PID 26 BUNDLE_GEMFILE=\/srv\/gitaly-ruby\/Gemfile\",\"supervisor.args\":[\"bundle\",\"exec\",\"bin\/ruby-cd\",\"\/\",\"\/srv\/gitaly-ruby\/bin\/gitaly-ruby\",\"10\",\"\/home\/git\/ruby.0\"],\"supervisor.name\":\"gitaly-ruby.0\",\"time\":\"2020-11-11T19:27:12.552Z\"}\n{\"level\":\"info\",\"msg\":\"PID 25 BUNDLE_GEMFILE=\/srv\/gitaly-ruby\/Gemfile\",\"supervisor.args\":[\"bundle\",\"exec\",\"bin\/ruby-cd\",\"\/\",\"\/srv\/gitaly-ruby\/bin\/gitaly-ruby\",\"10\",\"\/home\/git\/ruby.1\"],\"supervisor.name\":\"gitaly-ruby.1\",\"time\":\"2020-11-11T19:27:12.576Z\"}\n```\n\n### Version details\n\nKubernetes, version 1.16  \nGitaly, version 13.5.3  \nGitLab, version 13.5.3  \nGitLab Cloud Native Helm chart, version 4.5.3","state":"closed","created_at":1605122928746,"updated_at":1615147728004,"closed_at":1615147727916,"closed_by":{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/228150\/avatar.png","web_url":"https:\/\/gitlab.com\/proglottis"},"labels":["Category:Gitaly","devops::create","group::gitaly","missed:13.9","priority::3","section::dev","severity::3","type::bug","workflow::in review"],"milestone":{"id":1233761,"iid":57,"group_id":9970,"title":"13.10","description":"https:\/\/about.gitlab.com\/releases\/archives.html","state":"closed","created_at":"2020-04-09T17:44:14.646Z","updated_at":"2022-04-21T07:22:00.171Z","due_date":"2021-03-17","start_date":"2021-02-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/57"},"assignees":[{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/5522960\/avatar.png","web_url":"https:\/\/gitlab.com\/samihiltunen"}],"author":{"id":3800990,"username":"valioozz","name":"Valentin Zayash","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/5496addcd1f575dd60b6a86d7aaefc55?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/valioozz"},"type":"ISSUE","assignee":{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/5522960\/avatar.png","web_url":"https:\/\/gitlab.com\/samihiltunen"},"user_notes_count":3,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3288","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3288","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3288\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3288\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3288","relative":"#3288","full":"gitlab-org\/gitaly#3288"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":74093600,"iid":3277,"project_id":2009901,"title":"Build commit graph with Bloom Filter","description":"In our monorepo, we started to observe very slow response time in `FindCommits` grpc.\n\nUser when edit Merge Requests would get timeout with the following stack trace:\n\n```\nGitlab::Git::CommandError (4:Deadline Exceeded):\n  lib\/gitlab\/git\/wraps_gitaly_errors.rb:13:in `rescue in wrapped_gitaly_errors'\n  lib\/gitlab\/git\/wraps_gitaly_errors.rb:6:in `wrapped_gitaly_errors'\n  lib\/gitlab\/git\/repository.rb:347:in `log'\n  lib\/gitlab\/git\/commit.rb:46:in `where'\n  app\/models\/repository.rb:155:in `commits'\n  lib\/gitlab\/metrics\/instrumentation.rb:161:in `block in commits'\n  lib\/gitlab\/metrics\/method_call.rb:36:in `measure'\n  lib\/gitlab\/metrics\/instrumentation.rb:161:in `commits'\n  ee\/lib\/gitlab\/authority_analyzer.rb:26:in `involved_users'\n  ee\/lib\/gitlab\/authority_analyzer.rb:15:in `calculate'\n  ee\/app\/presenters\/merge_request_approver_presenter.rb:56:in `users_from_git_log_authors'\n  ee\/app\/presenters\/merge_request_approver_presenter.rb:44:in `block in users'\n  lib\/gitlab\/utils\/strong_memoize.rb:30:in `strong_memoize'\n  ee\/app\/presenters\/merge_request_approver_presenter.rb:43:in `users'\n  ee\/app\/presenters\/merge_request_approver_presenter.rb:25:in `any?'\n  ee\/app\/views\/shared\/issuable\/_approvals.html.haml:25\n  app\/helpers\/application_helper.rb:10:in `render_if_exists'\n  app\/views\/shared\/issuable\/_form.html.haml:36\n  app\/views\/projects\/merge_requests\/_form.html.haml:3\n  app\/views\/projects\/merge_requests\/_form.html.haml:1\n  app\/views\/projects\/merge_requests\/edit.html.haml:5\n  app\/controllers\/application_controller.rb:133:in `render'\n  ee\/lib\/gitlab\/ip_address_state.rb:10:in `with'\n  ee\/app\/controllers\/ee\/application_controller.rb:44:in `set_current_ip_address'\n  app\/controllers\/application_controller.rb:497:in `set_current_admin'\n  lib\/gitlab\/session.rb:11:in `with_session'\n  app\/controllers\/application_controller.rb:488:in `set_session_storage'\n  lib\/gitlab\/i18n.rb:55:in `with_locale'\n  lib\/gitlab\/i18n.rb:61:in `with_user_locale'\n  app\/controllers\/application_controller.rb:482:in `set_locale'\n  lib\/gitlab\/error_tracking.rb:51:in `with_context'\n  app\/controllers\/application_controller.rb:547:in `sentry_context'\n  app\/controllers\/application_controller.rb:475:in `block in set_current_context'\n  lib\/gitlab\/application_context.rb:52:in `block in use'\n  lib\/gitlab\/application_context.rb:52:in `use'\n  lib\/gitlab\/application_context.rb:20:in `with_context'\n  app\/controllers\/application_controller.rb:468:in `set_current_context'\n  lib\/gitlab\/metrics\/elasticsearch_rack_middleware.rb:24:in `call'\n  lib\/gitlab\/metrics\/redis_rack_middleware.rb:22:in `call'\n  lib\/gitlab\/middleware\/rails_queue_duration.rb:29:in `call'\n  lib\/gitlab\/metrics\/rack_middleware.rb:17:in `block in call'\n  lib\/gitlab\/metrics\/transaction.rb:54:in `run'\n  lib\/gitlab\/metrics\/rack_middleware.rb:17:in `call'\n  lib\/gitlab\/request_profiler\/middleware.rb:17:in `call'\n  ee\/lib\/gitlab\/database\/load_balancing\/rack_middleware.rb:39:in `call'\n  ee\/lib\/gitlab\/jira\/middleware.rb:19:in `call'\n  lib\/gitlab\/middleware\/go.rb:20:in `call'\n  lib\/gitlab\/etag_caching\/middleware.rb:13:in `call'\n  lib\/gitlab\/middleware\/multipart.rb:125:in `call'\n  lib\/gitlab\/middleware\/read_only\/controller.rb:51:in `call'\n  lib\/gitlab\/middleware\/read_only.rb:18:in `call'\n  lib\/gitlab\/middleware\/same_site_cookies.rb:27:in `call'\n  lib\/gitlab\/middleware\/basic_health_check.rb:25:in `call'\n  lib\/gitlab\/middleware\/handle_ip_spoof_attack_error.rb:25:in `call'\n  lib\/gitlab\/middleware\/request_context.rb:23:in `call'\n  config\/initializers\/fix_local_cache_middleware.rb:9:in `call'\n  lib\/gitlab\/metrics\/requests_rack_middleware.rb:60:in `call'\n  lib\/gitlab\/middleware\/release_env.rb:12:in `call'\n```\n\nWhat this is suggesting is that https:\/\/gitlab.com\/gitlab-org\/gitlab\/-\/blob\/v13.3.8-ee\/ee\/lib\/gitlab\/authority_analyzer.rb#L26 is being called and get timeout by Gitaly.\n\nI suspect this is because in a big monorepo, `git log -- <file_path>` could be very slow as reasons indicated in https:\/\/devblogs.microsoft.com\/devops\/super-charging-the-git-commit-graph-iv-bloom-filters\/\n\nThe solution here is to build the commit-graph with Bloom filter included by adding `--changed-paths` to `git commit-graph write`. I have a draft solution in https:\/\/gitlab.com\/sluongng\/gitaly\/-\/commit\/78dba8b73e720b11500482b19b755346ec853025 that need to be developed into a full fledged solution.","state":"closed","created_at":1604933810787,"updated_at":1634729825180,"closed_at":1621407208709,"closed_by":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"labels":["Category:Gitaly","Gitaly","customer","devops::create","group::gitaly","missed:13.9","section::dev","workflow::in dev"],"milestone":{"id":1850113,"iid":60,"group_id":9970,"title":"14.0","description":"","state":"closed","created_at":"2021-01-26T16:55:07.714Z","updated_at":"2022-04-21T07:25:17.749Z","due_date":"2021-06-17","start_date":"2021-05-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/60"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"}],"author":{"id":1418515,"username":"sluongng","name":"Son Luong Ngoc","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/1418515\/avatar.png","web_url":"https:\/\/gitlab.com\/sluongng"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"user_notes_count":17,"merge_requests_count":4,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3277","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3277","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3277\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3277\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3277","relative":"#3277","full":"gitlab-org\/gitaly#3277"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":73848356,"iid":3265,"project_id":2009901,"title":"Fix  resolving Praefect address in mixed-TLS deployments","description":"In deployements where Gitaly and Praefect have different TLS configurations, we may fail to correctly resolve injected Praefect addresses. The root cause is that in `resolvePraefectAddress`, we decide how to resolve the peer address by inspecting the incoming TCP connection: if it is unencrypted, we dial back with an unencrypted connection. If it is encrypted, we dial back with an encrypted connection. This doesn't make a lot of sense though, as we're deciding how to dial back depending on how we're reachable ourselves as a Gitaly node. We really shouldn't care for that and instead only go by the injected information we got.","state":"closed","created_at":1604483463416,"updated_at":1608142050547,"closed_at":1608142022490,"closed_by":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"labels":["Category:Gitaly","[deprecated] Accepting merge requests","devops::create","group::gitaly","priority::3","section::dev","severity::3","type::bug"],"milestone":{"id":1233760,"iid":56,"group_id":9970,"title":"13.9","description":"https:\/\/about.gitlab.com\/releases\/archives.html","state":"closed","created_at":"2020-04-09T17:44:14.334Z","updated_at":"2022-04-21T07:21:28.468Z","due_date":"2021-02-17","start_date":"2021-01-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/56"},"assignees":[],"author":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"type":"ISSUE","assignee":null,"user_notes_count":6,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3265","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3265","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3265\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3265\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3265","relative":"#3265","full":"gitlab-org\/gitaly#3265"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":73819963,"iid":3262,"project_id":2009901,"title":"Praefect should only dial to Gitaly for transactions","description":"For transactions, we require that Gitaly dials back to Praefect in order to vote on transactions. This introduces a few problems:\n\n- Gitaly is not configured with Praefect's security token. Praefect must send call-back information, including security token, to Gitaly for all transaction related calls.\n- It is not clear to customers how this dial back requirement affects supported network topologies for GitLab deployments. Sometimes, Praefect may be behind a load balancer or NAT. Being able to dial back to Praefect is not always desirable.\n\nHowever, Praefect is already configured with the Gitaly node security tokens and it is clear that Praefect must be able to reach individual Gitalies on the network. Therefore, it would be more robust to have Praefect initiate the gRPC call to Gitaly for all transaction votes. This would free Gitaly from needing to know network and security details for Praefect since Praefect is already a trusted client of Gitaly.","state":"closed","created_at":1604430984161,"updated_at":1627306499341,"closed_at":1620108447178,"closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"labels":["Category:Gitaly","Deliverable","GitLab Premium","customer","devops::create","direction","group::gitaly","group::gitaly::cluster","priority::2","section::dev","security","severity::4","type::feature","workflow::in dev"],"milestone":{"id":1233762,"iid":58,"group_id":9970,"title":"13.12","description":"https:\/\/about.gitlab.com\/releases\/archives.html","state":"closed","created_at":"2020-04-09T17:44:14.948Z","updated_at":"2022-04-21T07:22:18.898Z","due_date":"2021-05-17","start_date":"2021-04-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/58"},"assignees":[{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/5522960\/avatar.png","web_url":"https:\/\/gitlab.com\/samihiltunen"}],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"type":"ISSUE","assignee":{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/5522960\/avatar.png","web_url":"https:\/\/gitlab.com\/samihiltunen"},"user_notes_count":20,"merge_requests_count":2,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3262","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3262","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3262\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3262\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3262","relative":"#3262","full":"gitlab-org\/gitaly#3262"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1189.0,"epic":{"id":5989,"iid":1189,"title":"Gitaly Cluster: strong consistency","url":"\/groups\/gitlab-org\/-\/epics\/1189","group_id":9970,"human_readable_end_date":"Sep 17, 2021","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":73721249,"iid":3255,"project_id":2009901,"title":"Improve input validation of hook inputs","description":"The ported UserMergeBranch RPC caused pipelines to not get triggered in production anymore. The root cause was that the PostReceive hook was executed with empty input, where it should've contained a list of all updated references. As a result, the hook pretended no changes existed and thus no pipelines had to be triggered.\n\nThis error was hard to diagnose via logs or metrics as this is essentially about the absence of something. If we had stricter input verification in our hooks (e.g. expecting at least one change to exist), then the issue might've been a lot more visible and thus caught earlier.","state":"closed","created_at":1604307749619,"updated_at":1606901292406,"closed_at":1606901292321,"closed_by":{"id":1424505,"username":"avar","name":"\u00c6var Arnfj\u00f6r\u00f0 Bjarmason","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/4edaf21e9ad2d357c90aa62eb752f302?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/avar"},"labels":["Category:Gitaly","Stretch","corrective action","devops::create","group::gitaly","section::dev"],"milestone":{"id":1233757,"iid":54,"group_id":9970,"title":"13.7","description":"https:\/\/about.gitlab.com\/releases\/archives.html","state":"closed","created_at":"2020-04-09T17:43:14.893Z","updated_at":"2022-04-13T14:51:12.240Z","due_date":"2020-12-17","start_date":"2020-11-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/54"},"assignees":[{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"}],"author":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"type":"ISSUE","assignee":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"user_notes_count":2,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3255","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3255","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3255\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3255\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3255","relative":"#3255","full":"gitlab-org\/gitaly#3255"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":73263830,"iid":3231,"project_id":2009901,"title":"Add FetchSHA abstraction to LocalRepository","description":"Originally reported in https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/merge_requests\/2693#note_435231130\n\nFetching a single SHA is done in multiple places across Gitaly and is very verbose and error prone. Having a definitive and easy to use function will improve our code quality. Adding a new method `FetchSHA` to `localrepo` could enable this.","state":"closed","created_at":1603476329240,"updated_at":1635429910022,"closed_at":1627883269620,"closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"labels":["Category:Gitaly","[deprecated] good for new contributors","devops::create","group::gitaly","maintenance::refactor","missed:13.10","missed:13.11","missed:13.12","missed:13.9","missed:14.0","section::dev","type::maintenance","workflow::planning breakdown"],"milestone":{"id":1850126,"iid":62,"group_id":9970,"title":"14.2","description":"","state":"active","created_at":"2021-01-26T16:57:35.404Z","updated_at":"2021-07-22T19:45:42.498Z","due_date":"2021-08-17","start_date":"2021-07-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/62"},"assignees":[{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"}],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"type":"ISSUE","assignee":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"user_notes_count":4,"merge_requests_count":2,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3231","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3231","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3231\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3231\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3231","relative":"#3231","full":"gitlab-org\/gitaly#3231"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":73262492,"iid":3230,"project_id":2009901,"title":"Inject single client connection pool from main to all Gitaly services","description":"Currently, each service instantiates their own client pool for use in dialing across Gitalies. To improve performance by reducing connection dialing, the same pool should be used everywhere. This ideally should be dependency injected from the main module.\n\nOriginally reported in https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/merge_requests\/2693#note_435231124","state":"closed","created_at":1603473744021,"updated_at":1642748905495,"closed_at":1642748905480,"closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"labels":["Category:Gitaly","[deprecated] good for new contributors","bug::performance","devops::create","group::gitaly","section::dev"],"milestone":null,"assignees":[],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"type":"ISSUE","assignee":null,"user_notes_count":6,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3230","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3230","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3230\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3230\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3230","relative":"#3230","full":"gitlab-org\/gitaly#3230"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":73256843,"iid":3229,"project_id":2009901,"title":"Enable verbose logging of git2go subcommands","description":"Currently, git2go subcommands contain very complex logic for various tasks (e.g. squashing commits\/resolving conflicts\/commiting multiple changes). The subcommands lack observability since STDERR is used to return error messages. An alternative file descriptor should be used to allow git2go commands to relay back fine grain logs. When a git2go command exits with non-zero, or the logging level is set to a certain level, these fine grain logs should be emitted.","state":"closed","created_at":1603468368949,"updated_at":1649032241741,"closed_at":1649032241721,"closed_by":{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/228150\/avatar.png","web_url":"https:\/\/gitlab.com\/proglottis"},"labels":["Category:Gitaly","Observability","devops::create","group::gitaly","missed:14.7","priority::3","section::dev","severity::4","type::maintenance","workflow::in dev"],"milestone":{"id":2204142,"iid":72,"group_id":9970,"title":"14.10","description":"","state":"active","created_at":"2021-08-26T19:12:33.701Z","updated_at":"2021-08-26T19:12:33.701Z","due_date":"2022-04-17","start_date":"2022-03-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/72"},"assignees":[{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/228150\/avatar.png","web_url":"https:\/\/gitlab.com\/proglottis"}],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"type":"ISSUE","assignee":{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/228150\/avatar.png","web_url":"https:\/\/gitlab.com\/proglottis"},"user_notes_count":9,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3229","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3229","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3229\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3229\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3229","relative":"#3229","full":"gitlab-org\/gitaly#3229"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":73184079,"iid":3221,"project_id":2009901,"title":"Refactor NewFeatureSets to remove unused error return value","description":"The test helper function `NewFeatureSets` is not capable of returning a non-nil error. The helper should be fixed to never return an error and all affected code locations should be updated to accept a single return value. Any error assertions for that function call should be removed.\n\nThe function is defined here: https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/blob\/master\/internal\/testhelper\/testhelper.go#L959-980","state":"closed","created_at":1603384783750,"updated_at":1604555133269,"closed_at":1604555133237,"closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"labels":["Category:Gitaly","[deprecated] good for new contributors","devops::create","group::gitaly","section::dev"],"milestone":null,"assignees":[],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"type":"ISSUE","assignee":null,"user_notes_count":3,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3221","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3221","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3221\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3221\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3221","relative":"#3221","full":"gitlab-org\/gitaly#3221"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":72835557,"iid":3211,"project_id":2009901,"title":"GIT_DIR missing in hook environment","description":"### Summary\n\nAs reported in https:\/\/gitlab.com\/gitlab-org\/gitlab\/-\/issues\/258828, the `$GIT_DIR` is not present anymore in the environment for custom server hooks.\n\nI was able to reproduce by following the instructions at https:\/\/docs.gitlab.com\/ee\/administration\/server_hooks.html#create-a-global-server-hook-for-all-repositories. The `$GIT_DIR` variable is not set at all for any of the `pre-receive`, `post-receive`, and `update` hooks (this was on a normal project code repository, I assume the same applies for other repository types).\n\nThis seems related to recent work to port the hooks from Ruby to Go. I can see the variable was set in the Ruby code at https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/blob\/dfd9c3e1a79f6a222b742b1978e45785b06a9440\/ruby\/lib\/gitlab\/git\/hook.rb#L133.\n\n### Proposal\n\n`$GIT_DIR` is not explicitly documented at https:\/\/docs.gitlab.com\/ee\/administration\/server_hooks.html#environment-variables, but for compatibility reasons we probably want to keep supporting it, and should also document this.\n\nWe might also want to double-check that we're not missing any of the other variables that were set in the previous Ruby code: https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/blob\/dfd9c3e1a79f6a222b742b1978e45785b06a9440\/ruby\/lib\/gitlab\/git\/hook.rb#L118-138","state":"closed","created_at":1602853167421,"updated_at":1608263075778,"closed_at":1608263075728,"closed_by":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"labels":["Category:Gitaly","devops::create","group::gitaly","priority::3","section::dev","severity::3","type::bug","workflow::in review"],"milestone":{"id":1233759,"iid":55,"group_id":9970,"title":"13.8","description":"https:\/\/about.gitlab.com\/releases\/archives.html","state":"closed","created_at":"2020-04-09T17:44:13.983Z","updated_at":"2022-04-13T14:51:23.220Z","due_date":"2021-01-17","start_date":"2020-12-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/55"},"assignees":[{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"}],"author":{"id":423116,"username":"toupeira","name":"Markus Koller","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/7585ed50675c4febe7619f25b44f7fe0?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/toupeira"},"type":"ISSUE","assignee":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"user_notes_count":8,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3211","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3211","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3211\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3211\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3211","relative":"#3211","full":"gitlab-org\/gitaly#3211"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":72770726,"iid":3206,"project_id":2009901,"title":"Follow-up from \"Pass correlation_id over to gitaly-ssh\"","description":"The following discussion from !2530 should be addressed:\n\n- [ ] @ash2k started a [discussion](https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/merge_requests\/2530#note_428727639):  (+3 comments)\n\n    > @8bitlife \n    > \n    > Just discovered that these interceptors have been added. I understand the motivation but now I cannot customize neither of those interceptors:\n    > \n    > - For the tracing one I'd like to inject a custom `Tracer` by using `grpc_opentracing.UnaryClientInterceptor(grpc_opentracing.WithTracer())` directly, not via LabKit (see the discussion here https:\/\/gitlab.com\/gitlab-org\/labkit\/-\/merge_requests\/66)\n    > - For the correlation one I'd like to set the client name like that `grpccorrelation.StreamClientCorrelationInterceptor(grpccorrelation.WithClientName(\"kas\"))` as suggested here https:\/\/gitlab.com\/gitlab-com\/gl-infra\/readiness\/-\/merge_requests\/46#note_428087602 by @jacobvosmaer-gitlab.\n    > \n    > I have looked at the code and both Workhorse are Shell add these interceptors to the client:\n    > \n    > - Workhorse: https:\/\/gitlab.com\/gitlab-org\/gitlab-workhorse\/-\/blob\/master\/internal\/gitaly\/gitaly.go#L158-173 As you can see, it sets client name there.\n    > - Shell: https:\/\/github.com\/gitlabhq\/gitlab-shell\/blob\/master\/internal\/handler\/exec.go#L112-L120 Also sets the name but is missing the tracing interceptor (maybe intentionally).\n    > \n    > So the current behavior is not ideal - two traces\/spans from the same place (right?) and redundant context creation because the correlating interceptor is executed twice (so it adds the correlation ID twice).\n    > \n    > p.s. another bug that I've noticed is that `connOpts` is mutated. It's not safe to append to a slice that has been passed as the caller likely assumes that the method is not mutating it. The slice might have larger capacity and so this method will mutate the original backing array. The code should copy it first.\n    > \n    > p.p.s. It might be nicer to change the signature to varargs to match `grpc.Dial()` and all the other places where we take functional options. This will also address the bug ^.\n\n@8bitlife @zj-gitlab","state":"closed","created_at":1602763470346,"updated_at":1661960157883,"closed_at":1661960157696,"closed_by":{"id":2578846,"username":"wchandler","name":"Will Chandler","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/cc8b92738249753faee7055e021f8221?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/wchandler"},"labels":["Category:Gitaly","auto updated","devops::systems","group::gitaly","section::enablement","severity::4","type::bug","vintage"],"milestone":{"id":2453026,"iid":76,"group_id":9970,"title":"15.4","description":"[GitLab 15.4 Release](https:\/\/gitlab.com\/gitlab-org\/gitlab\/-\/releases\/v15.4.0-ee)","state":"active","created_at":"2022-02-03T22:29:22.015Z","updated_at":"2022-09-29T02:21:26.561Z","due_date":"2022-09-17","start_date":"2022-08-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/76"},"assignees":[{"id":4855585,"username":"ash2k","name":"Mikhail Mazurskiy","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/a3161684bd29f5016064a6c16ccd3bc7?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/ash2k"}],"author":{"id":4855585,"username":"ash2k","name":"Mikhail Mazurskiy","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/a3161684bd29f5016064a6c16ccd3bc7?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/ash2k"},"type":"ISSUE","assignee":{"id":4855585,"username":"ash2k","name":"Mikhail Mazurskiy","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/a3161684bd29f5016064a6c16ccd3bc7?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/ash2k"},"user_notes_count":4,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3206","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":1,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3206","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3206\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3206\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3206","relative":"#3206","full":"gitlab-org\/gitaly#3206"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":null},{"id":72578977,"iid":3196,"project_id":2009901,"title":"Intercept CreateRepository in Praefect to set up repository database state","description":"Currently we do not have a record of every repository a virtual storage is supposed to contain. This will change with #3033. We should intercept `CreateRepository` calls and set up the expected database records a repository should have. Related to #3133, we should select a primary for the repository when it is created. Related to #2971, we should select the nodes that will host the repository when it is created. Additionally, we can make generation related queries stricter once we can expect every repository to be present in the database and not allow for example incrementing generation of a repository that does not exist. Stricter queries prevent certain class of errors, such as https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3183, and make the logic simpler as we don't have to handle cases where the records are missing.","state":"closed","created_at":1602508236865,"updated_at":1612346550862,"closed_at":1612346550814,"closed_by":{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/5522960\/avatar.png","web_url":"https:\/\/gitlab.com\/samihiltunen"},"labels":["Category:Gitaly","GitLab Premium","Gitaly","devops::create","group::gitaly","group::gitaly::cluster","missed:13.6","section::dev","workflow::in dev"],"milestone":{"id":1233760,"iid":56,"group_id":9970,"title":"13.9","description":"https:\/\/about.gitlab.com\/releases\/archives.html","state":"closed","created_at":"2020-04-09T17:44:14.334Z","updated_at":"2022-04-21T07:21:28.468Z","due_date":"2021-02-17","start_date":"2021-01-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/56"},"assignees":[{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/228150\/avatar.png","web_url":"https:\/\/gitlab.com\/proglottis"}],"author":{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/5522960\/avatar.png","web_url":"https:\/\/gitlab.com\/samihiltunen"},"type":"ISSUE","assignee":{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/228150\/avatar.png","web_url":"https:\/\/gitlab.com\/proglottis"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3196","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3196","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3196\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3196\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3196","relative":"#3196","full":"gitlab-org\/gitaly#3196"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":3372.0,"epic":{"id":56824,"iid":3372,"title":"\ud83e\ude81 Gitaly Clusters variable replication factor","url":"\/groups\/gitlab-org\/-\/epics\/3372","group_id":9970,"human_readable_end_date":"Feb 17, 2022","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":72555029,"iid":3195,"project_id":2009901,"title":"UserMerge RPC should error with FailedPrecondition on merge conflicts","description":"### Problem\n\nWhen a user merges a branch while it can't be merged, the Gitaly service will detect this, and return an error. This error is an Unknown error currently, which is surprising to operators of Gitaly. Additionally, the error is wrong as the why of the error is known.\n\nLast reason it should be another error, is that Unknown influences SL{A,O}s. Though it shouldn't.\n\n### Solution\n\nGitaly should return a FailedPrecondition when it can't be merged due to conflicts.","state":"closed","created_at":1602488474651,"updated_at":1635429961020,"closed_at":1627554315258,"closed_by":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"labels":["Category:Gitaly","devops::create","group::gitaly","missed:13.11","missed:13.12","missed:14.0","priority::4","section::dev","severity::4","type::maintenance","workflow::in dev"],"milestone":{"id":1850126,"iid":62,"group_id":9970,"title":"14.2","description":"","state":"active","created_at":"2021-01-26T16:57:35.404Z","updated_at":"2021-07-22T19:45:42.498Z","due_date":"2021-08-17","start_date":"2021-07-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/62"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"user_notes_count":4,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3195","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3195","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3195\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3195\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3195","relative":"#3195","full":"gitlab-org\/gitaly#3195"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":72076407,"iid":3182,"project_id":2009901,"title":"Replace BurntSushi\/toml package","description":"Gitaly uses TOML for configuration, and parsing is done with `github.com\/BurntSushi\/toml`. That package has gone unmaintained and while TOML is stable, Gitaly should depend on a new package  which is supported.","state":"closed","created_at":1601641620182,"updated_at":1635429987788,"closed_at":1602505489937,"closed_by":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"labels":["Category:Gitaly","devops::create","group::gitaly","section::dev","type::maintenance"],"milestone":{"id":1233754,"iid":52,"group_id":9970,"title":"13.5","description":"https:\/\/about.gitlab.com\/releases\/2020\/10\/22\/gitlab-13-5-released\/","state":"closed","created_at":"2020-04-09T17:39:21.990Z","updated_at":"2022-04-21T07:21:12.213Z","due_date":"2020-10-17","start_date":"2020-09-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/52"},"assignees":[],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"type":"ISSUE","assignee":null,"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3182","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3182","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3182\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3182\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3182","relative":"#3182","full":"gitlab-org\/gitaly#3182"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":72050561,"iid":3181,"project_id":2009901,"title":"CreateRepositoryFromSnapshot will fail with error 'Promoting temporary directory failed' if parent directories of target path do not already exist","description":"If `CreateRepositoryFromSnapshot` is called when the parent directory of the target path does not exist, the request will fail with error:\n\n```\nrpc error: code = Internal desc = Promoting temporary directory failed: rename \/var\/opt\/gitlab\/git-data\/repositories\/+gitaly\/tmp\/repo446863582 \/var\/opt\/gitlab\/git-data\/repositories\/@geo-temporary\/@hashed\/\n19\/58\/19581e27de7ced00ff1ce50b2047e7a567c76b1cbaebabe5ef03f7c3017bb5b7.git: no such file or directory\n```\n\nStracing this, we find that the `renameat` call fails with ENOENT:\n\n```\n18192 22:01:24.772985 renameat(AT_FDCWD, \"\/var\/opt\/gitlab\/git-data\/repositories\/+gitaly\/tmp\/repo446863582\", AT_FDCWD, \"\/var\/opt\/gitlab\/git-data\/repositories\/@ge\no-temporary\/@hashed\/19\/58\/19581e27de7ced00ff1ce50b2047e7a567c76b1cbaebabe5ef03f7c3017bb5b7.git\") = -1 ENOENT (No such file or directory) <0.000013>\n```\n\nGenerally this RPC is only called on a second attempt to create a repository, so the directory has already been created, but due to https:\/\/gitlab.com\/gitlab-org\/gitlab\/-\/issues\/9803#note_422414267 these calls were the first attempt, exposing this issue.\n\n`ReplicateRepository` will [ensure the directories are present](https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/blob\/d76d10b540d474d950103aa3303a89a9aad9dd88\/internal\/gitaly\/service\/repository\/replicate.go#L142-144) before renaming the tmp directory, we should do the same in [this RPC](https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/blob\/d76d10b540d474d950103aa3303a89a9aad9dd88\/internal\/gitaly\/service\/repository\/create_from_snapshot.go#L106-112).","state":"closed","created_at":1601604135948,"updated_at":1603726693244,"closed_at":1603726693153,"closed_by":{"id":660180,"username":"toon","name":"Toon Claes","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/660180\/avatar.png","web_url":"https:\/\/gitlab.com\/toon"},"labels":["Category:Gitaly","devops::create","group::gitaly","section::dev","severity::3","type::bug","workflow::ready for development"],"milestone":{"id":1233755,"iid":53,"group_id":9970,"title":"13.6","description":"https:\/\/about.gitlab.com\/releases\/2020\/11\/22\/gitlab-13-6-released\/","state":"closed","created_at":"2020-04-09T17:39:22.328Z","updated_at":"2022-04-13T14:51:04.376Z","due_date":"2020-11-17","start_date":"2020-10-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/53"},"assignees":[{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/5522960\/avatar.png","web_url":"https:\/\/gitlab.com\/samihiltunen"}],"author":{"id":2578846,"username":"wchandler","name":"Will Chandler","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/cc8b92738249753faee7055e021f8221?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/wchandler"},"type":"ISSUE","assignee":{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/5522960\/avatar.png","web_url":"https:\/\/gitlab.com\/samihiltunen"},"user_notes_count":2,"merge_requests_count":1,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3181","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3181","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3181\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3181\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3181","relative":"#3181","full":"gitlab-org\/gitaly#3181"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":71993240,"iid":3177,"project_id":2009901,"title":"Gitaly module version cannot be updated in gitlab-workhorse and gitlab-shell","description":"On a clean Go v1.15.2 installation, I get this while trying to update the Gitaly module in gitlab-workhorse and gitlab-shell:\n\n```\n$  go get -u gitlab.com\/gitlab-org\/gitaly@v13.5.0-rc1\ngo: downloading gitlab.com\/gitlab-org\/gitaly v0.0.0-20201001041716-3f5e218def93\ngo: gitlab.com\/gitlab-org\/gitaly v13.5.0-rc1 => v0.0.0-20201001041716-3f5e218def93\ncat go.mod\ngo get: inconsistent versions:\n\tgitlab.com\/gitlab-org\/gitaly@v0.0.0-20201001041716-3f5e218def93 from gitlab.com\/gitlab-org\/gitaly@v13.5.0-rc1 requires gitlab.com\/gitlab-org\/gitaly@v1.68.0 (not gitlab.com\/gitlab-org\/gitaly@v0.0.0-20201001041716-3f5e218def93 from gitlab.com\/gitlab-org\/gitaly@v13.5.0-rc1)\n```\n\nAccording to https:\/\/github.com\/golang\/go\/issues\/35732 and https:\/\/golang.org\/cmd\/go\/#hdr-Module_compatibility_and_semantic_versioning, this is because Go is trying to enforce semantic compatibility:\n\n>>>\nIn semantic versioning, changing the major version number indicates a lack of backwards compatibility with earlier versions. To preserve import compatibility, the go command requires that modules with major version v2 or later use a module path with that major version as the final element. For example, version v2.0.0 of example.com\/m must instead use module path example.com\/m\/v2, and packages in that module would use that path as their import path prefix, as in example.com\/m\/v2\/sub\/pkg. Including the major version number in the module path and import paths in this way is called \"semantic import versioning\". Pseudo-versions for modules with major version v2 and later begin with that major version instead of v0, as in v2.0.0-20180326061214-4fc5987536ef. \n>>>\n\nI think this is saying that Gitaly should be using `m\/v13` in the module path.\n\nA workaround may be to tag another v1 tag with the latest master:\n\n>>>\nCode written before the semantic import versioning convention was introduced may use major versions v2 and later to describe the same set of unversioned import paths as used in v0 and v1. To accommodate such code, if a source code repository has a v2.0.0 or later tag for a file tree with no go.mod, the version is considered to be part of the v1 module's available versions and is given an +incompatible suffix when converted to a module version, as in v2.0.0+incompatible. The +incompatible tag is also applied to pseudo-versions derived from such versions, as in v2.0.1-0.yyyymmddhhmmss-abcdefabcdef+incompatible. \n>>>\n\nv1.87.0 was tagged in February 2020, and then we switched versioning schemes.\n\n@pokstad1 @samihiltunen What do you think we should do here?","state":"closed","created_at":1601532692689,"updated_at":1651462216223,"closed_at":1623155905864,"closed_by":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"labels":["Category:Gitaly","auto updated","devops::create","group::gitaly","missed:13.10","missed:13.11","section::dev","workflow::in dev"],"milestone":{"id":1850113,"iid":60,"group_id":9970,"title":"14.0","description":"","state":"closed","created_at":"2021-01-26T16:55:07.714Z","updated_at":"2022-04-21T07:25:17.749Z","due_date":"2021-06-17","start_date":"2021-05-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/60"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"}],"author":{"id":64248,"username":"stanhu","name":"Stan Hu","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/64248\/stanhu.jpg","web_url":"https:\/\/gitlab.com\/stanhu"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"user_notes_count":12,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3177","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3177","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3177\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3177\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3177","relative":"#3177","full":"gitlab-org\/gitaly#3177"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":71984925,"iid":3175,"project_id":2009901,"title":"Repository updates intermittently disappear on busy repos hosted on NFS mount shared by multiple Gitaly servers","description":"Issue is occurring on a large customer with three Gitaly nodes sharing an NFS mount behind a load balancer, appearing to be a single storage to rails.\n\nAfter upgrading to v13.3.2 several weeks ago users on several high-traffic projects on their instance have reported recently merged changes disappearing.  No errors are received when merging, but when they check the updated file at a later time the change is not present.  They had no reports of this issue when on v12.10.\n\nThis may be the same underlying issue as #2589.\n\nLooking at a specific example, we found a GC had been running on a separate Gitaly host during the a `UserMergeBranch` was executed.  The GC reported the following error:\n\n```\n{\n  \"correlation_id\": \"GPhidQI0kw9\",\n  \"grpc.meta.auth_version\": \"v2\",\n  \"grpc.meta.client_name\": \"gitlab-sidekiq\",\n  \"grpc.meta.deadline_type\": \"unknown\",\n  \"grpc.method\": \"GarbageCollect\",\n  \"grpc.request.deadline\": \"2020-09-29T12:49:23Z\",\n  \"grpc.request.fullMethod\": \"\/gitaly.RepositoryService\/GarbageCollect\",\n  \"grpc.request.glProjectPath\": \"services\/crm\/Lightning\/lightning-service\/service\",\n  \"grpc.request.glRepository\": \"project-3515\",\n  \"grpc.request.repoPath\": \"services\/crm\/Lightning\/lightning-service\/service.git\",\n  \"grpc.request.repoStorage\": \"default\",\n  \"grpc.request.topLevelGroup\": \"services\",\n  \"grpc.service\": \"gitaly.RepositoryService\",\n  \"grpc.start_time\": \"2020-09-29T06:49:23Z\",\n  \"level\": \"error\",\n  \"msg\": \"warning: garbage found: \/var\/opt\/gitlab-data\/git-data\/repositories\/group\/project\/objects\/pack\/.nfs0000000002e6ff1b0002d23a\nwarning: garbage found: \/var\/opt\/gitlab-data\/git-data\/repositories\/group\/project.git\/objects\/pack\/.nfs0000000002e6a8590002d236\nwarning: garbage found: \/var\/opt\/gitlab-data\/git-data\/repositories\/group\/project.git\/objects\/pack\/.nfs0000000002e74aa30002d237\nwarning: garbage found: \/var\/opt\/gitlab-data\/git-data\/repositories\/group\/project.git\/objects\/pack\/.nfs0000000002b239f50002d238\nwarning: garbage found: \/var\/opt\/gitlab-data\/git-data\/repositories\/group\/project.git\/objects\/pack\/.nfs0000000002bf55ea0002d234\",\n  \"peer.address\": \"10.143.238.127:20084\",\n  \"pid\": 16719,\n  \"span.kind\": \"server\",\n  \"system\": \"grpc\",\n  \"time\": \"2020-09-29T06:50:44.402Z\"\n}\n```\n\nThese `.nfs...` files indicate that a file with an open file handle against it was deleted.  NFS will perform a [silly rename](http:\/\/nfs.sourceforge.net) when this occurs, renaming the file to the `.nfs...` format and keeping it on disk until the file handle is released. This suggests that something is deleting pack files out from under another process, though which specific processes are unclear.\n\nIn addition, we see intermittent `rpc error: code = Unknown desc = Rugged::OSError: failed to read descriptor: Stale file handle` messages on multiple Gitaly-Ruby RPCs.  In these cases the request fails, so no data loss occurs.\n\nCurrent NFS mount settings on Gitaly nodes:\n\n```\nnfs4 (rw,relatime,vers=4.1,rsize=262144,wsize=262144,namlen=255,hard,proto=tcp,timeo=600,retrans=2,sec=sys,clientaddr=10.182.169.125,local_lock=none)\n```\n\nNote that the customer will be adding `lookupcache=positive` to their settings at their earliest opportunity.\n\n\/cc @pokstad1 @cnightingale @bprescott\\_","state":"closed","created_at":1601519661181,"updated_at":1679335475181,"closed_at":1604523190230,"closed_by":{"id":2578846,"username":"wchandler","name":"Will Chandler","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/cc8b92738249753faee7055e021f8221?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/wchandler"},"labels":["Category:Gitaly","[deprecated] Accepting merge requests","customer","devops::create","group::gitaly","priority::3","section::dev","severity::2","type::bug"],"milestone":{"id":490705,"iid":14,"group_id":9970,"title":"Backlog","description":"Issues that we want to do but are not planned right now. Open for contribution from the community.","state":"active","created_at":"2018-03-22T13:09:23.767Z","updated_at":"2018-10-30T14:56:54.069Z","due_date":null,"start_date":null,"expired":false,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/14"},"assignees":[],"author":{"id":2578846,"username":"wchandler","name":"Will Chandler","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/cc8b92738249753faee7055e021f8221?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/wchandler"},"type":"ISSUE","assignee":null,"user_notes_count":9,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3175","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3175","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3175\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3175\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3175","relative":"#3175","full":"gitlab-org\/gitaly#3175"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":71737554,"iid":3160,"project_id":2009901,"title":"Gitaly HTTP client should specify TLSClientConfig to support mutual TLS auth","description":"Gitaly currently doesn't specify a TLSClientConfig for the HTTP client used to make requests to the GitLab internal API. This prevents interoperation with services that require mutual TLS auth (e.g. nginx). The non-gRPC clients in Gitaly should be updated to use the configured Gitaly certificates for client connections.","state":"closed","created_at":1601137065626,"updated_at":1628517467757,"closed_at":1605637494226,"closed_by":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"labels":["Category:Gitaly","Deliverable","customer","devops::create","group::gitaly","section::dev","workflow::in review"],"milestone":{"id":1233755,"iid":53,"group_id":9970,"title":"13.6","description":"https:\/\/about.gitlab.com\/releases\/2020\/11\/22\/gitlab-13-6-released\/","state":"closed","created_at":"2020-04-09T17:39:22.328Z","updated_at":"2022-04-13T14:51:04.376Z","due_date":"2020-11-17","start_date":"2020-10-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/53"},"assignees":[{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"}],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"type":"ISSUE","assignee":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"user_notes_count":12,"merge_requests_count":1,"upvotes":2,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3160","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3160","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3160\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3160\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3160","relative":"#3160","full":"gitlab-org\/gitaly#3160"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":71507387,"iid":3151,"project_id":2009901,"title":"Leverage core.bigFilesTreshold for better memory utilization","description":"From `man git-config`:\n\n```\n       core.bigFileThreshold\n           Files larger than this size are stored deflated, without attempting delta compression. Storing large files without delta compression avoids excessive memory usage, at the slight expense of\n           increased disk usage. Additionally files larger than this size are always treated as binary.\n\n           Default is 512 MiB on all platforms. This should be reasonable for most projects as source code and other text files can still be delta compressed, but larger binary media files won\u2019t be.\n\n           Common unit suffixes of k, m, or g are supported.\n```\n\nGitaly doesn't set the `core.bigFileThreshold`, so it defaults to 512MiB. I think `50m` would be a better threshold and creates a better trade off for us. As I think the number of source files that are over 50MB is limited, so until that point each blob will still be compressed, and they get optimized packs for it. \n\nThis config should be dynamically inject on the relevant Git commands\/RPCs to improve `*UploadPack` performance, as well as `Repack*` performance.\n\n* [Tradeoffs from a user perspective](https:\/\/kscherer.github.io\/linux%20git\/2014\/09\/26\/git-server-option-bigfilethreshold)","state":"closed","created_at":1600782244601,"updated_at":1668042373097,"closed_at":1607355480716,"closed_by":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"labels":["Category:Gitaly","[deprecated] Accepting merge requests","bug::performance","devops::create","group::gitaly","section::dev","type::feature"],"milestone":{"id":490705,"iid":14,"group_id":9970,"title":"Backlog","description":"Issues that we want to do but are not planned right now. Open for contribution from the community.","state":"active","created_at":"2018-03-22T13:09:23.767Z","updated_at":"2018-10-30T14:56:54.069Z","due_date":null,"start_date":null,"expired":false,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/14"},"assignees":[],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"type":"ISSUE","assignee":null,"user_notes_count":4,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3151","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3151","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3151\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3151\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3151","relative":"#3151","full":"gitlab-org\/gitaly#3151"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":71198033,"iid":3135,"project_id":2009901,"title":"Reference transaction hook votes twice per reference update","description":"The reference-transaction hook will be called for every transition in Git's reference transaction mechanism. Currently, this will include exactly two transitions: either from `START -> prepared -> committed` or `START -> prepared -> aborted`. As our own hook will ignore which state we're transitioning to, we'll thus call out to the hook service twice and not pass along which state we've transitioned to. As a result, the hook service will vote twice per each reference update.\n\nOne could argue that this is a feature and not a bug in order to assert that we've actually performed both transitions as expected. But in any case, voting in the second transition from `prepared -> {committed,aborted}` is quite useless to us as Git will ignore the Git hook's return value in these transitions. After all, the transaction has already been wrapped up, so there's no way it can be changed after the fact.\n\nAs a result, we should stop voting in the second transition and only vote when moving to prepared state.","state":"closed","created_at":1600175999733,"updated_at":1603004900815,"closed_at":1602666831017,"closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"labels":["Category:Gitaly","Deliverable","devops::create","group::gitaly","section::dev","type::bug","workflow::in review"],"milestone":{"id":1233754,"iid":52,"group_id":9970,"title":"13.5","description":"https:\/\/about.gitlab.com\/releases\/2020\/10\/22\/gitlab-13-5-released\/","state":"closed","created_at":"2020-04-09T17:39:21.990Z","updated_at":"2022-04-21T07:21:12.213Z","due_date":"2020-10-17","start_date":"2020-09-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/52"},"assignees":[{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"}],"author":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"type":"ISSUE","assignee":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"user_notes_count":4,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3135","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3135","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3135\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3135\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3135","relative":"#3135","full":"gitlab-org\/gitaly#3135"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1189.0,"epic":{"id":5989,"iid":1189,"title":"Gitaly Cluster: strong consistency","url":"\/groups\/gitlab-org\/-\/epics\/1189","group_id":9970,"human_readable_end_date":"Sep 17, 2021","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":70726576,"iid":3110,"project_id":2009901,"title":"No use of checksum comparison after replication is done","description":"Once the replication is done (`update` of the repository at the gitaly storage) praefect runs [`CalculateChecksum`](https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/blob\/master\/internal\/praefect\/replicator.go#L263) for source and target gitaly nodes.  \nThe result of the execution compared and if there is no match the error message would be written into the log (example):\n```json\n{\n      \"msg\": \"checksums do not match\",\n      \"hostname\": \"praefect-01-stor-gprd\",\n      \"shard\": \"default\",\n      \"level\": \"error\",\n      \"primary\": {\n        \"storage_name\": \"file-praefect-02\",\n        \"relative_path\": \"@hashed\/fa\/53\/fa539965395b8382145f8370b34eab249cf610d2d6f2943c95b9b9d08a63d4a3.git\"\n      },\n      \"replica\": {\n        \"relative_path\": \"@hashed\/fa\/53\/fa539965395b8382145f8370b34eab249cf610d2d6f2943c95b9b9d08a63d4a3.git\",\n        \"storage_name\": \"file-praefect-01\"\n      },\n      \"environment\": \"gprd\",\n      \"pid\": 32412,\n      \"time\": \"2020-09-03T20:58:57.840Z\",\n      \"tier\": \"sv\",\n      \"type\": \"praefect\",\n      \"fqdn\": \"praefect-01-stor-gprd.c.gitlab-production.internal\",\n      \"tag\": \"praefect\",\n      \"stage\": \"main\"\n}\n```\n\nThis happens pretty often:\nStart of the replication: ![image](\/uploads\/45c46f2939516b0ce4d5913a810ee493\/image.png)  \nErrors about not matching checksums: ![image](\/uploads\/86763ea999d149bc58e23af9599f12d7\/image.png)\n\nAs a first step we could properly propagate `correlation_id` to all logging entries to get more info about what is going on as it is not used in all places where we log something.  \n\nIt is not clear if we should take any actions in regard of different checksums for the repository.\n\n\/cc @zj-gitlab @derekferguson","state":"closed","created_at":1599212071920,"updated_at":1607003150796,"closed_at":1607003150580,"closed_by":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"labels":["Category:Gitaly","devops::create","group::gitaly","missed:13.6","section::dev","workflow::in review"],"milestone":{"id":1233757,"iid":54,"group_id":9970,"title":"13.7","description":"https:\/\/about.gitlab.com\/releases\/archives.html","state":"closed","created_at":"2020-04-09T17:43:14.893Z","updated_at":"2022-04-13T14:51:12.240Z","due_date":"2020-12-17","start_date":"2020-11-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/54"},"assignees":[{"id":660180,"username":"toon","name":"Toon Claes","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/660180\/avatar.png","web_url":"https:\/\/gitlab.com\/toon"}],"author":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"type":"ISSUE","assignee":{"id":660180,"username":"toon","name":"Toon Claes","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/660180\/avatar.png","web_url":"https:\/\/gitlab.com\/toon"},"user_notes_count":5,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3110","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3110","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3110\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3110\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3110","relative":"#3110","full":"gitlab-org\/gitaly#3110"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":70504008,"iid":3098,"project_id":2009901,"title":"Fixup reference-transaction hook name based on arguments","description":"While the reference-transaction hook was released with Git v2.28.0, it's got a bug which will cause Git to accidentally execute the wrong hook if there's been interleaving calls to both the reference-transaction and another hook. This bug currently prohibits us to use the hook for reference transaction voting until a new Git version is released with the upstreamed fix. Given that this could be as late as release v2.29.0, it's potentially still quite a while until we can use the hook.\n\nAs a temporary workaround, we may manually fixup hook names in our `gitaly-hooks` binary. GitLab systems only have at most four hooks installed: `reference-transaction`, `pre-receive`, `update` and `post-receive`. Because of how these hooks get called, we should be able to tell the case when Git meant to execute the `reference-transaction` hook instead of any of the other three by inspecting the hook's arguments:\n\n- `reference-transaction` will receive as first arguments one of `prepared`, `committed` or `aborted`\n- `pre-receive` never gets any arguments\n- `update` will get as first argument the reference that is to be updated in its fully-qualified form (e.g. `refs\/heads\/master`) and thus should never clash with any of the three above verbs\n- `post-receive` never gets any arguments\n\nAs a consequence, none of these hooks except for the `reference-transaction` hook will ever get executed with one of `prepared`, `committed` or `aborted`. If they were executed with such an argument, we can be sure that Git wanted to execute the `reference-transaction` hook instead.\n\nBy making use of this info, we should be able to fix up the hook name without any casualties and unblock ourselves until Git v2.29.0 is released with a fix.","state":"closed","created_at":1598878299276,"updated_at":1599232289299,"closed_at":1599229785858,"closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"labels":["Category:Gitaly","devops::create","group::gitaly","section::dev","type::bug"],"milestone":{"id":1233753,"iid":51,"group_id":9970,"title":"13.4","description":"https:\/\/about.gitlab.com\/releases\/2020\/09\/22\/gitlab-13-4-released\/","state":"closed","created_at":"2020-04-09T17:39:21.662Z","updated_at":"2022-04-13T14:50:33.769Z","due_date":"2020-09-17","start_date":"2020-08-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/51"},"assignees":[{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"}],"author":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"type":"ISSUE","assignee":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3098","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3098","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3098\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3098\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3098","relative":"#3098","full":"gitlab-org\/gitaly#3098"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1189.0,"epic":{"id":5989,"iid":1189,"title":"Gitaly Cluster: strong consistency","url":"\/groups\/gitlab-org\/-\/epics\/1189","group_id":9970,"human_readable_end_date":"Sep 17, 2021","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":70060227,"iid":3077,"project_id":2009901,"title":"Port UserUpdateSubmodule to Go","description":"UserUpdateSubmodule is currently handled by the Gitaly-Ruby sidecar, and should be ported to Go for performance reasons. This could be handled by shelling out to Git, leveraging Git2Go, or another way.\n\n\/labels ~\"performance\" ~\"group::gitaly\"","state":"closed","created_at":1597919390883,"updated_at":1605129437061,"closed_at":1604994136913,"closed_by":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"labels":["Category:Gitaly","Deliverable","Gitaly-Ruby","devops::create","group::gitaly","missed-deliverable","missed:13.5","section::dev","workflow::in review"],"milestone":{"id":1233755,"iid":53,"group_id":9970,"title":"13.6","description":"https:\/\/about.gitlab.com\/releases\/2020\/11\/22\/gitlab-13-6-released\/","state":"closed","created_at":"2020-04-09T17:39:22.328Z","updated_at":"2022-04-13T14:51:04.376Z","due_date":"2020-11-17","start_date":"2020-10-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/53"},"assignees":[{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"type":"ISSUE","assignee":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3077","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3077","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3077\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3077\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3077","relative":"#3077","full":"gitlab-org\/gitaly#3077"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2862.0,"epic":{"id":30693,"iid":2862,"title":"\ud83c\udfcd Remove the Gitaly-Ruby sidecar","url":"\/groups\/gitlab-org\/-\/epics\/2862","group_id":9970,"human_readable_end_date":"May 17, 2023","human_readable_timestamp":"<strong>11<\/strong> days remaining"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":70060225,"iid":3076,"project_id":2009901,"title":"Port UserApplyPatch to Go","description":"UserApplyPatch is currently handled by the Gitaly-Ruby sidecar, and should be ported to Go for performance reasons. This could be handled by shelling out to Git, leveraging Git2Go, or another way.","state":"closed","created_at":1597919389952,"updated_at":1629270281557,"closed_at":1626945698206,"closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"labels":["Category:Gitaly","Deliverable","bug::performance","devops::create","feature::enhancement","group::gitaly","missed-deliverable","missed:13.10","missed:13.11","missed:13.12","missed:13.9","missed:14.0","missed:14.1","section::dev","type::feature","workflow::in review"],"milestone":{"id":1850126,"iid":62,"group_id":9970,"title":"14.2","description":"","state":"active","created_at":"2021-01-26T16:57:35.404Z","updated_at":"2021-07-22T19:45:42.498Z","due_date":"2021-08-17","start_date":"2021-07-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/62"},"assignees":[{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/5522960\/avatar.png","web_url":"https:\/\/gitlab.com\/samihiltunen"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"type":"ISSUE","assignee":{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/5522960\/avatar.png","web_url":"https:\/\/gitlab.com\/samihiltunen"},"user_notes_count":15,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3076","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3076","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3076\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3076\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3076","relative":"#3076","full":"gitlab-org\/gitaly#3076"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2862.0,"epic":{"id":30693,"iid":2862,"title":"\ud83c\udfcd Remove the Gitaly-Ruby sidecar","url":"\/groups\/gitlab-org\/-\/epics\/2862","group_id":9970,"human_readable_end_date":"May 17, 2023","human_readable_timestamp":"<strong>11<\/strong> days remaining"},"iteration":null,"health_status":"on_track","task_status":"0 of 0 checklist items completed"},{"id":70060224,"iid":3075,"project_id":2009901,"title":"Port UserSquash to Go","description":"UserSquash is currently handled by the Gitaly-Ruby sidecar, and should be ported to Go for performance reasons. This could be handled by shelling out to Git, leveraging Git2Go, or another way.\n\n\/labels ~\"performance\" ~\"group::gitaly\"","state":"closed","created_at":1597919388454,"updated_at":1605186391396,"closed_at":1602748290775,"closed_by":{"id":138401,"username":"chriscool","name":"Christian Couder","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/138401\/avatar.png","web_url":"https:\/\/gitlab.com\/chriscool"},"labels":["Category:Gitaly","Deliverable","devops::create","group::gitaly","section::dev","workflow::in review"],"milestone":{"id":1233754,"iid":52,"group_id":9970,"title":"13.5","description":"https:\/\/about.gitlab.com\/releases\/2020\/10\/22\/gitlab-13-5-released\/","state":"closed","created_at":"2020-04-09T17:39:21.990Z","updated_at":"2022-04-21T07:21:12.213Z","due_date":"2020-10-17","start_date":"2020-09-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/52"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3075","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3075","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3075\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3075\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3075","relative":"#3075","full":"gitlab-org\/gitaly#3075"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2862.0,"epic":{"id":30693,"iid":2862,"title":"\ud83c\udfcd Remove the Gitaly-Ruby sidecar","url":"\/groups\/gitlab-org\/-\/epics\/2862","group_id":9970,"human_readable_end_date":"May 17, 2023","human_readable_timestamp":"<strong>11<\/strong> days remaining"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":70060223,"iid":3074,"project_id":2009901,"title":"Port UserCommitFiles to Go","description":"UserCommitFiles is currently handled by the Gitaly-Ruby sidecar, and should be ported to Go for performance reasons. This could be handled by shelling out to Git, leveraging Git2Go, or another way.\n\n\/labels ~\"performance\" ~\"group::gitaly\"","state":"closed","created_at":1597919387315,"updated_at":1604934898526,"closed_at":1604055320872,"closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"labels":["Category:Gitaly","Deliverable","devops::create","group::gitaly","missed-deliverable","missed:13.5","section::dev","workflow::in review"],"milestone":{"id":1233755,"iid":53,"group_id":9970,"title":"13.6","description":"https:\/\/about.gitlab.com\/releases\/2020\/11\/22\/gitlab-13-6-released\/","state":"closed","created_at":"2020-04-09T17:39:22.328Z","updated_at":"2022-04-13T14:51:04.376Z","due_date":"2020-11-17","start_date":"2020-10-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/53"},"assignees":[{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/5522960\/avatar.png","web_url":"https:\/\/gitlab.com\/samihiltunen"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"type":"ISSUE","assignee":{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/5522960\/avatar.png","web_url":"https:\/\/gitlab.com\/samihiltunen"},"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3074","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3074","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3074\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3074\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3074","relative":"#3074","full":"gitlab-org\/gitaly#3074"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2862.0,"epic":{"id":30693,"iid":2862,"title":"\ud83c\udfcd Remove the Gitaly-Ruby sidecar","url":"\/groups\/gitlab-org\/-\/epics\/2862","group_id":9970,"human_readable_end_date":"May 17, 2023","human_readable_timestamp":"<strong>11<\/strong> days remaining"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":70060220,"iid":3072,"project_id":2009901,"title":"Port UserRevert to Go","description":"UserRevert is currently handled by the Gitaly-Ruby sidecar, and should be ported to Go for performance reasons. This could be handled by shelling out to Git, leveraging Git2Go, or another way.\n\n\/labels ~\"performance\" ~\"group::gitaly\"","state":"closed","created_at":1597919384746,"updated_at":1607465518040,"closed_at":1606984309805,"closed_by":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"labels":["Category:Gitaly","Deliverable","Gitaly-Ruby","devops::create","group::gitaly","missed-deliverable","missed:13.5","section::dev","workflow::verification"],"milestone":{"id":1233755,"iid":53,"group_id":9970,"title":"13.6","description":"https:\/\/about.gitlab.com\/releases\/2020\/11\/22\/gitlab-13-6-released\/","state":"closed","created_at":"2020-04-09T17:39:22.328Z","updated_at":"2022-04-13T14:51:04.376Z","due_date":"2020-11-17","start_date":"2020-10-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/53"},"assignees":[{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/228150\/avatar.png","web_url":"https:\/\/gitlab.com\/proglottis"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"type":"ISSUE","assignee":{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/228150\/avatar.png","web_url":"https:\/\/gitlab.com\/proglottis"},"user_notes_count":3,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3072","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3072","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3072\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3072\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3072","relative":"#3072","full":"gitlab-org\/gitaly#3072"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2862.0,"epic":{"id":30693,"iid":2862,"title":"\ud83c\udfcd Remove the Gitaly-Ruby sidecar","url":"\/groups\/gitlab-org\/-\/epics\/2862","group_id":9970,"human_readable_end_date":"May 17, 2023","human_readable_timestamp":"<strong>11<\/strong> days remaining"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":70060218,"iid":3071,"project_id":2009901,"title":"Port UserCherryPick to Go","description":"UserCherryPick is currently handled by the Gitaly-Ruby sidecar, and should be ported to Go for performance reasons. This could be handled by shelling out to Git, leveraging Git2Go, or another way.","state":"closed","created_at":1597919383689,"updated_at":1613632075400,"closed_at":1613614824777,"closed_by":{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/228150\/avatar.png","web_url":"https:\/\/gitlab.com\/proglottis"},"labels":["Category:Gitaly","Deliverable","bug::performance","devops::create","group::gitaly","missed-deliverable","missed:13.5","missed:13.6","section::dev","workflow::in review"],"milestone":{"id":1233760,"iid":56,"group_id":9970,"title":"13.9","description":"https:\/\/about.gitlab.com\/releases\/archives.html","state":"closed","created_at":"2020-04-09T17:44:14.334Z","updated_at":"2022-04-21T07:21:28.468Z","due_date":"2021-02-17","start_date":"2021-01-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/56"},"assignees":[{"id":660180,"username":"toon","name":"Toon Claes","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/660180\/avatar.png","web_url":"https:\/\/gitlab.com\/toon"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"type":"ISSUE","assignee":{"id":660180,"username":"toon","name":"Toon Claes","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/660180\/avatar.png","web_url":"https:\/\/gitlab.com\/toon"},"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3071","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3071","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3071\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3071\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3071","relative":"#3071","full":"gitlab-org\/gitaly#3071"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2862.0,"epic":{"id":30693,"iid":2862,"title":"\ud83c\udfcd Remove the Gitaly-Ruby sidecar","url":"\/groups\/gitlab-org\/-\/epics\/2862","group_id":9970,"human_readable_end_date":"May 17, 2023","human_readable_timestamp":"<strong>11<\/strong> days remaining"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":70060215,"iid":3070,"project_id":2009901,"title":"Port UserFFBranch to Go","description":"UserFFBranch is currently handled by the Gitaly-Ruby sidecar, and should be ported to Go for performance reasons. This could be handled by shelling out to Git, leveraging Git2Go, or another way.\n\n\/labels ~\"performance\" ~\"group::gitaly\"","state":"closed","created_at":1597919382686,"updated_at":1604523642393,"closed_at":1604523642339,"closed_by":{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/228150\/avatar.png","web_url":"https:\/\/gitlab.com\/proglottis"},"labels":["Category:Gitaly","Deliverable","Gitaly-Ruby","devops::create","group::gitaly","missed-deliverable","missed:13.5","section::dev","workflow::verification"],"milestone":{"id":1233755,"iid":53,"group_id":9970,"title":"13.6","description":"https:\/\/about.gitlab.com\/releases\/2020\/11\/22\/gitlab-13-6-released\/","state":"closed","created_at":"2020-04-09T17:39:22.328Z","updated_at":"2022-04-13T14:51:04.376Z","due_date":"2020-11-17","start_date":"2020-10-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/53"},"assignees":[{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/228150\/avatar.png","web_url":"https:\/\/gitlab.com\/proglottis"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"type":"ISSUE","assignee":{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/228150\/avatar.png","web_url":"https:\/\/gitlab.com\/proglottis"},"user_notes_count":3,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3070","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3070","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3070\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3070\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3070","relative":"#3070","full":"gitlab-org\/gitaly#3070"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2862.0,"epic":{"id":30693,"iid":2862,"title":"\ud83c\udfcd Remove the Gitaly-Ruby sidecar","url":"\/groups\/gitlab-org\/-\/epics\/2862","group_id":9970,"human_readable_end_date":"May 17, 2023","human_readable_timestamp":"<strong>11<\/strong> days remaining"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":70060212,"iid":3068,"project_id":2009901,"title":"Port UserMergeToRef to Go","description":"UserMergeToRef is currently handled by the Gitaly-Ruby sidecar, and should be ported to Go for performance reasons. This could be handled by shelling out to Git, leveraging Git2Go, or another way.\n\n\/labels ~\"performance\" ~\"group::gitaly\"","state":"closed","created_at":1597919380153,"updated_at":1603004901054,"closed_at":1600805169691,"closed_by":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"labels":["Category:Gitaly","Deliverable","devops::create","group::gitaly","section::dev","workflow::in review"],"milestone":{"id":1233754,"iid":52,"group_id":9970,"title":"13.5","description":"https:\/\/about.gitlab.com\/releases\/2020\/10\/22\/gitlab-13-5-released\/","state":"closed","created_at":"2020-04-09T17:39:21.990Z","updated_at":"2022-04-21T07:21:12.213Z","due_date":"2020-10-17","start_date":"2020-09-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/52"},"assignees":[{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"type":"ISSUE","assignee":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3068","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3068","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3068\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3068\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3068","relative":"#3068","full":"gitlab-org\/gitaly#3068"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2862.0,"epic":{"id":30693,"iid":2862,"title":"\ud83c\udfcd Remove the Gitaly-Ruby sidecar","url":"\/groups\/gitlab-org\/-\/epics\/2862","group_id":9970,"human_readable_end_date":"May 17, 2023","human_readable_timestamp":"<strong>11<\/strong> days remaining"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":70060205,"iid":3064,"project_id":2009901,"title":"Port UserDeleteTag to Go","description":"UserDeleteTag is currently handled by the Gitaly-Ruby sidecar, and should be ported to Go for performance reasons. This could be handled by shelling out to Git, leveraging Git2Go, or another way.\n\n\/labels ~\"performance\" ~\"group::gitaly\"","state":"closed","created_at":1597919375749,"updated_at":1608275286192,"closed_at":1606910574603,"closed_by":{"id":1424505,"username":"avar","name":"\u00c6var Arnfj\u00f6r\u00f0 Bjarmason","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/4edaf21e9ad2d357c90aa62eb752f302?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/avar"},"labels":["Category:Gitaly","Deliverable","Gitaly-Ruby","auto updated","devops::create","group::gitaly","missed-deliverable","missed:13.5","missed:13.6","section::dev","workflow::ready for development"],"milestone":{"id":1233757,"iid":54,"group_id":9970,"title":"13.7","description":"https:\/\/about.gitlab.com\/releases\/archives.html","state":"closed","created_at":"2020-04-09T17:43:14.893Z","updated_at":"2022-04-13T14:51:12.240Z","due_date":"2020-12-17","start_date":"2020-11-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/54"},"assignees":[{"id":1424505,"username":"avar","name":"\u00c6var Arnfj\u00f6r\u00f0 Bjarmason","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/4edaf21e9ad2d357c90aa62eb752f302?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/avar"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"type":"ISSUE","assignee":{"id":1424505,"username":"avar","name":"\u00c6var Arnfj\u00f6r\u00f0 Bjarmason","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/4edaf21e9ad2d357c90aa62eb752f302?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/avar"},"user_notes_count":4,"merge_requests_count":2,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3064","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3064","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3064\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3064\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3064","relative":"#3064","full":"gitlab-org\/gitaly#3064"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2862.0,"epic":{"id":30693,"iid":2862,"title":"\ud83c\udfcd Remove the Gitaly-Ruby sidecar","url":"\/groups\/gitlab-org\/-\/epics\/2862","group_id":9970,"human_readable_end_date":"May 17, 2023","human_readable_timestamp":"<strong>11<\/strong> days remaining"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":70060200,"iid":3063,"project_id":2009901,"title":"Port UserCreateTag to Go","description":"UserCreateTag is currently handled by the Gitaly-Ruby sidecar, and should be ported to Go for performance reasons. This could be handled by shelling out to Git, leveraging Git2Go, or another way.\n\n\/labels ~\"performance\" ~\"group::gitaly\"","state":"closed","created_at":1597919368269,"updated_at":1611162054076,"closed_at":1611162054023,"closed_by":{"id":1424505,"username":"avar","name":"\u00c6var Arnfj\u00f6r\u00f0 Bjarmason","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/4edaf21e9ad2d357c90aa62eb752f302?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/avar"},"labels":["Category:Gitaly","Deliverable","Gitaly-Ruby","auto updated","devops::create","group::gitaly","missed-deliverable","missed:13.5","missed:13.6","section::dev","workflow::in dev"],"milestone":{"id":1233759,"iid":55,"group_id":9970,"title":"13.8","description":"https:\/\/about.gitlab.com\/releases\/archives.html","state":"closed","created_at":"2020-04-09T17:44:13.983Z","updated_at":"2022-04-13T14:51:23.220Z","due_date":"2021-01-17","start_date":"2020-12-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/55"},"assignees":[{"id":1424505,"username":"avar","name":"\u00c6var Arnfj\u00f6r\u00f0 Bjarmason","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/4edaf21e9ad2d357c90aa62eb752f302?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/avar"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"type":"ISSUE","assignee":{"id":1424505,"username":"avar","name":"\u00c6var Arnfj\u00f6r\u00f0 Bjarmason","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/4edaf21e9ad2d357c90aa62eb752f302?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/avar"},"user_notes_count":4,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3063","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3063","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3063\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3063\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3063","relative":"#3063","full":"gitlab-org\/gitaly#3063"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2862.0,"epic":{"id":30693,"iid":2862,"title":"\ud83c\udfcd Remove the Gitaly-Ruby sidecar","url":"\/groups\/gitlab-org\/-\/epics\/2862","group_id":9970,"human_readable_end_date":"May 17, 2023","human_readable_timestamp":"<strong>11<\/strong> days remaining"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":69890593,"iid":3044,"project_id":2009901,"title":"Ignore common name from x509 certificates","description":"A temporary mitigation of a breaking change was introduced in https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/merge_requests\/2472.\n\nThis should be removed in the next major version of GitLab. Additionally, all users of the Gitaly Go-client should be upgraded.\n\nRelates to https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3036","state":"closed","created_at":1597642489695,"updated_at":1635430144235,"closed_at":1609784741431,"closed_by":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"labels":["Category:Gitaly","[deprecated] Accepting merge requests","breaking change","devops::create","group::gitaly","section::dev","type::maintenance"],"milestone":{"id":1406669,"iid":59,"group_id":9970,"title":"13.11","description":"https:\/\/about.gitlab.com\/releases\/archives.html","state":"closed","created_at":"2020-08-13T14:23:09.688Z","updated_at":"2022-04-21T07:22:08.835Z","due_date":"2021-04-17","start_date":"2021-03-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/59"},"assignees":[],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"type":"ISSUE","assignee":null,"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3044","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3044","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3044\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3044\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3044","relative":"#3044","full":"gitlab-org\/gitaly#3044"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":69757246,"iid":3035,"project_id":2009901,"title":"Re-include reference-transaction hook","description":"The reference-transaction hook has been removed from Gitaly due to a regression in Git v2.28.0, causing the wrong hooks to be invoked with inputs from the reference-transaction hook if there's interleaving hook calls. We need to re-include the reference-transaction hook as soon as Git v2.28.1 has been released with a fix to this issue.\n\nDepends on https:\/\/gitlab.com\/gitlab-org\/gitlab-git\/-\/issues\/1144","state":"closed","created_at":1597229745679,"updated_at":1600183431719,"closed_at":1599801360340,"closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"labels":["Category:Gitaly","[deprecated] Accepting merge requests","devops::create","group::gitaly","section::dev"],"milestone":null,"assignees":[],"author":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"type":"ISSUE","assignee":null,"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3035","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3035","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3035\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3035\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3035","relative":"#3035","full":"gitlab-org\/gitaly#3035"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1189.0,"epic":{"id":5989,"iid":1189,"title":"Gitaly Cluster: strong consistency","url":"\/groups\/gitlab-org\/-\/epics\/1189","group_id":9970,"human_readable_end_date":"Sep 17, 2021","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":69757169,"iid":3034,"project_id":2009901,"title":"Call reference-transaction hook from Ruby sidecar","description":"While we already call the pre-receive, update and post-receive hooks manually in the Ruby sidecar, we don't do so for the reference-transaction hook. This is a necessity when we want to drop the pre-receive hook in favor of the reference-transacton hook, though.\n\nThis depends on the re-inclusion of Gitaly's reference-transaction hook and thus on the release of Git v2.28.1.","state":"closed","created_at":1597229598265,"updated_at":1603004901164,"closed_at":1600310881719,"closed_by":{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/228150\/avatar.png","web_url":"https:\/\/gitlab.com\/proglottis"},"labels":["Category:Gitaly","Deliverable","Stretch","devops::create","group::gitaly","section::dev","type::feature","workflow::ready for development"],"milestone":{"id":1233754,"iid":52,"group_id":9970,"title":"13.5","description":"https:\/\/about.gitlab.com\/releases\/2020\/10\/22\/gitlab-13-5-released\/","state":"closed","created_at":"2020-04-09T17:39:21.990Z","updated_at":"2022-04-21T07:21:12.213Z","due_date":"2020-10-17","start_date":"2020-09-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/52"},"assignees":[{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"}],"author":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"type":"ISSUE","assignee":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3034","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3034","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3034\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3034\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3034","relative":"#3034","full":"gitlab-org\/gitaly#3034"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1189.0,"epic":{"id":5989,"iid":1189,"title":"Gitaly Cluster: strong consistency","url":"\/groups\/gitlab-org\/-\/epics\/1189","group_id":9970,"human_readable_end_date":"Sep 17, 2021","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":69722330,"iid":3032,"project_id":2009901,"title":"Improve reconcile error handling when individual repo failures occur","description":"Currently, the reconcile command will exit early if one of the repos experiences an unrecoverable error. This should not stop the command from continuing onto other repositories. Ideally, any errors encountered for individual repos should be reported back to the client and displayed appropriately to the user.","state":"closed","created_at":1597174067040,"updated_at":1614114553614,"closed_at":1613910002088,"closed_by":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"labels":["Category:Gitaly","devops::create","group::gitaly","group::gitaly::cluster","missed:13.5","missed:13.6","missed:13.9","section::dev","workflow::in dev"],"milestone":{"id":1233761,"iid":57,"group_id":9970,"title":"13.10","description":"https:\/\/about.gitlab.com\/releases\/archives.html","state":"closed","created_at":"2020-04-09T17:44:14.646Z","updated_at":"2022-04-21T07:22:00.171Z","due_date":"2021-03-17","start_date":"2021-02-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/57"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"}],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"user_notes_count":9,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3032","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3032","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3032\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3032\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3032","relative":"#3032","full":"gitlab-org\/gitaly#3032"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":69699005,"iid":3031,"project_id":2009901,"title":"Rename white\/blacklist references","description":"```\n\u276f git grep whitelist\ninternal\/praefect\/replicator.go:308:    \/\/ whitelist contains the project names of the repos we wish to replicate\ninternal\/praefect\/replicator.go:309:    whitelist map[string]struct{}\ninternal\/praefect\/replicator.go:342:            whitelist:       map[string]struct{}{},\ninternal\/praefect\/replicator.go:372:\/\/ WithWhitelist will configure a whitelist for repos to allow replication\ninternal\/praefect\/replicator.go:373:func WithWhitelist(whitelistedRepos []string) ReplMgrOpt {\ninternal\/praefect\/replicator.go:375:            for _, repo := range whitelistedRepos {\ninternal\/praefect\/replicator.go:376:                    r.whitelist[repo] = struct{}{}\ninternal\/rubyserver\/proxy.go:15:\/\/ Headers prefixed with this string get whitelisted automatically\ninternal\/rubyserver\/proxy.go:86:                \/\/ Automatically whitelist any Ruby-specific feature flag\ninternal\/rubyserver\/proxy_test.go:26:   require.False(t, ok, \"outgoing MD should not contain non-whitelisted key\")\ninternal\/rubyserver\/proxy_test.go:43:   require.Equal(t, []string{value}, outMd[key], \"outgoing MD should contain whitelisted key\")\ninternal\/rubyserver\/proxy_test.go:60:   require.Equal(t, []string{value}, outMd[key], \"outgoing MD should contain whitelisted feature key\")\n```\n\nGitaly should not use black vs white, but instead use block and allow lists.","state":"closed","created_at":1597156759467,"updated_at":1600412860804,"closed_at":1599580961009,"closed_by":{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/5522960\/avatar.png","web_url":"https:\/\/gitlab.com\/samihiltunen"},"labels":["Category:Gitaly","Deliverable","devops::create","group::gitaly","section::dev","workflow::in review"],"milestone":{"id":1233753,"iid":51,"group_id":9970,"title":"13.4","description":"https:\/\/about.gitlab.com\/releases\/2020\/09\/22\/gitlab-13-4-released\/","state":"closed","created_at":"2020-04-09T17:39:21.662Z","updated_at":"2022-04-13T14:50:33.769Z","due_date":"2020-09-17","start_date":"2020-08-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/51"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"user_notes_count":3,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3031","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3031","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3031\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3031\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3031","relative":"#3031","full":"gitlab-org\/gitaly#3031"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":69499544,"iid":3017,"project_id":2009901,"title":"Praefect server metadata not resolved before passing to Ruby sidecar","description":"When receiving a call with Praefect server metadata, we need resolve contained connection information first based on the current peer's connection information. This will fill in the remote's IP address, which is something that may change depending on how Praefect has connected to us.\n\nWhile we already to this for \"normal\" calls via `PraefectFromContext()`, we don't for proxied calls intended for our Ruby sidecar. As a result, the sidecar may receive invalid connection information which it cannot use. To fix this, we need to resolve address information on Gitaly's side and inject resolved metadata into the Ruby sidecar's metadata.\n\nReferences https:\/\/gitlab.com\/gitlab-org\/gitlab\/-\/issues\/233838","state":"closed","created_at":1596704939758,"updated_at":1597135377011,"closed_at":1596730817679,"closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"labels":["devops::create","group::gitaly","group::gitaly::cluster","type::bug"],"milestone":{"id":1233752,"iid":50,"group_id":9970,"title":"13.3","description":"https:\/\/about.gitlab.com\/releases\/2020\/08\/22\/gitlab-13-3-released\/","state":"closed","created_at":"2020-04-09T17:39:21.090Z","updated_at":"2022-04-13T14:50:18.976Z","due_date":"2020-08-17","start_date":"2020-07-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/50"},"assignees":[],"author":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"type":"ISSUE","assignee":null,"user_notes_count":0,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3017","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3017","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3017\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3017\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3017","relative":"#3017","full":"gitlab-org\/gitaly#3017"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":69398701,"iid":3010,"project_id":2009901,"title":"Improved metrics for transactions","description":"Todays testrun showed that metrics for transactions could be improved:\n\n- no way to figure out how many voters per transaction there are\n- client-side delay for voting on a transaction is missing\n- the server-side delay is extremely static and it doesn't matter whether we use primary-wins strategy or not. Maybe it's broken?","state":"closed","created_at":1596529133935,"updated_at":1596622501726,"closed_at":1596620544888,"closed_by":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"labels":["Category:Gitaly","devops::create","feature::addition","group::gitaly","type::feature"],"milestone":{"id":1233752,"iid":50,"group_id":9970,"title":"13.3","description":"https:\/\/about.gitlab.com\/releases\/2020\/08\/22\/gitlab-13-3-released\/","state":"closed","created_at":"2020-04-09T17:39:21.090Z","updated_at":"2022-04-13T14:50:18.976Z","due_date":"2020-08-17","start_date":"2020-07-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/50"},"assignees":[{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"}],"author":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"type":"ISSUE","assignee":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/3010","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3010","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3010\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/3010\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#3010","relative":"#3010","full":"gitlab-org\/gitaly#3010"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1189.0,"epic":{"id":5989,"iid":1189,"title":"Gitaly Cluster: strong consistency","url":"\/groups\/gitlab-org\/-\/epics\/1189","group_id":9970,"human_readable_end_date":"Sep 17, 2021","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":69174006,"iid":2993,"project_id":2009901,"title":"`praefect reconcile` hangs then fails on staging","description":"`praefect reconcile` on staging runs normally for a few minutes then hangs and fails on staging with the following error `unable to reconcile: rpc error: code = Unavailable desc = transport is closing`. It does not reach the point where it prints \"FINISHED: ...\".\n\ncc\/ @8bitlife @zj-gitlab","state":"closed","created_at":1596029388148,"updated_at":1605736117837,"closed_at":1605736117775,"closed_by":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"labels":["Category:Gitaly","SLO::Missed","devops::create","group::gitaly","group::gitaly::cluster","priority::2","section::dev","severity::2","type::bug","workflow::ready for development"],"milestone":{"id":1233755,"iid":53,"group_id":9970,"title":"13.6","description":"https:\/\/about.gitlab.com\/releases\/2020\/11\/22\/gitlab-13-6-released\/","state":"closed","created_at":"2020-04-09T17:39:22.328Z","updated_at":"2022-04-13T14:51:04.376Z","due_date":"2020-11-17","start_date":"2020-10-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/53"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"}],"author":{"id":506061,"username":"ahmadsherif","name":"Ahmad Sherif","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/bd6d0ec4213b91601956c9f801cbfe9b?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/ahmadsherif"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"user_notes_count":7,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2993","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2993","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2993\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2993\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2993","relative":"#2993","full":"gitlab-org\/gitaly#2993"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":68935101,"iid":2985,"project_id":2009901,"title":"Praefect subcommands miss user-visible documentation","description":"When executing `praefect -help`, we list the switches and subcommands available to Praefect. While switches have some short documentation available, none of the subcommands actually explain what they're doing and why an administrator would want to use them. As many of them will probably be of use in stressful scenarios where there's an incident happening, having some documentation handy for the admin as part of `praefect -help` would definitely be very helpful.","state":"closed","created_at":1595575012339,"updated_at":1680159094606,"closed_at":1680159094590,"closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"labels":["Category:Gitaly","[deprecated] Accepting merge requests","devops::systems","feature::addition","group::gitaly","section::enablement"],"milestone":null,"assignees":[],"author":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"type":"ISSUE","assignee":null,"user_notes_count":2,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2985","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2985","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2985\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2985\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2985","relative":"#2985","full":"gitlab-org\/gitaly#2985"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":68592316,"iid":2976,"project_id":2009901,"title":"Document usage of the PgBouncer for Praefect cluster setup","description":"The doc at https:\/\/docs.gitlab.com\/ee\/administration\/gitaly\/praefect.html should include instructions about setup and configuration of the PgBouncer that will be used in front of the PostgreSQL database.","state":"closed","created_at":1595313692034,"updated_at":1596525783659,"closed_at":1596524313754,"closed_by":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"labels":["Category:Gitaly","devops::create","documentation","group::gitaly","group::gitaly::cluster","missed:13.2","workflow::in review"],"milestone":{"id":1233752,"iid":50,"group_id":9970,"title":"13.3","description":"https:\/\/about.gitlab.com\/releases\/2020\/08\/22\/gitlab-13-3-released\/","state":"closed","created_at":"2020-04-09T17:39:21.090Z","updated_at":"2022-04-13T14:50:18.976Z","due_date":"2020-08-17","start_date":"2020-07-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/50"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"}],"author":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"user_notes_count":0,"merge_requests_count":3,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2976","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2976","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2976\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2976\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2976","relative":"#2976","full":"gitlab-org\/gitaly#2976"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2013.0,"epic":{"id":13406,"iid":2013,"title":"\ud83c\udf3f Gitaly Cluster: Distribute Git read operations across Gitaly nodes","url":"\/groups\/gitlab-org\/-\/epics\/2013","group_id":9970,"human_readable_end_date":"Mar 17, 2021","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":68589310,"iid":2975,"project_id":2009901,"title":"PgBouncer deployment with terraform","description":"In order to verify usage of the PgBouncer in front of the PostgreSQL database for Praefect we should include PgBouncer into terraform setup.  \nThis will allow us to verify that Praefect can use PgBouncer protected PostgreSQL without issues.  \n\n\/cc @zj-gitlab @jramsay","state":"closed","created_at":1595313236159,"updated_at":1597734503990,"closed_at":1596126362243,"closed_by":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"labels":["Category:Gitaly","Deliverable","devops::create","group::gitaly","group::gitaly::cluster","workflow::in review"],"milestone":{"id":1233752,"iid":50,"group_id":9970,"title":"13.3","description":"https:\/\/about.gitlab.com\/releases\/2020\/08\/22\/gitlab-13-3-released\/","state":"closed","created_at":"2020-04-09T17:39:21.090Z","updated_at":"2022-04-13T14:50:18.976Z","due_date":"2020-08-17","start_date":"2020-07-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/50"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"}],"author":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"user_notes_count":0,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2975","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2975","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2975\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2975\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2975","relative":"#2975","full":"gitlab-org\/gitaly#2975"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2013.0,"epic":{"id":13406,"iid":2013,"title":"\ud83c\udf3f Gitaly Cluster: Distribute Git read operations across Gitaly nodes","url":"\/groups\/gitlab-org\/-\/epics\/2013","group_id":9970,"human_readable_end_date":"Mar 17, 2021","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":54077691,"iid":2945,"project_id":2009901,"title":"Praefect distributed reads counter has mislabeled storage","description":"During the 2020-07-07 demo, we observed strange behavior from the distributed reads counter (see area in red rectangle):\n\n![Screen_Shot_2020-07-07_at_9.40.20_PM](\/uploads\/a3292e5a89dcd5d1d5b5f896736641e7\/Screen_Shot_2020-07-07_at_9.40.20_PM.png)\n\nNote how all three counters are labeled with the same storage `gitaly-1`.\n\nThe counters originate from three different Praefects. The objective of read distribution is to distribute reads across multiple storages of the same virtual storage. We expect to see each Praefect distribute reads to different storages. Given enough time, we expect to see counters labeled with all storages (in this case there were three: gitaly-1, gitaly-2, gitaly-3).","state":"closed","created_at":1594183489698,"updated_at":1597734504239,"closed_at":1594854072929,"closed_by":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"labels":["Category:Gitaly","Deliverable","demo","devops::create","group::gitaly","group::gitaly::cluster","priority::3","type::bug"],"milestone":{"id":1233752,"iid":50,"group_id":9970,"title":"13.3","description":"https:\/\/about.gitlab.com\/releases\/2020\/08\/22\/gitlab-13-3-released\/","state":"closed","created_at":"2020-04-09T17:39:21.090Z","updated_at":"2022-04-13T14:50:18.976Z","due_date":"2020-08-17","start_date":"2020-07-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/50"},"assignees":[{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"}],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"type":"ISSUE","assignee":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"user_notes_count":5,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2020-07-13","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2945","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2945","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2945\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2945\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2945","relative":"#2945","full":"gitlab-org\/gitaly#2945"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2013.0,"epic":{"id":13406,"iid":2013,"title":"\ud83c\udf3f Gitaly Cluster: Distribute Git read operations across Gitaly nodes","url":"\/groups\/gitlab-org\/-\/epics\/2013","group_id":9970,"human_readable_end_date":"Mar 17, 2021","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":54023862,"iid":2939,"project_id":2009901,"title":"Implement support for subtransactions","description":"With the upcoming reference-transaction hook implemented in gitlab-org\/gitlab-git!2, we need to extend transactions to support subtransactions. Right now, we know that each transaction will be invoked once only from the pre-receive hook. But with the reftx-hook, each Git operation may call out to a given transaction arbitrarily many times. As we cannot know how often that's going to happen, the transaction needs to cope and allow for multiple votes.\n\nThis is where subtransactions will come in. Each vote of a given node is going to create a new subtransaction iff all previous subtransactions for that node have succeeded. If the current transaction is still ongoing or has failed, it is not allowed to take part in new subtransactions. The outcome for each given node is then either `success` if all subtransactions have reached quorum on the same thing as the node voted for, `failure` if any subtransaction arrived at a different thing or `not started` if none of the nodes has created a subtransaction.","state":"closed","created_at":1594112388166,"updated_at":1594984292693,"closed_at":1594983416766,"closed_by":{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/5522960\/avatar.png","web_url":"https:\/\/gitlab.com\/samihiltunen"},"labels":["Deliverable","devops::create","feature::addition","group::gitaly::cluster","type::feature","workflow::planning breakdown"],"milestone":{"id":1233752,"iid":50,"group_id":9970,"title":"13.3","description":"https:\/\/about.gitlab.com\/releases\/2020\/08\/22\/gitlab-13-3-released\/","state":"closed","created_at":"2020-04-09T17:39:21.090Z","updated_at":"2022-04-13T14:50:18.976Z","due_date":"2020-08-17","start_date":"2020-07-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/50"},"assignees":[{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"}],"author":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"type":"ISSUE","assignee":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"user_notes_count":0,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2939","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2939","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2939\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2939\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2939","relative":"#2939","full":"gitlab-org\/gitaly#2939"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1189.0,"epic":{"id":5989,"iid":1189,"title":"Gitaly Cluster: strong consistency","url":"\/groups\/gitlab-org\/-\/epics\/1189","group_id":9970,"human_readable_end_date":"Sep 17, 2021","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":53975361,"iid":2936,"project_id":2009901,"title":"Improve the performance of CountCommits by using commit-graph","description":"(Placeholder issue, Gitaly team know details more than I do)\n\nIn https:\/\/gitlab.com\/gitlab-com\/gl-infra\/scalability\/-\/issues\/470, the main performance issue with the Gitaly cny node appears to be the CountCommits GRPC method.\n\n@chriscool pointed out that this could be sped up using `core.commitGraph`\n\n```\n$ git config core.commitGraph true\n$ time git rev-list --count --all\n67482\nreal    0m0,100s\nuser    0m0,088s\nsys     0m0,012s\n$ git config core.commitGraph false\n$ time git rev-list --count --all\n67482\nreal    0m0,587s\nuser    0m0,567s\nsys     0m0,020s\n```\n\nIf possible, we should consider enabling this. \n\ncc @zj-gitlab @pokstad1 @chriscool","state":"closed","created_at":1594045986870,"updated_at":1642755380470,"closed_at":1642755380455,"closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"labels":["Category:Gitaly","Stretch","auto updated","bug::performance","devops::create","group::gitaly","missed:13.10","missed:13.12","missed:13.6","missed:13.9","missed:14.0","missed:14.2","missed:14.3","missed:14.4","missed:14.5","missed:14.6","missed:14.7","priority::2","section::dev","type::bug","workflow::planning breakdown"],"milestone":{"id":2161849,"iid":70,"group_id":9970,"title":"14.8","description":"","state":"active","created_at":"2021-07-26T16:51:47.677Z","updated_at":"2021-07-26T16:51:47.677Z","due_date":"2022-02-17","start_date":"2022-01-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/70"},"assignees":[],"author":{"id":895869,"username":"andrewn","name":"Andrew Newdigate","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/895869\/avatar.png","web_url":"https:\/\/gitlab.com\/andrewn"},"type":"ISSUE","assignee":null,"user_notes_count":15,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2936","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2936","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2936\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2936\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2936","relative":"#2936","full":"gitlab-org\/gitaly#2936"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":53589477,"iid":2927,"project_id":2009901,"title":"Refactoring of the listening address configuration","description":"The following discussion from !2276 should be addressed:\n\n- [ ] @8bitlife started a [discussion](https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/merge_requests\/2276#note_362382231): \n\n    > I think we should refactor it and allow to set a list of addresses that needs to be served with mandatory schema each `listen = ['tcp:\/\/0.0.0.0:2609', 'tls:\/\/0.0.0.0:2609', 'unix:\/\/\/opt\/var\/praefect.socket']`.   \n    > It will simplify out code and we won't need to support both: 'tcp:\/\/0.0.0.0:2609' and '0.0.0.0:2609' for same `listen_addr` and in a couple of other places: `PraefectServer` type\n\n\/cc @zj-gitlab","state":"closed","created_at":1593676408324,"updated_at":1626177411079,"closed_at":1626177411062,"closed_by":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"labels":["Category:Gitaly","devops::create","group::gitaly","missed:13.11","missed:13.12","missed:14.0","priority::4","section::dev","severity::4","type::feature","workflow::in review"],"milestone":{"id":1850118,"iid":61,"group_id":9970,"title":"14.1","description":"","state":"closed","created_at":"2021-01-26T16:56:41.887Z","updated_at":"2022-04-21T07:25:22.879Z","due_date":"2021-07-17","start_date":"2021-06-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/61"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"}],"author":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"user_notes_count":0,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2927","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":1,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2927","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2927\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2927\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2927","relative":"#2927","full":"gitlab-org\/gitaly#2927"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":null},{"id":50011205,"iid":2905,"project_id":2009901,"title":"Filter environment variables when executing custom hooks","description":"Our hooks use a set of environment variables to pass along information across processes that's required to be operational. While we cannot help using these variables, we should make sure to filter out any envvars when executing custom hooks such that these custom hooks won't accidentally start depending on internal variables that weren't meant to be public in the first place.\n\nThus, executing custom hooks with the equivalent of `execve(3P)` would avoid us breaking customer's scripts if they unknowingly started using internal variables, allowing us to keep iterating here without fear of breakage.\n\nI'm labelling this as a bug as exposing internal variables to custom hooks is unintentional at best.","state":"closed","created_at":1592978647413,"updated_at":1621505629646,"closed_at":1621505629632,"closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"labels":["Category:Gitaly","[deprecated] Accepting merge requests","devops::create","group::gitaly","priority::3","section::dev","severity::4","type::bug"],"milestone":{"id":1233759,"iid":55,"group_id":9970,"title":"13.8","description":"https:\/\/about.gitlab.com\/releases\/archives.html","state":"closed","created_at":"2020-04-09T17:44:13.983Z","updated_at":"2022-04-13T14:51:23.220Z","due_date":"2021-01-17","start_date":"2020-12-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/55"},"assignees":[{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"}],"author":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"type":"ISSUE","assignee":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2905","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2905","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2905\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2905\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2905","relative":"#2905","full":"gitlab-org\/gitaly#2905"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":48198631,"iid":2889,"project_id":2009901,"title":"Push to gitlab.com fails with zeroPaddedFilemode: contains zero-padded file modes","description":"Customer has started to mirror some of their repos from their local gitlab (self-managed) to the new remote one (gitlab.com), but running into an issue with one of their repositories, Jquery, which returns this error: \n\n```\n13:close stream to gitaly-ruby: rpc error: code = Unknown desc = Gitlab::Git::CommandError: remote: error: object a98f1b7a267865bb78ef2a54ed54b67fbad6c839: zeroPaddedFilemode: contains zero-padded file modes       \nremote: fatal: fsck error in packed object       \nerror: remote unpack failed: index-pack abnormal exit\nTo\n ! [remote rejected]   master -&gt; master (unpacker error)\n! [remote rejected]   3.x-stable -&gt; 3.x-stable (unpacker error)\n! [remote rejected]   secure-buildFragment -&gt; secure-buildFragment (unpacker error)\n! [remote rejected]   1.12-stable -&gt; 1.12-stable (unpacker error)\n! [remote rejected]   2.2-stable -&gt; 2.2-stable (unpacker error)\n! [remote rejected]   feature\/Patch.2.2 -&gt; feature\/Patch.2.2 (unpacker error)\n! [remote rejected]   mgol\/test-flakiness -&gt; mgol\/test-flakiness (unpacker error)\nerror: failed to push some refs to &#39;[FILTERED]@gitlab.com\/<customername>\/3rdpartytools\/jquery.git&#39;\n```\nThey also tried mirroring this manually as follows: \n\n```\nC:\\projects\\jquery [master \u2261]> git remote rename origin old-origin\nC:\\projects\\jquery [master \u2261]> git remote add origin https:\/\/gitlab.com\/<customername>\/3rdpartytools\/jquery.git\nC:\\projects\\jquery [master \u2261]> git push -u origin --all\nEnumerating objects: 37001, done.\nCounting objects: 100% (37001\/37001), done.\nDelta compression using up to 4 threads\nCompressing objects: 100% (9856\/9856), done.\nWriting objects: 100% (37001\/37001), 21.80 MiB | 1.80 MiB\/s, done.\nTotal 37001 (delta 26510), reused 36878 (delta 26419)\nremote: error: object a98f1b7a267865bb78ef2a54ed54b67fbad6c839: zeroPaddedFilemode: contains zero-padded file modes\nremote: fatal: fsck error in packed object\nerror: remote unpack failed: index-pack abnormal exit\nTo https:\/\/gitlab.com\/<customername>\/3rdpartytools\/jquery.git\n! [remote rejected]   master -> master (unpacker error)\nerror: failed to push some refs to 'https:\/\/gitlab.com\/<customername>\/3rdpartytools\/jquery.git'\nC:\\projects\\jquery [master \u2261]>\n```\nThe following are two issues where it looks like the error was reported before, but no clear indication as to the resolution without having to necessarily repair the source repo.\n\n- [Pushing fails if local repo has problems with zero-padded file modes - 22095](https:\/\/gitlab.com\/gitlab-org\/gitlab-foss\/-\/issues\/22095)\n- [Pushing fails if local repo has problems with zero-padded file modes - 1602](https:\/\/gitlab.com\/gitlab-org\/omnibus-gitlab\/-\/issues\/1602)","state":"closed","created_at":1592500059351,"updated_at":1637044361464,"closed_at":1637044361448,"closed_by":{"id":660180,"username":"toon","name":"Toon Claes","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/660180\/avatar.png","web_url":"https:\/\/gitlab.com\/toon"},"labels":["Category:Gitaly","customer","devops::create","group::gitaly","priority::4","section::dev","severity::4"],"milestone":{"id":2114817,"iid":66,"group_id":9970,"title":"14.5","description":"https:\/\/about.gitlab.com\/releases\/archives.html","state":"closed","created_at":"2021-06-23T04:59:45.082Z","updated_at":"2022-04-21T07:25:45.431Z","due_date":"2021-11-17","start_date":"2021-10-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/66"},"assignees":[{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"}],"author":{"id":4709667,"username":"laurie_howitt","name":"Laurie Howitt","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4709667\/avatar.png","web_url":"https:\/\/gitlab.com\/laurie_howitt"},"type":"ISSUE","assignee":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"user_notes_count":22,"merge_requests_count":1,"upvotes":3,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2889","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2889","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2889\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2889\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2889","relative":"#2889","full":"gitlab-org\/gitaly#2889"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":45200352,"iid":2880,"project_id":2009901,"title":"Repair nodes on failed reference transaction vote","description":"When voting on a reference transaction fails, we should schedule replication jobs to get all secondaries up-to-date again that have disagreeing votes compared to the primary. This is especially important as soon as we have implemented a voting strategy that can reach quorum even if any of the nodes has cast a disagreeing vote.","state":"closed","created_at":1592312427340,"updated_at":1595056013105,"closed_at":1594760027458,"closed_by":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"},"labels":["Category:Gitaly","Deliverable","devops::create","group::gitaly","type::feature","workflow::in review"],"milestone":{"id":1233746,"iid":49,"group_id":9970,"title":"13.2","description":"https:\/\/about.gitlab.com\/releases\/2020\/07\/22\/gitlab-13-2-released\/","state":"closed","created_at":"2020-04-09T17:28:01.032Z","updated_at":"2022-04-13T14:48:24.167Z","due_date":"2020-07-17","start_date":"2020-06-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/49"},"assignees":[{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"}],"author":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"type":"ISSUE","assignee":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"user_notes_count":2,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2880","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2880","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2880\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2880\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2880","relative":"#2880","full":"gitlab-org\/gitaly#2880"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1189.0,"epic":{"id":5989,"iid":1189,"title":"Gitaly Cluster: strong consistency","url":"\/groups\/gitlab-org\/-\/epics\/1189","group_id":9970,"human_readable_end_date":"Sep 17, 2021","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":43404810,"iid":2870,"project_id":2009901,"title":"Implement voting strategies for the transaction manager","description":"The transaction manager currently supports a single voting strategy, only: all registered nodes need to cast the same vote, otherwise the transaction will be aborted. In order to support more scenarios and become more resilient to failures, we want to implement additional strategies:\n\n- Implement a mechanism to reach quorum such that a subset of nodes may fail.\n- Implement weighted voting such that it's possible to say e.g. that a primary node may never fail, but a subset of secondaries may.","state":"closed","created_at":1592205187107,"updated_at":1595056013184,"closed_at":1593756453715,"closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"labels":["Category:Gitaly","Deliverable","devops::create","group::gitaly","group::gitaly::cluster","type::feature","workflow::in dev"],"milestone":{"id":1233746,"iid":49,"group_id":9970,"title":"13.2","description":"https:\/\/about.gitlab.com\/releases\/2020\/07\/22\/gitlab-13-2-released\/","state":"closed","created_at":"2020-04-09T17:28:01.032Z","updated_at":"2022-04-13T14:48:24.167Z","due_date":"2020-07-17","start_date":"2020-06-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/49"},"assignees":[{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"}],"author":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"type":"ISSUE","assignee":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"user_notes_count":12,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2870","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2870","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2870\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2870\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2870","relative":"#2870","full":"gitlab-org\/gitaly#2870"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1189.0,"epic":{"id":5989,"iid":1189,"title":"Gitaly Cluster: strong consistency","url":"\/groups\/gitlab-org\/-\/epics\/1189","group_id":9970,"human_readable_end_date":"Sep 17, 2021","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":38118155,"iid":2855,"project_id":2009901,"title":"Protobuf generation behaves differently on CI","description":"Our protobuf code generation sometimes behaves differently on CI vs locally. Our code generation process is supposed to download and install all the correct versions of software so that this is deterministic, yet it continues to not be.","state":"closed","created_at":1591715869225,"updated_at":1600175669531,"closed_at":1600175159127,"closed_by":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"labels":["Category:Gitaly","backstage [DEPRECATED]","devops::create","group::gitaly","priority::3","section::dev","severity::3","type::bug","workflow::ready for development"],"milestone":{"id":1233753,"iid":51,"group_id":9970,"title":"13.4","description":"https:\/\/about.gitlab.com\/releases\/2020\/09\/22\/gitlab-13-4-released\/","state":"closed","created_at":"2020-04-09T17:39:21.662Z","updated_at":"2022-04-13T14:50:33.769Z","due_date":"2020-09-17","start_date":"2020-08-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/51"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"}],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"user_notes_count":12,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2855","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2855","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2855\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2855\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2855","relative":"#2855","full":"gitlab-org\/gitaly#2855"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":38110588,"iid":2854,"project_id":2009901,"title":"Makefile test target should have prereq to check Git version","description":"Many of Gitaly's tests depend on the correct minimum version of Git being installed. To save contributors wasted time and effort, the version can be detected prior to running tests and the contributor can be alerted if the version is not supported.","state":"closed","created_at":1591715636176,"updated_at":1642748768387,"closed_at":1642748768380,"closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"labels":["Category:Gitaly","[deprecated] good for new contributors","backstage [DEPRECATED]","devops::create","group::gitaly","section::dev"],"milestone":null,"assignees":[],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"type":"ISSUE","assignee":null,"user_notes_count":8,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2854","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2854","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2854\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2854\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2854","relative":"#2854","full":"gitlab-org\/gitaly#2854"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":37849669,"iid":2853,"project_id":2009901,"title":"Run tests against git-core's master branch","description":"With the new build-git target, we can now quickly build Git from the master branch. In order to catch issues with upcoming Git releases early on, we should start to run our tests against Git's master branch. This will be of benefit both to us to be aware of any backwards-incompatible changes as well as to git-core as we'll find newly introduced bugs fairly quick.","state":"closed","created_at":1591706847563,"updated_at":1621505523627,"closed_at":1621505523613,"closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"labels":["Category:Gitaly","[deprecated] Accepting merge requests","backstage [DEPRECATED]","devops::create","group::gitaly","section::dev"],"milestone":{"id":1233753,"iid":51,"group_id":9970,"title":"13.4","description":"https:\/\/about.gitlab.com\/releases\/2020\/09\/22\/gitlab-13-4-released\/","state":"closed","created_at":"2020-04-09T17:39:21.662Z","updated_at":"2022-04-13T14:50:33.769Z","due_date":"2020-09-17","start_date":"2020-08-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/51"},"assignees":[{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"}],"author":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"type":"ISSUE","assignee":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2853","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2853","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2853\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2853\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2853","relative":"#2853","full":"gitlab-org\/gitaly#2853"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":36039988,"iid":2852,"project_id":2009901,"title":"On hosts without the 'en_US.UTF-8' locale, output from popen_with_timeout will be US-ASCII encoded rather than UTF-8","description":"Gitaly sets [environment variable `LANG=en_US.UTF-8`](https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/blob\/v13.0.5\/internal\/command\/command.go#L27-30) for all child git processes, as well as Gitaly-Ruby. On hosts that do not have the `en_US.UTF-8` locale installed this causes Ruby to fall back to `US-ASCII` (7-bit) encoding by default, even if they are using a different UTF-8 locale.\r\n\r\nAs a result, UTF-8 encoded output from [`popen_with_timeout`](https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/blob\/v13.0.5\/ruby\/lib\/gitlab\/git\/popen.rb#L50) will trigger `ArgumentError: invalid byte sequence in US-ASCII` errors when string parsing methods are executed on it. A customer experienced this with [`sanitize_url`](https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/blob\/v13.0.5\/ruby\/lib\/gitaly_server\/utils.rb#L74-76) when `UpdateRemoteMirror` returned an error, but there are probably other places this could occur as well.\r\n\r\nOn a host using `de_DE.UTF-8` as its locale:\r\n\r\n```sh\r\n$ LANG=de_DE.UTF-8 \/opt\/gitlab\/embedded\/ruby -e 'p Encoding.default_external'\r\n#<Encoding:UTF-8>\r\n\r\n$ LANG=en_US.UTF-8 \/opt\/gitlab\/embedded\/ruby -e 'p Encoding.default_external'\r\n#<Encoding:US-ASCII>\r\n\r\n$ locale -a\r\nC\r\nC.UTF-8\r\nde_DE.utf8\r\nPOSIX\r\n\r\n$ locale -v\r\nLANG=de_DE.UTF-8\r\nLANGUAGE=\r\nLC_CTYPE=\"de_DE.UTF-8\"\r\nLC_NUMERIC=\"de_DE.UTF-8\"\r\nLC_TIME=\"de_DE.UTF-8\"\r\nLC_COLLATE=\"de_DE.UTF-8\"\r\nLC_MONETARY=\"de_DE.UTF-8\"\r\nLC_MESSAGES=\"de_DE.UTF-8\"\r\nLC_PAPER=\"de_DE.UTF-8\"\r\nLC_NAME=\"de_DE.UTF-8\"\r\nLC_ADDRESS=\"de_DE.UTF-8\"\r\nLC_TELEPHONE=\"de_DE.UTF-8\"\r\nLC_MEASUREMENT=\"de_DE.UTF-8\"\r\nLC_IDENTIFICATION=\"de_DE.UTF-8\"\r\nLC_ALL=\r\n```\r\n\r\nOn a host using `en_US.UTF-8` and `de_DE.UTF-8` installed both work:\r\n\r\n```sh\r\n$ LANG=en_US.UTF-8 \/opt\/gitlab\/embedded\/ruby -e 'p Encoding.default_external'\r\n#<Encoding:UTF-8>\r\n\r\nLANG=de_DE.UTF-8 ruby -e 'p Encoding.default_external'\r\n#<Encoding:UTF-8>\r\n\r\nLANG=ar_EG.UTF-8 ruby -e 'p Encoding.default_external'  # Using another UTF-8 encoding as an example\r\n#<Encoding:US-ASCII>\r\n\r\n$ locale -a\r\nC\r\nC.UTF-8\r\nPOSIX\r\nde_DE.utf8\r\nen_US.utf8\r\n\r\n$ locale -v\r\nLANG=en_US.UTF-8\r\nLANGUAGE=\r\nLC_CTYPE=\"en_US.UTF-8\"\r\nLC_NUMERIC=\"en_US.UTF-8\"\r\nLC_TIME=\"en_US.UTF-8\"\r\nLC_COLLATE=\"en_US.UTF-8\"\r\nLC_MONETARY=\"en_US.UTF-8\"\r\nLC_MESSAGES=en_US.UTF-8\r\nLC_PAPER=\"en_US.UTF-8\"\r\nLC_NAME=\"en_US.UTF-8\"\r\nLC_ADDRESS=\"en_US.UTF-8\"\r\nLC_TELEPHONE=\"en_US.UTF-8\"\r\nLC_MEASUREMENT=\"en_US.UTF-8\"\r\nLC_IDENTIFICATION=\"en_US.UTF-8\"\r\nLC_ALL=\r\n```","state":"closed","created_at":1591627700520,"updated_at":1595056013218,"closed_at":1593413367959,"closed_by":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"labels":["Category:Gitaly","Deliverable","Gitaly","Gitaly-Ruby","customer","devops::create","encoding","group::gitaly","priority::4","severity::3","type::bug"],"milestone":{"id":1233746,"iid":49,"group_id":9970,"title":"13.2","description":"https:\/\/about.gitlab.com\/releases\/2020\/07\/22\/gitlab-13-2-released\/","state":"closed","created_at":"2020-04-09T17:28:01.032Z","updated_at":"2022-04-13T14:48:24.167Z","due_date":"2020-07-17","start_date":"2020-06-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/49"},"assignees":[{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"}],"author":{"id":2578846,"username":"wchandler","name":"Will Chandler","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/cc8b92738249753faee7055e021f8221?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/wchandler"},"type":"ISSUE","assignee":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"user_notes_count":3,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2852","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2852","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2852\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2852\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2852","relative":"#2852","full":"gitlab-org\/gitaly#2852"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":35722317,"iid":2851,"project_id":2009901,"title":"Pass down \"primary\"\/\"secondary\" info to Gitaly nodes to avoid executing Git hooks on secondaries","description":"When proxying Git operations to multiple nodes at once, each node needs to know whether it's a primary node or a secondary node. This information is required such that nodes can decide whether they should execute custom hooks or not, where only the primary should do so.","state":"closed","created_at":1591597436834,"updated_at":1595056013251,"closed_at":1592807672847,"closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"labels":["Category:Gitaly","Deliverable","devops::create","group::gitaly","group::gitaly::cluster","priority::3","severity::3","type::feature"],"milestone":{"id":1233746,"iid":49,"group_id":9970,"title":"13.2","description":"https:\/\/about.gitlab.com\/releases\/2020\/07\/22\/gitlab-13-2-released\/","state":"closed","created_at":"2020-04-09T17:28:01.032Z","updated_at":"2022-04-13T14:48:24.167Z","due_date":"2020-07-17","start_date":"2020-06-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/49"},"assignees":[{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"}],"author":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"type":"ISSUE","assignee":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"user_notes_count":3,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2851","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2851","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2851\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2851\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2851","relative":"#2851","full":"gitlab-org\/gitaly#2851"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1189.0,"epic":{"id":5989,"iid":1189,"title":"Gitaly Cluster: strong consistency","url":"\/groups\/gitlab-org\/-\/epics\/1189","group_id":9970,"human_readable_end_date":"Sep 17, 2021","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":35479331,"iid":2846,"project_id":2009901,"title":"Remove multi-byte  support in the `lines` package","description":"The lines package takes some input, and splits it on a delimiter, and sends the output as defined by a `Sender()`. There's currently support for multi byte delimiters, which is both unused, and broken.\n\nBroken because for example using twice the same byte as delimiter will not send any results. There's currently no call site using this feature, nor test coverage for it. Therefor we should remove it.","state":"closed","created_at":1591361678166,"updated_at":1595402157802,"closed_at":1595401352329,"closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"labels":["Category:Gitaly","backstage [DEPRECATED]","devops::create","group::gitaly","missed:13.2","type::bug","workflow::ready for development"],"milestone":{"id":1233752,"iid":50,"group_id":9970,"title":"13.3","description":"https:\/\/about.gitlab.com\/releases\/2020\/08\/22\/gitlab-13-3-released\/","state":"closed","created_at":"2020-04-09T17:39:21.090Z","updated_at":"2022-04-13T14:50:18.976Z","due_date":"2020-08-17","start_date":"2020-07-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/50"},"assignees":[{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"type":"ISSUE","assignee":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2846","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2846","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2846\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2846\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2846","relative":"#2846","full":"gitlab-org\/gitaly#2846"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":35363262,"iid":2840,"project_id":2009901,"title":"Lock worktrees while they are still in use","description":"The following discussion from !2202 should be addressed:\n\n- [ ] @pks-t started a [discussion](https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/merge_requests\/2202#note_353463326):  (+5 comments)\n\n> I also wonder whether it would make sense to start using worktree locks. Currently, the logic will always remove worktrees older than a given threshold. If the threshold is small enough, I could see us removing worktrees that are still in use currently. Iff worktrees are strictly tied to a given operation (are they?), then we could tell the operation to first lock the worktree via git worktree lock <MSG> and consequentially unlock the worktree after the operation has finished. That'd guarantee that we do not delete any worktrees that are still in use. The message could also be chosen in such a way that we know what operation had it locked and when it was locked to give additional context. Naturally, it could happen that a worktree still doesn't get removed cause the operation failed mid-way through and didn't unlock, but we could have another, higher, threshold for that.\n\n- @johncai notes:\n\n> We could easily add something in the `def with_worktree` function that adds a worktree lock. If this change makes sense on its own, maybe we can create a follow up issue?","state":"closed","created_at":1591168156931,"updated_at":1652787109550,"closed_at":1652787109536,"closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"labels":["Category:Gitaly","[deprecated] Accepting merge requests","devops::create","group::gitaly","section::dev","type::feature"],"milestone":{"id":490705,"iid":14,"group_id":9970,"title":"Backlog","description":"Issues that we want to do but are not planned right now. Open for contribution from the community.","state":"active","created_at":"2018-03-22T13:09:23.767Z","updated_at":"2018-10-30T14:56:54.069Z","due_date":null,"start_date":null,"expired":false,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/14"},"assignees":[],"author":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"type":"ISSUE","assignee":null,"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2840","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":1,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2840","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2840\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2840\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2840","relative":"#2840","full":"gitlab-org\/gitaly#2840"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":null},{"id":35350580,"iid":2838,"project_id":2009901,"title":"Omnibus Gitaly dashboard should support multiple nodes","description":"During the 2020-05-27 demo, it was observed that the Omnibus Gitaly dashboard does not show more than one Gitaly at a time. Some of the panels, such as the current version, don't even support more than one Gitaly node (should instead be a table). The dashboard only allows viewing Gitalies with job set to \"gitaly\", while Praefect Gitaly nodes have a job of \"praefect-gitaly\". This should also be an option when selecting Gitalies.","state":"closed","created_at":1591125521346,"updated_at":1595056013286,"closed_at":1594733863316,"closed_by":{"id":64248,"username":"stanhu","name":"Stan Hu","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/64248\/stanhu.jpg","web_url":"https:\/\/gitlab.com\/stanhu"},"labels":["Category:Gitaly","Deliverable","Observability","demo","devops::create","group::gitaly","group::gitaly::cluster","workflow::in review"],"milestone":{"id":1233746,"iid":49,"group_id":9970,"title":"13.2","description":"https:\/\/about.gitlab.com\/releases\/2020\/07\/22\/gitlab-13-2-released\/","state":"closed","created_at":"2020-04-09T17:28:01.032Z","updated_at":"2022-04-13T14:48:24.167Z","due_date":"2020-07-17","start_date":"2020-06-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/49"},"assignees":[{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"}],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"type":"ISSUE","assignee":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"user_notes_count":3,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2838","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2838","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2838\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2838\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2838","relative":"#2838","full":"gitlab-org\/gitaly#2838"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2013.0,"epic":{"id":13406,"iid":2013,"title":"\ud83c\udf3f Gitaly Cluster: Distribute Git read operations across Gitaly nodes","url":"\/groups\/gitlab-org\/-\/epics\/2013","group_id":9970,"human_readable_end_date":"Mar 17, 2021","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":35316409,"iid":2834,"project_id":2009901,"title":"Distribute reads between all shards, including primaries","description":"#### Problem\n\nCurrently, the read distribution feature skips the primary node from serving read traffic. This is an understandable choice, given writes are more expensive than reads. But soon the write load will be distributed too with the introduction on transaction. Than the load isn't balanced anymore.\n\n#### Solution\n\nPrimary nodes get as much read traffic as any other node.","state":"closed","created_at":1591102857825,"updated_at":1591894969851,"closed_at":1591823308982,"closed_by":{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/228150\/avatar.png","web_url":"https:\/\/gitlab.com\/proglottis"},"labels":["Category:Gitaly","Stretch","devops::create","group::gitaly","type::feature","workflow::in review"],"milestone":{"id":1112145,"iid":47,"group_id":9970,"title":"13.1","description":"","state":"closed","created_at":"2020-01-03T12:28:30.160Z","updated_at":"2020-10-08T12:01:07.361Z","due_date":"2020-06-17","start_date":"2020-05-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/47"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"user_notes_count":2,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2834","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2834","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2834\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2834\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2834","relative":"#2834","full":"gitlab-org\/gitaly#2834"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2013.0,"epic":{"id":13406,"iid":2013,"title":"\ud83c\udf3f Gitaly Cluster: Distribute Git read operations across Gitaly nodes","url":"\/groups\/gitlab-org\/-\/epics\/2013","group_id":9970,"human_readable_end_date":"Mar 17, 2021","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":35255594,"iid":2827,"project_id":2009901,"title":"Praefect: Coordinator.StreamDirector doesn't handle STORAGE scope correctly","description":"Current implementation of [`StreamDirector`](https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/blob\/d08b7024a0a2882dc55d8a480d891fc0ded5bb9b\/internal\/praefect\/coordinator.go#L217) doesn't properly handles requests with `scope_level: STORAGE` option, such as [`RemoveNamespace`](https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/blob\/d08b7024a0a2882dc55d8a480d891fc0ded5bb9b\/proto\/namespace.proto#L16) in case virtual storage name and storage name for gitaly differs, like: \n```\n[[virtual_storage]]\nname = 'praefect'\n[[virtual_storage.node]]\n  storage = \"gitaly-1\"\n```\nCoordinator doesn't re-write storage for such RPCs, so request will contain virtual storage name instead of mapped gitaly storage name.\n\nThere is an open https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/merge_requests\/2234 that can be used to verify this bug.  \nYou can check it with `gdk` and `TestPraefectHandlesStorageScopeRequests` test locally.\n\n\/cc @zj-gitlab @jramsay","state":"closed","created_at":1591002812011,"updated_at":1595333746578,"closed_at":1595332440840,"closed_by":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"labels":["Category:Gitaly","Stretch","devops::create","group::gitaly","group::gitaly::cluster","missed:13.2","priority::2","severity::2","type::bug","workflow::in review"],"milestone":{"id":1233752,"iid":50,"group_id":9970,"title":"13.3","description":"https:\/\/about.gitlab.com\/releases\/2020\/08\/22\/gitlab-13-3-released\/","state":"closed","created_at":"2020-04-09T17:39:21.090Z","updated_at":"2022-04-13T14:50:18.976Z","due_date":"2020-08-17","start_date":"2020-07-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/50"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"}],"author":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2827","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2827","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2827\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2827\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2827","relative":"#2827","full":"gitlab-org\/gitaly#2827"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":35144491,"iid":2820,"project_id":2009901,"title":"Configure Gitaly to schedule nightly repo optimization","description":"We have an RPC `OptimizeRepository` that is designed to be called to improve performance of repos. Currently, it is not being utilized by Rails. It may be very complex to figure out the best way to invoke it from Rails. A more incremental approach might be invoking it internally from Gitaly on a routine schedule (e.g. nights, weekends) similar to a cron job.","state":"closed","created_at":1590706983973,"updated_at":1618957669975,"closed_at":1600152927232,"closed_by":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"labels":["Category:Gitaly","Deliverable","bug::performance","devops::create","feature::addition","group::gitaly","missed-deliverable","missed:13.3","section::dev","workflow::verification"],"milestone":{"id":1233753,"iid":51,"group_id":9970,"title":"13.4","description":"https:\/\/about.gitlab.com\/releases\/2020\/09\/22\/gitlab-13-4-released\/","state":"closed","created_at":"2020-04-09T17:39:21.662Z","updated_at":"2022-04-13T14:50:33.769Z","due_date":"2020-09-17","start_date":"2020-08-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/51"},"assignees":[{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"}],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"type":"ISSUE","assignee":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"user_notes_count":16,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2820","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2820","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2820\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2820\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2820","relative":"#2820","full":"gitlab-org\/gitaly#2820"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":35039260,"iid":2815,"project_id":2009901,"title":"Connection caching in ReplicateRepository breaks due to v2 tokens","description":"In https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/commit\/54465275b27178af0268d1281a7f933585f29b0f we dropped support for v1 tokens. V2 tokens have a timestamp constraint. \r\n\r\nIt seems that this has broken replication in production. It's unclear if this is due to clock skew, but we are getting some `timestamp too old` errors","state":"closed","created_at":1590534644755,"updated_at":1591049730600,"closed_at":1590703650765,"closed_by":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"},"labels":["Category:Gitaly","devops::create","group::gitaly","group::gitaly::cluster","priority::1","severity::1","type::bug","workflow::in dev"],"milestone":{"id":1112145,"iid":47,"group_id":9970,"title":"13.1","description":"","state":"closed","created_at":"2020-01-03T12:28:30.160Z","updated_at":"2020-10-08T12:01:07.361Z","due_date":"2020-06-17","start_date":"2020-05-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/47"},"assignees":[{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"}],"author":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"},"type":"ISSUE","assignee":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"},"user_notes_count":14,"merge_requests_count":2,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2815","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2815","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2815\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2815\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2815","relative":"#2815","full":"gitlab-org\/gitaly#2815"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":34819026,"iid":2796,"project_id":2009901,"title":"Praefect migration to drop gitaly_ tables","description":"We have old migrations in some of our environments with the outdated `gitaly_` tables. We should write a migration that removes these. eg: here is the production environment:\n\n```\npraefect_production=> \\d+\n                                     List of relations\n Schema |               Name                |   Type   |  Owner  |    Size    | Description\n--------+-----------------------------------+----------+---------+------------+-------------\n public | gitaly_replication_queue          | table    | default | 8192 bytes |\n public | gitaly_replication_queue_id_seq   | sequence | default | 8192 bytes |\n public | gitaly_replication_queue_job_lock | table    | default | 8192 bytes |\n public | gitaly_replication_queue_lock     | table    | default | 8192 bytes |\n public | hello_world                       | table    | default | 8192 bytes |\n public | node_status                       | table    | default | 8192 bytes |\n public | node_status_id_seq                | sequence | default | 8192 bytes |\n public | replication_queue                 | table    | default | 8192 bytes |\n public | replication_queue_id_seq          | sequence | default | 8192 bytes |\n public | replication_queue_job_lock        | table    | default | 8192 bytes |\n public | replication_queue_lock            | table    | default | 8192 bytes |\n public | schema_migrations                 | table    | default | 16 kB      |\n public | shard_primaries                   | table    | default | 8192 bytes |\n public | shard_primaries_id_seq            | sequence | default | 8192 bytes |\n(14 rows)\n```","state":"closed","created_at":1590001674218,"updated_at":1592811446282,"closed_at":1590694038656,"closed_by":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"},"labels":["Category:Gitaly","Stretch","devops::create","group::gitaly","workflow::in review"],"milestone":{"id":1112145,"iid":47,"group_id":9970,"title":"13.1","description":"","state":"closed","created_at":"2020-01-03T12:28:30.160Z","updated_at":"2020-10-08T12:01:07.361Z","due_date":"2020-06-17","start_date":"2020-05-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/47"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"}],"author":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"user_notes_count":3,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2796","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2796","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2796\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2796\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2796","relative":"#2796","full":"gitlab-org\/gitaly#2796"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1491.0,"epic":{"id":8450,"iid":1491,"title":"\ud83c\udf3b Improved Gitaly Cluster admin experience","url":"\/groups\/gitlab-org\/-\/epics\/1491","group_id":9970,"human_readable_end_date":"Apr 22, 2020","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":"on_track","task_status":"0 of 0 checklist items completed"},{"id":34785714,"iid":2792,"project_id":2009901,"title":"Investigate sporadic Praefect metrics for replication latency and delay","description":"During the demo, we observed sporadic data for replication delay and latency metrics. We should verify the metrics are behaving as expected, or determine a fix to correct them.","state":"closed","created_at":1589956176284,"updated_at":1590588927926,"closed_at":1590586935545,"closed_by":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"labels":["Category:Gitaly","Observability","demo","devops::create","group::gitaly","group::gitaly::cluster"],"milestone":{"id":1112145,"iid":47,"group_id":9970,"title":"13.1","description":"","state":"closed","created_at":"2020-01-03T12:28:30.160Z","updated_at":"2020-10-08T12:01:07.361Z","due_date":"2020-06-17","start_date":"2020-05-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/47"},"assignees":[{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"}],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"type":"ISSUE","assignee":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"user_notes_count":4,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2020-05-26","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2792","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2792","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2792\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2792\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2792","relative":"#2792","full":"gitlab-org\/gitaly#2792"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1491.0,"epic":{"id":8450,"iid":1491,"title":"\ud83c\udf3b Improved Gitaly Cluster admin experience","url":"\/groups\/gitlab-org\/-\/epics\/1491","group_id":9970,"human_readable_end_date":"Apr 22, 2020","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":34785652,"iid":2791,"project_id":2009901,"title":"Expand Praefect dashboard panel for error rate to also include total rate","description":"The Omnibus Praefect dashboard has a panel for the error rate of certain RPC's proxied by Praefect. This panel lacks context from the total number of handled requests. This should be added.","state":"closed","created_at":1589956031107,"updated_at":1591056866467,"closed_at":1591056441315,"closed_by":{"id":787914,"username":"ibaum","name":"Ian Baum","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/7c508dc85ddd5049564a95662311543b?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/ibaum"},"labels":["Category:Gitaly","Observability","demo","devops::create","group::gitaly","group::gitaly::cluster","workflow::in review"],"milestone":{"id":1112145,"iid":47,"group_id":9970,"title":"13.1","description":"","state":"closed","created_at":"2020-01-03T12:28:30.160Z","updated_at":"2020-10-08T12:01:07.361Z","due_date":"2020-06-17","start_date":"2020-05-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/47"},"assignees":[{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"}],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"type":"ISSUE","assignee":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":"2020-05-26","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2791","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2791","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2791\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2791\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2791","relative":"#2791","full":"gitlab-org\/gitaly#2791"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":34775378,"iid":2786,"project_id":2009901,"title":"Improve Gitaly connection error messages","description":"A customer using a stand-alone Gitaly server recently ran into an issue where Gitaly-Ruby processes could not communicate with the main Gitaly process when executing `UserCommitFiles`.  Specifically, DNS was not responding when querying for the Gitaly hostname, but the error `rpc error: code = Unavailable desc = failed to connect to all addresses` gave no indication where the problem was occurring.\n\nIncluding the target that could not be connected to would make problems like this significantly easier to debug.\n\n\/cc @zj-gitlab","state":"closed","created_at":1589921748995,"updated_at":1596622501679,"closed_at":1596618762289,"closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"labels":["Category:Gitaly","Gitaly","Gitaly-Ruby","SLO::Missed","[deprecated] Accepting merge requests","blocked","customer","devops::create","group::gitaly","priority::2","severity::4","type::bug","workflow::ready for development"],"milestone":{"id":490705,"iid":14,"group_id":9970,"title":"Backlog","description":"Issues that we want to do but are not planned right now. Open for contribution from the community.","state":"active","created_at":"2018-03-22T13:09:23.767Z","updated_at":"2018-10-30T14:56:54.069Z","due_date":null,"start_date":null,"expired":false,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/14"},"assignees":[],"author":{"id":2578846,"username":"wchandler","name":"Will Chandler","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/cc8b92738249753faee7055e021f8221?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/wchandler"},"type":"ISSUE","assignee":null,"user_notes_count":9,"merge_requests_count":2,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2786","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2786","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2786\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2786\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2786","relative":"#2786","full":"gitlab-org\/gitaly#2786"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":34731720,"iid":2783,"project_id":2009901,"title":"Enable read-only mode only when there is data loss after a failover","description":"## Problem to solve\n\nCurrently read-only mode is enabled after any failover event. Read-only Git access is a reduction in availability and should be avoided where possible.\n\n## Proposal\n\nWe should only enable read-only mode if the virtual storage has data loss, that is, any repositories for which the last replication job is not in `completed` state.\n\ncc @zj-gitlab","state":"closed","created_at":1589888318356,"updated_at":1597734504432,"closed_at":1595884006195,"closed_by":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"labels":["Category:Gitaly","Deliverable","Gitaly","devops::create","group::gitaly","group::gitaly::cluster","missed-deliverable","missed:13.1","missed:13.2","type::feature","workflow::ready for development"],"milestone":{"id":1233752,"iid":50,"group_id":9970,"title":"13.3","description":"https:\/\/about.gitlab.com\/releases\/2020\/08\/22\/gitlab-13-3-released\/","state":"closed","created_at":"2020-04-09T17:39:21.090Z","updated_at":"2022-04-13T14:50:18.976Z","due_date":"2020-08-17","start_date":"2020-07-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/50"},"assignees":[{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/5522960\/avatar.png","web_url":"https:\/\/gitlab.com\/samihiltunen"}],"author":{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/5522960\/avatar.png","web_url":"https:\/\/gitlab.com\/samihiltunen"},"type":"ISSUE","assignee":{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/5522960\/avatar.png","web_url":"https:\/\/gitlab.com\/samihiltunen"},"user_notes_count":1,"merge_requests_count":1,"upvotes":2,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2783","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":1,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2783","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2783\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2783\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2783","relative":"#2783","full":"gitlab-org\/gitaly#2783"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2983.0,"epic":{"id":36565,"iid":2983,"title":"\ud83e\udd84 HA Gitaly: improved availability","url":"\/groups\/gitlab-org\/-\/epics\/2983","group_id":9970,"human_readable_end_date":"Jan 17, 2021","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":34712319,"iid":2780,"project_id":2009901,"title":"Replication queue size should have virtual storage label","description":"The Prometheus metric `gitaly_praefect_replication_jobs` should be broken down by virtual storages. This will allow us to compare replication queue pressure between virtual storages on the same Praefect or to aggregate virtual storage queue pressure between Praefects. This requires adding a label for the virtual storage to the metric.\n\nRelates to https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2659","state":"closed","created_at":1589843695102,"updated_at":1592464047732,"closed_at":1590738941167,"closed_by":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"labels":["Category:Gitaly","Deliverable","Observability","devops::create","group::gitaly","group::gitaly::cluster","workflow::in review"],"milestone":{"id":1112145,"iid":47,"group_id":9970,"title":"13.1","description":"","state":"closed","created_at":"2020-01-03T12:28:30.160Z","updated_at":"2020-10-08T12:01:07.361Z","due_date":"2020-06-17","start_date":"2020-05-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/47"},"assignees":[{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"}],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"type":"ISSUE","assignee":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"user_notes_count":2,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2780","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":1,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2780","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2780\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2780\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2780","relative":"#2780","full":"gitlab-org\/gitaly#2780"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1491.0,"epic":{"id":8450,"iid":1491,"title":"\ud83c\udf3b Improved Gitaly Cluster admin experience","url":"\/groups\/gitlab-org\/-\/epics\/1491","group_id":9970,"human_readable_end_date":"Apr 22, 2020","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":34595758,"iid":2771,"project_id":2009901,"title":"Clean up Ruby implementation for FetchInternalRemote","description":"After porting an RPC to Go the following tasks remain:\n\n- [x] Remove the feature flag, default to Go\n- [x] Wait 1 release\n- [ ] Remove the Ruby implementation","state":"closed","created_at":1589533696313,"updated_at":1595056013426,"closed_at":1593457098701,"closed_by":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"labels":["Category:Gitaly","Deliverable","backstage [DEPRECATED]","devops::create","group::gitaly","workflow::in dev"],"milestone":{"id":1233746,"iid":49,"group_id":9970,"title":"13.2","description":"https:\/\/about.gitlab.com\/releases\/2020\/07\/22\/gitlab-13-2-released\/","state":"closed","created_at":"2020-04-09T17:28:01.032Z","updated_at":"2022-04-13T14:48:24.167Z","due_date":"2020-07-17","start_date":"2020-06-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/49"},"assignees":[{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/228150\/avatar.png","web_url":"https:\/\/gitlab.com\/proglottis"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"type":"ISSUE","assignee":{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/228150\/avatar.png","web_url":"https:\/\/gitlab.com\/proglottis"},"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2771","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":3,"completed_count":2},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2771","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2771\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2771\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2771","relative":"#2771","full":"gitlab-org\/gitaly#2771"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":"on_track","task_status":null},{"id":34538258,"iid":2769,"project_id":2009901,"title":"Explore use of Git's trace2 mechanism","description":"When spawning Git executables, we currently cannot evaluate what Git actually does except for observing its runtime and usual stdout\/stderr. In order to allow better traceing of performance and events in Git, the trace2 mechanism was introduced in v2.22. We should evaluate whether hooking into this mechanism makes sense to get more insight into Git, improve visibility and ultimately to allow for better debugging of pathological cases.","state":"closed","created_at":1589443243833,"updated_at":1681797669256,"closed_at":1680151631656,"closed_by":{"id":7815314,"username":"qmnguyen0711","name":"Quang-Minh Nguyen","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/7815314\/avatar.png","web_url":"https:\/\/gitlab.com\/qmnguyen0711"},"labels":["Category:Gitaly","Engineering Allocation","Gitaly authx","devops::systems","group::gitaly","group::gitaly::git","maintenance::scalability","missed:15.10","missed:15.8","missed:15.9","section::enablement","type::maintenance","workflow::complete"],"milestone":{"id":2910456,"iid":86,"group_id":9970,"title":"15.11","description":"","state":"active","created_at":"2022-12-13T20:08:46.985Z","updated_at":"2022-12-13T20:08:46.985Z","due_date":"2023-04-17","start_date":"2023-03-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/86"},"assignees":[],"author":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"type":"ISSUE","assignee":null,"user_notes_count":24,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2769","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2769","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2769\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2769\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2769","relative":"#2769","full":"gitlab-org\/gitaly#2769"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":9538.0,"epic":{"id":688348,"iid":9538,"title":"\ud83d\udcef Collect Git insights through Trace2","url":"\/groups\/gitlab-org\/-\/epics\/9538","group_id":9970,"human_readable_end_date":"Apr 17, 2023","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":34501318,"iid":2767,"project_id":2009901,"title":"Documentation: How to remove the filterspec for a local repository","description":"During the Partial clone demo of 2020-05-12, the question was asked how to remove the filterspec from a repository and `git pull` to ensure everything is present. Currently the documentation do not provide this.\n\n### Proposal\n\nAdd a section to the documentation: https:\/\/docs.gitlab.com\/ee\/topics\/git\/partial_clone.html on how to unfilter a repository.\n\n\/cc @chriscool @jramsay","state":"closed","created_at":1589365312304,"updated_at":1595477736548,"closed_at":1595474500632,"closed_by":{"id":138401,"username":"chriscool","name":"Christian Couder","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/138401\/avatar.png","web_url":"https:\/\/gitlab.com\/chriscool"},"labels":["Category:Gitaly","demo","devops::create","documentation","group::gitaly","missed:13.1","missed:13.2","partial clone","workflow::ready for development"],"milestone":{"id":1233752,"iid":50,"group_id":9970,"title":"13.3","description":"https:\/\/about.gitlab.com\/releases\/2020\/08\/22\/gitlab-13-3-released\/","state":"closed","created_at":"2020-04-09T17:39:21.090Z","updated_at":"2022-04-13T14:50:18.976Z","due_date":"2020-08-17","start_date":"2020-07-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/50"},"assignees":[{"id":138401,"username":"chriscool","name":"Christian Couder","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/138401\/avatar.png","web_url":"https:\/\/gitlab.com\/chriscool"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"type":"ISSUE","assignee":{"id":138401,"username":"chriscool","name":"Christian Couder","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/138401\/avatar.png","web_url":"https:\/\/gitlab.com\/chriscool"},"user_notes_count":8,"merge_requests_count":3,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2767","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2767","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2767\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2767\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2767","relative":"#2767","full":"gitlab-org\/gitaly#2767"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":3790.0,"epic":{"id":75811,"iid":3790,"title":"Partial clone for binary files workflows (viable)","url":"\/groups\/gitlab-org\/-\/epics\/3790","group_id":9970,"human_readable_end_date":"Mar 17, 2021","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":34416474,"iid":2757,"project_id":2009901,"title":"InfoRefsUploadPack disk cache: file descriptors must be closed after use","description":"RPC method **InfoRefsUploadPack** uses a special cache based on the use of files.  \nEach requests tries to find a cache entry in it.  \nIf it exists the data would be read from it and returned as a result of the call.  \nThe read is done with use of `[os.Open(respPath)](https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/blob\/v13.0.0-rc1\/internal\/cache\/cachedb.go#L92)` and `[io.Copy(w, stream)](https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/blob\/v13.0.0-rc1\/internal\/service\/smarthttp\/cache.go#L63)`.  \nBut the call to `stream.Close()` is missing and it results to file descriptors leak.  \n\n\/cc @zj-gitlab @jramsay","state":"closed","created_at":1589224750916,"updated_at":1589302261425,"closed_at":1589300687136,"closed_by":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"labels":["Category:Gitaly","devops::create","group::gitaly","type::bug"],"milestone":{"id":991112,"iid":42,"group_id":9970,"title":"13.0","description":"","state":"closed","created_at":"2019-09-04T15:20:39.024Z","updated_at":"2020-10-08T12:00:55.725Z","due_date":"2020-05-17","start_date":"2020-04-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/42"},"assignees":[],"author":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"type":"ISSUE","assignee":null,"user_notes_count":2,"merge_requests_count":1,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2757","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2757","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2757\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2757\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2757","relative":"#2757","full":"gitlab-org\/gitaly#2757"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":34383340,"iid":2756,"project_id":2009901,"title":"Gitaly tmp folder cleanup must run every hour","description":"Gitaly uses a special directory as a temporary folder named `tmp`.  \nIt has a [special background task](https:\/\/gitlab.com\/search?group_id=&nav_source=navbar&project_id=2009901&repository_ref=v13.0.0-rc1&search=StartCleaning()&search_code=true&utf8=%E2%9C%93#L79) that must run each hour to clean up stale files in it.\nBut now it runs only once after start\/restart because the call is not wrapped into the infinite loop.  \nIt could be observed by checking logs that a missed log entry for each hour.  \nThere are only entries after the service restart ![image](\/uploads\/eab41b2518b95f005e15271459f7cea6\/image.png)\n\n\/cc @zj-gitlab @jramsay","state":"closed","created_at":1589183692032,"updated_at":1596747522096,"closed_at":1594149315601,"closed_by":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"labels":["Category:Gitaly","Gitaly","[deprecated] Accepting merge requests","[deprecated] good for new contributors","devops::create","group::gitaly","priority::2","severity::3","type::bug"],"milestone":{"id":490705,"iid":14,"group_id":9970,"title":"Backlog","description":"Issues that we want to do but are not planned right now. Open for contribution from the community.","state":"active","created_at":"2018-03-22T13:09:23.767Z","updated_at":"2018-10-30T14:56:54.069Z","due_date":null,"start_date":null,"expired":false,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/14"},"assignees":[],"author":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"type":"ISSUE","assignee":null,"user_notes_count":7,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2756","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2756","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2756\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2756\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2756","relative":"#2756","full":"gitlab-org\/gitaly#2756"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":34305990,"iid":2741,"project_id":2009901,"title":"Port FetchSourceBranch to Go","description":"In %\"13.0\" FetchInternalRemote was ported to Go, and it seems like FetchSourceBranch does about the same things, but is still in Ruby. That makes it unreliable, while it could be ported to Go. Which would improve our SLA for the RPC, and maybe performance too.","state":"closed","created_at":1588930728591,"updated_at":1611645882897,"closed_at":1611645882856,"closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"labels":["Category:Gitaly","bug::performance","devops::create","group::gitaly","missed:13.1","missed:13.4","missed:13.5","missed:13.6","section::dev","type::maintenance","workflow::verification"],"milestone":{"id":1233760,"iid":56,"group_id":9970,"title":"13.9","description":"https:\/\/about.gitlab.com\/releases\/archives.html","state":"closed","created_at":"2020-04-09T17:44:14.334Z","updated_at":"2022-04-21T07:21:28.468Z","due_date":"2021-02-17","start_date":"2021-01-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/56"},"assignees":[{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"type":"ISSUE","assignee":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"user_notes_count":6,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2741","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2741","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2741\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2741\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2741","relative":"#2741","full":"gitlab-org\/gitaly#2741"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2862.0,"epic":{"id":30693,"iid":2862,"title":"\ud83c\udfcd Remove the Gitaly-Ruby sidecar","url":"\/groups\/gitlab-org\/-\/epics\/2862","group_id":9970,"human_readable_end_date":"May 17, 2023","human_readable_timestamp":"<strong>11<\/strong> days remaining"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":34095215,"iid":2729,"project_id":2009901,"title":"Update Source install instructions to use `make build-git`","description":"[Source install documentation](https:\/\/docs.gitlab.com\/ee\/install\/installation.html) includes instructions for installing Git. It has to be present to obtain the source, but needs to have the correct version too. \n\n### Proposal\n\nRemove the Git install from the dependencies section: https:\/\/docs.gitlab.com\/ee\/install\/installation.html#1-packages-and-dependencies, and move it to Gitaly to leverage `make download-git`.","state":"closed","created_at":1588581101227,"updated_at":1620215789082,"closed_at":1605596929557,"closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"labels":["Category:Gitaly","Deliverable","devops::create","documentation","group::gitaly","missed-deliverable","missed:13.5","section::dev","workflow::in dev"],"milestone":{"id":1233755,"iid":53,"group_id":9970,"title":"13.6","description":"https:\/\/about.gitlab.com\/releases\/2020\/11\/22\/gitlab-13-6-released\/","state":"closed","created_at":"2020-04-09T17:39:22.328Z","updated_at":"2022-04-13T14:51:04.376Z","due_date":"2020-11-17","start_date":"2020-10-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/53"},"assignees":[{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"type":"ISSUE","assignee":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https:\/\/secure.gravatar.com\/avatar\/0fec8836f293852876f02d1afd7f2aaf?s=80&d=identicon","web_url":"https:\/\/gitlab.com\/pks-gitlab"},"user_notes_count":5,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2729","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2729","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2729\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2729\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2729","relative":"#2729","full":"gitlab-org\/gitaly#2729"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":3196.0,"epic":{"id":49057,"iid":3196,"title":"1\ufe0f\u20e3 Distribute one Git throughout GitLab","url":"\/groups\/gitlab-org\/-\/epics\/3196","group_id":9970,"human_readable_end_date":"Apr 17, 2021","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":34086193,"iid":2727,"project_id":2009901,"title":"Frame-wise proxying of write operations to Gitaly replicas","description":"## Problem to solve\n\nWhen a success signal is sent via the Git protocol or an RPC for a write operation from a HA Gitaly cluster, we want the success signal to communicate that the write has succeeded in multiple locations so that a single node failure does not result in data loss.\n\nWrite operations are currently routed only to the primary node. This data also needs to be sent to the other nodes in the cluster.\n\n## Further details\n\nReplaying the write operation from the primary to the secondary nodes is not ideal from a performance or reliability perspective.\n\nIt should be possible to proxy the write to all the Gitaly nodes. The simplest approach is frame-wise proxying, but if one node is slow, this will block all the nodes. In the future, stream-wise proxying would solve this.\n\n## Proposal\n\nImplement frame-wise proxying of write operations to all Gitaly nodes as part of strong consistency.\n\n## Testing\n\nFunctional end-to-end coverage is provided by an existing [replication test](https:\/\/gitlab.com\/gitlab-org\/gitlab\/-\/merge_requests\/27972). And broad coverage by [running the entire end-to-end test suite against environments using Praefect for storage](https:\/\/gitlab.com\/gitlab-org\/gitlab-qa\/-\/blob\/master\/docs\/what_tests_can_be_run.md#testintegrationpraefect-ceeefull-image-address) (including Staging).\n\nPerformance end-to-end testing will be implemented as part of https:\/\/gitlab.com\/gitlab-org\/quality\/performance\/-\/issues\/231 (see https:\/\/gitlab.com\/gitlab-org\/quality\/team-tasks\/-\/issues\/451 for a more detailed plan of performance tests under failure conditions)\n\n## Links \/ references","state":"closed","created_at":1588567137604,"updated_at":1595056013506,"closed_at":1594054794180,"closed_by":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"},"labels":["Category:Gitaly","Deliverable","devops::create","group::gitaly","group::gitaly::cluster","missed-deliverable","missed:13.1","quad-planning::complete-action","type::feature","workflow::in review"],"milestone":{"id":1233746,"iid":49,"group_id":9970,"title":"13.2","description":"https:\/\/about.gitlab.com\/releases\/2020\/07\/22\/gitlab-13-2-released\/","state":"closed","created_at":"2020-04-09T17:28:01.032Z","updated_at":"2022-04-13T14:48:24.167Z","due_date":"2020-07-17","start_date":"2020-06-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/49"},"assignees":[{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"}],"author":{"id":1187333,"username":"jramsay-gitlab","name":"James Ramsay (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/1187333\/avatar.png","web_url":"https:\/\/gitlab.com\/jramsay-gitlab"},"type":"ISSUE","assignee":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/668120\/avatar.png","web_url":"https:\/\/gitlab.com\/johncai"},"user_notes_count":9,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2727","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2727","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2727\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2727\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2727","relative":"#2727","full":"gitlab-org\/gitaly#2727"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1189.0,"epic":{"id":5989,"iid":1189,"title":"Gitaly Cluster: strong consistency","url":"\/groups\/gitlab-org\/-\/epics\/1189","group_id":9970,"human_readable_end_date":"Sep 17, 2021","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":33980450,"iid":2715,"project_id":2009901,"title":"Error in go FetchInternalRemote \"git fetch failed: signal: terminated\"","description":"`FetchInternalRemote` sometimes fails with `git fetch` getting SIGTERM. And returning an error as per https:\/\/github.com\/golang\/go\/blob\/go1.14.2\/src\/os\/exec_posix.go#L107\n\nhttps:\/\/log.gprd.gitlab.net\/app\/kibana#\/doc\/AW5F1OHTiGcMMNRn84Di\/pubsub-gitaly-inf-gprd-001969?id=wJYRx3EB_vQvi1G70XPU","state":"closed","created_at":1588207718535,"updated_at":1592289172260,"closed_at":1591758969198,"closed_by":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"labels":["Category:Gitaly","devops::create","group::gitaly","missed:13.0","priority::2","type::bug","workflow::ready for development"],"milestone":{"id":1112145,"iid":47,"group_id":9970,"title":"13.1","description":"","state":"closed","created_at":"2020-01-03T12:28:30.160Z","updated_at":"2020-10-08T12:01:07.361Z","due_date":"2020-06-17","start_date":"2020-05-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/47"},"assignees":[{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/228150\/avatar.png","web_url":"https:\/\/gitlab.com\/proglottis"}],"author":{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/228150\/avatar.png","web_url":"https:\/\/gitlab.com\/proglottis"},"type":"ISSUE","assignee":{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/228150\/avatar.png","web_url":"https:\/\/gitlab.com\/proglottis"},"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2715","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2715","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2715\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2715\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2715","relative":"#2715","full":"gitlab-org\/gitaly#2715"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2307.0,"epic":{"id":15983,"iid":2307,"title":"\ud83d\ude9c Improve Gitaly data migration tools","url":"\/groups\/gitlab-org\/-\/epics\/2307","group_id":9970,"human_readable_end_date":"Jul 17, 2022","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":33944108,"iid":2713,"project_id":2009901,"title":"Praefect added latency misjudging CalculateChecksum latency","description":"When looking at the added latency through Praefect, it seems like only CalculateChecksum has issues, which seems odd:\n\n![Screenshot_from_2020-04-28_13-58-50](\/uploads\/70ba78a22284b7f473fe04a6f2e5a669\/Screenshot_from_2020-04-28_13-58-50.png)\n\nChecksums are used extensively by Praefect, without proxying the RPC to a client. It seems like a bug in the metric.","state":"closed","created_at":1588155830489,"updated_at":1653879956123,"closed_at":1653879956108,"closed_by":{"id":1786152,"username":"gitlab-bot","name":"\ud83e\udd16 GitLab Bot \ud83e\udd16","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/1786152\/avatar.png","web_url":"https:\/\/gitlab.com\/gitlab-bot"},"labels":["Category:Gitaly","Observability","[deprecated] Accepting merge requests","auto closed","devops::create","group::gitaly","group::gitaly::cluster","priority::4","section::dev","severity::4","stale","type::bug","vintage"],"milestone":{"id":490705,"iid":14,"group_id":9970,"title":"Backlog","description":"Issues that we want to do but are not planned right now. Open for contribution from the community.","state":"active","created_at":"2018-03-22T13:09:23.767Z","updated_at":"2018-10-30T14:56:54.069Z","due_date":null,"start_date":null,"expired":false,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/14"},"assignees":[],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"type":"ISSUE","assignee":null,"user_notes_count":12,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2713","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2713","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2713\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2713\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2713","relative":"#2713","full":"gitlab-org\/gitaly#2713"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":33840434,"iid":2709,"project_id":2009901,"title":"Praefect: proper multi-virtual storage support","description":"Praefect has advantage of multi-virtual storages support in configuration, but in the [real life](https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/blob\/ca7faa446b4db4713ad128698d4130aa4de8a26e\/cmd\/praefect\/main.go#L250) it can't handle it properly.  \nCurrent routing logic doesn't support multi-virtual storage configuration and allows request routings only for single virtual storage. As well replication is also has no multi-virtual storage support, that affects a helper-subcommand: `dataloss` as well.  \nProper multi-virtual storages support is required before https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2650\n\n\/cc @jramsay @zj-gitlab","state":"closed","created_at":1587978225478,"updated_at":1589984157700,"closed_at":1589778226340,"closed_by":{"id":1187333,"username":"jramsay-gitlab","name":"James Ramsay (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/1187333\/avatar.png","web_url":"https:\/\/gitlab.com\/jramsay-gitlab"},"labels":["Category:Gitaly","devops::create","group::gitaly","group::gitaly::cluster","priority::2","type::bug","workflow::in dev"],"milestone":{"id":991112,"iid":42,"group_id":9970,"title":"13.0","description":"","state":"closed","created_at":"2019-09-04T15:20:39.024Z","updated_at":"2020-10-08T12:00:55.725Z","due_date":"2020-05-17","start_date":"2020-04-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/42"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"}],"author":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"user_notes_count":5,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2709","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2709","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2709\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2709\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2709","relative":"#2709","full":"gitlab-org\/gitaly#2709"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2658.0,"epic":{"id":20748,"iid":2658,"title":"\ud83d\ude80 Gitaly HA (generally available)","url":"\/groups\/gitlab-org\/-\/epics\/2658","group_id":9970,"human_readable_end_date":"May 17, 2020","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":33756926,"iid":2701,"project_id":2009901,"title":"Revise usage of ReplicasDatastore interface","description":"After moving to new approach with leader election based on different strategies most of the methods of the `ReplicasDatastore` interface are not needed anymore.  \nThey exist only because of the tests.  \nTo simplify project we need to clean up and refactor it as it could lead to misunderstanding of proper usage.\n\n\n\/cc @zj-gitlab @jramsay","state":"closed","created_at":1587739360817,"updated_at":1591708510179,"closed_at":1591705084074,"closed_by":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"labels":["Category:Gitaly","Stretch","[deprecated] Accepting merge requests","devops::create","group::gitaly","group::gitaly::cluster","maintenance::refactor"],"milestone":{"id":1112145,"iid":47,"group_id":9970,"title":"13.1","description":"","state":"closed","created_at":"2020-01-03T12:28:30.160Z","updated_at":"2020-10-08T12:01:07.361Z","due_date":"2020-06-17","start_date":"2020-05-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/47"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"}],"author":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4626406\/avatar.png","web_url":"https:\/\/gitlab.com\/8bitlife"},"user_notes_count":2,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2701","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2701","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2701\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2701\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2701","relative":"#2701","full":"gitlab-org\/gitaly#2701"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":33594811,"iid":2691,"project_id":2009901,"title":"The `ReplicateRepository` GRPC should automatically clean up after itself when it encounters an error","description":"The `ReplicateRepository` GRPC should automatically clean up after itself when it encounters an error.\n\nCurrently, errors appear to get sort of eaten, and the invoking Rails process never notified about the failure.\n\nThis results in a bad state, with a project repository only partially replicated to the destination gitaly storage shard file system.\n\nIn any case, once the underlying problem is fixed, that is all well and good.\n\nHowever, to future-proof against other unknown and as yet unencountered errors, the `ReplicateRepository` GRPC implementation should include an unwind\/rollback step which is ensured to be invoked when any error is encountered.\n\nThis would also significantly unblock our current process, and would allow us to get back into the business of spinning through large numbers of project replications as part of storage shard re-balancing operations.\n\nThe failed replica repo should never matter, since the original repository should remain untouched, as defined by the scope of the `ReplicateRepository` GRPC method implementation.","state":"closed","created_at":1587499450725,"updated_at":1592347292572,"closed_at":1592289388247,"closed_by":{"id":1187333,"username":"jramsay-gitlab","name":"James Ramsay (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/1187333\/avatar.png","web_url":"https:\/\/gitlab.com\/jramsay-gitlab"},"labels":["Category:Gitaly","[deprecated] Accepting merge requests","blocker","devops::create","group::gitaly","internal customer","priority::3","type::feature"],"milestone":{"id":1212252,"iid":48,"group_id":9970,"title":"Next 1-3 releases","description":"Issues which are not quite ready to schedule, but should be considered as part of the near-term roadmap.","state":"active","created_at":"2020-03-26T20:39:10.889Z","updated_at":"2020-03-26T20:39:10.889Z","due_date":null,"start_date":null,"expired":false,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/48"},"assignees":[],"author":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/4006601\/avatar.png","web_url":"https:\/\/gitlab.com\/nnelson"},"type":"ISSUE","assignee":null,"user_notes_count":11,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2691","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2691","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2691\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2691\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2691","relative":"#2691","full":"gitlab-org\/gitaly#2691"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2307.0,"epic":{"id":15983,"iid":2307,"title":"\ud83d\ude9c Improve Gitaly data migration tools","url":"\/groups\/gitlab-org\/-\/epics\/2307","group_id":9970,"human_readable_end_date":"Jul 17, 2022","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"},{"id":33497489,"iid":2682,"project_id":2009901,"title":"Enable SQL leader election by default","description":"SQL leader election https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2547 is available, but is not enabled by default. SQL based leader election should be the default behavior, even if automatic failover is not enabled.\n\n## Proposal\n\nWhen not configured the default leader election strategy should be `sql`:\n\n```ruby\npraefect['failover_election_strategy'] = 'sql'\n```\n\n## Links \/ references","state":"closed","created_at":1587359459258,"updated_at":1594984613303,"closed_at":1591360053229,"closed_by":{"id":3585,"username":"axil","name":"Achilleas Pipinellis","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3585\/avatar.png","web_url":"https:\/\/gitlab.com\/axil"},"labels":["Category:Gitaly","Deliverable","devops::create","group::gitaly","group::gitaly::cluster","missed-deliverable","missed:13.0","priority::3","workflow::in review"],"milestone":{"id":1112145,"iid":47,"group_id":9970,"title":"13.1","description":"","state":"closed","created_at":"2020-01-03T12:28:30.160Z","updated_at":"2020-10-08T12:01:07.361Z","due_date":"2020-06-17","start_date":"2020-05-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/47"},"assignees":[{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"}],"author":{"id":1187333,"username":"jramsay-gitlab","name":"James Ramsay (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/1187333\/avatar.png","web_url":"https:\/\/gitlab.com\/jramsay-gitlab"},"type":"ISSUE","assignee":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/101578\/avatar.png","web_url":"https:\/\/gitlab.com\/zj-gitlab"},"user_notes_count":8,"merge_requests_count":2,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2682","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2682","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2682\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2682\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2682","relative":"#2682","full":"gitlab-org\/gitaly#2682"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1491.0,"epic":{"id":8450,"iid":1491,"title":"\ud83c\udf3b Improved Gitaly Cluster admin experience","url":"\/groups\/gitlab-org\/-\/epics\/1491","group_id":9970,"human_readable_end_date":"Apr 22, 2020","human_readable_timestamp":"<strong>Past due<\/strong>"},"iteration":null,"health_status":"on_track","task_status":"0 of 0 checklist items completed"},{"id":33397034,"iid":2672,"project_id":2009901,"title":"Praefect behavior when replication jobs fail to persist","description":"Currently, Praefect will allow a proxied RPC to succeed even if the associated replication jobs fail to persist. We simply log any replication persisting error and it doesn't impact the success\/fail message to the client. This is incorrect behavior. When Praefect proxies an RPC, it is promising the end user a number of things:\n\n- The RPC will be proxied to the primary.\n- The replication jobs from the primary to the secondaries will be scheduled.\n\nIf the replication jobs fail to be scheduled, we should fail the RPC since we did not satisfy the contract to the end user.","state":"closed","created_at":1587064947594,"updated_at":1595056013612,"closed_at":1593791706282,"closed_by":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"labels":["Category:Gitaly","Deliverable","bug::availability","devops::create","group::gitaly","group::gitaly::cluster","priority::2","severity::4","type::bug","workflow::ready for development"],"milestone":{"id":1233746,"iid":49,"group_id":9970,"title":"13.2","description":"https:\/\/about.gitlab.com\/releases\/2020\/07\/22\/gitlab-13-2-released\/","state":"closed","created_at":"2020-04-09T17:28:01.032Z","updated_at":"2022-04-13T14:48:24.167Z","due_date":"2020-07-17","start_date":"2020-06-18","expired":true,"web_url":"https:\/\/gitlab.com\/groups\/gitlab-org\/-\/milestones\/49"},"assignees":[{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"}],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"type":"ISSUE","assignee":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https:\/\/gitlab.com\/uploads\/-\/system\/user\/avatar\/3386176\/avatar.png","web_url":"https:\/\/gitlab.com\/pokstad1"},"user_notes_count":13,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https:\/\/gitlab.com\/gitlab-org\/gitaly\/-\/issues\/2672","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"_links":{"self":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2672","notes":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2672\/notes","award_emoji":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901\/issues\/2672\/award_emoji","project":"https:\/\/gitlab.com\/api\/v4\/projects\/2009901","closed_as_duplicate_of":null},"references":{"short":"#2672","relative":"#2672","full":"gitlab-org\/gitaly#2672"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null,"task_status":"0 of 0 checklist items completed"}]