[{"id":124674510,"iid":4827,"project_id":2009901,"title":"FindChangedPaths returns paths that are not changed from merge commit","description":"\u003c!--\nIf possible, please select a relevant template from the \"Choose a template\" dropdown above.\n--\u003e\n\n\u003c!-- template sourced from https://gitlab.com/gitlab-org/gitaly/-/blob/master/.gitlab/issue_templates/Default.md --\u003e\n\nRelated Gitlab Issue: https://gitlab.com/gitlab-org/gitlab/-/issues/23625\n\nWhen a user pushes a list of changes to gitlab we perform diff checks on the changes. If those changes include a merge commit the returned changed paths may also include changes that are already in history.\n\nWe can solve the gitlab issue linked above by using [-c](https://git-scm.com/docs/git-diff-tree#Documentation/git-diff-tree.txt--c) instead of [-m](https://git-scm.com/docs/git-diff-tree#Documentation/git-diff-tree.txt--m) in the [FindChangedPaths git-diff-tree cmd](https://gitlab.com/gitlab-org/gitaly/-/blob/master/internal/gitaly/service/diff/find_changed_paths.go#L61). `-c` combines the diffs and only returns changes that are different in all parents e.g. conflict resolutions (where different from all parents) and other manual changes introduced during the merge.\n\nI discussed this in slack with @jcaigitlab and @pks-gitlab. \n\n@pks-gitlab pointed out that this would be a breaking change so rather than changing the flag we should introduce an enum to allow the client to specify how the output should be formatted. \n\nNote: the [output format for a merge commit](https://git-scm.com/docs/git-diff-tree#_diff_format_for_merges) when using `-c` is different to `-m` (each parent has a mode and sha and a status) so the `nextPath` function will need to return multiple `gitalypb.ChangedPaths` for each merge commit.","state":"closed","created_at":"2023-03-03T09:49:50.600Z","updated_at":"2023-04-21T12:05:26.100Z","closed_at":"2023-04-14T06:31:55.614Z","closed_by":{"id":660180,"username":"toon","name":"Toon Claes","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/660180/avatar.png","web_url":"https://gitlab.com/toon"},"labels":["Git-LFS","feature::addition","group::gitaly","group::gitaly::git","priority::2","severity::3","type::feature","workflow::in dev"],"milestone":{"id":2910456,"iid":86,"group_id":9970,"title":"15.11","description":"","state":"active","created_at":"2022-12-13T20:08:46.985Z","updated_at":"2022-12-13T20:08:46.985Z","due_date":"2023-04-17","start_date":"2023-03-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/86"},"assignees":[{"id":660180,"username":"toon","name":"Toon Claes","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/660180/avatar.png","web_url":"https://gitlab.com/toon"}],"author":{"id":11390638,"username":"jwoodwardgl","name":"Joe Woodward","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/11390638/avatar.png","web_url":"https://gitlab.com/jwoodwardgl"},"type":"ISSUE","assignee":{"id":660180,"username":"toon","name":"Toon Claes","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/660180/avatar.png","web_url":"https://gitlab.com/toon"},"user_notes_count":15,"merge_requests_count":0,"upvotes":6,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/4827","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":1,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/4827","notes":"https://gitlab.com/api/v4/projects/2009901/issues/4827/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/4827/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#4827","relative":"#4827","full":"gitlab-org/gitaly#4827"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":118373307,"iid":4612,"project_id":2009901,"title":"Add support for generating patch-ids","description":"Users who interact with MR pages are often distanced from the actual mechanics of git that underlie the diffs, which is a strength of our product. However, by gently obfuscating the concept of commits and branches, we find users are often confused about the implications of those concepts. One area this arises in particular is approval rules behavior around rebases. Often users want approval rules to be reset when new code enters the diff; this is a fairly basic security requirement, as it helps ensure that unreviewed/unapproved code doesn't enter an MR.\n\nThis sensible behavior is broken in a situation where a rebase occurs, as git generates new commit SHAs, which look like \"new code\" to our app. While we can work around this with rebase commit SHAs and disabling approval rule resets for UI-generated rebases, if someone rebases via the command line, we have no way of detecting that -- we only see new commits coming in via the push. This would lead to a disjointed UX and rebase changes behavior depending on which execution method is chosen.\n\n+ https://gitlab.com/gitlab-org/gitlab/-/issues/216144+\n+ https://gitlab.com/gitlab-org/gitlab/-/issues/337888+\n\nThe real question we're attempting to answer is \"has a meaningful, programmatic change been made in the diff\" which is only detectable by comparing `merge_request_diff` data. Rather than attempt to compare 2 diffs themselves (potentially quite large text blobs) we would instead like the ability to generate a representation of the raw diff, allowing us to compare for _actual_ changes in the code. This would allow us to detect not only for the case of \"this is just a rebase, no need to reset approvals\" but potentially to trigger (or not..) additional management behavior in the review cycle (such as notifying previous reviewers that a change has been made..)\n\nOne approach towards accomplishing this would be to add support for [`git patch-id`](https://git-scm.com/docs/git-patch-id) as a new RPC, allowing us (Rails) to request as needed, storing the result in the DB. This would allow us to quickly and efficiently compare the gestalt of a series of commits, rather than giant diffs, or even commits themselves (which potentially can be added, removed, squashed, etc during rebasing without impacting the resulting diff..)\n\n(This was previously opened in https://gitlab.com/gitlab-org/gitlab/-/issues/378954 and includes some initial discussions and feedback from Rails-side stakeholders here https://gitlab.com/gitlab-org/gitlab/-/issues/378954#note_1149000248)","state":"closed","created_at":"2022-11-08T18:15:34.682Z","updated_at":"2023-05-04T11:12:48.616Z","closed_at":"2022-12-21T10:33:36.479Z","closed_by":{"id":12190999,"username":"knayakgl","name":"karthik nayak","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/12190999/avatar.png","web_url":"https://gitlab.com/knayakgl"},"labels":["Deliverable","Technical Writing","Track Health Status [DEPRECATED]","backend","devops::create","docs::feature","documentation","feature::addition","group::code review","group::gitaly::git","missed-deliverable","missed:15.7","quad-planning::complete-no-action","section::dev","type::feature","workflow::complete"],"milestone":{"id":2745648,"iid":83,"group_id":9970,"title":"15.8","description":"","state":"active","created_at":"2022-08-22T16:57:34.875Z","updated_at":"2022-08-22T16:57:34.875Z","due_date":"2023-01-17","start_date":"2022-12-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/83"},"assignees":[{"id":4901936,"username":"dskim_gitlab","name":"Sincheol (David) Kim","state":"active","avatar_url":"https://secure.gravatar.com/avatar/84a984a56c54d1d31338678421cecc32?s=80\u0026d=identicon","web_url":"https://gitlab.com/dskim_gitlab"}],"author":{"id":40375,"username":"kerrizor","name":"Kerri Miller","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/40375/avatar.png","web_url":"https://gitlab.com/kerrizor"},"type":"ISSUE","assignee":{"id":4901936,"username":"dskim_gitlab","name":"Sincheol (David) Kim","state":"active","avatar_url":"https://secure.gravatar.com/avatar/84a984a56c54d1d31338678421cecc32?s=80\u0026d=identicon","web_url":"https://gitlab.com/dskim_gitlab"},"user_notes_count":37,"merge_requests_count":1,"upvotes":5,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/4612","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":3,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/4612","notes":"https://gitlab.com/api/v4/projects/2009901/issues/4612/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/4612/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#4612","relative":"#4612","full":"gitlab-org/gitaly#4612"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":"on_track"},{"id":117061447,"iid":4546,"project_id":2009901,"title":"Introduce new WhitespaceChanges enum and deprecate ignore_whitespace_change","description":"Following from this comment: https://gitlab.com/groups/gitlab-org/-/epics/9028#note_1138747850 from @pks-t \n\nultimately this is a backwards-incompatible change in Gitaly that might also impact other users of it. How about we amend the `CommitDiff` RPC to expose a new enum `WhitespaceChanges` or similar that deprecates the `ignore_whitespace_change` field? It could either be `Unspecified` (we look at `ignore_whitespace_change`), `DontIgnore`, `Ignore` or `IgnoreAll` so that you can then control yourself how exactly to render the diff?\n\n\n### Availability \u0026 Testing\nAs the change in this issue is adding a new field, and potentially marking another as deprecated there shouldn't be any major issue here. Any change in behaviour in rails shouldn't happen until https://gitlab.com/gitlab-org/gitlab/-/issues/378213.  \n- We should ensure that `omnibus-gitlab-mirror` trigged by the `trigger-qa` job passes to confirm no unexpected downstream impact","state":"closed","created_at":"2022-10-17T21:04:30.158Z","updated_at":"2023-02-21T12:05:40.103Z","closed_at":"2023-02-01T13:31:38.795Z","closed_by":{"id":12190999,"username":"knayakgl","name":"karthik nayak","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/12190999/avatar.png","web_url":"https://gitlab.com/knayakgl"},"labels":["[deprecated] Accepting merge requests","[deprecated] good for new contributors","devops::systems","feature::addition","group::gitaly","group::gitaly::git","missed:15.8","quad-planning::complete-action","section::enablement","type::feature"],"milestone":{"id":2745650,"iid":84,"group_id":9970,"title":"15.9","description":"","state":"active","created_at":"2022-08-22T16:58:02.303Z","updated_at":"2022-08-22T16:58:02.303Z","due_date":"2023-02-17","start_date":"2023-01-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/84"},"assignees":[{"id":12190999,"username":"knayakgl","name":"karthik nayak","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/12190999/avatar.png","web_url":"https://gitlab.com/knayakgl"}],"author":{"id":5918904,"username":"marc_shaw","name":"Marc Shaw","state":"active","avatar_url":"https://secure.gravatar.com/avatar/78c946cb19e40815a2b5d97cefecec6a?s=80\u0026d=identicon","web_url":"https://gitlab.com/marc_shaw"},"type":"ISSUE","assignee":{"id":12190999,"username":"knayakgl","name":"karthik nayak","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/12190999/avatar.png","web_url":"https://gitlab.com/knayakgl"},"user_notes_count":15,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/4546","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/4546","notes":"https://gitlab.com/api/v4/projects/2009901/issues/4546/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/4546/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#4546","relative":"#4546","full":"gitlab-org/gitaly#4546"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":9028,"epic":{"id":626878,"iid":9028,"title":"Hide whitespace changes doesn't hide all whitespace changes","url":"/groups/gitlab-org/-/epics/9028","group_id":9970,"human_readable_end_date":"Mar 17, 2023","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":108947683,"iid":4251,"project_id":2009901,"title":"Optionally skip computing flattened paths in GetTreeEntries","description":"Computing flattened paths in GetTreeEntries can be excessively expensive. We should add a flag to optionally skip this step so that clients only need to request them in case they're really needed.","state":"closed","created_at":"2022-05-23T06:11:20.659Z","updated_at":"2022-07-19T13:05:34.909Z","closed_at":"2022-07-08T15:00:59.781Z","closed_by":{"id":1161495,"username":"igor.drozdov","name":"Igor Drozdov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1161495/avatar.png","web_url":"https://gitlab.com/igor.drozdov"},"labels":["Category:Gitaly","bug::performance","devops::systems","group::gitaly","section::enablement","type::bug","workflow::verification"],"milestone":{"id":2453024,"iid":74,"group_id":9970,"title":"15.2","description":"","state":"active","created_at":"2022-02-03T22:24:46.818Z","updated_at":"2022-02-03T22:26:32.010Z","due_date":"2022-07-17","start_date":"2022-06-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/74"},"assignees":[{"id":1161495,"username":"igor.drozdov","name":"Igor Drozdov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1161495/avatar.png","web_url":"https://gitlab.com/igor.drozdov"}],"author":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"type":"ISSUE","assignee":{"id":1161495,"username":"igor.drozdov","name":"Igor Drozdov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1161495/avatar.png","web_url":"https://gitlab.com/igor.drozdov"},"user_notes_count":5,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/4251","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/4251","notes":"https://gitlab.com/api/v4/projects/2009901/issues/4251/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/4251/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#4251","relative":"#4251","full":"gitlab-org/gitaly#4251"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":8122,"epic":{"id":528380,"iid":8122,"title":"Improve design of Gitaly's GetTreeEntries RPC","url":"/groups/gitlab-org/-/epics/8122","group_id":9970,"human_readable_end_date":"Sep 17, 2022","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":107255388,"iid":4196,"project_id":2009901,"title":"Remove overlay2 driver specification on CI","description":"Updates !1148\n\nhttps://docs.gitlab.com/ee/ci/docker/using_docker_build.html#use-the-overlayfs-driver\n\n\u003e The shared runners on GitLab.com use the overlay2 driver by default.\n\nPart of \u00267935","state":"closed","created_at":"2022-04-27T02:34:37.082Z","updated_at":"2022-05-19T01:40:02.714Z","closed_at":"2022-04-28T05:54:09.828Z","closed_by":{"id":660180,"username":"toon","name":"Toon Claes","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/660180/avatar.png","web_url":"https://gitlab.com/toon"},"labels":["Category:Gitaly","Community contribution","devops::create","group::gitaly","maintenance::pipelines","section::dev","test","type::maintenance"],"milestone":{"id":2095271,"iid":65,"group_id":9970,"title":"15.0","description":"","state":"active","created_at":"2021-06-08T15:35:34.814Z","updated_at":"2021-11-02T18:23:35.115Z","due_date":"2022-05-17","start_date":"2022-04-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/65"},"assignees":[{"id":100770,"username":"tnir","name":"Takuya Noguchi","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/100770/canstock6553672_288.png","web_url":"https://gitlab.com/tnir"}],"author":{"id":100770,"username":"tnir","name":"Takuya Noguchi","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/100770/canstock6553672_288.png","web_url":"https://gitlab.com/tnir"},"type":"ISSUE","assignee":{"id":100770,"username":"tnir","name":"Takuya Noguchi","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/100770/canstock6553672_288.png","web_url":"https://gitlab.com/tnir"},"user_notes_count":2,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":"2022-05-04","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/4196","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/4196","notes":"https://gitlab.com/api/v4/projects/2009901/issues/4196/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/4196/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#4196","relative":"#4196","full":"gitlab-org/gitaly#4196"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":7935,"epic":{"id":507749,"iid":7935,"title":"Remove overlay2 driver specification on shared-gitlab-org Runners on .com","url":"/groups/gitlab-org/-/epics/7935","group_id":9970,"human_readable_end_date":"Jun 17, 2022","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":"on_track"},{"id":94969384,"iid":3817,"project_id":2009901,"title":"[Feature flag] Enable pagination token exact match","description":"\u003c!-- Title suggestion: [Feature flag] Enable description of feature --\u003e\n\n## What\n\nEnable the `exact_pagination_token_match` feature flag ...\n\n## Owners\n\n* Team: ~\"group::source code\"\n* Most appropriate slack channel to reach out to: `#g_create_source-code-be`\n* Best individual to reach out to: @vyaklushin\n\n## Expectations\n\n### What release does this feature occur in first?\n\nhttps://gitlab.com/gitlab-org/gitaly/-/commit/69eac9a0db256b27a8872f6e871e5d7e61485471 \n14.3.0-rc42\n\n\n\n### What are we expecting to happen?\n\nGitaly will return an error when page token is not found.\n\nPreviously, it would try to return the next element of the collection that goes after the unknown page token. \n\n### What might happen if this goes wrong?\n\nUsers can see an error when requesting a list of branches.\n\n### What can we monitor to detect problems with this?\n\nhttps://log.gprd.gitlab.net/goto/9e72ab5de811c34415eb741c3696eaff\n\n## Beta groups/projects\n\nIf applicable, any groups/projects that are happy to have this feature turned on early. Some organizations may wish to test big changes they are interested in with a small subset of users ahead of time for example.\n\n- `gitlab-org/gitlab` / `gitlab-org/gitaly` projects\n- `gitlab-org`/`gitlab-com` groups\n- ...\n\n## Roll Out Steps\n\n- [x] [Read the documentation of feature flags](https://gitlab.com/gitlab-org/gitaly/-/blob/master/doc/PROCESS.md#feature-flags)\n- [x] Add ~\"featureflag::staging\" to this issue ([howto](https://gitlab.com/gitlab-org/gitaly/-/blob/master/doc/PROCESS.md#feature-flag-labels))\n- [x] Is the required code deployed? ([howto](https://gitlab.com/gitlab-org/gitaly/-/blob/master/doc/PROCESS.md#is-the-required-code-deployed))\n- [x] Do we need to create a [change management issue](https://about.gitlab.com/handbook/engineering/infrastructure/change-management/#feature-flags-and-the-change-management-process)? ([howto](https://gitlab.com/gitlab-org/gitaly/-/blob/master/doc/PROCESS.md#do-we-need-a-change-management-issue))\n- [x] Enable on staging ([howto](https://gitlab.com/gitlab-org/gitaly/-/blob/master/doc/PROCESS.md#enable-on-staging))\n- [x] Test on staging ([howto](https://gitlab.com/gitlab-org/gitaly/-/blob/master/doc/PROCESS.md#test-on-staging))\n- [x] Verify the feature flag was used by checking Prometheus metric [`gitaly_feature_flag_checks_total`](https://prometheus.gstg.gitlab.net/graph?g0.expr=sum%20by%20(flag)%20(rate(gitaly_feature_flag_checks_total%5B5m%5D))\u0026g0.tab=1\u0026g0.stacked=0\u0026g0.range_input=1h)\n- [x] Announce on this issue an estimated time this will be enabled on GitLab.com\n- [x] Add ~\"featureflag::production\" to this issue\n- [x] Enable on GitLab.com by running chatops command in `#production` ([howto](https://gitlab.com/gitlab-org/gitaly/-/blob/master/doc/PROCESS.md#enable-in-production))\n- [x] Cross post chatops slack command to `#support_gitlab-com` and in your team channel\n- [x] Verify the feature flag is being used by checking Prometheus metric [`gitaly_feature_flag_checks_total`](https://prometheus.gprd.gitlab.net/graph?g0.expr=sum%20by%20(flag)%20(rate(gitaly_feature_flag_checks_total%5B5m%5D))\u0026g0.tab=1\u0026g0.stacked=0\u0026g0.range_input=1h)\n- [x] Announce on the issue that the flag has been enabled\n- [x] Did you set the feature to both `100%` **and** `true` ([howto](https://gitlab.com/gitlab-org/gitaly/-/blob/master/doc/PROCESS.md#enable-in-production))\n- [x] Submit a MR to have the feature `OnByDefault: true` and add changelog entry ([howto](https://gitlab.com/gitlab-org/gitaly/-/blob/master/doc/PROCESS.md#feature-lifecycle-after-it-is-live))\n- [x] Have that MR merged\n- [x] Possibly wait for at least one deployment cycle ([howto](https://gitlab.com/gitlab-org/gitaly/-/blob/master/doc/PROCESS.md#two-phase-ruby-to-go-rollouts))\n- [x] Submit an MR to remove the pre-feature code from the codebase and add changelog entry ([howto](https://gitlab.com/gitlab-org/gitaly/-/blob/master/doc/PROCESS.md#feature-lifecycle-after-it-is-live))\n- [x] Have that MR merged\n- [x] Remove the feature flag via chatops ([howto](https://gitlab.com/gitlab-org/gitaly/-/blob/master/doc/PROCESS.md#remove-the-feature-flag-via-chatops))\n- [x] Close this issue","state":"closed","created_at":"2021-10-06T15:04:16.913Z","updated_at":"2022-08-05T13:04:53.617Z","closed_at":"2022-08-05T05:39:14.515Z","closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"labels":["Category:Gitaly","Stretch","devops::systems","feature flag","featureflag::production","group::gitaly","section::enablement","type::feature","workflow::verification"],"milestone":{"id":2453025,"iid":75,"group_id":9970,"title":"15.3","description":"","state":"active","created_at":"2022-02-03T22:28:50.229Z","updated_at":"2022-02-03T22:28:50.229Z","due_date":"2022-08-17","start_date":"2022-07-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/75"},"assignees":[{"id":421631,"username":"vyaklushin","name":"Vasilii Iakliushin","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/421631/avatar.png","web_url":"https://gitlab.com/vyaklushin"}],"author":{"id":421631,"username":"vyaklushin","name":"Vasilii Iakliushin","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/421631/avatar.png","web_url":"https://gitlab.com/vyaklushin"},"type":"ISSUE","assignee":{"id":421631,"username":"vyaklushin","name":"Vasilii Iakliushin","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/421631/avatar.png","web_url":"https://gitlab.com/vyaklushin"},"user_notes_count":7,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3817","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":21,"completed_count":21},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3817","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3817/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3817/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3817","relative":"#3817","full":"gitlab-org/gitaly#3817"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":88793588,"iid":3666,"project_id":2009901,"title":"Cleanup fallback logic for gitaly-git2go binary path resolution","description":"https://gitlab.com/gitlab-org/gitaly/-/merge_requests/3587 is merged and deployed on the gitlab.com.  \nIt is safe to remove [fallback logic](https://gitlab.com/gitlab-org/gitaly/-/blob/8a6d0e26de9d584941267d2b68c94b37bc30e092/internal/git2go/command.go#L31-39) to define the path to the `gitaly-git2go` binary. \n\n/cc @zj-gitlab","state":"closed","created_at":"2021-06-16T08:46:04.710Z","updated_at":"2021-07-29T16:10:16.414Z","closed_at":"2021-07-29T16:10:16.395Z","closed_by":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"labels":["Category:Gitaly","devops::create","group::gitaly","section::dev","workflow::in dev"],"milestone":{"id":1850126,"iid":62,"group_id":9970,"title":"14.2","description":"","state":"active","created_at":"2021-01-26T16:57:35.404Z","updated_at":"2021-07-22T19:45:42.498Z","due_date":"2021-08-17","start_date":"2021-07-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/62"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"}],"author":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"user_notes_count":2,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3666","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3666","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3666/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3666/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3666","relative":"#3666","full":"gitlab-org/gitaly#3666"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":81575543,"iid":3530,"project_id":2009901,"title":"Geo: Help Praefect recover after it does an internal failover","description":"From https://gitlab.com/gitlab-org/gitaly/-/issues/3493#note_536442781:\n\n\u003e Praefect responds with code `FailedPrecondition` and message `repository is in read-only mode`: https://gitlab.com/gitlab-org/gitaly/-/blob/f1b141704f05163c5cf95185151570b844cc8b1c/internal/praefect/coordinator.go#L33\n\n## Proposal\n\nWhen a secondary encounters this particular error while syncing, Geo should schedule the next retry at of this repository later than it usually would. For example, we could set a floor of 1 minute. And/or we could double the calculated delay.","state":"closed","created_at":"2021-03-24T15:27:08.593Z","updated_at":"2021-10-28T13:58:21.736Z","closed_at":"2021-03-24T15:27:28.127Z","closed_by":{"id":1144264,"username":"mkozono","name":"Michael Kozono","state":"active","avatar_url":"https://secure.gravatar.com/avatar/6243abba3cf112e6df4a5a644c5f86aa?s=80\u0026d=identicon","web_url":"https://gitlab.com/mkozono"},"labels":["Enterprise Edition","GitLab Premium","devops::systems","group::geo","section::enablement","type::maintenance"],"milestone":null,"assignees":[],"author":{"id":1144264,"username":"mkozono","name":"Michael Kozono","state":"active","avatar_url":"https://secure.gravatar.com/avatar/6243abba3cf112e6df4a5a644c5f86aa?s=80\u0026d=identicon","web_url":"https://gitlab.com/mkozono"},"type":"ISSUE","assignee":null,"user_notes_count":0,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3530","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3530","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3530/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3530/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3530","relative":"#3530","full":"gitlab-org/gitaly#3530"},"severity":"UNKNOWN","moved_to_id":81575571,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":80369000,"iid":3499,"project_id":2009901,"title":"Update docs for the minimum version of Ruby to 2.7","description":"While !2633 upgrades Ruby to 2.7, docs for the minimum version of Ruby has not been updated.\n\nUpdating the docs is required.","state":"closed","created_at":"2021-03-05T22:50:35.388Z","updated_at":"2021-03-08T15:50:58.084Z","closed_at":"2021-03-08T15:50:58.020Z","closed_by":{"id":660180,"username":"toon","name":"Toon Claes","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/660180/avatar.png","web_url":"https://gitlab.com/toon"},"labels":["Category:Gitaly","Gitaly-Ruby","Ruby","devops::create","docs-only","documentation","group::gitaly","ruby","section::dev"],"milestone":{"id":1233761,"iid":57,"group_id":9970,"title":"13.10","description":"https://about.gitlab.com/releases/archives.html","state":"closed","created_at":"2020-04-09T17:44:14.646Z","updated_at":"2022-04-21T07:22:00.171Z","due_date":"2021-03-17","start_date":"2021-02-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/57"},"assignees":[{"id":100770,"username":"tnir","name":"Takuya Noguchi","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/100770/canstock6553672_288.png","web_url":"https://gitlab.com/tnir"}],"author":{"id":100770,"username":"tnir","name":"Takuya Noguchi","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/100770/canstock6553672_288.png","web_url":"https://gitlab.com/tnir"},"type":"ISSUE","assignee":{"id":100770,"username":"tnir","name":"Takuya Noguchi","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/100770/canstock6553672_288.png","web_url":"https://gitlab.com/tnir"},"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3499","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3499","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3499/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3499/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3499","relative":"#3499","full":"gitlab-org/gitaly#3499"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":78723064,"iid":3446,"project_id":2009901,"title":"[Gitaly] Make Ruby 3.0.x the default Ruby","description":"Part of \u00265149\n\nOnce we have a [Ruby 3 build for gitaly-ruby](https://gitlab.com/gitlab-org/gitaly/-/issues/3715), we actually want to switch the default Ruby over as well, which should happen as a separate step. \n\n**NOTE**: We had to roll back the Ruby 3 build due to a grpc rollback.","state":"closed","created_at":"2021-02-09T14:14:47.646Z","updated_at":"2023-02-02T10:30:02.174Z","closed_at":"2022-04-25T12:19:11.968Z","closed_by":{"id":4087087,"username":"alipniagov","name":"Aleksei Lipniagov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4087087/avatar.png","web_url":"https://gitlab.com/alipniagov"},"labels":["Category:Gitaly","Ruby","devops::create","group::gitaly","maintenance::dependency","missed:14.0","missed:14.1","missed:14.2","missed:14.3","missed:14.4","missed:14.5","missed:14.6","missed:14.7","missed:14.8","rails6.1","ruby","section::dev","workflow::production"],"milestone":{"id":1212252,"iid":48,"group_id":9970,"title":"Next 1-3 releases","description":"Issues which are not quite ready to schedule, but should be considered as part of the near-term roadmap.","state":"active","created_at":"2020-03-26T20:39:10.889Z","updated_at":"2020-03-26T20:39:10.889Z","due_date":null,"start_date":null,"expired":false,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/48"},"assignees":[{"id":100770,"username":"tnir","name":"Takuya Noguchi","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/100770/canstock6553672_288.png","web_url":"https://gitlab.com/tnir"}],"author":{"id":100770,"username":"tnir","name":"Takuya Noguchi","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/100770/canstock6553672_288.png","web_url":"https://gitlab.com/tnir"},"type":"ISSUE","assignee":{"id":100770,"username":"tnir","name":"Takuya Noguchi","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/100770/canstock6553672_288.png","web_url":"https://gitlab.com/tnir"},"user_notes_count":15,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3446","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3446","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3446/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3446/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3446","relative":"#3446","full":"gitlab-org/gitaly#3446"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":5149,"epic":{"id":176983,"iid":5149,"title":"Update supported Ruby version to 3.0.5","url":"/groups/gitlab-org/-/epics/5149","group_id":9970,"human_readable_end_date":"Mar 17, 2023","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":77995430,"iid":3431,"project_id":2009901,"title":"Enable Prometheus by default","description":"Gitaly does not enable Prometheus by default, only when administrators configure the buckets. This issue proposes to have default buckets of:\n\n```\ngrpc_latency_buckets = [0.001, 0.005, 0.025, 0.1, 0.5, 1.0, 10.0, 30.0, 60.0, 300.0, 1500.0]\n```\n\nThe config value remains to override what the default value is.\n\nSee also: https://gitlab.com/gitlab-com/gl-infra/infrastructure/-/issues/9490#note_495908357","state":"closed","created_at":"2021-01-28T12:34:08.629Z","updated_at":"2021-07-15T03:07:45.349Z","closed_at":"2021-07-15T03:07:45.327Z","closed_by":{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/228150/avatar.png","web_url":"https://gitlab.com/proglottis"},"labels":["Category:Gitaly","devops::create","group::gitaly","missed:13.12","missed:14.0","section::dev","workflow::in review"],"milestone":{"id":1850118,"iid":61,"group_id":9970,"title":"14.1","description":"","state":"closed","created_at":"2021-01-26T16:56:41.887Z","updated_at":"2022-04-21T07:25:22.879Z","due_date":"2021-07-17","start_date":"2021-06-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/61"},"assignees":[{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5522960/avatar.png","web_url":"https://gitlab.com/samihiltunen"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"type":"ISSUE","assignee":{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5522960/avatar.png","web_url":"https://gitlab.com/samihiltunen"},"user_notes_count":2,"merge_requests_count":1,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3431","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3431","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3431/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3431/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3431","relative":"#3431","full":"gitlab-org/gitaly#3431"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":77882837,"iid":3427,"project_id":2009901,"title":"Praefect: Use millisecond precision for JSON logs time field","description":"### Problem to solve\n\nA customer [reported](https://gitlab.com/gitlab-com/account-management/emea/manomano/-/issues/53) that times in Praefect logs are not standardized. Some items have millisecond precision (thanks to https://gitlab.com/gitlab-org/gitaly/-/merge_requests/1887), but others don't.\n\nFrom the customer:\n```\nWe are trying to ingest logs on Datalog and are facing dates on logs that aren't standardized.  Example on the same file (/var/log/gitlab/praefect/current):\n\n{\"gitaly\":15927,\"level\":\"warning\",\"msg\":\"forwarding signal\",\"signal\":23,\"time\":\"2020-12-09T15:24:49Z\",\"wrapper\":15937}\n{\"correlation_id\":\"M2qIAurFTg7\",\"grpc.code\":\"OK\",\"grpc.meta.auth_version\":\"v2\",\"grpc.meta.client_name\":\"gitlab-web\",\"grpc.meta.deadline_type\":\"regular\",\"grpc.method\":\"FindCommit\",\"grpc.request.deadline\":\"2020-12-09T14:39:10Z\",\"grpc.request.fullMethod\":\"/gitaly.CommitService/FindCommit\",\"grpc.service\":\"gitaly.CommitService\",\"grpc.start_time\":\"2020-12-09T14:38:41Z\",\"grpc.time_ms\":4.497,\"level\":\"info\",\"msg\":\"finished streaming call with code OK\",\"peer.address\":\"REDACTED:11670\",\"pid\":15927,\"relative_path\":\"@hashed/e7/f6/REDACTED.git\",\"span.kind\":\"server\",\"system\":\"grpc\",\"time\":\"2020-12-09T14:38:41.010Z\",\"virtual_storage\":\"distributed\"}\n```\n\nNotice that the first `time` does not have millisecond precision, but the last `time` does.\n\n### Proposal\n\nPraefect log entries should have times with millisecond precision (ISO 8601.3).","state":"closed","created_at":"2021-01-26T17:57:32.299Z","updated_at":"2021-02-12T22:42:25.549Z","closed_at":"2021-02-11T19:37:55.629Z","closed_by":{"id":64248,"username":"stanhu","name":"Stan Hu","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/64248/stanhu.jpg","web_url":"https://gitlab.com/stanhu"},"labels":["Category:Gitaly","[deprecated] Accepting merge requests","backend","devops::create","feature::enhancement","group::gitaly","section::dev","type::feature","workflow::ready for development"],"milestone":{"id":1233761,"iid":57,"group_id":9970,"title":"13.10","description":"https://about.gitlab.com/releases/archives.html","state":"closed","created_at":"2020-04-09T17:44:14.646Z","updated_at":"2022-04-21T07:22:00.171Z","due_date":"2021-03-17","start_date":"2021-02-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/57"},"assignees":[],"author":{"id":4512390,"username":"djensen","name":"Dan Jensen","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4512390/avatar.png","web_url":"https://gitlab.com/djensen"},"type":"ISSUE","assignee":null,"user_notes_count":10,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3427","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3427","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3427/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3427/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3427","relative":"#3427","full":"gitlab-org/gitaly#3427"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2575,"epic":{"id":18891,"iid":2575,"title":"Standardize timestamp format in log files (epic)","url":"/groups/gitlab-org/-/epics/2575","group_id":9970,"human_readable_end_date":"Mar 17, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":77822925,"iid":3425,"project_id":2009901,"title":"Enforce default limit for recursive calls to GetTreeEntries","description":"## Background\n\nIn some repositories with very large trees (https://gitlab.com/gitlab-org/gitlab/-/issues/232072), recursive calls to GetTreeEntries can consume too much system resources to complete.\n\n## Proposal\n\nEnforce a default limit for the number of tree entries that can be recursively fetched by GetTreeEntries. Require an explicit override for requests that want more than the default limit.","state":"closed","created_at":"2021-01-25T20:05:32.034Z","updated_at":"2021-07-29T17:39:07.637Z","closed_at":"2021-07-29T17:39:07.619Z","closed_by":{"id":64248,"username":"stanhu","name":"Stan Hu","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/64248/stanhu.jpg","web_url":"https://gitlab.com/stanhu"},"labels":["Application Limits","Category:Gitaly","customer","devops::create","group::gitaly","section::dev"],"milestone":null,"assignees":[],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"type":"ISSUE","assignee":null,"user_notes_count":9,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3425","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3425","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3425/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3425/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3425","relative":"#3425","full":"gitlab-org/gitaly#3425"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":77019673,"iid":3405,"project_id":2009901,"title":"[Feature flag] Enable Go implementation of FetchSourceBranch","description":"## What\n\nEnable the `gitaly_go_fetch_source_branch` feature flag, which switches over from the Ruby implementation of FetchSourceBranch to the Go implementation. FetchSourceBranch is used \n\n- when creating merge requests across forks, FetchSourceBranch is used to get changes from the source repo into the target repo.\n- when doing cross-repository diffs.\n\nThe feature flag has been rolled out in the past but caused severe performance regressions https://gitlab.com/gitlab-org/gitaly/-/issues/2741#note_374138071. There's been some changes to mitigate those regressions and avoid needless duplication of work when objects are already contained in the target repository https://gitlab.com/gitlab-org/gitaly/-/merge_requests/2980.\n\n## Owners\n\n- Team: Gitaly\n- Most appropriate slack channel to reach out to: `#g_create_gitaly`\n- Best individual to reach out to: @pks-t\n\n## Expectations\n\n### What release does this feature occur in first?\n\n%13.2 via f0a5bdd7f04fb2819b62ed7afd466daabf672d15, improved performance in %13.8 via f382aa9588e4c818a4a70eefe7b3a8ebf790f91c.\n\n### What are we expecting to happen?\n\nNo change in behaviour is expected. Ideally, performance metrics for `FetchSourceBranch` shouldn't change.\n\n### What might happen if this goes wrong?\n\n- Errors when creating merge requests from forks.\n- Errors when diffing across repositories.\n- Latency regresses.\n\n### What can we monitor to detect problems with this?\n\n- https://dashboards.gitlab.net/d/000000199/gitaly-feature-status?var-environment=gprd\u0026var-method=FetchSourceBranch\n\n## Roll Out Steps\n\n- [x] [Read the documentation of feature flags](https://gitlab.com/gitlab-org/gitaly/-/blob/master/doc/PROCESS.md#feature-flags)\n- [x] Add ~\"featureflag::staging\" to this issue\n- [x] Is the required code deployed? ([howto](https://gitlab.com/gitlab-org/gitaly/-/blob/master/doc/PROCESS.md#is-the-required-code-deployed))\n- [x] Enable on staging ([howto](https://gitlab.com/gitlab-org/gitaly/-/blob/master/doc/PROCESS.md#enable-on-staging))\n- [x] Test on staging ([howto](https://gitlab.com/gitlab-org/gitaly/-/blob/master/doc/PROCESS.md#test-on-staging))\n- [ ] Ensure that documentation has been updated\n- [x] Announce on this issue an estimated time this will be enabled on GitLab.com\n- [x] Add ~\"featureflag::production\" to this issue\n- [x] Enable on GitLab.com by running chatops command in `#production` ([howto](https://gitlab.com/gitlab-org/gitaly/-/blob/master/doc/PROCESS.md#enable-in-production))\n- [ ] Cross post chatops slack command to `#support_gitlab-com` and in your team channel\n- [x] Announce on the issue that the flag has been enabled\n- [x] Remove feature flag and add changelog entry\n- [ ] Close this issue","state":"closed","created_at":"2021-01-11T11:55:50.294Z","updated_at":"2021-02-24T09:15:49.252Z","closed_at":"2021-02-24T09:15:49.183Z","closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"labels":["Category:Gitaly","devops::create","feature flag","featureflag::production","group::gitaly","section::dev","workflow::in dev"],"milestone":{"id":1233761,"iid":57,"group_id":9970,"title":"13.10","description":"https://about.gitlab.com/releases/archives.html","state":"closed","created_at":"2020-04-09T17:44:14.646Z","updated_at":"2022-04-21T07:22:00.171Z","due_date":"2021-03-17","start_date":"2021-02-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/57"},"assignees":[{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"}],"author":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"type":"ISSUE","assignee":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"user_notes_count":9,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3405","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":13,"completed_count":10},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3405","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3405/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3405/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3405","relative":"#3405","full":"gitlab-org/gitaly#3405"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":76044947,"iid":3381,"project_id":2009901,"title":"Remove Ruby implementation of UserUpdateSubmodule RPC","description":"Once the feature flag for the Go implementation for UserUpdateSubmodule has been removed in the previous release (https://gitlab.com/gitlab-org/gitaly/-/issues/3380), it is now a safe time to remove the old Ruby implementation.","state":"closed","created_at":"2020-12-14T17:01:01.257Z","updated_at":"2021-05-24T12:22:52.348Z","closed_at":"2021-05-24T12:22:52.327Z","closed_by":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"labels":["Category:Gitaly","devops::create","group::gitaly","missed:13.10","missed:13.11","missed:13.12","missed:13.9","section::dev","workflow::in dev"],"milestone":{"id":1850113,"iid":60,"group_id":9970,"title":"14.0","description":"","state":"closed","created_at":"2021-01-26T16:55:07.714Z","updated_at":"2022-04-21T07:25:17.749Z","due_date":"2021-06-17","start_date":"2021-05-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/60"},"assignees":[{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"}],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"type":"ISSUE","assignee":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"user_notes_count":2,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3381","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3381","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3381/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3381/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3381","relative":"#3381","full":"gitlab-org/gitaly#3381"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":76044879,"iid":3380,"project_id":2009901,"title":"Remove feature flag gitaly_go_user_update_submodule","description":"Once no issues have been found with the feature flag `gitaly_go_user_update_submodule` turned on by default, remove it.\n\nFollow up from #3290","state":"closed","created_at":"2020-12-14T16:59:02.672Z","updated_at":"2021-05-12T08:41:54.389Z","closed_at":"2021-05-12T08:41:54.337Z","closed_by":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"labels":["Category:Gitaly","devops::create","group::gitaly","missed:13.8","section::dev","workflow::in dev"],"milestone":{"id":1233762,"iid":58,"group_id":9970,"title":"13.12","description":"https://about.gitlab.com/releases/archives.html","state":"closed","created_at":"2020-04-09T17:44:14.948Z","updated_at":"2022-04-21T07:22:18.898Z","due_date":"2021-05-17","start_date":"2021-04-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/58"},"assignees":[{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"}],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"type":"ISSUE","assignee":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"user_notes_count":1,"merge_requests_count":2,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3380","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3380","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3380/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3380/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3380","relative":"#3380","full":"gitlab-org/gitaly#3380"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2862,"epic":{"id":30693,"iid":2862,"title":"🏍 Remove the Gitaly-Ruby sidecar","url":"/groups/gitlab-org/-/epics/2862","group_id":9970,"human_readable_end_date":"May 17, 2023","human_readable_timestamp":"\u003cstrong\u003e11\u003c/strong\u003e days remaining"},"iteration":null,"health_status":null},{"id":74220736,"iid":3288,"project_id":2009901,"title":"Logging format 'text' considered invalid","description":"When using logging format `text` for `gitaly` chart it's considered `invalid`.\nIn documentation `format` value of `[logging]` section should accept: `json` or `text`\n\n![image](/uploads/457e603e92498e00f4d61496126e8567/image.png)\n\nGitaly pod logs:\n```\nroot@ip-10-2-4-231:~# kubectl logs -n gitlab gitlab-gitaly-0\n+ /scripts/set-config /etc/gitaly/templates /etc/gitaly\nBegin parsing .erb files from /etc/gitaly/templates\nWriting /etc/gitaly/config.toml\nCopying other config files found in /etc/gitaly/templates\n+ exec /bin/sh -c '\"/scripts/process-wrapper\"'\nStarting Gitaly\n\n*** /var/log/gitaly/gitaly.log ***\ntime=\"2020-11-11T19:06:22Z\" level=info msg=\"Starting Gitaly\" version=\"Gitaly, version 13.5.3\"\ntime=\"2020-11-11T19:06:22Z\" level=warning msg=\"git path not configured. Using default path resolution\" resolvedPath=/usr/local/bin/git\ntime=\"2020-11-11T19:06:22Z\" level=info msg=\"clearing disk cache object folder\" path=/home/git/repositories\ntime=\"2020-11-11T19:06:22Z\" level=info msg=\"moving disk cache object folder to /home/git/repositories/+gitaly/tmp/diskcache085180550\" path=/home/git/repositories\ntime=\"2020-11-11T19:06:22Z\" level=info msg=\"disk cache object folder doesn't exist, no need to remove\" path=/home/git/repositories\ntime=\"2020-11-11T19:06:22Z\" level=info msg=\"Starting file walker for /home/git/repositories/+gitaly/cache\" path=/home/git/repositories/+gitaly/cache\ntime=\"2020-11-11T19:06:22Z\" level=info msg=\"Starting file walker for /home/git/repositories/+gitaly/state\" path=/home/git/repositories/+gitaly/state\ntime=\"2020-11-11T19:06:22Z\" level=info msg=\"cleared all cache object files in /home/git/repositories/+gitaly/tmp/diskcache085180550 after 4.352483ms\" path=/home/git/repositories\ntime=\"2020-11-11T19:06:23Z\" level=fatal msg=\"invalid logger format\" format=text\n```\n\nLogging section for the `gitaly` ConfigMap using `text` as format:\n```\nroot@ip-10-2-4-231:~# kubectl get cm -n gitlab gitlab-gitaly -o yaml | grep 'logging' -A5\n    [logging]\n    format = \"text\"\n    dir = \"/var/log/gitaly\"\n\n    [auth]\n    token = \"\u003c%= File.read('/etc/gitlab-secrets/gitaly/gitaly_token').strip.dump[1..-2] %\u003e\"\n```\n\n---\n\n### Normal behavior\n\nThe working logging section for the `gitaly` ConfigMap with `json` value:\n```\nroot@ip-10-2-4-231:~# kubectl get cm -n gitlab gitlab-gitaly -o yaml | grep 'logging' -A5\n    [logging]\n    format = \"json\"\n    dir = \"/var/log/gitaly\"\n\n    [auth]\n    token = \"\u003c%= File.read('/etc/gitlab-secrets/gitaly/gitaly_token').strip.dump[1..-2] %\u003e\"\n```\n\nGitaly log when using `json` as `[logging]` value for the `format`:\n```\nroot@ip-10-2-4-231:~# kubectl logs -n gitlab gitlab-gitaly-0\n+ /scripts/set-config /etc/gitaly/templates /etc/gitaly\nBegin parsing .erb files from /etc/gitaly/templates\nWriting /etc/gitaly/config.toml\nCopying other config files found in /etc/gitaly/templates\n+ exec /bin/sh -c '\"/scripts/process-wrapper\"'\nStarting Gitaly\n\n*** /var/log/gitaly/gitaly.log ***\ntime=\"2020-11-11T19:27:11Z\" level=info msg=\"Starting Gitaly\" version=\"Gitaly, version 13.5.3\"\ntime=\"2020-11-11T19:27:11Z\" level=warning msg=\"git path not configured. Using default path resolution\" resolvedPath=/usr/local/bin/git\ntime=\"2020-11-11T19:27:11Z\" level=info msg=\"clearing disk cache object folder\" path=/home/git/repositories\ntime=\"2020-11-11T19:27:11Z\" level=info msg=\"moving disk cache object folder to /home/git/repositories/+gitaly/tmp/diskcache451226427\" path=/home/git/repositories\ntime=\"2020-11-11T19:27:11Z\" level=info msg=\"disk cache object folder doesn't exist, no need to remove\" path=/home/git/repositories\ntime=\"2020-11-11T19:27:11Z\" level=info msg=\"Starting file walker for /home/git/repositories/+gitaly/cache\" path=/home/git/repositories/+gitaly/cache\ntime=\"2020-11-11T19:27:11Z\" level=info msg=\"Starting file walker for /home/git/repositories/+gitaly/state\" path=/home/git/repositories/+gitaly/state\ntime=\"2020-11-11T19:27:11Z\" level=info msg=\"cleared all cache object files in /home/git/repositories/+gitaly/tmp/diskcache451226427 after 4.46173ms\" path=/home/git/repositories\n{\"address\":\"/home/git/internal.sock\",\"level\":\"info\",\"msg\":\"listening at unix address\",\"time\":\"2020-11-11T19:27:12.101Z\"}\n{\"address\":\"0.0.0.0:8075\",\"level\":\"info\",\"msg\":\"listening at tcp address\",\"time\":\"2020-11-11T19:27:12.101Z\"}\n{\"address\":\":9236\",\"level\":\"info\",\"msg\":\"starting prometheus listener\",\"time\":\"2020-11-11T19:27:12.105Z\"}\n{\"level\":\"info\",\"msg\":\"finished tempdir cleaner walk\",\"storage\":\"default\",\"time\":\"2020-11-11T19:27:12.105Z\",\"time_ms\":6}\n{\"level\":\"info\",\"msg\":\"starting RSS monitor\",\"supervisor.name\":\"gitaly-ruby.1\",\"supervisor.rss_threshold\":209715200,\"time\":\"2020-11-11T19:27:12.106Z\"}\n{\"level\":\"info\",\"msg\":\"starting RSS monitor\",\"supervisor.name\":\"gitaly-ruby.0\",\"supervisor.rss_threshold\":209715200,\"time\":\"2020-11-11T19:27:12.106Z\"}\n{\"level\":\"warning\",\"msg\":\"spawned\",\"supervisor.args\":[\"bundle\",\"exec\",\"bin/ruby-cd\",\"/\",\"/srv/gitaly-ruby/bin/gitaly-ruby\",\"10\",\"/home/git/ruby.1\"],\"supervisor.name\":\"gitaly-ruby.1\",\"supervisor.pid\":25,\"time\":\"2020-11-11T19:27:12.107Z\"}\n{\"level\":\"warning\",\"msg\":\"spawned\",\"supervisor.args\":[\"bundle\",\"exec\",\"bin/ruby-cd\",\"/\",\"/srv/gitaly-ruby/bin/gitaly-ruby\",\"10\",\"/home/git/ruby.0\"],\"supervisor.name\":\"gitaly-ruby.0\",\"supervisor.pid\":26,\"time\":\"2020-11-11T19:27:12.108Z\"}\n{\"level\":\"info\",\"msg\":\"PID 26 BUNDLE_GEMFILE=/srv/gitaly-ruby/Gemfile\",\"supervisor.args\":[\"bundle\",\"exec\",\"bin/ruby-cd\",\"/\",\"/srv/gitaly-ruby/bin/gitaly-ruby\",\"10\",\"/home/git/ruby.0\"],\"supervisor.name\":\"gitaly-ruby.0\",\"time\":\"2020-11-11T19:27:12.552Z\"}\n{\"level\":\"info\",\"msg\":\"PID 25 BUNDLE_GEMFILE=/srv/gitaly-ruby/Gemfile\",\"supervisor.args\":[\"bundle\",\"exec\",\"bin/ruby-cd\",\"/\",\"/srv/gitaly-ruby/bin/gitaly-ruby\",\"10\",\"/home/git/ruby.1\"],\"supervisor.name\":\"gitaly-ruby.1\",\"time\":\"2020-11-11T19:27:12.576Z\"}\n```\n\n### Version details\n\nKubernetes, version 1.16  \nGitaly, version 13.5.3  \nGitLab, version 13.5.3  \nGitLab Cloud Native Helm chart, version 4.5.3","state":"closed","created_at":"2020-11-11T19:28:48.746Z","updated_at":"2021-03-07T20:08:48.004Z","closed_at":"2021-03-07T20:08:47.916Z","closed_by":{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/228150/avatar.png","web_url":"https://gitlab.com/proglottis"},"labels":["Category:Gitaly","devops::create","group::gitaly","missed:13.9","priority::3","section::dev","severity::3","type::bug","workflow::in review"],"milestone":{"id":1233761,"iid":57,"group_id":9970,"title":"13.10","description":"https://about.gitlab.com/releases/archives.html","state":"closed","created_at":"2020-04-09T17:44:14.646Z","updated_at":"2022-04-21T07:22:00.171Z","due_date":"2021-03-17","start_date":"2021-02-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/57"},"assignees":[{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5522960/avatar.png","web_url":"https://gitlab.com/samihiltunen"}],"author":{"id":3800990,"username":"valioozz","name":"Valentin Zayash","state":"active","avatar_url":"https://secure.gravatar.com/avatar/5496addcd1f575dd60b6a86d7aaefc55?s=80\u0026d=identicon","web_url":"https://gitlab.com/valioozz"},"type":"ISSUE","assignee":{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5522960/avatar.png","web_url":"https://gitlab.com/samihiltunen"},"user_notes_count":3,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3288","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3288","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3288/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3288/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3288","relative":"#3288","full":"gitlab-org/gitaly#3288"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":74093600,"iid":3277,"project_id":2009901,"title":"Build commit graph with Bloom Filter","description":"In our monorepo, we started to observe very slow response time in `FindCommits` grpc.\n\nUser when edit Merge Requests would get timeout with the following stack trace:\n\n```\nGitlab::Git::CommandError (4:Deadline Exceeded):\n  lib/gitlab/git/wraps_gitaly_errors.rb:13:in `rescue in wrapped_gitaly_errors'\n  lib/gitlab/git/wraps_gitaly_errors.rb:6:in `wrapped_gitaly_errors'\n  lib/gitlab/git/repository.rb:347:in `log'\n  lib/gitlab/git/commit.rb:46:in `where'\n  app/models/repository.rb:155:in `commits'\n  lib/gitlab/metrics/instrumentation.rb:161:in `block in commits'\n  lib/gitlab/metrics/method_call.rb:36:in `measure'\n  lib/gitlab/metrics/instrumentation.rb:161:in `commits'\n  ee/lib/gitlab/authority_analyzer.rb:26:in `involved_users'\n  ee/lib/gitlab/authority_analyzer.rb:15:in `calculate'\n  ee/app/presenters/merge_request_approver_presenter.rb:56:in `users_from_git_log_authors'\n  ee/app/presenters/merge_request_approver_presenter.rb:44:in `block in users'\n  lib/gitlab/utils/strong_memoize.rb:30:in `strong_memoize'\n  ee/app/presenters/merge_request_approver_presenter.rb:43:in `users'\n  ee/app/presenters/merge_request_approver_presenter.rb:25:in `any?'\n  ee/app/views/shared/issuable/_approvals.html.haml:25\n  app/helpers/application_helper.rb:10:in `render_if_exists'\n  app/views/shared/issuable/_form.html.haml:36\n  app/views/projects/merge_requests/_form.html.haml:3\n  app/views/projects/merge_requests/_form.html.haml:1\n  app/views/projects/merge_requests/edit.html.haml:5\n  app/controllers/application_controller.rb:133:in `render'\n  ee/lib/gitlab/ip_address_state.rb:10:in `with'\n  ee/app/controllers/ee/application_controller.rb:44:in `set_current_ip_address'\n  app/controllers/application_controller.rb:497:in `set_current_admin'\n  lib/gitlab/session.rb:11:in `with_session'\n  app/controllers/application_controller.rb:488:in `set_session_storage'\n  lib/gitlab/i18n.rb:55:in `with_locale'\n  lib/gitlab/i18n.rb:61:in `with_user_locale'\n  app/controllers/application_controller.rb:482:in `set_locale'\n  lib/gitlab/error_tracking.rb:51:in `with_context'\n  app/controllers/application_controller.rb:547:in `sentry_context'\n  app/controllers/application_controller.rb:475:in `block in set_current_context'\n  lib/gitlab/application_context.rb:52:in `block in use'\n  lib/gitlab/application_context.rb:52:in `use'\n  lib/gitlab/application_context.rb:20:in `with_context'\n  app/controllers/application_controller.rb:468:in `set_current_context'\n  lib/gitlab/metrics/elasticsearch_rack_middleware.rb:24:in `call'\n  lib/gitlab/metrics/redis_rack_middleware.rb:22:in `call'\n  lib/gitlab/middleware/rails_queue_duration.rb:29:in `call'\n  lib/gitlab/metrics/rack_middleware.rb:17:in `block in call'\n  lib/gitlab/metrics/transaction.rb:54:in `run'\n  lib/gitlab/metrics/rack_middleware.rb:17:in `call'\n  lib/gitlab/request_profiler/middleware.rb:17:in `call'\n  ee/lib/gitlab/database/load_balancing/rack_middleware.rb:39:in `call'\n  ee/lib/gitlab/jira/middleware.rb:19:in `call'\n  lib/gitlab/middleware/go.rb:20:in `call'\n  lib/gitlab/etag_caching/middleware.rb:13:in `call'\n  lib/gitlab/middleware/multipart.rb:125:in `call'\n  lib/gitlab/middleware/read_only/controller.rb:51:in `call'\n  lib/gitlab/middleware/read_only.rb:18:in `call'\n  lib/gitlab/middleware/same_site_cookies.rb:27:in `call'\n  lib/gitlab/middleware/basic_health_check.rb:25:in `call'\n  lib/gitlab/middleware/handle_ip_spoof_attack_error.rb:25:in `call'\n  lib/gitlab/middleware/request_context.rb:23:in `call'\n  config/initializers/fix_local_cache_middleware.rb:9:in `call'\n  lib/gitlab/metrics/requests_rack_middleware.rb:60:in `call'\n  lib/gitlab/middleware/release_env.rb:12:in `call'\n```\n\nWhat this is suggesting is that https://gitlab.com/gitlab-org/gitlab/-/blob/v13.3.8-ee/ee/lib/gitlab/authority_analyzer.rb#L26 is being called and get timeout by Gitaly.\n\nI suspect this is because in a big monorepo, `git log -- \u003cfile_path\u003e` could be very slow as reasons indicated in https://devblogs.microsoft.com/devops/super-charging-the-git-commit-graph-iv-bloom-filters/\n\nThe solution here is to build the commit-graph with Bloom filter included by adding `--changed-paths` to `git commit-graph write`. I have a draft solution in https://gitlab.com/sluongng/gitaly/-/commit/78dba8b73e720b11500482b19b755346ec853025 that need to be developed into a full fledged solution.","state":"closed","created_at":"2020-11-09T14:56:50.787Z","updated_at":"2021-10-20T11:37:05.180Z","closed_at":"2021-05-19T06:53:28.709Z","closed_by":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"labels":["Category:Gitaly","Gitaly","customer","devops::create","group::gitaly","missed:13.9","section::dev","workflow::in dev"],"milestone":{"id":1850113,"iid":60,"group_id":9970,"title":"14.0","description":"","state":"closed","created_at":"2021-01-26T16:55:07.714Z","updated_at":"2022-04-21T07:25:17.749Z","due_date":"2021-06-17","start_date":"2021-05-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/60"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"}],"author":{"id":1418515,"username":"sluongng","name":"Son Luong Ngoc","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1418515/avatar.png","web_url":"https://gitlab.com/sluongng"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"user_notes_count":17,"merge_requests_count":4,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3277","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3277","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3277/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3277/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3277","relative":"#3277","full":"gitlab-org/gitaly#3277"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":73848356,"iid":3265,"project_id":2009901,"title":"Fix  resolving Praefect address in mixed-TLS deployments","description":"In deployements where Gitaly and Praefect have different TLS configurations, we may fail to correctly resolve injected Praefect addresses. The root cause is that in `resolvePraefectAddress`, we decide how to resolve the peer address by inspecting the incoming TCP connection: if it is unencrypted, we dial back with an unencrypted connection. If it is encrypted, we dial back with an encrypted connection. This doesn't make a lot of sense though, as we're deciding how to dial back depending on how we're reachable ourselves as a Gitaly node. We really shouldn't care for that and instead only go by the injected information we got.","state":"closed","created_at":"2020-11-04T09:51:03.416Z","updated_at":"2020-12-16T18:07:30.547Z","closed_at":"2020-12-16T18:07:02.490Z","closed_by":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"labels":["Category:Gitaly","[deprecated] Accepting merge requests","devops::create","group::gitaly","priority::3","section::dev","severity::3","type::bug"],"milestone":{"id":1233760,"iid":56,"group_id":9970,"title":"13.9","description":"https://about.gitlab.com/releases/archives.html","state":"closed","created_at":"2020-04-09T17:44:14.334Z","updated_at":"2022-04-21T07:21:28.468Z","due_date":"2021-02-17","start_date":"2021-01-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/56"},"assignees":[],"author":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"type":"ISSUE","assignee":null,"user_notes_count":6,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3265","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3265","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3265/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3265/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3265","relative":"#3265","full":"gitlab-org/gitaly#3265"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":73819963,"iid":3262,"project_id":2009901,"title":"Praefect should only dial to Gitaly for transactions","description":"For transactions, we require that Gitaly dials back to Praefect in order to vote on transactions. This introduces a few problems:\n\n- Gitaly is not configured with Praefect's security token. Praefect must send call-back information, including security token, to Gitaly for all transaction related calls.\n- It is not clear to customers how this dial back requirement affects supported network topologies for GitLab deployments. Sometimes, Praefect may be behind a load balancer or NAT. Being able to dial back to Praefect is not always desirable.\n\nHowever, Praefect is already configured with the Gitaly node security tokens and it is clear that Praefect must be able to reach individual Gitalies on the network. Therefore, it would be more robust to have Praefect initiate the gRPC call to Gitaly for all transaction votes. This would free Gitaly from needing to know network and security details for Praefect since Praefect is already a trusted client of Gitaly.","state":"closed","created_at":"2020-11-03T19:16:24.161Z","updated_at":"2021-07-26T13:34:59.341Z","closed_at":"2021-05-04T06:07:27.178Z","closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"labels":["Category:Gitaly","Deliverable","GitLab Premium","customer","devops::create","direction","group::gitaly","group::gitaly::cluster","priority::2","section::dev","security","severity::4","type::feature","workflow::in dev"],"milestone":{"id":1233762,"iid":58,"group_id":9970,"title":"13.12","description":"https://about.gitlab.com/releases/archives.html","state":"closed","created_at":"2020-04-09T17:44:14.948Z","updated_at":"2022-04-21T07:22:18.898Z","due_date":"2021-05-17","start_date":"2021-04-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/58"},"assignees":[{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5522960/avatar.png","web_url":"https://gitlab.com/samihiltunen"}],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"type":"ISSUE","assignee":{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5522960/avatar.png","web_url":"https://gitlab.com/samihiltunen"},"user_notes_count":20,"merge_requests_count":2,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3262","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3262","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3262/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3262/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3262","relative":"#3262","full":"gitlab-org/gitaly#3262"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1189,"epic":{"id":5989,"iid":1189,"title":"Gitaly Cluster: strong consistency","url":"/groups/gitlab-org/-/epics/1189","group_id":9970,"human_readable_end_date":"Sep 17, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":73721249,"iid":3255,"project_id":2009901,"title":"Improve input validation of hook inputs","description":"The ported UserMergeBranch RPC caused pipelines to not get triggered in production anymore. The root cause was that the PostReceive hook was executed with empty input, where it should've contained a list of all updated references. As a result, the hook pretended no changes existed and thus no pipelines had to be triggered.\n\nThis error was hard to diagnose via logs or metrics as this is essentially about the absence of something. If we had stricter input verification in our hooks (e.g. expecting at least one change to exist), then the issue might've been a lot more visible and thus caught earlier.","state":"closed","created_at":"2020-11-02T09:02:29.619Z","updated_at":"2020-12-02T09:28:12.406Z","closed_at":"2020-12-02T09:28:12.321Z","closed_by":{"id":1424505,"username":"avar","name":"Ævar Arnfjörð Bjarmason","state":"active","avatar_url":"https://secure.gravatar.com/avatar/4edaf21e9ad2d357c90aa62eb752f302?s=80\u0026d=identicon","web_url":"https://gitlab.com/avar"},"labels":["Category:Gitaly","Stretch","corrective action","devops::create","group::gitaly","section::dev"],"milestone":{"id":1233757,"iid":54,"group_id":9970,"title":"13.7","description":"https://about.gitlab.com/releases/archives.html","state":"closed","created_at":"2020-04-09T17:43:14.893Z","updated_at":"2022-04-13T14:51:12.240Z","due_date":"2020-12-17","start_date":"2020-11-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/54"},"assignees":[{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"}],"author":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"type":"ISSUE","assignee":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"user_notes_count":2,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3255","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3255","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3255/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3255/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3255","relative":"#3255","full":"gitlab-org/gitaly#3255"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":73263830,"iid":3231,"project_id":2009901,"title":"Add FetchSHA abstraction to LocalRepository","description":"Originally reported in https://gitlab.com/gitlab-org/gitaly/-/merge_requests/2693#note_435231130\n\nFetching a single SHA is done in multiple places across Gitaly and is very verbose and error prone. Having a definitive and easy to use function will improve our code quality. Adding a new method `FetchSHA` to `localrepo` could enable this.","state":"closed","created_at":"2020-10-23T18:05:29.240Z","updated_at":"2021-10-28T14:05:10.022Z","closed_at":"2021-08-02T05:47:49.620Z","closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"labels":["Category:Gitaly","[deprecated] good for new contributors","devops::create","group::gitaly","maintenance::refactor","missed:13.10","missed:13.11","missed:13.12","missed:13.9","missed:14.0","section::dev","type::maintenance","workflow::planning breakdown"],"milestone":{"id":1850126,"iid":62,"group_id":9970,"title":"14.2","description":"","state":"active","created_at":"2021-01-26T16:57:35.404Z","updated_at":"2021-07-22T19:45:42.498Z","due_date":"2021-08-17","start_date":"2021-07-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/62"},"assignees":[{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"}],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"type":"ISSUE","assignee":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"user_notes_count":4,"merge_requests_count":2,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3231","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3231","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3231/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3231/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3231","relative":"#3231","full":"gitlab-org/gitaly#3231"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":73262492,"iid":3230,"project_id":2009901,"title":"Inject single client connection pool from main to all Gitaly services","description":"Currently, each service instantiates their own client pool for use in dialing across Gitalies. To improve performance by reducing connection dialing, the same pool should be used everywhere. This ideally should be dependency injected from the main module.\n\nOriginally reported in https://gitlab.com/gitlab-org/gitaly/-/merge_requests/2693#note_435231124","state":"closed","created_at":"2020-10-23T17:22:24.021Z","updated_at":"2022-01-21T07:08:25.495Z","closed_at":"2022-01-21T07:08:25.480Z","closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"labels":["Category:Gitaly","[deprecated] good for new contributors","bug::performance","devops::create","group::gitaly","section::dev"],"milestone":null,"assignees":[],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"type":"ISSUE","assignee":null,"user_notes_count":6,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3230","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3230","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3230/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3230/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3230","relative":"#3230","full":"gitlab-org/gitaly#3230"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":73256843,"iid":3229,"project_id":2009901,"title":"Enable verbose logging of git2go subcommands","description":"Currently, git2go subcommands contain very complex logic for various tasks (e.g. squashing commits/resolving conflicts/commiting multiple changes). The subcommands lack observability since STDERR is used to return error messages. An alternative file descriptor should be used to allow git2go commands to relay back fine grain logs. When a git2go command exits with non-zero, or the logging level is set to a certain level, these fine grain logs should be emitted.","state":"closed","created_at":"2020-10-23T15:52:48.949Z","updated_at":"2022-04-04T00:30:41.741Z","closed_at":"2022-04-04T00:30:41.721Z","closed_by":{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/228150/avatar.png","web_url":"https://gitlab.com/proglottis"},"labels":["Category:Gitaly","Observability","devops::create","group::gitaly","missed:14.7","priority::3","section::dev","severity::4","type::maintenance","workflow::in dev"],"milestone":{"id":2204142,"iid":72,"group_id":9970,"title":"14.10","description":"","state":"active","created_at":"2021-08-26T19:12:33.701Z","updated_at":"2021-08-26T19:12:33.701Z","due_date":"2022-04-17","start_date":"2022-03-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/72"},"assignees":[{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/228150/avatar.png","web_url":"https://gitlab.com/proglottis"}],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"type":"ISSUE","assignee":{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/228150/avatar.png","web_url":"https://gitlab.com/proglottis"},"user_notes_count":9,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3229","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3229","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3229/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3229/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3229","relative":"#3229","full":"gitlab-org/gitaly#3229"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":73184079,"iid":3221,"project_id":2009901,"title":"Refactor NewFeatureSets to remove unused error return value","description":"The test helper function `NewFeatureSets` is not capable of returning a non-nil error. The helper should be fixed to never return an error and all affected code locations should be updated to accept a single return value. Any error assertions for that function call should be removed.\n\nThe function is defined here: https://gitlab.com/gitlab-org/gitaly/-/blob/master/internal/testhelper/testhelper.go#L959-980","state":"closed","created_at":"2020-10-22T16:39:43.750Z","updated_at":"2020-11-05T05:45:33.269Z","closed_at":"2020-11-05T05:45:33.237Z","closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"labels":["Category:Gitaly","[deprecated] good for new contributors","devops::create","group::gitaly","section::dev"],"milestone":null,"assignees":[],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"type":"ISSUE","assignee":null,"user_notes_count":3,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3221","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3221","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3221/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3221/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3221","relative":"#3221","full":"gitlab-org/gitaly#3221"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":72835557,"iid":3211,"project_id":2009901,"title":"GIT_DIR missing in hook environment","description":"### Summary\n\nAs reported in https://gitlab.com/gitlab-org/gitlab/-/issues/258828, the `$GIT_DIR` is not present anymore in the environment for custom server hooks.\n\nI was able to reproduce by following the instructions at https://docs.gitlab.com/ee/administration/server_hooks.html#create-a-global-server-hook-for-all-repositories. The `$GIT_DIR` variable is not set at all for any of the `pre-receive`, `post-receive`, and `update` hooks (this was on a normal project code repository, I assume the same applies for other repository types).\n\nThis seems related to recent work to port the hooks from Ruby to Go. I can see the variable was set in the Ruby code at https://gitlab.com/gitlab-org/gitaly/-/blob/dfd9c3e1a79f6a222b742b1978e45785b06a9440/ruby/lib/gitlab/git/hook.rb#L133.\n\n### Proposal\n\n`$GIT_DIR` is not explicitly documented at https://docs.gitlab.com/ee/administration/server_hooks.html#environment-variables, but for compatibility reasons we probably want to keep supporting it, and should also document this.\n\nWe might also want to double-check that we're not missing any of the other variables that were set in the previous Ruby code: https://gitlab.com/gitlab-org/gitaly/-/blob/dfd9c3e1a79f6a222b742b1978e45785b06a9440/ruby/lib/gitlab/git/hook.rb#L118-138","state":"closed","created_at":"2020-10-16T12:59:27.421Z","updated_at":"2020-12-18T03:44:35.778Z","closed_at":"2020-12-18T03:44:35.728Z","closed_by":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"labels":["Category:Gitaly","devops::create","group::gitaly","priority::3","section::dev","severity::3","type::bug","workflow::in review"],"milestone":{"id":1233759,"iid":55,"group_id":9970,"title":"13.8","description":"https://about.gitlab.com/releases/archives.html","state":"closed","created_at":"2020-04-09T17:44:13.983Z","updated_at":"2022-04-13T14:51:23.220Z","due_date":"2021-01-17","start_date":"2020-12-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/55"},"assignees":[{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"}],"author":{"id":423116,"username":"toupeira","name":"Markus Koller","state":"active","avatar_url":"https://secure.gravatar.com/avatar/7585ed50675c4febe7619f25b44f7fe0?s=80\u0026d=identicon","web_url":"https://gitlab.com/toupeira"},"type":"ISSUE","assignee":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"user_notes_count":8,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3211","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3211","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3211/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3211/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3211","relative":"#3211","full":"gitlab-org/gitaly#3211"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":72770726,"iid":3206,"project_id":2009901,"title":"Follow-up from \"Pass correlation_id over to gitaly-ssh\"","description":"The following discussion from !2530 should be addressed:\n\n- [ ] @ash2k started a [discussion](https://gitlab.com/gitlab-org/gitaly/-/merge_requests/2530#note_428727639):  (+3 comments)\n\n    \u003e @8bitlife \n    \u003e \n    \u003e Just discovered that these interceptors have been added. I understand the motivation but now I cannot customize neither of those interceptors:\n    \u003e \n    \u003e - For the tracing one I'd like to inject a custom `Tracer` by using `grpc_opentracing.UnaryClientInterceptor(grpc_opentracing.WithTracer())` directly, not via LabKit (see the discussion here https://gitlab.com/gitlab-org/labkit/-/merge_requests/66)\n    \u003e - For the correlation one I'd like to set the client name like that `grpccorrelation.StreamClientCorrelationInterceptor(grpccorrelation.WithClientName(\"kas\"))` as suggested here https://gitlab.com/gitlab-com/gl-infra/readiness/-/merge_requests/46#note_428087602 by @jacobvosmaer-gitlab.\n    \u003e \n    \u003e I have looked at the code and both Workhorse are Shell add these interceptors to the client:\n    \u003e \n    \u003e - Workhorse: https://gitlab.com/gitlab-org/gitlab-workhorse/-/blob/master/internal/gitaly/gitaly.go#L158-173 As you can see, it sets client name there.\n    \u003e - Shell: https://github.com/gitlabhq/gitlab-shell/blob/master/internal/handler/exec.go#L112-L120 Also sets the name but is missing the tracing interceptor (maybe intentionally).\n    \u003e \n    \u003e So the current behavior is not ideal - two traces/spans from the same place (right?) and redundant context creation because the correlating interceptor is executed twice (so it adds the correlation ID twice).\n    \u003e \n    \u003e p.s. another bug that I've noticed is that `connOpts` is mutated. It's not safe to append to a slice that has been passed as the caller likely assumes that the method is not mutating it. The slice might have larger capacity and so this method will mutate the original backing array. The code should copy it first.\n    \u003e \n    \u003e p.p.s. It might be nicer to change the signature to varargs to match `grpc.Dial()` and all the other places where we take functional options. This will also address the bug ^.\n\n@8bitlife @zj-gitlab","state":"closed","created_at":"2020-10-15T12:04:30.346Z","updated_at":"2022-08-31T15:35:57.883Z","closed_at":"2022-08-31T15:35:57.696Z","closed_by":{"id":2578846,"username":"wchandler","name":"Will Chandler","state":"active","avatar_url":"https://secure.gravatar.com/avatar/cc8b92738249753faee7055e021f8221?s=80\u0026d=identicon","web_url":"https://gitlab.com/wchandler"},"labels":["Category:Gitaly","auto updated","devops::systems","group::gitaly","section::enablement","severity::4","type::bug","vintage"],"milestone":{"id":2453026,"iid":76,"group_id":9970,"title":"15.4","description":"[GitLab 15.4 Release](https://gitlab.com/gitlab-org/gitlab/-/releases/v15.4.0-ee)","state":"active","created_at":"2022-02-03T22:29:22.015Z","updated_at":"2022-09-29T02:21:26.561Z","due_date":"2022-09-17","start_date":"2022-08-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/76"},"assignees":[{"id":4855585,"username":"ash2k","name":"Mikhail Mazurskiy","state":"active","avatar_url":"https://secure.gravatar.com/avatar/a3161684bd29f5016064a6c16ccd3bc7?s=80\u0026d=identicon","web_url":"https://gitlab.com/ash2k"}],"author":{"id":4855585,"username":"ash2k","name":"Mikhail Mazurskiy","state":"active","avatar_url":"https://secure.gravatar.com/avatar/a3161684bd29f5016064a6c16ccd3bc7?s=80\u0026d=identicon","web_url":"https://gitlab.com/ash2k"},"type":"ISSUE","assignee":{"id":4855585,"username":"ash2k","name":"Mikhail Mazurskiy","state":"active","avatar_url":"https://secure.gravatar.com/avatar/a3161684bd29f5016064a6c16ccd3bc7?s=80\u0026d=identicon","web_url":"https://gitlab.com/ash2k"},"user_notes_count":4,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3206","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":1,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3206","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3206/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3206/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3206","relative":"#3206","full":"gitlab-org/gitaly#3206"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":72578977,"iid":3196,"project_id":2009901,"title":"Intercept CreateRepository in Praefect to set up repository database state","description":"Currently we do not have a record of every repository a virtual storage is supposed to contain. This will change with #3033. We should intercept `CreateRepository` calls and set up the expected database records a repository should have. Related to #3133, we should select a primary for the repository when it is created. Related to #2971, we should select the nodes that will host the repository when it is created. Additionally, we can make generation related queries stricter once we can expect every repository to be present in the database and not allow for example incrementing generation of a repository that does not exist. Stricter queries prevent certain class of errors, such as https://gitlab.com/gitlab-org/gitaly/-/issues/3183, and make the logic simpler as we don't have to handle cases where the records are missing.","state":"closed","created_at":"2020-10-12T13:10:36.865Z","updated_at":"2021-02-03T10:02:30.862Z","closed_at":"2021-02-03T10:02:30.814Z","closed_by":{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5522960/avatar.png","web_url":"https://gitlab.com/samihiltunen"},"labels":["Category:Gitaly","GitLab Premium","Gitaly","devops::create","group::gitaly","group::gitaly::cluster","missed:13.6","section::dev","workflow::in dev"],"milestone":{"id":1233760,"iid":56,"group_id":9970,"title":"13.9","description":"https://about.gitlab.com/releases/archives.html","state":"closed","created_at":"2020-04-09T17:44:14.334Z","updated_at":"2022-04-21T07:21:28.468Z","due_date":"2021-02-17","start_date":"2021-01-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/56"},"assignees":[{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/228150/avatar.png","web_url":"https://gitlab.com/proglottis"}],"author":{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5522960/avatar.png","web_url":"https://gitlab.com/samihiltunen"},"type":"ISSUE","assignee":{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/228150/avatar.png","web_url":"https://gitlab.com/proglottis"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3196","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3196","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3196/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3196/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3196","relative":"#3196","full":"gitlab-org/gitaly#3196"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":3372,"epic":{"id":56824,"iid":3372,"title":"🪁 Gitaly Clusters variable replication factor","url":"/groups/gitlab-org/-/epics/3372","group_id":9970,"human_readable_end_date":"Feb 17, 2022","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":72555029,"iid":3195,"project_id":2009901,"title":"UserMerge RPC should error with FailedPrecondition on merge conflicts","description":"### Problem\n\nWhen a user merges a branch while it can't be merged, the Gitaly service will detect this, and return an error. This error is an Unknown error currently, which is surprising to operators of Gitaly. Additionally, the error is wrong as the why of the error is known.\n\nLast reason it should be another error, is that Unknown influences SL{A,O}s. Though it shouldn't.\n\n### Solution\n\nGitaly should return a FailedPrecondition when it can't be merged due to conflicts.","state":"closed","created_at":"2020-10-12T07:41:14.651Z","updated_at":"2021-10-28T14:06:01.020Z","closed_at":"2021-07-29T10:25:15.258Z","closed_by":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"labels":["Category:Gitaly","devops::create","group::gitaly","missed:13.11","missed:13.12","missed:14.0","priority::4","section::dev","severity::4","type::maintenance","workflow::in dev"],"milestone":{"id":1850126,"iid":62,"group_id":9970,"title":"14.2","description":"","state":"active","created_at":"2021-01-26T16:57:35.404Z","updated_at":"2021-07-22T19:45:42.498Z","due_date":"2021-08-17","start_date":"2021-07-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/62"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"user_notes_count":4,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3195","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3195","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3195/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3195/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3195","relative":"#3195","full":"gitlab-org/gitaly#3195"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":72076407,"iid":3182,"project_id":2009901,"title":"Replace BurntSushi/toml package","description":"Gitaly uses TOML for configuration, and parsing is done with `github.com/BurntSushi/toml`. That package has gone unmaintained and while TOML is stable, Gitaly should depend on a new package  which is supported.","state":"closed","created_at":"2020-10-02T12:27:00.182Z","updated_at":"2021-10-28T14:06:27.788Z","closed_at":"2020-10-12T12:24:49.937Z","closed_by":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"labels":["Category:Gitaly","devops::create","group::gitaly","section::dev","type::maintenance"],"milestone":{"id":1233754,"iid":52,"group_id":9970,"title":"13.5","description":"https://about.gitlab.com/releases/2020/10/22/gitlab-13-5-released/","state":"closed","created_at":"2020-04-09T17:39:21.990Z","updated_at":"2022-04-21T07:21:12.213Z","due_date":"2020-10-17","start_date":"2020-09-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/52"},"assignees":[],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"type":"ISSUE","assignee":null,"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3182","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3182","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3182/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3182/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3182","relative":"#3182","full":"gitlab-org/gitaly#3182"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":72050561,"iid":3181,"project_id":2009901,"title":"CreateRepositoryFromSnapshot will fail with error 'Promoting temporary directory failed' if parent directories of target path do not already exist","description":"If `CreateRepositoryFromSnapshot` is called when the parent directory of the target path does not exist, the request will fail with error:\n\n```\nrpc error: code = Internal desc = Promoting temporary directory failed: rename /var/opt/gitlab/git-data/repositories/+gitaly/tmp/repo446863582 /var/opt/gitlab/git-data/repositories/@geo-temporary/@hashed/\n19/58/19581e27de7ced00ff1ce50b2047e7a567c76b1cbaebabe5ef03f7c3017bb5b7.git: no such file or directory\n```\n\nStracing this, we find that the `renameat` call fails with ENOENT:\n\n```\n18192 22:01:24.772985 renameat(AT_FDCWD, \"/var/opt/gitlab/git-data/repositories/+gitaly/tmp/repo446863582\", AT_FDCWD, \"/var/opt/gitlab/git-data/repositories/@ge\no-temporary/@hashed/19/58/19581e27de7ced00ff1ce50b2047e7a567c76b1cbaebabe5ef03f7c3017bb5b7.git\") = -1 ENOENT (No such file or directory) \u003c0.000013\u003e\n```\n\nGenerally this RPC is only called on a second attempt to create a repository, so the directory has already been created, but due to https://gitlab.com/gitlab-org/gitlab/-/issues/9803#note_422414267 these calls were the first attempt, exposing this issue.\n\n`ReplicateRepository` will [ensure the directories are present](https://gitlab.com/gitlab-org/gitaly/-/blob/d76d10b540d474d950103aa3303a89a9aad9dd88/internal/gitaly/service/repository/replicate.go#L142-144) before renaming the tmp directory, we should do the same in [this RPC](https://gitlab.com/gitlab-org/gitaly/-/blob/d76d10b540d474d950103aa3303a89a9aad9dd88/internal/gitaly/service/repository/create_from_snapshot.go#L106-112).","state":"closed","created_at":"2020-10-02T02:02:15.948Z","updated_at":"2020-10-26T15:38:13.244Z","closed_at":"2020-10-26T15:38:13.153Z","closed_by":{"id":660180,"username":"toon","name":"Toon Claes","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/660180/avatar.png","web_url":"https://gitlab.com/toon"},"labels":["Category:Gitaly","devops::create","group::gitaly","section::dev","severity::3","type::bug","workflow::ready for development"],"milestone":{"id":1233755,"iid":53,"group_id":9970,"title":"13.6","description":"https://about.gitlab.com/releases/2020/11/22/gitlab-13-6-released/","state":"closed","created_at":"2020-04-09T17:39:22.328Z","updated_at":"2022-04-13T14:51:04.376Z","due_date":"2020-11-17","start_date":"2020-10-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/53"},"assignees":[{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5522960/avatar.png","web_url":"https://gitlab.com/samihiltunen"}],"author":{"id":2578846,"username":"wchandler","name":"Will Chandler","state":"active","avatar_url":"https://secure.gravatar.com/avatar/cc8b92738249753faee7055e021f8221?s=80\u0026d=identicon","web_url":"https://gitlab.com/wchandler"},"type":"ISSUE","assignee":{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5522960/avatar.png","web_url":"https://gitlab.com/samihiltunen"},"user_notes_count":2,"merge_requests_count":1,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3181","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3181","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3181/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3181/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3181","relative":"#3181","full":"gitlab-org/gitaly#3181"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":71993240,"iid":3177,"project_id":2009901,"title":"Gitaly module version cannot be updated in gitlab-workhorse and gitlab-shell","description":"On a clean Go v1.15.2 installation, I get this while trying to update the Gitaly module in gitlab-workhorse and gitlab-shell:\n\n```\n$  go get -u gitlab.com/gitlab-org/gitaly@v13.5.0-rc1\ngo: downloading gitlab.com/gitlab-org/gitaly v0.0.0-20201001041716-3f5e218def93\ngo: gitlab.com/gitlab-org/gitaly v13.5.0-rc1 =\u003e v0.0.0-20201001041716-3f5e218def93\ncat go.mod\ngo get: inconsistent versions:\n\tgitlab.com/gitlab-org/gitaly@v0.0.0-20201001041716-3f5e218def93 from gitlab.com/gitlab-org/gitaly@v13.5.0-rc1 requires gitlab.com/gitlab-org/gitaly@v1.68.0 (not gitlab.com/gitlab-org/gitaly@v0.0.0-20201001041716-3f5e218def93 from gitlab.com/gitlab-org/gitaly@v13.5.0-rc1)\n```\n\nAccording to https://github.com/golang/go/issues/35732 and https://golang.org/cmd/go/#hdr-Module_compatibility_and_semantic_versioning, this is because Go is trying to enforce semantic compatibility:\n\n\u003e\u003e\u003e\nIn semantic versioning, changing the major version number indicates a lack of backwards compatibility with earlier versions. To preserve import compatibility, the go command requires that modules with major version v2 or later use a module path with that major version as the final element. For example, version v2.0.0 of example.com/m must instead use module path example.com/m/v2, and packages in that module would use that path as their import path prefix, as in example.com/m/v2/sub/pkg. Including the major version number in the module path and import paths in this way is called \"semantic import versioning\". Pseudo-versions for modules with major version v2 and later begin with that major version instead of v0, as in v2.0.0-20180326061214-4fc5987536ef. \n\u003e\u003e\u003e\n\nI think this is saying that Gitaly should be using `m/v13` in the module path.\n\nA workaround may be to tag another v1 tag with the latest master:\n\n\u003e\u003e\u003e\nCode written before the semantic import versioning convention was introduced may use major versions v2 and later to describe the same set of unversioned import paths as used in v0 and v1. To accommodate such code, if a source code repository has a v2.0.0 or later tag for a file tree with no go.mod, the version is considered to be part of the v1 module's available versions and is given an +incompatible suffix when converted to a module version, as in v2.0.0+incompatible. The +incompatible tag is also applied to pseudo-versions derived from such versions, as in v2.0.1-0.yyyymmddhhmmss-abcdefabcdef+incompatible. \n\u003e\u003e\u003e\n\nv1.87.0 was tagged in February 2020, and then we switched versioning schemes.\n\n@pokstad1 @samihiltunen What do you think we should do here?","state":"closed","created_at":"2020-10-01T06:11:32.689Z","updated_at":"2022-05-02T03:30:16.223Z","closed_at":"2021-06-08T12:38:25.864Z","closed_by":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"labels":["Category:Gitaly","auto updated","devops::create","group::gitaly","missed:13.10","missed:13.11","section::dev","workflow::in dev"],"milestone":{"id":1850113,"iid":60,"group_id":9970,"title":"14.0","description":"","state":"closed","created_at":"2021-01-26T16:55:07.714Z","updated_at":"2022-04-21T07:25:17.749Z","due_date":"2021-06-17","start_date":"2021-05-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/60"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"}],"author":{"id":64248,"username":"stanhu","name":"Stan Hu","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/64248/stanhu.jpg","web_url":"https://gitlab.com/stanhu"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"user_notes_count":12,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3177","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3177","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3177/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3177/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3177","relative":"#3177","full":"gitlab-org/gitaly#3177"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":71984925,"iid":3175,"project_id":2009901,"title":"Repository updates intermittently disappear on busy repos hosted on NFS mount shared by multiple Gitaly servers","description":"Issue is occurring on a large customer with three Gitaly nodes sharing an NFS mount behind a load balancer, appearing to be a single storage to rails.\n\nAfter upgrading to v13.3.2 several weeks ago users on several high-traffic projects on their instance have reported recently merged changes disappearing.  No errors are received when merging, but when they check the updated file at a later time the change is not present.  They had no reports of this issue when on v12.10.\n\nThis may be the same underlying issue as #2589.\n\nLooking at a specific example, we found a GC had been running on a separate Gitaly host during the a `UserMergeBranch` was executed.  The GC reported the following error:\n\n```\n{\n  \"correlation_id\": \"GPhidQI0kw9\",\n  \"grpc.meta.auth_version\": \"v2\",\n  \"grpc.meta.client_name\": \"gitlab-sidekiq\",\n  \"grpc.meta.deadline_type\": \"unknown\",\n  \"grpc.method\": \"GarbageCollect\",\n  \"grpc.request.deadline\": \"2020-09-29T12:49:23Z\",\n  \"grpc.request.fullMethod\": \"/gitaly.RepositoryService/GarbageCollect\",\n  \"grpc.request.glProjectPath\": \"services/crm/Lightning/lightning-service/service\",\n  \"grpc.request.glRepository\": \"project-3515\",\n  \"grpc.request.repoPath\": \"services/crm/Lightning/lightning-service/service.git\",\n  \"grpc.request.repoStorage\": \"default\",\n  \"grpc.request.topLevelGroup\": \"services\",\n  \"grpc.service\": \"gitaly.RepositoryService\",\n  \"grpc.start_time\": \"2020-09-29T06:49:23Z\",\n  \"level\": \"error\",\n  \"msg\": \"warning: garbage found: /var/opt/gitlab-data/git-data/repositories/group/project/objects/pack/.nfs0000000002e6ff1b0002d23a\nwarning: garbage found: /var/opt/gitlab-data/git-data/repositories/group/project.git/objects/pack/.nfs0000000002e6a8590002d236\nwarning: garbage found: /var/opt/gitlab-data/git-data/repositories/group/project.git/objects/pack/.nfs0000000002e74aa30002d237\nwarning: garbage found: /var/opt/gitlab-data/git-data/repositories/group/project.git/objects/pack/.nfs0000000002b239f50002d238\nwarning: garbage found: /var/opt/gitlab-data/git-data/repositories/group/project.git/objects/pack/.nfs0000000002bf55ea0002d234\",\n  \"peer.address\": \"10.143.238.127:20084\",\n  \"pid\": 16719,\n  \"span.kind\": \"server\",\n  \"system\": \"grpc\",\n  \"time\": \"2020-09-29T06:50:44.402Z\"\n}\n```\n\nThese `.nfs...` files indicate that a file with an open file handle against it was deleted.  NFS will perform a [silly rename](http://nfs.sourceforge.net) when this occurs, renaming the file to the `.nfs...` format and keeping it on disk until the file handle is released. This suggests that something is deleting pack files out from under another process, though which specific processes are unclear.\n\nIn addition, we see intermittent `rpc error: code = Unknown desc = Rugged::OSError: failed to read descriptor: Stale file handle` messages on multiple Gitaly-Ruby RPCs.  In these cases the request fails, so no data loss occurs.\n\nCurrent NFS mount settings on Gitaly nodes:\n\n```\nnfs4 (rw,relatime,vers=4.1,rsize=262144,wsize=262144,namlen=255,hard,proto=tcp,timeo=600,retrans=2,sec=sys,clientaddr=10.182.169.125,local_lock=none)\n```\n\nNote that the customer will be adding `lookupcache=positive` to their settings at their earliest opportunity.\n\n/cc @pokstad1 @cnightingale @bprescott\\_","state":"closed","created_at":"2020-10-01T02:34:21.181Z","updated_at":"2023-03-20T18:04:35.181Z","closed_at":"2020-11-04T20:53:10.230Z","closed_by":{"id":2578846,"username":"wchandler","name":"Will Chandler","state":"active","avatar_url":"https://secure.gravatar.com/avatar/cc8b92738249753faee7055e021f8221?s=80\u0026d=identicon","web_url":"https://gitlab.com/wchandler"},"labels":["Category:Gitaly","[deprecated] Accepting merge requests","customer","devops::create","group::gitaly","priority::3","section::dev","severity::2","type::bug"],"milestone":{"id":490705,"iid":14,"group_id":9970,"title":"Backlog","description":"Issues that we want to do but are not planned right now. Open for contribution from the community.","state":"active","created_at":"2018-03-22T13:09:23.767Z","updated_at":"2018-10-30T14:56:54.069Z","due_date":null,"start_date":null,"expired":false,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/14"},"assignees":[],"author":{"id":2578846,"username":"wchandler","name":"Will Chandler","state":"active","avatar_url":"https://secure.gravatar.com/avatar/cc8b92738249753faee7055e021f8221?s=80\u0026d=identicon","web_url":"https://gitlab.com/wchandler"},"type":"ISSUE","assignee":null,"user_notes_count":9,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3175","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3175","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3175/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3175/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3175","relative":"#3175","full":"gitlab-org/gitaly#3175"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":71737554,"iid":3160,"project_id":2009901,"title":"Gitaly HTTP client should specify TLSClientConfig to support mutual TLS auth","description":"Gitaly currently doesn't specify a TLSClientConfig for the HTTP client used to make requests to the GitLab internal API. This prevents interoperation with services that require mutual TLS auth (e.g. nginx). The non-gRPC clients in Gitaly should be updated to use the configured Gitaly certificates for client connections.","state":"closed","created_at":"2020-09-26T16:17:45.626Z","updated_at":"2021-08-09T13:57:47.757Z","closed_at":"2020-11-17T18:24:54.226Z","closed_by":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"labels":["Category:Gitaly","Deliverable","customer","devops::create","group::gitaly","section::dev","workflow::in review"],"milestone":{"id":1233755,"iid":53,"group_id":9970,"title":"13.6","description":"https://about.gitlab.com/releases/2020/11/22/gitlab-13-6-released/","state":"closed","created_at":"2020-04-09T17:39:22.328Z","updated_at":"2022-04-13T14:51:04.376Z","due_date":"2020-11-17","start_date":"2020-10-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/53"},"assignees":[{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"}],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"type":"ISSUE","assignee":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"user_notes_count":12,"merge_requests_count":1,"upvotes":2,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3160","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3160","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3160/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3160/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3160","relative":"#3160","full":"gitlab-org/gitaly#3160"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":71507387,"iid":3151,"project_id":2009901,"title":"Leverage core.bigFilesTreshold for better memory utilization","description":"From `man git-config`:\n\n```\n       core.bigFileThreshold\n           Files larger than this size are stored deflated, without attempting delta compression. Storing large files without delta compression avoids excessive memory usage, at the slight expense of\n           increased disk usage. Additionally files larger than this size are always treated as binary.\n\n           Default is 512 MiB on all platforms. This should be reasonable for most projects as source code and other text files can still be delta compressed, but larger binary media files won’t be.\n\n           Common unit suffixes of k, m, or g are supported.\n```\n\nGitaly doesn't set the `core.bigFileThreshold`, so it defaults to 512MiB. I think `50m` would be a better threshold and creates a better trade off for us. As I think the number of source files that are over 50MB is limited, so until that point each blob will still be compressed, and they get optimized packs for it. \n\nThis config should be dynamically inject on the relevant Git commands/RPCs to improve `*UploadPack` performance, as well as `Repack*` performance.\n\n* [Tradeoffs from a user perspective](https://kscherer.github.io/linux%20git/2014/09/26/git-server-option-bigfilethreshold)","state":"closed","created_at":"2020-09-22T13:44:04.601Z","updated_at":"2022-11-10T01:06:13.097Z","closed_at":"2020-12-07T15:38:00.716Z","closed_by":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"labels":["Category:Gitaly","[deprecated] Accepting merge requests","bug::performance","devops::create","group::gitaly","section::dev","type::feature"],"milestone":{"id":490705,"iid":14,"group_id":9970,"title":"Backlog","description":"Issues that we want to do but are not planned right now. Open for contribution from the community.","state":"active","created_at":"2018-03-22T13:09:23.767Z","updated_at":"2018-10-30T14:56:54.069Z","due_date":null,"start_date":null,"expired":false,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/14"},"assignees":[],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"type":"ISSUE","assignee":null,"user_notes_count":4,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3151","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3151","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3151/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3151/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3151","relative":"#3151","full":"gitlab-org/gitaly#3151"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":71198033,"iid":3135,"project_id":2009901,"title":"Reference transaction hook votes twice per reference update","description":"The reference-transaction hook will be called for every transition in Git's reference transaction mechanism. Currently, this will include exactly two transitions: either from `START -\u003e prepared -\u003e committed` or `START -\u003e prepared -\u003e aborted`. As our own hook will ignore which state we're transitioning to, we'll thus call out to the hook service twice and not pass along which state we've transitioned to. As a result, the hook service will vote twice per each reference update.\n\nOne could argue that this is a feature and not a bug in order to assert that we've actually performed both transitions as expected. But in any case, voting in the second transition from `prepared -\u003e {committed,aborted}` is quite useless to us as Git will ignore the Git hook's return value in these transitions. After all, the transaction has already been wrapped up, so there's no way it can be changed after the fact.\n\nAs a result, we should stop voting in the second transition and only vote when moving to prepared state.","state":"closed","created_at":"2020-09-15T13:19:59.733Z","updated_at":"2020-10-18T07:08:20.815Z","closed_at":"2020-10-14T09:13:51.017Z","closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"labels":["Category:Gitaly","Deliverable","devops::create","group::gitaly","section::dev","type::bug","workflow::in review"],"milestone":{"id":1233754,"iid":52,"group_id":9970,"title":"13.5","description":"https://about.gitlab.com/releases/2020/10/22/gitlab-13-5-released/","state":"closed","created_at":"2020-04-09T17:39:21.990Z","updated_at":"2022-04-21T07:21:12.213Z","due_date":"2020-10-17","start_date":"2020-09-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/52"},"assignees":[{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"}],"author":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"type":"ISSUE","assignee":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"user_notes_count":4,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3135","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3135","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3135/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3135/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3135","relative":"#3135","full":"gitlab-org/gitaly#3135"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1189,"epic":{"id":5989,"iid":1189,"title":"Gitaly Cluster: strong consistency","url":"/groups/gitlab-org/-/epics/1189","group_id":9970,"human_readable_end_date":"Sep 17, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":70726576,"iid":3110,"project_id":2009901,"title":"No use of checksum comparison after replication is done","description":"Once the replication is done (`update` of the repository at the gitaly storage) praefect runs [`CalculateChecksum`](https://gitlab.com/gitlab-org/gitaly/-/blob/master/internal/praefect/replicator.go#L263) for source and target gitaly nodes.  \nThe result of the execution compared and if there is no match the error message would be written into the log (example):\n```json\n{\n      \"msg\": \"checksums do not match\",\n      \"hostname\": \"praefect-01-stor-gprd\",\n      \"shard\": \"default\",\n      \"level\": \"error\",\n      \"primary\": {\n        \"storage_name\": \"file-praefect-02\",\n        \"relative_path\": \"@hashed/fa/53/fa539965395b8382145f8370b34eab249cf610d2d6f2943c95b9b9d08a63d4a3.git\"\n      },\n      \"replica\": {\n        \"relative_path\": \"@hashed/fa/53/fa539965395b8382145f8370b34eab249cf610d2d6f2943c95b9b9d08a63d4a3.git\",\n        \"storage_name\": \"file-praefect-01\"\n      },\n      \"environment\": \"gprd\",\n      \"pid\": 32412,\n      \"time\": \"2020-09-03T20:58:57.840Z\",\n      \"tier\": \"sv\",\n      \"type\": \"praefect\",\n      \"fqdn\": \"praefect-01-stor-gprd.c.gitlab-production.internal\",\n      \"tag\": \"praefect\",\n      \"stage\": \"main\"\n}\n```\n\nThis happens pretty often:\nStart of the replication: ![image](/uploads/45c46f2939516b0ce4d5913a810ee493/image.png)  \nErrors about not matching checksums: ![image](/uploads/86763ea999d149bc58e23af9599f12d7/image.png)\n\nAs a first step we could properly propagate `correlation_id` to all logging entries to get more info about what is going on as it is not used in all places where we log something.  \n\nIt is not clear if we should take any actions in regard of different checksums for the repository.\n\n/cc @zj-gitlab @derekferguson","state":"closed","created_at":"2020-09-04T09:34:31.920Z","updated_at":"2020-12-03T13:45:50.796Z","closed_at":"2020-12-03T13:45:50.580Z","closed_by":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"labels":["Category:Gitaly","devops::create","group::gitaly","missed:13.6","section::dev","workflow::in review"],"milestone":{"id":1233757,"iid":54,"group_id":9970,"title":"13.7","description":"https://about.gitlab.com/releases/archives.html","state":"closed","created_at":"2020-04-09T17:43:14.893Z","updated_at":"2022-04-13T14:51:12.240Z","due_date":"2020-12-17","start_date":"2020-11-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/54"},"assignees":[{"id":660180,"username":"toon","name":"Toon Claes","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/660180/avatar.png","web_url":"https://gitlab.com/toon"}],"author":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"type":"ISSUE","assignee":{"id":660180,"username":"toon","name":"Toon Claes","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/660180/avatar.png","web_url":"https://gitlab.com/toon"},"user_notes_count":5,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3110","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3110","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3110/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3110/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3110","relative":"#3110","full":"gitlab-org/gitaly#3110"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":70504008,"iid":3098,"project_id":2009901,"title":"Fixup reference-transaction hook name based on arguments","description":"While the reference-transaction hook was released with Git v2.28.0, it's got a bug which will cause Git to accidentally execute the wrong hook if there's been interleaving calls to both the reference-transaction and another hook. This bug currently prohibits us to use the hook for reference transaction voting until a new Git version is released with the upstreamed fix. Given that this could be as late as release v2.29.0, it's potentially still quite a while until we can use the hook.\n\nAs a temporary workaround, we may manually fixup hook names in our `gitaly-hooks` binary. GitLab systems only have at most four hooks installed: `reference-transaction`, `pre-receive`, `update` and `post-receive`. Because of how these hooks get called, we should be able to tell the case when Git meant to execute the `reference-transaction` hook instead of any of the other three by inspecting the hook's arguments:\n\n- `reference-transaction` will receive as first arguments one of `prepared`, `committed` or `aborted`\n- `pre-receive` never gets any arguments\n- `update` will get as first argument the reference that is to be updated in its fully-qualified form (e.g. `refs/heads/master`) and thus should never clash with any of the three above verbs\n- `post-receive` never gets any arguments\n\nAs a consequence, none of these hooks except for the `reference-transaction` hook will ever get executed with one of `prepared`, `committed` or `aborted`. If they were executed with such an argument, we can be sure that Git wanted to execute the `reference-transaction` hook instead.\n\nBy making use of this info, we should be able to fix up the hook name without any casualties and unblock ourselves until Git v2.29.0 is released with a fix.","state":"closed","created_at":"2020-08-31T12:51:39.276Z","updated_at":"2020-09-04T15:11:29.299Z","closed_at":"2020-09-04T14:29:45.858Z","closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"labels":["Category:Gitaly","devops::create","group::gitaly","section::dev","type::bug"],"milestone":{"id":1233753,"iid":51,"group_id":9970,"title":"13.4","description":"https://about.gitlab.com/releases/2020/09/22/gitlab-13-4-released/","state":"closed","created_at":"2020-04-09T17:39:21.662Z","updated_at":"2022-04-13T14:50:33.769Z","due_date":"2020-09-17","start_date":"2020-08-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/51"},"assignees":[{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"}],"author":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"type":"ISSUE","assignee":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3098","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3098","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3098/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3098/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3098","relative":"#3098","full":"gitlab-org/gitaly#3098"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1189,"epic":{"id":5989,"iid":1189,"title":"Gitaly Cluster: strong consistency","url":"/groups/gitlab-org/-/epics/1189","group_id":9970,"human_readable_end_date":"Sep 17, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":70060227,"iid":3077,"project_id":2009901,"title":"Port UserUpdateSubmodule to Go","description":"UserUpdateSubmodule is currently handled by the Gitaly-Ruby sidecar, and should be ported to Go for performance reasons. This could be handled by shelling out to Git, leveraging Git2Go, or another way.\n\n/labels ~\"performance\" ~\"group::gitaly\"","state":"closed","created_at":"2020-08-20T10:29:50.883Z","updated_at":"2020-11-11T21:17:17.061Z","closed_at":"2020-11-10T07:42:16.913Z","closed_by":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"labels":["Category:Gitaly","Deliverable","Gitaly-Ruby","devops::create","group::gitaly","missed-deliverable","missed:13.5","section::dev","workflow::in review"],"milestone":{"id":1233755,"iid":53,"group_id":9970,"title":"13.6","description":"https://about.gitlab.com/releases/2020/11/22/gitlab-13-6-released/","state":"closed","created_at":"2020-04-09T17:39:22.328Z","updated_at":"2022-04-13T14:51:04.376Z","due_date":"2020-11-17","start_date":"2020-10-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/53"},"assignees":[{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"type":"ISSUE","assignee":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3077","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3077","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3077/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3077/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3077","relative":"#3077","full":"gitlab-org/gitaly#3077"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2862,"epic":{"id":30693,"iid":2862,"title":"🏍 Remove the Gitaly-Ruby sidecar","url":"/groups/gitlab-org/-/epics/2862","group_id":9970,"human_readable_end_date":"May 17, 2023","human_readable_timestamp":"\u003cstrong\u003e11\u003c/strong\u003e days remaining"},"iteration":null,"health_status":null},{"id":70060225,"iid":3076,"project_id":2009901,"title":"Port UserApplyPatch to Go","description":"UserApplyPatch is currently handled by the Gitaly-Ruby sidecar, and should be ported to Go for performance reasons. This could be handled by shelling out to Git, leveraging Git2Go, or another way.","state":"closed","created_at":"2020-08-20T10:29:49.952Z","updated_at":"2021-08-18T07:04:41.557Z","closed_at":"2021-07-22T09:21:38.206Z","closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"labels":["Category:Gitaly","Deliverable","bug::performance","devops::create","feature::enhancement","group::gitaly","missed-deliverable","missed:13.10","missed:13.11","missed:13.12","missed:13.9","missed:14.0","missed:14.1","section::dev","type::feature","workflow::in review"],"milestone":{"id":1850126,"iid":62,"group_id":9970,"title":"14.2","description":"","state":"active","created_at":"2021-01-26T16:57:35.404Z","updated_at":"2021-07-22T19:45:42.498Z","due_date":"2021-08-17","start_date":"2021-07-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/62"},"assignees":[{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5522960/avatar.png","web_url":"https://gitlab.com/samihiltunen"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"type":"ISSUE","assignee":{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5522960/avatar.png","web_url":"https://gitlab.com/samihiltunen"},"user_notes_count":15,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3076","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3076","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3076/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3076/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3076","relative":"#3076","full":"gitlab-org/gitaly#3076"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2862,"epic":{"id":30693,"iid":2862,"title":"🏍 Remove the Gitaly-Ruby sidecar","url":"/groups/gitlab-org/-/epics/2862","group_id":9970,"human_readable_end_date":"May 17, 2023","human_readable_timestamp":"\u003cstrong\u003e11\u003c/strong\u003e days remaining"},"iteration":null,"health_status":"on_track"},{"id":70060224,"iid":3075,"project_id":2009901,"title":"Port UserSquash to Go","description":"UserSquash is currently handled by the Gitaly-Ruby sidecar, and should be ported to Go for performance reasons. This could be handled by shelling out to Git, leveraging Git2Go, or another way.\n\n/labels ~\"performance\" ~\"group::gitaly\"","state":"closed","created_at":"2020-08-20T10:29:48.454Z","updated_at":"2020-11-12T13:06:31.396Z","closed_at":"2020-10-15T07:51:30.775Z","closed_by":{"id":138401,"username":"chriscool","name":"Christian Couder","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/138401/avatar.png","web_url":"https://gitlab.com/chriscool"},"labels":["Category:Gitaly","Deliverable","devops::create","group::gitaly","section::dev","workflow::in review"],"milestone":{"id":1233754,"iid":52,"group_id":9970,"title":"13.5","description":"https://about.gitlab.com/releases/2020/10/22/gitlab-13-5-released/","state":"closed","created_at":"2020-04-09T17:39:21.990Z","updated_at":"2022-04-21T07:21:12.213Z","due_date":"2020-10-17","start_date":"2020-09-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/52"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3075","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3075","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3075/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3075/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3075","relative":"#3075","full":"gitlab-org/gitaly#3075"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2862,"epic":{"id":30693,"iid":2862,"title":"🏍 Remove the Gitaly-Ruby sidecar","url":"/groups/gitlab-org/-/epics/2862","group_id":9970,"human_readable_end_date":"May 17, 2023","human_readable_timestamp":"\u003cstrong\u003e11\u003c/strong\u003e days remaining"},"iteration":null,"health_status":null},{"id":70060223,"iid":3074,"project_id":2009901,"title":"Port UserCommitFiles to Go","description":"UserCommitFiles is currently handled by the Gitaly-Ruby sidecar, and should be ported to Go for performance reasons. This could be handled by shelling out to Git, leveraging Git2Go, or another way.\n\n/labels ~\"performance\" ~\"group::gitaly\"","state":"closed","created_at":"2020-08-20T10:29:47.315Z","updated_at":"2020-11-09T15:14:58.526Z","closed_at":"2020-10-30T10:55:20.872Z","closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"labels":["Category:Gitaly","Deliverable","devops::create","group::gitaly","missed-deliverable","missed:13.5","section::dev","workflow::in review"],"milestone":{"id":1233755,"iid":53,"group_id":9970,"title":"13.6","description":"https://about.gitlab.com/releases/2020/11/22/gitlab-13-6-released/","state":"closed","created_at":"2020-04-09T17:39:22.328Z","updated_at":"2022-04-13T14:51:04.376Z","due_date":"2020-11-17","start_date":"2020-10-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/53"},"assignees":[{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5522960/avatar.png","web_url":"https://gitlab.com/samihiltunen"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"type":"ISSUE","assignee":{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5522960/avatar.png","web_url":"https://gitlab.com/samihiltunen"},"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3074","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3074","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3074/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3074/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3074","relative":"#3074","full":"gitlab-org/gitaly#3074"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2862,"epic":{"id":30693,"iid":2862,"title":"🏍 Remove the Gitaly-Ruby sidecar","url":"/groups/gitlab-org/-/epics/2862","group_id":9970,"human_readable_end_date":"May 17, 2023","human_readable_timestamp":"\u003cstrong\u003e11\u003c/strong\u003e days remaining"},"iteration":null,"health_status":null},{"id":70060220,"iid":3072,"project_id":2009901,"title":"Port UserRevert to Go","description":"UserRevert is currently handled by the Gitaly-Ruby sidecar, and should be ported to Go for performance reasons. This could be handled by shelling out to Git, leveraging Git2Go, or another way.\n\n/labels ~\"performance\" ~\"group::gitaly\"","state":"closed","created_at":"2020-08-20T10:29:44.746Z","updated_at":"2020-12-08T22:11:58.040Z","closed_at":"2020-12-03T08:31:49.805Z","closed_by":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"labels":["Category:Gitaly","Deliverable","Gitaly-Ruby","devops::create","group::gitaly","missed-deliverable","missed:13.5","section::dev","workflow::verification"],"milestone":{"id":1233755,"iid":53,"group_id":9970,"title":"13.6","description":"https://about.gitlab.com/releases/2020/11/22/gitlab-13-6-released/","state":"closed","created_at":"2020-04-09T17:39:22.328Z","updated_at":"2022-04-13T14:51:04.376Z","due_date":"2020-11-17","start_date":"2020-10-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/53"},"assignees":[{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/228150/avatar.png","web_url":"https://gitlab.com/proglottis"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"type":"ISSUE","assignee":{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/228150/avatar.png","web_url":"https://gitlab.com/proglottis"},"user_notes_count":3,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3072","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3072","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3072/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3072/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3072","relative":"#3072","full":"gitlab-org/gitaly#3072"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2862,"epic":{"id":30693,"iid":2862,"title":"🏍 Remove the Gitaly-Ruby sidecar","url":"/groups/gitlab-org/-/epics/2862","group_id":9970,"human_readable_end_date":"May 17, 2023","human_readable_timestamp":"\u003cstrong\u003e11\u003c/strong\u003e days remaining"},"iteration":null,"health_status":null},{"id":70060218,"iid":3071,"project_id":2009901,"title":"Port UserCherryPick to Go","description":"UserCherryPick is currently handled by the Gitaly-Ruby sidecar, and should be ported to Go for performance reasons. This could be handled by shelling out to Git, leveraging Git2Go, or another way.","state":"closed","created_at":"2020-08-20T10:29:43.689Z","updated_at":"2021-02-18T07:07:55.400Z","closed_at":"2021-02-18T02:20:24.777Z","closed_by":{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/228150/avatar.png","web_url":"https://gitlab.com/proglottis"},"labels":["Category:Gitaly","Deliverable","bug::performance","devops::create","group::gitaly","missed-deliverable","missed:13.5","missed:13.6","section::dev","workflow::in review"],"milestone":{"id":1233760,"iid":56,"group_id":9970,"title":"13.9","description":"https://about.gitlab.com/releases/archives.html","state":"closed","created_at":"2020-04-09T17:44:14.334Z","updated_at":"2022-04-21T07:21:28.468Z","due_date":"2021-02-17","start_date":"2021-01-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/56"},"assignees":[{"id":660180,"username":"toon","name":"Toon Claes","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/660180/avatar.png","web_url":"https://gitlab.com/toon"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"type":"ISSUE","assignee":{"id":660180,"username":"toon","name":"Toon Claes","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/660180/avatar.png","web_url":"https://gitlab.com/toon"},"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3071","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3071","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3071/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3071/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3071","relative":"#3071","full":"gitlab-org/gitaly#3071"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2862,"epic":{"id":30693,"iid":2862,"title":"🏍 Remove the Gitaly-Ruby sidecar","url":"/groups/gitlab-org/-/epics/2862","group_id":9970,"human_readable_end_date":"May 17, 2023","human_readable_timestamp":"\u003cstrong\u003e11\u003c/strong\u003e days remaining"},"iteration":null,"health_status":null},{"id":70060215,"iid":3070,"project_id":2009901,"title":"Port UserFFBranch to Go","description":"UserFFBranch is currently handled by the Gitaly-Ruby sidecar, and should be ported to Go for performance reasons. This could be handled by shelling out to Git, leveraging Git2Go, or another way.\n\n/labels ~\"performance\" ~\"group::gitaly\"","state":"closed","created_at":"2020-08-20T10:29:42.686Z","updated_at":"2020-11-04T21:00:42.393Z","closed_at":"2020-11-04T21:00:42.339Z","closed_by":{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/228150/avatar.png","web_url":"https://gitlab.com/proglottis"},"labels":["Category:Gitaly","Deliverable","Gitaly-Ruby","devops::create","group::gitaly","missed-deliverable","missed:13.5","section::dev","workflow::verification"],"milestone":{"id":1233755,"iid":53,"group_id":9970,"title":"13.6","description":"https://about.gitlab.com/releases/2020/11/22/gitlab-13-6-released/","state":"closed","created_at":"2020-04-09T17:39:22.328Z","updated_at":"2022-04-13T14:51:04.376Z","due_date":"2020-11-17","start_date":"2020-10-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/53"},"assignees":[{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/228150/avatar.png","web_url":"https://gitlab.com/proglottis"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"type":"ISSUE","assignee":{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/228150/avatar.png","web_url":"https://gitlab.com/proglottis"},"user_notes_count":3,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3070","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3070","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3070/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3070/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3070","relative":"#3070","full":"gitlab-org/gitaly#3070"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2862,"epic":{"id":30693,"iid":2862,"title":"🏍 Remove the Gitaly-Ruby sidecar","url":"/groups/gitlab-org/-/epics/2862","group_id":9970,"human_readable_end_date":"May 17, 2023","human_readable_timestamp":"\u003cstrong\u003e11\u003c/strong\u003e days remaining"},"iteration":null,"health_status":null},{"id":70060212,"iid":3068,"project_id":2009901,"title":"Port UserMergeToRef to Go","description":"UserMergeToRef is currently handled by the Gitaly-Ruby sidecar, and should be ported to Go for performance reasons. This could be handled by shelling out to Git, leveraging Git2Go, or another way.\n\n/labels ~\"performance\" ~\"group::gitaly\"","state":"closed","created_at":"2020-08-20T10:29:40.153Z","updated_at":"2020-10-18T07:08:21.054Z","closed_at":"2020-09-22T20:06:09.691Z","closed_by":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"labels":["Category:Gitaly","Deliverable","devops::create","group::gitaly","section::dev","workflow::in review"],"milestone":{"id":1233754,"iid":52,"group_id":9970,"title":"13.5","description":"https://about.gitlab.com/releases/2020/10/22/gitlab-13-5-released/","state":"closed","created_at":"2020-04-09T17:39:21.990Z","updated_at":"2022-04-21T07:21:12.213Z","due_date":"2020-10-17","start_date":"2020-09-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/52"},"assignees":[{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"type":"ISSUE","assignee":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3068","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3068","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3068/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3068/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3068","relative":"#3068","full":"gitlab-org/gitaly#3068"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2862,"epic":{"id":30693,"iid":2862,"title":"🏍 Remove the Gitaly-Ruby sidecar","url":"/groups/gitlab-org/-/epics/2862","group_id":9970,"human_readable_end_date":"May 17, 2023","human_readable_timestamp":"\u003cstrong\u003e11\u003c/strong\u003e days remaining"},"iteration":null,"health_status":null},{"id":70060205,"iid":3064,"project_id":2009901,"title":"Port UserDeleteTag to Go","description":"UserDeleteTag is currently handled by the Gitaly-Ruby sidecar, and should be ported to Go for performance reasons. This could be handled by shelling out to Git, leveraging Git2Go, or another way.\n\n/labels ~\"performance\" ~\"group::gitaly\"","state":"closed","created_at":"2020-08-20T10:29:35.749Z","updated_at":"2020-12-18T07:08:06.192Z","closed_at":"2020-12-02T12:02:54.603Z","closed_by":{"id":1424505,"username":"avar","name":"Ævar Arnfjörð Bjarmason","state":"active","avatar_url":"https://secure.gravatar.com/avatar/4edaf21e9ad2d357c90aa62eb752f302?s=80\u0026d=identicon","web_url":"https://gitlab.com/avar"},"labels":["Category:Gitaly","Deliverable","Gitaly-Ruby","auto updated","devops::create","group::gitaly","missed-deliverable","missed:13.5","missed:13.6","section::dev","workflow::ready for development"],"milestone":{"id":1233757,"iid":54,"group_id":9970,"title":"13.7","description":"https://about.gitlab.com/releases/archives.html","state":"closed","created_at":"2020-04-09T17:43:14.893Z","updated_at":"2022-04-13T14:51:12.240Z","due_date":"2020-12-17","start_date":"2020-11-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/54"},"assignees":[{"id":1424505,"username":"avar","name":"Ævar Arnfjörð Bjarmason","state":"active","avatar_url":"https://secure.gravatar.com/avatar/4edaf21e9ad2d357c90aa62eb752f302?s=80\u0026d=identicon","web_url":"https://gitlab.com/avar"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"type":"ISSUE","assignee":{"id":1424505,"username":"avar","name":"Ævar Arnfjörð Bjarmason","state":"active","avatar_url":"https://secure.gravatar.com/avatar/4edaf21e9ad2d357c90aa62eb752f302?s=80\u0026d=identicon","web_url":"https://gitlab.com/avar"},"user_notes_count":4,"merge_requests_count":2,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3064","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3064","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3064/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3064/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3064","relative":"#3064","full":"gitlab-org/gitaly#3064"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2862,"epic":{"id":30693,"iid":2862,"title":"🏍 Remove the Gitaly-Ruby sidecar","url":"/groups/gitlab-org/-/epics/2862","group_id":9970,"human_readable_end_date":"May 17, 2023","human_readable_timestamp":"\u003cstrong\u003e11\u003c/strong\u003e days remaining"},"iteration":null,"health_status":null},{"id":70060200,"iid":3063,"project_id":2009901,"title":"Port UserCreateTag to Go","description":"UserCreateTag is currently handled by the Gitaly-Ruby sidecar, and should be ported to Go for performance reasons. This could be handled by shelling out to Git, leveraging Git2Go, or another way.\n\n/labels ~\"performance\" ~\"group::gitaly\"","state":"closed","created_at":"2020-08-20T10:29:28.269Z","updated_at":"2021-01-20T17:00:54.076Z","closed_at":"2021-01-20T17:00:54.023Z","closed_by":{"id":1424505,"username":"avar","name":"Ævar Arnfjörð Bjarmason","state":"active","avatar_url":"https://secure.gravatar.com/avatar/4edaf21e9ad2d357c90aa62eb752f302?s=80\u0026d=identicon","web_url":"https://gitlab.com/avar"},"labels":["Category:Gitaly","Deliverable","Gitaly-Ruby","auto updated","devops::create","group::gitaly","missed-deliverable","missed:13.5","missed:13.6","section::dev","workflow::in dev"],"milestone":{"id":1233759,"iid":55,"group_id":9970,"title":"13.8","description":"https://about.gitlab.com/releases/archives.html","state":"closed","created_at":"2020-04-09T17:44:13.983Z","updated_at":"2022-04-13T14:51:23.220Z","due_date":"2021-01-17","start_date":"2020-12-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/55"},"assignees":[{"id":1424505,"username":"avar","name":"Ævar Arnfjörð Bjarmason","state":"active","avatar_url":"https://secure.gravatar.com/avatar/4edaf21e9ad2d357c90aa62eb752f302?s=80\u0026d=identicon","web_url":"https://gitlab.com/avar"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"type":"ISSUE","assignee":{"id":1424505,"username":"avar","name":"Ævar Arnfjörð Bjarmason","state":"active","avatar_url":"https://secure.gravatar.com/avatar/4edaf21e9ad2d357c90aa62eb752f302?s=80\u0026d=identicon","web_url":"https://gitlab.com/avar"},"user_notes_count":4,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3063","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3063","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3063/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3063/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3063","relative":"#3063","full":"gitlab-org/gitaly#3063"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2862,"epic":{"id":30693,"iid":2862,"title":"🏍 Remove the Gitaly-Ruby sidecar","url":"/groups/gitlab-org/-/epics/2862","group_id":9970,"human_readable_end_date":"May 17, 2023","human_readable_timestamp":"\u003cstrong\u003e11\u003c/strong\u003e days remaining"},"iteration":null,"health_status":null},{"id":69890593,"iid":3044,"project_id":2009901,"title":"Ignore common name from x509 certificates","description":"A temporary mitigation of a breaking change was introduced in https://gitlab.com/gitlab-org/gitaly/-/merge_requests/2472.\n\nThis should be removed in the next major version of GitLab. Additionally, all users of the Gitaly Go-client should be upgraded.\n\nRelates to https://gitlab.com/gitlab-org/gitaly/-/issues/3036","state":"closed","created_at":"2020-08-17T05:34:49.695Z","updated_at":"2021-10-28T14:09:04.235Z","closed_at":"2021-01-04T18:25:41.431Z","closed_by":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"labels":["Category:Gitaly","[deprecated] Accepting merge requests","breaking change","devops::create","group::gitaly","section::dev","type::maintenance"],"milestone":{"id":1406669,"iid":59,"group_id":9970,"title":"13.11","description":"https://about.gitlab.com/releases/archives.html","state":"closed","created_at":"2020-08-13T14:23:09.688Z","updated_at":"2022-04-21T07:22:08.835Z","due_date":"2021-04-17","start_date":"2021-03-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/59"},"assignees":[],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"type":"ISSUE","assignee":null,"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3044","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3044","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3044/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3044/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3044","relative":"#3044","full":"gitlab-org/gitaly#3044"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":69757246,"iid":3035,"project_id":2009901,"title":"Re-include reference-transaction hook","description":"The reference-transaction hook has been removed from Gitaly due to a regression in Git v2.28.0, causing the wrong hooks to be invoked with inputs from the reference-transaction hook if there's interleaving hook calls. We need to re-include the reference-transaction hook as soon as Git v2.28.1 has been released with a fix to this issue.\n\nDepends on https://gitlab.com/gitlab-org/gitlab-git/-/issues/1144","state":"closed","created_at":"2020-08-12T10:55:45.679Z","updated_at":"2020-09-15T15:23:51.719Z","closed_at":"2020-09-11T05:16:00.340Z","closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"labels":["Category:Gitaly","[deprecated] Accepting merge requests","devops::create","group::gitaly","section::dev"],"milestone":null,"assignees":[],"author":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"type":"ISSUE","assignee":null,"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3035","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3035","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3035/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3035/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3035","relative":"#3035","full":"gitlab-org/gitaly#3035"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1189,"epic":{"id":5989,"iid":1189,"title":"Gitaly Cluster: strong consistency","url":"/groups/gitlab-org/-/epics/1189","group_id":9970,"human_readable_end_date":"Sep 17, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":69757169,"iid":3034,"project_id":2009901,"title":"Call reference-transaction hook from Ruby sidecar","description":"While we already call the pre-receive, update and post-receive hooks manually in the Ruby sidecar, we don't do so for the reference-transaction hook. This is a necessity when we want to drop the pre-receive hook in favor of the reference-transacton hook, though.\n\nThis depends on the re-inclusion of Gitaly's reference-transaction hook and thus on the release of Git v2.28.1.","state":"closed","created_at":"2020-08-12T10:53:18.265Z","updated_at":"2020-10-18T07:08:21.164Z","closed_at":"2020-09-17T02:48:01.719Z","closed_by":{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/228150/avatar.png","web_url":"https://gitlab.com/proglottis"},"labels":["Category:Gitaly","Deliverable","Stretch","devops::create","group::gitaly","section::dev","type::feature","workflow::ready for development"],"milestone":{"id":1233754,"iid":52,"group_id":9970,"title":"13.5","description":"https://about.gitlab.com/releases/2020/10/22/gitlab-13-5-released/","state":"closed","created_at":"2020-04-09T17:39:21.990Z","updated_at":"2022-04-21T07:21:12.213Z","due_date":"2020-10-17","start_date":"2020-09-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/52"},"assignees":[{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"}],"author":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"type":"ISSUE","assignee":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3034","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3034","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3034/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3034/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3034","relative":"#3034","full":"gitlab-org/gitaly#3034"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1189,"epic":{"id":5989,"iid":1189,"title":"Gitaly Cluster: strong consistency","url":"/groups/gitlab-org/-/epics/1189","group_id":9970,"human_readable_end_date":"Sep 17, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":69722330,"iid":3032,"project_id":2009901,"title":"Improve reconcile error handling when individual repo failures occur","description":"Currently, the reconcile command will exit early if one of the repos experiences an unrecoverable error. This should not stop the command from continuing onto other repositories. Ideally, any errors encountered for individual repos should be reported back to the client and displayed appropriately to the user.","state":"closed","created_at":"2020-08-11T19:27:47.040Z","updated_at":"2021-02-23T21:09:13.614Z","closed_at":"2021-02-21T12:20:02.088Z","closed_by":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"labels":["Category:Gitaly","devops::create","group::gitaly","group::gitaly::cluster","missed:13.5","missed:13.6","missed:13.9","section::dev","workflow::in dev"],"milestone":{"id":1233761,"iid":57,"group_id":9970,"title":"13.10","description":"https://about.gitlab.com/releases/archives.html","state":"closed","created_at":"2020-04-09T17:44:14.646Z","updated_at":"2022-04-21T07:22:00.171Z","due_date":"2021-03-17","start_date":"2021-02-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/57"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"}],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"user_notes_count":9,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3032","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3032","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3032/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3032/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3032","relative":"#3032","full":"gitlab-org/gitaly#3032"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":69699005,"iid":3031,"project_id":2009901,"title":"Rename white/blacklist references","description":"```\n❯ git grep whitelist\ninternal/praefect/replicator.go:308:    // whitelist contains the project names of the repos we wish to replicate\ninternal/praefect/replicator.go:309:    whitelist map[string]struct{}\ninternal/praefect/replicator.go:342:            whitelist:       map[string]struct{}{},\ninternal/praefect/replicator.go:372:// WithWhitelist will configure a whitelist for repos to allow replication\ninternal/praefect/replicator.go:373:func WithWhitelist(whitelistedRepos []string) ReplMgrOpt {\ninternal/praefect/replicator.go:375:            for _, repo := range whitelistedRepos {\ninternal/praefect/replicator.go:376:                    r.whitelist[repo] = struct{}{}\ninternal/rubyserver/proxy.go:15:// Headers prefixed with this string get whitelisted automatically\ninternal/rubyserver/proxy.go:86:                // Automatically whitelist any Ruby-specific feature flag\ninternal/rubyserver/proxy_test.go:26:   require.False(t, ok, \"outgoing MD should not contain non-whitelisted key\")\ninternal/rubyserver/proxy_test.go:43:   require.Equal(t, []string{value}, outMd[key], \"outgoing MD should contain whitelisted key\")\ninternal/rubyserver/proxy_test.go:60:   require.Equal(t, []string{value}, outMd[key], \"outgoing MD should contain whitelisted feature key\")\n```\n\nGitaly should not use black vs white, but instead use block and allow lists.","state":"closed","created_at":"2020-08-11T14:39:19.467Z","updated_at":"2020-09-18T07:07:40.804Z","closed_at":"2020-09-08T16:02:41.009Z","closed_by":{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5522960/avatar.png","web_url":"https://gitlab.com/samihiltunen"},"labels":["Category:Gitaly","Deliverable","devops::create","group::gitaly","section::dev","workflow::in review"],"milestone":{"id":1233753,"iid":51,"group_id":9970,"title":"13.4","description":"https://about.gitlab.com/releases/2020/09/22/gitlab-13-4-released/","state":"closed","created_at":"2020-04-09T17:39:21.662Z","updated_at":"2022-04-13T14:50:33.769Z","due_date":"2020-09-17","start_date":"2020-08-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/51"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"user_notes_count":3,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3031","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3031","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3031/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3031/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3031","relative":"#3031","full":"gitlab-org/gitaly#3031"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":69499544,"iid":3017,"project_id":2009901,"title":"Praefect server metadata not resolved before passing to Ruby sidecar","description":"When receiving a call with Praefect server metadata, we need resolve contained connection information first based on the current peer's connection information. This will fill in the remote's IP address, which is something that may change depending on how Praefect has connected to us.\n\nWhile we already to this for \"normal\" calls via `PraefectFromContext()`, we don't for proxied calls intended for our Ruby sidecar. As a result, the sidecar may receive invalid connection information which it cannot use. To fix this, we need to resolve address information on Gitaly's side and inject resolved metadata into the Ruby sidecar's metadata.\n\nReferences https://gitlab.com/gitlab-org/gitlab/-/issues/233838","state":"closed","created_at":"2020-08-06T09:08:59.758Z","updated_at":"2020-08-11T08:42:57.011Z","closed_at":"2020-08-06T16:20:17.679Z","closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"labels":["devops::create","group::gitaly","group::gitaly::cluster","type::bug"],"milestone":{"id":1233752,"iid":50,"group_id":9970,"title":"13.3","description":"https://about.gitlab.com/releases/2020/08/22/gitlab-13-3-released/","state":"closed","created_at":"2020-04-09T17:39:21.090Z","updated_at":"2022-04-13T14:50:18.976Z","due_date":"2020-08-17","start_date":"2020-07-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/50"},"assignees":[],"author":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"type":"ISSUE","assignee":null,"user_notes_count":0,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3017","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3017","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3017/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3017/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3017","relative":"#3017","full":"gitlab-org/gitaly#3017"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":69398701,"iid":3010,"project_id":2009901,"title":"Improved metrics for transactions","description":"Todays testrun showed that metrics for transactions could be improved:\n\n- no way to figure out how many voters per transaction there are\n- client-side delay for voting on a transaction is missing\n- the server-side delay is extremely static and it doesn't matter whether we use primary-wins strategy or not. Maybe it's broken?","state":"closed","created_at":"2020-08-04T08:18:53.935Z","updated_at":"2020-08-05T10:15:01.726Z","closed_at":"2020-08-05T09:42:24.888Z","closed_by":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"labels":["Category:Gitaly","devops::create","feature::addition","group::gitaly","type::feature"],"milestone":{"id":1233752,"iid":50,"group_id":9970,"title":"13.3","description":"https://about.gitlab.com/releases/2020/08/22/gitlab-13-3-released/","state":"closed","created_at":"2020-04-09T17:39:21.090Z","updated_at":"2022-04-13T14:50:18.976Z","due_date":"2020-08-17","start_date":"2020-07-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/50"},"assignees":[{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"}],"author":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"type":"ISSUE","assignee":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/3010","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/3010","notes":"https://gitlab.com/api/v4/projects/2009901/issues/3010/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/3010/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#3010","relative":"#3010","full":"gitlab-org/gitaly#3010"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1189,"epic":{"id":5989,"iid":1189,"title":"Gitaly Cluster: strong consistency","url":"/groups/gitlab-org/-/epics/1189","group_id":9970,"human_readable_end_date":"Sep 17, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":69174006,"iid":2993,"project_id":2009901,"title":"`praefect reconcile` hangs then fails on staging","description":"`praefect reconcile` on staging runs normally for a few minutes then hangs and fails on staging with the following error `unable to reconcile: rpc error: code = Unavailable desc = transport is closing`. It does not reach the point where it prints \"FINISHED: ...\".\n\ncc/ @8bitlife @zj-gitlab","state":"closed","created_at":"2020-07-29T13:29:48.148Z","updated_at":"2020-11-18T21:48:37.837Z","closed_at":"2020-11-18T21:48:37.775Z","closed_by":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"labels":["Category:Gitaly","SLO::Missed","devops::create","group::gitaly","group::gitaly::cluster","priority::2","section::dev","severity::2","type::bug","workflow::ready for development"],"milestone":{"id":1233755,"iid":53,"group_id":9970,"title":"13.6","description":"https://about.gitlab.com/releases/2020/11/22/gitlab-13-6-released/","state":"closed","created_at":"2020-04-09T17:39:22.328Z","updated_at":"2022-04-13T14:51:04.376Z","due_date":"2020-11-17","start_date":"2020-10-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/53"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"}],"author":{"id":506061,"username":"ahmadsherif","name":"Ahmad Sherif","state":"active","avatar_url":"https://secure.gravatar.com/avatar/bd6d0ec4213b91601956c9f801cbfe9b?s=80\u0026d=identicon","web_url":"https://gitlab.com/ahmadsherif"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"user_notes_count":7,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2993","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2993","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2993/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2993/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2993","relative":"#2993","full":"gitlab-org/gitaly#2993"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":68935101,"iid":2985,"project_id":2009901,"title":"Praefect subcommands miss user-visible documentation","description":"When executing `praefect -help`, we list the switches and subcommands available to Praefect. While switches have some short documentation available, none of the subcommands actually explain what they're doing and why an administrator would want to use them. As many of them will probably be of use in stressful scenarios where there's an incident happening, having some documentation handy for the admin as part of `praefect -help` would definitely be very helpful.","state":"closed","created_at":"2020-07-24T07:16:52.339Z","updated_at":"2023-03-30T06:51:34.606Z","closed_at":"2023-03-30T06:51:34.590Z","closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"labels":["Category:Gitaly","[deprecated] Accepting merge requests","devops::systems","feature::addition","group::gitaly","section::enablement"],"milestone":null,"assignees":[],"author":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"type":"ISSUE","assignee":null,"user_notes_count":2,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2985","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2985","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2985/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2985/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2985","relative":"#2985","full":"gitlab-org/gitaly#2985"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":68592316,"iid":2976,"project_id":2009901,"title":"Document usage of the PgBouncer for Praefect cluster setup","description":"The doc at https://docs.gitlab.com/ee/administration/gitaly/praefect.html should include instructions about setup and configuration of the PgBouncer that will be used in front of the PostgreSQL database.","state":"closed","created_at":"2020-07-21T06:41:32.034Z","updated_at":"2020-08-04T07:23:03.659Z","closed_at":"2020-08-04T06:58:33.754Z","closed_by":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"labels":["Category:Gitaly","devops::create","documentation","group::gitaly","group::gitaly::cluster","missed:13.2","workflow::in review"],"milestone":{"id":1233752,"iid":50,"group_id":9970,"title":"13.3","description":"https://about.gitlab.com/releases/2020/08/22/gitlab-13-3-released/","state":"closed","created_at":"2020-04-09T17:39:21.090Z","updated_at":"2022-04-13T14:50:18.976Z","due_date":"2020-08-17","start_date":"2020-07-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/50"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"}],"author":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"user_notes_count":0,"merge_requests_count":3,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2976","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2976","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2976/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2976/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2976","relative":"#2976","full":"gitlab-org/gitaly#2976"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2013,"epic":{"id":13406,"iid":2013,"title":"🌿 Gitaly Cluster: Distribute Git read operations across Gitaly nodes","url":"/groups/gitlab-org/-/epics/2013","group_id":9970,"human_readable_end_date":"Mar 17, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":68589310,"iid":2975,"project_id":2009901,"title":"PgBouncer deployment with terraform","description":"In order to verify usage of the PgBouncer in front of the PostgreSQL database for Praefect we should include PgBouncer into terraform setup.  \nThis will allow us to verify that Praefect can use PgBouncer protected PostgreSQL without issues.  \n\n/cc @zj-gitlab @jramsay","state":"closed","created_at":"2020-07-21T06:33:56.159Z","updated_at":"2020-08-18T07:08:23.990Z","closed_at":"2020-07-30T16:26:02.243Z","closed_by":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"labels":["Category:Gitaly","Deliverable","devops::create","group::gitaly","group::gitaly::cluster","workflow::in review"],"milestone":{"id":1233752,"iid":50,"group_id":9970,"title":"13.3","description":"https://about.gitlab.com/releases/2020/08/22/gitlab-13-3-released/","state":"closed","created_at":"2020-04-09T17:39:21.090Z","updated_at":"2022-04-13T14:50:18.976Z","due_date":"2020-08-17","start_date":"2020-07-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/50"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"}],"author":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"user_notes_count":0,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2975","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2975","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2975/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2975/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2975","relative":"#2975","full":"gitlab-org/gitaly#2975"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2013,"epic":{"id":13406,"iid":2013,"title":"🌿 Gitaly Cluster: Distribute Git read operations across Gitaly nodes","url":"/groups/gitlab-org/-/epics/2013","group_id":9970,"human_readable_end_date":"Mar 17, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":54077691,"iid":2945,"project_id":2009901,"title":"Praefect distributed reads counter has mislabeled storage","description":"During the 2020-07-07 demo, we observed strange behavior from the distributed reads counter (see area in red rectangle):\n\n![Screen_Shot_2020-07-07_at_9.40.20_PM](/uploads/a3292e5a89dcd5d1d5b5f896736641e7/Screen_Shot_2020-07-07_at_9.40.20_PM.png)\n\nNote how all three counters are labeled with the same storage `gitaly-1`.\n\nThe counters originate from three different Praefects. The objective of read distribution is to distribute reads across multiple storages of the same virtual storage. We expect to see each Praefect distribute reads to different storages. Given enough time, we expect to see counters labeled with all storages (in this case there were three: gitaly-1, gitaly-2, gitaly-3).","state":"closed","created_at":"2020-07-08T04:44:49.698Z","updated_at":"2020-08-18T07:08:24.239Z","closed_at":"2020-07-15T23:01:12.929Z","closed_by":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"labels":["Category:Gitaly","Deliverable","demo","devops::create","group::gitaly","group::gitaly::cluster","priority::3","type::bug"],"milestone":{"id":1233752,"iid":50,"group_id":9970,"title":"13.3","description":"https://about.gitlab.com/releases/2020/08/22/gitlab-13-3-released/","state":"closed","created_at":"2020-04-09T17:39:21.090Z","updated_at":"2022-04-13T14:50:18.976Z","due_date":"2020-08-17","start_date":"2020-07-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/50"},"assignees":[{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"}],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"type":"ISSUE","assignee":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"user_notes_count":5,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2020-07-13","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2945","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2945","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2945/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2945/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2945","relative":"#2945","full":"gitlab-org/gitaly#2945"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2013,"epic":{"id":13406,"iid":2013,"title":"🌿 Gitaly Cluster: Distribute Git read operations across Gitaly nodes","url":"/groups/gitlab-org/-/epics/2013","group_id":9970,"human_readable_end_date":"Mar 17, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":54023862,"iid":2939,"project_id":2009901,"title":"Implement support for subtransactions","description":"With the upcoming reference-transaction hook implemented in gitlab-org/gitlab-git!2, we need to extend transactions to support subtransactions. Right now, we know that each transaction will be invoked once only from the pre-receive hook. But with the reftx-hook, each Git operation may call out to a given transaction arbitrarily many times. As we cannot know how often that's going to happen, the transaction needs to cope and allow for multiple votes.\n\nThis is where subtransactions will come in. Each vote of a given node is going to create a new subtransaction iff all previous subtransactions for that node have succeeded. If the current transaction is still ongoing or has failed, it is not allowed to take part in new subtransactions. The outcome for each given node is then either `success` if all subtransactions have reached quorum on the same thing as the node voted for, `failure` if any subtransaction arrived at a different thing or `not started` if none of the nodes has created a subtransaction.","state":"closed","created_at":"2020-07-07T08:59:48.166Z","updated_at":"2020-07-17T11:11:32.693Z","closed_at":"2020-07-17T10:56:56.766Z","closed_by":{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5522960/avatar.png","web_url":"https://gitlab.com/samihiltunen"},"labels":["Deliverable","devops::create","feature::addition","group::gitaly::cluster","type::feature","workflow::planning breakdown"],"milestone":{"id":1233752,"iid":50,"group_id":9970,"title":"13.3","description":"https://about.gitlab.com/releases/2020/08/22/gitlab-13-3-released/","state":"closed","created_at":"2020-04-09T17:39:21.090Z","updated_at":"2022-04-13T14:50:18.976Z","due_date":"2020-08-17","start_date":"2020-07-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/50"},"assignees":[{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"}],"author":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"type":"ISSUE","assignee":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"user_notes_count":0,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2939","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2939","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2939/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2939/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2939","relative":"#2939","full":"gitlab-org/gitaly#2939"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1189,"epic":{"id":5989,"iid":1189,"title":"Gitaly Cluster: strong consistency","url":"/groups/gitlab-org/-/epics/1189","group_id":9970,"human_readable_end_date":"Sep 17, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":53975361,"iid":2936,"project_id":2009901,"title":"Improve the performance of CountCommits by using commit-graph","description":"(Placeholder issue, Gitaly team know details more than I do)\n\nIn https://gitlab.com/gitlab-com/gl-infra/scalability/-/issues/470, the main performance issue with the Gitaly cny node appears to be the CountCommits GRPC method.\n\n@chriscool pointed out that this could be sped up using `core.commitGraph`\n\n```\n$ git config core.commitGraph true\n$ time git rev-list --count --all\n67482\nreal    0m0,100s\nuser    0m0,088s\nsys     0m0,012s\n$ git config core.commitGraph false\n$ time git rev-list --count --all\n67482\nreal    0m0,587s\nuser    0m0,567s\nsys     0m0,020s\n```\n\nIf possible, we should consider enabling this. \n\ncc @zj-gitlab @pokstad1 @chriscool","state":"closed","created_at":"2020-07-06T14:33:06.870Z","updated_at":"2022-01-21T08:56:20.470Z","closed_at":"2022-01-21T08:56:20.455Z","closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"labels":["Category:Gitaly","Stretch","auto updated","bug::performance","devops::create","group::gitaly","missed:13.10","missed:13.12","missed:13.6","missed:13.9","missed:14.0","missed:14.2","missed:14.3","missed:14.4","missed:14.5","missed:14.6","missed:14.7","priority::2","section::dev","type::bug","workflow::planning breakdown"],"milestone":{"id":2161849,"iid":70,"group_id":9970,"title":"14.8","description":"","state":"active","created_at":"2021-07-26T16:51:47.677Z","updated_at":"2021-07-26T16:51:47.677Z","due_date":"2022-02-17","start_date":"2022-01-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/70"},"assignees":[],"author":{"id":895869,"username":"andrewn","name":"Andrew Newdigate","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/895869/avatar.png","web_url":"https://gitlab.com/andrewn"},"type":"ISSUE","assignee":null,"user_notes_count":15,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2936","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2936","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2936/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2936/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2936","relative":"#2936","full":"gitlab-org/gitaly#2936"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":53589477,"iid":2927,"project_id":2009901,"title":"Refactoring of the listening address configuration","description":"The following discussion from !2276 should be addressed:\n\n- [ ] @8bitlife started a [discussion](https://gitlab.com/gitlab-org/gitaly/-/merge_requests/2276#note_362382231): \n\n    \u003e I think we should refactor it and allow to set a list of addresses that needs to be served with mandatory schema each `listen = ['tcp://0.0.0.0:2609', 'tls://0.0.0.0:2609', 'unix:///opt/var/praefect.socket']`.   \n    \u003e It will simplify out code and we won't need to support both: 'tcp://0.0.0.0:2609' and '0.0.0.0:2609' for same `listen_addr` and in a couple of other places: `PraefectServer` type\n\n/cc @zj-gitlab","state":"closed","created_at":"2020-07-02T07:53:28.324Z","updated_at":"2021-07-13T11:56:51.079Z","closed_at":"2021-07-13T11:56:51.062Z","closed_by":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"labels":["Category:Gitaly","devops::create","group::gitaly","missed:13.11","missed:13.12","missed:14.0","priority::4","section::dev","severity::4","type::feature","workflow::in review"],"milestone":{"id":1850118,"iid":61,"group_id":9970,"title":"14.1","description":"","state":"closed","created_at":"2021-01-26T16:56:41.887Z","updated_at":"2022-04-21T07:25:22.879Z","due_date":"2021-07-17","start_date":"2021-06-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/61"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"}],"author":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"user_notes_count":0,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2927","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":1,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2927","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2927/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2927/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2927","relative":"#2927","full":"gitlab-org/gitaly#2927"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":50011205,"iid":2905,"project_id":2009901,"title":"Filter environment variables when executing custom hooks","description":"Our hooks use a set of environment variables to pass along information across processes that's required to be operational. While we cannot help using these variables, we should make sure to filter out any envvars when executing custom hooks such that these custom hooks won't accidentally start depending on internal variables that weren't meant to be public in the first place.\n\nThus, executing custom hooks with the equivalent of `execve(3P)` would avoid us breaking customer's scripts if they unknowingly started using internal variables, allowing us to keep iterating here without fear of breakage.\n\nI'm labelling this as a bug as exposing internal variables to custom hooks is unintentional at best.","state":"closed","created_at":"2020-06-24T06:04:07.413Z","updated_at":"2021-05-20T10:13:49.646Z","closed_at":"2021-05-20T10:13:49.632Z","closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"labels":["Category:Gitaly","[deprecated] Accepting merge requests","devops::create","group::gitaly","priority::3","section::dev","severity::4","type::bug"],"milestone":{"id":1233759,"iid":55,"group_id":9970,"title":"13.8","description":"https://about.gitlab.com/releases/archives.html","state":"closed","created_at":"2020-04-09T17:44:13.983Z","updated_at":"2022-04-13T14:51:23.220Z","due_date":"2021-01-17","start_date":"2020-12-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/55"},"assignees":[{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"}],"author":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"type":"ISSUE","assignee":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2905","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2905","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2905/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2905/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2905","relative":"#2905","full":"gitlab-org/gitaly#2905"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":48198631,"iid":2889,"project_id":2009901,"title":"Push to gitlab.com fails with zeroPaddedFilemode: contains zero-padded file modes","description":"Customer has started to mirror some of their repos from their local gitlab (self-managed) to the new remote one (gitlab.com), but running into an issue with one of their repositories, Jquery, which returns this error: \n\n```\n13:close stream to gitaly-ruby: rpc error: code = Unknown desc = Gitlab::Git::CommandError: remote: error: object a98f1b7a267865bb78ef2a54ed54b67fbad6c839: zeroPaddedFilemode: contains zero-padded file modes       \nremote: fatal: fsck error in packed object       \nerror: remote unpack failed: index-pack abnormal exit\nTo\n ! [remote rejected]   master -\u0026gt; master (unpacker error)\n! [remote rejected]   3.x-stable -\u0026gt; 3.x-stable (unpacker error)\n! [remote rejected]   secure-buildFragment -\u0026gt; secure-buildFragment (unpacker error)\n! [remote rejected]   1.12-stable -\u0026gt; 1.12-stable (unpacker error)\n! [remote rejected]   2.2-stable -\u0026gt; 2.2-stable (unpacker error)\n! [remote rejected]   feature/Patch.2.2 -\u0026gt; feature/Patch.2.2 (unpacker error)\n! [remote rejected]   mgol/test-flakiness -\u0026gt; mgol/test-flakiness (unpacker error)\nerror: failed to push some refs to \u0026#39;[FILTERED]@gitlab.com/\u003ccustomername\u003e/3rdpartytools/jquery.git\u0026#39;\n```\nThey also tried mirroring this manually as follows: \n\n```\nC:\\projects\\jquery [master ≡]\u003e git remote rename origin old-origin\nC:\\projects\\jquery [master ≡]\u003e git remote add origin https://gitlab.com/\u003ccustomername\u003e/3rdpartytools/jquery.git\nC:\\projects\\jquery [master ≡]\u003e git push -u origin --all\nEnumerating objects: 37001, done.\nCounting objects: 100% (37001/37001), done.\nDelta compression using up to 4 threads\nCompressing objects: 100% (9856/9856), done.\nWriting objects: 100% (37001/37001), 21.80 MiB | 1.80 MiB/s, done.\nTotal 37001 (delta 26510), reused 36878 (delta 26419)\nremote: error: object a98f1b7a267865bb78ef2a54ed54b67fbad6c839: zeroPaddedFilemode: contains zero-padded file modes\nremote: fatal: fsck error in packed object\nerror: remote unpack failed: index-pack abnormal exit\nTo https://gitlab.com/\u003ccustomername\u003e/3rdpartytools/jquery.git\n! [remote rejected]   master -\u003e master (unpacker error)\nerror: failed to push some refs to 'https://gitlab.com/\u003ccustomername\u003e/3rdpartytools/jquery.git'\nC:\\projects\\jquery [master ≡]\u003e\n```\nThe following are two issues where it looks like the error was reported before, but no clear indication as to the resolution without having to necessarily repair the source repo.\n\n- [Pushing fails if local repo has problems with zero-padded file modes - 22095](https://gitlab.com/gitlab-org/gitlab-foss/-/issues/22095)\n- [Pushing fails if local repo has problems with zero-padded file modes - 1602](https://gitlab.com/gitlab-org/omnibus-gitlab/-/issues/1602)","state":"closed","created_at":"2020-06-18T17:07:39.351Z","updated_at":"2021-11-16T06:32:41.464Z","closed_at":"2021-11-16T06:32:41.448Z","closed_by":{"id":660180,"username":"toon","name":"Toon Claes","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/660180/avatar.png","web_url":"https://gitlab.com/toon"},"labels":["Category:Gitaly","customer","devops::create","group::gitaly","priority::4","section::dev","severity::4"],"milestone":{"id":2114817,"iid":66,"group_id":9970,"title":"14.5","description":"https://about.gitlab.com/releases/archives.html","state":"closed","created_at":"2021-06-23T04:59:45.082Z","updated_at":"2022-04-21T07:25:45.431Z","due_date":"2021-11-17","start_date":"2021-10-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/66"},"assignees":[{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"}],"author":{"id":4709667,"username":"laurie_howitt","name":"Laurie Howitt","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4709667/avatar.png","web_url":"https://gitlab.com/laurie_howitt"},"type":"ISSUE","assignee":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"user_notes_count":22,"merge_requests_count":1,"upvotes":3,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2889","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2889","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2889/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2889/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2889","relative":"#2889","full":"gitlab-org/gitaly#2889"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":45200352,"iid":2880,"project_id":2009901,"title":"Repair nodes on failed reference transaction vote","description":"When voting on a reference transaction fails, we should schedule replication jobs to get all secondaries up-to-date again that have disagreeing votes compared to the primary. This is especially important as soon as we have implemented a voting strategy that can reach quorum even if any of the nodes has cast a disagreeing vote.","state":"closed","created_at":"2020-06-16T13:00:27.340Z","updated_at":"2020-07-18T07:06:53.105Z","closed_at":"2020-07-14T20:53:47.458Z","closed_by":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"},"labels":["Category:Gitaly","Deliverable","devops::create","group::gitaly","type::feature","workflow::in review"],"milestone":{"id":1233746,"iid":49,"group_id":9970,"title":"13.2","description":"https://about.gitlab.com/releases/2020/07/22/gitlab-13-2-released/","state":"closed","created_at":"2020-04-09T17:28:01.032Z","updated_at":"2022-04-13T14:48:24.167Z","due_date":"2020-07-17","start_date":"2020-06-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/49"},"assignees":[{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"}],"author":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"type":"ISSUE","assignee":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"user_notes_count":2,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2880","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2880","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2880/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2880/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2880","relative":"#2880","full":"gitlab-org/gitaly#2880"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1189,"epic":{"id":5989,"iid":1189,"title":"Gitaly Cluster: strong consistency","url":"/groups/gitlab-org/-/epics/1189","group_id":9970,"human_readable_end_date":"Sep 17, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":43404810,"iid":2870,"project_id":2009901,"title":"Implement voting strategies for the transaction manager","description":"The transaction manager currently supports a single voting strategy, only: all registered nodes need to cast the same vote, otherwise the transaction will be aborted. In order to support more scenarios and become more resilient to failures, we want to implement additional strategies:\n\n- Implement a mechanism to reach quorum such that a subset of nodes may fail.\n- Implement weighted voting such that it's possible to say e.g. that a primary node may never fail, but a subset of secondaries may.","state":"closed","created_at":"2020-06-15T07:13:07.107Z","updated_at":"2020-07-18T07:06:53.184Z","closed_at":"2020-07-03T06:07:33.715Z","closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"labels":["Category:Gitaly","Deliverable","devops::create","group::gitaly","group::gitaly::cluster","type::feature","workflow::in dev"],"milestone":{"id":1233746,"iid":49,"group_id":9970,"title":"13.2","description":"https://about.gitlab.com/releases/2020/07/22/gitlab-13-2-released/","state":"closed","created_at":"2020-04-09T17:28:01.032Z","updated_at":"2022-04-13T14:48:24.167Z","due_date":"2020-07-17","start_date":"2020-06-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/49"},"assignees":[{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"}],"author":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"type":"ISSUE","assignee":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"user_notes_count":12,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2870","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2870","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2870/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2870/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2870","relative":"#2870","full":"gitlab-org/gitaly#2870"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1189,"epic":{"id":5989,"iid":1189,"title":"Gitaly Cluster: strong consistency","url":"/groups/gitlab-org/-/epics/1189","group_id":9970,"human_readable_end_date":"Sep 17, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":38118155,"iid":2855,"project_id":2009901,"title":"Protobuf generation behaves differently on CI","description":"Our protobuf code generation sometimes behaves differently on CI vs locally. Our code generation process is supposed to download and install all the correct versions of software so that this is deterministic, yet it continues to not be.","state":"closed","created_at":"2020-06-09T15:17:49.225Z","updated_at":"2020-09-15T13:14:29.531Z","closed_at":"2020-09-15T13:05:59.127Z","closed_by":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"labels":["Category:Gitaly","backstage [DEPRECATED]","devops::create","group::gitaly","priority::3","section::dev","severity::3","type::bug","workflow::ready for development"],"milestone":{"id":1233753,"iid":51,"group_id":9970,"title":"13.4","description":"https://about.gitlab.com/releases/2020/09/22/gitlab-13-4-released/","state":"closed","created_at":"2020-04-09T17:39:21.662Z","updated_at":"2022-04-13T14:50:33.769Z","due_date":"2020-09-17","start_date":"2020-08-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/51"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"}],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"user_notes_count":12,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2855","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2855","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2855/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2855/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2855","relative":"#2855","full":"gitlab-org/gitaly#2855"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":38110588,"iid":2854,"project_id":2009901,"title":"Makefile test target should have prereq to check Git version","description":"Many of Gitaly's tests depend on the correct minimum version of Git being installed. To save contributors wasted time and effort, the version can be detected prior to running tests and the contributor can be alerted if the version is not supported.","state":"closed","created_at":"2020-06-09T15:13:56.176Z","updated_at":"2022-01-21T07:06:08.387Z","closed_at":"2022-01-21T07:06:08.380Z","closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"labels":["Category:Gitaly","[deprecated] good for new contributors","backstage [DEPRECATED]","devops::create","group::gitaly","section::dev"],"milestone":null,"assignees":[],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"type":"ISSUE","assignee":null,"user_notes_count":8,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2854","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2854","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2854/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2854/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2854","relative":"#2854","full":"gitlab-org/gitaly#2854"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":37849669,"iid":2853,"project_id":2009901,"title":"Run tests against git-core's master branch","description":"With the new build-git target, we can now quickly build Git from the master branch. In order to catch issues with upcoming Git releases early on, we should start to run our tests against Git's master branch. This will be of benefit both to us to be aware of any backwards-incompatible changes as well as to git-core as we'll find newly introduced bugs fairly quick.","state":"closed","created_at":"2020-06-09T12:47:27.563Z","updated_at":"2021-05-20T10:12:03.627Z","closed_at":"2021-05-20T10:12:03.613Z","closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"labels":["Category:Gitaly","[deprecated] Accepting merge requests","backstage [DEPRECATED]","devops::create","group::gitaly","section::dev"],"milestone":{"id":1233753,"iid":51,"group_id":9970,"title":"13.4","description":"https://about.gitlab.com/releases/2020/09/22/gitlab-13-4-released/","state":"closed","created_at":"2020-04-09T17:39:21.662Z","updated_at":"2022-04-13T14:50:33.769Z","due_date":"2020-09-17","start_date":"2020-08-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/51"},"assignees":[{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"}],"author":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"type":"ISSUE","assignee":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2853","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2853","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2853/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2853/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2853","relative":"#2853","full":"gitlab-org/gitaly#2853"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":36039988,"iid":2852,"project_id":2009901,"title":"On hosts without the 'en_US.UTF-8' locale, output from popen_with_timeout will be US-ASCII encoded rather than UTF-8","description":"Gitaly sets [environment variable `LANG=en_US.UTF-8`](https://gitlab.com/gitlab-org/gitaly/-/blob/v13.0.5/internal/command/command.go#L27-30) for all child git processes, as well as Gitaly-Ruby. On hosts that do not have the `en_US.UTF-8` locale installed this causes Ruby to fall back to `US-ASCII` (7-bit) encoding by default, even if they are using a different UTF-8 locale.\r\n\r\nAs a result, UTF-8 encoded output from [`popen_with_timeout`](https://gitlab.com/gitlab-org/gitaly/-/blob/v13.0.5/ruby/lib/gitlab/git/popen.rb#L50) will trigger `ArgumentError: invalid byte sequence in US-ASCII` errors when string parsing methods are executed on it. A customer experienced this with [`sanitize_url`](https://gitlab.com/gitlab-org/gitaly/-/blob/v13.0.5/ruby/lib/gitaly_server/utils.rb#L74-76) when `UpdateRemoteMirror` returned an error, but there are probably other places this could occur as well.\r\n\r\nOn a host using `de_DE.UTF-8` as its locale:\r\n\r\n```sh\r\n$ LANG=de_DE.UTF-8 /opt/gitlab/embedded/ruby -e 'p Encoding.default_external'\r\n#\u003cEncoding:UTF-8\u003e\r\n\r\n$ LANG=en_US.UTF-8 /opt/gitlab/embedded/ruby -e 'p Encoding.default_external'\r\n#\u003cEncoding:US-ASCII\u003e\r\n\r\n$ locale -a\r\nC\r\nC.UTF-8\r\nde_DE.utf8\r\nPOSIX\r\n\r\n$ locale -v\r\nLANG=de_DE.UTF-8\r\nLANGUAGE=\r\nLC_CTYPE=\"de_DE.UTF-8\"\r\nLC_NUMERIC=\"de_DE.UTF-8\"\r\nLC_TIME=\"de_DE.UTF-8\"\r\nLC_COLLATE=\"de_DE.UTF-8\"\r\nLC_MONETARY=\"de_DE.UTF-8\"\r\nLC_MESSAGES=\"de_DE.UTF-8\"\r\nLC_PAPER=\"de_DE.UTF-8\"\r\nLC_NAME=\"de_DE.UTF-8\"\r\nLC_ADDRESS=\"de_DE.UTF-8\"\r\nLC_TELEPHONE=\"de_DE.UTF-8\"\r\nLC_MEASUREMENT=\"de_DE.UTF-8\"\r\nLC_IDENTIFICATION=\"de_DE.UTF-8\"\r\nLC_ALL=\r\n```\r\n\r\nOn a host using `en_US.UTF-8` and `de_DE.UTF-8` installed both work:\r\n\r\n```sh\r\n$ LANG=en_US.UTF-8 /opt/gitlab/embedded/ruby -e 'p Encoding.default_external'\r\n#\u003cEncoding:UTF-8\u003e\r\n\r\nLANG=de_DE.UTF-8 ruby -e 'p Encoding.default_external'\r\n#\u003cEncoding:UTF-8\u003e\r\n\r\nLANG=ar_EG.UTF-8 ruby -e 'p Encoding.default_external'  # Using another UTF-8 encoding as an example\r\n#\u003cEncoding:US-ASCII\u003e\r\n\r\n$ locale -a\r\nC\r\nC.UTF-8\r\nPOSIX\r\nde_DE.utf8\r\nen_US.utf8\r\n\r\n$ locale -v\r\nLANG=en_US.UTF-8\r\nLANGUAGE=\r\nLC_CTYPE=\"en_US.UTF-8\"\r\nLC_NUMERIC=\"en_US.UTF-8\"\r\nLC_TIME=\"en_US.UTF-8\"\r\nLC_COLLATE=\"en_US.UTF-8\"\r\nLC_MONETARY=\"en_US.UTF-8\"\r\nLC_MESSAGES=en_US.UTF-8\r\nLC_PAPER=\"en_US.UTF-8\"\r\nLC_NAME=\"en_US.UTF-8\"\r\nLC_ADDRESS=\"en_US.UTF-8\"\r\nLC_TELEPHONE=\"en_US.UTF-8\"\r\nLC_MEASUREMENT=\"en_US.UTF-8\"\r\nLC_IDENTIFICATION=\"en_US.UTF-8\"\r\nLC_ALL=\r\n```","state":"closed","created_at":"2020-06-08T14:48:20.520Z","updated_at":"2020-07-18T07:06:53.218Z","closed_at":"2020-06-29T06:49:27.959Z","closed_by":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"labels":["Category:Gitaly","Deliverable","Gitaly","Gitaly-Ruby","customer","devops::create","encoding","group::gitaly","priority::4","severity::3","type::bug"],"milestone":{"id":1233746,"iid":49,"group_id":9970,"title":"13.2","description":"https://about.gitlab.com/releases/2020/07/22/gitlab-13-2-released/","state":"closed","created_at":"2020-04-09T17:28:01.032Z","updated_at":"2022-04-13T14:48:24.167Z","due_date":"2020-07-17","start_date":"2020-06-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/49"},"assignees":[{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"}],"author":{"id":2578846,"username":"wchandler","name":"Will Chandler","state":"active","avatar_url":"https://secure.gravatar.com/avatar/cc8b92738249753faee7055e021f8221?s=80\u0026d=identicon","web_url":"https://gitlab.com/wchandler"},"type":"ISSUE","assignee":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"user_notes_count":3,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2852","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2852","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2852/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2852/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2852","relative":"#2852","full":"gitlab-org/gitaly#2852"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":35722317,"iid":2851,"project_id":2009901,"title":"Pass down \"primary\"/\"secondary\" info to Gitaly nodes to avoid executing Git hooks on secondaries","description":"When proxying Git operations to multiple nodes at once, each node needs to know whether it's a primary node or a secondary node. This information is required such that nodes can decide whether they should execute custom hooks or not, where only the primary should do so.","state":"closed","created_at":"2020-06-08T06:23:56.834Z","updated_at":"2020-07-18T07:06:53.251Z","closed_at":"2020-06-22T06:34:32.847Z","closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"labels":["Category:Gitaly","Deliverable","devops::create","group::gitaly","group::gitaly::cluster","priority::3","severity::3","type::feature"],"milestone":{"id":1233746,"iid":49,"group_id":9970,"title":"13.2","description":"https://about.gitlab.com/releases/2020/07/22/gitlab-13-2-released/","state":"closed","created_at":"2020-04-09T17:28:01.032Z","updated_at":"2022-04-13T14:48:24.167Z","due_date":"2020-07-17","start_date":"2020-06-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/49"},"assignees":[{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"}],"author":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"type":"ISSUE","assignee":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"user_notes_count":3,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2851","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2851","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2851/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2851/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2851","relative":"#2851","full":"gitlab-org/gitaly#2851"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1189,"epic":{"id":5989,"iid":1189,"title":"Gitaly Cluster: strong consistency","url":"/groups/gitlab-org/-/epics/1189","group_id":9970,"human_readable_end_date":"Sep 17, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":35479331,"iid":2846,"project_id":2009901,"title":"Remove multi-byte  support in the `lines` package","description":"The lines package takes some input, and splits it on a delimiter, and sends the output as defined by a `Sender()`. There's currently support for multi byte delimiters, which is both unused, and broken.\n\nBroken because for example using twice the same byte as delimiter will not send any results. There's currently no call site using this feature, nor test coverage for it. Therefor we should remove it.","state":"closed","created_at":"2020-06-05T12:54:38.166Z","updated_at":"2020-07-22T07:15:57.802Z","closed_at":"2020-07-22T07:02:32.329Z","closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"labels":["Category:Gitaly","backstage [DEPRECATED]","devops::create","group::gitaly","missed:13.2","type::bug","workflow::ready for development"],"milestone":{"id":1233752,"iid":50,"group_id":9970,"title":"13.3","description":"https://about.gitlab.com/releases/2020/08/22/gitlab-13-3-released/","state":"closed","created_at":"2020-04-09T17:39:21.090Z","updated_at":"2022-04-13T14:50:18.976Z","due_date":"2020-08-17","start_date":"2020-07-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/50"},"assignees":[{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"type":"ISSUE","assignee":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2846","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2846","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2846/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2846/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2846","relative":"#2846","full":"gitlab-org/gitaly#2846"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":35363262,"iid":2840,"project_id":2009901,"title":"Lock worktrees while they are still in use","description":"The following discussion from !2202 should be addressed:\n\n- [ ] @pks-t started a [discussion](https://gitlab.com/gitlab-org/gitaly/-/merge_requests/2202#note_353463326):  (+5 comments)\n\n\u003e I also wonder whether it would make sense to start using worktree locks. Currently, the logic will always remove worktrees older than a given threshold. If the threshold is small enough, I could see us removing worktrees that are still in use currently. Iff worktrees are strictly tied to a given operation (are they?), then we could tell the operation to first lock the worktree via git worktree lock \u003cMSG\u003e and consequentially unlock the worktree after the operation has finished. That'd guarantee that we do not delete any worktrees that are still in use. The message could also be chosen in such a way that we know what operation had it locked and when it was locked to give additional context. Naturally, it could happen that a worktree still doesn't get removed cause the operation failed mid-way through and didn't unlock, but we could have another, higher, threshold for that.\n\n- @johncai notes:\n\n\u003e We could easily add something in the `def with_worktree` function that adds a worktree lock. If this change makes sense on its own, maybe we can create a follow up issue?","state":"closed","created_at":"2020-06-03T07:09:16.931Z","updated_at":"2022-05-17T11:31:49.550Z","closed_at":"2022-05-17T11:31:49.536Z","closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"labels":["Category:Gitaly","[deprecated] Accepting merge requests","devops::create","group::gitaly","section::dev","type::feature"],"milestone":{"id":490705,"iid":14,"group_id":9970,"title":"Backlog","description":"Issues that we want to do but are not planned right now. Open for contribution from the community.","state":"active","created_at":"2018-03-22T13:09:23.767Z","updated_at":"2018-10-30T14:56:54.069Z","due_date":null,"start_date":null,"expired":false,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/14"},"assignees":[],"author":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"type":"ISSUE","assignee":null,"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2840","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":1,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2840","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2840/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2840/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2840","relative":"#2840","full":"gitlab-org/gitaly#2840"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":35350580,"iid":2838,"project_id":2009901,"title":"Omnibus Gitaly dashboard should support multiple nodes","description":"During the 2020-05-27 demo, it was observed that the Omnibus Gitaly dashboard does not show more than one Gitaly at a time. Some of the panels, such as the current version, don't even support more than one Gitaly node (should instead be a table). The dashboard only allows viewing Gitalies with job set to \"gitaly\", while Praefect Gitaly nodes have a job of \"praefect-gitaly\". This should also be an option when selecting Gitalies.","state":"closed","created_at":"2020-06-02T19:18:41.346Z","updated_at":"2020-07-18T07:06:53.286Z","closed_at":"2020-07-14T13:37:43.316Z","closed_by":{"id":64248,"username":"stanhu","name":"Stan Hu","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/64248/stanhu.jpg","web_url":"https://gitlab.com/stanhu"},"labels":["Category:Gitaly","Deliverable","Observability","demo","devops::create","group::gitaly","group::gitaly::cluster","workflow::in review"],"milestone":{"id":1233746,"iid":49,"group_id":9970,"title":"13.2","description":"https://about.gitlab.com/releases/2020/07/22/gitlab-13-2-released/","state":"closed","created_at":"2020-04-09T17:28:01.032Z","updated_at":"2022-04-13T14:48:24.167Z","due_date":"2020-07-17","start_date":"2020-06-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/49"},"assignees":[{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"}],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"type":"ISSUE","assignee":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"user_notes_count":3,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2838","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2838","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2838/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2838/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2838","relative":"#2838","full":"gitlab-org/gitaly#2838"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2013,"epic":{"id":13406,"iid":2013,"title":"🌿 Gitaly Cluster: Distribute Git read operations across Gitaly nodes","url":"/groups/gitlab-org/-/epics/2013","group_id":9970,"human_readable_end_date":"Mar 17, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":35316409,"iid":2834,"project_id":2009901,"title":"Distribute reads between all shards, including primaries","description":"#### Problem\n\nCurrently, the read distribution feature skips the primary node from serving read traffic. This is an understandable choice, given writes are more expensive than reads. But soon the write load will be distributed too with the introduction on transaction. Than the load isn't balanced anymore.\n\n#### Solution\n\nPrimary nodes get as much read traffic as any other node.","state":"closed","created_at":"2020-06-02T13:00:57.825Z","updated_at":"2020-06-11T17:02:49.851Z","closed_at":"2020-06-10T21:08:28.982Z","closed_by":{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/228150/avatar.png","web_url":"https://gitlab.com/proglottis"},"labels":["Category:Gitaly","Stretch","devops::create","group::gitaly","type::feature","workflow::in review"],"milestone":{"id":1112145,"iid":47,"group_id":9970,"title":"13.1","description":"","state":"closed","created_at":"2020-01-03T12:28:30.160Z","updated_at":"2020-10-08T12:01:07.361Z","due_date":"2020-06-17","start_date":"2020-05-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/47"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"user_notes_count":2,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2834","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2834","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2834/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2834/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2834","relative":"#2834","full":"gitlab-org/gitaly#2834"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2013,"epic":{"id":13406,"iid":2013,"title":"🌿 Gitaly Cluster: Distribute Git read operations across Gitaly nodes","url":"/groups/gitlab-org/-/epics/2013","group_id":9970,"human_readable_end_date":"Mar 17, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":35255594,"iid":2827,"project_id":2009901,"title":"Praefect: Coordinator.StreamDirector doesn't handle STORAGE scope correctly","description":"Current implementation of [`StreamDirector`](https://gitlab.com/gitlab-org/gitaly/-/blob/d08b7024a0a2882dc55d8a480d891fc0ded5bb9b/internal/praefect/coordinator.go#L217) doesn't properly handles requests with `scope_level: STORAGE` option, such as [`RemoveNamespace`](https://gitlab.com/gitlab-org/gitaly/-/blob/d08b7024a0a2882dc55d8a480d891fc0ded5bb9b/proto/namespace.proto#L16) in case virtual storage name and storage name for gitaly differs, like: \n```\n[[virtual_storage]]\nname = 'praefect'\n[[virtual_storage.node]]\n  storage = \"gitaly-1\"\n```\nCoordinator doesn't re-write storage for such RPCs, so request will contain virtual storage name instead of mapped gitaly storage name.\n\nThere is an open https://gitlab.com/gitlab-org/gitaly/-/merge_requests/2234 that can be used to verify this bug.  \nYou can check it with `gdk` and `TestPraefectHandlesStorageScopeRequests` test locally.\n\n/cc @zj-gitlab @jramsay","state":"closed","created_at":"2020-06-01T09:13:32.011Z","updated_at":"2020-07-21T12:15:46.578Z","closed_at":"2020-07-21T11:54:00.840Z","closed_by":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"labels":["Category:Gitaly","Stretch","devops::create","group::gitaly","group::gitaly::cluster","missed:13.2","priority::2","severity::2","type::bug","workflow::in review"],"milestone":{"id":1233752,"iid":50,"group_id":9970,"title":"13.3","description":"https://about.gitlab.com/releases/2020/08/22/gitlab-13-3-released/","state":"closed","created_at":"2020-04-09T17:39:21.090Z","updated_at":"2022-04-13T14:50:18.976Z","due_date":"2020-08-17","start_date":"2020-07-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/50"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"}],"author":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2827","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2827","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2827/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2827/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2827","relative":"#2827","full":"gitlab-org/gitaly#2827"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":35144491,"iid":2820,"project_id":2009901,"title":"Configure Gitaly to schedule nightly repo optimization","description":"We have an RPC `OptimizeRepository` that is designed to be called to improve performance of repos. Currently, it is not being utilized by Rails. It may be very complex to figure out the best way to invoke it from Rails. A more incremental approach might be invoking it internally from Gitaly on a routine schedule (e.g. nights, weekends) similar to a cron job.","state":"closed","created_at":"2020-05-28T23:03:03.973Z","updated_at":"2021-04-20T22:27:49.975Z","closed_at":"2020-09-15T06:55:27.232Z","closed_by":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"labels":["Category:Gitaly","Deliverable","bug::performance","devops::create","feature::addition","group::gitaly","missed-deliverable","missed:13.3","section::dev","workflow::verification"],"milestone":{"id":1233753,"iid":51,"group_id":9970,"title":"13.4","description":"https://about.gitlab.com/releases/2020/09/22/gitlab-13-4-released/","state":"closed","created_at":"2020-04-09T17:39:21.662Z","updated_at":"2022-04-13T14:50:33.769Z","due_date":"2020-09-17","start_date":"2020-08-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/51"},"assignees":[{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"}],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"type":"ISSUE","assignee":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"user_notes_count":16,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2820","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2820","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2820/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2820/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2820","relative":"#2820","full":"gitlab-org/gitaly#2820"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":35039260,"iid":2815,"project_id":2009901,"title":"Connection caching in ReplicateRepository breaks due to v2 tokens","description":"In https://gitlab.com/gitlab-org/gitaly/-/commit/54465275b27178af0268d1281a7f933585f29b0f we dropped support for v1 tokens. V2 tokens have a timestamp constraint. \r\n\r\nIt seems that this has broken replication in production. It's unclear if this is due to clock skew, but we are getting some `timestamp too old` errors","state":"closed","created_at":"2020-05-26T23:10:44.755Z","updated_at":"2020-06-01T22:15:30.600Z","closed_at":"2020-05-28T22:07:30.765Z","closed_by":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"},"labels":["Category:Gitaly","devops::create","group::gitaly","group::gitaly::cluster","priority::1","severity::1","type::bug","workflow::in dev"],"milestone":{"id":1112145,"iid":47,"group_id":9970,"title":"13.1","description":"","state":"closed","created_at":"2020-01-03T12:28:30.160Z","updated_at":"2020-10-08T12:01:07.361Z","due_date":"2020-06-17","start_date":"2020-05-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/47"},"assignees":[{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"}],"author":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"},"type":"ISSUE","assignee":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"},"user_notes_count":14,"merge_requests_count":2,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2815","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2815","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2815/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2815/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2815","relative":"#2815","full":"gitlab-org/gitaly#2815"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":34819026,"iid":2796,"project_id":2009901,"title":"Praefect migration to drop gitaly_ tables","description":"We have old migrations in some of our environments with the outdated `gitaly_` tables. We should write a migration that removes these. eg: here is the production environment:\n\n```\npraefect_production=\u003e \\d+\n                                     List of relations\n Schema |               Name                |   Type   |  Owner  |    Size    | Description\n--------+-----------------------------------+----------+---------+------------+-------------\n public | gitaly_replication_queue          | table    | default | 8192 bytes |\n public | gitaly_replication_queue_id_seq   | sequence | default | 8192 bytes |\n public | gitaly_replication_queue_job_lock | table    | default | 8192 bytes |\n public | gitaly_replication_queue_lock     | table    | default | 8192 bytes |\n public | hello_world                       | table    | default | 8192 bytes |\n public | node_status                       | table    | default | 8192 bytes |\n public | node_status_id_seq                | sequence | default | 8192 bytes |\n public | replication_queue                 | table    | default | 8192 bytes |\n public | replication_queue_id_seq          | sequence | default | 8192 bytes |\n public | replication_queue_job_lock        | table    | default | 8192 bytes |\n public | replication_queue_lock            | table    | default | 8192 bytes |\n public | schema_migrations                 | table    | default | 16 kB      |\n public | shard_primaries                   | table    | default | 8192 bytes |\n public | shard_primaries_id_seq            | sequence | default | 8192 bytes |\n(14 rows)\n```","state":"closed","created_at":"2020-05-20T19:07:54.218Z","updated_at":"2020-06-22T07:37:26.282Z","closed_at":"2020-05-28T19:27:18.656Z","closed_by":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"},"labels":["Category:Gitaly","Stretch","devops::create","group::gitaly","workflow::in review"],"milestone":{"id":1112145,"iid":47,"group_id":9970,"title":"13.1","description":"","state":"closed","created_at":"2020-01-03T12:28:30.160Z","updated_at":"2020-10-08T12:01:07.361Z","due_date":"2020-06-17","start_date":"2020-05-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/47"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"}],"author":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"user_notes_count":3,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2796","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2796","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2796/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2796/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2796","relative":"#2796","full":"gitlab-org/gitaly#2796"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1491,"epic":{"id":8450,"iid":1491,"title":"🌻 Improved Gitaly Cluster admin experience","url":"/groups/gitlab-org/-/epics/1491","group_id":9970,"human_readable_end_date":"Apr 22, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":"on_track"},{"id":34785714,"iid":2792,"project_id":2009901,"title":"Investigate sporadic Praefect metrics for replication latency and delay","description":"During the demo, we observed sporadic data for replication delay and latency metrics. We should verify the metrics are behaving as expected, or determine a fix to correct them.","state":"closed","created_at":"2020-05-20T06:29:36.284Z","updated_at":"2020-05-27T14:15:27.926Z","closed_at":"2020-05-27T13:42:15.545Z","closed_by":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"labels":["Category:Gitaly","Observability","demo","devops::create","group::gitaly","group::gitaly::cluster"],"milestone":{"id":1112145,"iid":47,"group_id":9970,"title":"13.1","description":"","state":"closed","created_at":"2020-01-03T12:28:30.160Z","updated_at":"2020-10-08T12:01:07.361Z","due_date":"2020-06-17","start_date":"2020-05-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/47"},"assignees":[{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"}],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"type":"ISSUE","assignee":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"user_notes_count":4,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":"2020-05-26","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2792","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2792","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2792/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2792/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2792","relative":"#2792","full":"gitlab-org/gitaly#2792"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1491,"epic":{"id":8450,"iid":1491,"title":"🌻 Improved Gitaly Cluster admin experience","url":"/groups/gitlab-org/-/epics/1491","group_id":9970,"human_readable_end_date":"Apr 22, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":34785652,"iid":2791,"project_id":2009901,"title":"Expand Praefect dashboard panel for error rate to also include total rate","description":"The Omnibus Praefect dashboard has a panel for the error rate of certain RPC's proxied by Praefect. This panel lacks context from the total number of handled requests. This should be added.","state":"closed","created_at":"2020-05-20T06:27:11.107Z","updated_at":"2020-06-02T00:14:26.467Z","closed_at":"2020-06-02T00:07:21.315Z","closed_by":{"id":787914,"username":"ibaum","name":"Ian Baum","state":"active","avatar_url":"https://secure.gravatar.com/avatar/7c508dc85ddd5049564a95662311543b?s=80\u0026d=identicon","web_url":"https://gitlab.com/ibaum"},"labels":["Category:Gitaly","Observability","demo","devops::create","group::gitaly","group::gitaly::cluster","workflow::in review"],"milestone":{"id":1112145,"iid":47,"group_id":9970,"title":"13.1","description":"","state":"closed","created_at":"2020-01-03T12:28:30.160Z","updated_at":"2020-10-08T12:01:07.361Z","due_date":"2020-06-17","start_date":"2020-05-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/47"},"assignees":[{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"}],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"type":"ISSUE","assignee":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":"2020-05-26","confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2791","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2791","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2791/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2791/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2791","relative":"#2791","full":"gitlab-org/gitaly#2791"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":34775378,"iid":2786,"project_id":2009901,"title":"Improve Gitaly connection error messages","description":"A customer using a stand-alone Gitaly server recently ran into an issue where Gitaly-Ruby processes could not communicate with the main Gitaly process when executing `UserCommitFiles`.  Specifically, DNS was not responding when querying for the Gitaly hostname, but the error `rpc error: code = Unavailable desc = failed to connect to all addresses` gave no indication where the problem was occurring.\n\nIncluding the target that could not be connected to would make problems like this significantly easier to debug.\n\n/cc @zj-gitlab","state":"closed","created_at":"2020-05-19T20:55:48.995Z","updated_at":"2020-08-05T10:15:01.679Z","closed_at":"2020-08-05T09:12:42.289Z","closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"labels":["Category:Gitaly","Gitaly","Gitaly-Ruby","SLO::Missed","[deprecated] Accepting merge requests","blocked","customer","devops::create","group::gitaly","priority::2","severity::4","type::bug","workflow::ready for development"],"milestone":{"id":490705,"iid":14,"group_id":9970,"title":"Backlog","description":"Issues that we want to do but are not planned right now. Open for contribution from the community.","state":"active","created_at":"2018-03-22T13:09:23.767Z","updated_at":"2018-10-30T14:56:54.069Z","due_date":null,"start_date":null,"expired":false,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/14"},"assignees":[],"author":{"id":2578846,"username":"wchandler","name":"Will Chandler","state":"active","avatar_url":"https://secure.gravatar.com/avatar/cc8b92738249753faee7055e021f8221?s=80\u0026d=identicon","web_url":"https://gitlab.com/wchandler"},"type":"ISSUE","assignee":null,"user_notes_count":9,"merge_requests_count":2,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2786","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2786","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2786/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2786/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2786","relative":"#2786","full":"gitlab-org/gitaly#2786"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":34731720,"iid":2783,"project_id":2009901,"title":"Enable read-only mode only when there is data loss after a failover","description":"## Problem to solve\n\nCurrently read-only mode is enabled after any failover event. Read-only Git access is a reduction in availability and should be avoided where possible.\n\n## Proposal\n\nWe should only enable read-only mode if the virtual storage has data loss, that is, any repositories for which the last replication job is not in `completed` state.\n\ncc @zj-gitlab","state":"closed","created_at":"2020-05-19T11:38:38.356Z","updated_at":"2020-08-18T07:08:24.432Z","closed_at":"2020-07-27T21:06:46.195Z","closed_by":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"labels":["Category:Gitaly","Deliverable","Gitaly","devops::create","group::gitaly","group::gitaly::cluster","missed-deliverable","missed:13.1","missed:13.2","type::feature","workflow::ready for development"],"milestone":{"id":1233752,"iid":50,"group_id":9970,"title":"13.3","description":"https://about.gitlab.com/releases/2020/08/22/gitlab-13-3-released/","state":"closed","created_at":"2020-04-09T17:39:21.090Z","updated_at":"2022-04-13T14:50:18.976Z","due_date":"2020-08-17","start_date":"2020-07-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/50"},"assignees":[{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5522960/avatar.png","web_url":"https://gitlab.com/samihiltunen"}],"author":{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5522960/avatar.png","web_url":"https://gitlab.com/samihiltunen"},"type":"ISSUE","assignee":{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5522960/avatar.png","web_url":"https://gitlab.com/samihiltunen"},"user_notes_count":1,"merge_requests_count":1,"upvotes":2,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2783","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":1,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2783","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2783/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2783/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2783","relative":"#2783","full":"gitlab-org/gitaly#2783"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2983,"epic":{"id":36565,"iid":2983,"title":"🦄 HA Gitaly: improved availability","url":"/groups/gitlab-org/-/epics/2983","group_id":9970,"human_readable_end_date":"Jan 17, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":34712319,"iid":2780,"project_id":2009901,"title":"Replication queue size should have virtual storage label","description":"The Prometheus metric `gitaly_praefect_replication_jobs` should be broken down by virtual storages. This will allow us to compare replication queue pressure between virtual storages on the same Praefect or to aggregate virtual storage queue pressure between Praefects. This requires adding a label for the virtual storage to the metric.\n\nRelates to https://gitlab.com/gitlab-org/gitaly/-/issues/2659","state":"closed","created_at":"2020-05-18T23:14:55.102Z","updated_at":"2020-06-18T07:07:27.732Z","closed_at":"2020-05-29T07:55:41.167Z","closed_by":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"labels":["Category:Gitaly","Deliverable","Observability","devops::create","group::gitaly","group::gitaly::cluster","workflow::in review"],"milestone":{"id":1112145,"iid":47,"group_id":9970,"title":"13.1","description":"","state":"closed","created_at":"2020-01-03T12:28:30.160Z","updated_at":"2020-10-08T12:01:07.361Z","due_date":"2020-06-17","start_date":"2020-05-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/47"},"assignees":[{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"}],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"type":"ISSUE","assignee":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"user_notes_count":2,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2780","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":1,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2780","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2780/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2780/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2780","relative":"#2780","full":"gitlab-org/gitaly#2780"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1491,"epic":{"id":8450,"iid":1491,"title":"🌻 Improved Gitaly Cluster admin experience","url":"/groups/gitlab-org/-/epics/1491","group_id":9970,"human_readable_end_date":"Apr 22, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":34595758,"iid":2771,"project_id":2009901,"title":"Clean up Ruby implementation for FetchInternalRemote","description":"After porting an RPC to Go the following tasks remain:\n\n- [x] Remove the feature flag, default to Go\n- [x] Wait 1 release\n- [ ] Remove the Ruby implementation","state":"closed","created_at":"2020-05-15T09:08:16.313Z","updated_at":"2020-07-18T07:06:53.426Z","closed_at":"2020-06-29T18:58:18.701Z","closed_by":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"labels":["Category:Gitaly","Deliverable","backstage [DEPRECATED]","devops::create","group::gitaly","workflow::in dev"],"milestone":{"id":1233746,"iid":49,"group_id":9970,"title":"13.2","description":"https://about.gitlab.com/releases/2020/07/22/gitlab-13-2-released/","state":"closed","created_at":"2020-04-09T17:28:01.032Z","updated_at":"2022-04-13T14:48:24.167Z","due_date":"2020-07-17","start_date":"2020-06-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/49"},"assignees":[{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/228150/avatar.png","web_url":"https://gitlab.com/proglottis"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"type":"ISSUE","assignee":{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/228150/avatar.png","web_url":"https://gitlab.com/proglottis"},"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2771","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":3,"completed_count":2},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2771","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2771/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2771/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2771","relative":"#2771","full":"gitlab-org/gitaly#2771"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":"on_track"},{"id":34538258,"iid":2769,"project_id":2009901,"title":"Explore use of Git's trace2 mechanism","description":"When spawning Git executables, we currently cannot evaluate what Git actually does except for observing its runtime and usual stdout/stderr. In order to allow better traceing of performance and events in Git, the trace2 mechanism was introduced in v2.22. We should evaluate whether hooking into this mechanism makes sense to get more insight into Git, improve visibility and ultimately to allow for better debugging of pathological cases.","state":"closed","created_at":"2020-05-14T08:00:43.833Z","updated_at":"2023-04-18T06:01:09.256Z","closed_at":"2023-03-30T04:47:11.656Z","closed_by":{"id":7815314,"username":"qmnguyen0711","name":"Quang-Minh Nguyen","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/7815314/avatar.png","web_url":"https://gitlab.com/qmnguyen0711"},"labels":["Category:Gitaly","Engineering Allocation","Gitaly authx","devops::systems","group::gitaly","group::gitaly::git","maintenance::scalability","missed:15.10","missed:15.8","missed:15.9","section::enablement","type::maintenance","workflow::complete"],"milestone":{"id":2910456,"iid":86,"group_id":9970,"title":"15.11","description":"","state":"active","created_at":"2022-12-13T20:08:46.985Z","updated_at":"2022-12-13T20:08:46.985Z","due_date":"2023-04-17","start_date":"2023-03-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/86"},"assignees":[],"author":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"type":"ISSUE","assignee":null,"user_notes_count":24,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2769","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2769","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2769/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2769/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2769","relative":"#2769","full":"gitlab-org/gitaly#2769"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":9538,"epic":{"id":688348,"iid":9538,"title":"📯 Collect Git insights through Trace2","url":"/groups/gitlab-org/-/epics/9538","group_id":9970,"human_readable_end_date":"Apr 17, 2023","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":34501318,"iid":2767,"project_id":2009901,"title":"Documentation: How to remove the filterspec for a local repository","description":"During the Partial clone demo of 2020-05-12, the question was asked how to remove the filterspec from a repository and `git pull` to ensure everything is present. Currently the documentation do not provide this.\n\n### Proposal\n\nAdd a section to the documentation: https://docs.gitlab.com/ee/topics/git/partial_clone.html on how to unfilter a repository.\n\n/cc @chriscool @jramsay","state":"closed","created_at":"2020-05-13T10:21:52.304Z","updated_at":"2020-07-23T04:15:36.548Z","closed_at":"2020-07-23T03:21:40.632Z","closed_by":{"id":138401,"username":"chriscool","name":"Christian Couder","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/138401/avatar.png","web_url":"https://gitlab.com/chriscool"},"labels":["Category:Gitaly","demo","devops::create","documentation","group::gitaly","missed:13.1","missed:13.2","partial clone","workflow::ready for development"],"milestone":{"id":1233752,"iid":50,"group_id":9970,"title":"13.3","description":"https://about.gitlab.com/releases/2020/08/22/gitlab-13-3-released/","state":"closed","created_at":"2020-04-09T17:39:21.090Z","updated_at":"2022-04-13T14:50:18.976Z","due_date":"2020-08-17","start_date":"2020-07-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/50"},"assignees":[{"id":138401,"username":"chriscool","name":"Christian Couder","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/138401/avatar.png","web_url":"https://gitlab.com/chriscool"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"type":"ISSUE","assignee":{"id":138401,"username":"chriscool","name":"Christian Couder","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/138401/avatar.png","web_url":"https://gitlab.com/chriscool"},"user_notes_count":8,"merge_requests_count":3,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2767","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2767","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2767/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2767/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2767","relative":"#2767","full":"gitlab-org/gitaly#2767"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":3790,"epic":{"id":75811,"iid":3790,"title":"Partial clone for binary files workflows (viable)","url":"/groups/gitlab-org/-/epics/3790","group_id":9970,"human_readable_end_date":"Mar 17, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":34416474,"iid":2757,"project_id":2009901,"title":"InfoRefsUploadPack disk cache: file descriptors must be closed after use","description":"RPC method **InfoRefsUploadPack** uses a special cache based on the use of files.  \nEach requests tries to find a cache entry in it.  \nIf it exists the data would be read from it and returned as a result of the call.  \nThe read is done with use of `[os.Open(respPath)](https://gitlab.com/gitlab-org/gitaly/-/blob/v13.0.0-rc1/internal/cache/cachedb.go#L92)` and `[io.Copy(w, stream)](https://gitlab.com/gitlab-org/gitaly/-/blob/v13.0.0-rc1/internal/service/smarthttp/cache.go#L63)`.  \nBut the call to `stream.Close()` is missing and it results to file descriptors leak.  \n\n/cc @zj-gitlab @jramsay","state":"closed","created_at":"2020-05-11T19:19:10.916Z","updated_at":"2020-05-12T16:51:01.425Z","closed_at":"2020-05-12T16:24:47.136Z","closed_by":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"labels":["Category:Gitaly","devops::create","group::gitaly","type::bug"],"milestone":{"id":991112,"iid":42,"group_id":9970,"title":"13.0","description":"","state":"closed","created_at":"2019-09-04T15:20:39.024Z","updated_at":"2020-10-08T12:00:55.725Z","due_date":"2020-05-17","start_date":"2020-04-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/42"},"assignees":[],"author":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"type":"ISSUE","assignee":null,"user_notes_count":2,"merge_requests_count":1,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2757","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2757","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2757/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2757/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2757","relative":"#2757","full":"gitlab-org/gitaly#2757"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":34383340,"iid":2756,"project_id":2009901,"title":"Gitaly tmp folder cleanup must run every hour","description":"Gitaly uses a special directory as a temporary folder named `tmp`.  \nIt has a [special background task](https://gitlab.com/search?group_id=\u0026nav_source=navbar\u0026project_id=2009901\u0026repository_ref=v13.0.0-rc1\u0026search=StartCleaning()\u0026search_code=true\u0026utf8=%E2%9C%93#L79) that must run each hour to clean up stale files in it.\nBut now it runs only once after start/restart because the call is not wrapped into the infinite loop.  \nIt could be observed by checking logs that a missed log entry for each hour.  \nThere are only entries after the service restart ![image](/uploads/eab41b2518b95f005e15271459f7cea6/image.png)\n\n/cc @zj-gitlab @jramsay","state":"closed","created_at":"2020-05-11T07:54:52.032Z","updated_at":"2020-08-06T20:58:42.096Z","closed_at":"2020-07-07T19:15:15.601Z","closed_by":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"labels":["Category:Gitaly","Gitaly","[deprecated] Accepting merge requests","[deprecated] good for new contributors","devops::create","group::gitaly","priority::2","severity::3","type::bug"],"milestone":{"id":490705,"iid":14,"group_id":9970,"title":"Backlog","description":"Issues that we want to do but are not planned right now. Open for contribution from the community.","state":"active","created_at":"2018-03-22T13:09:23.767Z","updated_at":"2018-10-30T14:56:54.069Z","due_date":null,"start_date":null,"expired":false,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/14"},"assignees":[],"author":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"type":"ISSUE","assignee":null,"user_notes_count":7,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2756","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2756","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2756/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2756/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2756","relative":"#2756","full":"gitlab-org/gitaly#2756"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":34305990,"iid":2741,"project_id":2009901,"title":"Port FetchSourceBranch to Go","description":"In %\"13.0\" FetchInternalRemote was ported to Go, and it seems like FetchSourceBranch does about the same things, but is still in Ruby. That makes it unreliable, while it could be ported to Go. Which would improve our SLA for the RPC, and maybe performance too.","state":"closed","created_at":"2020-05-08T09:38:48.591Z","updated_at":"2021-01-26T07:24:42.897Z","closed_at":"2021-01-26T07:24:42.856Z","closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"labels":["Category:Gitaly","bug::performance","devops::create","group::gitaly","missed:13.1","missed:13.4","missed:13.5","missed:13.6","section::dev","type::maintenance","workflow::verification"],"milestone":{"id":1233760,"iid":56,"group_id":9970,"title":"13.9","description":"https://about.gitlab.com/releases/archives.html","state":"closed","created_at":"2020-04-09T17:44:14.334Z","updated_at":"2022-04-21T07:21:28.468Z","due_date":"2021-02-17","start_date":"2021-01-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/56"},"assignees":[{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"type":"ISSUE","assignee":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"user_notes_count":6,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2741","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2741","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2741/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2741/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2741","relative":"#2741","full":"gitlab-org/gitaly#2741"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2862,"epic":{"id":30693,"iid":2862,"title":"🏍 Remove the Gitaly-Ruby sidecar","url":"/groups/gitlab-org/-/epics/2862","group_id":9970,"human_readable_end_date":"May 17, 2023","human_readable_timestamp":"\u003cstrong\u003e11\u003c/strong\u003e days remaining"},"iteration":null,"health_status":null},{"id":34095215,"iid":2729,"project_id":2009901,"title":"Update Source install instructions to use `make build-git`","description":"[Source install documentation](https://docs.gitlab.com/ee/install/installation.html) includes instructions for installing Git. It has to be present to obtain the source, but needs to have the correct version too. \n\n### Proposal\n\nRemove the Git install from the dependencies section: https://docs.gitlab.com/ee/install/installation.html#1-packages-and-dependencies, and move it to Gitaly to leverage `make download-git`.","state":"closed","created_at":"2020-05-04T08:31:41.227Z","updated_at":"2021-05-05T11:56:29.082Z","closed_at":"2020-11-17T07:08:49.557Z","closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"labels":["Category:Gitaly","Deliverable","devops::create","documentation","group::gitaly","missed-deliverable","missed:13.5","section::dev","workflow::in dev"],"milestone":{"id":1233755,"iid":53,"group_id":9970,"title":"13.6","description":"https://about.gitlab.com/releases/2020/11/22/gitlab-13-6-released/","state":"closed","created_at":"2020-04-09T17:39:22.328Z","updated_at":"2022-04-13T14:51:04.376Z","due_date":"2020-11-17","start_date":"2020-10-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/53"},"assignees":[{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"type":"ISSUE","assignee":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"user_notes_count":5,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2729","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2729","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2729/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2729/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2729","relative":"#2729","full":"gitlab-org/gitaly#2729"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":3196,"epic":{"id":49057,"iid":3196,"title":"1️⃣ Distribute one Git throughout GitLab","url":"/groups/gitlab-org/-/epics/3196","group_id":9970,"human_readable_end_date":"Apr 17, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":34086193,"iid":2727,"project_id":2009901,"title":"Frame-wise proxying of write operations to Gitaly replicas","description":"## Problem to solve\n\nWhen a success signal is sent via the Git protocol or an RPC for a write operation from a HA Gitaly cluster, we want the success signal to communicate that the write has succeeded in multiple locations so that a single node failure does not result in data loss.\n\nWrite operations are currently routed only to the primary node. This data also needs to be sent to the other nodes in the cluster.\n\n## Further details\n\nReplaying the write operation from the primary to the secondary nodes is not ideal from a performance or reliability perspective.\n\nIt should be possible to proxy the write to all the Gitaly nodes. The simplest approach is frame-wise proxying, but if one node is slow, this will block all the nodes. In the future, stream-wise proxying would solve this.\n\n## Proposal\n\nImplement frame-wise proxying of write operations to all Gitaly nodes as part of strong consistency.\n\n## Testing\n\nFunctional end-to-end coverage is provided by an existing [replication test](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/27972). And broad coverage by [running the entire end-to-end test suite against environments using Praefect for storage](https://gitlab.com/gitlab-org/gitlab-qa/-/blob/master/docs/what_tests_can_be_run.md#testintegrationpraefect-ceeefull-image-address) (including Staging).\n\nPerformance end-to-end testing will be implemented as part of https://gitlab.com/gitlab-org/quality/performance/-/issues/231 (see https://gitlab.com/gitlab-org/quality/team-tasks/-/issues/451 for a more detailed plan of performance tests under failure conditions)\n\n## Links / references","state":"closed","created_at":"2020-05-04T04:38:57.604Z","updated_at":"2020-07-18T07:06:53.506Z","closed_at":"2020-07-06T16:59:54.180Z","closed_by":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"},"labels":["Category:Gitaly","Deliverable","devops::create","group::gitaly","group::gitaly::cluster","missed-deliverable","missed:13.1","quad-planning::complete-action","type::feature","workflow::in review"],"milestone":{"id":1233746,"iid":49,"group_id":9970,"title":"13.2","description":"https://about.gitlab.com/releases/2020/07/22/gitlab-13-2-released/","state":"closed","created_at":"2020-04-09T17:28:01.032Z","updated_at":"2022-04-13T14:48:24.167Z","due_date":"2020-07-17","start_date":"2020-06-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/49"},"assignees":[{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"}],"author":{"id":1187333,"username":"jramsay-gitlab","name":"James Ramsay (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1187333/avatar.png","web_url":"https://gitlab.com/jramsay-gitlab"},"type":"ISSUE","assignee":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"},"user_notes_count":9,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2727","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2727","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2727/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2727/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2727","relative":"#2727","full":"gitlab-org/gitaly#2727"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1189,"epic":{"id":5989,"iid":1189,"title":"Gitaly Cluster: strong consistency","url":"/groups/gitlab-org/-/epics/1189","group_id":9970,"human_readable_end_date":"Sep 17, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":33980450,"iid":2715,"project_id":2009901,"title":"Error in go FetchInternalRemote \"git fetch failed: signal: terminated\"","description":"`FetchInternalRemote` sometimes fails with `git fetch` getting SIGTERM. And returning an error as per https://github.com/golang/go/blob/go1.14.2/src/os/exec_posix.go#L107\n\nhttps://log.gprd.gitlab.net/app/kibana#/doc/AW5F1OHTiGcMMNRn84Di/pubsub-gitaly-inf-gprd-001969?id=wJYRx3EB_vQvi1G70XPU","state":"closed","created_at":"2020-04-30T00:48:38.535Z","updated_at":"2020-06-16T06:32:52.260Z","closed_at":"2020-06-10T03:16:09.198Z","closed_by":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"labels":["Category:Gitaly","devops::create","group::gitaly","missed:13.0","priority::2","type::bug","workflow::ready for development"],"milestone":{"id":1112145,"iid":47,"group_id":9970,"title":"13.1","description":"","state":"closed","created_at":"2020-01-03T12:28:30.160Z","updated_at":"2020-10-08T12:01:07.361Z","due_date":"2020-06-17","start_date":"2020-05-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/47"},"assignees":[{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/228150/avatar.png","web_url":"https://gitlab.com/proglottis"}],"author":{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/228150/avatar.png","web_url":"https://gitlab.com/proglottis"},"type":"ISSUE","assignee":{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/228150/avatar.png","web_url":"https://gitlab.com/proglottis"},"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2715","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2715","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2715/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2715/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2715","relative":"#2715","full":"gitlab-org/gitaly#2715"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2307,"epic":{"id":15983,"iid":2307,"title":"🚜 Improve Gitaly data migration tools","url":"/groups/gitlab-org/-/epics/2307","group_id":9970,"human_readable_end_date":"Jul 17, 2022","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":33944108,"iid":2713,"project_id":2009901,"title":"Praefect added latency misjudging CalculateChecksum latency","description":"When looking at the added latency through Praefect, it seems like only CalculateChecksum has issues, which seems odd:\n\n![Screenshot_from_2020-04-28_13-58-50](/uploads/70ba78a22284b7f473fe04a6f2e5a669/Screenshot_from_2020-04-28_13-58-50.png)\n\nChecksums are used extensively by Praefect, without proxying the RPC to a client. It seems like a bug in the metric.","state":"closed","created_at":"2020-04-29T10:23:50.489Z","updated_at":"2022-05-30T03:05:56.123Z","closed_at":"2022-05-30T03:05:56.108Z","closed_by":{"id":1786152,"username":"gitlab-bot","name":"🤖 GitLab Bot 🤖","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1786152/avatar.png","web_url":"https://gitlab.com/gitlab-bot"},"labels":["Category:Gitaly","Observability","[deprecated] Accepting merge requests","auto closed","devops::create","group::gitaly","group::gitaly::cluster","priority::4","section::dev","severity::4","stale","type::bug","vintage"],"milestone":{"id":490705,"iid":14,"group_id":9970,"title":"Backlog","description":"Issues that we want to do but are not planned right now. Open for contribution from the community.","state":"active","created_at":"2018-03-22T13:09:23.767Z","updated_at":"2018-10-30T14:56:54.069Z","due_date":null,"start_date":null,"expired":false,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/14"},"assignees":[],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"type":"ISSUE","assignee":null,"user_notes_count":12,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2713","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2713","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2713/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2713/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2713","relative":"#2713","full":"gitlab-org/gitaly#2713"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":33840434,"iid":2709,"project_id":2009901,"title":"Praefect: proper multi-virtual storage support","description":"Praefect has advantage of multi-virtual storages support in configuration, but in the [real life](https://gitlab.com/gitlab-org/gitaly/-/blob/ca7faa446b4db4713ad128698d4130aa4de8a26e/cmd/praefect/main.go#L250) it can't handle it properly.  \nCurrent routing logic doesn't support multi-virtual storage configuration and allows request routings only for single virtual storage. As well replication is also has no multi-virtual storage support, that affects a helper-subcommand: `dataloss` as well.  \nProper multi-virtual storages support is required before https://gitlab.com/gitlab-org/gitaly/-/issues/2650\n\n/cc @jramsay @zj-gitlab","state":"closed","created_at":"2020-04-27T09:03:45.478Z","updated_at":"2020-05-20T14:15:57.700Z","closed_at":"2020-05-18T05:03:46.340Z","closed_by":{"id":1187333,"username":"jramsay-gitlab","name":"James Ramsay (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1187333/avatar.png","web_url":"https://gitlab.com/jramsay-gitlab"},"labels":["Category:Gitaly","devops::create","group::gitaly","group::gitaly::cluster","priority::2","type::bug","workflow::in dev"],"milestone":{"id":991112,"iid":42,"group_id":9970,"title":"13.0","description":"","state":"closed","created_at":"2019-09-04T15:20:39.024Z","updated_at":"2020-10-08T12:00:55.725Z","due_date":"2020-05-17","start_date":"2020-04-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/42"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"}],"author":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"user_notes_count":5,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2709","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2709","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2709/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2709/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2709","relative":"#2709","full":"gitlab-org/gitaly#2709"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2658,"epic":{"id":20748,"iid":2658,"title":"🚀 Gitaly HA (generally available)","url":"/groups/gitlab-org/-/epics/2658","group_id":9970,"human_readable_end_date":"May 17, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":33756926,"iid":2701,"project_id":2009901,"title":"Revise usage of ReplicasDatastore interface","description":"After moving to new approach with leader election based on different strategies most of the methods of the `ReplicasDatastore` interface are not needed anymore.  \nThey exist only because of the tests.  \nTo simplify project we need to clean up and refactor it as it could lead to misunderstanding of proper usage.\n\n\n/cc @zj-gitlab @jramsay","state":"closed","created_at":"2020-04-24T14:42:40.817Z","updated_at":"2020-06-09T13:15:10.179Z","closed_at":"2020-06-09T12:18:04.074Z","closed_by":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"labels":["Category:Gitaly","Stretch","[deprecated] Accepting merge requests","devops::create","group::gitaly","group::gitaly::cluster","maintenance::refactor"],"milestone":{"id":1112145,"iid":47,"group_id":9970,"title":"13.1","description":"","state":"closed","created_at":"2020-01-03T12:28:30.160Z","updated_at":"2020-10-08T12:01:07.361Z","due_date":"2020-06-17","start_date":"2020-05-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/47"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"}],"author":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"user_notes_count":2,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2701","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2701","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2701/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2701/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2701","relative":"#2701","full":"gitlab-org/gitaly#2701"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":33594811,"iid":2691,"project_id":2009901,"title":"The `ReplicateRepository` GRPC should automatically clean up after itself when it encounters an error","description":"The `ReplicateRepository` GRPC should automatically clean up after itself when it encounters an error.\n\nCurrently, errors appear to get sort of eaten, and the invoking Rails process never notified about the failure.\n\nThis results in a bad state, with a project repository only partially replicated to the destination gitaly storage shard file system.\n\nIn any case, once the underlying problem is fixed, that is all well and good.\n\nHowever, to future-proof against other unknown and as yet unencountered errors, the `ReplicateRepository` GRPC implementation should include an unwind/rollback step which is ensured to be invoked when any error is encountered.\n\nThis would also significantly unblock our current process, and would allow us to get back into the business of spinning through large numbers of project replications as part of storage shard re-balancing operations.\n\nThe failed replica repo should never matter, since the original repository should remain untouched, as defined by the scope of the `ReplicateRepository` GRPC method implementation.","state":"closed","created_at":"2020-04-21T20:04:10.725Z","updated_at":"2020-06-16T22:41:32.572Z","closed_at":"2020-06-16T06:36:28.247Z","closed_by":{"id":1187333,"username":"jramsay-gitlab","name":"James Ramsay (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1187333/avatar.png","web_url":"https://gitlab.com/jramsay-gitlab"},"labels":["Category:Gitaly","[deprecated] Accepting merge requests","blocker","devops::create","group::gitaly","internal customer","priority::3","type::feature"],"milestone":{"id":1212252,"iid":48,"group_id":9970,"title":"Next 1-3 releases","description":"Issues which are not quite ready to schedule, but should be considered as part of the near-term roadmap.","state":"active","created_at":"2020-03-26T20:39:10.889Z","updated_at":"2020-03-26T20:39:10.889Z","due_date":null,"start_date":null,"expired":false,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/48"},"assignees":[],"author":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"type":"ISSUE","assignee":null,"user_notes_count":11,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2691","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2691","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2691/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2691/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2691","relative":"#2691","full":"gitlab-org/gitaly#2691"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2307,"epic":{"id":15983,"iid":2307,"title":"🚜 Improve Gitaly data migration tools","url":"/groups/gitlab-org/-/epics/2307","group_id":9970,"human_readable_end_date":"Jul 17, 2022","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":33497489,"iid":2682,"project_id":2009901,"title":"Enable SQL leader election by default","description":"SQL leader election https://gitlab.com/gitlab-org/gitaly/-/issues/2547 is available, but is not enabled by default. SQL based leader election should be the default behavior, even if automatic failover is not enabled.\n\n## Proposal\n\nWhen not configured the default leader election strategy should be `sql`:\n\n```ruby\npraefect['failover_election_strategy'] = 'sql'\n```\n\n## Links / references","state":"closed","created_at":"2020-04-20T05:10:59.258Z","updated_at":"2020-07-17T11:16:53.303Z","closed_at":"2020-06-05T12:27:33.229Z","closed_by":{"id":3585,"username":"axil","name":"Achilleas Pipinellis","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3585/avatar.png","web_url":"https://gitlab.com/axil"},"labels":["Category:Gitaly","Deliverable","devops::create","group::gitaly","group::gitaly::cluster","missed-deliverable","missed:13.0","priority::3","workflow::in review"],"milestone":{"id":1112145,"iid":47,"group_id":9970,"title":"13.1","description":"","state":"closed","created_at":"2020-01-03T12:28:30.160Z","updated_at":"2020-10-08T12:01:07.361Z","due_date":"2020-06-17","start_date":"2020-05-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/47"},"assignees":[{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"}],"author":{"id":1187333,"username":"jramsay-gitlab","name":"James Ramsay (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1187333/avatar.png","web_url":"https://gitlab.com/jramsay-gitlab"},"type":"ISSUE","assignee":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"user_notes_count":8,"merge_requests_count":2,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2682","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2682","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2682/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2682/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2682","relative":"#2682","full":"gitlab-org/gitaly#2682"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1491,"epic":{"id":8450,"iid":1491,"title":"🌻 Improved Gitaly Cluster admin experience","url":"/groups/gitlab-org/-/epics/1491","group_id":9970,"human_readable_end_date":"Apr 22, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":"on_track"},{"id":33397034,"iid":2672,"project_id":2009901,"title":"Praefect behavior when replication jobs fail to persist","description":"Currently, Praefect will allow a proxied RPC to succeed even if the associated replication jobs fail to persist. We simply log any replication persisting error and it doesn't impact the success/fail message to the client. This is incorrect behavior. When Praefect proxies an RPC, it is promising the end user a number of things:\n\n- The RPC will be proxied to the primary.\n- The replication jobs from the primary to the secondaries will be scheduled.\n\nIf the replication jobs fail to be scheduled, we should fail the RPC since we did not satisfy the contract to the end user.","state":"closed","created_at":"2020-04-16T19:22:27.594Z","updated_at":"2020-07-18T07:06:53.612Z","closed_at":"2020-07-03T15:55:06.282Z","closed_by":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"labels":["Category:Gitaly","Deliverable","bug::availability","devops::create","group::gitaly","group::gitaly::cluster","priority::2","severity::4","type::bug","workflow::ready for development"],"milestone":{"id":1233746,"iid":49,"group_id":9970,"title":"13.2","description":"https://about.gitlab.com/releases/2020/07/22/gitlab-13-2-released/","state":"closed","created_at":"2020-04-09T17:28:01.032Z","updated_at":"2022-04-13T14:48:24.167Z","due_date":"2020-07-17","start_date":"2020-06-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/49"},"assignees":[{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"}],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"type":"ISSUE","assignee":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"user_notes_count":13,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2672","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2672","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2672/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2672/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2672","relative":"#2672","full":"gitlab-org/gitaly#2672"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null}]