[{"id":33319034,"iid":2664,"project_id":2009901,"title":"Include Praefect usage in the usage ping","description":"GitLab features a [Usage Ping](https://docs.gitlab.com/ee/user/admin_area/settings/usage_statistics.html#usage-ping-core-only), which sends a simple JSON to GitLab servers for us to track certain data from customers. For example, it shows the version of Git installed for internal analysis which is used to determine when and if we can deprecate Git versions.\n\n### Proposal\n\n- [x] Extend the usage ping to send data regarding Praefect usage\n- [x] Extend the version app that records the version ping, to accept this new parameter.","state":"closed","created_at":"2020-04-15T12:38:48.664Z","updated_at":"2020-06-29T04:39:03.985Z","closed_at":"2020-06-01T07:44:35.217Z","closed_by":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"labels":["Category:Gitaly","Deliverable","devops::create","group::gitaly","missed-deliverable","missed:13.0","workflow::in dev"],"milestone":{"id":1112145,"iid":47,"group_id":9970,"title":"13.1","description":"","state":"closed","created_at":"2020-01-03T12:28:30.160Z","updated_at":"2020-10-08T12:01:07.361Z","due_date":"2020-06-17","start_date":"2020-05-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/47"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"user_notes_count":8,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2664","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":2,"completed_count":2},"weight":3,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2664","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2664/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2664/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2664","relative":"#2664","full":"gitlab-org/gitaly#2664"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":3744,"epic":{"id":73949,"iid":3744,"title":"Create:Gitaly Instrumentation","url":"/groups/gitlab-org/-/epics/3744","group_id":9970,"human_readable_end_date":"May 17, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":33293341,"iid":2659,"project_id":2009901,"title":"Omnibus Praefect dashboard improvements from demo","description":"From the 2020-04-14 demo, we noticed the following potential improvements:\n\n- The table containing the latest known elected primary should also include the instance name (e.g. IP or hostname).\n- The replication queue size could be further broken down by Praefect instance and virtual storage.\n- Need a panel for the replication delay metric (`gitaly_praefect_replication_delay`).\n- Virtual storage flapping should use two labels (`{{instance}} {{gitaly_storage}}`)\n\nFrom the 2020-04-17 demo, we noticed we should also include:\n\n- A panel for the query `rate(grpc_server_handled_total{job=\"praefect\",grpc_code!=\"OK\"}[5m])`\n- A panel for the node up time: `gitaly_praefect_node_last_healthcheck_up`","state":"closed","created_at":"2020-04-15T01:06:05.551Z","updated_at":"2020-05-28T15:11:37.480Z","closed_at":"2020-05-19T16:14:38.610Z","closed_by":{"id":787914,"username":"ibaum","name":"Ian Baum","state":"active","avatar_url":"https://secure.gravatar.com/avatar/7c508dc85ddd5049564a95662311543b?s=80\u0026d=identicon","web_url":"https://gitlab.com/ibaum"},"labels":["Deliverable","Observability","demo","devops::create","group::gitaly","group::gitaly::cluster","priority::2","workflow::in review"],"milestone":{"id":991112,"iid":42,"group_id":9970,"title":"13.0","description":"","state":"closed","created_at":"2019-09-04T15:20:39.024Z","updated_at":"2020-10-08T12:00:55.725Z","due_date":"2020-05-17","start_date":"2020-04-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/42"},"assignees":[{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"}],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"type":"ISSUE","assignee":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"user_notes_count":3,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2659","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2659","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2659/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2659/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2659","relative":"#2659","full":"gitlab-org/gitaly#2659"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2658,"epic":{"id":20748,"iid":2658,"title":"🚀 Gitaly HA (generally available)","url":"/groups/gitlab-org/-/epics/2658","group_id":9970,"human_readable_end_date":"May 17, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":"on_track"},{"id":33252162,"iid":2653,"project_id":2009901,"title":"ReplicateRepository should create a bitmap when there's none","description":"ReplicateRepository is used in multiple cases, one of which is moving a repository across shards. In https://gitlab.com/gitlab-org/gitlab/commit/888ffdfa7f5dc3af5c1653d5064199027ac9be4a#dab876ea293e0f990ba0851665c089cfe2c7e0c5_92_99 @nick.thomas describes a good case where we should ensure that Gitaly writes bitmaps:\n\n\u003e\u003e\u003e\n    Run housekeeping after moving a repository between shards\n    \n    The current inter-shard move is implemented as a `git fetch` from the\n    original shard to an empty repository on the new shard. The repository\n    on the new shard lacks bitmaps, and may be less well packed, than the\n    repository on the old shard. This has a measurable performance impact.\n    \n    We may be changing from \"FetchInternalRemote\" to \"ReplicateRepository\"\n    in the future, but until then, forcing housekeeping to run is a good\n    performance optimisation - we trade off some short-term I/O load on the\n    new shard for better performance across a wide range of RPCs, including\n    an order-of-magnitude improvement in `IsAncestor`, which is the find\n    that motivated this change.\n\u003e\u003e\u003e\n\nThat change is behind a feature flag, part of closing this issue is removing the flag, and making sure we're using the ReplicateRepository RPC.","state":"closed","created_at":"2020-04-14T08:03:14.182Z","updated_at":"2020-05-12T07:13:36.034Z","closed_at":"2020-05-12T06:15:59.835Z","closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"labels":["Category:Gitaly","devops::create","group::gitaly","type::feature","workflow::in review"],"milestone":{"id":991112,"iid":42,"group_id":9970,"title":"13.0","description":"","state":"closed","created_at":"2019-09-04T15:20:39.024Z","updated_at":"2020-10-08T12:00:55.725Z","due_date":"2020-05-17","start_date":"2020-04-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/42"},"assignees":[{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"type":"ISSUE","assignee":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"},"user_notes_count":7,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2653","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2653","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2653/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2653/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2653","relative":"#2653","full":"gitlab-org/gitaly#2653"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2307,"epic":{"id":15983,"iid":2307,"title":"🚜 Improve Gitaly data migration tools","url":"/groups/gitlab-org/-/epics/2307","group_id":9970,"human_readable_end_date":"Jul 17, 2022","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":33235781,"iid":2650,"project_id":2009901,"title":"Horizontal scaling of a single shard MVC","description":"## Problem to solve\n\nWhen hundreds of developers are working on a mono repo (perhaps 5GB), it is possible to saturate a single server with reads and writes. CI servers add to this load. There is no way to horizontally scale reads without NFS today.\n\n## Further details\n\nThe current workaround for this is:\n\n- install a load balancer between GitLab and a Gitaly storage\n- the load balancer should distribute reads and writes across all many Gitaly nodes\n- Gitaly nodes are kept in sync by a shared NFS volume that is mounted to each Gitaly nodes\n\nThis relies on NFS to keep all nodes completely consistent.\n\n## Proposal\n\nWhen using Praefect for Gitaly HA, each repository is replicated some number of times. Only the primary node services reads.\n\nUsing the Praefect tracking database:\n\n- randomly distributes reads to any node where the replication queue is empty for that repository.\n\n![praefect-distribute-reads](/uploads/da214c773640e33de80060b63c364d3e/praefect-distribute-reads.png)\n\n## Links / references","state":"closed","created_at":"2020-04-14T00:20:22.486Z","updated_at":"2020-11-18T21:48:13.679Z","closed_at":"2020-05-18T16:01:12.727Z","closed_by":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"labels":["Deliverable","bug::performance","devops::create","direction","group::gitaly","group::gitaly::cluster","type::feature","workflow::ready for development"],"milestone":{"id":991112,"iid":42,"group_id":9970,"title":"13.0","description":"","state":"closed","created_at":"2019-09-04T15:20:39.024Z","updated_at":"2020-10-08T12:00:55.725Z","due_date":"2020-05-17","start_date":"2020-04-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/42"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"}],"author":{"id":1187333,"username":"jramsay-gitlab","name":"James Ramsay (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1187333/avatar.png","web_url":"https://gitlab.com/jramsay-gitlab"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"user_notes_count":6,"merge_requests_count":1,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2650","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2650","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2650/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2650/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2650","relative":"#2650","full":"gitlab-org/gitaly#2650"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2013,"epic":{"id":13406,"iid":2013,"title":"🌿 Gitaly Cluster: Distribute Git read operations across Gitaly nodes","url":"/groups/gitlab-org/-/epics/2013","group_id":9970,"human_readable_end_date":"Mar 17, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":33100397,"iid":2642,"project_id":2009901,"title":"Smarter Praefect election process","description":"## Problem to solve\n\nRight now our primary election process in Praefect treats all Gitaly nodes that are up as possible candidates for election. However, what happens if a secondary fails replication or becomes out of sync? We need to consider marking the Gitaly node as \"unelectable\" and taking it out of the rotation. \n\n## Further Details\n\nWe probably need to consider a number of inputs:\n\n1. Are there any jobs left in the replication queue? If there is a node that is up that has an empty queue, we'd prefer that one over another one.\n1. Failure rates of the replication queue: If a node is unable to sync with the current primary for a number of repositories, that is indicative that something went out of sync, and we may need to do a repair.\n\nIdeas for consideration:\n\n1. During the election process, sort nodes by descending number of outstanding jobs.\n1. Track a metric of the `FetchInternalRemote` and/or `ReplicateRepository` RPCs in Praefect\n\n## Proposal\n\nWhen promoting a secondary to a new primary, use the Gitaly node with least pending replication jobs.\n\n## Links / references","state":"closed","created_at":"2020-04-09T13:39:06.670Z","updated_at":"2020-05-18T07:08:34.634Z","closed_at":"2020-04-30T16:04:16.390Z","closed_by":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"},"labels":["Deliverable","devops::create","group::gitaly","group::gitaly::cluster","priority::2","type::feature","workflow::in dev"],"milestone":{"id":991112,"iid":42,"group_id":9970,"title":"13.0","description":"","state":"closed","created_at":"2019-09-04T15:20:39.024Z","updated_at":"2020-10-08T12:00:55.725Z","due_date":"2020-05-17","start_date":"2020-04-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/42"},"assignees":[{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"}],"author":{"id":64248,"username":"stanhu","name":"Stan Hu","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/64248/stanhu.jpg","web_url":"https://gitlab.com/stanhu"},"type":"ISSUE","assignee":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"},"user_notes_count":6,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2642","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2642","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2642/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2642/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2642","relative":"#2642","full":"gitlab-org/gitaly#2642"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2658,"epic":{"id":20748,"iid":2658,"title":"🚀 Gitaly HA (generally available)","url":"/groups/gitlab-org/-/epics/2658","group_id":9970,"human_readable_end_date":"May 17, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":33025854,"iid":2635,"project_id":2009901,"title":"2PC via pre-receive hook","description":"As a result of the experiments in #2466 and #2529, we have concluded that the most promising way to implement strong consistency for reference updates is by going via Git hooks: given a reference update, a hook will execute on each Gitaly node that reports back to Praefect. Praefect will collect these reports from all Gitaly nodes that take part in the current update and, if all nodes post the same update, send them a message to go ahead.\n\nWhile the mid-term goal is to hook directly into the reference transaction handling code in order to handle all kinds of reference updates and not only those invoked via git-receive-pack(1), this requires a new set of hooks on Git's side. We thus decided to implement a first POC of this mechanism by using the Git pre-receive hook, which executes after all reference updates have been announced by the Git client. This should give us a better picture of how the mechanism will work in the end.\n\nThe following diagram depicts the 3PC via a pre-receive hook:\n\n```mermaid\nsequenceDiagram\n  Praefect-\u003e\u003e+Gitaly: ReceivePack\n  Gitaly-\u003e\u003e+Git: git receive-pack\n  Git-\u003e\u003e+Hook: update HEAD master\n  Hook-\u003e\u003e+Gitaly: TX: update HEAD master\n  Gitaly-\u003e\u003e+Praefect: TX: update HEAD master\n  Praefect-\u003e\u003e+Praefect: TX: collect votes\n  Praefect-\u003e\u003e+Gitaly: TX: commit\n  Gitaly-\u003e\u003e+Hook: TX: commit\n  Hook-\u003e\u003e+Git: exit 0\n  Git-\u003e\u003e+Gitaly: exit 0\n  Gitaly-\u003e\u003e+Praefect: success\n```\n\nThe 2PC voting protocol will start as soon as a first \"TX\" message is received on the Praefect node. Each of the pre-receive hooks will block until it receives a message from Praefect telling to to either go on with the update or to abort. In case the vote was successful, the hook will exit with `0` to indicate success, otherwise it will return an error code and thus abort the reference update.\n\nThe main goal of this issue is to establish a communication channel between hook and Praefect to allow for transaction handling. The communication channel should be implemented transparent to Gitaly nodes as much as possible so that Gitaly does not need to know if and how many transactions a given Git transaction is going to start. This ensures we can swap out the hooks in the future and start multiple transactions for a single Git command.","state":"closed","created_at":"2020-04-08T08:11:56.928Z","updated_at":"2020-05-22T00:12:32.601Z","closed_at":"2020-05-21T23:31:03.780Z","closed_by":{"id":1187333,"username":"jramsay-gitlab","name":"James Ramsay (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1187333/avatar.png","web_url":"https://gitlab.com/jramsay-gitlab"},"labels":["Category:Gitaly","Deliverable","devops::create","direction","group::gitaly","type::feature","workflow::in review"],"milestone":{"id":991112,"iid":42,"group_id":9970,"title":"13.0","description":"","state":"closed","created_at":"2019-09-04T15:20:39.024Z","updated_at":"2020-10-08T12:00:55.725Z","due_date":"2020-05-17","start_date":"2020-04-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/42"},"assignees":[{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"}],"author":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"type":"ISSUE","assignee":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"user_notes_count":7,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2635","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":7,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2635","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2635/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2635/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2635","relative":"#2635","full":"gitlab-org/gitaly#2635"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1189,"epic":{"id":5989,"iid":1189,"title":"Gitaly Cluster: strong consistency","url":"/groups/gitlab-org/-/epics/1189","group_id":9970,"human_readable_end_date":"Sep 17, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":"on_track"},{"id":33016702,"iid":2634,"project_id":2009901,"title":"Remove primary in praefect config once SQL election is merged and the default","description":"SQL leader election has now been merged https://gitlab.com/gitlab-org/gitaly/-/issues/2547, meaning we no longer need the idea of a \"default\" primary in the config.\n\nWe should remove this in:\n\n- [x] Praefect example config toml in gitaly\n- [x] GDK\n- [ ] Omnibus\n- [x] Gitaly Cluster admin docs","state":"closed","created_at":"2020-04-08T00:35:00.797Z","updated_at":"2021-01-07T16:07:13.447Z","closed_at":"2020-09-22T22:17:59.940Z","closed_by":{"id":787914,"username":"ibaum","name":"Ian Baum","state":"active","avatar_url":"https://secure.gravatar.com/avatar/7c508dc85ddd5049564a95662311543b?s=80\u0026d=identicon","web_url":"https://gitlab.com/ibaum"},"labels":["Category:Gitaly","Deliverable","devops::create","group::gitaly","group::gitaly::cluster","missed-deliverable","missed:13.4","section::dev","workflow::in dev"],"milestone":{"id":1233754,"iid":52,"group_id":9970,"title":"13.5","description":"https://about.gitlab.com/releases/2020/10/22/gitlab-13-5-released/","state":"closed","created_at":"2020-04-09T17:39:21.990Z","updated_at":"2022-04-21T07:21:12.213Z","due_date":"2020-10-17","start_date":"2020-09-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/52"},"assignees":[{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"}],"author":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"},"type":"ISSUE","assignee":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"user_notes_count":5,"merge_requests_count":2,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2634","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":4,"completed_count":3},"weight":2,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2634","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2634/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2634/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2634","relative":"#2634","full":"gitlab-org/gitaly#2634"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1491,"epic":{"id":8450,"iid":1491,"title":"🌻 Improved Gitaly Cluster admin experience","url":"/groups/gitlab-org/-/epics/1491","group_id":9970,"human_readable_end_date":"Apr 22, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":32979230,"iid":2630,"project_id":2009901,"title":"Option for failover to put out-of-date repositories in read-only mode","description":"## Problem to solve\n\nPraefect has a failover mechanism, where if it detects that a Gitaly node is unresponsive, it will promote a secondary storage server to primary. If this secondary server could be missing data still from the old primary. This in itself would allow Gitaly to serve stale data. However, after serveral mutations on the repository, it could end up in a state where data-loss occurs. As such, the current implementation is great for demo's, or instances where velocity is more important than data integrity. The current approach will not work for gitlab.com\n\n## Solution\n\nIn \u003cissue link\u003e we're working on reporting of potential data loss, this issue proposes the next iteration of it; putting each of those repositories in a read only state, until manual intervention from an admin to mark it operational again. Allowing all administrators to use the current failover mechanism, and resolve data integrety issues manually.  \n\n\n### Additional benefits\n\nWhen moving a repository on a shard, it's put in read only mode for a brief period of time. This is a loosely defined contract right now. Having a praefect managed read only mode for repositories put stronger data integrity.\n\nThis approach could remove the need for https://gitlab.com/gitlab-org/gitaly/-/issues/2601","state":"closed","created_at":"2020-04-07T09:24:40.375Z","updated_at":"2020-06-11T05:46:32.837Z","closed_at":"2020-05-12T11:36:20.936Z","closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"labels":["Category:Gitaly","devops::create","group::gitaly","group::gitaly::cluster","priority::1","type::feature","workflow::in dev"],"milestone":{"id":991112,"iid":42,"group_id":9970,"title":"13.0","description":"","state":"closed","created_at":"2019-09-04T15:20:39.024Z","updated_at":"2020-10-08T12:00:55.725Z","due_date":"2020-05-17","start_date":"2020-04-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/42"},"assignees":[{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5522960/avatar.png","web_url":"https://gitlab.com/samihiltunen"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"type":"ISSUE","assignee":{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5522960/avatar.png","web_url":"https://gitlab.com/samihiltunen"},"user_notes_count":6,"merge_requests_count":2,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2630","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":5,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2630","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2630/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2630/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2630","relative":"#2630","full":"gitlab-org/gitaly#2630"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2658,"epic":{"id":20748,"iid":2658,"title":"🚀 Gitaly HA (generally available)","url":"/groups/gitlab-org/-/epics/2658","group_id":9970,"human_readable_end_date":"May 17, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":32967456,"iid":2627,"project_id":2009901,"title":"Stale packed-refs.new files prevents branches from being deleted","description":"We saw in https://gitlab.com/gitlab-org/gitlab/-/issues/213620#note_318864514, that somehow the `gitlab-org/gitlab` repository had a stale/aborted `packed-refs.new` file that prevented branches from being deleted inside the `MergeRequestWorker`, causing that worker to retry 4 times unnecessarily:\n\n```\nroot@file-cny-01-stor-gprd.c.gitlab-production.internal:/var/log/gitlab/gitlab-rails# sudo ls -al /var/opt/gitlab/git-data/repositories/@hashed/a6/80/a68072e80f075e89bc74a300101a9e71e8363bdb542182580162553462480a52.git\ntotal 34168\ndrwxr-s---   7 git root     4096 Apr  7 02:50 .\ndrwxr-s---   5 git root     4096 Dec 12 09:21 ..\n-rw-r--r--   1 git root      409 Apr  7 00:05 config\n-rw-r--r--   1 git root       73 Dec 12 09:17 description\n-rw-r--r--   1 git root   156636 Apr  7 02:54 FETCH_HEAD\ndrwxr-sr-x   2 git root     4096 Apr  7 00:05 gitlab-worktree\n-rw-r--r--   1 git root       23 Feb  5 07:35 HEAD\ndrwxr-sr-x   2 git root     4096 Dec 12 09:17 hooks\ndrwxr-sr-x   2 git root     4096 Apr  7 02:54 info\n-rw-r--r--   1 git root   301751 Apr  7 02:13 language-stats.cache\ndrwxr-sr-x 260 git root     4096 Apr  7 02:56 objects\n-rw-r--r--   1 git root 30427806 Apr  6 11:07 packed-refs\n-rw-r--r--   1 git root  4055040 Apr  6 11:08 packed-refs.new\ndrwxr-sr-x  11 git root     4096 Dec 12 09:21 refs\nroot@file-cny-01-stor-gprd.c.gitlab-production.internal:/var/log/gitlab/gitlab-rails# date\nTue Apr  7 02:56:39 UTC 2020\n```\n\nAttached are the files:\n\n[packed-refs.tar.gz](/uploads/d12f6d32ef38a805943bff296b25a722/packed-refs.tar.gz)\n\nIt almost looks like the writes to `packed-refs.new` got aborted at 11:08:\n\n![image](/uploads/4e1d6697a1c911a5e0963dab6ed7a7b4/image.png)\n\nFew questions/issues:\n\n1. What left this `packed-refs.new` around? I presume it was a `git pack-refs`. I see a `PackRefs` RPC that completed successfully at 11:05: https://log.gprd.gitlab.net/goto/b30757c2d0feb12c7ea3dd7590d93760 \n1. Should we run `Cleanup()` on stale `packed-refs.new` files?\n1. https://gitlab.com/gitlab-org/gitlab/-/issues/213620: `MergeRequestWorker` should be idempotent here: why did the deletion of the branch cause duplicate merge commits? \n1. These error messages only went to `githost.log`: https://gitlab.com/gitlab-org/gitaly/blob/981ff509c05475c65480f11c92101f0a4d5f5158/ruby/lib/gitlab/git/operation_service.rb#L209. Can we just port this RPC to Go and use structured logging here?","state":"closed","created_at":"2020-04-07T03:51:13.467Z","updated_at":"2020-05-25T03:13:33.327Z","closed_at":"2020-05-25T02:22:50.371Z","closed_by":{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/228150/avatar.png","web_url":"https://gitlab.com/proglottis"},"labels":["Category:Gitaly","devops::create","group::gitaly","priority::2","severity::2","type::bug"],"milestone":{"id":1112145,"iid":47,"group_id":9970,"title":"13.1","description":"","state":"closed","created_at":"2020-01-03T12:28:30.160Z","updated_at":"2020-10-08T12:01:07.361Z","due_date":"2020-06-17","start_date":"2020-05-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/47"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"}],"author":{"id":64248,"username":"stanhu","name":"Stan Hu","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/64248/stanhu.jpg","web_url":"https://gitlab.com/stanhu"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"user_notes_count":6,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2627","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2627","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2627/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2627/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2627","relative":"#2627","full":"gitlab-org/gitaly#2627"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":32951949,"iid":2626,"project_id":2009901,"title":"Documentation: two sources of truth for GL_REPOSITORY","description":"When receiving a git push, Gitaly will make HTTP callbacks to gitlab-rails. This is done via the Git `pre-receive` and `post-receive` hooks.\n\nIn these callbacks, Gitaly must tell gitlab-rails what repo the hooks are running in. We use an opaque token called GL_REPOSITORY for this. This token comes in as an RPC request field, and gets handed down into the Git hook via an environment variable on the `git receive-pack` process.\n\nThere are three groups of RPC's where we need GL_REPOSITORY to make callback requests:\n\n- SSHService.SSHReceivePack (git push via SSH)\n- SmartHTTPService.PostReceivePack (git push via HTTP)\n- OperationsService.UserCommitfiles, OperationsService.UserMergeBranch, etc. (RPC's that modify a repo on while impersonating a user)\n\nIn the case of OperationsService, we always pass GL_REPOSITORY [via the Repository protobuf message](https://gitlab.com/gitlab-org/gitaly/-/blob/dca26f3a6d09e3cea5d05373bd2c35ddc03c05c8/proto/shared.proto#L42).\n\nIn the case of SSHReceivePack and PostReceivePack, however, we have a confusing situation. These RPC's were implemented before we had a GL_REPOSITORY field on the Repository message. What we do there instead is that we explicitly pass in the value via the request message ([example 1](https://gitlab.com/gitlab-org/gitaly/-/blob/master/proto/smarthttp.proto#L82)) and [example 2](https://gitlab.com/gitlab-org/gitaly/-/blob/master/proto/ssh.proto#L66)).\n\nThe purpose of this issue is to discuss if this is a problem or not, and if so, what we want to do about it.","state":"closed","created_at":"2020-04-06T16:34:21.400Z","updated_at":"2020-04-30T19:11:15.820Z","closed_at":"2020-04-30T18:39:45.470Z","closed_by":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"},"labels":["Category:Gitaly","devops::create","documentation","group::gitaly","missed:12.10","workflow::ready for development"],"milestone":{"id":991112,"iid":42,"group_id":9970,"title":"13.0","description":"","state":"closed","created_at":"2019-09-04T15:20:39.024Z","updated_at":"2020-10-08T12:00:55.725Z","due_date":"2020-05-17","start_date":"2020-04-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/42"},"assignees":[{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"}],"author":{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/513969/avatar.png","web_url":"https://gitlab.com/jacobvosmaer-gitlab"},"type":"ISSUE","assignee":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"},"user_notes_count":5,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2626","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2626","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2626/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2626/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2626","relative":"#2626","full":"gitlab-org/gitaly#2626"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":32839108,"iid":2620,"project_id":2009901,"title":"Praefect gRPC logs should not be visible when running subcommands","description":"The Praefect gRPC logs are appearing in the terminal when running subcommands. This is a regression and not desirable since it makes too much noise.","state":"closed","created_at":"2020-04-03T15:28:33.762Z","updated_at":"2020-04-20T00:25:02.066Z","closed_at":"2020-04-15T01:55:47.144Z","closed_by":{"id":1187333,"username":"jramsay-gitlab","name":"James Ramsay (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1187333/avatar.png","web_url":"https://gitlab.com/jramsay-gitlab"},"labels":["[deprecated] Accepting merge requests","demo","devops::create","group::gitaly","group::gitaly::cluster","priority::3","severity::3","type::bug"],"milestone":null,"assignees":[],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"type":"ISSUE","assignee":null,"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2620","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2620","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2620/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2620/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":"https://gitlab.com/api/v4/projects/2009901/issues/2500"},"references":{"short":"#2620","relative":"#2620","full":"gitlab-org/gitaly#2620"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2658,"epic":{"id":20748,"iid":2658,"title":"🚀 Gitaly HA (generally available)","url":"/groups/gitlab-org/-/epics/2658","group_id":9970,"human_readable_end_date":"May 17, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":32804854,"iid":2618,"project_id":2009901,"title":"Automatically clean up after moving a project to a different shard","description":"## Problem to solve\n\nMoving a project from one shard to another leaves behind the repo on the original shard, and it isn't cleaned up automatically. This means manual work is required to reclaim space\n\n## Proposal\n\nIf a project is moved to a new shard successfully, the space should be reclaimed on the old shard by deleting the repo\n\n## Links / references","state":"closed","created_at":"2020-04-02T23:50:00.882Z","updated_at":"2020-08-19T08:53:24.065Z","closed_at":"2020-08-19T08:53:24.030Z","closed_by":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"labels":["Category:Gitaly","Deliverable","devops::create","feature flag","group::gitaly","missed-deliverable","missed:13.0","missed:13.1","missed:13.2","workflow::in dev"],"milestone":{"id":1233752,"iid":50,"group_id":9970,"title":"13.3","description":"https://about.gitlab.com/releases/2020/08/22/gitlab-13-3-released/","state":"closed","created_at":"2020-04-09T17:39:21.090Z","updated_at":"2022-04-13T14:50:18.976Z","due_date":"2020-08-17","start_date":"2020-07-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/50"},"assignees":[{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/228150/avatar.png","web_url":"https://gitlab.com/proglottis"}],"author":{"id":1187333,"username":"jramsay-gitlab","name":"James Ramsay (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1187333/avatar.png","web_url":"https://gitlab.com/jramsay-gitlab"},"type":"ISSUE","assignee":{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/228150/avatar.png","web_url":"https://gitlab.com/proglottis"},"user_notes_count":12,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2618","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2618","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2618/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2618/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2618","relative":"#2618","full":"gitlab-org/gitaly#2618"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2307,"epic":{"id":15983,"iid":2307,"title":"🚜 Improve Gitaly data migration tools","url":"/groups/gitlab-org/-/epics/2307","group_id":9970,"human_readable_end_date":"Jul 17, 2022","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":32791485,"iid":2615,"project_id":2009901,"title":"Praefect: Enable database replication queue by default","description":"As of now by default Praefect uses in-memory implementation of the replication queue.  \nThis can be switched to Postgres implementation by providing configuration parameter [`postgres_queue_enabled`](https://gitlab.com/gitlab-org/gitaly/-/blob/cc314adf47d3eed96d824f35ae601e891e2e70e2/internal/praefect/config/config.go#L33) with value `true`.\nOnce Postgres implementation tested enough this parameter must be removed and Postgres implementation must become default.\n\n/cc @zj-gitlab @jramsay","state":"closed","created_at":"2020-04-02T15:44:34.984Z","updated_at":"2020-05-28T08:08:42.126Z","closed_at":"2020-05-20T17:49:23.170Z","closed_by":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"labels":["Category:Gitaly","Deliverable","devops::create","group::gitaly","group::gitaly::cluster","priority::3","workflow::in dev"],"milestone":{"id":991112,"iid":42,"group_id":9970,"title":"13.0","description":"","state":"closed","created_at":"2019-09-04T15:20:39.024Z","updated_at":"2020-10-08T12:00:55.725Z","due_date":"2020-05-17","start_date":"2020-04-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/42"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"}],"author":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"user_notes_count":3,"merge_requests_count":1,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2615","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2615","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2615/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2615/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2615","relative":"#2615","full":"gitlab-org/gitaly#2615"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1491,"epic":{"id":8450,"iid":1491,"title":"🌻 Improved Gitaly Cluster admin experience","url":"/groups/gitlab-org/-/epics/1491","group_id":9970,"human_readable_end_date":"Apr 22, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":32783997,"iid":2613,"project_id":2009901,"title":"Praefect: same storage name can't be used for different virtual storages","description":"If you have setup with multiple virtual storages and each storage has node with name `node-1` only one node will be used for processing.  \nAnother node will be treated as duplicate and skipped, [here is the code](https://gitlab.com/gitlab-org/gitaly/-/blob/19fd0676954fd87cee2f0108efd3caaf20c5c266/internal/praefect/datastore/datastore.go#L168-170).\n\nExpected: all nodes must be bound to proper virtual storage so all operations can be routed properly.\n\n/cc @zj-gitlab @jramsay","state":"closed","created_at":"2020-04-02T13:47:46.967Z","updated_at":"2020-06-18T07:07:28.137Z","closed_at":"2020-05-29T11:47:16.467Z","closed_by":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"labels":["Category:Gitaly","Deliverable","devops::create","group::gitaly","group::gitaly::cluster","missed-deliverable","missed:13.0","priority::3","severity::3","type::bug","workflow::ready for development"],"milestone":{"id":1112145,"iid":47,"group_id":9970,"title":"13.1","description":"","state":"closed","created_at":"2020-01-03T12:28:30.160Z","updated_at":"2020-10-08T12:01:07.361Z","due_date":"2020-06-17","start_date":"2020-05-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/47"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"}],"author":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"user_notes_count":2,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2613","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2613","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2613/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2613/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2613","relative":"#2613","full":"gitlab-org/gitaly#2613"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1491,"epic":{"id":8450,"iid":1491,"title":"🌻 Improved Gitaly Cluster admin experience","url":"/groups/gitlab-org/-/epics/1491","group_id":9970,"human_readable_end_date":"Apr 22, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":"on_track"},{"id":32774722,"iid":2611,"project_id":2009901,"title":"WalkRepos should handle a directory being deleted during file walking","description":"[`service/internalgitaly.WalkRepos`](https://gitlab.com/gitlab-org/gitaly/-/blob/f3f4ae8bc2945b8363835e6c6862a7044311aa9e/internal/service/internalgitaly/walkrepos.go#L36) should handle a possible `not exists` errors. This can happen if a repository is deleted by another RPC during the file walk.","state":"closed","created_at":"2020-04-02T10:00:00.043Z","updated_at":"2020-04-23T16:15:15.337Z","closed_at":"2020-04-23T15:22:23.842Z","closed_by":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"labels":["Category:Gitaly","Gitaly","devops::create","group::gitaly","priority::3","severity::2","type::bug","workflow::ready for development"],"milestone":{"id":991112,"iid":42,"group_id":9970,"title":"13.0","description":"","state":"closed","created_at":"2019-09-04T15:20:39.024Z","updated_at":"2020-10-08T12:00:55.725Z","due_date":"2020-05-17","start_date":"2020-04-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/42"},"assignees":[{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5522960/avatar.png","web_url":"https://gitlab.com/samihiltunen"}],"author":{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5522960/avatar.png","web_url":"https://gitlab.com/samihiltunen"},"type":"ISSUE","assignee":{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5522960/avatar.png","web_url":"https://gitlab.com/samihiltunen"},"user_notes_count":3,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2611","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2611","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2611/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2611/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2611","relative":"#2611","full":"gitlab-org/gitaly#2611"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":32760295,"iid":2608,"project_id":2009901,"title":"Detect node failure by read/write failures","description":"### Problem to solve\n\nHealth checks can often succeed even if there is a problem with the server, Gitaly or Git. For example, the Gitaly process may be running just fine and respond with a healthy signal even though the persistent disk is not available which would prevent any Git operation from succeeding.\n\n### Further details\n\nHealth checks are relatively slow to detect failures (seconds), and are performed less frequently to the total number of Git operations. For example, a busy Gitaly node may be handle hundreds of requests per second (get commit, get file, list something etc). If multiple health checks must fail before failover, this means thousands of operations have failed before the system notices a failure.\n\n### Proposal\n\nPraefect should monitor Gitaly RPC success/failures and mark a node as bad if there multiple failues in a row. For example, if 5 or 10 RPCs fail in a row, this is a strong signal that the node isn't working.\n\nWorst case scenario we fail over to an up to date replica because strong consistency means we always have an up to date replica https://gitlab.com/groups/gitlab-org/-/epics/1189.\n\n### Testing\n\nFunctional end-to-end coverage will be provided by a new [failover test](https://gitlab.com/gitlab-org/quality/testcases/-/issues/836). And broad coverage by [running the entire end-to-end test suite against environments using Praefect for storage](https://gitlab.com/gitlab-org/gitlab-qa/-/blob/master/docs/what_tests_can_be_run.md#testintegrationpraefect-ceeefull-image-address) (including Staging).\n\nPerformance end-to-end testing will be implemented as part of https://gitlab.com/gitlab-org/quality/performance/-/issues/231 (see https://gitlab.com/gitlab-org/quality/team-tasks/-/issues/451 for a more detailed plan of performance tests under failure conditions).\n\n### Links / references","state":"closed","created_at":"2020-04-02T00:06:14.058Z","updated_at":"2021-07-29T17:26:30.259Z","closed_at":"2020-09-01T10:46:52.978Z","closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"labels":["Category:Gitaly","Deliverable","devops::create","group::gitaly","group::gitaly::cluster","missed-deliverable","missed:13.1","missed:13.2","quad-planning::complete-action","type::feature","workflow::in review"],"milestone":{"id":1233753,"iid":51,"group_id":9970,"title":"13.4","description":"https://about.gitlab.com/releases/2020/09/22/gitlab-13-4-released/","state":"closed","created_at":"2020-04-09T17:39:21.662Z","updated_at":"2022-04-13T14:50:33.769Z","due_date":"2020-09-17","start_date":"2020-08-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/51"},"assignees":[{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5522960/avatar.png","web_url":"https://gitlab.com/samihiltunen"}],"author":{"id":1187333,"username":"jramsay-gitlab","name":"James Ramsay (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1187333/avatar.png","web_url":"https://gitlab.com/jramsay-gitlab"},"type":"ISSUE","assignee":{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5522960/avatar.png","web_url":"https://gitlab.com/samihiltunen"},"user_notes_count":16,"merge_requests_count":2,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2608","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":1,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2608","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2608/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2608/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2608","relative":"#2608","full":"gitlab-org/gitaly#2608"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2983,"epic":{"id":36565,"iid":2983,"title":"🦄 HA Gitaly: improved availability","url":"/groups/gitlab-org/-/epics/2983","group_id":9970,"human_readable_end_date":"Jan 17, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":32409342,"iid":2580,"project_id":2009901,"title":"Expose node level metrics even if automatic failover is disabled","description":"Currently, node metrics such as `gitaly_praefect_primaries` and `gitaly_praefect_node_latency` get populated when `failover_enabled = true`. We should populate these metrics regardless.\n\nThis involves refactoring the node manager so that it does healthchecks on the nodes even if `failover_enabled = false`.\n\nHere is where we start the health checks: https://gitlab.com/gitlab-org/gitaly/-/blob/master/internal/praefect/nodes/manager.go#L164\n\nThe easiest way is to probably prevent node promotion with `failoverEnabled` in https://gitlab.com/gitlab-org/gitaly/-/blob/master/internal/praefect/nodes/manager.go#L164","state":"closed","created_at":"2020-03-24T23:01:08.037Z","updated_at":"2020-07-18T07:06:53.647Z","closed_at":"2020-07-10T06:09:22.726Z","closed_by":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"labels":["Category:Gitaly","Deliverable","demo","devops::create","group::gitaly","group::gitaly::cluster","missed-deliverable","missed:13.0","missed:13.1","workflow::ready for development"],"milestone":{"id":1233746,"iid":49,"group_id":9970,"title":"13.2","description":"https://about.gitlab.com/releases/2020/07/22/gitlab-13-2-released/","state":"closed","created_at":"2020-04-09T17:28:01.032Z","updated_at":"2022-04-13T14:48:24.167Z","due_date":"2020-07-17","start_date":"2020-06-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/49"},"assignees":[{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/228150/avatar.png","web_url":"https://gitlab.com/proglottis"}],"author":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"},"type":"ISSUE","assignee":{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/228150/avatar.png","web_url":"https://gitlab.com/proglottis"},"user_notes_count":6,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2580","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2580","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2580/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2580/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2580","relative":"#2580","full":"gitlab-org/gitaly#2580"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1491,"epic":{"id":8450,"iid":1491,"title":"🌻 Improved Gitaly Cluster admin experience","url":"/groups/gitlab-org/-/epics/1491","group_id":9970,"human_readable_end_date":"Apr 22, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":"on_track"},{"id":32242603,"iid":2563,"project_id":2009901,"title":"On startup, Praefect can't talk to gitaly nodes before it picks up replication jobs","description":"During our demo on 3/20/20, we observed that when praefect is brought up when the sql replication queue has jobs in `ready`, praefect picks up the jobs immediately and tries to replicate, but failed because it couldn't talk to gitaly.\n\nTo reproduce:\n\n1. bring praefect down\n1. create replication jobs on the sql database\n1. bring praefect up\n\nin the logs, praefect will complain that it cannot talk to gitaly, and the jobs will fail.","state":"closed","created_at":"2020-03-20T16:40:59.315Z","updated_at":"2020-05-05T17:14:38.013Z","closed_at":"2020-05-05T16:15:55.749Z","closed_by":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"},"labels":["Category:Gitaly","auto updated","devops::create","group::gitaly","type::bug","workflow::ready for development"],"milestone":{"id":991112,"iid":42,"group_id":9970,"title":"13.0","description":"","state":"closed","created_at":"2019-09-04T15:20:39.024Z","updated_at":"2020-10-08T12:00:55.725Z","due_date":"2020-05-17","start_date":"2020-04-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/42"},"assignees":[{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"}],"author":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"},"type":"ISSUE","assignee":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"},"user_notes_count":6,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2563","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2563","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2563/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2563/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2563","relative":"#2563","full":"gitlab-org/gitaly#2563"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":32212850,"iid":2559,"project_id":2009901,"title":"Drop Golang 1.12 support","description":"With the release of Go 1.14, the support stops for Go 1.13 as per the Golang policy to support the last two releases. This means that Gitaly now supports being compiled by an unsupported Golang version.\n\nAction items:\n- [x] Remove Go 1.12 from our Pipeline\n- [ ] Remove Go 1.12 from the docs at this project, and GitLab","state":"closed","created_at":"2020-03-20T07:59:26.937Z","updated_at":"2021-03-05T22:27:37.833Z","closed_at":"2020-04-06T14:00:29.102Z","closed_by":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"labels":["Category:Gitaly","[deprecated] Accepting merge requests","auto updated","backstage [DEPRECATED]","devops::create","group::gitaly","workflow::production"],"milestone":{"id":1104429,"iid":46,"group_id":9970,"title":"12.10","description":"https://about.gitlab.com/releases/2020/04/22/gitlab-12-10-released","state":"closed","created_at":"2019-12-20T15:15:53.243Z","updated_at":"2020-10-08T12:00:39.852Z","due_date":"2020-04-17","start_date":"2020-03-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/46"},"assignees":[],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"type":"ISSUE","assignee":null,"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2559","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":2,"completed_count":1},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2559","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2559/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2559/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2559","relative":"#2559","full":"gitlab-org/gitaly#2559"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":5153,"epic":{"id":177675,"iid":5153,"title":"Upgrade Go to 1.14.x","url":"/groups/gitlab-org/-/epics/5153","group_id":9970,"human_readable_end_date":"Feb 24, 2021","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":32114771,"iid":2553,"project_id":2009901,"title":"Enable partial clone with blob size filter by default","description":"## Problem to solve\n\nOnce it is possible to enable blob and sparsity filters independently, we should enable blob filters by default since they are low risk and make it easy for customers to try out partial clone.\n\n## Proposal\n\nCurrently we have one feature flag `gitaly_upload_pack_filter` to control both blob and sparsity filters.\n\n- reuse the existing feature flag `gitaly_upload_pack_filter` for blob filters, and default to enabled\n- create a new feature flag `gitaly_upload_pack_filter_sparsity` for sparsity filters, and default to false\n\n## Links/references","state":"closed","created_at":"2020-03-18T04:00:41.679Z","updated_at":"2020-05-18T07:08:34.703Z","closed_at":"2020-05-05T10:05:40.790Z","closed_by":{"id":138401,"username":"chriscool","name":"Christian Couder","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/138401/avatar.png","web_url":"https://gitlab.com/chriscool"},"labels":["Category:Gitaly","Deliverable","devops::create","direction","group::gitaly","missed-deliverable","missed:12.10","workflow::ready for development"],"milestone":{"id":991112,"iid":42,"group_id":9970,"title":"13.0","description":"","state":"closed","created_at":"2019-09-04T15:20:39.024Z","updated_at":"2020-10-08T12:00:55.725Z","due_date":"2020-05-17","start_date":"2020-04-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/42"},"assignees":[{"id":138401,"username":"chriscool","name":"Christian Couder","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/138401/avatar.png","web_url":"https://gitlab.com/chriscool"}],"author":{"id":1187333,"username":"jramsay-gitlab","name":"James Ramsay (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1187333/avatar.png","web_url":"https://gitlab.com/jramsay-gitlab"},"type":"ISSUE","assignee":{"id":138401,"username":"chriscool","name":"Christian Couder","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/138401/avatar.png","web_url":"https://gitlab.com/chriscool"},"user_notes_count":5,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2553","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2553","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2553/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2553/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2553","relative":"#2553","full":"gitlab-org/gitaly#2553"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":958,"epic":{"id":5319,"iid":958,"title":"Minimal partial clone support","url":"/groups/gitlab-org/-/epics/958","group_id":9970,"human_readable_end_date":"May 17, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":32070182,"iid":2547,"project_id":2009901,"title":"SQL for failover and leader election","description":"## Problem to solve\n\nIt is important that multiple Praefect proxies/routers can be run at the same time so that there is no single point of failure. These need to be consistent in choosing the same primary node else different Praefects will route requests inconsistently causing data loss.\n\n## Further details\n\nThere have been investigations in Consul https://gitlab.com/gitlab-org/gitaly/issues/2037 https://gitlab.com/gitlab-org/gitaly/issues/2458 for GitLab Omnibus, since this is a good application of Consul. However, Consul isn't likely to be ideal in a Kubernetes environment.\n\nSince we already have a PostgreSQL database as part of the current architecture, and is seems like viable first iteration (spike https://gitlab.com/gitlab-org/gitaly/-/merge_requests/1883) we will use this for providing failover and leader election. We plan to keep open the possibility for supporting Consul and K8s features for these problems.\n\n## Proposal\n\n1. We do some lightweight refactoring to prepare the Praefect code to support both SQL and Consul\n1. We aim to incorporate the SQL PoC approach first and roll out two Praefect nodes on GitLab.com.\n1. Focus on getting failover metrics etc. so we have more data on how this performs\n\n## Links / references","state":"closed","created_at":"2020-03-17T08:52:31.361Z","updated_at":"2020-04-24T22:10:34.914Z","closed_at":"2020-04-09T14:21:37.573Z","closed_by":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"labels":["Category:Gitaly","Deliverable","auto updated","devops::create","direction","group::gitaly","group::gitaly::cluster","priority::1","type::feature","workflow::in review"],"milestone":{"id":1104429,"iid":46,"group_id":9970,"title":"12.10","description":"https://about.gitlab.com/releases/2020/04/22/gitlab-12-10-released","state":"closed","created_at":"2019-12-20T15:15:53.243Z","updated_at":"2020-10-08T12:00:39.852Z","due_date":"2020-04-17","start_date":"2020-03-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/46"},"assignees":[{"id":64248,"username":"stanhu","name":"Stan Hu","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/64248/stanhu.jpg","web_url":"https://gitlab.com/stanhu"}],"author":{"id":1187333,"username":"jramsay-gitlab","name":"James Ramsay (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1187333/avatar.png","web_url":"https://gitlab.com/jramsay-gitlab"},"type":"ISSUE","assignee":{"id":64248,"username":"stanhu","name":"Stan Hu","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/64248/stanhu.jpg","web_url":"https://gitlab.com/stanhu"},"user_notes_count":8,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2547","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":6,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2547","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2547/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2547/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2547","relative":"#2547","full":"gitlab-org/gitaly#2547"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2657,"epic":{"id":20747,"iid":2657,"title":"🚨 Gitaly HA (beta)","url":"/groups/gitlab-org/-/epics/2657","group_id":9970,"human_readable_end_date":"May 17, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":"on_track"},{"id":32037158,"iid":2546,"project_id":2009901,"title":"Document how to keep Praefect's SQL schema up to date","description":"Praefect has its own SQL database. Every time you deploy a new version of Praefect you need to make sure you run any pending SQL migrations.\n\nThe status quo in multi-node GitLab installations is that the local administrators must have their own process for running database migrations. In the gitlab-rails case this means running `rake db:migrate`. https://docs.gitlab.com/omnibus/update/#zero-downtime-updates\n\nI think we should extend this documentation with information on how to run Praefect migrations.","state":"closed","created_at":"2020-03-16T13:13:33.347Z","updated_at":"2020-05-18T07:08:34.737Z","closed_at":"2020-04-24T06:04:44.241Z","closed_by":{"id":4849,"username":"balasankarc","name":"Balasankar 'Balu' C","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4849/avatar.png","web_url":"https://gitlab.com/balasankarc"},"labels":["Deliverable","devops::create","group::gitaly","group::gitaly::cluster","missed-deliverable","missed:12.10","priority::2","workflow::in review"],"milestone":{"id":991112,"iid":42,"group_id":9970,"title":"13.0","description":"","state":"closed","created_at":"2019-09-04T15:20:39.024Z","updated_at":"2020-10-08T12:00:55.725Z","due_date":"2020-05-17","start_date":"2020-04-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/42"},"assignees":[{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/513969/avatar.png","web_url":"https://gitlab.com/jacobvosmaer-gitlab"}],"author":{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/513969/avatar.png","web_url":"https://gitlab.com/jacobvosmaer-gitlab"},"type":"ISSUE","assignee":{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/513969/avatar.png","web_url":"https://gitlab.com/jacobvosmaer-gitlab"},"user_notes_count":0,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2546","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2546","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2546/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2546/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2546","relative":"#2546","full":"gitlab-org/gitaly#2546"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2657,"epic":{"id":20747,"iid":2657,"title":"🚨 Gitaly HA (beta)","url":"/groups/gitlab-org/-/epics/2657","group_id":9970,"human_readable_end_date":"May 17, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":"on_track"},{"id":31850391,"iid":2530,"project_id":2009901,"title":"Add praefect replication delay metric","description":"Per demo on 3/10, a useful metric would be the total time from when a replication job is created to when it is completed. This would give us total \"replication delay\".\n\nAdditionally, this metric should be graphed in Grafana: https://dashboards.gitlab.net/d/8EAXC-AWz/praefect?orgId=1\u0026from=now-24h\u0026to=now\n","state":"closed","created_at":"2020-03-10T22:59:23.516Z","updated_at":"2020-04-18T07:08:21.459Z","closed_at":"2020-04-06T17:19:54.869Z","closed_by":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"},"labels":["Deliverable","demo","devops::create","group::gitaly","group::gitaly::cluster","workflow::in review"],"milestone":{"id":1104429,"iid":46,"group_id":9970,"title":"12.10","description":"https://about.gitlab.com/releases/2020/04/22/gitlab-12-10-released","state":"closed","created_at":"2019-12-20T15:15:53.243Z","updated_at":"2020-10-08T12:00:39.852Z","due_date":"2020-04-17","start_date":"2020-03-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/46"},"assignees":[{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"}],"author":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"},"type":"ISSUE","assignee":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"user_notes_count":3,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2530","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2530","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2530/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2530/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2530","relative":"#2530","full":"gitlab-org/gitaly#2530"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2657,"epic":{"id":20747,"iid":2657,"title":"🚨 Gitaly HA (beta)","url":"/groups/gitlab-org/-/epics/2657","group_id":9970,"human_readable_end_date":"May 17, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":31685325,"iid":2525,"project_id":2009901,"title":"Turn on info-ref advertisement cache by default","description":"Right now, info-ref advertisement caching is guarded by a feature flag. We have been running the feature on GitLab.com for a while now without major incidents (last incident was `TODO: link issue with cache walker incident`). This should be enabled by default.","state":"closed","created_at":"2020-03-06T17:33:00.467Z","updated_at":"2020-04-18T07:08:21.566Z","closed_at":"2020-04-16T12:45:59.284Z","closed_by":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"labels":["Category:Gitaly","Deliverable","bug::performance","devops::create","group::gitaly","workflow::in review"],"milestone":{"id":1104429,"iid":46,"group_id":9970,"title":"12.10","description":"https://about.gitlab.com/releases/2020/04/22/gitlab-12-10-released","state":"closed","created_at":"2019-12-20T15:15:53.243Z","updated_at":"2020-10-08T12:00:39.852Z","due_date":"2020-04-17","start_date":"2020-03-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/46"},"assignees":[{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"}],"author":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"type":"ISSUE","assignee":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"user_notes_count":2,"merge_requests_count":0,"upvotes":2,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2525","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2525","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2525/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2525/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2525","relative":"#2525","full":"gitlab-org/gitaly#2525"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1190,"epic":{"id":6002,"iid":1190,"title":"Reduce worst Gitaly IO hotspots","url":"/groups/gitlab-org/-/epics/1190","group_id":9970,"human_readable_end_date":"Apr 17, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":31631137,"iid":2524,"project_id":2009901,"title":"Add GetFullestShard, GetBusiestShard, GetFastestGrowingProject, GetBusiestProject grpc methods","description":"As a gitlab admin, I would like to balance git repository storage between shards based on project activity and growth.\n\nGitaly now provides information about current disk usage and availability per shard.\n\nThe following GRPC methods could be very useful in selecting specific projects for relocation.\n\n- `GetFullestShard`\n- `GetBusiestShard`\n- `GetFastestGrowingProject`\n- `GetBusiestProject`\n\nWhile this information *could* be examined using monitoring, it would be useful to integrate such informatics into the `gitlab-rails` app, in order to ultimately expose this information through the admin api, supporting admin tooling.","state":"closed","created_at":"2020-03-05T18:06:05.158Z","updated_at":"2021-10-27T10:46:24.884Z","closed_at":"2020-03-07T01:05:21.744Z","closed_by":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"labels":["Category:Gitaly","Eng-Consumer::Infrastructure","Eng-Producer::Development","Engineering Allocation","devops::create","group::gitaly","infradev","infrastructure"],"milestone":{"id":490705,"iid":14,"group_id":9970,"title":"Backlog","description":"Issues that we want to do but are not planned right now. Open for contribution from the community.","state":"active","created_at":"2018-03-22T13:09:23.767Z","updated_at":"2018-10-30T14:56:54.069Z","due_date":null,"start_date":null,"expired":false,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/14"},"assignees":[],"author":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"type":"ISSUE","assignee":null,"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2524","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":8,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2524","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2524/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2524/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2524","relative":"#2524","full":"gitlab-org/gitaly#2524"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":31270038,"iid":2502,"project_id":2009901,"title":"Add praefect storage to the performance bar","description":"## Problem to solve\n\nWhen using Gitaly HA it is hard to reconcile what you see in the browser, with what is happening on the server. Which node is primary? If I stop a node, which node is promoted to primary. This would be easy to know if there was information in the performance bar about this.\n\n## Proposal\n\nInclude information in the performance bar about which Gitaly node in the cluster responded to the request.\n\n## Links / references","state":"closed","created_at":"2020-02-26T00:32:38.002Z","updated_at":"2020-04-21T07:50:56.335Z","closed_at":"2020-03-23T05:23:16.375Z","closed_by":{"id":1187333,"username":"jramsay-gitlab","name":"James Ramsay (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1187333/avatar.png","web_url":"https://gitlab.com/jramsay-gitlab"},"labels":["[deprecated] Accepting merge requests","demo","devops::create","group::gitaly","group::gitaly::cluster","workflow::ready for development"],"milestone":null,"assignees":[],"author":{"id":1187333,"username":"jramsay-gitlab","name":"James Ramsay (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1187333/avatar.png","web_url":"https://gitlab.com/jramsay-gitlab"},"type":"ISSUE","assignee":null,"user_notes_count":6,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2502","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2502","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2502/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2502/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2502","relative":"#2502","full":"gitlab-org/gitaly#2502"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":31269946,"iid":2500,"project_id":2009901,"title":"Praefect dial-nodes has even more garbage output","description":"## Problem to solve\n\nIn the demo today we observed large amounts of garbage output. This seems like a regression.\n\n## Proposal\n\nRemove the noise from the output","state":"closed","created_at":"2020-02-26T00:24:36.869Z","updated_at":"2020-05-18T07:08:34.812Z","closed_at":"2020-05-15T00:27:24.644Z","closed_by":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"},"labels":["Deliverable","demo","devops::create","group::gitaly","group::gitaly::cluster","type::bug","workflow::ready for development"],"milestone":{"id":991112,"iid":42,"group_id":9970,"title":"13.0","description":"","state":"closed","created_at":"2019-09-04T15:20:39.024Z","updated_at":"2020-10-08T12:00:55.725Z","due_date":"2020-05-17","start_date":"2020-04-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/42"},"assignees":[{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/228150/avatar.png","web_url":"https://gitlab.com/proglottis"}],"author":{"id":1187333,"username":"jramsay-gitlab","name":"James Ramsay (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1187333/avatar.png","web_url":"https://gitlab.com/jramsay-gitlab"},"type":"ISSUE","assignee":{"id":228150,"username":"proglottis","name":"James Fargher","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/228150/avatar.png","web_url":"https://gitlab.com/proglottis"},"user_notes_count":3,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2500","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2500","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2500/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2500/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2500","relative":"#2500","full":"gitlab-org/gitaly#2500"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2658,"epic":{"id":20748,"iid":2658,"title":"🚀 Gitaly HA (generally available)","url":"/groups/gitlab-org/-/epics/2658","group_id":9970,"human_readable_end_date":"May 17, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":27970392,"iid":2237,"project_id":2009901,"title":"Gitaly should perform better Rails-side validation","description":"For example, this API query alone causes dozens of 500 errors per minute: https://log.gitlab.net/goto/bb1a0ad5013edecd5f0e31daa4c12df0\n\nThe Gitaly ruby client should do more basic client side validation, to ensure refs are valid (don't contain whitespace) etc. \n\nThis will prevent a remote GRPC call, git spawn etc, only to error with a basic validation error. \n\nMore examples of this: https://log.gitlab.net/goto/a5a4ce0c321fb5c3703286ced55d1df3","state":"closed","created_at":"2019-12-05T09:48:27.417Z","updated_at":"2020-05-20T14:15:57.487Z","closed_at":"2020-05-15T19:14:12.169Z","closed_by":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"labels":["Category:Gitaly","Mechanical Sympathy","devops::create","group::gitaly","priority::3","severity::2","type::bug","workflow::ready for development"],"milestone":{"id":991112,"iid":42,"group_id":9970,"title":"13.0","description":"","state":"closed","created_at":"2019-09-04T15:20:39.024Z","updated_at":"2020-10-08T12:00:55.725Z","due_date":"2020-05-17","start_date":"2020-04-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/42"},"assignees":[{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"}],"author":{"id":895869,"username":"andrewn","name":"Andrew Newdigate","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/895869/avatar.png","web_url":"https://gitlab.com/andrewn"},"type":"ISSUE","assignee":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"user_notes_count":8,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2237","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2237","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2237/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2237/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2237","relative":"#2237","full":"gitlab-org/gitaly#2237"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":27479933,"iid":2204,"project_id":2009901,"title":"Remove old praefect config virtual_storage_name and nodes","description":"Once https://gitlab.com/gitlab-org/omnibus-gitlab/merge_requests/3754 and gdk is updated with the change to allow multiple praefect virtual storages, we can remove the backwards compatible support in praefect.\n\nalso we need to remove the text fixture in `internal/praefect/config/testdata/single-virtual-storage.config.toml`","state":"closed","created_at":"2019-11-22T19:58:23.670Z","updated_at":"2020-04-29T09:17:56.247Z","closed_at":"2020-04-29T09:04:09.042Z","closed_by":{"id":4626406,"username":"8bitlife","name":"Pavlo Strokov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4626406/avatar.png","web_url":"https://gitlab.com/8bitlife"},"labels":["Category:Gitaly","auto updated","devops::create","group::gitaly","group::gitaly::cluster","maintenance::refactor","workflow::ready for development"],"milestone":{"id":991112,"iid":42,"group_id":9970,"title":"13.0","description":"","state":"closed","created_at":"2019-09-04T15:20:39.024Z","updated_at":"2020-10-08T12:00:55.725Z","due_date":"2020-05-17","start_date":"2020-04-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/42"},"assignees":[{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"}],"author":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"},"type":"ISSUE","assignee":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"},"user_notes_count":4,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2204","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2204","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2204/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2204/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2204","relative":"#2204","full":"gitlab-org/gitaly#2204"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":27083225,"iid":2167,"project_id":2009901,"title":"Observe which projects suffered dataloss from failover","description":"## Problem to solve\n\nAs an administrator, when a failover occurs, I want to know which repositories have experienced dataloss. This provides me an indication of which developers have been effected and where to target efforts for recovering missing data where possible. For example, letting a team know that they might need to re-push their feature branches.\n\n## Further details\n\nAt a minimum, we should be able to which specific projects suffered dataloss, caused by replication operations that cannot be completed due to incomplete replication queue.\n\nA possible future improvement could also be to summarize the number of replication jobs lost for each repo, and perhaps even count per ref, per repository.\n\n## Proposal\n\nStore failed replication jobs for some period of time in the Praefect database, and provide a method for reporting on this.\n\nPerhaps the MVC, would be command that can be run on any Praefect server to:\n\n- dump all the failed replication jobs (this could be useful for analysis)\n- summarize failed replication jobs\n","state":"closed","created_at":"2019-11-15T09:27:10.660Z","updated_at":"2020-04-20T12:36:48.061Z","closed_at":"2020-04-19T23:31:07.829Z","closed_by":{"id":1187333,"username":"jramsay-gitlab","name":"James Ramsay (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1187333/avatar.png","web_url":"https://gitlab.com/jramsay-gitlab"},"labels":["Deliverable","backstage [DEPRECATED]","devops::create","direction","group::gitaly","group::gitaly::cluster","priority::2","workflow::in review"],"milestone":{"id":1104429,"iid":46,"group_id":9970,"title":"12.10","description":"https://about.gitlab.com/releases/2020/04/22/gitlab-12-10-released","state":"closed","created_at":"2019-12-20T15:15:53.243Z","updated_at":"2020-10-08T12:00:39.852Z","due_date":"2020-04-17","start_date":"2020-03-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/46"},"assignees":[{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5522960/avatar.png","web_url":"https://gitlab.com/samihiltunen"}],"author":{"id":1187333,"username":"jramsay-gitlab","name":"James Ramsay (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1187333/avatar.png","web_url":"https://gitlab.com/jramsay-gitlab"},"type":"ISSUE","assignee":{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5522960/avatar.png","web_url":"https://gitlab.com/samihiltunen"},"user_notes_count":16,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2167","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2167","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2167/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2167/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2167","relative":"#2167","full":"gitlab-org/gitaly#2167"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":2657,"epic":{"id":20747,"iid":2657,"title":"🚨 Gitaly HA (beta)","url":"/groups/gitlab-org/-/epics/2657","group_id":9970,"human_readable_end_date":"May 17, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":"on_track"},{"id":26989784,"iid":2160,"project_id":2009901,"title":"Use `--end-of-options` in the GitDSL","description":"Requires the minimum version of Git 2.24: https://gitlab.com/gitlab-org/gitaly/issues/2170\n\nFrom the GH release blog: https://github.blog/2019-11-03-highlights-from-git-2-24/#tidbits\n\n\u003e\u003e\u003e\nGit 2.24 has a new way to prevent this sort of option injection attack using --end-of-options. When Git sees this as an argument to any command, it knows to treat the remaining arguments as such, and won’t interpret them as more options.\n\nSo, instead of the string previously mentioned, you could write the following to get the history of your (admittedly, pretty oddly named) branch:\n\n$ git log --end-of-options --super-dangerous-option\n\nNot using the standard -- was an intentional choice here, since this is already a widely-used mechanism in Git to separate reference names from files. In this example, you could have also written git log --end-of-options --super-dangerous-option ^master -- path/to/file to get only the history over that range which modified that specific file.\n\u003e\u003e\u003e\n\nExample of the Git behaviour:\n\n```\n$ git diff --end-of-options --name-only HEAD~ HEAD\nfatal: option '--name-only' must come before non-option arguments\n```","state":"closed","created_at":"2019-11-12T17:33:52.832Z","updated_at":"2020-06-18T07:07:28.236Z","closed_at":"2020-05-22T09:48:02.232Z","closed_by":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"labels":["Category:Gitaly","Deliverable","devops::create","group::gitaly","security","type::feature","workflow::in review"],"milestone":{"id":1112145,"iid":47,"group_id":9970,"title":"13.1","description":"","state":"closed","created_at":"2020-01-03T12:28:30.160Z","updated_at":"2020-10-08T12:01:07.361Z","due_date":"2020-06-17","start_date":"2020-05-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/47"},"assignees":[{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"type":"ISSUE","assignee":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"user_notes_count":5,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2160","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2160","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2160/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2160/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2160","relative":"#2160","full":"gitlab-org/gitaly#2160"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1893,"epic":{"id":12146,"iid":1893,"title":"🧯 Git DSL for Gitaly","url":"/groups/gitlab-org/-/epics/1893","group_id":9970,"human_readable_end_date":"Jun 17, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":26782454,"iid":2146,"project_id":2009901,"title":"Add GetStorageDiskStatistics grpc","description":"It may also be useful to implement a method for obtaining a collection of disk space statistics.  In fact, this could reduce overall load on the server, by avoiding the need to invoke multiple remote procedure calls to obtain separate details.\n\nSo this issue is to suggest the feature addition of a `grpc` resembling `GetStorageDiskStatistics` which would return a collection, ideally a dictionary, containing at least the disk `avail` and disk `used` portions of the output of a `df /var/opt/gitlab` invocation on the given target storage node system.","state":"closed","created_at":"2019-11-06T18:37:00.993Z","updated_at":"2019-11-25T08:48:52.444Z","closed_at":"2019-11-25T08:48:52.333Z","closed_by":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"labels":["Category:Gitaly","devops::create","group::gitaly","missed:12.5","production request","type::feature","workflow::in review"],"milestone":{"id":891797,"iid":40,"group_id":9970,"title":"12.6","description":"https://about.gitlab.com/releases/2019/12/22/gitlab-12-6-released","state":"closed","created_at":"2019-05-31T08:38:03.539Z","updated_at":"2020-04-27T16:27:13.329Z","due_date":"2019-12-17","start_date":"2019-11-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/40"},"assignees":[{"id":2207885,"username":"maxmati","name":"Mateusz Nowotynski","state":"active","avatar_url":"https://secure.gravatar.com/avatar/321da2d4dd336295456ea3921eab40d3?s=80\u0026d=identicon","web_url":"https://gitlab.com/maxmati"}],"author":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"type":"ISSUE","assignee":{"id":2207885,"username":"maxmati","name":"Mateusz Nowotynski","state":"active","avatar_url":"https://secure.gravatar.com/avatar/321da2d4dd336295456ea3921eab40d3?s=80\u0026d=identicon","web_url":"https://gitlab.com/maxmati"},"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2146","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2146","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2146/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2146/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2146","relative":"#2146","full":"gitlab-org/gitaly#2146"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":26778710,"iid":2144,"project_id":2009901,"title":"Add GetStorageDiskUsed grpc","description":"Currently, `gitlab-rails` acquires disk usage information for individual project repositories from `gitaly` which ultimately appears to use `du` (https://gitlab.com/gitlab-org/gitaly/blob/master/internal/service/repository/size.go#L36).\n\nAs an SRE, I am responsible for managing storage node configuration through the gitlab rails web application admin section, and also adding new nodes as needed.  Automating these procedures would be very helpful for our team.  To accomplish this, some data is required.\n\nI would like to have reliable access to the disk `used` (amount of disk in current use) statistic.\n\nOnly as an example, not an implementation recommendation: `ssh file-34-stor-gprd.c.gitlab-production.internal 'df /var/opt/gitlab --output=used | tail -n1' #=\u003e 13710976516`\n\nAfter having spoken with @pokstad1 and @jacobvosmaer-gitlab , I think the best suggestion is to implement a `grpc` resembling `GetStorageDiskUsed` which will return the parsed results of such an `df` operation with the relevant detail or details.","state":"closed","created_at":"2019-11-06T16:25:00.923Z","updated_at":"2019-11-07T10:57:05.838Z","closed_at":"2019-11-07T10:55:31.176Z","closed_by":{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/513969/avatar.png","web_url":"https://gitlab.com/jacobvosmaer-gitlab"},"labels":["Category:Gitaly","devops::create","group::gitaly","production request","type::feature"],"milestone":null,"assignees":[],"author":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"type":"ISSUE","assignee":null,"user_notes_count":3,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2144","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2144","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2144/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2144/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2144","relative":"#2144","full":"gitlab-org/gitaly#2144"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":26778708,"iid":2143,"project_id":2009901,"title":"Add GetStorageDiskAvail grpc","description":"Currently, `gitlab-rails` acquires disk usage information for individual project repositories from `gitaly` which ultimately appears to use `du` (https://gitlab.com/gitlab-org/gitaly/blob/master/internal/service/repository/size.go#L36).\n\nAs an SRE, I am responsible for managing storage node configuration through the gitlab rails web application admin section, and also adding new nodes as needed.  Automating these procedures would be very helpful for our team.  To accomplish this, some data is required.\n\nI would like to have reliable access to the disk `avail` (amount of remaining -- unused -- disk space available for use) statistic.\n\nOnly as an example, not an implementation recommendation: `ssh file-34-stor-gprd.c.gitlab-production.internal 'df /var/opt/gitlab --output=avail | tail -n1' #=\u003e 2933905600`\n\nAfter having spoken with @pokstad1 and @jacobvosmaer-gitlab , I think the best suggestion is to implement a `grpc` resembling `GetStorageDiskAvail` which will return the parsed results of such an `df` operation with the relevant detail or details.","state":"closed","created_at":"2019-11-06T16:24:56.858Z","updated_at":"2019-11-07T10:55:18.058Z","closed_at":"2019-11-07T10:55:18.024Z","closed_by":{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/513969/avatar.png","web_url":"https://gitlab.com/jacobvosmaer-gitlab"},"labels":["Category:Gitaly","devops::create","group::gitaly","production request","type::feature"],"milestone":null,"assignees":[],"author":{"id":4006601,"username":"nnelson","name":"Nels Nelson","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4006601/avatar.png","web_url":"https://gitlab.com/nnelson"},"type":"ISSUE","assignee":null,"user_notes_count":1,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2143","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2143","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2143/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2143/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2143","relative":"#2143","full":"gitlab-org/gitaly#2143"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":26718942,"iid":2137,"project_id":2009901,"title":"Remove WikiService#get_formatted_data RPC","description":"Depends on: https://gitlab.com/gitlab-org/gitlab/merge_requests/19627\n\nThe RPC has gone unused, and can be removed from both our `Protobuf` schema, as well as the Golang + Ruby code that's related.","state":"closed","created_at":"2019-11-05T14:42:44.005Z","updated_at":"2019-11-06T22:24:02.705Z","closed_at":"2019-11-06T22:24:02.661Z","closed_by":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"},"labels":["Category:Gitaly","backstage [DEPRECATED]","devops::create","group::gitaly","workflow::in review"],"milestone":{"id":891796,"iid":39,"group_id":9970,"title":"12.5","description":"https://about.gitlab.com/releases/2019/11/22/gitlab-12-5-released","state":"closed","created_at":"2019-05-31T08:38:03.087Z","updated_at":"2020-04-27T16:27:03.474Z","due_date":"2019-11-17","start_date":"2019-10-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/39"},"assignees":[{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"type":"ISSUE","assignee":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2137","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2137","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2137/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2137/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2137","relative":"#2137","full":"gitlab-org/gitaly#2137"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":26227127,"iid":2108,"project_id":2009901,"title":"Gitaly spikes to 100% CPU usage when a moved project's branch details are called via API","description":"### Summary\n\nThis will affect all environments when customers move workload in different shards. We did find this out while testing out our new [50k Reference Architecture](https://docs.gitlab.com/ee/administration/high_availability/README.html#50000-user-configuration) I noticed that one of the 4 Gitaly nodes was spiking to 100% when performance testing was done against the [Repository Branch Details API](https://docs.gitlab.com/ee/api/branches.html#get-single-repository-branch).\n\n![image](/uploads/5b0c199a53a039bda4c9f4445691d940/image.png)\n\nhttp://50k.testbed.gitlab.net/-/grafana/dashboard/snapshot/KDpnPrAq5Cj3sH75cGenTJE400E3G0X8\n\nIn this setup we have 4 identical Gitaly nodes (64 CPU, 240GB Memory) that each have a copy of the same large project on each. Our test tool then tests the environment at a rate of 1000 RPS and makes calls equally to each of the 4 project copies (so approximately 250 RPS to each Gitaly node). The other copies of the prohect only should around 20% usage.\n\nThe only difference that applied here is how the copy of the project was imported to the affected Gitaly node - It was specifically moved from another Gitaly node via the [Project Edit API](https://docs.gitlab.com/ee/api/projects.html#edit-project) where as all the others were imported to their Gitaly nodes directly via UI settings.\n\nTo verify this I imported another copy of the project today in the same way to another Gitaly node and was able to reproduce the issue successfully.\n\nOf note the affected node shows numerous Git operations (details in the logs section below). Interestingly not all Linux task managers showed these Git operations but `top` did and they were averaging around 20% CPU usage.\n\n### Steps to reproduce\n\n1. Import a Project to an environment that has at least 2 Gitaly nodes (API was used in this case and the specific project is [a copy of `gitlab-foss`](https://gitlab.com/gitlab-org/quality/performance-data/blob/master/gitlabhq_export.tar.gz)).\n1. Move the project to the other Gitaly node via the [Project Edit API](https://docs.gitlab.com/ee/api/projects.html#edit-project).\n1. Set up a way to monitor the CPU use on the Gitaly node that now contains the project (e.g. Prometheus or even just watching `top` on the node directly)\n1. [Prepare the GitLab Performance Tool](https://gitlab.com/gitlab-org/quality/performance#documentation) and the proceed to run the `api_v4_projects_repository_branches_branch` test against the environment. The RPS rate will be dependent on your environment but `20s_20rps` should do, e.g.\n    * `ACCESS_TOKEN=\u003ctoken\u003e ./run-k6 -e environments/\u003cenvironment\u003e.json -s scenarios/20s_20rps.json -t tests/api_v4_projects_repository_branches_branch.js`\n1. As the test is running note that the CPU usage spikes massively to 100%.\n\n### Example Project\n\nWe use a copy of [`gitlab-foss`](https://gitlab.com/gitlab-org/quality/performance-data/blob/master/gitlabhq_export.tar.gz). It's specifically a backup of our own backup on GitHub, [gitlabhq](https://github.com/gitlabhq/gitlabhq), as that's sanitised and doesn't contain private data.\n\n### What is the current *bug* behavior?\n\nGitaly CPU usage spikes massively to 100% when the [Repository Branch Details API](https://docs.gitlab.com/ee/api/branches.html#get-single-repository-branch) endpoint is polled for a project that's been moved to the Gitaly node via the [Project Edit API](https://docs.gitlab.com/ee/api/projects.html#edit-project).\n\n### What is the expected *correct* behavior?\n\nThat the Gitaly node shows the same CPU usage as others where the project is the same but hasn't been moved via the [Project Edit API](https://docs.gitlab.com/ee/api/projects.html#edit-project).\n\n### Relevant logs and/or screenshots\n\n[Perf Output](https://docs.gitlab.com/ee/administration/troubleshooting/sidekiq.html#process-profiling-with-perf), taken over a couple of minutes as a long version of the test was running:\n```\nSamples: 59M of event 'cpu-clock', Event count (approx.): 14942880250000\nOverhead  Command  Shared Object           Symbol\n  27.56%  git      libz.so.1.2.11          [.] inflate\n  21.79%  git      libz.so.1.2.11          [.] inflate_table\n   9.28%  git      libz.so.1.2.11          [.] inflate_fast\n   3.59%  git      libc-2.27.so            [.] 0x000000000018adb8\n   3.53%  git      git                     [.] lookup_object\n   2.27%  git      libz.so.1.2.11          [.] adler32_z\n   1.69%  git      git                     [.] clear_commit_marks_1\n   1.61%  git      git                     [.] create_object\n   1.49%  git      git                     [.] hashmap_get\n   1.40%  git      git                     [.] parse_commit_buffer\n   1.16%  git      git                     [.] nth_packed_object_offset\n   1.13%  git      [kernel.kallsyms]       [k] __do_page_fault\n   1.09%  git      [kernel.kallsyms]       [k] clear_page_erms\n   0.91%  git      git                     [.] get_sha1_hex\n   0.61%  git      git                     [.] bsearch_hash\n   0.50%  git      git                     [.] compare_commits_by_gen_then_commit_date\n   0.46%  git      libc-2.27.so            [.] 0x00000000000950dd\n   0.43%  git      [kernel.kallsyms]       [k] _raw_spin_unlock_irqrestore\n   0.42%  git      git                     [.] unpack_object_header_buffer\n   0.40%  git      [kernel.kallsyms]       [k] unmap_page_range\n   0.39%  git      [kernel.kallsyms]       [k] get_page_from_freelist\n   0.37%  git      libc-2.27.so            [.] malloc\n   0.37%  git      [kernel.kallsyms]       [k] filemap_map_pages\n   0.36%  git      git                     [.] prio_queue_get\n   0.36%  git      [kernel.kallsyms]       [k] try_charge\n   0.35%  git      git                     [.] paint_down_to_common\n   0.35%  git      [kernel.kallsyms]       [k] __d_lookup_rcu\n   0.34%  git      git                     [.] prio_queue_put\n   0.29%  git      [kernel.kallsyms]       [k] do_syscall_64\n```\n\n[Go Tool `pprof` output](https://gitlab.com/gitlab-com/runbooks/blob/master/howto/gitaly-profiling.md#1-download-the-profiles). Top 30 Cumulative:\n```\nShowing nodes accounting for 4.24s, 23.30% of 18.20s total\nDropped 581 nodes (cum \u003c= 0.09s)\nShowing top 30 nodes out of 272\n      flat  flat%   sum%        cum   cum%\n         0     0%     0%      7.48s 41.10%  google.golang.org/grpc.(*Server).serveStreams.func1.1\n         0     0%     0%      7.47s 41.04%  google.golang.org/grpc.(*Server).handleStream\n     0.01s 0.055% 0.055%      7.47s 41.04%  google.golang.org/grpc.(*Server).processUnaryRPC\n         0     0% 0.055%      6.93s 38.08%  github.com/grpc-ecosystem/go-grpc-middleware.ChainUnaryServer.func1\n         0     0% 0.055%      6.92s 38.02%  github.com/grpc-ecosystem/go-grpc-middleware/tags.UnaryServerInterceptor.func1\n     0.01s 0.055%  0.11%      6.84s 37.58%  github.com/grpc-ecosystem/go-grpc-middleware.ChainUnaryServer.func1.1\n         0     0%  0.11%      6.84s 37.58%  gitlab.com/gitlab-org/labkit/correlation/grpc.UnaryServerCorrelationInterceptor.func1\n         0     0%  0.11%      6.82s 37.47%  gitlab.com/gitlab-org/gitaly/internal/middleware/metadatahandler.UnaryInterceptor\n         0     0%  0.11%      6.75s 37.09%  github.com/grpc-ecosystem/go-grpc-prometheus.(*ServerMetrics).UnaryServerInterceptor.func1\n     0.01s 0.055%  0.16%      6.64s 36.48%  github.com/grpc-ecosystem/go-grpc-middleware/logging/logrus.UnaryServerInterceptor.func1\n         0     0%  0.16%      5.75s 31.59%  github.com/grpc-ecosystem/go-grpc-middleware/auth.UnaryServerInterceptor.func1\n         0     0%  0.16%      5.75s 31.59%  gitlab.com/gitlab-org/gitaly/internal/middleware/cancelhandler.Unary\n         0     0%  0.16%      5.75s 31.59%  gitlab.com/gitlab-org/gitaly/internal/middleware/limithandler.(*LimiterMiddleware).UnaryInterceptor.func1\n         0     0%  0.16%      5.75s 31.59%  gitlab.com/gitlab-org/gitaly/internal/middleware/sentryhandler.UnaryLogHandler\n         0     0%  0.16%      5.64s 30.99%  github.com/grpc-ecosystem/go-grpc-middleware/tracing/opentracing.UnaryServerInterceptor.func1\n     0.02s  0.11%  0.27%      5.61s 30.82%  gitlab.com/gitlab-org/gitaly/internal/middleware/cache.UnaryInvalidator.func1\n     0.01s 0.055%  0.33%      5.58s 30.66%  gitlab.com/gitlab-org/gitaly/internal/middleware/panichandler.UnaryPanicHandler\n         0     0%  0.33%      4.06s 22.31%  gitlab.com/gitlab-org/gitaly/proto/go/gitalypb._RefService_FindBranch_Handler\n         0     0%  0.33%      3.87s 21.26%  runtime.mcall\n     3.84s 21.10% 21.43%      3.84s 21.10%  runtime.futex\n     0.04s  0.22% 21.65%      3.76s 20.66%  runtime.schedule\n         0     0% 21.65%      3.55s 19.51%  gitlab.com/gitlab-org/gitaly/proto/go/gitalypb._RefService_FindBranch_Handler.func1\n     0.02s  0.11% 21.76%      3.54s 19.45%  gitlab.com/gitlab-org/gitaly/internal/service/ref.(*server).FindBranch\n     0.26s  1.43% 23.19%      3.42s 18.79%  runtime.findrunnable\n     0.01s 0.055% 23.24%      3.41s 18.74%  gitlab.com/gitlab-org/gitaly/internal/command.New\n         0     0% 23.24%      3.41s 18.74%  gitlab.com/gitlab-org/gitaly/internal/git.BareCommand\n     0.01s 0.055% 23.30%      3.17s 17.42%  runtime.futexsleep\n         0     0% 23.30%      2.97s 16.32%  runtime.park_m\n         0     0% 23.30%      2.34s 12.86%  gitlab.com/gitlab-org/gitaly/internal/git.Command\n         0     0% 23.30%      2.19s 12.03%  gitlab.com/gitlab-org/gitaly/proto/go/gitalypb._CommitService_CommitIsAncestor_Handler\n```\n\n### Output of checks\n\n#### Results of GitLab environment info\n\n\u003cdetails\u003e\n\u003csummary\u003eExpand for output related to GitLab environment info\u003c/summary\u003e\n\u003cpre\u003e\n\n```\nSystem information\nSystem:\t\tUbuntu 18.04\nProxy:\t\tno\nCurrent User:\tgit\nUsing RVM:\tno\nRuby Version:\t2.6.3p62\nGem Version:\t2.7.9\nBundler Version:1.17.3\nRake Version:\t12.3.2\nRedis Version:\t3.2.12\nGit Version:\t2.22.0\nSidekiq Version:5.2.7\nGo Version:\tunknown\n\nGitLab information\nVersion:\t12.3.5-ee\nRevision:\t9dbaa740018\nDirectory:\t/opt/gitlab/embedded/service/gitlab-rails\nDB Adapter:\tPostgreSQL\nDB Version:\t10.9\nURL:\t\thttp://50k.testbed.gitlab.net\nHTTP Clone URL:\thttp://50k.testbed.gitlab.net/some-group/some-project.git\nSSH Clone URL:\tgit@50k.testbed.gitlab.net:some-group/some-project.git\nElasticsearch:\tno\nGeo:\t\tno\nUsing LDAP:\tno\nUsing Omniauth:\tyes\nOmniauth Providers:\n\nGitLab Shell\nVersion:\t10.0.0\nRepository storage paths:\n- default: \t/var/opt/gitlab/git-data/repositories\n- storage1: \t/var/opt/gitlab/git-data/repositories\n- storage2: \t/var/opt/gitlab/git-data/repositories\n- storage3: \t/var/opt/gitlab/git-data/repositories\n- storage4: \t/var/opt/gitlab/git-data/repositories\nGitLab Shell path:\t\t/opt/gitlab/embedded/service/gitlab-shell\nGit:\t\t/opt/gitlab/embedded/bin/git\n```\n\n\u003c/pre\u003e\n\u003c/details\u003e\n\n#### Results of GitLab application Check\n\n\u003cdetails\u003e\n\u003csummary\u003eExpand for output related to the GitLab application check\u003c/summary\u003e\n\u003cpre\u003e\n\n```\nChecking GitLab subtasks ...\n\nChecking GitLab Shell ...\n\nGitLab Shell: ... GitLab Shell version \u003e= 10.0.0 ? ... OK (10.0.0)\nRunning /opt/gitlab/embedded/service/gitlab-shell/bin/check\nCheck GitLab API access: OK\nRedis available via internal API: OK\n\ngitlab-shell self-check successful\n\nChecking GitLab Shell ... Finished\n\nChecking Gitaly ...\n\nGitaly: ... default ... OK\nstorage1 ... OK\nstorage2 ... OK\nstorage3 ... OK\nstorage4 ... OK\n\nChecking Gitaly ... Finished\n\nChecking Sidekiq ...\n\nSidekiq: ... Running? ... no\n  Try fixing it:\n  sudo -u git -H RAILS_ENV=production bin/background_jobs start\n  For more information see:\n  doc/install/installation.md in section \"Install Init Script\"\n  see log/sidekiq.log for possible errors\n  Please fix the error above and rerun the checks.\n\nChecking Sidekiq ... Finished\n\nChecking Incoming Email ...\n\nIncoming Email: ... Reply by email is disabled in config/gitlab.yml\n\nChecking Incoming Email ... Finished\n\nChecking LDAP ...\n\nLDAP: ... LDAP is disabled in config/gitlab.yml\n\nChecking LDAP ... Finished\n\nChecking GitLab App ...\n\nGit configured correctly? ... yes\nDatabase config exists? ... yes\nAll migrations up? ... yes\nDatabase contains orphaned GroupMembers? ... no\nGitLab config exists? ... yes\nGitLab config up to date? ... yes\nLog directory writable? ... yes\nTmp directory writable? ... yes\nUploads directory exists? ... yes\nUploads directory has correct permissions? ... yes\nUploads directory tmp has correct permissions? ... yes\nInit script exists? ... skipped (omnibus-gitlab has no init script)\nInit script up-to-date? ... skipped (omnibus-gitlab has no init script)\nProjects have namespace: ...\n2/1 ... yes\n2/19 ... yes\n2/20 ... yes\n2/31 ... yes\n2/33 ... yes\n21/35 ... yes\n2/43 ... yes\n2/44 ... yes\n1/45 ... yes\n1/46 ... yes\nRedis version \u003e= 2.8.0? ... yes\nRuby version \u003e= 2.5.3 ? ... yes (2.6.3)\nGit version \u003e= 2.22.0 ? ... yes (2.22.0)\nGit user has default SSH configuration? ... yes\nActive users: ... 1\nIs authorized keys file accessible? ... yes\nElasticsearch version 5.6 - 6.x? ... skipped (elasticsearch is disabled)\n\nChecking GitLab App ... Finished\n\n\nChecking GitLab subtasks ... Finished\n```\n\nNote that the Sidekiq error above is due to this being a HA environment where they run on separate nodes.\n\n\u003c/pre\u003e\n\u003c/details\u003e","state":"closed","created_at":"2019-10-23T09:58:28.902Z","updated_at":"2022-11-03T11:55:05.368Z","closed_at":"2019-12-20T16:12:39.857Z","closed_by":{"id":4554599,"username":"m_gill","name":"Michelle Gill","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/4554599/avatar.png","web_url":"https://gitlab.com/m_gill"},"labels":["Deliverable","Quality:performance-issues","backend","bug::performance","devops::create","group::source code","performance-refinement","priority::2","severity::3","type::bug","workflow::verification"],"milestone":{"id":891797,"iid":40,"group_id":9970,"title":"12.6","description":"https://about.gitlab.com/releases/2019/12/22/gitlab-12-6-released","state":"closed","created_at":"2019-05-31T08:38:03.539Z","updated_at":"2020-04-27T16:27:13.329Z","due_date":"2019-12-17","start_date":"2019-11-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/40"},"assignees":[{"id":572018,"username":"nick.thomas","name":"Nick Thomas","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/572018/avatar.png","web_url":"https://gitlab.com/nick.thomas"}],"author":{"id":3769272,"username":"grantyoung","name":"Grant Young","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3769272/avatar.png","web_url":"https://gitlab.com/grantyoung"},"type":"ISSUE","assignee":{"id":572018,"username":"nick.thomas","name":"Nick Thomas","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/572018/avatar.png","web_url":"https://gitlab.com/nick.thomas"},"user_notes_count":49,"merge_requests_count":0,"upvotes":2,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2108","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2108","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2108/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2108/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2108","relative":"#2108","full":"gitlab-org/gitaly#2108"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":26167524,"iid":2106,"project_id":2009901,"title":"Remove repository field inside of ConflictFileHeader","description":"In https://gitlab.com/gitlab-org/gitlab/merge_requests/18692, we changed the client behavior to use the repository being passed into the request rather than wait for the very same repository object to get attached to the response. \n\nOnce that is merged, in 12.6 we can remove the `repository` field in `ConflictFileHeader` completely.","state":"closed","created_at":"2019-10-21T16:59:28.196Z","updated_at":"2019-12-02T19:26:32.407Z","closed_at":"2019-12-02T19:26:32.350Z","closed_by":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"},"labels":["Category:Gitaly","devops::create","group::gitaly","workflow::in dev"],"milestone":{"id":891797,"iid":40,"group_id":9970,"title":"12.6","description":"https://about.gitlab.com/releases/2019/12/22/gitlab-12-6-released","state":"closed","created_at":"2019-05-31T08:38:03.539Z","updated_at":"2020-04-27T16:27:13.329Z","due_date":"2019-12-17","start_date":"2019-11-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/40"},"assignees":[{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"}],"author":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"},"type":"ISSUE","assignee":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2106","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2106","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2106/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2106/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2106","relative":"#2106","full":"gitlab-org/gitaly#2106"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":25228249,"iid":2026,"project_id":2009901,"title":"Praefect as pass through proxy by default in the GDK","description":"Currently one could run Praefect in the GDK, after running `rake praefect:enable`. Given we're confident that praefect works, especially if there's only one Gitaly storage node, the daemon should be enabled by default.\n\nThe thing to consider is that users don't like to reseed their GDK, as it takes long. So the changes should have good forward compatibility.","state":"closed","created_at":"2019-09-24T09:00:45.647Z","updated_at":"2019-10-31T19:19:33.616Z","closed_at":"2019-10-31T19:19:33.547Z","closed_by":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"labels":["Category:Gitaly","Deliverable","devops::create","group::gitaly","type::feature","workflow::in review"],"milestone":{"id":891796,"iid":39,"group_id":9970,"title":"12.5","description":"https://about.gitlab.com/releases/2019/11/22/gitlab-12-5-released","state":"closed","created_at":"2019-05-31T08:38:03.087Z","updated_at":"2020-04-27T16:27:03.474Z","due_date":"2019-11-17","start_date":"2019-10-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/39"},"assignees":[{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"type":"ISSUE","assignee":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2026","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2026","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2026/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2026/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2026","relative":"#2026","full":"gitlab-org/gitaly#2026"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1877,"epic":{"id":11992,"iid":1877,"title":"🏝 HA Gitaly: minimal reverse proxy","url":"/groups/gitlab-org/-/epics/1877","group_id":9970,"human_readable_end_date":"Nov 17, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":24662617,"iid":1924,"project_id":2009901,"title":"Pass through FindRemoteRepository in Praefect to any gitaly node","description":"We can proxy it to any of the praefect gitaly nodes since this RPC call is not dependent on a repository.","state":"closed","created_at":"2019-09-10T22:04:46.914Z","updated_at":"2019-10-01T18:11:09.852Z","closed_at":"2019-10-01T18:11:09.671Z","closed_by":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"},"labels":["Deliverable","[deprecated] Accepting merge requests","devops::create","group::gitaly","group::gitaly::cluster","workflow::ready for development"],"milestone":{"id":731039,"iid":38,"group_id":9970,"title":"12.4","description":"https://about.gitlab.com/releases/2019/10/22/gitlab-12-4-released","state":"closed","created_at":"2018-12-07T12:41:53.212Z","updated_at":"2020-04-27T16:30:43.889Z","due_date":"2019-10-17","start_date":"2019-09-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/38"},"assignees":[{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"}],"author":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"},"type":"ISSUE","assignee":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"},"user_notes_count":6,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/1924","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/1924","notes":"https://gitlab.com/api/v4/projects/2009901/issues/1924/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/1924/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#1924","relative":"#1924","full":"gitlab-org/gitaly#1924"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1877,"epic":{"id":11992,"iid":1877,"title":"🏝 HA Gitaly: minimal reverse proxy","url":"/groups/gitlab-org/-/epics/1877","group_id":9970,"human_readable_end_date":"Nov 17, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":24637979,"iid":1921,"project_id":2009901,"title":"Remove get-commit-signatures feature flag","description":"`GetCommitSignatures` has been rewritten using Go in https://gitlab.com/gitlab-org/gitaly/issues/1604. The new RPC is under a feature flag and already [enabled in gitlab.com](https://gitlab.com/gitlab-org/gitaly/issues/1907). The feature flag can now be removed from both gitaly and gitlab-ce.  \n\n#### TODO \n\n- [ ] Remove the feature flag from go first: https://gitlab.com/gitlab-org/gitaly/merge_requests/1484\n- [ ] Remove feature flag from gitlab-ce: https://gitlab.com/gitlab-org/gitlab/merge_requests/16550","state":"closed","created_at":"2019-09-10T12:38:01.716Z","updated_at":"2019-09-13T18:20:52.903Z","closed_at":"2019-09-13T18:20:52.807Z","closed_by":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"},"labels":["Gitaly","Gitaly-Ruby","backstage [DEPRECATED]","devops::create","feature flag","group::gitaly"],"milestone":{"id":731038,"iid":37,"group_id":9970,"title":"12.3","description":"https://about.gitlab.com/releases/2019/09/22/gitlab-12-3-released/","state":"closed","created_at":"2018-12-07T12:40:55.400Z","updated_at":"2020-04-23T21:06:04.173Z","due_date":"2019-09-17","start_date":"2019-08-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/37"},"assignees":[{"id":426128,"username":"felipe_artur","name":"Felipe Artur","state":"active","avatar_url":"https://secure.gravatar.com/avatar/dbad92659914f56621cbdd726e283e60?s=80\u0026d=identicon","web_url":"https://gitlab.com/felipe_artur"}],"author":{"id":426128,"username":"felipe_artur","name":"Felipe Artur","state":"active","avatar_url":"https://secure.gravatar.com/avatar/dbad92659914f56621cbdd726e283e60?s=80\u0026d=identicon","web_url":"https://gitlab.com/felipe_artur"},"type":"ISSUE","assignee":{"id":426128,"username":"felipe_artur","name":"Felipe Artur","state":"active","avatar_url":"https://secure.gravatar.com/avatar/dbad92659914f56621cbdd726e283e60?s=80\u0026d=identicon","web_url":"https://gitlab.com/felipe_artur"},"user_notes_count":2,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/1921","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":2,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/1921","notes":"https://gitlab.com/api/v4/projects/2009901/issues/1921/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/1921/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#1921","relative":"#1921","full":"gitlab-org/gitaly#1921"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":24637373,"iid":1920,"project_id":2009901,"title":"Remove ruby implementation for GetCommitSignatures RPC","description":"GetCommitSignatures RPC has been rewritten using Go in https://gitlab.com/gitlab-org/gitaly/issues/1604. [The old RPC that uses ruby can be removed](https://gitlab.com/gitlab-org/gitaly/blob/master/internal/service/commit/commit_signatures.go#L37).  \n\nMethod signature:  \n\n``` go\nfunc rubyGetCommitSignatures(s *server, request *gitalypb.GetCommitSignaturesRequest, stream gitalypb.CommitService_GetCommitSignaturesServer) error {\n```  \n\n## TODO\n\n- [ ] Remove `rubyGetCommitSignatures` go function\n- [ ] Fix broken specs\n- [ ] if possible remove all ruby code related to`GitalyServer::CommitService#get_commit_signatures`","state":"closed","created_at":"2019-09-10T12:18:50.144Z","updated_at":"2019-09-19T20:45:54.299Z","closed_at":"2019-09-19T20:45:54.245Z","closed_by":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"},"labels":["Gitaly","Gitaly-Ruby","[deprecated] Accepting merge requests","backstage [DEPRECATED]","devops::create","group::gitaly","workflow::ready for development"],"milestone":{"id":731039,"iid":38,"group_id":9970,"title":"12.4","description":"https://about.gitlab.com/releases/2019/10/22/gitlab-12-4-released","state":"closed","created_at":"2018-12-07T12:41:53.212Z","updated_at":"2020-04-27T16:30:43.889Z","due_date":"2019-10-17","start_date":"2019-09-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/38"},"assignees":[{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"}],"author":{"id":426128,"username":"felipe_artur","name":"Felipe Artur","state":"active","avatar_url":"https://secure.gravatar.com/avatar/dbad92659914f56621cbdd726e283e60?s=80\u0026d=identicon","web_url":"https://gitlab.com/felipe_artur"},"type":"ISSUE","assignee":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"user_notes_count":0,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/1920","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":3,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/1920","notes":"https://gitlab.com/api/v4/projects/2009901/issues/1920/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/1920/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#1920","relative":"#1920","full":"gitlab-org/gitaly#1920"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":24395322,"iid":1907,"project_id":2009901,"title":"Roll out get_commit_signatures feature flag","description":"\u003c!-- Title suggestion: [Feature flag] Enable description of feature --\u003e\n\n## What\n\nRemove the `get_commit_signatures` feature flag\n\n## Owners\n\n- Team: Gitaly\n- Most appropriate slack channel to reach out to: `#g_gitaly`\n- Best individual to reach out to: @felipe_artur \n\n## Expectations\n\nCommit signatures request should use use go version of the RPC  \nwhich is expected to be more performant.\n\n### What release does this feature occur in first?\n\n12.3\n\n### What are we expecting to happen?\n\nBetter performance of the RPC\n\n### What might happen if this goes wrong?\n\nWorst case scenario: Stop showing if commit signatures are verified  \nbecause of some exception.  \n\nWe may not see commits page broken because that RPC is made async.\n\n### What can we monitor to detect problems with this?\n\n* https://dashboards.gitlab.net/d/000000199/gitaly-feature-status?from=now-12h\u0026to=now\u0026orgId=1\u0026var-method=GetCommitSignatures\u0026var-job=gitaly\u0026refresh=5m  \n\n* https://sentry.gitlab.net/gitlab/gitaly-production/\n\n* https://sentry.gitlab.net/gitlab/gitaly-production/?query=GetCommitSignatures\n\n## Beta groups/projects\n\nIf applicable, any groups/projects that are happy to have this feature turned on early. Some organizations may wish to test big changes they are interested in with a small subset of users ahead of time for example.\n\n- `gitlab-org/gitlab-ce`/`gitlab-org/gitaly` projects\n- `gitlab-org`/`gitlab-com` groups\n- ...\n\n## Roll Out Steps\n\n- [x] [Read the documentation of feature flags](https://docs.gitlab.com/ee/development/rolling_out_changes_using_feature_flags.html)\n- [x] Enable on staging\n- [x] Test on staging\n- [x] Ensure that documentation has been updated\n- [x] Enable on GitLab.com for individual groups/projects listed above and verify behaviour\n- [x] Announce on the issue an estimated time this will be enabled on GitLab.com\n- [x] Enable on GitLab.com by running chatops command in `#production`\n- [ ] Cross post chatops slack command to `#support_gitlab-com` and in your team channel\n- [x] Announce on the issue that the flag has been enabled\n- [x] Remove feature flag and add changelog entry","state":"closed","created_at":"2019-09-02T17:29:30.955Z","updated_at":"2019-09-16T14:52:15.379Z","closed_at":"2019-09-16T13:14:08.113Z","closed_by":{"id":426128,"username":"felipe_artur","name":"Felipe Artur","state":"active","avatar_url":"https://secure.gravatar.com/avatar/dbad92659914f56621cbdd726e283e60?s=80\u0026d=identicon","web_url":"https://gitlab.com/felipe_artur"},"labels":["Gitaly","backstage [DEPRECATED]","devops::create","feature flag","group::gitaly","workflow::verification"],"milestone":{"id":731038,"iid":37,"group_id":9970,"title":"12.3","description":"https://about.gitlab.com/releases/2019/09/22/gitlab-12-3-released/","state":"closed","created_at":"2018-12-07T12:40:55.400Z","updated_at":"2020-04-23T21:06:04.173Z","due_date":"2019-09-17","start_date":"2019-08-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/37"},"assignees":[{"id":426128,"username":"felipe_artur","name":"Felipe Artur","state":"active","avatar_url":"https://secure.gravatar.com/avatar/dbad92659914f56621cbdd726e283e60?s=80\u0026d=identicon","web_url":"https://gitlab.com/felipe_artur"}],"author":{"id":426128,"username":"felipe_artur","name":"Felipe Artur","state":"active","avatar_url":"https://secure.gravatar.com/avatar/dbad92659914f56621cbdd726e283e60?s=80\u0026d=identicon","web_url":"https://gitlab.com/felipe_artur"},"type":"ISSUE","assignee":{"id":426128,"username":"felipe_artur","name":"Felipe Artur","state":"active","avatar_url":"https://secure.gravatar.com/avatar/dbad92659914f56621cbdd726e283e60?s=80\u0026d=identicon","web_url":"https://gitlab.com/felipe_artur"},"user_notes_count":13,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/1907","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":10,"completed_count":9},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/1907","notes":"https://gitlab.com/api/v4/projects/2009901/issues/1907/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/1907/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#1907","relative":"#1907","full":"gitlab-org/gitaly#1907"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":24173138,"iid":1891,"project_id":2009901,"title":"Remove `ensure_storage_path_exists` from gitlab-ce","description":"as discussed in https://gitlab.com/gitlab-org/gitaly/issues/1807#note_208197834, the first step to deprecating the Namespace service is to get rid of `ensure_storage_path_exists` calls\n\nThere are two parts to this issue:\n\n- Modify RenameNamespace to create the parent directory of the destination dir\n- Remove calls to `ensure_storage_path_exists` calls in gitlab-ce","state":"closed","created_at":"2019-08-26T16:37:40.687Z","updated_at":"2019-10-16T12:38:47.065Z","closed_at":"2019-10-14T09:12:44.194Z","closed_by":{"id":128633,"username":"rymai","name":"Rémy Coutable","state":"active","avatar_url":"https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80\u0026d=identicon","web_url":"https://gitlab.com/rymai"},"labels":["Deliverable","backstage [DEPRECATED]","devops::create","group::gitaly","group::gitaly::cluster","workflow::in review"],"milestone":{"id":731039,"iid":38,"group_id":9970,"title":"12.4","description":"https://about.gitlab.com/releases/2019/10/22/gitlab-12-4-released","state":"closed","created_at":"2018-12-07T12:41:53.212Z","updated_at":"2020-04-27T16:30:43.889Z","due_date":"2019-10-17","start_date":"2019-09-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/38"},"assignees":[{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"}],"author":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"},"type":"ISSUE","assignee":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"},"user_notes_count":3,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/1891","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/1891","notes":"https://gitlab.com/api/v4/projects/2009901/issues/1891/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/1891/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#1891","relative":"#1891","full":"gitlab-org/gitaly#1891"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1877,"epic":{"id":11992,"iid":1877,"title":"🏝 HA Gitaly: minimal reverse proxy","url":"/groups/gitlab-org/-/epics/1877","group_id":9970,"human_readable_end_date":"Nov 17, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":23984510,"iid":1875,"project_id":2009901,"title":"Remove deprecated message handling code","description":"The following discussion from !1410 should be addressed:\n\n- [ ] @zj-gitlab started a [discussion](https://gitlab.com/gitlab-org/gitaly/merge_requests/1410#note_205645542): \n\n    \u003e Post merge I'll create an issue to remove this code in %\"12.4\"\n\nRemove in %\"12.4\", because gitlab-ce/gitlab-ee must be using the new `:messages` param (https://gitlab.com/gitlab-org/gitlab-ce/merge_requests/31640 is currently targeting %\"12.3\").","state":"closed","created_at":"2019-08-20T19:38:13.416Z","updated_at":"2019-09-23T07:13:00.883Z","closed_at":"2019-09-23T07:13:00.832Z","closed_by":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"labels":["auto updated","backstage [DEPRECATED]","devops::create","group::gitaly"],"milestone":{"id":731039,"iid":38,"group_id":9970,"title":"12.4","description":"https://about.gitlab.com/releases/2019/10/22/gitlab-12-4-released","state":"closed","created_at":"2018-12-07T12:41:53.212Z","updated_at":"2020-04-27T16:30:43.889Z","due_date":"2019-10-17","start_date":"2019-09-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/38"},"assignees":[{"id":1144264,"username":"mkozono","name":"Michael Kozono","state":"active","avatar_url":"https://secure.gravatar.com/avatar/6243abba3cf112e6df4a5a644c5f86aa?s=80\u0026d=identicon","web_url":"https://gitlab.com/mkozono"}],"author":{"id":1144264,"username":"mkozono","name":"Michael Kozono","state":"active","avatar_url":"https://secure.gravatar.com/avatar/6243abba3cf112e6df4a5a644c5f86aa?s=80\u0026d=identicon","web_url":"https://gitlab.com/mkozono"},"type":"ISSUE","assignee":{"id":1144264,"username":"mkozono","name":"Michael Kozono","state":"active","avatar_url":"https://secure.gravatar.com/avatar/6243abba3cf112e6df4a5a644c5f86aa?s=80\u0026d=identicon","web_url":"https://gitlab.com/mkozono"},"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/1875","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":1,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/1875","notes":"https://gitlab.com/api/v4/projects/2009901/issues/1875/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/1875/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#1875","relative":"#1875","full":"gitlab-org/gitaly#1875"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":23159924,"iid":1808,"project_id":2009901,"title":"Deprecate ListDirectories RPC","description":"This RPC is only used in cleanup rake tasks, as far as I can tell. E.g. https://gitlab.com/gitlab-org/gitlab-ce/blob/master/lib/tasks/gitlab/cleanup.rake#L7\n\nThis is problematic for Gitaly HA because we there will be directories on multiple different Gitaly servers and we don't want to directly expose those Gitaly servers.\n\nWe should take a look at the things that use ListDirectories, and reimplement whatever it is they do inside Gitaly. In some cases it might be automated cleanup; in other cases we might need a new RPC. In the latter case that RPC should express what we want to happen, and leave the actual work to Gitaly.","state":"closed","created_at":"2019-07-25T13:46:45.607Z","updated_at":"2019-11-13T16:25:43.720Z","closed_at":"2019-11-08T08:29:23.819Z","closed_by":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"labels":["Deliverable","auto updated","backstage [DEPRECATED]","devops::create","group::gitaly","group::gitaly::cluster","workflow::in review"],"milestone":{"id":891796,"iid":39,"group_id":9970,"title":"12.5","description":"https://about.gitlab.com/releases/2019/11/22/gitlab-12-5-released","state":"closed","created_at":"2019-05-31T08:38:03.087Z","updated_at":"2020-04-27T16:27:03.474Z","due_date":"2019-11-17","start_date":"2019-10-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/39"},"assignees":[{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"}],"author":{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/513969/avatar.png","web_url":"https://gitlab.com/jacobvosmaer-gitlab"},"type":"ISSUE","assignee":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"},"user_notes_count":9,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/1808","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/1808","notes":"https://gitlab.com/api/v4/projects/2009901/issues/1808/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/1808/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#1808","relative":"#1808","full":"gitlab-org/gitaly#1808"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":1877,"epic":{"id":11992,"iid":1877,"title":"🏝 HA Gitaly: minimal reverse proxy","url":"/groups/gitlab-org/-/epics/1877","group_id":9970,"human_readable_end_date":"Nov 17, 2019","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":21848253,"iid":1728,"project_id":2009901,"title":"remote: warning: ignoring extra bitmap file when pulling from a deduplicated repo","description":"Seen today on the gitlab-org/gitlab-pages repository:\n\n```\n$ git fetch upstream master\nremote: warning: ignoring extra bitmap file: /var/opt/gitlab/git-data/repositories/@pools/81/17/811786ad1ae74adfdd20dd0372abaaebc6246e343aebd01da0bfc4c02bf0106c.git/objects/pack/pack-1d59d5e04b0538cfc7fb23125f81c317aafd0b10.pack\n```\n\nI think we try to avoid displaying server-side paths to the client in other cases. Other than that, it didn't seem to affect anything - the fetch succeeded and had all the objects I expected.","state":"closed","created_at":"2019-06-12T16:36:11.114Z","updated_at":"2021-01-27T10:48:07.766Z","closed_at":"2020-05-18T11:13:39.442Z","closed_by":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"labels":["Category:Gitaly","SLO::Missed","devops::create","git object deduplication","group::gitaly","missed-deliverable","missed:12.1","missed:12.5","missed:12.6","missed:12.7","priority::2","severity::4","type::bug","workflow::in review"],"milestone":{"id":991112,"iid":42,"group_id":9970,"title":"13.0","description":"","state":"closed","created_at":"2019-09-04T15:20:39.024Z","updated_at":"2020-10-08T12:00:55.725Z","due_date":"2020-05-17","start_date":"2020-04-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/42"},"assignees":[{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"}],"author":{"id":572018,"username":"nick.thomas","name":"Nick Thomas","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/572018/avatar.png","web_url":"https://gitlab.com/nick.thomas"},"type":"ISSUE","assignee":{"id":1902115,"username":"pks-gitlab","name":"Patrick Steinhardt","state":"active","avatar_url":"https://secure.gravatar.com/avatar/0fec8836f293852876f02d1afd7f2aaf?s=80\u0026d=identicon","web_url":"https://gitlab.com/pks-gitlab"},"user_notes_count":41,"merge_requests_count":1,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/1728","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/1728","notes":"https://gitlab.com/api/v4/projects/2009901/issues/1728/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/1728/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#1728","relative":"#1728","full":"gitlab-org/gitaly#1728"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":189,"epic":{"id":385,"iid":189,"title":"Create forks of public projects with deduplicated Git objects","url":"/groups/gitlab-org/-/epics/189","group_id":9970,"human_readable_end_date":"May 17, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":21331132,"iid":1690,"project_id":2009901,"title":"Remove Rugged patches from gitlab","description":"We have been forced to walk back part of the Gitaly migration project because it turned out that in certain scenarios, the old gitlab-ce code that used Rugged is still significantly more performant than the new Gitaly code. Specifically, this is the case for some GitLab installations that host their Git repository data on slow NFS servers.\n\nThe code in question can be found here: https://gitlab.com/gitlab-org/gitlab-ce/tree/master/lib/gitlab/git/rugged_impl\n\nThis is blocking us from completing the Gitaly migration project. These rugged patches should be removed again. This issue is meant to track their removal.\n\n## Current Plan of Record for 14.3 and beyond\n\n_Summary of the discussion in the below thread_\n\nWe don't believe that the Rugged patches are necessary for our customers utilizing NFS as we believe that [performance issues necessitating these patches are mitigated](https://gitlab.com/gitlab-org/gitaly/-/issues/1690#note_584475955).\n\nAs the Rugged patches create an additional maintenance concern for the Gitaly team, as well as not supporting the direction of moving customers requiring HA towards Gitaly Cluster. We therefore feel that they should be removed.\n\nStarting in %\"14.3\", we will default to disabling the Rugged patches. As stated above, we don't believe that this will cause any performance issues for our users.\n\n### Mitigations pending customer issues\n\n- The Rugged patches are currently behind a feature flag. Starting in %\"14.3\" we will be defaulting this feature flag to disable Rugged, but we will not be removing the feature flag. If customers notice performance degradation, they can re-enable the Rugged patches via the feature flag. \n\n- Pending significant customer performance issues, the current plan is to remove the Rugged patches a couple of releases past %\"14.3\"  and the associated feature flag.","state":"closed","created_at":"2019-05-27T12:19:43.930Z","updated_at":"2023-03-30T14:12:46.704Z","closed_at":"2023-03-30T14:12:46.419Z","closed_by":{"id":4586870,"username":"mjwood","name":"Mark Wood","state":"active","avatar_url":"https://secure.gravatar.com/avatar/4376afce32152d684a9563d594dbb257?s=80\u0026d=identicon","web_url":"https://gitlab.com/mjwood"},"labels":["Category:Gitaly","[deprecated] Accepting merge requests","customer","devops::systems","group::gitaly","section::dev","type::feature"],"milestone":{"id":490705,"iid":14,"group_id":9970,"title":"Backlog","description":"Issues that we want to do but are not planned right now. Open for contribution from the community.","state":"active","created_at":"2018-03-22T13:09:23.767Z","updated_at":"2018-10-30T14:56:54.069Z","due_date":null,"start_date":null,"expired":false,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/14"},"assignees":[],"author":{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/513969/avatar.png","web_url":"https://gitlab.com/jacobvosmaer-gitlab"},"type":"ISSUE","assignee":null,"user_notes_count":87,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/1690","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/1690","notes":"https://gitlab.com/api/v4/projects/2009901/issues/1690/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/1690/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#1690","relative":"#1690","full":"gitlab-org/gitaly#1690"},"severity":"UNKNOWN","moved_to_id":126003579,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":27219683,"iid":2180,"project_id":2009901,"title":"GetCommitSignatures' messages can be too large","description":"https://sentry.gitlab.net/gitlab/gitlabcom/issues/736414/\n\n```\nGRPC::ResourceExhausted: 8:Received message larger than max (6302368 vs. 4194304)\n  grpc/generic/active_call.rb:31:in `check_status'\n    fail GRPC::BadStatus.new_status_exception(\n  grpc/generic/active_call.rb:181:in `attach_status_results_and_complete_call'\n    recv_status_batch_result.check_status\n  grpc/generic/active_call.rb:170:in `receive_and_check_status'\n    attach_status_results_and_complete_call(batch_result)\n  grpc/generic/active_call.rb:338:in `each_remote_read_then_finish'\n    receive_and_check_status\n  gitlab/gitaly_client/commit_service.rb:440:in `each'\n    response.flat_map do |message|\n...\n(158 additional frame(s) were not displayed)\n\nGitlab::Git::CommandError: 8:Received message larger than max (6302368 vs. 4194304)\n  gitlab/git/wraps_gitaly_errors.rb:13:in `rescue in wrapped_gitaly_errors'\n    raise Gitlab::Git::CommandError.new(e)\n  gitlab/git/wraps_gitaly_errors.rb:6:in `wrapped_gitaly_errors'\n    def wrapped_gitaly_errors(\u0026block)\n  gitlab/metrics/instrumentation.rb:161:in `block in wrapped_gitaly_errors'\n    .measure { super }\n  gitlab/metrics/method_call.rb:36:in `measure'\n    retval = yield\n  gitlab/metrics/instrumentation.rb:161:in `wrapped_gitaly_errors'\n    .measure { super }\n...\n(150 additional frame(s) were not displayed)\n\nGitlab::Git::CommandError: 8:Received message larger than max (6302368 vs. 4194304)\n```","state":"closed","created_at":"2019-05-06T10:42:07.284Z","updated_at":"2020-04-22T22:09:36.313Z","closed_at":"2020-04-22T21:52:17.806Z","closed_by":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"},"labels":["Category:Gitaly","SLO::Missed","customer","devops::create","group::gitaly","priority::2","severity::3","type::bug","workflow::ready for development"],"milestone":{"id":991112,"iid":42,"group_id":9970,"title":"13.0","description":"","state":"closed","created_at":"2019-09-04T15:20:39.024Z","updated_at":"2020-10-08T12:00:55.725Z","due_date":"2020-05-17","start_date":"2020-04-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/42"},"assignees":[{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"}],"author":{"id":402401,"username":"jobbot","name":"Bot","state":"active","avatar_url":"https://secure.gravatar.com/avatar/aaa6738f1ebf25404010884af511b0e7?s=80\u0026d=identicon","web_url":"https://gitlab.com/jobbot"},"type":"ISSUE","assignee":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"},"user_notes_count":11,"merge_requests_count":0,"upvotes":2,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/2180","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/2180","notes":"https://gitlab.com/api/v4/projects/2009901/issues/2180/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/2180/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#2180","relative":"#2180","full":"gitlab-org/gitaly#2180"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":20590064,"iid":1649,"project_id":2009901,"title":"Fail to start if the pid file is empty","description":"``gitaly`` cannot start if the pid file is empty.\n\nFirst found [here](https://forum.gitlab.com/t/gitaly-fail-14-connect-failed/26137).\n\nI cannot figure out how the pid file becomes empty, but probably we can handle this situation?","state":"closed","created_at":"2019-05-05T08:37:03.357Z","updated_at":"2020-05-25T15:13:47.831Z","closed_at":"2020-05-25T15:09:53.051Z","closed_by":{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5522960/avatar.png","web_url":"https://gitlab.com/samihiltunen"},"labels":["Category:Gitaly","customer","devops::create","group::gitaly","severity::2","type::bug"],"milestone":{"id":1112145,"iid":47,"group_id":9970,"title":"13.1","description":"","state":"closed","created_at":"2020-01-03T12:28:30.160Z","updated_at":"2020-10-08T12:01:07.361Z","due_date":"2020-06-17","start_date":"2020-05-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/47"},"assignees":[{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5522960/avatar.png","web_url":"https://gitlab.com/samihiltunen"}],"author":{"id":922506,"username":"XiaofengWang","name":"Xiaofeng Wang","state":"active","avatar_url":"https://secure.gravatar.com/avatar/69be270b80d0602ea4fd7eafc744d9e8?s=80\u0026d=identicon","web_url":"https://gitlab.com/XiaofengWang"},"type":"ISSUE","assignee":{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5522960/avatar.png","web_url":"https://gitlab.com/samihiltunen"},"user_notes_count":9,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/1649","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/1649","notes":"https://gitlab.com/api/v4/projects/2009901/issues/1649/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/1649/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#1649","relative":"#1649","full":"gitlab-org/gitaly#1649"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":17980204,"iid":1480,"project_id":2009901,"title":"CalculateChecksum: invalid memory address or nil pointer","description":"Seen 553 instances of this in 4 hours of customer's Gitaly logs (ZenDesk: https://gitlab.zendesk.com/agent/tickets/111902):\n\n```\n2019-02-04_22:21:04.33575 time=\"2019-02-04T22:21:04Z\" level=error msg=\"grpc panic\" error=\"runtime error: invalid memory address or nil pointer dereference\" method=/gitaly.RepositoryService/CalculateChecksum\n```\n\nThey are running GitLab 11.5.4.\n\nUnfortunately I don't see a backtrace, but I think we need to fix this ASAP.\n\n/cc: @dbalexandre","state":"closed","created_at":"2019-02-05T16:14:24.155Z","updated_at":"2019-12-17T15:50:59.898Z","closed_at":"2019-02-07T18:14:50.586Z","closed_by":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"},"labels":["Category:Geo Replication","customer","devops::systems","group::geo","type::bug","workflow::in review"],"milestone":{"id":581391,"iid":23,"group_id":9970,"title":"11.8","description":"","state":"closed","created_at":"2018-06-26T15:15:18.359Z","updated_at":"2019-03-08T17:33:19.162Z","due_date":"2019-02-22","start_date":"2019-01-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/23"},"assignees":[{"id":283999,"username":"dbalexandre","name":"Douglas Barbosa Alexandre","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/283999/avatar.png","web_url":"https://gitlab.com/dbalexandre"}],"author":{"id":64248,"username":"stanhu","name":"Stan Hu","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/64248/stanhu.jpg","web_url":"https://gitlab.com/stanhu"},"type":"ISSUE","assignee":{"id":283999,"username":"dbalexandre","name":"Douglas Barbosa Alexandre","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/283999/avatar.png","web_url":"https://gitlab.com/dbalexandre"},"user_notes_count":4,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/1480","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/1480","notes":"https://gitlab.com/api/v4/projects/2009901/issues/1480/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/1480/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#1480","relative":"#1480","full":"gitlab-org/gitaly#1480"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":16771769,"iid":1439,"project_id":2009901,"title":"Deleting tag fails when branch and tag exists with the same name","description":"While testing https://gitlab.com/gitlab-org/gitaly/merge_requests/1006, I have a test that attempts to delete the tag `v1.1.0`, but this fails because https://gitlab.com/gitlab-org/gitlab-test has both `refs/heads/v1.1.0` and `refs/tags/v1.1.0`:\n\n```\ntime=\"2018-12-18T11:21:15-08:00\" level=info msg=\"I, [2018-12-18T11:21:15.603634 #38932]  INFO -- : Pushing deleted branches from /Users/stanhu/gitlab/gitaly/internal/testhelper/testdata/data/TestSuccessfulUpdateRemoteMirrorRequestWithWildcards066627066 to remote remote_mirror_2: [\\\"v1.1.0\\\"]\" supervisor.args=\"[bundle exec bin/ruby-cd /Users/stanhu/gitlab/gitaly/_build/src/gitlab.com/gitlab-org/gitaly/internal/service/remote /Users/stanhu/gitlab/gitaly/_build/src/gitlab.com/gitlab-org/gitaly/ruby/bin/gitaly-ruby 38900 /var/folders/jf/z0tr5kvs589dk92xkzkk49wc0000gn/T/gitaly-ruby944237139/socket.1]\" supervisor.name=gitaly-ruby.1\n--- FAIL: TestSuccessfulUpdateRemoteMirrorRequestWithWildcards (1.17s)\n    test_hook.go:39: time=\"2018-12-18T11:21:15-08:00\" level=error msg=\"finished streaming call with code Unknown\" error=\"rpc error: code = Unknown desc = Gitlab::Git::CommandError: warning: refname '1942eed5cc108b19c7405106e81fa96125d0be22' is ambiguous.\\nGit normally never creates a ref that ends with 40 hex characters\\nbecause it will be ignored when you just specify 40-hex. These refs\\nmay be created by mistake. For example,\\n\\n  git checkout -b $br $(git rev-parse ...)\\n\\nwhere \\\"$br\\\" is somehow empty and a 40-hex ref is created. Please\\nexamine these refs and maybe delete them. Turn this message off by\\nrunning \\\"git config advice.objectNameWarning false\\\"\\nTo /Users/stanhu/gitlab/gitaly/internal/testhelper/testdata/data/TestSuccessfulUpdateRemoteMirrorRequestWithWildcards080387857\\n * [new branch]      11-0-stable -\u003e 11-0-stable\\n * [new branch]      11-1-stable -\u003e 11-1-stable\\nwarning: refname '1942eed5cc108b19c7405106e81fa96125d0be22' is ambiguous.\\nGit normally never creates a ref that ends with 40 hex characters\\nbecause it will be ignored when you just specify 40-hex. These refs\\nmay be created by mistake. For example,\\n\\n  git checkout -b $br $(git rev-parse ...)\\n\\nwhere \\\"$br\\\" is somehow empty and a 40-hex ref is created. Please\\nexamine these refs and maybe delete them. Turn this message off by\\nrunning \\\"git config advice.objectNameWarning false\\\"\\nTo /Users/stanhu/gitlab/gitaly/internal/testhelper/testdata/data/TestSuccessfulUpdateRemoteMirrorRequestWithWildcards080387857\\n + f4e6814...33fde33 v1.0.0 -\u003e v1.0.0 (forced update)\\n * [new tag]         new-tag -\u003e new-tag\\nerror: dst refspec v1.1.0 matches more than one.\\nerror: failed to push some refs to '/Users/stanhu/gitlab/gitaly/internal/testhelper/testdata/data/TestSuccessfulUpdateRemoteMirrorRequestWithWildcards080387857'\\n\" grpc.code=Unknown grpc.method=UpdateRemoteMirror grpc.service=gitaly.RemoteService grpc.start_time=\"2018-12-18T11:21:15-08:00\" grpc.time_ms=425.41 span.kind=server system=grpc test=TestSuccessfulUpdateRemoteMirrorRequestWithWildcards\n\n    require.go:794:\n                Error Trace:    update_remote_mirror_test.go:138\n                Error:          Received unexpected error:\n                                rpc error: code = Unknown desc = Gitlab::Git::CommandError: warning: refname '1942eed5cc108b19c7405106e81fa96125d0be22' is ambiguous.\n                                Git normally never creates a ref that ends with 40 hex characters\n                                because it will be ignored when you just specify 40-hex. These refs\n                                may be created by mistake. For example,\n\n                                  git checkout -b $br $(git rev-parse ...)\n\n```\n\nThis is similar to https://gitlab.com/gitlab-org/gitaly/issues/1329.","state":"closed","created_at":"2018-12-18T19:31:54.299Z","updated_at":"2020-05-18T07:08:34.882Z","closed_at":"2020-04-22T10:53:04.418Z","closed_by":{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/513969/avatar.png","web_url":"https://gitlab.com/jacobvosmaer-gitlab"},"labels":["Category:Gitaly","Deliverable","devops::create","group::gitaly","missed-deliverable","missed:12.10","priority::3","type::bug","workflow::in review"],"milestone":{"id":991112,"iid":42,"group_id":9970,"title":"13.0","description":"","state":"closed","created_at":"2019-09-04T15:20:39.024Z","updated_at":"2020-10-08T12:00:55.725Z","due_date":"2020-05-17","start_date":"2020-04-18","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/42"},"assignees":[{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5522960/avatar.png","web_url":"https://gitlab.com/samihiltunen"}],"author":{"id":64248,"username":"stanhu","name":"Stan Hu","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/64248/stanhu.jpg","web_url":"https://gitlab.com/stanhu"},"type":"ISSUE","assignee":{"id":5522960,"username":"samihiltunen","name":"Sami Hiltunen","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/5522960/avatar.png","web_url":"https://gitlab.com/samihiltunen"},"user_notes_count":6,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/1439","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/1439","notes":"https://gitlab.com/api/v4/projects/2009901/issues/1439/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/1439/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#1439","relative":"#1439","full":"gitlab-org/gitaly#1439"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":16750530,"iid":1437,"project_id":2009901,"title":"Remove Gitlab::GitLogger","description":"The Gitlab::GitLogger logs just one error, which is returned to the client too. I think in that case that should be enough because of the interceptors we use.\n\n/cc @johncai @jacobvosmaer\\-gitlab","state":"closed","created_at":"2018-12-18T10:48:51.560Z","updated_at":"2019-03-12T13:48:36.911Z","closed_at":"2019-03-12T13:48:36.882Z","closed_by":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"labels":["maintenance::refactor"],"milestone":null,"assignees":[{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"type":"ISSUE","assignee":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"},"user_notes_count":2,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/1437","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/1437","notes":"https://gitlab.com/api/v4/projects/2009901/issues/1437/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/1437/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#1437","relative":"#1437","full":"gitlab-org/gitaly#1437"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":16732142,"iid":1436,"project_id":2009901,"title":"Snapshots don't work with dedup","description":"Gitaly's snapshots won't work for repositories that use object pool as we ignore `objects/info/alternates`. Theoretically, it's possible to include objects from an object pool to the TAR archive.\n\nSee https://gitlab.com/gitlab-org/gitaly/issues/1410 for details","state":"closed","created_at":"2018-12-17T20:50:12.912Z","updated_at":"2019-12-17T15:50:59.809Z","closed_at":"2019-02-19T20:27:59.463Z","closed_by":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"},"labels":["devops::create","forking","group::gitaly","priority::3","regression","severity::3","type::bug"],"milestone":{"id":523180,"iid":18,"group_id":9970,"title":"11.9","description":"https://about.gitlab.com/releases/2019/03/22/gitlab-11-9-released/","state":"closed","created_at":"2018-05-09T14:56:19.024Z","updated_at":"2020-04-30T19:56:35.917Z","due_date":"2019-03-22","start_date":"2019-02-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/18"},"assignees":[{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"}],"author":{"id":59678,"username":"vsizov","name":"Valery Sizov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/59678/avatar.png","web_url":"https://gitlab.com/vsizov"},"type":"ISSUE","assignee":{"id":668120,"username":"johncai","name":"John Cai","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/668120/avatar.png","web_url":"https://gitlab.com/johncai"},"user_notes_count":14,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/1436","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/1436","notes":"https://gitlab.com/api/v4/projects/2009901/issues/1436/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/1436/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#1436","relative":"#1436","full":"gitlab-org/gitaly#1436"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":189,"epic":{"id":385,"iid":189,"title":"Create forks of public projects with deduplicated Git objects","url":"/groups/gitlab-org/-/epics/189","group_id":9970,"human_readable_end_date":"May 17, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":16209276,"iid":1410,"project_id":2009901,"title":"Support Geo for dedupped repositories","description":"Geo needs to perform the same operation on the secondairies. Not sure what is required from the Gitaly team, so please consider this a tracking issue.","state":"closed","created_at":"2018-11-29T10:15:07.787Z","updated_at":"2019-12-16T11:46:49.568Z","closed_at":"2019-01-08T09:17:38.097Z","closed_by":{"id":59678,"username":"vsizov","name":"Valery Sizov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/59678/avatar.png","web_url":"https://gitlab.com/vsizov"},"labels":["Deliverable","devops::create","forking","group::gitaly","product discovery [DEPRECATED]","workflow::in review"],"milestone":{"id":581385,"iid":22,"group_id":9970,"title":"11.7","description":"","state":"closed","created_at":"2018-06-26T15:14:47.054Z","updated_at":"2019-02-07T18:12:10.925Z","due_date":"2019-01-22","start_date":"2018-12-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/22"},"assignees":[{"id":59678,"username":"vsizov","name":"Valery Sizov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/59678/avatar.png","web_url":"https://gitlab.com/vsizov"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"type":"ISSUE","assignee":{"id":59678,"username":"vsizov","name":"Valery Sizov","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/59678/avatar.png","web_url":"https://gitlab.com/vsizov"},"user_notes_count":43,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/1410","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":13,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/1410","notes":"https://gitlab.com/api/v4/projects/2009901/issues/1410/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/1410/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#1410","relative":"#1410","full":"gitlab-org/gitaly#1410"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":189,"epic":{"id":385,"iid":189,"title":"Create forks of public projects with deduplicated Git objects","url":"/groups/gitlab-org/-/epics/189","group_id":9970,"human_readable_end_date":"May 17, 2020","human_readable_timestamp":"\u003cstrong\u003ePast due\u003c/strong\u003e"},"iteration":null,"health_status":null},{"id":15695396,"iid":1392,"project_id":2009901,"title":"Stop symlinking the hooks directory","description":"Part of: https://gitlab.com/gitlab-org/gitaly/issues/1226\n\nThe hooks are now executed by setting them explicitly each git shellout, instead of executing the `path/to/repo.git/hooks` which is symlinked to the `gitlab-shell/hooks` dir.\n\nThe symlinking still happens, but this could stop. Downside of stopping doing so, is that a client could not downgrade the GitLab version with a minor release as the projects that got created in the mean time wouldn't have the symlink.\n\nThe cost to keep symlinking is low, but I'd recommend removing the symlinking around %\"12.0\" to avoid confusion and have one way of doing so.\n\nAdded this to that milestone, feel free to remove @jramsay :)","state":"closed","created_at":"2018-11-09T08:26:18.468Z","updated_at":"2019-09-18T14:31:55.658Z","closed_at":"2019-05-11T16:08:00.310Z","closed_by":{"id":3386176,"username":"pokstad1","name":"Paul Okstad (ex-GitLab)","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/3386176/avatar.png","web_url":"https://gitlab.com/pokstad1"},"labels":["Deliverable","devops::create","group::gitaly","maintenance::refactor"],"milestone":{"id":693518,"iid":33,"group_id":9970,"title":"12.0","description":"https://about.gitlab.com/releases/2019/06/22/gitlab-12-0-released/","state":"closed","created_at":"2018-10-30T16:47:37.975Z","updated_at":"2020-04-22T19:51:03.475Z","due_date":"2019-06-22","start_date":"2019-05-08","expired":true,"web_url":"https://gitlab.com/groups/gitlab-org/-/milestones/33"},"assignees":[{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"}],"author":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"type":"ISSUE","assignee":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"user_notes_count":6,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/1392","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/1392","notes":"https://gitlab.com/api/v4/projects/2009901/issues/1392/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/1392/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#1392","relative":"#1392","full":"gitlab-org/gitaly#1392"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":15977073,"iid":1403,"project_id":2009901,"title":"Importing Project on same instance from URL fails","description":"### Summary\n\nImport a repository from the same GitLab instance during project creation is failing with the error message below displayed on the empty repository's import screen.\n\n```\nEvery import attempt has failed: Error importing repository https://ckgltest.s.co.zw/root/greenie.git into root/greenie-import - 13:CreateRepositoryFromURL: clone cmd wait: exit status 128. Please try again.\n```\n\n### Steps to reproduce\n\n* Create a new project and select import by Git URL.\n* Enter the URL of another project within our GitLab instance and run the import.\n\n### Example Project\n\nFailed to reproduce on GitLab.com but reproduced successfully on 11.0.3-ee\n\n### What is the expected *correct* behavior?\n\nProject should be imported without errors. This was working for the [customer](https://gitlab.zendesk.com/agent/tickets/100000)  before upgrading to 11.0\n\n### Relevant logs and/or screenshots\n\n![Screen_Shot_2018-07-10_at_09.56.45](/uploads/f979d9588b839bce7509f23948d0c01e/Screen_Shot_2018-07-10_at_09.56.45.png)","state":"closed","created_at":"2018-07-10T08:06:20.274Z","updated_at":"2020-06-17T07:36:03.738Z","closed_at":"2020-06-17T07:36:03.669Z","closed_by":{"id":101578,"username":"zj-gitlab","name":"Zeger-Jan van de Weg","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/101578/avatar.png","web_url":"https://gitlab.com/zj-gitlab"},"labels":["Category:Gitaly","bug::performance","customer","devops::create","group::gitaly","missed:13.0","priority::3","regression","regression:11.3","severity::3","type::bug","workflow::in dev"],"milestone":null,"assignees":[{"id":1349468,"username":"ckatanda","name":"Chenjerai Katanda","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1349468/avatar.png","web_url":"https://gitlab.com/ckatanda"}],"author":{"id":1349468,"username":"ckatanda","name":"Chenjerai Katanda","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1349468/avatar.png","web_url":"https://gitlab.com/ckatanda"},"type":"ISSUE","assignee":{"id":1349468,"username":"ckatanda","name":"Chenjerai Katanda","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/1349468/avatar.png","web_url":"https://gitlab.com/ckatanda"},"user_notes_count":47,"merge_requests_count":0,"upvotes":7,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/1403","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/1403","notes":"https://gitlab.com/api/v4/projects/2009901/issues/1403/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/1403/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#1403","relative":"#1403","full":"gitlab-org/gitaly#1403"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":5257325,"iid":203,"project_id":2009901,"title":"Go 1.8","description":"This is a placeholder issue to discuss upgrading Go to 1.8, now that https://gitlab.com/gitlab-org/omnibus-gitlab/issues/2279 is merged. \n\n- Update CI to stop testing on Go 1.5 / 1.6 and 1.7. \n- Update documentation for developer requirements\n- Discuss any potential code changes that may follow on from this change in future (for example, related to context)","state":"closed","created_at":"2017-05-02T08:41:18.269Z","updated_at":"2019-08-07T08:28:45.047Z","closed_at":"2017-06-06T11:19:26.402Z","closed_by":null,"labels":["devops::systems","group::distribution"],"milestone":{"id":286698,"iid":12,"project_id":2009901,"title":"9.3","description":"","state":"closed","created_at":"2017-03-21T10:10:13.485Z","updated_at":"2017-07-06T12:27:27.330Z","due_date":"2017-06-07","start_date":"2017-05-23","expired":true,"web_url":"https://gitlab.com/gitlab-org/gitaly/-/milestones/12"},"assignees":[],"author":{"id":895869,"username":"andrewn","name":"Andrew Newdigate","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/895869/avatar.png","web_url":"https://gitlab.com/andrewn"},"type":"ISSUE","assignee":null,"user_notes_count":2,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/203","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/203","notes":"https://gitlab.com/api/v4/projects/2009901/issues/203/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/203/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#203","relative":"#203","full":"gitlab-org/gitaly#203"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":5200506,"iid":201,"project_id":2009901,"title":"Gitlab-shell hooks can no longer send absolute paths to gitlab-ce","description":"~\"Client Implementation\": https://gitlab.com/gitlab-org/gitlab-ce/issues/29925\r\n\r\nAdditional tasks: \r\n  - https://gitlab.com/gitlab-org/gitaly/issues/150\r\n  - https://gitlab.com/gitlab-org/gitaly/issues/151","state":"closed","created_at":"2017-04-26T14:04:50.413Z","updated_at":"2017-07-05T14:48:08.143Z","closed_at":"2017-06-29T08:19:07.042Z","closed_by":null,"labels":["Setup","Sharding"],"milestone":{"id":325402,"iid":20,"project_id":2009901,"title":"Milestone 2017-06-16","description":"### GitLab 9.3 Cutoff\r\n\r\n- What do we need to deliver for GitLab 9.3?","state":"closed","created_at":"2017-06-05T13:18:07.281Z","updated_at":"2017-07-06T12:50:40.535Z","due_date":"2017-06-16","start_date":"2017-06-05","expired":true,"web_url":"https://gitlab.com/gitlab-org/gitaly/-/milestones/20"},"assignees":[{"id":367626,"username":"alejandro","name":"Alejandro Rodríguez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"}],"author":{"id":895869,"username":"andrewn","name":"Andrew Newdigate","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/895869/avatar.png","web_url":"https://gitlab.com/andrewn"},"type":"ISSUE","assignee":{"id":367626,"username":"alejandro","name":"Alejandro Rodríguez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"},"user_notes_count":2,"merge_requests_count":6,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/201","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/201","notes":"https://gitlab.com/api/v4/projects/2009901/issues/201/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/201/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#201","relative":"#201","full":"gitlab-org/gitaly#201"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":5200434,"iid":200,"project_id":2009901,"title":"Test how GitLab behaves when Gitaly is Down","description":"@pcarranza's idea:\n\u003e test how does GitLab behaves when a Gitaly server is down - we need better resiliency when an NFS server goes down, since it will happen again and we will be running Gitaly on those hosts, we need to be sure that the application will survive when they go dark. For this I propose that we actually test how gRPC behaves and we code for resiliency from now and not as an afterthought.","state":"closed","created_at":"2017-04-26T13:55:34.459Z","updated_at":"2018-03-05T20:42:09.281Z","closed_at":"2018-02-26T16:58:43.507Z","closed_by":null,"labels":[],"milestone":null,"assignees":[{"id":895869,"username":"andrewn","name":"Andrew Newdigate","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/895869/avatar.png","web_url":"https://gitlab.com/andrewn"}],"author":{"id":895869,"username":"andrewn","name":"Andrew Newdigate","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/895869/avatar.png","web_url":"https://gitlab.com/andrewn"},"type":"ISSUE","assignee":{"id":895869,"username":"andrewn","name":"Andrew Newdigate","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/895869/avatar.png","web_url":"https://gitlab.com/andrewn"},"user_notes_count":18,"merge_requests_count":0,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/200","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/200","notes":"https://gitlab.com/api/v4/projects/2009901/issues/200/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/200/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#200","relative":"#200","full":"gitlab-org/gitaly#200"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":5200084,"iid":199,"project_id":2009901,"title":"Client Implementation: CommitDiff changes for deltas_only","description":"~Conversation: #222 \r\n\r\n~\"RPC Design\": https://gitlab.com/gitlab-org/gitaly-proto/merge_requests/15 \r\n\r\n~\"Server Implementation\": #178\r\n\r\n----------------------------------------------\r\n\r\nUpdate GitLab-CE with the CommitDiff changes for `deltas_only`","state":"closed","created_at":"2017-04-26T13:20:27.666Z","updated_at":"2017-05-23T17:12:52.869Z","closed_at":"2017-05-14T20:03:20.971Z","closed_by":null,"labels":[],"milestone":{"id":305102,"iid":17,"project_id":2009901,"title":"Milestone 2017-05-19","description":"[GitLab 9.2 release](https://gitlab.com/gitlab-org/gitlab-ce/milestones/36) has been cut, which means that the Gitaly team can start testing Gitaly running across a network. \r\n\r\nThemes: ~\"Acceptance Testing\" \r\n\r\n## Testing\r\n\r\nOur **top priority** for this release is to [test our implementations](https://gitlab.com/gitlab-org/gitaly/issues?scope=all\u0026utf8=%E2%9C%93\u0026state=opened\u0026label_name[]=Acceptance%20Testing\u0026milestone_title=Milestone%202017-05-19).\r\n\r\n@jacobvosmaer-gitlab will focus on testing [Gitaly running across the network](https://gitlab.com/gitlab-org/gitaly/issues/181) and how [GitLab handled Gitaly failures](https://gitlab.com/gitlab-org/gitaly/issues/200).\r\n\r\n@eReGeBe @ahmadsherif and @bkc will focus on testing the migrations: \r\n\r\n- #215 \r\n- #211\r\n- #210 \r\n- #209 \r\n- #184\r\n\r\n@andrewn has added some documentation about what we expect from the [acceptance testing]( \r\nhttps://gitlab.com/gitlab-org/gitaly/merge_requests/144/diffs#36e74ccc6a563cded188bd7806cb126dff075937)\r\n\r\n\r\n## Waiting for 9.2 RC1\r\n\r\nThere may be some slacktime between the start of the iteration and the availability of 9.2RC1. \r\n\r\nDuring this time, please focus on\r\n\r\n- Completing work left over from the last iteration\r\n- Other tasks assigned to you for this milestone\r\n- If you are still available, speak to @andrewn or pick a task from ~\"To Do\"\r\n\r\nPlease note that once 9.2 is available on staging, you'll need to switch across to testing as this is our top priority. If we leave testing too late, we may miss the release and will need to delay some of the feature flags by another release.\r\n\r\n\r\n\r\n","state":"closed","created_at":"2017-04-26T12:05:56.503Z","updated_at":"2017-07-06T08:50:46.869Z","due_date":"2017-05-19","start_date":"2017-05-08","expired":true,"web_url":"https://gitlab.com/gitlab-org/gitaly/-/milestones/17"},"assignees":[{"id":506061,"username":"ahmadsherif","name":"Ahmad Sherif","state":"active","avatar_url":"https://secure.gravatar.com/avatar/bd6d0ec4213b91601956c9f801cbfe9b?s=80\u0026d=identicon","web_url":"https://gitlab.com/ahmadsherif"}],"author":{"id":895869,"username":"andrewn","name":"Andrew Newdigate","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/895869/avatar.png","web_url":"https://gitlab.com/andrewn"},"type":"ISSUE","assignee":{"id":506061,"username":"ahmadsherif","name":"Ahmad Sherif","state":"active","avatar_url":"https://secure.gravatar.com/avatar/bd6d0ec4213b91601956c9f801cbfe9b?s=80\u0026d=identicon","web_url":"https://gitlab.com/ahmadsherif"},"user_notes_count":0,"merge_requests_count":6,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/199","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/199","notes":"https://gitlab.com/api/v4/projects/2009901/issues/199/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/199/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#199","relative":"#199","full":"gitlab-org/gitaly#199"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":5200076,"iid":198,"project_id":2009901,"title":"Client Implementation: CommitDiff changes for whitespace_changes_only and path","description":"~\"RPC Design\": https://gitlab.com/gitlab-org/gitaly-proto/merge_requests/15 \r\n\r\n~\"Server Implementation\": #178\r\n\r\n----------------------------------------------\r\n\r\nUpdate GitLab-CE with the CommitDiff changes for `whitespace_changes_only` and `path`","state":"closed","created_at":"2017-04-26T13:19:29.697Z","updated_at":"2017-05-07T23:31:29.974Z","closed_at":"2017-05-07T22:59:35.526Z","closed_by":null,"labels":[],"milestone":{"id":303689,"iid":16,"project_id":2009901,"title":"Milestone 2017-05-05","description":"This release will coincide with the GitLab CE cutoff for [GitLab 9.2](https://gitlab.com/gitlab-org/gitlab-ce/milestones/36)\r\n\r\n## Themes\r\n\r\nThe themes for this milestone are, in descending priority:\r\n\r\n1. **Re-enable disabled Gitaly features on GitLab.com**: trackdown all bugs in Gitaly that are currently leading to it being disabled.\r\n\r\n2. **Move Gitaly closer to the data**: move Gitaly onto the NFS servers. Solve problems related to:\r\n  1. Git-hooks\r\n  2. Production buy-in and support\r\n  \r\n3. **Git SSH and HTTP support**:","state":"closed","created_at":"2017-04-24T10:47:39.880Z","updated_at":"2017-05-09T08:10:09.101Z","due_date":"2017-05-05","start_date":"2017-04-24","expired":true,"web_url":"https://gitlab.com/gitlab-org/gitaly/-/milestones/16"},"assignees":[{"id":506061,"username":"ahmadsherif","name":"Ahmad Sherif","state":"active","avatar_url":"https://secure.gravatar.com/avatar/bd6d0ec4213b91601956c9f801cbfe9b?s=80\u0026d=identicon","web_url":"https://gitlab.com/ahmadsherif"}],"author":{"id":895869,"username":"andrewn","name":"Andrew Newdigate","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/895869/avatar.png","web_url":"https://gitlab.com/andrewn"},"type":"ISSUE","assignee":{"id":506061,"username":"ahmadsherif","name":"Ahmad Sherif","state":"active","avatar_url":"https://secure.gravatar.com/avatar/bd6d0ec4213b91601956c9f801cbfe9b?s=80\u0026d=identicon","web_url":"https://gitlab.com/ahmadsherif"},"user_notes_count":0,"merge_requests_count":2,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/198","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/198","notes":"https://gitlab.com/api/v4/projects/2009901/issues/198/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/198/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#198","relative":"#198","full":"gitlab-org/gitaly#198"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":5199436,"iid":197,"project_id":2009901,"title":"Address unicorn grpc preforking issues in gitlab-ce","description":"Resolved by: https://gitlab.com/gitlab-org/gitlab-ce/issues/31143","state":"closed","created_at":"2017-04-26T12:15:17.921Z","updated_at":"2017-05-18T12:48:29.000Z","closed_at":"2017-04-28T17:13:15.999Z","closed_by":null,"labels":["GRPC","type::bug"],"milestone":{"id":303689,"iid":16,"project_id":2009901,"title":"Milestone 2017-05-05","description":"This release will coincide with the GitLab CE cutoff for [GitLab 9.2](https://gitlab.com/gitlab-org/gitlab-ce/milestones/36)\r\n\r\n## Themes\r\n\r\nThe themes for this milestone are, in descending priority:\r\n\r\n1. **Re-enable disabled Gitaly features on GitLab.com**: trackdown all bugs in Gitaly that are currently leading to it being disabled.\r\n\r\n2. **Move Gitaly closer to the data**: move Gitaly onto the NFS servers. Solve problems related to:\r\n  1. Git-hooks\r\n  2. Production buy-in and support\r\n  \r\n3. **Git SSH and HTTP support**:","state":"closed","created_at":"2017-04-24T10:47:39.880Z","updated_at":"2017-05-09T08:10:09.101Z","due_date":"2017-05-05","start_date":"2017-04-24","expired":true,"web_url":"https://gitlab.com/gitlab-org/gitaly/-/milestones/16"},"assignees":[{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/513969/avatar.png","web_url":"https://gitlab.com/jacobvosmaer-gitlab"}],"author":{"id":895869,"username":"andrewn","name":"Andrew Newdigate","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/895869/avatar.png","web_url":"https://gitlab.com/andrewn"},"type":"ISSUE","assignee":{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/513969/avatar.png","web_url":"https://gitlab.com/jacobvosmaer-gitlab"},"user_notes_count":1,"merge_requests_count":6,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/197","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":3,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/197","notes":"https://gitlab.com/api/v4/projects/2009901/issues/197/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/197/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#197","relative":"#197","full":"gitlab-org/gitaly#197"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":5198569,"iid":196,"project_id":2009901,"title":"Document changelog process in CONTRIBUTING","description":"Also automation in release script.","state":"closed","created_at":"2017-04-26T10:33:32.869Z","updated_at":"2017-05-04T13:35:29.214Z","closed_at":"2017-05-04T12:03:22.958Z","closed_by":null,"labels":["documentation"],"milestone":{"id":303689,"iid":16,"project_id":2009901,"title":"Milestone 2017-05-05","description":"This release will coincide with the GitLab CE cutoff for [GitLab 9.2](https://gitlab.com/gitlab-org/gitlab-ce/milestones/36)\r\n\r\n## Themes\r\n\r\nThe themes for this milestone are, in descending priority:\r\n\r\n1. **Re-enable disabled Gitaly features on GitLab.com**: trackdown all bugs in Gitaly that are currently leading to it being disabled.\r\n\r\n2. **Move Gitaly closer to the data**: move Gitaly onto the NFS servers. Solve problems related to:\r\n  1. Git-hooks\r\n  2. Production buy-in and support\r\n  \r\n3. **Git SSH and HTTP support**:","state":"closed","created_at":"2017-04-24T10:47:39.880Z","updated_at":"2017-05-09T08:10:09.101Z","due_date":"2017-05-05","start_date":"2017-04-24","expired":true,"web_url":"https://gitlab.com/gitlab-org/gitaly/-/milestones/16"},"assignees":[{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/513969/avatar.png","web_url":"https://gitlab.com/jacobvosmaer-gitlab"}],"author":{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/513969/avatar.png","web_url":"https://gitlab.com/jacobvosmaer-gitlab"},"type":"ISSUE","assignee":{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/513969/avatar.png","web_url":"https://gitlab.com/jacobvosmaer-gitlab"},"user_notes_count":0,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/196","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/196","notes":"https://gitlab.com/api/v4/projects/2009901/issues/196/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/196/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#196","relative":"#196","full":"gitlab-org/gitaly#196"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":5197911,"iid":195,"project_id":2009901,"title":"RPC Design: Commit::TreeEntry Endpoint","description":"~\"Migration Analysis\": #169 \r\n\r\n~Conversation: #310 \r\n\r\n------------------------------------\r\n\r\nGoal: develop the RPC interfaces required to migrate `Projects::RawController#show`","state":"closed","created_at":"2017-04-26T09:21:50.325Z","updated_at":"2017-06-12T18:59:44.545Z","closed_at":"2017-06-12T18:59:43.709Z","closed_by":null,"labels":["RPC Design"],"milestone":{"id":325402,"iid":20,"project_id":2009901,"title":"Milestone 2017-06-16","description":"### GitLab 9.3 Cutoff\r\n\r\n- What do we need to deliver for GitLab 9.3?","state":"closed","created_at":"2017-06-05T13:18:07.281Z","updated_at":"2017-07-06T12:50:40.535Z","due_date":"2017-06-16","start_date":"2017-06-05","expired":true,"web_url":"https://gitlab.com/gitlab-org/gitaly/-/milestones/20"},"assignees":[{"id":506061,"username":"ahmadsherif","name":"Ahmad Sherif","state":"active","avatar_url":"https://secure.gravatar.com/avatar/bd6d0ec4213b91601956c9f801cbfe9b?s=80\u0026d=identicon","web_url":"https://gitlab.com/ahmadsherif"}],"author":{"id":895869,"username":"andrewn","name":"Andrew Newdigate","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/895869/avatar.png","web_url":"https://gitlab.com/andrewn"},"type":"ISSUE","assignee":{"id":506061,"username":"ahmadsherif","name":"Ahmad Sherif","state":"active","avatar_url":"https://secure.gravatar.com/avatar/bd6d0ec4213b91601956c9f801cbfe9b?s=80\u0026d=identicon","web_url":"https://gitlab.com/ahmadsherif"},"user_notes_count":12,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/195","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":2,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/195","notes":"https://gitlab.com/api/v4/projects/2009901/issues/195/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/195/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#195","relative":"#195","full":"gitlab-org/gitaly#195"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":5197872,"iid":194,"project_id":2009901,"title":"Migration Analysis: Workhorse Sendblob","description":"~Conversation: #212 \r\n\r\nPerform an analysis of the migration of Workhorse's `sendblob`.\r\n\r\nOutput:\r\n* List of existing RPCs to be used\r\n* List of new RPCs required\r\n* Risks\r\n* Estimated effort","state":"closed","created_at":"2017-04-26T09:16:44.928Z","updated_at":"2018-06-12T12:59:22.839Z","closed_at":"2017-05-09T07:52:23.383Z","closed_by":null,"labels":["Migration Analysis"],"milestone":{"id":325402,"iid":20,"project_id":2009901,"title":"Milestone 2017-06-16","description":"### GitLab 9.3 Cutoff\r\n\r\n- What do we need to deliver for GitLab 9.3?","state":"closed","created_at":"2017-06-05T13:18:07.281Z","updated_at":"2017-07-06T12:50:40.535Z","due_date":"2017-06-16","start_date":"2017-06-05","expired":true,"web_url":"https://gitlab.com/gitlab-org/gitaly/-/milestones/20"},"assignees":[],"author":{"id":895869,"username":"andrewn","name":"Andrew Newdigate","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/895869/avatar.png","web_url":"https://gitlab.com/andrewn"},"type":"ISSUE","assignee":null,"user_notes_count":4,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/194","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/194","notes":"https://gitlab.com/api/v4/projects/2009901/issues/194/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/194/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#194","relative":"#194","full":"gitlab-org/gitaly#194"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":5197697,"iid":193,"project_id":2009901,"title":"Define the GitLab Shell \u003c-\u003e Gitaly CLI Stub interface","description":"Blocking: #124 \r\n\r\nRelated: https://gitlab.com/gitlab-org/gitlab-shell/issues/80\r\n\r\n----------------------------------\r\n\r\nAs part of https://gitlab.com/gitlab-org/gitaly/issues/124 we need to have a way of communicating between GitLab-Shell and a GitLab CLI interface.\r\n\r\nDo we use environment variables? Configuration file? Arguments?\r\n\r\nhttps://gitlab.com/gitlab-org/gitaly/issues/124 is blocked on this but work will be able to continue once it's done.","state":"closed","created_at":"2017-04-26T09:11:06.888Z","updated_at":"2017-07-05T14:48:08.094Z","closed_at":"2017-05-23T15:41:40.845Z","closed_by":null,"labels":[],"milestone":{"id":305102,"iid":17,"project_id":2009901,"title":"Milestone 2017-05-19","description":"[GitLab 9.2 release](https://gitlab.com/gitlab-org/gitlab-ce/milestones/36) has been cut, which means that the Gitaly team can start testing Gitaly running across a network. \r\n\r\nThemes: ~\"Acceptance Testing\" \r\n\r\n## Testing\r\n\r\nOur **top priority** for this release is to [test our implementations](https://gitlab.com/gitlab-org/gitaly/issues?scope=all\u0026utf8=%E2%9C%93\u0026state=opened\u0026label_name[]=Acceptance%20Testing\u0026milestone_title=Milestone%202017-05-19).\r\n\r\n@jacobvosmaer-gitlab will focus on testing [Gitaly running across the network](https://gitlab.com/gitlab-org/gitaly/issues/181) and how [GitLab handled Gitaly failures](https://gitlab.com/gitlab-org/gitaly/issues/200).\r\n\r\n@eReGeBe @ahmadsherif and @bkc will focus on testing the migrations: \r\n\r\n- #215 \r\n- #211\r\n- #210 \r\n- #209 \r\n- #184\r\n\r\n@andrewn has added some documentation about what we expect from the [acceptance testing]( \r\nhttps://gitlab.com/gitlab-org/gitaly/merge_requests/144/diffs#36e74ccc6a563cded188bd7806cb126dff075937)\r\n\r\n\r\n## Waiting for 9.2 RC1\r\n\r\nThere may be some slacktime between the start of the iteration and the availability of 9.2RC1. \r\n\r\nDuring this time, please focus on\r\n\r\n- Completing work left over from the last iteration\r\n- Other tasks assigned to you for this milestone\r\n- If you are still available, speak to @andrewn or pick a task from ~\"To Do\"\r\n\r\nPlease note that once 9.2 is available on staging, you'll need to switch across to testing as this is our top priority. If we leave testing too late, we may miss the release and will need to delay some of the feature flags by another release.\r\n\r\n\r\n\r\n","state":"closed","created_at":"2017-04-26T12:05:56.503Z","updated_at":"2017-07-06T08:50:46.869Z","due_date":"2017-05-19","start_date":"2017-05-08","expired":true,"web_url":"https://gitlab.com/gitlab-org/gitaly/-/milestones/17"},"assignees":[{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/513969/avatar.png","web_url":"https://gitlab.com/jacobvosmaer-gitlab"}],"author":{"id":895869,"username":"andrewn","name":"Andrew Newdigate","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/895869/avatar.png","web_url":"https://gitlab.com/andrewn"},"type":"ISSUE","assignee":{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/513969/avatar.png","web_url":"https://gitlab.com/jacobvosmaer-gitlab"},"user_notes_count":1,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/193","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/193","notes":"https://gitlab.com/api/v4/projects/2009901/issues/193/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/193/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#193","relative":"#193","full":"gitlab-org/gitaly#193"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":5002397,"iid":184,"project_id":2009901,"title":"Validate SmartHTTP::PostUploadPack","description":"~Conversation: https://gitlab.com/gitlab-org/gitaly/issues/219\n\nSee the [Migration Process documentation](https://gitlab.com/gitlab-org/gitaly/blob/master/doc/MIGRATION_PROCESS.md#acceptance-testing-acceptance-testing) \nfor more information on the Acceptance Testing stage of the process.\n\nFeature Toggle Environment Variable: `GITALY_POST_UPLOAD_PACK`\n\n--------------------------------------------------------------------------------\n\n- [x] [Chef recipes](https://dev.gitlab.org/cookbooks/chef-repo) to enable/disable this feature https://dev.gitlab.org/cookbooks/chef-repo/merge_requests/684\n- [x] [Grafana dashboard](https://gitlab.com/gitlab-org/grafana-dashboards/) for monitoring https://gitlab.com/gitlab-org/gitaly-dashboards/merge_requests/5\n- [ ] Environments\n    - [x] `dev.gitlab.org` https://dev.gitlab.org/cookbooks/chef-repo/merge_requests/685\n    - [x] Staging https://dev.gitlab.org/cookbooks/chef-repo/merge_requests/684\n    - [x] `gitlab.com` https://dev.gitlab.org/cookbooks/chef-repo/merge_requests/696 https://docs.google.com/document/d/1SmZvlT7D1dXsEtRPZc0xWR0jGmPmLztlGkG4_L9DQeU/edit\n- [ ] Test Results (post as comments on this issue)\n    - [ ] Did the migration perform as expected? \n    - [ ] Did the code have reasonable performance characteristics?\n    - [ ] Did error rates jump to an unacceptable level?\n- [ ] Have the changes been rolled back pending final review?\n- [ ] Runbook Added (link to MR)\n- [ ] Prometheus Alerts Added (link to MR)\n\n-----------------------------------------------------------------------------------\n\nWe now (9.1) have a feature flag GITALY_POST_UPLOAD_PACK in gitlab-ce. We should validate that it works:\n\n- [x] test in omnibus nightly\n- [x] test in RC omnibus package\n- [x] test in staging (apply setting, do manual clones, look at prometheus counters for errors and to see if the RPC is being used)\n- [x] test in production for a few hours (same as staging)\n- [ ] test in production for a week\n- [ ] enable feature flag by default in omnibus\n\n----\n## Staging steps\n\n- update `gitlab-staging-worker` role (make sure change is on chef.gitlab.com, not just in the chef-repo)\n- `knife ssh -C 1 role:gitlab-staging-worker 'sudo chef-client; sleep 60; sudo gitlab-ctl term unicorn; echo done $?'` (`-C 1` is probably too slow for production)\n- `knife ssh role:gitlab-staging-worker 'for p in $(pgrep -f \"unicorn master\"); do ps -o pid,etime,args -p $p; sudo cat  /proc/$p/environ | xargs --null --max-args=1; done' | grep GITALY`\n - check [gitaly staging prometheus dashbord](https://performance.gitlab.net/dashboard/db/gitaly?orgId=1\u0026var-job=gitaly-staging)\n- check [Sentry for staging](https://sentry.gitlap.com/gitlab/staginggitlabcom/)\n- manual tests\n- revert config change\n\n## Local omnibus steps\n\nIn gitlab.rb:\n\n```ruby\ngitlab_rails['env'] = {'GITALY_POST_UPLOAD_PACK' =\u003e '1'}\n```\n\nTo apply or revert:\n\n```\nsudo gitlab-ctl reconfigure\nsleep 60 # wait for unicorn to reload\nsudo gitlab-ctl term unicorn\n# test environment of unicorn master. should print a match\nfor p in $(pgrep -f 'unicorn master'); do ps -o pid,etime,args -p $p; sudo cat  /proc/$p/environ | xargs --null --max-args=1 | grep GITALY; done\n```\n\nThe rigmarole with `gitlab-ctl term` is because of https://gitlab.com/gitlab-org/omnibus-gitlab/issues/2002","state":"closed","created_at":"2017-04-10T14:44:46.799Z","updated_at":"2017-09-05T11:20:32.304Z","closed_at":"2017-09-01T08:45:22.927Z","closed_by":null,"labels":[],"milestone":null,"assignees":[{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/513969/avatar.png","web_url":"https://gitlab.com/jacobvosmaer-gitlab"}],"author":{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/513969/avatar.png","web_url":"https://gitlab.com/jacobvosmaer-gitlab"},"type":"ISSUE","assignee":{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/513969/avatar.png","web_url":"https://gitlab.com/jacobvosmaer-gitlab"},"user_notes_count":49,"merge_requests_count":6,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/184","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":19,"completed_count":9},"weight":3,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/184","notes":"https://gitlab.com/api/v4/projects/2009901/issues/184/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/184/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#184","relative":"#184","full":"gitlab-org/gitaly#184"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":4985014,"iid":181,"project_id":2009901,"title":"Gitaly-on-NFS staging test plan","description":"How will we test this on staging with 9.1. RCx.\r\n\r\n- [x] make sure Gitaly over TCP works in omnibus\r\n- [x] test with localhost\r\n- [x] test with remote host and different repository root\r\n- [ ] instructions to prepare staging\r\n- [x] wait for package with all required capabilities to be deployed on staging\r\n- [ ] schedule time with someone with production access to run experiments on staging\r\n\r\nParallel production issue: https://gitlab.com/gitlab-com/infrastructure/issues/1777\r\n\r\nMerge Request with (some of) the required staging configuration changes https://dev.gitlab.org/cookbooks/chef-repo/merge_requests/637","state":"closed","created_at":"2017-04-07T16:07:31.432Z","updated_at":"2018-07-18T19:28:54.871Z","closed_at":"2017-06-05T13:39:42.879Z","closed_by":null,"labels":[],"milestone":{"id":315744,"iid":19,"project_id":2009901,"title":"Milestone 2017-06-02","description":"","state":"closed","created_at":"2017-05-17T14:34:14.380Z","updated_at":"2017-07-06T08:51:21.797Z","due_date":"2017-06-02","start_date":"2017-05-22","expired":true,"web_url":"https://gitlab.com/gitlab-org/gitaly/-/milestones/19"},"assignees":[{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/513969/avatar.png","web_url":"https://gitlab.com/jacobvosmaer-gitlab"}],"author":{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/513969/avatar.png","web_url":"https://gitlab.com/jacobvosmaer-gitlab"},"type":"ISSUE","assignee":{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/513969/avatar.png","web_url":"https://gitlab.com/jacobvosmaer-gitlab"},"user_notes_count":41,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/181","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":6,"completed_count":4},"weight":3,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/181","notes":"https://gitlab.com/api/v4/projects/2009901/issues/181/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/181/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#181","relative":"#181","full":"gitlab-org/gitaly#181"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":4976958,"iid":178,"project_id":2009901,"title":"Operation `CommitDiff ` on service `Diff` doesn't implement the full functionality expected by Gitlab CE","description":"~Conversation: gitlab-org/gitaly#222\r\n\r\nThe following flags are not supported:\r\n\r\n- [ ] deltas_only\r\n- [ ] ignore_whitespace_change\r\n- [ ] paths\r\n\r\nBecause of this reason, we can't fully migrate this operation to Gitaly. We should implement support for these flags. This will require changes in gitaly-proto.\r\n\r\n/cc @jacobvosmaer-gitlab @andrewn @ahmadsherif ","state":"closed","created_at":"2017-04-06T20:19:05.747Z","updated_at":"2017-05-09T13:16:16.361Z","closed_at":"2017-05-05T14:27:37.998Z","closed_by":null,"labels":["Server Implementation","type::bug"],"milestone":{"id":303689,"iid":16,"project_id":2009901,"title":"Milestone 2017-05-05","description":"This release will coincide with the GitLab CE cutoff for [GitLab 9.2](https://gitlab.com/gitlab-org/gitlab-ce/milestones/36)\r\n\r\n## Themes\r\n\r\nThe themes for this milestone are, in descending priority:\r\n\r\n1. **Re-enable disabled Gitaly features on GitLab.com**: trackdown all bugs in Gitaly that are currently leading to it being disabled.\r\n\r\n2. **Move Gitaly closer to the data**: move Gitaly onto the NFS servers. Solve problems related to:\r\n  1. Git-hooks\r\n  2. Production buy-in and support\r\n  \r\n3. **Git SSH and HTTP support**:","state":"closed","created_at":"2017-04-24T10:47:39.880Z","updated_at":"2017-05-09T08:10:09.101Z","due_date":"2017-05-05","start_date":"2017-04-24","expired":true,"web_url":"https://gitlab.com/gitlab-org/gitaly/-/milestones/16"},"assignees":[{"id":506061,"username":"ahmadsherif","name":"Ahmad Sherif","state":"active","avatar_url":"https://secure.gravatar.com/avatar/bd6d0ec4213b91601956c9f801cbfe9b?s=80\u0026d=identicon","web_url":"https://gitlab.com/ahmadsherif"}],"author":{"id":367626,"username":"alejandro","name":"Alejandro Rodríguez","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/367626/avatar.png","web_url":"https://gitlab.com/alejandro"},"type":"ISSUE","assignee":{"id":506061,"username":"ahmadsherif","name":"Ahmad Sherif","state":"active","avatar_url":"https://secure.gravatar.com/avatar/bd6d0ec4213b91601956c9f801cbfe9b?s=80\u0026d=identicon","web_url":"https://gitlab.com/ahmadsherif"},"user_notes_count":8,"merge_requests_count":0,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/178","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":3,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":false,"_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/178","notes":"https://gitlab.com/api/v4/projects/2009901/issues/178/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/178/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#178","relative":"#178","full":"gitlab-org/gitaly#178"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":4700826,"iid":123,"project_id":2009901,"title":"Forward Git SSH sessions from gitlab-shell to Gitaly Server Implementation","description":"~Conversation: gitlab-org/gitaly#218\r\n\r\nDepends on ~\"Migration Analysis\" #91\r\n\r\nDepends on ~\"RPC Design\" https://gitlab.com/gitlab-org/gitaly-proto/merge_requests/5\r\n\r\n-------------------\r\n\r\n### ~\"Server Implementation\" Forward Git SSH sessions from gitlab-shell to Gitaly\r\n\r\nGoal: allow Gitaly to monitor and control the git upload-pack and git receive-pack server-side processes spawned by the Git SSH transport.\r\n\r\n\r\nWe already have a protocol for this. https://gitlab.com/gitlab-org/gitaly-proto/blob/v0.5.0/ssh.proto \r\n\r\nWe want to be able to run two commands on behalf of SSH clients: `git upload-pack` and `git receive-pack`. Each has its own RPC `SSHUploadPack` and `SSHReceivePack`.\r\n\r\nThe idea behind the current proto is:\r\n\r\n- read first request message to get Repository and some metadata (GL_ID variable) in case of receive-pack\r\n- start the git process requested for the correct git repository path\r\n- in a goroutine: copy the rest of the request stream to stdin\r\n- in two goroutines: copy the stdout and stderr streams to the response\r\n- wait for the git command, out and err streams to finish\r\n- send final response message containing the git exit code","state":"closed","created_at":"2017-03-13T12:11:11.416Z","updated_at":"2018-06-12T12:59:17.478Z","closed_at":"2017-05-15T10:43:00.812Z","closed_by":null,"labels":["Server Implementation"],"milestone":{"id":305102,"iid":17,"project_id":2009901,"title":"Milestone 2017-05-19","description":"[GitLab 9.2 release](https://gitlab.com/gitlab-org/gitlab-ce/milestones/36) has been cut, which means that the Gitaly team can start testing Gitaly running across a network. \r\n\r\nThemes: ~\"Acceptance Testing\" \r\n\r\n## Testing\r\n\r\nOur **top priority** for this release is to [test our implementations](https://gitlab.com/gitlab-org/gitaly/issues?scope=all\u0026utf8=%E2%9C%93\u0026state=opened\u0026label_name[]=Acceptance%20Testing\u0026milestone_title=Milestone%202017-05-19).\r\n\r\n@jacobvosmaer-gitlab will focus on testing [Gitaly running across the network](https://gitlab.com/gitlab-org/gitaly/issues/181) and how [GitLab handled Gitaly failures](https://gitlab.com/gitlab-org/gitaly/issues/200).\r\n\r\n@eReGeBe @ahmadsherif and @bkc will focus on testing the migrations: \r\n\r\n- #215 \r\n- #211\r\n- #210 \r\n- #209 \r\n- #184\r\n\r\n@andrewn has added some documentation about what we expect from the [acceptance testing]( \r\nhttps://gitlab.com/gitlab-org/gitaly/merge_requests/144/diffs#36e74ccc6a563cded188bd7806cb126dff075937)\r\n\r\n\r\n## Waiting for 9.2 RC1\r\n\r\nThere may be some slacktime between the start of the iteration and the availability of 9.2RC1. \r\n\r\nDuring this time, please focus on\r\n\r\n- Completing work left over from the last iteration\r\n- Other tasks assigned to you for this milestone\r\n- If you are still available, speak to @andrewn or pick a task from ~\"To Do\"\r\n\r\nPlease note that once 9.2 is available on staging, you'll need to switch across to testing as this is our top priority. If we leave testing too late, we may miss the release and will need to delay some of the feature flags by another release.\r\n\r\n\r\n\r\n","state":"closed","created_at":"2017-04-26T12:05:56.503Z","updated_at":"2017-07-06T08:50:46.869Z","due_date":"2017-05-19","start_date":"2017-05-08","expired":true,"web_url":"https://gitlab.com/gitlab-org/gitaly/-/milestones/17"},"assignees":[],"author":{"id":895869,"username":"andrewn","name":"Andrew Newdigate","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/895869/avatar.png","web_url":"https://gitlab.com/andrewn"},"type":"ISSUE","assignee":null,"user_notes_count":0,"merge_requests_count":1,"upvotes":0,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/123","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":4,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/123","notes":"https://gitlab.com/api/v4/projects/2009901/issues/123/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/123/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#123","relative":"#123","full":"gitlab-org/gitaly#123"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null},{"id":4447094,"iid":94,"project_id":2009901,"title":"`make test` requires all files to be checked in","description":"Currently, the test suite is checking that all files are checked in and failing if there are any local changes:\n \n```\nnotice-up-to-date:\tnotice\n\tgit ls-files --error-unmatch NOTICE # NOTICE is a tracked file\n\tgit diff --exit-code # there are no changed files\n```\n\nThis is happening here: `git diff --exit-code`\n\nI would question why we have this at all:\n1. In a local development environment, we would expect there to be uncommitted changes.\n2. In a CI environment, this would not serve a purpose either\n\nWe should be able to run `make test` without requiring all changes to be committed.","state":"closed","created_at":"2017-02-20T12:49:44.183Z","updated_at":"2019-08-07T08:28:47.591Z","closed_at":null,"closed_by":null,"labels":["devops::systems","group::distribution"],"milestone":null,"assignees":[{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/513969/avatar.png","web_url":"https://gitlab.com/jacobvosmaer-gitlab"}],"author":{"id":895869,"username":"andrewn","name":"Andrew Newdigate","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/895869/avatar.png","web_url":"https://gitlab.com/andrewn"},"type":"ISSUE","assignee":{"id":513969,"username":"jacobvosmaer-gitlab","name":"Jacob Vosmaer","state":"blocked","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/513969/avatar.png","web_url":"https://gitlab.com/jacobvosmaer-gitlab"},"user_notes_count":0,"merge_requests_count":1,"upvotes":1,"downvotes":0,"due_date":null,"confidential":false,"discussion_locked":null,"issue_type":"issue","web_url":"https://gitlab.com/gitlab-org/gitaly/-/issues/94","time_stats":{"time_estimate":0,"total_time_spent":0,"human_time_estimate":null,"human_total_time_spent":null},"task_completion_status":{"count":0,"completed_count":0},"weight":1,"blocking_issues_count":0,"has_tasks":true,"task_status":"0 of 0 checklist items completed","_links":{"self":"https://gitlab.com/api/v4/projects/2009901/issues/94","notes":"https://gitlab.com/api/v4/projects/2009901/issues/94/notes","award_emoji":"https://gitlab.com/api/v4/projects/2009901/issues/94/award_emoji","project":"https://gitlab.com/api/v4/projects/2009901","closed_as_duplicate_of":null},"references":{"short":"#94","relative":"#94","full":"gitlab-org/gitaly#94"},"severity":"UNKNOWN","moved_to_id":null,"service_desk_reply_to":null,"epic_iid":null,"epic":null,"iteration":null,"health_status":null}]